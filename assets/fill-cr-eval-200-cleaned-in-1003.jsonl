[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n**** START OF CHANGES ****\nAnnex X: \t5G security characteristics (informative)\n\nCharacteristics\tSub-Characteristics\tIndications\nSecondary authentication\t\tRequired\n\t\tNot needed\nUser Plane\t\tEncryption\tRequired\n\t\tNot needed\n\tIntegrity\tRequired\n\t\tNot needed\nControl Plane (RRC and NAS)\tEncryption\tRequired\n\t\tNot needed\n\tIntegrity\tRequired\nKey storage\tK_AUSF storage in AUSF\tRequired\n\t\tNot needed\n\tK_SEAF storage in SEAF\tRequired\n\t\tNot needed\nSUCI encryption methods\t\t\t\tNULL scheme\n\t\tPublic Key encryption scheme\n\n\nCharacteristics\tSub-Characteristics\tSupported Methods \nPrimary Authentication\t\t5G-AKA (Mandatory)\tEAP-AKA\u2019 (Mandatory)\tEAP-TLS and other EAP methods (Informative)\nSecondary authentication\tIf secondary authentication is required, the supported EAP methods are shown in the next column\tOptional methods (non-exhaustive list)\tEAP-TLS\tEAP-PSK\tEAP-TTLS\tEAP-IKEv2\tEAP-FAST\nUser Plane\tEncryption\tNEA0 (Mandatory)\t128-NEA1 (Mandatory)\t128-NEA2 (Mandatory)\t128-NEA3 (Optional)\n\tIntegrity\t128-NIA1 (Mandatory)\t128-NIA2 (Mandatory)\t128-NIA3 (Optional)\nControl Plane\tEncryption\tNEA0 (Mandatory)\t128-NEA1 (Mandatory)\t128-NEA2 (Mandatory)\t128-NEA3 (Optional)\n\tIntegrity\t128-NIA1 (Mandatory)\t128-NIA2 (Mandatory)\t128-NIA3 (Optional)\n\n\n**** End of Changes ****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThis contribution summarizes the security characteristics in TS 33.501 and it is good to have such information in the spec.\n\n>>> SUMMARY OF CHANGE\nThis CR proposes a new Annex to include a summary of security characteristics\n\n>>> CONSEQUENCES IF NOT REVISED\nSecurity features are scattered throughout the specs and may be overlooked by many."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n6.4.6\tProtection of initial NAS message\nThe initial NAS message is the first NAS message that is sent after the UE transitions from the idle state. The UE shall send a limited set of IEs (called the cleartext IEs) including those needed to establish security in the initial message when it has no NAS security context. When the UE has a security context, the UE shall send a message that has the complete initial NAS message ciphered in a NAS Container along with the cleartext IEs with whole message integrity protected. The complete initial message is included in the NAS Security Mode Complete message in a NAS Container when needed (e.g. AMF cannot find the used security context) in the latter case and always in the former case as described below.\nThe protection of the initial NAS message proceeds as shown in Figure 6.4.6-1.\n\nFigure 6.4.6-1: Protecting the initial NAS message\nStep 1: The UE shall send the initial NAS message to the AMF. If the UE has no NAS security context, the initial NAS message shall only contain the cleartext IEs, i.e. subscription identifiers (e.g. SUCI or GUTIs), UE security capabilities, ngKSI,  indication that the UE is moving from EPC, Additional GUTI, and IE containing the TAU Request in the case idle mobility from LTE.\nIf the UE has a NAS security context, the message sent shall contain the information given above in cleartext and the complete initial NAS message ciphered in a NAS container which is ciphered. With a NAS security context, the sent message shall also be integrity protected. In the case that the initial NAS message was protected and  the AMF has the same security context, then steps 2 to 4 may be omitted In this case the AMF shall use the complete initial NAS message that is in the NAS container as the message to respond to..\nStep 2: If the AMF is not able to find the security context locally or from last visited AMF, or if the integrity check fails, then the AMF shall initiate an authentication procedure with the UE. If the AMF fetches old security context from the last visited AMF, the AMF may decipher the NAS container with the same security context, and get the initial NAS message, then the step 2b to 4 may be omitted. If the AMF fetches new K AMF from the last visited AMF (receiving keyAmfChangeInd), the step 2b may be omitted.\nStep 3: If the authentication of the UE is successful, the AMF shall send the NAS Security Mode Command message. If the initial NAS message was protected but did not pass the integrity check (due either to a MAC failure or the AMF not being able to find the used security context) or the AMF could not decrypt the complete initial NAS message in the NAS container (due to receiving \"keyAmfChangeInd\" from the last visited AMF), then the AMF shall include in the Security Mode Command message a flag requesting the UE to send the complete initial NAS message in the NAS Security Mode Complete message.  \nStep 4: The UE shall send the NAS Security Mode Complete message to the network in response to a NAS Security Mode Command message. The NAS Security Mode Complete message shall be ciphered and integrity protected. Furthermore the NAS Security Mode Complete message shall include the complete initial NAS message in a NAS Container if either requested by the AMF or the UE sent the initial NAS message unprotected. The AMF shall use the complete initial NAS message that is in the NAS container as the message to respond to. \nStep 5: The AMF shall send its response to the Initial NAS message. This message shall be ciphered and integrity protected.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to current specification TS 33.501  if the UE has 5G NAS security context then the UE encrpts cleartext and non-clear text IEs using the ciphering method of the 5G NAS security context and sends in the Initial NAS message. This behavior also applies for the case when the assigned ciphering algorithm in 5G NAS security context is NULL ciphering (NEA0) i.e. by local regulation PLMN selects null ciphering.  This behavior brings following issue.A UE is registered to a PLMN  and 5G NAS security context is established with null ciphering method (NEA0) due to local regulation (local regulation of a country). The UE changes to another PLMN(e.g. a PLMN of another country) which does not allow null ciphering according to local requirement. In this scenario the UE will sends non-cleartext IE will null ciphering as per the 5G NAS secruity context established in step 1.In the above secnario the UE violates the local requirement of the PLMN and also the non-cleartext IEs (sensitive information) are sent with null ciphering i.e. without any encrptions so the man in middle can get know the sensitive information of the UE.Also CT1 in last CT1 meeting#117 has agreed a CR (C1-193295) where it is mentioned that the UE will perform a Registration procedure for mobility and periodic registration update when a UE selects a new PLMN in the 5GMM-REGISTERED.PLMN.SEARCH state.\n\n>>> SUMMARY OF CHANGE\nSpecify that when the UE registered to a PLMN and 5G NAS security context is established with null ciphering and the UE selects another PLMN then the UE sends Initial NAS message with cleartext IE(s) only. When the new PLMN initiates NAS Security mode control procedure then the UE sends the initial NAS message with cleartext(s) and non-cleartext IE(s) in Security mode complete message.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE will sends viloates the local regulation and also the user sensitive information are sent without encryption."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\t\t\t\t\t\t\t\t\t***\tBEGIN CHANGES\t***\n\n6.1.1\tCommon rules to all certificates\n-\tVersion 3 certificate according to RFC5280\u00a0[14].\n-\tHash algorithm for use before signing certificate: SHA-256 shall be supported, SHA-384 should be supported, MD5, MD2, and SHA-1 shall not be supported. \nNOTE 1:\tVoid.\n-\tSignature algorithm: RSAEncryption and ecdsa shall be supported. \n-\tPublic key algorithm: rsaEncryption and id-ecPublicKey shall be supported.\n\t-\tParameters: For ecdsa and id-ecPublicKey, secp256r1 shall be supported.\n-\tECDSA is recommended for newly created certificates.\n-\tFor RSA certificates: The public key length shall be at least 2048-bit. A public key length of at least 4096-bit should be supported. Public key lengths of less than 2048-bit shall not be supported.\n-\tFor ECDSA certificates: The public key length shall be at least 255-bit. A public key length of at least 384-bit shall be supported. Public key lengths of less than 255-bit shall not be supported.\nNOTE 2:\tFor interworking with pre-Release 10 elements, usage of public key lengths less than 2048-bit in certificates may be required for some time. However, it is likely that in a future 3GPP release, certificates which use public key lengths less than 2048-bit will be prohibited.\n\n-\tFor CA certificates using RSA the public key length shall be at least 2048-bit and a public key length of at least 4096-bit shall be supported.-\tThe security level of the public key used to sign the certificate shall be at least the same as the public keys in the certicate.\n-\tSubject and issuer name format. \n-\t(C=<country>), O=<Organization Name>, CN=<Some distinguishing name>. Organization and CN shall be in UTF8 format. Note that C is optional element.\nor\n-\tcn=<hostname>, (ou=<servers>), dc=<domain>, dc=<domain>. Note that ou is optional element.\n-\tCRLs as specified in subclause 6.1a shall be supported for certificate revocation verification. \n-\tCertificate extensions which are not mandated by this specification but which are mentioned within RFC5280 [14] are optional for implementation. If present, such optional extensions shall be marked as \u201cnon critical\u201c.\nNOTE 3:\tThe above requirement implies that an NE, SEG or TLS entity receiving such optional extensions marked as \u201ccritical\u201d will react with an error because, according to the introduction to clause 6.1 of the present document, NEs, SEGs and TLS entities shall only accept compliant certificates.\n\n***\tNEXT CHANGE \t***\n\n6.1a\tCRL profile\n-\tVersion 2 CRL according to RFC5280\u00a0[14].\n-\tHash algorithm for use before signing CRL: SHA-256 shall be supported SHA-384 should be supported,, M,D5 MD2, and SHA-1 shall not be used. \nNOTE:\tVoid.\n-\tSignature algorithm: RSAEncryption and ecdsa shall be supported.\n-\tParameters: For ecdsa, secp256r1 shall be supported, secp384r1 should be supported.\n-\tECDSA is recommended for newly created CRLs.\n-\tThe security level of the public key used to sign the CRL shall be at least the same as the public keys used to sign the revoked certificates.\n-\tFor RSA: Public key lengths of 4096-bit for CRL signing shall be supported. \n-\tFor ECDSA: Public key lengths of at least 384-bit for CRL signing shall be supported. \n\nCRL retrieval with LDAPv3\u00a0[5] shall be supported as the primary method. HTTP may be used for checking the revocation status of TLS and NE certificates.\n\n***\tNEXT CHANGE \t***\n\nAnnex G (informative):\nExample CMPv2 Message Flow for Initial Enrolment\nThe purpose of this annex is to provide an overview how the initial enrolment of a base station may be executed.\nThe message flow for an initial enrolment of a base station to the RA/CA is shown in Figure 8 below. The text below the figure gives a description of this message flow. Precondition for this message flow is that the base station contains the vendor provided private/public key pair and is pre-provisioned with the related base station certificate signed by a vendor CA. If there is a certificate chain up to the vendor root CA, also the intermediate certificates must be pre-provisioned to the base station. The RA/CA is configured with the root certificate of the vendor and its own certificate(s). The exchanged messages are protected by setting the PKIHeader fields \u201cprotection\u201d and \u201cprotectionAlg\u201d. Example of protectionAlg is set to the value {1 2 840 113549 1 1 5} (sha1WithRSAEncrypt) when SHA-1 is used or {1 2 840 11359 1 1 11} (sha256With RSAEncrypt) when SHA-256 is used.\n\nFigure 8: Example message flow for initial base station enrolment\n1.\tThe base station discovers the RA/CA address.\n2.\tThe base station generates the private/public key pair to be enrolled in the operator CA, if this is not pre-provisioned.\n3.\tThe base station generates the Initialization Request (ir). The CertReqMsg inside ir specifies the requested certificate. If the suggested identity is known to the base station, it includes this in the subject field. To provide proof of possession the base station generates the signature for the POPOSigningKey field of the CertReqMsg using the private key related to the public key to be certified by the RA/CA. The base station signs the ir using the vendor provided private key, and includes the digital signature in the PKIMessage. Its own vendor signed certificate and any intermediate certificates are included in the extraCerts field of the PKIMessage carrying the ir.\n4.\tThe base station sends the signed ir message to the RA/CA.\n5.\tThe RA/CA verifies the digital signature on the ir message against the vendor root certificate using the certificate(s) sent by the base station. The RA/CA also verifies the proof of the possession of the private key for the requested certificate.\n6.\tThe RA/CA generates the certificate for base station. If the suggested identity of the base station is not included in the ir message, the RA/CA determines the suggested identity of the base station, e.g. based on the vendor provided identity of the base station contained in the base station certificate.\nNOTE: The procedures for determination of the base station identity used by the operator are not in scope of the present document. According to [4], the RA/CA may replace a suggested identity sent by the base station with another identity based on local information.\n7.\tThe RA/CA generates an Initialization Response (ip) which includes the issued certificate and uses the same certReqId value as in the Initialization Request. The RA/CA signs the ip with the RA/CA private key (or the private key for signing CMP messages, if separate), and includes the signature, the RA/CA certificate(s) and the operator root certificate in the PKIMessage. The appropriate certificate chains for authenticating the RA/CA certificate(s) are included in the PKIMessage.\n8.\tThe RA/CA sends the signed ip to the base station.\n9.\tIf the operator root certificate is not pre-provisioned to the base station, the base station extracts the operator root certificate from the PKIMessage. The base station authenticates the PKIMessage using the RA/CA certificate and installs the base station certificate on success.\n10.\tThe base station creates and signs the CertificateConfirm (certconf) message. The CertficateConfirm message uses the same certReqId value as in the Initialization Request.\n11. The base station sends the PKIMessage that includes the signed CertificateConfirm to the RA/CA.\n12.\t The RA/CA authenticates the PKI Message that includes the CertificateConfirm.\n13.\tThe RA/CA creates and signs a Confirmation message (pkiconf).\n14.\tThe RA/CA sends the signed PKIMessage including the pkiconf message to the base station.\n15.\tThe base station authenticates the pkiconf message.\n***\tEND OF CHANGES\t***\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe 3GPP security protocol profiles needs to be regularlarly updated to stay up to date and remain secure.- The key length requirements talks about the \u201cpublic key length\u201d. This could be understood like the requirements does not apply to the signature algorithm.- RSA key lengths less than 2048 have been forbidden since Rel-14, but a note stating that key lengths less than 2048 is likely to be forbidden in a future release was forgotten and therefore still remains in clause 6.1.1.- After the requirements for all RSA certificates have been increased, the bullet regarding RSA CA certificates does not add anything.- CRL profile is missing minimum key lengths. CRL profile states \u201cshall support RSA-4096\u201d while Certificate profile states \u201cshould support RSA-4096\u201d.- Certificates with Signature Algorithm RSAEncryption always uses PKCS#1v1.5 padding (note that certificates with public key algorithm rsaEncryption can be used with any RSA algorithm). IETF and other organisations is working on phasing out PKCS#1v1.5 padding.Examples:IETF has completely removed PKCS#1v1.5 padding in TLS 1.3 (RFC 8466) except for use in legacy certificates.https://tools.ietf.org/html/rfc8446ENISA writes about PKCS#1v1.5 padding in signatures that \u201cwe do not propose that it is used anywhere but in legacy systems\u201d.https://www.enisa.europa.eu/publications/algorithms-key-size-and-parameters-report-2014BSI states that \u201cUsage of the older PKCS#1v1.5 paddings is not recommended\u201d. BSI requires that signatures with PKCS#1v1.5 padding is phased out no later than 2026.https://www.bsi.bund.de/EN/Publications/TechnicalGuidelines/tr02102/index_htm.htmlCritical infrastructure like 3GPP should start to phase out PKCS#1v1.5 padding, otherwise there is a risk that 3GPP systems are deployed with long term RSA certificates with PKCS#1v1.5 padding that cannot be replaced in time. ECDSA signatures are already mandatory to support and recommended for new certificates. Introducing id-RSASSA-PSS  as a third certificates signature algorithms do not seem worthwhile at this point. Any new certificates signature algorithms should be EdDSA (standardized by IETF and soon NIST), stateful hash-based PQC signatures like LMS and XMSS (standardized by IETF and soon NIST), or stateless PQC signatures (work ongoing by NIST).- It is time to start planning deprecation of RSA-2048, otherwise there is a risk that 3GPP systems are deployed with long term RSA-2048 certificates that cannot be replaced in time. Best practice will in some years be to not use RSA-2048. As examples, NIST (USA) and ANSSI (France) forbids use of RSA-2048 from 2031. BSI (Germany) forbids use of RSA-2048 and 2048-bit Diffie-Hellman already from 2023. Critical infrastructure like 3GPP should start to phase out use of RSA-2048.- SHA-1 has been forbidden in signatures since Rel-14, but an example using sha1WithRSAEncrypt still exists in Annex G.\n\n>>> SUMMARY OF CHANGE\n- \u201cpublic key length\u201d is changed to \u201ckey length\u201d- The note is voided.- The bullet regarding RSA CA certificates is deleted.- Key length requirements in CRL and Certificate profiles are harmonised. - PKCS#1v1.5 padding is not recommended.- Note that PKCS#1v1.5 paddign and RSA-2048 will likely be forbidden in a future release.- The example with SHA-1 is deleted.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe note and the example are conflicting with the actual specification and may confuse implementors or security researchers analysing 3GPP specifications, leding to implementation weaknesses.Risk that 3GPP systems are deployed with long term RSA-2048 or PKCS #1 v1.5 certificates that cannot be replaced in time."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*** START OF CHANGES ***\n6.1.3.1\tAuthentication procedure for EAP-AKA'\nEAP-AKA' is specified in RFC 5448 [12]. The 3GPP 5G profile for EAP-AKA' is specified in the normative Annex F.\nEditor\u2019s Note: The reference to RFC 5448 will be superseded by the internet draft referred to in [67] when it becomes an RFC.\nThe selection of using EAP-AKA' is described in sub-clause 6.1.2 of the present document. \nFigure 6.1.3.1-1: Authentication procedure for EAP-AKA'\nThe authentication procedure for EAP-AKA' works as follows, cf. also Figure 6.1.3.1-1:\n1.\tThe UDM/ARPF shall first generate an authentication vector with Authentication Management Field (AMF) separation bit = 1 as defined in TS 33.102 [9]. The UDM/ARPF shall then compute CK' and IK' as per the normative Annex A and replace CK and IK by CK' and IK'. \n2.\tThe UDM shall subsequently send this transformed authentication vector AV' (RAND, AUTN, XRES, CK', IK') to the AUSF from which it received the Nudm_UEAuthentication_Get Request together with an indication that the AV' is to be used for EAP-AKA' using a Nudm_UEAuthentication_Get Response message. \nNOTE:\tThe exchange of a Nudm_UEAuthentication_Get Request message and an Nudm_UEAuthentication_Get Response message between the AUSF and the UDM/ARPF described in the preceding paragraph is the same as for trusted access using EAP-AKA' described in TS 33.402 [11], sub-clause 6.2, step 10, except for the input parameter to the key derivation, which is the value of <network name>. The \"network name\" is a concept from RFC 5448 [12]; it is carried in the AT_KDF_INPUT attribute in EAP-AKA'. The value of <network name> parameter is not defined in RFC 5448 [12], but rather in 3GPP specifications. For EPS, it is defined as \" access network identity \" in TS 24.302 [13], and for 5G, it is defined as \"serving network name\" in sub-clause 6.1.1.4 of the present document.\n\nIn case SUCI was included in the Nudm_UEAuthentication_Get Request, UDM will include the SUPI in the Nudm_UEAuthentication_Get Response.\nThe AUSF and the UE shall then proceed as described in RFC 5448 [12] until the AUSF is ready to send the EAP-Success.\n3.\tThe AUSF shall send the EAP-Request/AKA'-Challenge message to the SEAF in a Nausf_UEAuthentication_Authenticate Response message. 4.\tThe SEAF shall transparently forward the EAP-Request/AKA'-Challenge message to the UE in a NAS message Authentication Request message. The ME shall forward the RAND and AUTN received in EAP-Request/AKA'-Challenge message to the USIM. This message shall include the ngKSI and ABBA parameter. In fact, SEAF shall include the ngKSI and ABBA parameter in all EAP-Authentication request message. ngKSI will be used by the UE and AMF to identify the partial native security context that is created if the authentication is successful. The SEAF shall set the ABBA parameter as defined in Annex A.7.1. During an EAP authentication, the value of the ngKSI and the ABBA parameter sent by the SEAF to the UE shall not be changed.\nNOTE 1: \tThe SEAF needs to understand that the authentication method used is an EAP method by evaluating the type of authentication method based on the Nausf_UEAuthentication_Authenticate Response message. \n5.\tAt receipt of the RAND and AUTN, the USIM shall verify the freshness of the AV' by checking whether AUTN can be accepted as described in TS 33.102 [4]. If so, the USIM computes a response RES. The USIM shall return RES, CK, IK to the ME. If the USIM computes a Kc (i.e. GPRS Kc) from CK and IK using conversion function c3 as described in TS 33.102 [4], and sends it to the ME, then the ME shall ignore such GPRS Kc and not store the GPRS Kc on USIM or in ME. The ME shall derive CK' and IK' according to Annex A.3.\n\tIf the verification of the AUTN fails on the USIM, then the USIM and ME shall proceed as described in sub-clause 6.1.3. 3.\n6.\tThe UE shall send the EAP-Response/AKA'-Challenge message to the SEAF in a NAS message Auth-Resp message.\n7.\tThe SEAF shall transparently forward the EAP-Response/AKA'-Challenge message to the AUSF in Nausf_UEAuthentication_Authenticate Request message. \n8.\tThe AUSF shall verify the message, and if the AUSF has successfully verified this message it shall continue as follows, otherwise it shall return an error to the SEAF. AUSF shall inform UDM about the authentication result (see sub-clause 6.1.4 of the present document for details on linking authentication confirmation). \n9.\tThe AUSF and the UE may exchange EAP-Request/AKA'-Notification and EAP-Response /AKA'-Notification messages via the SEAF. The SEAF shall transparently forward these messages. \nNOTE 2: \tEAP Notifications as described in RFC 3748 [27] and EAP-AKA Notifications as described in RFC 4187 [21] can be used at any time in the EAP-AKA exchange. These notifications can be used e.g. for protected result indications or when the EAP server detects an error in the received EAP-AKA response.  \n10.\tThe AUSF derives EMSK from CK\u2019 and IK\u2019 as described in RFC 5448[12] and Annex F. The AUSF uses the most significant 256 bits of EMSK as the KAUSF and then calculates KSEAF from KAUSF as described in clause A.6. The AUSF shall send an EAP Success message to the SEAF inside Nausf_UEAuthentication_Authenticate Response, which shall forward it transparently to the UE. Nausf_UEAuthentication_Authenticate Response message contains the KSEAF. If the AUSF received a SUCI from the SEAF when the authentication was initiated (see sub-clause 6.1.2 of the present document), then the AUSF shall also include the SUPI in the Nausf_UEAuthentication_Authenticate Response message. \nNOTE 3: \tFor lawful interception, the AUSF sending SUPI to SEAF is necessary but not sufficient. By including the SUPI as input parameter to the key derivation of KAMF from KSEAF, additional assurance on the correctness of SUPI is achieved by the serving network from both, home network and UE side. \n11.\tThe SEAF shall send the EAP Success message to the UE in the N1 message. This message shall also include the ngKSI and the ABBA parameter. The SEAF shall set the ABBA parameter as defined in Annex A.7.1.\nNOTE 4: \tStep 11 could be NAS Security Mode Command or Authentication Result. \nNOTE 5: \tThe ABBA parameter is included to enable the bidding down protection of security features that may be introduced later.  \nThe key received in the Nausf_UEAuthentication_Authenticate Response message shall become the anchor key, KSEAF in the sense of the key hierarchy in sub-clause 6.2 of the present document. The SEAF shall then derive the KAMF from the KSEAF, the ABBA parameter and the SUPI according to Annex A.7 and send it to the AMF. On receiving the EAP-Success message, the UE derives EMSK from CK\u2019 and IK\u2019 as described in RFC 5448 and Annex F. The ME uses the most significant 256 bits of the EMSK as the KAUSF and then calculates KSEAF in the same way as the AUSF. The UE shall derive the KAMF from the KSEAF, the ABBA parameter and the SUPI according to Annex A.7.\nNOTE 6:\tAs an implementation option, the UE creates the temporary security context as described in step 11 after receiving the EAP message that allows EMSK to be calculated. The UE turns this temporary security context into a partial security context when it receives the EAP Success. The UE removes the temporary security context if the EAP authentication fails. \n\nThe further steps taken by the AUSF upon receiving a successfully verified EAP-Response/AKA'-Challenge message are described in sub-clause 6.1.4 of the present document. \nIf the EAP-Response/AKA'-Challenge message is not successfully verified, the subsequent AUSF behaviour is determined according to the home network's policy. \nIf AUSF and SEAF determine that the authentication was successful, then the SEAF provides the ngKSI and the KAMF to the AMF.\n\n*** NEXT CHANGE ***\n6.1.3.2.0\t5G AKA\n5G AKA enhances EPS AKA [10] by providing the home network with proof of successful authentication of the UE from the visited network. The proof is sent by the visited network in an Authentication Confirmation message. \nThe selection of using 5G AKA is described in sub-clause 6.1.2 of the present document. \nNOTE 1:\t5G AKA does not support requesting multiple 5G AVs, neither the SEAF pre-fetching 5G AVs from the home network for future use.\n\nFigure 6.1.3.2-1: Authentication procedure for 5G AKA\nThe authentication procedure for 5G AKA works as follows, cf. also Figure 6.1.3.2-1:\n1.\tFor each Nudm_Authenticate_Get Request, the UDM/ARPF shall create a 5G HE AV. The UDM/ARPF does this by generating an AV with the Authentication Management Field (AMF) separation bit set to \"1\" as defined in TS 33.102 [9]. The UDM/ARPF shall then derive KAUSF (as per Annex A.2) and calculate XRES* (as per Annex A.4). Finally, the UDM/ARPF shall create a 5G HE AV from RAND, AUTN, XRES*, and KAUSF.\n2.\tThe UDM shall then return the 5G HE AV to the AUSF together with an indication that the 5G HE AV is to be used for 5G-AKA in a Nudm_UEAuthentication_Get Response. In case SUCI was included in the Nudm_UEAuthentication_Get Request, UDM will include the SUPI in the Nudm_UEAuthentication_Get Response.  \n3.\tThe AUSF shall store the XRES* temporarily together with the received SUCI or SUPI. The AUSF may store the KAUSF.\n4.\tThe AUSF shall then generate the 5G AV from the 5G HE AV received from the UDM/ARPF by computing the HXRES* from XRES* (according to Annex A.5) and KSEAF from KAUSF(according to Annex A.6), and replacing the XRES* with the HXRES* and KAUSF with KSEAF in the 5G HE AV.\n5.\tThe AUSF shall then remove the KSEAF return the 5G SE AV (RAND, AUTN, HXRES*) to the SEAF in a Nausf_UEAuthentication_Authenticate Response. \n6.\tThe SEAF shall send RAND, AUTN to the UE in a NAS message Authentication -Request. This message shall also include the ngKSI that will be used by the UE and AMF to identify the KAMF and the partial native security context that is created if the authentication is successful. This message shall also include the ABBA parameter. The SEAF shall set the ABBA paremeter as defined in Annex A.7.1. The ME shall forward the RAND and AUTN received in NAS message Authentication Request to the USIM.\nNOTE 2: The ABBA parameter is included to enable the bidding down protection of security features that may be introduced later.\n7.\tAt receipt of the RAND and AUTN, the USIM shall verify the freshness of the 5G AV by checking whether AUTN can be accepted as described in TS 33.102[4]. If so, the USIM computes a response RES. The USIM shall return RES, CK, IK to the ME. If the USIM computes a Kc (i.e. GPRS Kc) from CK and IK using conversion function c3 as described in TS 33.102 [4], and sends it to the ME, then the ME shall ignore such GPRS Kc and not store the GPRS Kc on USIM or in ME. The ME then shall compute RES* from RES according to Annex A.4. The ME shall calculate KAUSF from CK||IK according to clause A.2. The ME shall calculate KSEAF from KAUSF according to clause A.6. An ME accessing 5G shall check during authentication that the \"separation bit\" in the AMF field of AUTN is set to 1. The \"separation bit\" is bit 0 of the AMF field of AUTN.\nNOTE 3:\tThis separation bit in the AMF field of AUTN cannot be used anymore for operator specific purposes as described by TS 33.102 [9], Annex F.\n8.\tThe UE shall return RES* to the SEAF in a NAS message Authentication Response. \n9.\tThe SEAF shall then compute HRES* from RES* according to Annex A.5, and the SEAF shall compare HRES* and HXRES*. If they coincide, the SEAF shall consider the authentication successful from the serving network point of view. If not, the SEAF proceed as described in sub-clause 6.1.3.2.2. If the UE is not reached, and the RES* is never received by the SEAF, the SEAF shall consider authentication as failed, and indicate a failure to the AUSF.\n10.\tThe SEAF shall send RES*, as received from the UE, in a Nausf_UEAuthentication_Authenticate Request message to the AUSF.\n11.\tWhen the AUSF receives as authentication confirmation the Nausf_UEAuthentication_Authenticate Request message including a RES* it may verify whether the AV has expired. If the AV has expired, the AUSF may consider the authentication as unsuccessful from the home network point of view. AUSF shall compare the received RES* with the stored XRES*. If the RES* and XRES* are equal, the AUSF shall consider the authentication as successful from the home network point of view.AUSF shall inform UDM about the authentication result (see sub-clause 6.1.4 of the present document for linking with the authentication confirmation).\n12.\tThe AUSF shall indicate to the SEAF in the Nausf_UEAuthentication_Authenticate Response whether the authentication was successful or not from the home network point of view. If the authentication was successful, the KSEAF shall be sent to the SEAF in the Nausf_UEAuthentication_Authenticate Response. In case the AUSF received a SUCI from the SEAF in the authentication request (see sub-clause 6.1.2 of the present document), and if the authentication was successful, then the AUSF shall also include the SUPI in the Nausf_UEAuthentication_Authenticate Response message. \nIf the authentication was successful, the key KSEAF received in the Nausf_UEAuthentication_Authenticate Response messageshall become the anchor key in the sense of the key hierarchy as specified in sub-clause 6.2 of the present document. Then the SEAF shall derive the KAMF from the KSEAF, the ABBA parameter and the SUPI according to Annex A.7. The SEAF shall provide the ngKSI and the KAMF to the AMF.\nIf a SUCI was used for this authentication, then the SEAF shall only provide ngKSI and KAMF to the AMF after it has received the Nausf_UEAuthentication_Authenticate Response message containing SUPI; no communication services will be provided to the UE until the SUPI is known to the serving network.\nThe further steps taken by the AUSF after the authentication procedure are described in sub-clause 6.1.4 of the present document. \n\n*** NEXT OF CHANGE ***\nA.7\tKAMF derivation function\nA.7.0\tParameters for the input S to the KDF\nWhen deriving a KAMF from KSEAF the following parameters shall be used to form the input S to the KDF. \n-\tFC = 0x6D\n-\tP0 = SUPI \n-\tL0 = P0 length - number of octets in P0\n-\tP1 = ABBA parameter \n-\tL1 = P1 length - number of octets in P1 \nThe input key KEY shall be the 256-bit KSEAF.\nFor P0, when the SUPI type is IMSI, SUPI shall be set to IMSI as defined in clause 2.2 of TS 23.003 [19]. For P0, when the SUPI type is network specific identifier, the SUPI shall be set to Network Access Identifier (NAI) as defined in clause 28.7.2 of TS 23.003 [19]. \nSUPI shall be represented as a character string as specified in B.2.1.2 of TS 33.220 [28], for both IMSI based SUPI as well as in NAI based SUPI.\nFor ABBA parameter values please refer to clause A.7.1.\n*** NEXT CHANGES ***\n5.5.3\tSubscriber privacy \nThe AMF shall support to trigger primary authentication using the SUCI.\nThe AMF shall support assigning 5G-GUTI to the UE.\nThe AMF shall support reallocating 5G-GUTI to UE.\nThe AMF shall be able to confirm SUPI from UE and from home network. The AMF shall deny service to the UE if this confirmation fails.\n\n*** END OF CHANGES ***\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nDuring primary authentication, we have the so-called SUPI binding that is supposed to assure the correctness of SUPI in the serving network. See NOTE 3 in clause 6.1.3.1.Upon further analysis, we identified that the following aspect is seriously ambiguous -- whether the serving network needs to verify that the parameters received in SUCI from the UE corresponds to the ones in SUPI from the home network. The parameters being the SUPI type and the home network identifier.There could be 4 behaviours in the serving network:The SEAF does whatever its vendor decides, i.e., behaviour is left to implementation.The SEAF performs SUPI binding with the SUPI received from the home network \"as-is\", i.e. without taking into consideration the SUCI received from the UE. The SEAF verifies that the parameters received in SUPI from the home network correspond to the ones in SUCI from the UE.The SEAF performs SUPI binding with the combination of SUPI received from the home network and the SUCI received from the UETo assure predictable/consistent handling of primary authentication, we believe that the behaviour of AMF/SEAF needs to be clearly mentioned, regardless of which behaviour is chosen by SA3.We believe that either #3 or #4 would be the correct behaviour.\n\n>>> SUMMARY OF CHANGE\nBehavior #3 is proposed in clauses 6.1.3.1 and 6.1.3.2.0. Behavior #4 is shown as another altenative in Annex A.7.0. Changes should be updated to what SA3 ultimately decides.Clause 5.5.3 has been udpated to align with current state of the TS.\n\n>>> CONSEQUENCES IF NOT REVISED\nInconsitent handling of primary authentication"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n6.5.3\tCombined GPRS / IMSI Attach procedure\nThe Combined GPRS\u00a0/ IMSI Attach procedure is illustrated in Figure\u00a022.\n\nFigure\u00a022: Combined GPRS\u00a0/ IMSI Attach Procedure\nNOTE\u00a01:\tAll steps except steps\u00a06 and 7d, 7e are common for architecture variants using Gn/Gp based interaction with GGSN and using S4-based interaction with SGW and PGW. For an S4-based interaction with SGW and PGW, procedure steps\u00a0(A) are defined in clause\u00a06.5.3A and procedure steps\u00a0(B) are defined in clause\u00a06.5.3B.\nNOTE\u00a02:\tFor an Emergency Attach in which the MS was not successfully authenticated, steps\u00a06, 7, 8 and 11 are not performed.\n1)\tIn A/Gb mode, the MS initiates the attach procedure by the transmission of an Attach Request (IMSI or PTMSI and old RAI, MS Radio Access Capability, MS Network Capability, CKSN, Attach Type, DRX Parameters, old PTMSI Signature, additional P-TMSI) message to the SGSN. IMSI shall be included if the MS does not have a valid PTMSI available. If the MS has a valid PTMSI or a valid GUTI, then PTMSI and the old RAI associated with PTMSI shall be included. MS Radio Access Capability contains the MS's GPRS multislot capabilities, frequency bands, etc. as defined in TS\u00a024.008\u00a0[13]. Attach Type indicates which type of attach is to be performed, i.e. GPRS attach only, GPRS Attach while already IMSI attached, or combined GPRS\u00a0/ IMSI attach. If the MS uses PTMSI for identifying itself and if it has also stored its old PTMSI Signature, then the MS shall include the old PTMSI Signature in the Attach Request message.\n\tFor Iu mode, the MS initiates the attach procedure by the transmission of an Attach Request (IMSI or PTMSI and old RAI, Core Network Classmark, KSI, Attach Type, old PTMSI Signature, Follow On Request, DRX Parameters, additional P-TMSI) message to the SGSN. IMSI shall be included if the MS does not have a valid PTMSI available or a valid GUTI. If the MS uses PTMSI for identifying itself and if it has also stored its old PTMSI Signature, then the MS shall include the old PTMSI Signature in the Attach Request message. If the MS has a valid PTMSI, then PTMSI and the old RAI associated with PTMSI shall be included. KSI shall be included if the MS has valid security parameters. Core Network Classmark is described in clause \"MS Network Capability\". The MS shall set \"Follow On Request\" if there is pending uplink traffic (signalling or user data). The SGSN may use, as an implementation option, the follow on request indication to release or keep the Iu connection after the completion of the GPRS Attach procedure. Attach Type indicates which type of attach is to be performed, i.e. GPRS attach only, GPRS Attach while already IMSI attached, or combined GPRS\u00a0/ IMSI attach.\n\tIn both A/Gb and Iu mode, the DRX Parameters contain information about DRX cycle length for GERAN, UTRAN and possibly other RATs, e.g. E-UTRAN.\n\tIf the MS initiates the Attach procedure at a CSG cell or a hybrid cell, the RAN indicates the CSG access mode and CSG ID of the CSG cell with the Attach Request message sent to the new SGSN.\nNOTE\u00a03:\tThe RAN can indicate a CSG cell by the absence of the CSG access mode parameter.\n\tThe E-UTRAN capable MS stores the TIN in detached state. If the MS's TIN indicates \"P-TMSI\" or \"RAT related TMSI\" and the MS holds a valid P-TMSI then the \"old P-TMSI\" IE indicates this valid P-TMSI. If the MS's TIN indicates \"GUTI\" and the MS holds a valid GUTI then the \"old P-TMSI\" IE indicates a P-TMSI mapped from the GUTI. Mapping a GUTI to P TMSI/RAI is specified in TS\u00a023.003\u00a0[4]. If the MS holds a valid P-TMSI then the MS indicates the P-TMSI as additional P-TMSI, regardless whether the \"old P-TMSI\" IE also indicates this P-TMSI or a P-TMSI mapped from a GUTI.\n\tFor an Emergency Attach the MS shall indicate emergency service and the IMSI shall be included if the MS does not have a valid P-TMSI or a valid GUTI available. The IMEI shall be included when the MS has no valid IMSI, no valid P-TMSI and no valid GUTI. The UE shall set the \"Follow On Request\" to indicate that there is pending uplink traffic and the UE shall initiate the activation of an emergency PDP context after successful Emergency Attach.\n\tIf the SGSN is not configured to support Emergency Attach the SGSN shall reject any Attach Request that indicates emergency service.\n2)\tIf the MS identifies itself with PTMSI and the SGSN has changed since detach, the new SGSN sends an Identification Request (PTMSI, old RAI, old PTMSI Signature) to the old SGSN (this could be an old MME) to request the IMSI. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI and send the Identification Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI and relay the message to that actual old SGSN. The old SGSN responds with Identification Response (IMSI, Authentication Triplets or Authentication Quintets). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN also validates the old PTMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN.\n\tFor an Emergency Attach if the MS identifies itself with a temporary identity that is not known to the SGSN, the SGSN shall immediately request the IMSI from the MS. If the UE identifies itself with IMEI, the IMSI request shall be skipped.\n3)\tIf the MS is unknown in both the old and new SGSN, the SGSN sends an Identity Request (Identity Type\u00a0= IMSI) to the MS. The MS responds with Identity Response (IMSI).\n4)\tThe authentication functions are defined in the clause \"Security Function\". If no MM context for the MS exists anywhere in the network, then authentication is mandatory. Ciphering procedures are described in clause \"Security Function\". If PTMSI allocation is going to be done and the network supports ciphering, the network shall set the ciphering mode.\n\tIf the SGSN is configured to support Emergency Attach and the MS indicated emergency service, the SGSN skips the authentication and security setup or the SGSN accepts that the authentication may fail and continues the attach procedure. If the MS is emergency attached and not successfully authenticated, integrity protection and ciphering shall not be performed.\n5)\tThe equipment checking functions are defined in the clause \"Identity Check Procedures\". Equipment checking is optional.\n\tFor an Emergency Attach, the MS may have included the IMEI in the Attach Request message. If not, and the IMSI cannot be authenticated, the SGSN shall retrieve the IMEI from the MS.\n\tFor an Emergency Attach, the IMEI check to the EIR may be performed. If the IMEI is blocked, operator policies determine whether the Emergency Attach procedure continues or is stopped.\n6)\tIf there are active PDP contexts in the new SGSN for this particular MS (i.e. the MS re-attaches to the same SGSN without having properly detached before), the new SGSN deletes these PDP contexts by sending Delete PDP Context Request (TEID) messages to the GGSNs involved. The GGSNs acknowledge with Delete PDP Context Response (TEID) messages.\n7)\tIf the SGSN number has changed since the GPRS detach, or if it is the very first attach, or if the Automatic Device Detection (ADD) function is supported and the IMEISV has changed (see\u00a0[82] for ADD functional requirement), or if the MS provides an IMSI or the MS provides an old P-TMSI/RAI which doesn't point to a valid context in the SGSN, then the SGSN informs the HLR:\na)\tThe SGSN sends an Update Location (SGSN Number, SGSN Address, IMSI, IMEISV, Update Type) to the HLR. IMEISV is sent if the ADD function is supported. Update Type indicates this if Attach procedure is set to \"SGSN only registration\".\nb)\tThe HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN. If the Update Type indicates Attach and the HSS has the MME registration, then the HSS sends Cancel Location (IMSI, Cancellation Type) to the old MME. The Cancellation Type indicates the old MME\\SGSN to release the old Serving GW resource.\nc)\tThe old SGSN acknowledges with Cancel Location Ack (IMSI). If there are any ongoing procedures for that MS, the old SGSN shall wait until these procedures are finished before removing the MM and PDP contexts.\nd)\tIf there are active PDP contexts in the old SGSN for this particular MS, the old SGSN deletes these PDP contexts by sending Delete PDP Context Request (TEID) messages to the GGSNs involved.\ne)\tThe GGSNs acknowledge with Delete PDP Context Response (TEID) messages.\nf)\tThe HLR sends Insert Subscriber Data (IMSI, Subscription Data, CSG subscription data for the PLMN) to the new SGSN. If the S6d interface is used between an S4-SGSN and HSS the message \"Insert Subscriber Data\" is not used. Instead, the Subscription Data is sent by HSS in the message Update Location Ack. (Step\u00a07h).\n\tIf the MS initiates the Attach procedure at a CSG cell, the new SGSN shall check whether the CSG ID is contained in the CSG subscription and is not expired. If the CSG ID is not present or expired, the SGSN shall send an Attach Reject message to the MS with an appropriate cause value. The MS shall remove the CSG ID from its Allowed CSG list, if present.\ng)\tThe new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions or access restrictions (see TS\u00a023.221\u00a0[80] and TS\u00a023.008\u00a0[79]) e.g. CSG restrictions, the MS is not allowed to attach in the RA, the SGSN rejects the Attach Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If subscription checking fails for other reasons, the SGSN rejects the Attach Request with an appropriate cause and returns an Insert Subscriber Data Ack (IMSI, Cause) message to the HLR. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS\u00a023.251\u00a0[83] instead of rejecting the Attach Request message. If all checks are successful then the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI) message to the HLR. If the S6d interface is used between S4-SGSN and HSS the message \"Insert Subscriber Data Ack\" is not used. Instead the subscription data check performed by S4-SGSN is done when the S4-SGSN has received the message \"Update Location Ack\" from HSS (Step\u00a07h).\nh)\tThe HLR acknowledges the Update Location message by sending an Update Location Ack to the SGSN after the cancelling of old MM context and insertion of new MM context are finished. If the S6d interface is used the Update Location Ack messages includes the subscription Data. If the Update Location is rejected by the HLR, the SGSN rejects the Attach Request from the MS with an appropriate cause. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS\u00a023.251\u00a0[83] instead of rejecting the Attach Request message.\n\tFor an Emergency Attach in which the MS was not successfully authenticated, the SGSN shall not send an Update Location Request to the HLR.\n8)\tIf Attach Type in step\u00a01 indicated GPRS Attach while already IMSI attached, or combined GPRS\u00a0/ IMSI attached, then the VLR shall be updated if the Gs interface is installed. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step\u00a06d). This operation marks the MS as GPRS-attached in the VLR.\na)\tThe SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) message to the VLR. Location Update Type shall indicate IMSI attach if Attach Type indicated combined GPRS\u00a0/ IMSI attach. Otherwise, Location Update Type shall indicate normal location update. The VLR creates an association with the SGSN by storing SGSN Number. . In networks that support network sharing, the Location Update Request includes the identity of the selected core network operator if the SGSN has received this information from the RAN, as described in TS\u00a023.251\u00a0[83].\nb)\tIf the LA update is inter-MSC, the new VLR sends Update Location (IMSI, new VLR) to the HLR.\nc)\tIf the LA update is inter-MSC, the HLR sends a Cancel Location (IMSI) to the old VLR.\nd)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\ne)\tIf the LA update is inter-MSC, the HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR. The subscriber data may contain the CSG subscription data for the PLMN.\nf)\tThe VLR acknowledges with Insert Subscriber Data Ack (IMSI).\ng)\tAfter finishing the inter-MSC location update procedures, the HLR responds with Update Location Ack (IMSI) to the new VLR.\nh)\tThe VLR responds with Location Update Accept (VLR TMSI) to the SGSN.\n9)\tThe SGSN selects Radio Priority SMS, and sends an Attach Accept (PTMSI, VLR TMSI, PTMSI Signature, Radio Priority SMS, IMS voice over PS Session Supported Indication, Emergency Service Support indicator) message to the MS. PTMSI is included if the SGSN allocates a new PTMSI. The IMS voice over PS Session Supported Indication is set as described in clause\u00a05.3.8.\n\tThe Emergency Service Support indicator informs the MS that Emergency PDP contexts are supported, i.e. the MS is allowed to request activation of emergency PDP contexts when needed.\n\tWhen receiving the Attach Accept message the EUTRAN capable UE shall set its TIN to \"PTMSI\" as no ISR Activated is indicated at Attach.\n\tIf the attach is initiated by manual CSG selection via a CSG cell, the MS upon receiving the Attach Accept message at a CSG cell shall add the CSG ID of the cell where the MS has sent the Attach Request message to its Allowed CSG list if it is not already present. Manual CSG selection is not supported when an emergency service has been initiated.\n\tIf the MS initiates the Attach procedure at a hybrid mode CSG cell, the SGSN shall check whether the CSG ID is contained in the CSG subscription and is not expired. The SGSN shall send an indication whether the UE is a CSG member to the RAN along with the RANAP message. Based on this information the RAN may perform differentiated treatment for CSG and non-CSG members.\nNOTE\u00a04:\tIf the MS receives a Attach Accept message via a hybrid cell, the MS does not add the corresponding CSG ID to its Allowed CSG list. Adding a CSG ID to the MS's Allowed CSG list for a hybrid cell is performed only by OTA or OMA DM procedures.\n10)\tIf PTMSI or VLR TMSI was changed, the MS acknowledges the received TMSI(s) by returning an Attach Complete message to the SGSN.\n11)\tIf VLR TMSI was changed, the SGSN confirms the VLR TMSI re-allocation by sending a TMSI Reallocation Complete message to the VLR.\nFor an Emergency Attach the SGSN shall not check for access restrictions, regional restrictions, subscription restrictions (e.g. CSG restrictions) or perform CSG access control.\nIf the Attach Request cannot be accepted, the SGSN returns an Attach Reject (IMSI or IMEI, Cause) message to the MS. IMEI shall be sent if it is an Emergency Attach and no valid IMSI exists. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS\u00a023.251\u00a0[83] instead of returning an Attach Reject (IMSI, Cause) message to the MS.\nEditor's note:\tIt is FFS if or how emergency service is supported in a MOCN configuration.\nThe CAMEL procedure call shall be performed, see referenced procedure in TS\u00a023.078\u00a0[8b]:\nC1)\tCAMEL_GPRS_Attach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Attach is called. In Figure\u00a022, the procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn RAU from E-UTRAN procedure, old MME uses FNAS-token carried in the old P-TMSI signature to authenticate the UE. When attaching in UTRAN/GERAN using an \u201cold P-TMSI\u201d mapped from GUTI, the NAS token based authentication is not supported in current spec. This CR defines the NAS token based authentication for GPRS attach to align with SA3 S3-092187 or SP-090812.\n\n>>> SUMMARY OF CHANGE\nOld MME shall use NAS token carried in the old P-TMSI signature to authenticate the UE.\n\n>>> CONSEQUENCES IF NOT REVISED\nP-TMSI signature security not available when attaching using a GUTI as the temporary identity."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nThis CR's revision history:\n\n1st CHANGE\n4.12b\tProcedures for devices that do not support 5GC NAS over WLAN access\n4.12b.1\tGeneral\nAs specified in TS\u00a023.501\u00a0[2] clause\u00a04.2.8.5, devices that do not support 5GC NAS signalling over WLAN access (referred to as \"Non-5G-Capable over WLAN\" devices, or N5CW devices for short), may access 5GC in a PLMN via a trusted WLAN access network that supports a Trusted WLAN Interworking Function (TWIF). The following clause\u00a0specifies how a N5CW device can be registered to 5GC and how it can send data via a PDU Session.\nA N5CW device may be 5G-capable over 3GPP access, in which case it is also a 5G UE over 3GPP access.\n4.12b.2\tInitial Registration & PDU Session Establishment\nFigure 4.12b.2-1 illustrates how the N5CW device can connect to a trusted WLAN access network and simultaneously register to a 5G core network. A single EAP-based authentication procedure is executed for connecting the N5CW device to the trusted WLAN access network and for registering the N5CW device to the 5G core network.\n\n\nFigure 4.12b.2-1: Initial registration and PDU session establishment\n0.\tThe N5CW device selects a PLMN and a trusted WLAN that supports \"5G connectivity-without-NAS\" to this PLMN by using the procedure specified in TS\u00a023.501\u00a0[2] clause\u00a06.3.12a, \"Access Network selection for devices that do not support 5GC NAS over WLAN\".\nSteps 1-10:\tInitial registration to 5GC.\n1.\tThe N5CW device associates with the selected trusted WLAN and the EAP authentication procedure is initiated.\n2.\tThe N5CW device provides its Network Access Identity (NAI). The Trusted WLAN Access Point (TWAP) selects a Trusted WLAN Interworking Function (TWIF), e.g. based on the received realm, and sends an AAA request to the selected TWIF.\n\tIf the N5CW device has registered to 5GC over 3GPP access (i.e, it is also a 5G UE) when the above procedure is initiated, then the NAI includes the 5G-GUTI assigned to N5CW device over 3GPP access. This enables the TWIF in step\u00a04a below to select the same AMF as the one serving the N5CW device over 3GPP access.\n\tThe NAI provided by the N5CW device in step\u00a02b indicates that the N5CW device wants \"5G connectivity-without-NAS\" towards a specific PLMN (i.e. the PLMN selected in step\u00a00). For example, with NAI=<5G-GUTI>@nai.5gc-nn.mnc123.mcc45.3gppnetwork.org, the N5CW device indicates that it wants \"5G connectivity-without-NAS\" (5gc-nn) to the PLMN with MCC=45 and MNC=123.\n3.\tThe TWIF creates a 5GC Registration Request message on behalf of the N5CW device. The TWIF uses default values to populate the parameters in the Registration Request message, which are the same for all N5CW devices. The Registration type indicates \"Initial Registration\".\n4.\tThe TWIF selects an AMF (e.g. by using the 5G-GUTI in the NAI, if provided by the N5CW device) and sends an N2 message to the AMF including the Registration Request, the User Location and an AN Type.\n5.\tThe AMF triggers an authentication procedure by sending a request to AUSF indicating the AN type.\n6.\tAn EAP authentication procedure takes place between the N5CW device and AUSF. Over the N2 interface, the EAP messages are encapsulated within NAS Authentication messages. The type of EAP authentication procedure is specified in TS\u00a033.501\u00a0[15].\n7.\tAfter a successful authentication, the AUSF sends to AMF the EAP-Success message and the created SEAF key. The AMF derives an AN key from the received SEAF key.\n8.\tThe NAS Security Mode Command (SMC) is sent from the AMF to the TWIF. The selected NAS security algorithms of integrity protection and ciphering are set to NULL.\n9.\tThe AMF sends an N2 Initial Context Setup Request and provides the AN key to TWIF. In turn, the TWIF derives a Pairwise Master Key (PMK) from the AN key and sends the PMK key and the EAP-Success message to the Trusted WLAN Access Point, which forwards the EAP-Success to the N5CW device. The PMK is the key used to secure the WLAN air-interface communication according to IEEE 802.11 specification [48]. A layer-2 or layer-3 connection is established between the Trusted WLAN Access Point and the TWIF for transporting all user-plane traffic of the N5CW device to TWIF. This connection is later bound to an N3 connection that is created for this N5CW device.\n10.\tFinally, the AMF sends a Registration Accept message to TWIF. At this point, the N5CW device is connected to the WLAN access network and is registered to 5GC.\nSteps 20-21:\tPDU Session Establishment.\n20.\tThe TWIF creates a PDU Session Establishment Request message on behalf of the N5CW device and sends this message to AMF. This may be triggered by receiving an IP configuration request (e.g. DHCP Offer/Request) from the N5CW device. The TWIF may use default values to populate the parameters in the PDU Session Establishment Request message, but may also skip some PDU session parameters and let the AMF or the SMF determine these parameters based on the N5CW device subscription information received during the registration procedure. This way, default PDU session parameters can be used per N5CW device.\n\tThe value of the PDU Session id provided by TWIF in step\u00a020c shall always be the same. It will be a value reserved for the PDU sessions requested by the TWIF and it will be different from the values that can be used by the N5CW device when requesting a PDU session over 3GPP access. This way, the PDU session id provided by the TWIF cannot be the same with the PDU Session Id of any PDU session established by the N5CW device over 3GPP access.\n21.\tThe AMF sends upon request of the SMF an N2 PDU Session Request message to TWIF in order to reserve the appropriate access network resources. This N2 message includes the PDU Session Establishment Accept message. In step\u00a021b, the TWIF may reserve WLAN access resources for the user-plane communication between the N5CW device and TWIF. If and how this resource reservation is performed is outside the scope of 3GPP.\n\tAfter the establishment of the PDU session, the TWIF assigns IP configuration data to N5CW device (e.g. with DHCP). The IP address assigned to N5CW device is the IP address allocated to the PDU session.\nStep 25:\tUser plane communication.\n\tThe TWIF binds the N5CW device-specific L2/L3 connection created in step\u00a09g with the N3 connection created in step\u00a021. All user-plane traffic sent by the N5CW device is forwarded to TWIF via the L2/L3 connection and then to UPF via the N3 connection. The TWIF operates as a Layer-2 relay.\n\tThe TWIF may receive URSP rules (see TS\u00a023.503\u00a0[20]), which indicate the traffic that should be offloaded locally by TWIF (sent outside the PDU session) and the traffic that should be sent inside the PDU session.\nThe above procedure supports only one PDU session per N5CW device whose parameters are either configured for all N5CW devices in the TWIF or are derived from default values in the N5CW device susbscription.\nIf the TWIF is co-located with one or more local UPFs then:\n-\tIn step\u00a020c (N2 Uplink NAS Transport), the TWIF may send a TWIF Identities parameter to AMF. The TWIF Identities parameter contains a list of identifiers (i.e. FQDNs or IP addresses) of N3 terminations supported by the TWIF.\n-\tIf received by the AMF, it shall forward it to the SMF when invoking Nsmf_PDUSessionCreateSMContext i.e. at the establishment of the PDU Session. The SMF may use this information to select a local UPF for the PDU Session.\n\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen a UE attempts to access 5GC, during the primary authentication procedure, the UDM selects an authentication method (e.g. 5G-AKA, EAP-AKA\u2019, EAP-TLS in private networks, etc.) based on the subscriber permanent identity (SUPI). TS 33.501 clearly specifies in clause 6.1.2 that \u201cbased on SUPI, the UDM/ARPF shall choose the authentication method.\u201dHowever, in the special case when a N5CW device attempts to access 5GC, the UDM shall not select 5G-AKA because the N5CW device does not support NAS and, therefore, does not support 5G-AKA. In this case, the UDM shall only select an EAP-based authentication method, e.g. EAP-AKA', EAP-TLS (in private networks), etc.\n\n>>> SUMMARY OF CHANGE\nDuring the initial registration for a N5CW device, the UDM receives an Authentication Method element, which indicates a preferred EAP authentication method. This Authentication Method element is provided from TWIF to AMF, then from AMF to AUSF and finally from AUSF to UDM.NOTE: An Authentication Method element is also sent from a AAA Server to HSS (as specified in TS 29.273) that contains a preferred EAP-based authentication method.\n\n>>> CONSEQUENCES IF NOT REVISED\nA N5CW device shall not be able to register to 5GC if the UDM selects 5G-AKA authentication."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * 1st change * * * *\n5.4.2.5\tAuthentication not accepted by the network\nIf the authentication response returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the GUTI was used; or\n-\tif the IMSI was used.\nIf the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should proceed as described below.\nIf the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE.\nUpon receipt of an AUTHENTICATION REJECT message, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed.\nIf A/Gb or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the authentication and ciphering procedure is not accepted by the network.\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the timers T3410, T3417 or T3430 (if running) and enter state EMM-DEREGISTERED.\nDepending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is attaching to the network for emergency bearer services, the MME need not follow the procedures specified for the authentication failure in the present subclause. The MME may continue a current EMM specific procedure as if the authentication was successful and shall deactivate all non-emergency EPS bearers, if any.\n\n* * * 2nd change * * * *\n5.4.3.3\tNAS security mode command accepted by the UE\nUpon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities and the received nonceUE have not been altered compared to what the UE provided in the initial layer\u00a03 message that triggered this procedure. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context).\nThe UE shall accept a SECURITY MODE COMMAND message indicating the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm only if the message is received during an attach procedure for emergency bearer services or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services.\nIf the type of security context flag included in the SECURITY MODE COMMAND message is set to \"native security context\" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:\n-\tthe SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;\n-\tthe SECURITY MODE COMMAND message received includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm, the UE shall:\n-\tif the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;\n-\totherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K'ASME if the type of security context flag is set to \"mapped security context\" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:\n-\tgenerate K'ASME from both the nonceMME and the nonceUE as indicated in 3GPP\u00a0TS\u00a033.401\u00a0[19];or\n-\tcheck whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K'ASME.\nFurthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K'ASME indicated by the eKSI. The UE shall set the security header type of the message to \"integrity protected and ciphered with new EPS security context\".\nFrom this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.\nIf the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.\n\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAssuming we have the following scenario:1* the UE is attached for emergency bearer services and has NULL emergency security context, 2* the Authentication procedure is performed as a standalone procedure (i.e. not invoked within an Attach/TAU procedure), e.g. the authentication procedure is delayed after the TAU Accept/Complete in case of inter PLMN handover,3* the UE rejects the Authentication Request by sending an Authentication Failure and sets T3418/3420 (the UE does not know whether the network would reattempt an authentication procedure or not depending on the error cause),Then, what should be the behaviour of a network that allows unauthenticated emergency calls ?If the network considers the authentication as being successful and sends no messages to the UE, then upon T3418/3420 expiry, the UE would locally detach while it would have been possible for the UE to perform emergency calls with this network !Hence it is proposed that the MME sends a Security Mode Command including NULL algos as per supporting unauthenticated emergency calls. So, the UE would stop T3418/3420 (the UE already does so as per current specification). The UE would regenerate a local Kasme similarly to the case of retransmission of the Security Mode Command including NULL algos.It is not much added complexity in the network since a network that supports unauthenticated emergency calls while the UE has a non NULL emergency security context, would already do as described earlier i.e. Security Mode Command including NULL algos.Backward compatibility issues: none, the problem as depicted still occurs if either the UE or the network does not implement the change.\n\n>>> SUMMARY OF CHANGE\nIt is proposed to add the following text:(1st change, authentication not accepted by the network): If the network received an Authentication Failure and there is no current EMM specific procedure, the MME shall initiate a security mode command procedure including NULL NAS algorithms.(2nd change, security mode command accepted by UE):  *The UE shall accept a SECURITY MODE COMMAND message if it has a PDN connection for emergency bearer services ongoing*When the UE has a PDN connection for emergency bearer services, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a native EPS security context where the KSI value \"000\" is included in the NAS key set identifier IE and the NULL NAS security algorithms were included).\n\n>>> CONSEQUENCES IF NOT REVISED\nA UE that has failed an authentication procedure (by sending Authentication Failure) initiated by a network supporting unauthenticated emergency calls as a standalone procedure would locally detach if this network does not send any security related message to the UE."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n3.1\tDefinitions\nFor the purposes of the present document, the terms and definitions given in 3GPP\u00a0TR\u00a021.905\u00a0[1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP\u00a0TR\u00a021.905\u00a0[1].\n\n\n\n\n\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.402\u00a0[6] apply:\nS2a\nS2b\nS2c\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.301\u00a0[10] apply:\nEvolved packet core network\nEvolved packet system\nFor the purposes of the present document, the following terms and definitions given in WiMAX\u00a0Forum\u00a0Network\u00a0Architecture Release\u00a01.0 version 1.2 \u2013 Stage\u00a03\u00a0[25] apply:\nNetwork Access Provider\nNetwork Service Provider\n* * * End First Change * * * *\n7.2.1\tSelection of the ePDG\nFor dynamic selection of the ePDG the UE shall support the implementation of standard DNS mechanisms in order to retrieve the IP address(es) of the ePDG. The input to the DNS query is an ePDG FQDN as specified in subclause\u00a04.4.3 and in 3GPP\u00a0TS\u00a023.003\u00a0[3]. The ePDG FQDN contains a PLMN ID as Operator Identifier. The UE selects the PLMN ID used in the ePDG FQDN based on the conditions described below.\nIf the UE performs an initial attach to the untrusted non-3GPP access network and:\n\n\n-\tthe access specific signalling provides to the UE a list of available PLMN ID(s) served by the access network, the UE shall include in the ePDG FQDN a PLMN ID as described in 3GPP\u00a0TS\u00a024.234\u00a0[9].\n-\tthe access specific signalling does not provide to the UE a list of available PLMN ID(s) served by the access network, the UE shall include the HPLMN ID in the ePDG FQDN.\n\n\n\n\n\n\n\nIf the UE performs a handover attach without having been connected to an ePDG before the handover, the UE shall include in the ePDG FQDN the PLMN ID, which identifies the PLMN used before the handover.\nUpon reception of a DNS response containing one or more IP addresses of ePDGs, the UE shall select an IP address of ePDG with the same IP version as its local IP address.\nThe UE shall select only one ePDG also in case of multiple PDN connections.\nNOTE:\tDuring handover between two untrusted non-3GPP access networks, the UE can initiate tunnel establishment to another ePDG while still being attached to the current ePDG.\n \n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nStage 2 specification TS 23.402 describes ePDG selection for the case when the VPLMN Id is known by the UE. It needs to be clarified in stage 3 how the UE selects ePDG when the UE is attached to a VPLMN, HPLMN or EHPLMN respecitively and when the UE is not attached to any PLMN. It should also be clarified how ePDG selection in UE depends on whether the access network provided the UE with a list of PLMN identities or not.\n\n>>> SUMMARY OF CHANGE\nThe UE's ePDG selection procedure is clarified for the cases when the UE is attached to a VPLMN, HPLMN or EHPLMN and when the UE is not attached to any PLMN.\n\n>>> CONSEQUENCES IF NOT REVISED\nCurrent text identifies that FQDN for ePDG is based on TS\u00a024.234.  However TS\u00a024.234 identifies how to build a FQDN to select a PDG.  The UE would build a FQDN according to this specification for reaching wrong functional element. Implementor may also implement tunnel set-up procedures using TS\u00a024.234 procedure which would fail.  No service would be obtained."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n6.3.3\tTMSI reallocation procedure\nIf the VLR decides to reallocate the TMSI to the MS it shall include the new TMSI in the BSSAP+-LOCATION-UPDATE-ACCEPT message. If the VLR decides to deallocate the TMSI of the MS it shall include the IMSI of the MS in the BSSAP+-LOCATION-UPDATE-ACCEPT message. After sending the BSSAP+-LOCATION-UPDATE-ACCEPT message with a new TMSI the VLR starts timer T6-2.\nNOTE:\tIn the BSSAP+-LOCATION-UPDATE-REQUEST the SGSN may indicate, that there is no valid TMSI available in the MS. This information may be used by the VLR to decide whether to reallocate a new TMSI to the MS.\nUpon receipt of the BSSAP+-TMSI-REALLOCATION-COMPLETE message, the VLR stops the timer T6-2 and considers the new TMSI as valid.\nIf an IMSI was sent to the MS, the VLR considers the old TMSI as deleted.\nIf no BSSAP+-TMSI-REALLOCATION-COMPLETE message is received by the VLR before the timer T6-2 expires, the VLR aborts the TMSI reallocation procedure. The VLR may still perform the TMSI reallocation procedure via the A or Iu-CS interface. The outcome of the TMSI reallocation procedure does not change the state of the association. The VLR uses the IMSI or the new TMSI for paging.\n6.3.4\tAbnormal cases\nThe following abnormal cases can be identified:\ni)\tMM signalling via the A or Iu-CS interface\n\tIf the VLR receives a Location Update request or an IMSI detach indication from the MS by the A or Iu-CS interface when the state of the association in the VLR is not Gs-NULL, the VLR shall move the state of the association to Gs-NULL.\nii)\tAdditional Location Update Request\n\tIf the state of the association in the VLR is in the LA-UPDATE PRESENT state and a BSSAP+-LOCATION-UPDATE-REQUEST message is received, then:\n-\tIf the message is from the same SGSN and indicates the same New Location Area as the outstanding location update request, then this additional BSSAP+-LOCATION-UPDATE-REQUEST message shall be ignored;\n-\tIf the message is from the same SGSN but indicates a different New Location Area to the outstanding location update request, then this additional BSSAP+-LOCATION-UPDATE-REQUEST message shall be treated and the VLR shall not send any response to the previous BSSAP+-LOCATION-UPDATE-REQUEST message; or\n-\tIf the message is from a different SGSN (indicating either the same or different New Location Area) to the outstanding location update request, then this additional BSSAP+-LOCATION-UPDATE-REQUEST message shall be treated and the VLR shall not send any response to the previous BSSAP+-LOCATION-UPDATE-REQUEST message.\niii)\tDetach signalling from SGSN\n\tIf the state of the association in the VLR is in the LA-UPDATE PRESENT state and either a BSSAP+-GPRS-DETACH-INDICATION or a BSSAP+-IMSI-DETACH-INDICATION message is received, then, the Location Update for non-GPRS services procedure shall be abandoned in the VLR (neither a BSSAP+LOCATION-UPDATE-ACCEPT nor a BSSAP+LOCATION-UPDATE-REJECT messages is sent) and the further actions described in clauses 8 or 9 or 10 are followed.\niv)\tSignalling via SGs interface\n\tIf the VLR receives for a UE a SGsAP-LOCATION-UPDATE-REQUEST message (as defined in 3GPP\u00a0TS\u00a029.118 [27]) from an MME when the state of the association for this UE in the VLR is not Gs-NULL, the VLR shall move the state of the association to Gs-NULL.\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) Currently TS 29.018 does not specify how the VLR should behave if it receives a new BSSAP+-LOCATION-UPDATE-REQUEST while it is still waiting for the BSSAP+-TMSI-REALLOCATION-COMPLETE message from the previous location updating procedure. Subclause 6.3.4, item ii), Additional Location Update Request, is not applicable, since the VLR has moved the state of the Gs association to Gs-ASSOCIATED when sending the BSSAP+-LOCATION-UPDATE-ACCEPT message. Subclause 6.3.3, TMSI reallocation procedure, describes the behaviour when the supervision timer T6-2 for the TMSI reallocation expires:\"If no BSSAP+-TMSI-REALLOCATION-COMPLETE message is received by the VLR before the timer T6-2 expires, the VLR aborts the TMSI reallocation procedure. The VLR may still perform the TMSI reallocation procedure via the A or Iu-CS interface. The outcome of the TMSI reallocation procedure does not change the state of the association. The VLR uses the IMSI or the new TMSI for paging.\"It is proposed to specify the same handling also for the collision case when the VLR receives a new BSSAP+-LOCATION-UPDATE-REQUEST message instead of a BSSAP+-TMSI-REALLOCATION-COMPLETE message. 2) As shown above, TS 29.018 specifies that \"the VLR uses the IMSI or the new TMSI for paging\", if the TMSI reallocation could not be completed successfully. In R98, when this requirement was added to TS 09.18 (CR 09.18-A013r1), MSC pooling was not yet standardized, so paging with IMSI was an acceptable alternative, if paging with the new TMSI failed. With the introduction of MSC pools, however, there is a risk that when the MS responds with a Paging Response message including an IMSI as mobile identity, the BSC will route the message to a different MSC/VLR than the one that initiated the paging. Therefore, if the old TMSI is available in the VLR (i.e. if the VLR allocated also the old TMSI), the VLR should be allowed to use also the old TMSI as paging identity. (Note that for TS 29.118, which contains a similar requirement to use \"IMSI or the new TMSI for paging\" via the SGs interface, this change is not needed, because for paging for CSFB the actual TMSI value is not sent via the radio interface. Instead the MME performs paging with S-TMSI and CN domain indicator = \"CS\", or it sends a NAS message CS Service Notification with the paging identity value set to \"TMSI\". I.e. regardless whether the VLR requests paging with old TMSI or new TMSI, the message sent via the radio interface will be the same.)\n\n>>> SUMMARY OF CHANGE\n1) If the VLR receives a new BSSAP+-LOCATION-UPDATE-REQUEST message instead of a BSSAP+-TMSI-REALLOCATION-COMPLETE message, the VLR aborts the TMSI reallocation procedure and proceeds with the new location updating procedure. The VLR uses the IMSI or the new TMSI from the aborted TMSI reallocation procedure or the old TMSI, if available, for paging.2) In subclause 6.3.3, the old TMSI is added as a possible paging identity for the case when a previous TMSI reallocation could not be completed successfully.\n\n>>> CONSEQUENCES IF NOT REVISED\n1) If the VLR behaviour is not specified, a VLR implementation could e.g. ignore or reject new BSSAP+-LOCATION-UPDATE-REQUEST messages until T6-2 expires. The UE would then need to re-initiate the combined routing area updating procedure which would finally re-establish the Gs association. I.e. the VLR behaviour would result in unnecessary additional signalling, and the UE could be unreachable for mobile terminating CS calls until the new Gs association has been re-established.2) In a network using MSC pools and supporting GERAN, paging with IMSI can result in a wrong routing of the Paging Response message by the BSC and consequently in a failure to setup a mobile terminating call. If the MS can also be paged using the old TMSI, this enables the VLR to avoid paging with IMSI in some cases."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** Next change *****\n4.5.3\tOperator-defined access categories\nOperator-defined access category definitions can be signalled to the UE using NAS signalling. Each operator-defined access category definition consists of the following parameters:\na)\ta precedence value which indicates in which order the UE shall evaluate the operator-defined category definition for a match;\nb)\tan operator-defined access category number, i.e. access category number in the 32-63 range that uniquely identifies the access category in the PLMN or SNPN in which the access categories are being sent to the UE;\nc)\tcriteria consisting of one or more access category criteria type and associated access category criteria type values. The access category criteria type can be set to one of the following:\n1)\tDNN;\n2)\t5QI\nEditor's note:\tWhether the 5QI is a suitable access category criteria type is FFS.\n3)\tOS Id + OS App Id of application triggering the access attempt; \n or\n4)\tS-NSSAI; and\nNOTE\u00a01:\tAn access category criteria type can be associated with more than one access category criteria values.\nd)\toptionally, a standardized access category. This standardized access category is used in combination with the access identities of the UE to determine the RRC establishment cause as specified in subclause\u00a04.5.6.\nAn access attempt matches the criteria of an operator-defined access category definition, if the access attempt matches all access category criteria types included in the criteria with any of the associated access criteria type values.\nEach operator-defined access category definition has a different precedence value.\nSeveral operator-defined access category definitions can have the same operator-defined access category number.\nIf:\n-\tan access category in bullet d) is not provided;\n-\tan access category in bullet d) is provided and is not a standardized access category; or\n-\tan access category in bullet d) is provided, is a standardized access category and is not recognized by the UE;\nthe UE shall use instead access category 7 (MO_data) in combination with the access identities of the UE to determine the RRC establishment cause as specified in subclause\u00a04.5.6.\nThe operator-defined access category definitions are valid in the PLMN which provided them and in a PLMN equivalent to the PLMN which provided them, or in the SNPN which provided them, as specified in annex\u00a0C.\nIf the UE stores operator-defined access category definitions valid in the selected PLMN or the RPLMN, or valid in the selected SNPN or RSNPN, then access control in 5GMM-IDLE mode will only be performed for the event a) defined in subclause\u00a04.5.1. If the transition from 5GMM-IDLE mode over 3GPP access to 5GMM-CONNECTED mode is due to a UE NAS initiated 5GMM specific procedure, then this access attempt shall be mapped to one of the standardized access categories in the range < 32, see subclause\u00a04.5.2. I.e. for this case the UE shall skip the checking of operator-defined access category definitions.\nIf the UE is stores operator-defined access category definitions valid in the selected PLMN or the RPLMN, or valid in the selected SNPN or RSNPN, then access control in 5GMM-CONNECTED mode and in 5GMM-CONNECTED mode with RRC inactive indication will only be performed for the events 1) to 6) defined in subclause\u00a04.5.1.\nThe UE shall handle the operator-defined access category definitions stored for the RPLMN or RSNPN as specified in subclause\u00a05.4.4.3, subclause\u00a05.5.1.2.4, and subclause\u00a05.5.1.3.4.\nWhen the UE is switched off, the UE shall keep the operator-defined access category definitions so that the operator-defined access category definitions can be used after switch on.\nWhen the UE selects a new PLMN which is not equivalent to the previously selected PLMN, or selects a new SNPN, the UE shall stop using the operator-defined access category definitions stored for the previously selected PLMN or SNPN and should keep the operator-defined access category definitions stored for the previously selected PLMN or SNPN.\nNOTE\u00a02:\tWhen the UE selects a new PLMN which is not equivalent to the previously selected PLMN, or selects a new SNPN, the UE can delete the operator-defined access category definitions stored for the previously selected PLMN or SNPN e.g. if there is no storage space in the UE.\n***** Next change *****\n9.11.3.1\t5GMM capability\nThe purpose of the 5GMM capability information element is to provide the network with information concerning aspects of the UE related to the 5GCN or interworking with the EPS. The contents might affect the manner in which the network handles the operation of the UE. \nThe 5GMM capability information element is coded as shown in figure\u00a09.11.3.1.1 and table\u00a09.11.3.1.1.\nThe 5GMM capability is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets.\n8\t7\t6\t5\t4\t3\t2\t1\n5GMM capability IEI\toctet 1\nLength of 5GMM capability contents\toctet 2\nSGC\t\t5G-HC-CP CIoT\tN3 data\t5G-CP CIoT\tRestrictEC\tLPP\t\tHO attach\tS1 mode\t\toctet 3\nRACS\tNSSAA\t5G-LCS\tV2XCNPC5\tV2XCEPC5\tV2X\t5G-UP CIoT\t5GSRVCC\t\toctet 4*\n\n0\t0\t0\t0\t0\t0\t0\t0\nSpare\nFigure\u00a09.11.3.1.1: 5GMM capability information element\nTable\u00a09.11.3.1.1: 5GMM capability information element\nEPC NAS supported (S1 mode) (octet 3, bit 1)\n0\t\t\t\tS1 mode not supported\n1\t\t\t\tS1 mode supported\n\nATTACH REQUEST message containing PDN CONNECTIVITY REQUEST message for handover support (HO attach) (octet 3, bit 2)\n0\t\t\t\tATTACH REQUEST message containing PDN CONNECTIVITY REQUEST message with request type set to \"handover\" or \"handover of emergency bearer services\" to transfer PDU session from N1 mode to S1 mode not supported\n1\t\t\t\tATTACH REQUEST message containing PDN CONNECTIVITY REQUEST message with request type set to \"handover\" or \"handover of emergency bearer services\" to transfer PDU session from N1 mode to S1 mode supported\n\nLTE Positioning Protocol (LPP) capability (octet 3, bit 3)\n0\t\t\t\tLPP in N1 mode not supported\n1\t\t\t\tLPP in N1 mode supported (see 3GPP\u00a0TS\u00a036.355\u00a0[26])\n\nRestriction on use of enhanced coverage support (RestrictEC) (octet 3, bit 4)\tThis bit indicates the capability to support restriction on use of enhanced coverage.\n0\t\t\t\tRestriction on use of enhanced coverage not supported\n1\t\t\t\tRestriction on use of enhanced coverage supported\n\tControl plane CIoT 5GS optimization (5G-CP CIoT) (octet 3, bit 5)\tThis bit indicates the capability for control plane CIoT 5GS optimization.\n0\t\t\t\tControl plane CIoT 5GS optimization not supported\n1\t\t\t\tControl plane CIoT 5GS optimization supported\n\tN3 data transfer (N3 data) (octet 3, bit 6)\tThis bit indicates the capability for N3 data transfer.\n0\t\t\t\tN3 data transfer supported\n1\t\t\t\tN3 data transfer not supported\n\tHeader compression for control plane CIoT 5GS optimization (5G-HC-CP CIoT) (octet 3, bit 7)\tThis bit indicates the capability for header compression for control plane CIoT 5GS optimization.\n0\t\t\t\tHeader compression for control plane CIoT 5GS optimization not supported\n1\t\t\t\tHeader compression for control plane CIoT 5GS optimization supported\n\nService gap control (SGC) (octet 3, bit 8)\n0\t\t\t\tservice gap control not supported\n1\t\t\t\tservice gap control supported\n\n5G-SRVCC from NG-RAN to UTRAN (5GSRVCC) capability (octet 4, bit 1)\n0\t\t\t\t5G-SRVCC from NG-RAN to UTRAN not supported\n1\t\t\t\t5G-SRVCC from NG-RAN to UTRAN supported (see 3GPP\u00a0TS\u00a023.216\u00a0[6A])\n\tUser plane CIoT 5GS optimization (5G-UP CIoT) (octet 4, bit 2)\tThis bit indicates the capability for user plane CIoT 5GS optimization.\n0\t\t\t\tUser plane CIoT 5GS optimization not supported\n1\t\t\t\tUser plane CIoT 5GS optimization supported\n\nV2X capability (V2X) (octet 4, bit 3)\nThis bit indicates the capability for V2X, as specified in 3GPP\u00a0TS\u00a024.587\u00a0[52].\tBit\n3\n0\t\t\t\tV2X not supported\n1\t\t\t\tV2X supported\n\nV2X communication over E-UTRA-PC5 capability (V2XCEPC5) (octet 4, bit 4)\nThis bit indicates the capability for V2X communication over E-UTRA-PC5, as specified in 3GPP\u00a0TS\u00a024.587\u00a0[52].\nBit\n4\n0\t\t\t\tV2X communication over E-UTRA-PC5 not supported\n1\t\t\t\tV2X communication over E-UTRA-PC5 supported\n\nV2X communication over NR-PC5 capability (V2XCNPC5) (octet 4, bit 5)\tThis bit indicates the capability for V2X communication over NR-PC5, as specified in 3GPP\u00a0TS\u00a024.587\u00a0[r24587].\tBit\t5\t\t\t\t\t0\t\t\t\tV2X communication over NR-PC5 not supported\t1\t\t\t\tV2X communication over NR-PC5 supported\t\t\tV2X communication over NR-PC5 capability (V2XCNPC5) (octet 4, bit 5)\tThis bit indicates the capability for V2X communication over NR-PC5, as specified in 3GPP\u00a0TS\u00a024.587\u00a0[r24587].\tBit\t5\t\t\t\t\t0\t\t\t\tV2X communication over NR-PC5 not supported\t1\t\t\t\tV2X communication over NR-PC5 supported\nV2X communication over NR-PC5 capability (V2XCNPC5) (octet 4, bit 5)\nThis bit indicates the capability for V2X communication over NR-PC5, as specified in 3GPP\u00a0TS\u00a024.587\u00a0[r24587].\nBit\n5\n0\t\t\t\tV2X communication over NR-PC5 not supported\n1\t\t\t\tV2X communication over NR-PC5 supported\n\nLocation Services (5G-LCS) notification mechanisms capability (octet 4, bit 6)\n0\t\t\t\tLCS notification mechanisms not supported\n1\t\t\t\tLCS notification mechanisms supported (see 3GPP\u00a0TS\u00a023.273\u00a0[60])\n\tNetwork slice-specific authentication and authorization (NSSAA) (octet 4, bit 7)\tThis bit indicates the capability to support network slice-specific authentication and authorization.\n0\t\t\t\tNetwork slice-specific authentication and authorization not supported\n1\t\t\t\tNetwork slice-specific authentication and authorization supported\n\n\tRadio capability signalling optimisation (RACS) capability (octet 4, bit 8)\n0\t\t\t\tRACS not supported\n1\t\t\t\tRACS supported\n\n\n\n\n\tAll other bits in octet 4 and bits in octets 5 to 15 are spare and shall be coded as zero, if the respective octet is included in the information element.\n\n***** Next change *****\n9.11.3.38\tOperator-defined access category definitions\nThe purpose of the Operator-defined access category definitions information element is to provide the UE with the operator-defined access category definitions or to delete the operator-defined access category definitions at the UE.\nThe Operator-defined access category definitions information element is coded as shown in figure\u00a09.11.3.38.1, figure\u00a09.11.3.38.2 and table\u00a09.11.3.38.1.\nThe Operator-defined access category definitions is a type 6 information element with a minimum length of 3 octets.\n8\t7\t6\t5\t4\t3\t2\t1\nOperator-defined access category definitions IEI\toctet 1\n\tLength of operator-defined access category definitions contents\toctet 2\toctet 3\n\tOperator-defined access category definition 1\toctet 4*\t\toctet a*\n\tOperator-defined access category definition 2\toctet a+1*\t\toctet b*\n\t\u2026\t\toctet b+1*\t\toctet g*\n\tOperator-defined access category definition n\toctet g+1*\t\toctet h*\nFigure\u00a09.11.3.38.1: Operator-defined access category definitions information element\n8\t7\t6\t5\t4\t3\t2\t1\nLength of operator-defined access category definition contents\toctet 4\nPrecedence value\toctet 5\nPSAC\t0\tSpare\t0\tSpare\tOperator-defined access category number\toctet 6\nLength of criteria\toctet 7\n\tCriteria\toctet 8\t\toctet a-1\n0\tSpare\t0\tSpare\t0\tSpare\tStandardized access category\toctet a*\nFigure\u00a09.11.3.38.2: Operator-defined access category definition\nTable\u00a09.11.3.38.1: Operator-defined access category definitions information element\nValue part of the Operator-defined access category definitions information element (octet 4 to h)\tThe value part of the Operator-defined access category definitions information element consists of zero or several operator-defined access category definition fields. Each operator-defined access category definition field is coded as described in figure\u00a09.11.3.38.2. The length of each operator-defined access category definition field is determined by the length of operator-defined access category definition contents field.\nOperator-defined access category definition (octet 4 to octet a):\n\tLength of operator-defined access category definition contents (octet 4)\tLength of operator-defined access category definition contents indicates binary coded length of the operator-defined access category definition value field (octet 5 to octet a).\t\tPrecedence value (octet 5)\nBits\n8\t7\t6\t5\t4\t3\t2\t1\n0\t0\t0\t0\t0\t0\t0\t0\t\tPrecedence value 0\nto\n1\t1\t1\t1\t1\t1\t1\t1\t\tPrecedence value 255\n\nOperator-defined access category number (bits 5 to 1 of octet 6)\nBits\n5\t4\t3\t2\t1\n0\t0\t0\t0\t0\t\tAccess category number 32\nto\n1\t1\t1\t1\t1\t\tAccess category number 63\n\nPresence of standardized access category (PSAC) (bit 8 of octet 6)\nPSAC field indicates whether the standardized access category field is present or absent.\nBit\n8\n0\tStandardized access category field is not included\n1\tStandardized access category field is included\n\nLength of criteria (octet 7)\nLength of criteria field indicates binary coded length of the criteria field.\n\nCriteria (octets 8 to octet a-1)\nThe criteria field contains one or more criteria components fields. Each criteria component field shall be encoded as a sequence of a one octet criteria type field and zero or more octets criteria value field. The criteria type field shall be transmitted first.\n\nCriteria type\nBits\n8\t7\t6\t5\t4\t3\t2\t1\n0\t0\t0\t0\t0\t0\t0\t0\t\tDNN type\n0\t0\t0\t0\t0\t0\t0\t1\n0\t0\t0\t0\t0\t0\t1\t0\t\tS-NSSAI type\n\nAll other values are reserved.\n\nFor \"DNN type\", the criteria value field shall be encoded as a sequence of one octet DNN length-value pair count field and one or more DNN length-value pair fields. The DNN length-value pair count field indicates the number of included DNN length-value pair fields. Each DNN length-value pair field is coded as a sequence of one octet DNN value length field and a DNN value field. The DNN value length field indicates the length in octets of the DNN value field. The DNN value field contains an APN as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\n\nFor \"OS Id + OS App Id type\", the criteria value field shall be encoded as a sequence of one octet app id value count field and one or more app id value fields. The app id value count field indicates the number of included app id value fields. Each app id value field is coded as a sequence of a sixteen octet OS id value field, one octet OS app id value length field and an OS app id value field. The OS app id value length field indicates the length in octets of the OS app id value field. The OS id value field contains a Universally Unique IDentifier (UUID) as specified in IETF\u00a0RFC\u00a04122\u00a0[35A]. The OS app id value field contains an OS specific application identifier. Coding of the OS app id value field is outside the scope of the present document.\n\n\n\nFor \"S-NSSAI type\", the criteria value field shall be encoded as a sequence of one octet S-NSSAI length-value pair count field and one or more S-NSSAI length-value value fields. The S-NSSAI length-value pair count field indicates the number of included S-NSSAI length-value pair fields. Each S-NSSAI length-value pair field is coded as a sequence of one octet S-NSSAI value length field and an S-NSSAI value field. The S-NSSAI value length field indicates the length in octets of the S-NSSAI value field. The S-NSSAI value field contains one octet SST field optionally followed by three octets SD field. The SST field contains a SST. The SD field contains an SD. SST and SD are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\n\nStandardized access category (bits 5 to 1 of octet a)\nStandardized access category field indicates the access category number of the standardized access category that is used in combination with the access identities to determine the establishment cause.\nBits\n5\t4\t3\t2\t1\n0\t0\t0\t0\t0\t\tAccess category number 0\nto\n0\t0\t1\t1\t1\t\tAccess category number 7\nAll other values are reserved.\nEditor's note:\tWhether the 5QI is a suitable access category criteria type is FFS.\n\n***** Next change *****\nD.1.1\tOverview\nThe PCF may provide the UE with one or more UE policies using the network-requested UE policy management procedure. The UE provides the PCF with a list of one or more stored UE policy section identifiers (UPSIs), and the PCF provides each UE policy using one or more UE policy sections, each identified by aUPSI. The UPSI is composed of two parts:\na)\ta PLMN ID part containing the PLMN ID for the PLMN of the PCF which provides the UE policies; and\nb)\ta UE policy section code (UPSC) containing a value assigned by the PCF. \nThe UE processes the UE policy sections, each identified by the UPSI, received from the PCF and informs the PCF of the result.\nThe UE provides the PCF with the UE policy related capabilities such as the UE's support for ANDSP and the UE's OS\u00a0Id.\n***** Next change *****\nD.2.2.1\tGeneral\nThe purpose of the UE-initiated UE state indication procedure is:\na)\tto deliver the UPSI(s) of the UE policy section(s) which are:\n-\tidentified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; and\n-\tstored in the UE;\n\tto the PCF if the UE has one or more stored UE policy sections identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; and\nb)\tto indicate whether UE supports ANDSP; and\nc)\tto deliver the UE's one or more OS Ids\n.\n***** Next change *****\nD.2.2.2\tUE-initiated UE state indication procedure initiation\nIn order to initiate the UE-initiated UE state indication procedure, the UE shall create a UE STATE INDICATION message. The UE:\na)\tshall allocate a PTI value currently not used and set the PTI IE to the allocated PTI value; \nb)\tshall include the UPSI(s) of the UE policy section(s) which are identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN available in the UE in the UPSI list IE; \nc)\tshall specify whether the UE supports ANDSP in the UE policy classmark IE; and\nd)\tmay include the UE's one or more OS Ids in the UE OS Id IE\n,.\nThe UE shall send the UE STATE INDICATION message (see example in figure\u00a0D.2.2.2.1). The UE shall transport the created UE STATE INDICATION message using the registration procedure (see subclause\u00a05.5.1).\n\nFigure\u00a0D.2.2.2.1: UE-initiated UE state indication procedure\n***** Next change *****\nD.5.4.1\tMessage definition\nThe UE STATE INDICATION message is sent by the UE to the PCF:\na)\tto deliver the UPSI(s) of the UE policy section(s) stored in the UE;\nb)\tto indicate whether the UE supports ANDSP; and\nc)\tto deliver the the UE's one or more OS Ids;\n\nsee table\u00a0D.5.4.1.1.\nMessage type:\tUE STATE INDICATION\nSignificance:\tdual\nDirection:\t\tUE to network\nTable\u00a0D.5.4.1.1: UE STATE INDICATION message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tPTI\tProcedure transaction identity\t9.6\tM\tV\t1\n\tUE STATE INDICATION message identity\tUE policy delivery service message type\tD.6.1\tM\tV\t1\n\tUPSI list\tUPSI list\tD.6.4\tM\tLV-E\t9-65531\n\tUE policy classmark\tUE policy classmark\tD.6.5\tM\tLV\t2-4\n41\tUE OS Id\tOS Id\tD.6.6\tO\tTLV\t18-242 \n\nNOTE:\tThe total length of the UE STATE INDICATION message content cannot exceed 65535 octets (see Payload container contents maximum length as specified in subclause 9.11.3.39.1).\n\n***** Next change *****\n\n\n\n\n\nFigure\u00a0D.6.7.1: UE \nOS Id information element\n\n\n***** Next change *****\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFor the network and the UE to exchange information about the UE's operating system identity, there is no need for a sixteen octets UUID. In addition, there may be cases when the network and the UE do not know how to identify their OS Id to each other such as:A UE can change its OS or add another active OS. The UE may therefore does not know the encoding of the new OS by the operator. An operator may not have an agreement by a UE vendor and as the result, it may not know what OS the UE is using.\n\n>>> SUMMARY OF CHANGE\nA new operating system identity is defined to identify the 3GPP registered OS Ids which are called 3GPP OS Ids with values which are registered and maintained by 3GPP.The format of the 3GPP OS Ids is limited to two Octet binary.3GPP OS Id 5GMM capability information element is added to provide the network with information about the UE's support or lack of support for 3GPP OS Id.This CR adds related text that 3GPP identified OS Ids are registred on CT WG1 site.\n\n>>> CONSEQUENCES IF NOT REVISED\nAccess barring feature jams the network with sixteen octets OS Id at the time of transmission of Operator-defined access category.The network will not know the OS running on the UE and thus will not know which OSAppIDs to include in URSP rules provided to the UE, i.e.:- whether to include OSAppIDs of Android applications;- whether to include OSAppIDs of iOS applications;- whether to include OSAppIDs of Windows applications; or- whether to include OSAppIDs of applications for any other OS."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**** start of changes ****\n6.1.5\tMechanisms for the set up of UE-initiated tunnels (WLAN 3GPP IP Access)\n-\tThe WLAN UE and the PDG use IKEv2, as specified in [ikev2], in order to establish IPSec security associations.\n-\tPublic key signature based authentication with certificates, as specified in [ikev2], is used to authenticate the PDG. The PDG shall authenticate itself with an identity, for example, \"pdg.mncNNN.mccMMM.3gppnetwork.org\". This identity shall be contained in the IKEv2 ID_FQDN payload and shall match a dNSName SubjectAltName component in the PDG's certificate. A profile for certificate contents and processing is defined in clause\u00a06.6A.\n-\tEAP-AKA within IKEv2, as specified in [ikev2, section 2.16], is used to authenticate WLAN UEs, which contain a USIM.\n-\tEAP-SIM within IKEv2, as specified in [ikev2, section 2.16], is used to authenticate WLAN UEs, which contain a SIM and no USIM.\n-\tA profile for IKEv2 is defined in section 6.5.\n-\tIf the Private network access from WLAN 3GPP IP Access is required, then multiple authentications with the 3GPP AAA Server and External AAA Server are performed. The detailed procedure of this access method is described in section 6.1.5.3.\n**** end of changes ****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe current text in 33.234 does not mandate using any particular identity, so the security benefits of using certificates are largely lost. An attacker can easily buy a certificate for his own domain name and if the MS does not check the name, it will accept it. Even if the certificate is issued by an operator\u2019s own CA, since it isn't mandatory for UE\u00a0to check the validity of the PDG certificate, an attacker that gets hold of private key corresponding to any certificate issued by the operator\u2019s CA (which could be thousands) can masquerade as the PDG.So TS 33.234 should be fixed to require the MS to compare the PDG identity authenticated in IKEv2 with the identity \"expected\" by the MS and abort connection if they don't match, and describe how the MS knows what the \"expected\" identity is.In section 14.7.2 \u201cFormat of W-APN Operator Identifier\u201d of TS23.003 it defines The default W-APN Operator Identifier is derived from the IMSI as follows:\"w-apn.mnc<MNC>.mcc<MCC>.pub.3gppnetwork.org\"Following this rule the PDG identity in TS33.234 can be mandated in format of \u201cw-apn.mncNNN.mccMMM.pub.3gppnetwork.org\". In this way the MS can know what the \"expected\" identity is.So an attacker can't masquerade as the PDG.\u00a0This is because he can't get a certificate for w-apn.mncNNN.mccMMM.pub.3gppnetwork.org (unless an operator\u2019s CA makes a big mistake).Since the domain \u201c3gppnetwork.org\u201d can only be used by 3GPP operators, the ID in format \u201cw-apn.mncNNN.mccMMM.pub.3gppnetwork.org\u201d is only valid for the PDGs belonging to 3GPP operators. UE can know if it will connect to a 3GPP operators\u2019 PDG during W-APN resolution specified in TS23.234.\n\n>>> SUMMARY OF CHANGE\nMandate the format of PDG ID for the PDG belonging to 3GPP operators.\n\n>>> CONSEQUENCES IF NOT REVISED\nLeave a security hole for the attacker to masquerade as the PDG."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n**** For information ****\n\n5.3.5.7\tAS Security key update\nThe UE shall:\n1>\tif UE is connected to E-UTRA/EPC:\n2>\tupon reception of sk-Counter as specified in TS 36.331 [10]:\n3>\tupdate the S-KgNB key based on the KeNB key and using the received sk-Counter value, as specified in TS 33.401 [30];\n3>\tderive the KRRCenc and KUPenc keys as specified in TS 33.401 [30];\n3>\tderive the KRRCint and KUPint keys as specified in TS 33.401 [30].\n1>\telse:\n2>\tif the nas-Container is included in the received masterKeyUpdate:\n3>\tforward the nas-Container to the upper layers;\n2>\tif the keySetChangeIndicator is set to true:\n3>\tderive or update the KgNB key based on the KAMF key, as specified in TS 33.501 [11];\n2>\telse:\n3>\tderive or update the KgNB key based on the current KgNB key or the NH, using the nextHopChainingCount value indicated in the received masterKeyUpdate, as specified in TS 33.501 [11];\n2>\tstore the nextHopChainingCount value;\n2>\tderive the keys associated with the KgNB key as follows:\n3>\tif the securityAlgorithmConfig is included in SecurityConfig:\n4>\tderive the KRRCenc and KUPenc keys associated with the cipheringAlgorithm indicated in the securityAlgorithmConfig, as specified in TS 33.501 [11];\n4>\tderive the KRRCint and KUPint keys associated with the integrityProtAlgorithm indicated in the securityAlgorithmConfig, as specified in TS 33.501 [11];\n3>\telse:\n4>\tderive the KRRCenc and KUPenc keys associated with the current cipheringAlgorithm, as specified in TS 33.501 [11];\n4>\tderive the KRRCint and KUPint keys associated with the current integrityProtAlgorithm, as specified in TS 33.501 [11].\nNOTE:\tCiphering and integrity protection are optional to configure for the DRBs.\n\n**** First change ****\n\n5.3.5.8.2\tInability to comply with RRCReconfiguration\nThe UE shall:\n1>\tif the UE is in EN-DC:\n2>\tif the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over SRB3;\n3>\tcontinue using the configuration used prior to the reception of RRCReconfiguration message;\n3>\tinitiate the SCG failure information procedure as specified in subclause 5.7.3 to report SCG reconfiguration error, upon which the connection reconfiguration procedure ends;\n2>\telse, if the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over SRB1;\n3>\tcontinue using the configuration used prior to the reception of RRCReconfiguration message;\n3>\tinitiate the connection re-establishment procedure as specified in TS 36.331 [10], clause 5.3.7, upon which the connection reconfiguration procedure ends.\n1>\telse if RRCReconfiguration is received via NR:\n2>\tif the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message ;\n3>\tcontinue using the configuration used prior to the reception of RRCReconfiguration message;\n3>\tif AS security has not been activated:\n4>\tperform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other'\n3>\telse if AS security has been activated but SRB2 and at least one DRB have not been setup:\n4>\tperform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure';\n3>\telse:\n4>\tinitiate the connection re-establishment procedure as specified in 5.3.7, upon which the reconfiguration procedure ends;\n1>\telse if RRCReconfiguration is received via other RAT (Handover to NR failure):\n2>\tif the UE is unable to comply with any part of the configuration included in the RRCReconfiguration message:\n3>\tperform the actions defined for this failure case as defined in the specifications applicable for the other RAT.\nNOTE 1:\tThe UE may apply above failure handling also in case the RRCReconfiguration message causes a protocol error for which the generic error handling as defined in clause 10 specifies that the UE shall ignore the message.\nNOTE 2:\tIf the UE is unable to comply with part of the configuration, it does not apply any part of the configuration, i.e. there is no partial success/failure.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSA3 in TS 33.501 subclause 6.9.2.3.4 specifies that the UE shall verify the NAS COUNT and NAS MAC when receiving NASC (NAS Container) in the HO Command and process it only if the verification is successful.  If the verification is not successful, NAS continues to use the old security information and hence the AS security keys derived by UE AS will be incorrect/not possible.  The only recovery possible from this situation is to initiate a re-establishment procedure and UE revert to the previous configuration, including the security keys.  This AS behaviour is not what is normally expected with transparent NAS containers and hence needs to be captured explictly.\n\n>>> SUMMARY OF CHANGE\nUE considers it a RRCReconfiguration failure if NAS indicates an invalid nas-Container.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf the UE receives an invalid nas-Container, the UE may apply wrong keys and be unable to continue the communication resulting in a failure of RRC connection.Impact analysis:Impacted architecture: SAImpact is isolated to RRCReconfiguration involving NAScontainer for security derivation.If the network is implemented in line with this CR and UE is not, the UE may apply wrong keys and be unable to continue the communication resulting in a failure of RRC connection.If the UE is implemented in line with this CR and network is not, there is no inter-operability issue.  HO will fail and UE and network will fall back to previous (security) configuration after the re-establishment."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n------------------------------------------- 1st change----------------------------------------------\n5.3.2.1\tNormal procedures\nThe I-CSCF may behave as a stateful proxy for initial requests.\nUpon receipt of a request, the I-CSCF shall perform the originating procedures as described in subclause\u00a05.3.2.1A if the topmost Route header field of the request contains the \"orig\" parameter. Otherwise, the I-CSCF shall continue with the rest of the procedures of this subclause.\nWhen the I-CSCF receives a request, the I-CSCF shall verify whether it has arrived from a trusted domain or not. If the request has arrived from a non trusted domain, then the I-CSCF shall remove all P-Charging-Vector header fields and all P-Charging-Function-Addresses header fields the request may contain.\nNOTE\u00a01:\tThe I-CSCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP\u00a0TS\u00a033.210\u00a0[19A].\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe I-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs.\nNOTE\u00a02:\tThe special treatment can included filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nThe I-CSCF shall discard the P-Profile-Key header field, if the I-CSCF receives the P-Profile-Key header field in a SIP request or response.\nWhen the I-CSCF receives, destined for a served user or a PSI, an initial request for a dialog or standalone transaction the I-CSCF shall:\n1)\tif the Request-URI includes: \na)\ta pres: or an im: URI, then translate the pres: or im: URI to a public user identity and replace the Request-URI of the incoming request with that public user identity; or\nb)\t a SIP-URI that is not a GRUU and with the user part starting with a + and the \"user\" SIP URI parameter equals \"phone\" then replace the Request-URI with a tel-URI with the user part of the SIP-URI in the telephone-subscriber element in the tel-URI, and carry forward the tel-URI parameters that may be present in the Request-URI; or\nc)\ta SIP URI that is a GRUU, then obtain the public user identity from the Request-URI and use it for location query procedure to the HSS. When forwarding the request, the I-CSCF shall not modify the Request-URI of the incoming request;\nNOTE\u00a03:\tIf the Request-URI is a GRUU with the user part starting with a + and the \"user\" SIP URI parameter equals \"phone\", the I-CSCF builds a tel URI from the user part and uses it only to query the HSS. Subsequently, when the I-CSCF forwards the request to the S-CSCF, it will not modify the Request-URI.\nNOTE\u00a04:\tSRV records have to be advertised in DNS pointing to the I-CSCF for pres: and im: queries.\n2)\tremove its own SIP URI from the topmost Route header field, if present; and\n3)\tcheck if the domain name of the Request-URI matches with one of the PSI subdomains configured in the I-CSCF. If the match is successful, the I-CSCF resolves the Request-URI by an internal DNS mechanism into the IP address of the AS hosting the PSI and does not start the user location query procedure. Otherwise, the I-CSCF will start the user location query procedure to the HSS as specified in 3GPP\u00a0TS\u00a029.228\u00a0[14] for the called PSI or user, indicated in or derived from the Request-URI. Prior to performing the user location query procedure to the HSS, the I-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional (SLF) entity as specified in 3GPP\u00a0TS\u00a029.228\u00a0[14].\nWhen the I-CSCF receives any response to such a request, the I-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present. \nNOTE\u00a05:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the response was sent. \nWhen the I-CSCF receives an INVITE request, the I-CSCF may require the periodic refreshment of the session to avoid hung states in the I-CSCF. If the I-CSCF requires the session to be refreshed, then the I-CSCF shall apply the procedures described in RFC\u00a04028\u00a0[58] clause\u00a08. \nNOTE\u00a06:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nIn case the I-CSCF is able to resolve the Request-URI into the IP address of the AS hosting the PSI, then the I-CSCF shall:\n1)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. If no \"icid-value\" header field parameter was found, then create a new, globally unique value for the \"icid-value\" header field parameter and insert it into the P-Charging-Vector header field. The I-CSCF shall insert a type 3 \"orig-ioi\" header field parameter in place of any received \"orig-ioi\" header field parameter. The I-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The I-CSCF shall not include the type 3 \"term-ioi\" header field parameter; and\n2)\tforward the request directly to the AS hosting the PSI.\nUpon successful user location query, when the response contains the URI of the assigned S-CSCF , the I-CSCF shall:\n1)\tinsert the URI received from the HSS as the topmost Route header field;\n2)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. If no \"icid-value\" header field parameter was found, then create a new, globally unique value for the \"icid-value\" header field parameter and insert it into the P-Charging-Vector header field;\n3)\toptionally, include the received Redirect-Host AVP value in the P-User-Database header field as defined in RFC\u00a04457\u00a0[82]; \n and\n4)\tforward the request based on the topmost Route header field.\nNOTE\u00a07:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon successful user location query, when the response contains information about the required S-CSCF capabilities, the I-CSCF shall:\n1)\tif overlap signalling using the multiple-INVITEs method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, route the new INVITE to the same next hop as the previous INVITE request; otherwise\n2)\tselect a S-CSCF according to the method described in 3GPP\u00a0TS\u00a029.228\u00a0[14];\n3)\tinsert the URI of the selected S-CSCF as the topmost Route header field value;\n4)\texecute the procedure described in step 2 and 3 in the above paragraph (upon successful user location query, when the response contains the URI of the assigned S-CSCF);\n5)\toptionally, include the received Redirect-Host AVP value in the P-User-Database header field as defined in RFC\u00a04457\u00a0[82];\n6)\tif the Wildcarded Identity value is received from the HSS in the Wildcarded-Identity AVP and the I-CSCF supports the the SIP P-Profile-Key private header extension, include the wildcarded identity value in the P-Profile-Key header field as defined in RFC\u00a05002\u00a0[97]; and\nNOTE\u00a08:\tA Wildcarded Identity can be either a PSI or a public user identity.\n7)\tforward the request to the selected S-CSCF.\nNOTE\u00a09:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon an unsuccessful user location query when the response from the HSS indicates that the user does not exist, and if the Request-URI is a tel URI containing a public telecommunications number as specified in RFC\u00a03966\u00a0[22], the I-CSCF may support a local configuration option that indicates whether or not request routeing is to be attempted. If the local configuration option indicates that request routeing is to be attempted, then the I-CSCF shall perform one of the following procedures based on local operator policy:\n1)\tforward the request to the transit functionality for subsequent routeing; or\n2)\tinvoke the portion of the transit functionality that translates the public telecommunications number contained in the Request-URI to a routeable SIP URI, and process the request based on the result, as follows:\na)\tif the translation fails, the request may be forwarded to a BGCF or any other appropriate entity (e.g. a MRFC to play an announcement) in the home network, or the I-CSCF may send an appropriate SIP response to the originator, such as 404 (Not Found) or 604 (Does not exist anywhere). When forwarding the request to a BGCF or any other appropriate entity, the I-CSCF shall leave the original Request-URI containing the tel URI unmodified:\ni)\tif overlap signalling using the multiple-INVITEs method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, the I-CSCF shall route the new INVITE to the same next hop as the previous INVITE request; and\nii)\tadditional procedures apply if the I-CSCF supports NP capabilities and these capabilities are enabled by local policy, and the database used for translation from an international public telecommunications number to a SIP URI also provides NP data (for example, based on the PSTN Enumservice as defined by RFC\u00a04769\u00a0[114] or other appropriate data bases). If the above translation from an international public telecommunications number to a SIP URI failed, but NP data was obtained from the database, then the I-CSCF shall update the tel-URI in the Request-URI with the obtained NP data, prior to forwarding the request to the BGCF or other appropriate entity. The URI is updated by the I-CSCF by adding the NP parameters defined by RFC\u00a04694\u00a0[112] to the tel-URI in the Request-URI: an \"npdi\" tel-URI parameter is added to indicate that NP data retrieval has been performed, and if the number is ported, an \"rn\" tel-URI parameter is added to identify the ported-to routeing number. The I-CSCF shall perform these procedures if the tel-URI in the received Request-URI does not contain an \"npdi\" tel-URI parameter. In addition, the I-CSCF may, based on local policy, perform these procedures when the tel-URI in the received Request-URI contains an \"npdi\" tel-URI parameter indicating that the NP data has been previously obtained; or\nNOTE\u00a010: The I-CSCF might need to update NP data added by a previous network if the previous network's NP database did not contain the local ported data for the called number.\nb)\tif this translation succeeds, then replace the Request-URI with the routeable SIP URI and process the request as follows:\n-\tdetermine the destination address (e.g. DNS access) using the URI placed in the topmost Route header field if present, otherwise based on the Request-URI. If the destination requires interconnect functionalities (e.g. the destination address is of an IP address type other than the IP address type used in the IM CN subsystem), the I-CSCF shall forward the request to the destination address via an IBCF in the same network;\n-\tif network hiding is needed due to local policy, put the address of the IBCF to the topmost Route header field;\n-\troute the request based on SIP routeing procedures; and\n-\tif overlap signalling using the multiple-INVITE method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, route the new INVITE to the same next hop as the previous INVITE request.\nUpon an unsuccessful user location query when the response from the HSS indicates that the user does not exist, and if local operator policy does not indicate that request routeing is to be attempted, then, the I-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 404 (Not found) or 604 (Does not exist anywhere) in the case the user is not a user of the home network. \nUpon an unsuccessful user location query when the response from the HSS indicates that the user is not registered and no services are provided for such a user, the I-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 480 (Temporarily unavailable) response if the user is recognized as a valid user, but is not registered at the moment and it does not have services for unregistered users.\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction, that contains a single Route header field pointing to itself, the I-CSCF shall determine from the entry in the Route header field whether it needs to do HSS query. In case HSS query is not needed, then the I-CSCF shall:\n1)\tremove its own SIP URI from the topmost Route header field; and\n2)\troute the request based on the Request-URI.\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction containing more than one Route header field, the I-CSCF shall:\n1)\tremove its own SIP URI from the topmost Route header field; and\n2)\tforward the request based on the topmost Route header field.\nNOTE\u00a011:\tIn accordance with SIP the I-CSCF can add its own routeable SIP URI to the top of the Record-Route header field to any request, independently of whether it is an initial request. The P-CSCF will ignore any Record-Route header field that is not in the initial request of a dialog.\nWhen the I-CSCF receives a response to an initial request (e.g. 183 (Session Progress) response or 2xx response), the I-CSCF shall store the values from the P-Charging-Function-Addresses header field, if present. If the next hop is outside of the current network, then the I-CSCF shall remove the P-Charging-Function-Addresses header field prior to forwarding the message.\nWhen the I-CSCF, upon sending an initial INVITE request to the S-CSCF, receives a 305 (Use Proxy) response from the S-CSCF, the I-CSCF shall forward the initial INVITE request to the SIP URI indicated in the Contact field of the 305 (Use Proxy) response, as specified in RFC\u00a03261\u00a0[26].\n\n\n\n------------------------------------------- 2nd change----------------------------------------------\n\n\n\n5.3.2.1A\tOriginating procedures for requests containing the \"orig\" parameter\nThe procedures of this subclause apply for requests received at the I-CSCF when the topmost Route header field of the request contains the \"orig\" parameter.\nThe I-CSCF shall verify for all requests whether they arrived from a trusted domain or not. If the request arrived from a non trusted domain, then the I-CSCF shall respond with 403 (Forbidden) response.\nIf the request arrived from a trusted domain, the I-CSCF shall perform the procedures below.\nNOTE\u00a01:\tThe I-CSCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP\u00a0TS\u00a033.210\u00a0[19A].\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe I-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs.\nNOTE\u00a02\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\n\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction the I-CSCF will start the user location query procedure to the HSS as specified in 3GPP\u00a0TS\u00a029.228\u00a0[14] for the calling user, indicated in either:\n1)\tthe P-Served-User header field, if included in the request; or\n2)\tthe P-Asserted-Identity header field, if the P-Served-User header field is not included in the request.\nPrior to performing the user location query procedure to the HSS, the I-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional (SLF) entity as specified in 3GPP\u00a0TS\u00a029.228\u00a0[14].\nWhen the I-CSCF receives an INVITE request, the I-CSCF may require the periodic refreshment of the session to avoid hung states in the I-CSCF. If the I-CSCF requires the session to be refreshed, the I-CSCF shall apply the procedures described in RFC\u00a04028\u00a0[58] clause\u00a08.\nNOTE\u00a03:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen the response for user location query contains information about the required S-CSCF capabilities, the I-CSCF shall select a S-CSCF according to the method described in 3GPP\u00a0TS\u00a029.228\u00a0[14].\nIf the user location query was successful, the I-CSCF shall:\n1)\tinsert the URI of the S-CSCF - either received from the HSS, or selected by the I-CSCF based on capabilities - as the topmost Route header field appending the \"orig\" parameter to the URI of the S-CSCF;\n2)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. If no \"icid-value\" header field parameter was found, then create a new, globally unique value for the \"icid-value\" header field parameter and insert it into the P-Charging-Vector header field;\n3)\toptionally, include the received Redirect-Host AVP value in the P-User-Database header field as defined in draft-camarillo-sipping-user-database\u00a0[82];\n4)\tif a wildcarded public user identity value is received from the HSS in the Wildcarded-IMPU AVP and the I-CSCF supports the the SIP P-Profile-Key private header extension, include the wildcarded public user identity value in the P-Profile-Key header field as defined in RFC\u00a05002\u00a0[97]; and\n5)\tforward the request based on the topmost Route header field.\nNOTE\u00a04:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon an unsuccessful user location query, the I-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 404 (Not found) response or 604 (Does not exist anywhere) response in the case the user is not a user of the home network.\nWhen the I-CSCF receives any response to the above request, and forwards it to AS, the I-CSCF shall:\n-\tstore the values from the P-Charging-Function-Addresses header field, if present. If the next hop is outside of the current network, then the I-CSCF shall remove the P-Charging-Function-Addresses header field prior to forwarding the message; and\n-\tinsert a P-Charging-Vector header field containing the type 3 \"orig-ioi\" header field parameter, if received in the request, and a type 3 \"term-ioi\" header field parameter in the response. The I-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response and the type 3 \"orig-ioi\" header field parameter is set to the previously received value of type 3 \"orig-ioi\" header field parameter.\n\n\n----------------------------------------- End changes---------------------------------------------\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n- The User location response from HSS may include a Wildcarded-Public-Identity AVP. The value of the AVP shall be included in the P-Profile-Key header field as defined in RFC 5002 if supported by I-CSCF.At the moment the 3GPP TS 24.229 does not include the AVP in all cases.- Further, it is not clear how to handle the case when the URI received from the HSS is an AS.- If the I-CSCF receives a SIP request with a PPK and a \"distinct IPMU\" in the PSU/PAI, the I-CSCF will forward a SIP Request to the S-CSCF with a PPK. However, the Sip Request shall NOT contain a PPK because the PSU/PAI contains a distinct IMPU.\n\n>>> SUMMARY OF CHANGE\n- Included the wildcarded identity value in the P-Profile-Key header field when the I-CSCF receives a URI from the HSS in the terminating case.- Added on originating side that the procedure towards S-CSCF when receiving an URI is also valid for the AS case.\n\n>>> CONSEQUENCES IF NOT REVISED\n- The P-Profilie key will not be included in SIP requests towards the AS and to S-CSCF on the terminating side.- The P-Profilie key will not be included in SIP requests towards the AS on the originating sideThe above behaviour is inconsistent with the information received from HSS and the purpose with the SIP P-Profile-Key private header extension, i.e. the S-CSCF and/or the AS will do unnecessary queries to HSS causing unnecessary load on HSS."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st Change\n2.1.2\tVocabulary\nFor the purposes of the present document, the following terms and definitions apply:\n-\tA GSM security context is established and stored in the MS and the network as a result of a successful execution of a GSM authentication challenge. The GSM security context for the CS domain consists of the GSM ciphering key and the ciphering key sequence number. The GSM security context for the PS domain consists of the GPRS GSM ciphering key and the GPRS ciphering key sequence number.\n-\tA UMTS security context is established and stored in the MS and the network as a result of a successful execution of a UMTS authentication challenge. The UMTS security context for the CS domain consists of the UMTS ciphering key, the UMTS integrity key, the GSM ciphering key and the ciphering key sequence number. The UMTS security context for the PS domain consists of the GPRS UMTS ciphering key, the GPRS UMTS integrity key, the GPRS GSM ciphering key, the GPRS ciphering key sequence number and the GPRS GSM Kc128 (if an A5 or GEA ciphering algorithm that requires a 128-bit ciphering key is in use).\n-\tidle mode: In this mode, the mobile station is not allocated any dedicated channel; it listens to the CCCH and the BCCH;\n-\tgroup receive mode: (only applicable for mobile stations supporting VGCS listening or VBS listening) In this mode, the mobile station is not allocated a dedicated channel with the network; it listens to the downlink of a voice broadcast channel or voice group call channel allocated to the cell. Occasionally, the mobile station has to listen to the BCCH of the serving cell as defined in 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a045.008\u00a0[34];\n-\tdedicated mode: In this mode, the mobile station is allocated at least two dedicated channels, only one of them being a SACCH;\n-\tgroup transmit mode: (only applicable for mobile stations supporting VGCS talking) In this mode, one mobile station of a voice group call is allocated two dedicated channels, one of them being a SACCH. These channels can be allocated to one mobile station at a time but to different mobile stations during the voice group call; \n-\tpacket idle mode: (only applicable for mobile stations supporting GPRS) In this mode, mobile station is not allocated any radio resource on a packet data physical channel; it listens to the PBCCH and PCCCH or, if those are not provided by the network, to the BCCH and the CCCH, see 3GPP\u00a0TS\u00a044.060\u00a0[76].\n-\tpacket transfer mode: (only applicable for mobile stations supporting GPRS) In this mode, the mobile station is allocated radio resource on one or more packet data physical channels for the transfer of LLC PDUs.\n-\tmain DCCH: In Dedicated mode and group transmit mode, only two channels are used as DCCH, one being a SACCH, the other being a SDCCH or a FACCH; the SDCCH or FACCH is called here \"the main DCCH\";\n-\tA channel is activated if it can be used for transmission, in particular for signalling, at least with UI frames. On the SACCH, whenever activated, it must be ensured that a contiguous stream of layer 2 frames is sent;\n-\tA TCH is connected if circuit mode user data can be transferred. A TCH cannot be connected if it is not activated. A TCH which is activated but not connected is used only for signalling, i.e. as a DCCH;\n-\tThe data link of SAPI 0 on the main DCCH is called the main signalling link. Any message specified to be sent on the main signalling link is sent in acknowledged mode except when otherwise specified;\n-\tThe term \"to establish\" a link is a short form for \"to establish the multiframe mode\" on that data link. It is possible to send UI frames on a data link even if it is not established as soon as the corresponding channel is activated. Except when otherwise indicated, a data link layer establishment is done without an information field.\n- \t\"channel set\" is used to identify TCHs that carry related user information flows, e.g., in a multislot configuration used to support circuit switched connection(s), which therefore need to be handled together. \n-\tA temporary block flow (TBF) is a physical connection used by the two RR peer entities to support the uni-directional transfer of LLC\u00a0PDUs on packet data physical channels, see 3GPP\u00a0TS\u00a044.060\u00a0[76].\n-\tRLC/MAC block: A RLC/MAC block is the protocol data unit exchanged between RLC/MAC entities, see 3GPP\u00a0TS\u00a044.060\u00a0[76].\n-\tA GMM context is established when a GPRS attach procedure is successfully completed.\n-\tNetwork operation mode\nThe three different network operation modes I, II, and III are defined in 3GPP\u00a0TS\u00a023.060\u00a0[74].\nThe network operation mode shall be indicated as system information. For proper operation, the network operation mode should be the same in each cell of one routing area.\n-\tGAN mode: See 3GPP\u00a0TS\u00a043.318\u00a0[75a].\n-\tGPRS MS operation mode\nThe three different GPRS MS operation modes A, B, and C are defined in 3GPP\u00a0TS\u00a023.060\u00a0[74]. \n-\tRR connection: A RR connection is a dedicated physical circuit switched domain connection used by the two RR or RRC peer entities to support the upper layers' exchange of information flows. \n-\tPS signalling connection is a peer to peer Iu mode connection between MS and CN packet domain node.\n-\tInter-System change is a change of an MS from A/Gb mode to Iu mode of operation or vice versa. or from S1 mode to A/Gb mode or Iu mode of operation.\n-\tGPRS: Packet Services for systems which operate the Gb or Iu-PS interfaces.\n-\tGSM ciphering key: A 64-bit CS GSM ciphering key\n-\tGSM Kc128: A 128-bit CS GSM ciphering key\n-\tGPRS GSM ciphering key: A 64-bit PS GSM ciphering key\n-\tGPRS GSM Kc128: A 128-bit PS GSM ciphering key\n-\tThe label (A/Gb mode only) indicates this section or paragraph applies only to a system which operates in A/Gb mode, i.e. with a functional division that is in accordance with the use of an A or a Gb interface between the radio access network and the core network. For multi system case this is determined by the current serving radio access network. \n-\tThe label (Iu mode only) indicates this section or paragraph applies only to a system which operates in  Iu mode. The Iu mode includes UTRAN and GERAN Iu modes, i.e. with a functional division that is in accordance with the use of an Iu-CS or Iu-PS interface between the radio access network and the core network. For multi system case this is determined by the current serving radio access network. \n-\tIn A/Gb mode,... Indicates this paragraph applies only to a system which operates in A/Gb mode. For multi system case this is determined by the current serving radio access network. \n-\tIn Iu mode,... Indicates this paragraph applies only to a system which operates in Iu mode. The Iu mode includes both UTRAN Iu mode and GERAN Iu mode. For multi system case this is determined by the current serving radio access network. \n-\tIn A/Gb mode and GERAN Iu mode,... Indicates this paragraph applies only to a system which operates in A/Gb mode or GERAN Iu mode. For multi system case this is determined by the current serving radio access network. \n-\tIn UTRAN Iu mode,... Indicates this paragraph applies only to a system which operates in UTRAN Iu mode. For multi system case this is determined by the current serving radio access network.\n-\tIn a shared network,... Indicates this paragraph applies only to a shared network. For the definition of shared network see 3GPP\u00a0TS\u00a023.122\u00a0[14].\n-\tA default PDP context is a PDP context activated by the PDP context activation procedure that establishes a PDN connection. The default PDP context remains active during the lifetime of the PDN connection.\n-\tSIM, Subscriber Identity Module (see 3GPP\u00a0TS\u00a042.017\u00a0[7]).\n-\tUSIM, Universal Subscriber Identity Module (see 3GPP\u00a0TS\u00a021.111\u00a0[101]).\n-\tMS, Mobile Station. The present document makes no distinction between MS and UE.\n-\tCell Notification is an (optimised) variant of the Cell Update Procedure which uses the LLC NULL frame for cell change notification which does not trigger the restart of the READY timer\n-\tDTM: dual transfer mode, see 3GPP\u00a0TS\u00a044.018\u00a0[84] and 3GPP\u00a0TS\u00a043.055\u00a0[87]\nThe term \"eCall only\" applies to a mobile station which is in the eCall only mode, as described in 3GPP\u00a0TS\u00a022.101\u00a0[8].\n\"removal of eCall only restriction\" means that all the limitations as described in 3GPP\u00a0TS\u00a022.101\u00a0[8] for the eCall only mode do not apply any more.\n-\tAccess domain selection: The process to select whether the CS domain or the IMS/IPCAN is used to transmit the call control signalling between MS and core network. Definition derived from 3GPP\u00a0TS\u00a023.221\u00a0[131].\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.401\u00a0[122], subclause\u00a03.2, apply:\nGlobally Unique MME Identifier (GUMMEI)\nGlobally Unique Temporary Identity (GUTI)\nIdle Mode Signalling Reduction (ISR)\nM-Temporary Mobile Subscriber Identity (M-TMSI)\nTracking Area Identity (TAI)\nTemporary Identity used in Next update (TIN)\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.301\u00a0[120] apply:\nCSG ID\nCSG selection\nS1 mode\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a033.401\u00a0[123] apply:\nCurrent EPS security context\nMapped security context\neKSI\nCK' and IK'\nNAS downlink COUNT\nNext Change\n4.7.7.4\tGPRS ciphering key sequence number\nThe security parameters for authentication and ciphering are tied together in sets. \nIn a GSM authentication challenge, from a challenge parameter RAND both the authentication response parameter SRES and the GPRS GSM ciphering key can be computed given the secret key associated to the IMSI. \nIn a UMTS authentication challenge, from a challenge parameter RAND, the authentication response parameter RES and the GPRS UMTS ciphering key and the GPRS UMTS integrity key can be computed given the secret key associated to the IMSI. Furthermore, in the USIM a GPRS GSM ciphering key can be computed from the GPRS UMTS integrity key and the GPRS UMTS ciphering key by means of an unkeyed conversion function. Furthermore, in A/Gb mode if a GEA ciphering algorithm that requires a 128-bit ciphering key is taken into use, then a GPRS GSM Kc128 shall also be calculated as described in the subclause\u00a04.7.7.3a.\nIn order to allow start of ciphering on a logical link without authentication, GPRS ciphering key sequence numbers are introduced. \nThe GPRS ciphering key sequence number is managed by the network such that the AUTHENTICATION AND\u00a0CIPHERING REQUEST message contains the GPRS ciphering key sequence number allocated to the GPRS GSM ciphering key (in case of a GSM authentication challenge) or the GPRS UMTS ciphering key and the GPRS UMTS integrity key (in case of a UMTS authentication challenge) which may be computed from the RAND parameter carried in that message.\nIf an authentication and ciphering procedure has been completed successfully and a GPRS ciphering key sequence number is stored in the network, the network shall include a different GPRS ciphering key sequence number in the AUTHENTICATION AND\u00a0CIPHERING REQUEST message when it intiates a new authentication and ciphering procedure.\nThe MS stores the GPRS ciphering key sequence number with the GPRS GSM ciphering key (in case of a GSM authentication challenge) and the GPRS UMTS ciphering key and the GPRS UMTS integrity key (in case of a UMTS authentication challenge), and includes the corresponding GPRS ciphering key sequence number in the ROUTING AREA UPDATE REQUEST, SERVICE REQUEST and ATTACH REQUEST messages.\nIf the GPRS ciphering key sequence number is deleted, the associated GPRS GSM ciphering key, GPRS UMTS ciphering key, GPRS UMTS integrity key and GPRS GSM Kc128 shall be deleted if any (i.e. the established GSM security context or the UMTS security context is no longer valid).\nIn Iu mode, the network may choose to start ciphering and integrity checking with the stored GPRS UMTS ciphering key and the stored GPRS UMTS integrity key (under the restrictions given in 3GPP\u00a0TS\u00a042.009\u00a0[5] and 3GPP\u00a0TS\u00a033.102\u00a0[5a]) if the stored GPRS ciphering key sequence number and the one given from the MS are equal.\nIn A/Gb mode, the network may choose to start ciphering with the stored GPRS GSM ciphering key or GPRS GSM Kc128 (under the restrictions given in 3GPP\u00a0TS\u00a042.009\u00a0[5]) if the stored GPRS ciphering key sequence number and the one given from the MS are equal and the previously negotiated ciphering algorithm is known and supported in the network. When ciphering is requested at GPRS attach, the authentication and ciphering procedure shall be performed since the MS does not store the ciphering algorithm at detach.\nNOTE 1:\tThe decision of starting ciphering with the GPRS GSM ciphering key or the GPRS GSM Kc128 depends on whether the network indicates in the CIPHERING MODE COMMAND message a GEA ciphering algorithm which requires a 64 or 128-bit ciphering key as specified in 3GPP\u00a0TS\u00a033.102\u00a0[5a].\nUpon GPRS attach, if ciphering is to be used, an AUTHENTICATION AND CIPHERING REQUEST message shall be sent to the MS to start ciphering.\nIf the GPRS ciphering key sequence number stored in the network does not match the GPRS ciphering key sequence number received from the MS in the ATTACH REQUEST message, then the network should authenticate the MS.\nIn A/Gb mode, the MS starts ciphering after sending the AUTHENTICATION AND CIPHERING RESPONSE message. The network starts ciphering when a valid AUTHENTICATION AND CIPHERING RESPONSE is received from the MS.\nIn Iu mode, the MS starts ciphering and integrity checking according to the conditions specified in specification 3GPP\u00a0TS\u00a025.331\u00a0[23c].\nIn A/Gb mode, as an option, the network may decide to continue ciphering without sending an AUTHENTICATION AND CIPHERING REQUEST message after receiving a ROUTING AREA UPDATE REQUEST message with a valid GPRS ciphering key sequence number. Both the MS and the network shall use the latest ciphering parameters. The network starts ciphering when sending the ciphered ROUTING AREA UPDATE ACCEPT message to the MS. The MS starts ciphering after receiving a valid ciphered ROUTING AREA UPDATE ACCEPT message from the network.\nNOTE 2:\tIn some specifications the term KSI (Key Set Identifier) is used instead of the term GPRS ciphering key sequence number. \n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCT1 agreed the CR1371 which introduces in TS 24.008 the handling of ciphering algorithms which require 128-bit ciphering (encryption) key.However, CR1371 contained a falty message name in a note included in the section 4.7.7.4. Also, the defintion of UMTS security context is not complete.\n\n>>> SUMMARY OF CHANGE\nCorrecting a faulty message in 4.7.7.4 and adding also the case of using a 128-bit ciphering key for CS domain in the defintion of the UMTS security context.\n\n>>> CONSEQUENCES IF NOT REVISED\nMisalignment between the definition of the UMTS security context and the procedural text in which it is possible to use A5/4 ciphering algorithm requires a 128-bit ciphering key (new GSM Kc128 may be part of the UMTS security context)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n* * * Start of Changes * * *\n\n6.2.2\tData Collection from NFs\n6.2.2.1\tGeneral\nThe Data Collection from NFs is used by NWDAF to subscribe/unsubscribe at any 5GC NF to be notified for data on a set of events.\nThe Data Collection from NFs is based on the services of AMF, SMF, UDM, PCF, NRF and AF (possibly via NEF):\n-\tEvent Exposure Service offered by each NF as defined in TS\u00a023.502\u00a0[3] clause\u00a04.15 and clause\u00a05.2.\n-\tother NF services (e.g. Nnrf_NFDiscovery and Nnrf_NFManagement in NRF as defined in TS\u00a023.502\u00a0[3] clause\u00a04.17)\nThis data collection service is used directly in order to retrieve behaviour data for individual UEs or groups of UEs (e.g. UE reachability), and also to retrieve global UE information (e.g. Number of UEs present in a geographical area).\nTable 6.2.2.1-1: NF Services consumed by NWDAF for data collection\nService producer\tService\tReference in TS\u00a023.502\u00a0[3]\nAMF\tNamf_EventExposure (NOTE 3)\t5.2.2.3\t5.2.3.5\nSMF\tNsmf_EventExposure (NOTE 3)\t5.2.8.3\t5.2.3.5\nPCF\tNpcf_EventExposure (for a group of UEs or any UE)\tNpcf_PolicyAuthorization_Subscribe (for a specific UE)\t5.2.5.7\nUDM\tNudm_EventExposure\t5.2.3.5\nNEF\tNnef_EventExposure\t5.2.6.2\nAF\tNaf_EventExposure\t5.2.19.2\nNRF\tNnrf_NFDiscovery\t5.2.7.3\n\tNnrf_NFManagement\t5.2.7.2\n\nNOTE\u00a01:\tThe present document specifies that NWDAF can collect some UPF input data for deriving analytics, but how NWDAF collects these UPF input data is not defined in this Release of the specification.\nNOTE\u00a02:\tThere is no data collected from the PCF by the NWDAF defined in this Release of the specification.\nNOTE\u00a03:\tThe Nudm_EventExposure can be used when NWDAF uses the procedures specified in TS\u00a023.502\u00a0[3] clause\u00a04.15.4.3 to subscribe to AMF or SMF via UDM.\nTo retrieve data related to a specific UE, there are two cases:\n-\tIf no Area of interest is indicated by the consumer, the NWDAF shall first determine which NF instances are serving this UE as stated in table 6.2.2.1-2 unless the NWDAF has already obtained this information due to recent operations related to this UE.\n-\tIf an Area of interest is indicated, the NWDAF can:\n-\tFirst determine the AMF serving the UE, and subscribe UE location from the AMF. Once the UE is in or moves into the Area of interest, the NWDAF determines which NF instances are serving this UE as stated in table 6.2.2.1-2 unless the NWDAF has already obtained this information due to recent operations related to this UE; or\n-\tDetermine the NF instances of a given type of network function serving the Area of interest by querying NRF unless the NWDAF has already obtained this information due to recent operations related to this UE.\nTable 6.2.2.1-2: NF Services consumed by NWDAF to determine which NF instances are serving a UE\nType of NF instance (serving the UE) to determine\tNF to be contacted by NWDAF\tService\tReference in TS\u00a023.502\u00a0[3]\nUDM\tNRF\tNnrf_NFDiscovery\t5.2.7.3\nAMF\tUDM\tNudm_UECM\t5.2.3.2\nSMF\tUDM\tNudm_UECM\t5.2.3.2\nBSF\tNRF\tNnrf_NFDiscovery\t5.2.7.3\nPCF\tBSF\tNbsf_Management\t5.2.13.2\nNEF\tNRF\tNnrf_NFDiscovery\t5.2.7.3\nNWDAF\tNRF\tUDM\tNnrf_NFDiscovery\tNudm_UECM\t5.2.7.3\t5.2.3.2\n\nThe UDM instance should be determined using NRF as described in clause\u00a04.17.4 of TS\u00a023.502\u00a0[3] and factors to determine as described in clause\u00a06.3.8 of TS\u00a023.501\u00a0[2].\nThe AMF, SMF instances should be determined using a request to UDM providing the SUPI. To determine the SMF serving a PDU session, the NWDAF should in addition provide the DNN and S-NSSAI of this PDU Session; otherwise the NWDAF will obtain a list of possibly multiple SMFs (e.g. one per PDU session).\nThe BSF instance should be discovered using NRF thanks to optional request parameters (e.g. DNN list, IP domain list, IPv4 address range, IPv6 prefix range) as stated in clause\u00a04.17.4 of TS\u00a023.502\u00a0[3], or based on local configuration at the NWDAF.\nThe PCF instance serving UE PDU Session(s) should be determined using a request to BSF with the allocated UE address, DNN and S-NSSAI.\nWhen NWDAF receives a request addressed to an Internal Group ID from a consumer, NWDAF may need to initiate data collection from several 5GC NFs, such as AMF, SMF, UDM, PCF, NEF/AF, etc. If an Area of interest is indicated by the consumer, NWDAF may first discover the instances of the required 5GC NFs deployed in the network, e.g. by querying NRF, otherwise:\n-\tFor discovering the UDM, NWDAF can query the NRF with the Internal Group ID as the target of the query.\n-\tFor discovering AMF, SMF, PCF, NEF, and AF, NWDAF may need to discover all instances in the network by using the Nnrf_NFDiscovery service.\nNOTE\u00a04:\tIt is assumed that all members of an Internal Group ID belong to the same UDM Group ID. NWDAF can select a UDM instance supporting the UDM Group ID of the Internal Group ID.\nThen, if data needs to be collected from AMF, SMF, UDM, and PCF, NWDAF may initiate the data collection with the Internal Group ID as the target, e.g. subscribing to the event exposure in all the instances of a given type of network function. This subscription to all the instances of required source of event exposure handles, e.g. mobility of UEs across AMFs, or initiation of new PDU sessions with different allocated SMFs.\nFor collecting data from AMF and SMF, NWDAF may collect the data directly from AMF and/or SMF, or indirectly via UDM, according to TS\u00a023.502\u00a0[3] clause\u00a04.15.4.3. The indirect method may be required if the event exposure subscription from NWDAF, for a UE or group of UEs, needs to survive the removal of UE context in the AMF including event exposure subscriptions, or upon the creation of new UE context in AMF or SMF serving the UE or group of UEs. In this case the UDM is responsible for (re)creating event exposure subscriptions in AMF and SMF, as specified in TS\u00a023.502\u00a0[3], clause\u00a04.15.4.3.\nThe NWDAF determines to collect data from a trusted AF supporting specific Event ID(s) and serving specific application(s) based on internal configuration.\nThe NEF instance that is serving a specific network slices and/or applications of a UE should be determined using NRF using optional request parameters as defined in clause\u00a06.3.14 of TS\u00a023.501\u00a0[2]\nIf NWDAF needs to collect data from an AF deployed outside the operator's domain, the NWDAF shall contact NEF with a SUPI or Internal Group ID as the target of the data collection. NEF is responsible for translation of SUPI to GPSI, or internal to external group identifiers, by querying UDM, prior to contacting the AF.\n\nTo retrieve required data for any UE, the NWDAF may subscribe to events from the AMF and/or SMF instances it has determined, setting the target of event reporting to \"any UE\" and the event filter(s) according to the Analytics Filter Information. Alternatively, if the required data is communication related and for any UE within an Area of interest, the NWDAF can obtain from the AMF instances it has determined a list of UEs located within the Area of Interest. Based on the obtained UE list, for each UE in the list, the NWDAF retrieves the SMF serving the UE and the NWDAF subscribes to data from the relevant SMF per each specific UE. The indirect event exposure subscription to AMF or SMF via UDM is not available for \"any UE\" or \"any UE within an Area of interest\". If the required data is collected from UE via AF as described in clause\u00a06.2.8 and the target of analytics reporting received from consumer is \"any UE\", the NWDAF may either set the target of event reporting to \"any UE\" in the data collection request to the AF, or may determine a list of UEs from AMF and / or SMF based on the analytics filter information and send the data collection request to the AF for the determined list of UEs.\nNOTE\u00a05:\tIf NWDAF requires collecting data from either AMF or SMF for \"any UE\" or \"any UE within an Area of Interest\", NWDAF can use the direct Event Exposure subscription to AMF or SMF, since subscriptions to \"any UE\" or \"any UE within an Area of Interest\" are persistent by nature in AMF or SMF, due to not being linked to a UE context.\nTo retrieve data related to \"any UE\" based on analytics filter information, the NWDAF shall first determine which NF instances are matching the analytics filter information (see clause\u00a06.7.5.1) as stated in table 6.2.2.1-3 unless the NWDAF has already obtained this information due to recent operations related to this analytics filter information.\nTable 6.2.2.1-3: NF Services consumed by NWDAF to determine which NF instances are matching analytics filters\nType of NF instance (matching analytics filters) to determine\tNF to be contacted by NWDAF\tService\tReference in TS\u00a023.502\u00a0[3]\nAMF, SMF\tNRF\tNnrf_NFDiscovery\t5.2.7.3\n\nTo retrieve data related to analytics IDs for \"any UE\" with analytics filter information defining an area of interest in terms of TA or Cells and/or with specific S-NSSAIs, NWDAF requires the network slice association information to properly determine the AMFs to collect data from as well as the proper queries to OAM for data collection.\nNOTE\u00a06:\tExamples of analytics ID requiring NWDAF to use network slice association information for data retrieval are: network performance clause\u00a06.6.1; user data congestion clause\u00a06.8.1; QoS Sustainability clause\u00a06.9; Dispersion Analytics clause\u00a06.10.1; observed service experience for a Network Slice clause\u00a06.4.1; and slice load analytics clause\u00a06.3.\nThe network slice association information comprises the TAs associated with each AMF, and for each TA its associated access type, cells and list of restricted or unrestricted S-NSSAIs per PLMN. Additionally, the mapping of cells per TA and restricted or unrestricted S-NSSAIs per PLMN for TA for each AMF can change and NWDAF shall obtain this accurate information in order to properly retrieve data for analytics generation.\nIn order to derive the network slice association information, NWDAF may be configured with the mapping of cells per TAI, and the S-NSSAIs per TAI. NWDAF may subscribe to the \"S-NSSAIs per TA mapping\" event exposed by AMF. The NWDAF may use the configured information (when the subscription or request is per Cell granularity) and the area of interest in the subscription to retrieve from AMF the list of restricted or unrestricted S-NSSAIs per PLMN for TA, and access types per TA for each AMF in the required area of interest. NWDAF consumes the \"S-NSSAIs per TA mapping\" event exposed by AMF using as target of event reporting the list of TAIs based on the TA received in the analytics filter information or identified by the mapping of the Cells per TA matching to the Cell granularity included in the analytics filter information. The AMF \"S-NSSAIs per TA mapping\" event output contains each TAI associated with AMF and for each TAI its associated access type and list of restricted or unrestricted S-NSSAIs per PLMN.\nTo retrieve data from SMFs for analytics IDs subscription or requests for \"any UE\" including analytics filter information with specific Applications, DNNs, DNAIs and area of interest per TA granularity, NWDAF shall first discover the SMF serving the area of interest via NRF.\nNOTE\u00a07:\tExamples of analytics ID requiring NWDAF to collect data related to PDU sessions associated with an AoI with TA granularity are: network performance clause\u00a06.6.1; user data congestion clause\u00a06.8.1, QoS Sustainability clause\u00a06.9.\nNWDAF may directly consume events from the discovered SMF using the event target set to \"any PDU session\", and event filters with the same parameters of the analytics filter information, i.e. list of Application IDs, and/or DNNs, and/or DNAI, and the area of interest related to the requested analytics ID.\n1.\tWhen SMF supports the exchange of UE Location parameter when SMF interacts with AMF via Nsmf_PDUSession_Create / Update / CreateSMContext / UpdateSMContext due to session establishment, modification, or release, service request, or handover procedures (as defined in the TS\u00a023.502\u00a0[3] clause\u00a05.2.8.2), SMF can directly map the PDU sessions to an AoI with TA granularity.\n\tIf there are any changes in PDU sessions in the area of interest, for the Application ID, and/or DNN, and/or DNAI subscribed by NWDAF, SMF notifies the detected changes to NWDAF via Nmsf_EventExposure_Notify service operation, enabling NWDAF to keep an updated map of SMF and PDU sessions associated with the analytics filter information in an area of interest.\n2.\tWhen SMF does not support the exchange of UE Location parameter when SMF interacts with AMF but supports the mapping of PDU sessions per TA (as defined in TS\u00a023.501\u00a0[2] clause\u00a05.6.11), SMF may subscribe to UE mobility event notifications of AMF as described in clause\u00a05.3.4.4 of TS\u00a023.501\u00a0[2] using event ID \"UE moving in or out of Area of Interest\" and Event Filters as described in Table 5.2.2.3.1-1 from TS\u00a023.502\u00a0[3] to retrieve the list of SUPIs (and GPSIs if available) in the area of interest. Based on the retrieved list of SUPIs in the area of interest, SMF identifies the PDU sessions in the area of interest.\n3.\tWhen SMF does not support the exchange of UE Location parameter when SMF interacts with SMF nor supports the mapping of PDU sessions per TA (as defined in TS\u00a023.501\u00a0[2] clause\u00a05.6.11), SMF rejects the request from NWDAF. Upon the reject, NWDAF identifies the need to create the mapping of PDU sessions per TA. NWDAF subscribes to UE mobility event notifications of AMF as described in clause\u00a05.3.4.4 of TS\u00a023.501\u00a0[2] using event ID \"UE moving in or out of Area of Interest\" and Event Filters as described in Table 5.2.2.3.1-1 from TS\u00a023.502\u00a0[3] to retrieve the list of SUPIs (and GPSIs if available) in the area of interest. Based on the retrieved list of SUPIs in the area of interest, NWDAF subscribes to the SMFs serving the UEs in the area of interest and derives the mapping of PDU sessions per TA.\nAn NWDAF may require to discover and select other NWDAFs for UE related analytics. In this case, the NWDAF may discover from UDM if an NWDAF is already collecting data related to the UE, as specified in clauses 5.2 and 6.1C.\n\n* * * Next Change * * *\n6.2.8.1\tGeneral\nThe NWDAF may interact with an AF to collect data from UE Application(s) as an input for analytics generation. The AF can be in the MNO domain or an AF external to MNO domain. The data collection request from NWDAF may trigger the AF to collect data from the UE Application.\nThe UE Application establishes a connection to the AF in the MNO domain or external to MNO domain over user plane via a PDU session. The AF communicates with the UE Application and collects data from UE Application.\nFor both an AF in trusted domain and an AF in untrusted domain (which supports to collect data from a UE Application), the SLA between the operator and the Application Service Provider (i.e. ASP) determines per Application ID in use by the ASP:\n-\tThe AF for the UE Application to connect to (e.g. based on an FQDN).\n-\tThe information that the UE Application shares with the AF, subject to user consent.\n-\tPossible Data Anonymization, Aggregation or Normalization algorithms (if used).\n-\tThe authentication information that enable the AF to verify the authenticity of the UE's Application that provides data.\nNOTE\u00a01:\tThe mutual authentication info that is used by the UE Application and the AF and how user consent is obtained is out of SA\u00a0WG2's scope.\nThe AF (which supports the data collection) is configured based on the SLA above.\nNOTE\u00a02:\tData Anonymization, Aggregation or Normalization algorithms within the SLA are defined per individual UE.\nA UE Application (which supports to providing data to an AF) is configured by the ASP with the Application ID to use in the communication with the AF and then the UE Application is configured per Application ID with the following information:\n-\tThe address of the AF to contact.\n-\tThe parameters that the UE Application is authorized to provide to the AF.\n-\tThe authentication information to enable the UE Application to verify the authenticity of the AF that requests data.\nNOTE\u00a03:\tThe authentication and authorization info that is used by the UE Application and the AF for collection and how user consent is obtained is out of SA2's scope.\nNOTE\u00a04:\tThe configuration procedure for the above information from the ASP to the UE's Application is out of SA\u00a0WG2 scope.\nNOTE\u00a05:\tThe Application ID configured in the UE Application can either be an OSAppId as defined in TS\u00a023.503\u00a0[4] or an OS independent Application Identifier (e.g. for applications running on a web browser).\nThe Target for Event Reporting may be set as \na GPSI in the Naf_EventExposure. \n\nThe GPSI may be an External Identifier for individual UE as defined in TS\u00a023.501\u00a0[2] that includes the domain name. This domain name and the Application ID configured in the UE Application are different from each other.\n* * * Next Change * * *\n6.2.8.2.3\tData Collection Procedure from UE\n\nFigure 6.2.8.2.3-1: Data Collection Procedure from UE\n1.\tAn NF subscribes to Analytics from the NWDAF as described in clause\u00a06.1.1.1, that includes Analytics ID, Analytics Filter Information including e.g. AoI, Internal Application ID(s) and Target of Analytics Reporting. NWDAF may also initiate the data collection prior to this subscription.\n2.\tNWDAF discovers the AF that provides data collection (based on the AF profiles registered in NRF) as described in TS 23.502\u00a0[3].\nStep 3a is used for the AF in trusted domain while step\u00a03b is used for the AF in untrusted domain.\n3a.\tNWDAF subscribes to the AF in trusted domain for UE data collection input data for analytics, by using Naf_Event_Exposure_Subscribe as defined in clause\u00a05.2.19.2 of TS\u00a023.502\u00a0[3]. The NWDAF requests contains an Application ID known in the core network and the UE Application provides the Application ID configured in the UE Application The AF binds the NWDAF request for an Application Id and the UE data collection for an Application Id configured in the UE.\n3b.\tNWDAF subscribes to the AF in untrusted domain for UE data collection input data for analytics, by using step\u00a02 and step\u00a03 of the procedure that is described in Figure\u00a06.2.2.3-1).\n4.\tThe AF collects the UE data using either direct or indirect data collection procedure in clause\u00a06.2.8.2.1. The establishment of the connection can be performed at any time prior to this. The AF links the data collection request from step\u00a03 to the user plane connection as described in clause\u00a06.2.8.2.4.\nNOTE\u00a01:\tThe Direct data collection and indirect data collection procedure is decided by SA4.\nEditor's note:\tAppropriate reference to SA4 specification for data collection procedure is needed.\nStep 5a is used for the AF in trusted domain while step\u00a05b is used for the AF in untrusted domain.\n5a.\tThe AF in trusted domain receives the input data from the UE, and processes the data (e.g. anonymizes, aggregates and normalizes) according to the SLA that is configured in the AF described in clause\u00a06.2.8.1, Event ID(s) and Event Filter(s) set during step\u00a03a. The trusted AF then notifies the NWDAF on the processed data collected according to the NWDAF subscription in step\u00a03a.\n5b.\tThe AF in untrusted domain receives the input data from the UE, and processes the data (e.g. anonymizes, aggregates and normalizes) according to the SLA that is configured in the AF described in clause\u00a06.2.8.1, Event ID(s) and Event Filter(s) set during step\u00a03b. The untrusted AF notifies the NWDAF on the processed data collected by using step\u00a05b (i.e. Step\u00a04 and step\u00a05 of the procedure that described in Figure\u00a06.2.2.3-1).\nNOTE\u00a02:\tIf NWDAF requests the same data for multiple UEs, i.e. a determined list of UEs or provides \"any UE\" as the target of analytics reporting, the AF either before step\u00a05a (the AF in trusted domain) or before step\u00a05b (the AF in untrusted domain) can process (e.g. anonymize, aggregate and normalize) the data from multiple UEs according to the Event ID(s) and Event Filter(s) received from NWDAF during step\u00a03a or 3b before notifying the NWDAF on the processed data.\n6.\tThe NWDAF produces Analytics.\n7.\tThe NWDAF provides analytics to the consumer NF.\nEditor's note:\tAny steps related to architecture enhancement (e.g. DCCF) in this procedure will need further updates.\n\nIf the target of analytics reporting that received from consumer in step\u00a01 is \"any UE\", NWDAF may either set the target of event reporting to \"any UE\" in step\u00a03a or 3b to AF, or may determines a list of SUPIs from AMF and/or SMF based on the analytics filter information and sends the step\u00a03a or 3b to AF for the determined list of UEs.\n\n* * * Next Change * * *\n6.2.8.2.4.1\tGeneral\nThe UE IP address is used to identify the user plane connection established between the UE application and the AF for data collection, while the AF receives the Naf_Event_Exposure_Subscribe to request for the specific UE data collection by using SUPI (for AF in trusted domain) or external UE ID (i.e. GPSI) (for AF in untrusted domain). AF is required to correlate the UE IP address to the SUPI or to GPSI.\n\nAF may indicate in NF profile and register to NRF in clause\u00a06.2.8.2.2 if it supports to do the mapping itself or ask NWDAF to do it and the supported list of S-NSSAI, DNN combinations.\nAccordingly, if AF supports the mapping, for AF in trusted domain, it is required to correlate the UE IP address and SUPI as described in clause\u00a06.2.8.2.4.2 after receiving the data collection request from NWDAF and there is no mapping information storage in the AF. For AF in untrusted domain, the procedure to correlate the UE IP address and GPSI is described in clause\u00a06.2.8.2.4a.\nNWDAF may collect the mapping information as described in clause\u00a06.2.8.2.4a before sending request to AF in step\u00a03a or step\u00a03b in Figure\u00a06.2.8.2.3-1.\n* * * Next Change * * *\n6.10.2\tInput Data\nThe NWDAF shall be able to collect UE dispersion information from NF(s) and AFs. The information collected by the NWDAF is network data from 5GC NFs and service data from AFs:\n-\tData related to UE transactions dispersion and bound by location collected from AMF and SMF are defined in the tables 6.10.2-1 and 6.10.2-2. This may include individual transactions or SMF/AMF state transition information stored as UE behaviour trends, which provides aggregated transaction information.\nTable 6.10.2-1: Location based UE transactions dispersion information collected from serving AMF\nInformation\tSource\tDescription\nUE ID\tAMF\tSUPI.\nType Allocation Code\tAMF\tTerminal model and vendor information of the UE.\nUE locations (1..max)\tAMF\tUE locations.\n   > UE location\tAMF\tArea of Interest (TA or cells that the UE had entered).\n   > Timestamp\tAMF\tTime stamp when the AMF detected that the UE had entered this location.\n   > Transactions\tAMF\tEither all transactions for this UE in this location or, optionally, if subscription with periodic notification is requested, the amount of UE transactions exchanged at the location in the notified time period.\nUE access behaviour trends\tAMF\tMetrics on UE state transitions (e.g., access, RM and CM states, handover).\nUE location trends\tAMF\tMetrics on UE locations.\nNOTE:\tUE location provides one location per instance while UE location trend provides multiple locations at once. One or both of them may be used.\n\nTable 6.10.2-2: UE transactions dispersion information collected from serving SMF\nInformation\tSource\tDescription\nUE IP address\tSMF\tUE IP address.\nUE ID\tSMF\tSUPI.\n   > Timestamp\tSMF\tTime stamp of the collected information.\n   > Transactions\tSMF\tEither all transaction for this UE or, optionally, if subscription with periodic notification is requested, the amount of UE transactions exchanged in the notified time period.\n> UE session behaviour trends\tSMF\tMetrics on UE state transitions (e.g. PDU Session Establishment, PDU Session Release).\n\nData volume can be collected from the AF per UE across all the UE applications provided by a particular AF or per UE per application when application IDs are requested.\nData related to UE data volume dispersion, bound by a location or slice, collected from the AF and UPF are defined in tables 6.10.2-3 through 6.10.2-6.\n\n\n-\tIn table 6.10.2-3, the data volume is collected per UE from the AF. The collected UE information is applicable across all the applications used by the UE during the period.\nTable 6.10.2-3: UE Data volume dispersion information collected from the AF\nInformation\tSource\tDescription\nUE ID\tAF\nTimestamp\tAF\tTime stamp of the collected information.\n> Data Volume UL/DL\tAF\tSum of UE data volume exchanged at the AF during the period of observation. \n\n-\tIn table 6.10.2-4, the AF reports data volume per UE per application in relation to the start and stop of the application as indicated by the application duration.\nTable 6.10.2-4: UE data volume dispersion collected from the AF\nInformation\tSource\tDescription\nUE IP address\tAF\tUE IP address.\nIP 5-tuple\tAF\tIP address 5-tuple.\nTimestamp\tAF\tTimestamp of the collected information. \nApplication ID\tAF\tIdentifier of the application at the AF.\nLocation of Application\tAF/NEF\tLocation of application represented by a list of DNAI(s). The NEF may map the AF-Service identifier information to a list of DNAI(s) when the DNAI(s) being used by the application are statically defined.\nData Volume UL/DL\tAF\tSum of UE data volume exchanged per application during the period.\nApplication duration\tAF\tDuration for the application (e.g. Voice talk time).\nNOTE\u00a01:\tApplication ID and IP 5-tuple are mutually exclusive.\tNOTE\u00a02:\tMultiple outputs are provided by the AF when multiple applications are running at the AF for the same UE and time period.\n\nData volume can also be collected from the UPF per UE IP address across all applications or per UE for specific application(s).\n-\tIn table 6.10.2-5, the data volume is collected per UE from the UPF. The collected UE information is applicable across all applications used by the UE between start and stop of the PDU session. The UPF reports volume per UE IP address across all applications.\nTable 6.10.2-5: UE data volume dispersion collected from serving UPF\nInformation\tSource\tDescription\nUE IP address\tUPF\tUE IP address.\nTimestamp\tUPF\tTime stamp of the collected information.\nData Volume UL/DL\tUPF\tSum of UE data volume exchanged per UE across all applications.\nNOTE:\tThe Data volume can be reported either as total volume of the PDU session or periodically. It refers to the Data volume exchanged between the start and stop of the PDU session. When reported periodically, the period can be specified in the requested analytic target period or configured as a default value in the UPF.\n\n-\tIn table 6.10.2-6, the UPF reports data volume per UE for specific application(s) in relation to the start and stop of the application as indicated by the application duration.\nThere are two modes of data collection:\n-\tNon periodical: A mode where the data volume is requested and consequently provided for the total volume of a PDU session.\n-\tPeriodical: A mode where data volume is provided periodically between the start and stop of a PDU session. The period can be specified in the requested analytic target period or configured as a default value in the UPF.\nFor both modes of data collection, if there are multiple application sessions for the UE PDU session, the NWDAF aggregates (i.e. sums up) the data volume across all applications to obtain per UE information.\nTable 6.10.2-6: UE data volume dispersion collected from serving UPF\nInformation\tSource\tDescription\nUE IP address\tUPF\tUE IP address.\nTimestamp\tUPF\tA timestamp of the collected information.\nApplication ID\tUPF\tIdentify the application at the UPF \nIP 5-tuple\tUPF\tIP 5-tuple.\nLocation of Application\tUPF\tList of Internet applications represented by DNAI(s).\nData Volume UL/DL\tUPF\tSum of UE data volume exchanged per application during the period. \nApplication duration\tUPF\tDuration for the application (e.g. Voice talk time).\nNOTE\u00a01:\tApplication ID and IP 5-tuple are mutually exclusive.\tNOTE\u00a02:\tMultiple outputs are provided by the UPF when multiple applications are running at the UPF for the same UE and time period.\tNOTE\u00a03:\tThe Data volume can be reported either as total volume of the PDU session or periodically. It refers to the Data volume exchanged between the start and stop of the PDU session. When reported periodically, the period can be specified in the requested analytic target period or configured as a default value in the UPF.\n\nThe task of the NWDAF is to calculate the volume of data and amount of transactions dispersed by the UE at each visited location during a period of interest. The entry time and exit time to a location is provided by the AMF.\nCollecting volume per UE and per specific application is optional and such information can be provided by the UPF or AF.\nThe Correlation Information as defined in table 6.2.4-1 is used to correlate the input data from AMF and SMF, the input data from SMF and UPF, and the input data from UPF and AF.\n-\tSlice information related to UE transactions dispersion from NF(s) are defined in tables 6.10.2-7 and 6.10.2-8. This may include individual transactions or SMF/AMF state transition information stored as UE behaviour trends, which provides aggregated transaction information.\n-\tThe Slice data volume collection is the same as listed in tables 6.10.2-3 to 6.10.2-6.\nTable 6.10.2-7: Slice based UE transactions dispersion information collected from serving AMF\nInformation\tSource\tDescription\nUE ID\tAMF\tSUPI.\nType Allocation Code\tAMF\tTerminal model and vendor information of the UE.\nSlice (1..max)\tAMF\tUE assigned slice.\n   >S-NSSAI\tAMF\tIdentifier of the slice.\n   >Timestamp\tAMF\tTime stamp when the slice was assigned.\n   >Transactions\tAMF\tEither all transactions for this UE or, optionally, if subscription with periodic notification is requested, an amount of UE transactions exchanged at the slice in the notified time period.\nUE access behaviour trends\tAMF\tMetrics on UE state transitions (e.g., access, RM and CM states, handover).\n\nTable 6.10.2-8: Slice based UE transactions dispersion information collected from serving SMF\nInformation\tSource\tDescription\nUE IP\tSMF\tUE IP address.\nUE ID\tSMF\tSUPI.\nSlice (1..max)\tSMF\tUE assigned slice.\n   >S-NSSAI\tSMF\tIdentifier of the slice.\n   >Timestamp\tSMF\tTime stamp associated with the collected information.\n   >Application ID\tSMF\tIdentifier of the application for the UE in the slice.\n   >Transactions\tSMF\tEither all transactions for this UE or, optionally, if subscription with periodic notification is requested, an amount of UE transactions exchanged at the slice in the notified time period.\nUE session behaviour trends\tSMF\tMetrics on UE state transitions (e.g. PDU Session Establishment, PDU Session Release).\n\nThe task of the NWDAF is to calculate the volume of data and amount of transactions dispersed by the UE at each slice during a period of interest. A time stamp of a slice assignment is provided by the AMF.\nThe Correlation Information as defined in table 6.2.4-1 is used to correlate the input data from AMF and SMF, the input data from SMF and UPF, and the input data from UPF and AF.\nData collection may be provided on samples (e.g. spatial subsets of UEs or UE group, temporal subsets of UE location information).\nNOTE\u00a01:\tHow the data from UPF is retrieved is not specified in this release.\nNOTE\u00a02: The list of monitored transactions (MM and SM messages) is a subset of the messages listed in clauses 8.2 and 8.3 of TS\u00a024.501\u00a0[23].\nNOTE\u00a03:\tThe Namf_EventExposure and Nsmf_EventExposure services in clauses 5.2.2.3 and 5.2.8.3 of TS\u00a023.502\u00a0[3] provide the required transactions information.\n\n\n* * * End of Changes * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the AF is located in the trust domain, it may receive requests addressed to an internal group ID. However, the procedures do not support these requests.If the AF is located in the untrust domain and receives a request from NEF addressed to an external group ID, it is not clear whether the NEF can obtain the list of UEs belonging to such group.Procedures for collecting data from the UE Application do not include requests based on groups.\n\n>>> SUMMARY OF CHANGE\nSpecified that if the AF is located in the trust domain it can receive requests addressed to an internal group ID.Clarified that the assumption for an AF located in the untrust domain is to be provisioned with the list of external UE IDs that belong to an external Group ID.Added general support for requests to AF based on internal/external Group ID.An unrelated editorial correction is included in this CR: In clause 6.2.2.1, the indirect collection of data from AMF and SMF via UDM refers to 23.502, but to an incorrect clause 4.15.4.3. The correct 4.15.4.4 clause is added instead.\n\n>>> CONSEQUENCES IF NOT REVISED\nNot possible to for NWDAF to contact a trusted AF with an internal group ID. Also, for untrusted AFs, the spec may give the wrong impression that the AF may obtain the list of UE IDs that belong to a group somehow."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n************************************Begin of change *****************************\n4.2.2\tNetwork application function (NAF)\nAfter the bootstrapping has been completed, the UE and an operator-controlled NAF can run some application specific protocol where the authentication of messages will be based on those session keys generated during the mutual authentication between UE and BSF.\nGeneral assumptions for the functionality of an operator-controlled NAF are:\n-\tthere is no previous security association between the UE and the NAF;\n-\tNAF shall be able to locate and communicate securely with the subscriber's BSF;\n-\tNAF shall be able to acquire a shared key material established between UE and the BSF during the run of the application-specific protocol;\n-\tNAF shall be able to acquire an (application-specific) user security setting from the HSS via the BSF;\n\n-\tNAF shall be able to check lifetime of the shared key material.\n\n************************************End of change *****************************\n\n************************************Begin of change *****************************\n4.5.3\tProcedures using bootstrapped Security Association\nBefore communication between the UE and the NAF can start, the UE and the NAF first have to agree whether to use shared keys obtained by means of the GBA. If the UE does not know whether to use GBA with this NAF, it uses the Initiation of Bootstrapping procedure described in clause\u00a04.5.1.\nOnce the UE and the NAF have established that they want to use GBA then every time the UE wants to interact with an NAF the following steps are executed as depicted in figure 4.4.\nUE starts communication over reference point Ua with the NAF:\n-\tin general, UE and NAF will not yet share the key(s) required to protect the reference point Ua. If they already do (i.e. if a key Ks_NAF for the corresponding key derivation parameter NAF_Id is already available),, the UE and the NAF can start to securely communicate right away. If the UE and the NAF do not yet share a key, the UE proceeds as follows:\n-\tif a key Ks for the selected UICC application is available in the UE, the UE derives the key Ks_NAF from Ks, as specified in clause 4.5.2;\n-\tif no key Ks for the selected UICC application is available in the UE, the UE first agrees on a new key Ks with the BSF over the reference point Ub, and then proceeds to derive Ks_NAF;\nNOTE\u00a01:\tIf it is not desired by the UE to use the same Ks for the selected UICC application to derive more than one Ks_NAF then the UE should agree on a new key Ks with the BSF over the reference point Ub, and then proceed to derive Ks_NAF;\n-\tif the NAF shares a key with the UE, but the NAF requires an update of that key, e.g. because the key\u2019s lifetime has expired , it shall send a suitable bootstrapping renegotiation request to the UE and terminates the protocol used over reference point Ua, see figure 4.5. The form of this indication depends on the particular protocol used over reference point Ua. If the UE receives a bootstrapping renegotiation request, it starts a run of the protocol over reference point Ub, as specified in clause\u00a04.5.2, in order to obtain a new key Ks.\nNOTE\u00a02:\tTo allow for consistent key derivation in BSF and UE, both have to use the same FQDN for derivation (see NOTE\u00a02 of clause\u00a04.5.2). For each protocol used over Ua it shall be specified if only cases (1) and (2) of NOTE\u00a02 of clause\u00a04.5.2 are allowed for the NAF or if the protocol used over Ua shall transfer also the FQDN used for key derivation by UE to NAF.\nNOTE\u00a03:\tIf the shared key between UE and NAF is invalid , the NAF can set deletion conditions to the corresponding security association for subsequent removal.\n-\tthe UE supplies the B-TID to the NAF, in the form as specified in clause\u00a04.3.2, to allow the NAF to retrieve the corresponding keys from the BSF;\nNOTE\u00a04:\tThe UE may adapt the key material Ks_NAF to the specific needs of the reference point Ua. This adaptation is outside the scope of this specification.\n-\twhen the UE is powered down, or when the UICC is removed, any keys Ks and Ks_NAF shall be deleted from storage;\n-\twhen a new Ks is agreed over the reference point Ub and a key Ks_NAF, derived from one NAF_Id, is updated, the other keys Ks_NAF, derived from different values NAF_Id, stored on the UE shall not be affected;\nNAF starts communication over reference point Zn with BSF\n-\tThe NAF requests key material corresponding to the B-TID supplied by the UE to the NAF over reference point Ua. If the NAF has several FQDNs, which may be used in conjunction with this specification, then the NAF shall transfer in the request over Zn the same FQDN, which was used over Ua (see NOTE\u00a02 on key derivation in this clause);\n-\tThe NAF may also request application-specific user security settings for the applications, which the request received over Ua from UE may access;\n-\tWith the key material request, the NAF shall supply NAF\u2019s public hostname that UE has used to access NAF to BSF, and BSF shall be able verify that NAF is authorized to use that hostname;\n-\tThe BSF derives the keys required to protect the protocol used over reference point Ua from the key Ks and the key derivation parameters, as specified in clause 4.5.2, and supplies to NAF the requested key Ks_NAF, as well as the lifetime of that key. If the key identified by the B-TID supplied by the NAF is not available at the BSF, the BSF shall indicate this in the reply to the NAF. The NAF then indicates a bootstrapping renegotiation request to the UE.\nNOTE\u00a05:\tThe NAF shall adapt the key material Ks_NAF to the specific needs of the reference point Ua in the same way as the UE did. This adaptation is outside the scope of this specification.\n-\tThe BSF may also send the private user identity (IMPI) and requested user security settings to NAF according to the BSF's policy;\nNAF continues with the protocol used over the reference point Ua with the UE.\nOnce the run of the protocol used over reference point Ua is completed the purpose of bootstrapping is fulfilled as it enabled UE and NAF to use reference point Ua in a secure way.\n\nFigure 4.4: The bootstrapping usage procedure\n\nFigure 4.5: Bootstrapping renegotiation request\n\n************************************End of change *****************************\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe key leaking out is an potential security threaten during the service, e.g. leakage of key with not well safed local connections in UE, then a frequent stolen service request may happen with a very short time. Application(NAF) should have a mechanism to limit the abnormal using of the shared secret and take action to mitigate it as much as possible.\n\n>>> SUMMARY OF CHANGE\nNAF set the local validity condition of the shared key material. E.g. a limited number of times that TID and key material can be used. When NAF receive the user\u2019s request including the TID, the NAF can check the local validity conditions set by itself to avoid the service stolen.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe NAF miss the important feature that can avoid the some possible attacks"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n************ START OF CHANGE ***********\nB.2.2.1\tPDP context activation and P-CSCF discovery\nPrior to communication with the IM CN subsystem, the UE shall:\na)\tperform a GPRS attach procedure as specified in 3GPP\u00a0TS\u00a024.008\u00a0[8];\nb)\tensure that a PDP context used for SIP signalling according to the APN and GGSN selection criteria described in 3GPP\u00a0TS\u00a023.060\u00a0[4] and 3GPP\u00a0TS\u00a027.060\u00a0[10A] is available. This PDP context shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration. As a result, the PDP context provides the UE with information that makes the UE able to construct an IPv4 or an IPv6 address;\nNOTE\u00a01:\tDuring the PDP context activation procedure, the UE and network negotiate whether the UE or the GPRS IP-CAN is responsible for the resource reservation applicable to all PDP contexts within the activated PDP address/APN pair, as described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\n\tWhen the bearer establishment is controlled by the UE, the UE shall choose one of the following options when performing establishment of this PDP context:\nI.\tA dedicated PDP context for SIP signalling:\n\tThe UE shall indicate to the GGSN that this is a PDP context intended to carry IM CN subsystem-related signalling only by setting the IM CN Subsystem Signalling Flag. The UE may also use this PDP context for DNS and DHCP signalling according to the static packet filters as described in 3GPP\u00a0TS\u00a029.061\u00a0[11]. The UE can also set the Signalling Indication attribute within the QoS information element;\nII.\tA general-purpose PDP context:\n\tThe UE may decide to use a general-purpose PDP Context to carry IM CN subsystem-related signalling. The UE shall indicate to the GGSN that this is a general-purpose PDP context by not setting the IM CN Subsystem Signalling Flag. The UE may carry both signalling and media on the general-purpose PDP context. The UE can also set the Signalling Indication attribute within the QoS information element.\nNOTE\u00a02:\tWhen the bearer establishment is controlled by the GPRS IP-CAN, the GGSN follows the procedures described in 3GPP\u00a0TS\u00a029.061\u00a0[11] in order to establish a dedicated PDP context for SIP signalling. \nThe UE indicates the IM CN Subsystem Signalling Flag to the GGSN within the Protocol Configuration Options information element of the ACTIVATE PDP CONTEXT REQUEST message or ACTIVATE SECONDARY PDP CONTEXT REQUEST message. Upon successful signalling PDP context establishment the UE receives an indication from GGSN in the form of IM CN Subsystem Signalling Flag within the Protocol Configuration Options information element. If the flag is not received, the UE shall consider the PDP context as a general-purpose PDP context.\n\n\n\n\nThe encoding of the IM CN Subsystem Signalling Flag within the Protocol Configuration Options information element is described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\n\tThe UE can indicate a request for prioritised handling over the radio interface by setting the Signalling Indication attribute (see 3GPP\u00a0TS\u00a023.107\u00a0[4A]). The general QoS negotiation mechanism and the encoding of the Signalling Indication attribute within the QoS information element are described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\nNOTE\u00a03:\tA general-purpose PDP Context can carry both IM CN subsystem signalling and media, in case the media does not need to be authorized by Policy and Charging control mechanisms as defined in 3GPP\u00a0TS\u00a029.212\u00a0[13C] and Service Based Local Policy mechanisms defined in 3GPP\u00a0TS\u00a029.207\u00a0[12] and the media stream is not mandated by the P-CSCF to be carried in a separate PDP Context.\nc)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the Dynamic Host Configuration Protocol (DHCP) RFC\u00a02132\u00a0[20F], the DHCPv4 options for SIP servers RFC\u00a03361\u00a0[35A], and RFC\u00a03263\u00a0[27A] as described in subclause\u00a09.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC\u00a03315\u00a0[40], the DHCPv6 options for SIP servers RFC\u00a03319\u00a0[41] and DHCPv6 options for Domain Name Servers (DNS) RFC\u00a03646\u00a0[56C] as described in subclause\u00a09.2.1.\nII.\tTransfer P-CSCF address(es) within the PDP context activation procedure.\n\tThe UE shall indicate the request for a P-CSCF address to the GGSN within the Protocol Configuration Options information element of the ACTIVATE PDP CONTEXT REQUEST message or ACTIVATE SECONDARY PDP CONTEXT REQUEST message.\n\tIf the GGSN provides the UE with a list of P-CSCF IPv4 or IPv6 addresses in the ACTIVATE PDP CONTEXT ACCEPT message or ACTIVATE SECONDARY PDP CONTEXT ACCEPT message, the UE shall assume that the list is prioritised with the first address within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nIII.\tThe UE selects a P-CSCF from the list (see 3GPP\u00a0TS\u00a031.103\u00a0[15B]) stored in the ISIM.\nIV.\tThe UE selects a P-CSCF from the list in IMS management object.\n\tThe UE shall use method IV to select a P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming; and\n-\tthe IMS management object contains the P-CSCF list.\n\tThe UE shall use method III to select the P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming;\n-\teither the UE does not contain the IMS management object, or the UE contains the IMS management object, but the IMS management object does not contain the P-CSCF list; and\n-\tthe ISIM residing in the UICC supports the P-CSCF list.\n\tThe UE can freely select method I or II for P-CSCF discovery, if:\n-\tthe UE is in the home network; or \n-\tthe UE is roaming and the P-CSCF is to be discovered in the visited network .\n\tIn case method I is selected and several P-CSCF addresses or FQDNs are provided to the UE, the selection of P-CSCF address or FQDN shall be performed as indicated in RFC\u00a03361\u00a0[35A] when using IPv4 or RFC\u00a03319\u00a0[41] when using IPv6. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nNOTE\u00a04:\tThe UE decides whether the P-CSCF is to be discovered in the serving network or in the home network based on local configuration, e.g. whether the application on the UE is permitted to use local breakout.\n\tIf the UE is designed to use I above, but receives P-CSCF address(es) according to II, then the UE shall either ignore the received address(es), or use the address(es) in accordance with II, and not proceed with the DHCP request according to I.\n\tWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC\u00a02132\u00a0[20F] or by the Protocol Configuration Options information element when activating a PDP context according to 3GPP\u00a0TS\u00a027.060\u00a0[10A].\n\tWhen using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC\u00a03315\u00a0[40] and RFC\u00a03646\u00a0[56C] or by the Protocol Configuration Options information element when activating a PDP context according to 3GPP\u00a0TS\u00a027.060\u00a0[10A].\n\tThe encoding of the request and response for IPv4 or IPv6 address(es) for DNS server(s) and list of P-CSCF address(es) within the Protocol Configuration Options information element is described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\n************ NEXT CHANGE ***********\nB.2.2.1B\tRe-establishment of the PDP context for SIP signalling\nIf the dedicated PDP context for SIP signalling is lost due to e.g. a GPRS routeing area update procedure and the bearer establishment is controlled by the UE, the UE shall attempt to re-establish the dedicated PDP context for SIP signalling\n\n \nIf this procedure does not succeed, the UE shall deactivate all PDP contexts established as a result of SIP signalling according to the 3GPP\u00a0TS\u00a024.008\u00a0[8].\n\n\n\n\n************ NEXT CHANGE ***********\nL.2.2.1\tEPS bearer context activation and P-CSCF discovery\nPrior to communication with the IM CN subsystem, the UE shall:\na)\tperform a EPS attach procedure as specified in 3GPP\u00a0TS\u00a024.301\u00a0[8J];\nb)\tensure that a EPS bearer context used for SIP signalling according to the APN and P-GW selection criteria described in 3GPP\u00a0TS\u00a023.401\u00a0[7B], is available. This EPS bearer context shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration. As a result, the EPS bearer context provides the UE with information that makes the UE able to construct an IPv4 or an IPv6 address;\nNOTE\u00a03:\tThe default EPS bearer context can also be used for SIP signalling as well as any other EPS bearer context.\n\tWhen the EPS bearer context establishment procedure for the SIP signalling is initiated by the UE:\nI.\tif a default EPS bearer context is not available with the selected P-GW, the UE shall indicate to the network in the PDN CONNECTIVITY REQUEST that the request is for SIP signalling. If the request is authorized, the network establishes a bearer with the appropriate QCI as described in 3GPP\u00a0TS\u00a024.301\u00a0[8J]. The UE may also use this EPS bearer context for DNS and DHCP signalling;\nII.\tif the default EPS bearer context is available with the selected P-GW, and is to be used for SIP signalling no additional steps are needed;\nIII.\tif the default EPS bearer context is available with the selected P-GW and an EPS bearer for SIP signalling with the correct QCI and TFT is to be established, the UE shall indicate to the network, by setting the IM CN Subsystem Signalling Flag in the Protocol Configuration Options information element in the BEARER RESOURCE ALLOCATION REQUEST message, that the request is for SIP signalling. If the request is authorized, the network either establishes a new dedicated bearer or modifies an exisiting bearer with the appropriate QCI and TFT as described in 3GPP\u00a0TS\u00a024.301\u00a0[8J]. The general QoS negotiation mechanism is described in 3GPP\u00a0TS\u00a024.301\u00a0[8J].\nNOTE\u00a02:\tAn EPS bearer with a QCI value other than the one for signalling can carry both IM CN subsystem signalling and media, in case the media does not need to be authorized by Policy and Charging control mechanisms as defined in 3GPP\u00a0TS\u00a029.212\u00a0[13B] and the media stream is not mandated by the P-CSCF to be carried in a separate EPS bearer.\n\n\n\n\n\nc)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the Dynamic Host Configuration Protocol (DHCP) RFC\u00a02132\u00a0[20F], the DHCPv4 options for SIP servers RFC\u00a03361\u00a0[35A], and RFC\u00a03263\u00a0[27A] as described in subclause\u00a09.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC\u00a03315\u00a0[40], the DHCPv6 options for SIP servers RFC\u00a03319\u00a0[41] and DHCPv6 options for Domain Name Servers (DNS) RFC\u00a03646\u00a0[56C] as described in subclause\u00a09.2.1.\nII.\tTransfer P-CSCF address(es) within the EPS bearer context activation procedure.\n\tThe UE shall indicate the request for a P-CSCF address to the network within the Protocol Configuration Options information element of the PDN CONNECTIVITY REQUEST message or BEARER RESOURCE ALLOCATION REQUEST message.\n\tIf the network provides the UE with a list of P-CSCF IPv4 or IPv6 addresses in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall assume that the list is prioritised with the first address within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nIII.\tThe UE selects a P-CSCF from the list  (see 3GPP\u00a0TS\u00a031.103\u00a0[15B]) stored in the ISIM.\nIV.\tThe UE selects a P-CSCF from the list in IMS management object.\nThe UE shall use method IV to select a P-CSCF, if\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming; and\n-\tthe IMS management object contains the P-CSCF list.\nThe UE shall use method III to select the P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming;\n-\teither the UE does not contain the IMS management object, or the UE contains the IMS management object but the IMS management object does not contain the P-CSCF list; and\n-\tthe ISIM residing in the UICC supports the P-CSCF list.\nThe UE can freely select method I or II for P-CSCF discovery, if:\n-\tthe UE is in the home network; or \n-\tthe UE is roaming and the P-CSCF is to be discovered in the visited network.\nIn case method I is selected and several P-CSCF addresses or FQDNs are provided to the UE, the selection of P-CSCF address or FQDN shall be performed as indicated in RFC\u00a03361\u00a0[35A] when using IPv4 or RFC\u00a03319\u00a0[41] when using IPv6. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nNOTE\u00a03:\tThe UE decides whether the P-CSCF is to be discovered in the serving network or in the home network based on local configuration, e.g. whether the application on the UE is permitted to use local breakout.\nIf the UE is designed to use I above, but receives P-CSCF address(es) according to II, then the UE shall either ignore the received address(es), or use the address(es) in accordance with II, and not proceed with the DHCP request according to I.\nWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC\u00a02132\u00a0[20F] or by the Protocol Configuration Options information element when activating a EPS bearer context according to 3GPP\u00a0TS\u00a024.301\u00a0[8J].\nWhen using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC\u00a03315\u00a0[40] and RFC\u00a03646\u00a0[56C] or by the Protocol Configuration Options information element when activating a EPS bearer context according to 3GPP\u00a0TS\u00a024.301\u00a0[8J].\nThe encoding of the request and response for IPv4 or IPv6 address(es) for DNS server(s) and list of P-CSCF address(es) within the Protocol Configuration Options information element is described in 3GPP\u00a0TS\u00a024.301\u00a0[8J].\n************ NEXT CHANGE ***********\nL.2.2.1B\tRe-establishment of the EPS bearer context for SIP signalling\nIf the EPS bearer context for SIP signalling is lost and cannot be re-established:\n-\t\nif the SIP signalling was carried over a dedicated EPS bearer, the UE shall release all resources established as a result of SIP signalling by sending to the network either:\n-\ta BEARER RESOURCE MODIFICATION REQUEST message, if there are EPS bearers to this PDN that are not related SIP sessions; or\n-\ta PDN DISCONNECT REQUEST message if all the bearers to this PDN are related to SIP sessions.\nNOTE:\tIf the SIP signalling was carried over the default EPS bearer, all the resources established as a result of SIP signalling are released without any explicit NAS signalling.\n\n\n\n\n\n************ END OF CHANGE ***********\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn a scenario described below, as informed by GSMA IREG RILTE, the UE can continuously attempt to establish PDN connectivity (PDP context, EPS bearer) for IMS connectivity.A UE with a PDN connection (which also means PDP context hereafter) used for SIP signalling (i.e. to the IMS APN) and a PDN connection for Internet service moves from LTE to 2G/3G, where IMS Voice over PS is not supported.IR.92 profiled IMS voice over PS is the only application using the IMS APN in this UEThe PDN connection used for SIP signalling is torn down by network while the UE moves to 2G/3G because the network is not able to maintain multiple PDN connections.According to section B.2.2.1B in TS 24.229, the UE shall attempt to re-establish the PDN connection used for SIP signalling. There are following potential problems in this circumstance, and solution is required.the re-established PDN connection used for SIP signalling unnecessarily consumes network resources since IMS Voice over PS is not supported and thus the UE is unable to setup or receive any IMS voice sessions.the UE's attempt(s) to re-establish the PDN connection used for SIP signalling causes an increased amount of signalling (and thus potential congestion) when the network cannot support the PDN connection used for SIP signalling  on top of the PDN connection for Internet.Solutions being discussed in Pre-Rel-11 (C1-121158) rely on IMSVoPS Indicator and the rejection of MO request to establish PDN connectivity for voice.  However further enhancement should be in order to avoid UE (may be equipped with other IMS apps) attempting to establish the PDN connection based on whether the network can support IMS SIP signalling bearer.\n\n>>> SUMMARY OF CHANGE\nIt is corrected that:1. UE shall not attempt to establish PDN connectivity for IMS SIP signalling if the request is rejected by ESM Cause #322. If the only application on the UE is IMS Voice and SMS (as profiled in GSMA IR.92), and, if NW already indicated that IMS Voice over PS (IMSVoPS) is NOT supported, then the UE shall not send attempt at all, as long as the IMSVoPS indicator changes.It is enhanced that:1. NW can indicate that whether the network supports IMS SIP signalling bearer during Attach/TAU.2. UE, if indicated IMS is not supported, shall not attempt to establish PDN connectivity for SIP signalling.\n\n>>> CONSEQUENCES IF NOT REVISED\n-the re-established PDN connection used for SIP signalling unnecessarily consumes network resources since IMS Voice over PS is not supported and thus the UE is unable to setup or receive any IMS voice sessions.- the UE's attempt(s) to re-establish the PDN connection used for SIP signalling causes an increased amount of signalling (and thus potential congestion) when the network cannot support the PDN connection used for SIP signalling on top of the PDN connection for Internet.- extra signalling would still be needed in order to address abovementioned problems"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n4.7.4.2.2\tNetwork initiated GPRS detach procedure completion by the MS\nWhen receiving the DETACH REQUEST message and the detach type indicates \"re-attach required\", the MS shall deactivate the PDP context(s), the MBMS context(s) and deactivate the logical link(s), if any. The MS shall stop the timer T3346, if it is running. The MS shall also stop timer(s) T3396, if it is running. The MS shall send a DETACH ACCEPT message to the network and shall enter the state GMM-DEREGISTERED. The MS shall, after the completion of the GPRS detach procedure, initiate a GPRS attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\nNOTE\u00a01:\tWhen the detach type indicates \"re-attach required\", user interaction is necessary in some cases when the MS cannot re-activate the PDP/MBMS context(s) automatically.\nA GPRS MS operating in MS operation mode A or B in network operation mode I, which receives an DETACH REQUEST message with detach type indicating \"re-attach required\" or \"re-attach not required\" and no cause code, is only detached for GPRS services in the network.\nWhen receiving the DETACH REQUEST message and the detach type IE indicates \"IMSI detach\", the MS shall not deactivate the PDP/MBMS contexts. The MS shall set the MM update status to U2 NOT UPDATED. An MS in operation mode A or B in network operation mode I may send a DETACH ACCEPT message to the network, and shall re-attach to non-GPRS service by performing the combined routing area updating procedure according to subclause\u00a04.7.5.2, sending a ROUTING AREA UPDATE REQUEST message with Update type IE indicating \"combined RA/LA updating with IMSI attach\". An MS in operation mode A that is in an ongoing circuit-switched transaction shall initiate the combined routing area updating after the circuit-switched transaction has been released. An MS in operation mode C, or in MS operation mode A or B in network operation mode II, shall send a DETACH ACCEPT message to the network.\nIf the detach type IE indicates \"IMSI detach\", or \"re-attach required\" then the MS shall ignore the cause code if received.\nIf the MS is attached for GPRS and non-GPRS services and the network operates in network operation mode I, then if in the MS the timer T3212 is not already running, the timer T3212 shall be set to its initial value and restarted if:\n-\tthe detach type IE indicates \"re-attach required\";\n-\tthe detach type IE indicates \"re-attach not required\" and no cause code is included; or\n-\tthe detach type IE indicates \"re-attach not required\" and the cause code is #7 \"GPRS services not allowed\" or #14 \"GPRS services not allowed in this PLMN\".\nWhen receiving the DETACH REQUEST message and the detach type IE indicates \"re-attach not required\" and no cause code, or \"re-attach not required\" and the cause code is not #2 \"IMSI unknown in HLR\", the MS shall deactivate the PDP contexts, the MBMS contexts and deactivate the logical link(s), if any. The MS shall then send a DETACH ACCEPT message to the network and shall change state to GMM-DEREGISTERED.\nIf the detach type IE indicates \"re-attach not required\", then, depending on the received cause code, the MS shall act as follows:\n# 2\t\t(IMSI unknown in HLR);\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. The SIM/USIM shall be considered as invalid for non-GPRS services until switching off or the SIM/USIM is removed.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is still IMSI attached for GPRS services in the network.\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed.\n\tA GPRS MS operating in MS operation mode A or B shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed. \n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\nNOTE\u00a02:\tThe possibility to configure an MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is still IMSI attached for CS services in the network.\n\nNOTE\u00a03:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\nNOTE\u00a04:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI or LAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall reset the GPRS attach attempt counter. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tA GPRS MS operating in MS operation mode A or B shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS\u00a044.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED. \nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nA GPRS MS operating in MS operation mode A or B, is still IMSI attached for CS services in the network.\n\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n# 15\t(No Suitable Cells In Location Area);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a06:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n\t# 25\t(Not authorized for this CSG)\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the cell where the MS has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list stored in the MS, the MS shall remove the CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the cell where the MS has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\nNOTE\u00a07:\tCSG is applicable only for UMTS.\nOther cause values shall not impact the update status. Further actions of the MS are implementation dependent.\n\n************************ NEXT MODIFIED SECTION ***********************\n4.7.5.1.4\tNormal and periodic routing area updating procedure not accepted by the network\nIf the routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS, which receives a ROUTING AREA UPDATE REJECT message with a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.\nIf the ROUTING AREA UPDATE REJECT message containing GMM cause value cause #25 was received without integrity protection, then the MS shall discard the message.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take different actions depending on the received reject cause value:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\n\tIf the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a01:\tThe possibility to configure a MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\n\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I is still IMSI attached for CS services in the network, and shall set the timer T3212 to its initial value and restart it, if it is not already running. The MS shall then proceed with the appropriate MM specific procedure according to the MM service state.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs, and shall enter the GMM state GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\nNOTE\u00a03:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area procedure is rejected with the EMM cause with the same value.\n# 9\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may subsequently , automatically initiate the GPRS attach procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.\n\tThe MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a04:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter, shall delete the list of equivalent PLMNs, and enter the state GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS\u00a044.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection.\n\nIf the update type is \"periodic updating\" a GPRS MS operating in MS operation mode A or B in network operation mode I shall set the timer T3212 to its initial value and restart it, if it is not already running.\nA GPRS MS operating in MS operation mode A or B in network operation mode II, is still IMSI attached for CS services in the network.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:\n-\tThe MS may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a06:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.1.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shallchange to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.1.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.1.5.\n\n************************ NEXT MODIFIED SECTION ***********************\n4.7.5.2.4\tCombined routing area updating not accepted by the network\nIf the combined routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS that receives a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330, and shall enter the state MM IDLE. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.\nIf the ROUTING AREA UPDATE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take different actions depending on the received reject cause:\n# 3\t\t\t(Illegal MS);\n# 6\t\t\t(Illegal ME), or\n# 8\t\t\t(GPRS services and non GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS and non GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9 for reject cause #8.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED. If in the MS the timer T3212 is not already running, the timer shall be set to its initial value and restarted.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services, is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP TS 24.301 [120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services , the MS may subsequently, automatically initiate the GPRS attach procedure.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.\n\tThe MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a03:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP/MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, the MS shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number GPRS ciphering key sequence number, shall delete the list of equivalent PLMNs, and shall reset the routing area updating attempt counter and the location update attempt counter.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall then perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\nThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure following the PLMN selection.\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED. If in the MS the timer T3212 is not already running, the timer shall be set to its initial value and restarted.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services, is still IMSI attached for CS services in the network.\nA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall search for a suitable cell in another location area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.2.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the ME shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.2.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.2.5.\n\n************************ NEXT MODIFIED SECTION ***********************\n4.7.13.4\tService request procedure not accepted by the network\nIf the Service request cannot be accepted, the network returns a SERVICE REJECT message to the mobile station.\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nAn MS that receives a SERVICE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall reset the service request attempt counter, shall stop the timer T3317.\nIf the SERVICE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.\nThe MS shall then take different actions depending on the received reject cause value:\n# 3\t\t\t(Illegal MS); or\n# 6\t\t\t(Illegal ME);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed.\n-\tA GPRS MS operating in MS operation mode A shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. \n\tA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services is still IMSI attached for CS services in the network, and shall set the timer T3212 to its initial value and restart it, if it is not already running.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n-\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may subsequently, automatically initiate the GPRS attach procedure. \n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\n-\tThe MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the the service request procedure is rejected with the EMM cause with the same value.\nNOTE\u00a03:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED.\n-\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tA GPRS MS operating in MS operation mode A shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n-\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP TS\u00a043.022\u00a0[82] and 3GPP TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.13.5.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall abort the service request procedure and enter state GMM-REGISTERED, and stop timer T3317 if still running.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the SERVICE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the SERVICE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n-\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.13.5.\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\t If the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n-\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n-\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n-\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 40\t(No PDP context activated)\n-\tThe MS shall deactivate locally all active PDP and MBMS contexts and the MS shall enter the state GMM-REGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS may also perform the procedures needed in order to activate any previously active multicast service(s).\nNOTE\u00a06:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.13.5.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) If the MS receives a Detach Request with GMM cause #7 \"GPRS services not allowed\" or #14 \"GPRS services not allowed in this PLMN\", then an MS in MS operation mode A or B in a network operating in NMO I needs to restart the periodic location update timer. This requirement is currently missing. It is proposed that to this purpose the MS shall set the update status to U2 NOT UPDATED so that the MS initiates a location update procedure and the start of the location update timer in the MS and the implicit detach timer in the VLR is synchronized.(Note: for the alternative approach that upon receipt of the Detach Request with GMM cause #7 or #14 the MS shall just start the location update timer, it cannot be guaranteed that the the location update timer and the implicit detach timer are always started in a synchronized way:TS 23.060, subclause 6.6.2.2, HLR-initiated detach procedure, is showing a message flow where the SGSN is sending the Detach Request to the MS and the GPRS Detach Indication to the MSC/VLR within a short time interval. I.e. in this specific example, the 2 timers are started in a synchronized way. But let us assume that for some reason (e.g. MS is 'out-of-coverage') the Detach Request (including all retransmissions) cannot be received by the MS. According to the message flow in 6.6.2.2, the SGSN will send the GPRS Detach Indication to the MSC/VLR before receiving the Detach Accept from the MS. So the implicit detach timer in the VLR will be started in any case. If we are in A/Gb mode and some time later the MS, which in the mean-time has returned to coverage, initiates a session management procedure, the SGSN could then respond with a Detach Request with GMM cause #7 or #14, respectively. In that case the periodic location update timer would be started by the MS some time after the implicit detach timer, and the MS could become unreachable for MT CS services when the implicit detach timer expires.)2) For GMM causes #7 \"GPRS services not allowed\" and #14 \"GPRS services not allowed in this PLMN\", the statement: \"A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\"is correct, independent of the network mode of operation or the udpate type. So the unnecessary conditions were removed in various procedures.3) Currently, for the normal/periodic RAU, combined RAU and service request procedure it is specified that upon receipt of GMM cause #7 or #14 an MS in MS operation mode A or B in a network operating in NMO I shall restart the periodic location update timer if it is not already running. \u2013 As explained under item 1), it cannot be guaranteed that with this mechanism the location update timer in the MS and the implicit detach timer in the VLR are started in a synchronized way. It is therefore proposed that the MS shall set the update status to U2 NOT UPDATED so that the MS initiates a location update procedure. In 4.7.5.1.4 (normal and periodic RAU), this MS requirement should be independent of the update type, as for an MS in operation mode A which has an ongoing CS call the failure case could also occur during normal RAU.4) In the unsuccessful cases for the service request procedure, upon receipt auf GMM cause #3, #6 or #8, the USIM should be deactivated for non-GPRS services not only for an MS in operation mode A, but also for an MS in operation mode B.5) Further it is clarified that upon receipt of a Service Reject with GMM cause #10 \"implicitly detached\", if the MS is operating in MS operation mode A or B in a network is operating in NMO I, then the MS is detached for GPRS and non-GPRS services. (The MS has to assume the worst case that the SGSN performed an implicit detach for non-GPRS services via the Gs interface.)\n\n>>> SUMMARY OF CHANGE\n1) Upon receipt of a Detach Request with GMM cause #7 or #14, a GPRS MS operating in MS operation mode A or B in network operation mode I shall set the update status to U2 NOT UPDATED (in order to initiate a location update).2) Unnecessary conditions are removed.3) Upon receipt of a RAU Reject or Service Reject with GMM cause #7 or #14, a GPRS MS operating in MS operation mode A or B in network operation mode I shall set the update status to U2 NOT UPDATED (in order to initiate a location update).4) Upon receipt of a Service Reject with GMM cause #3, #6, or #8, an MS in operation mode B shall follow the requirements already specified for an MS in operation mode A.5) Clarification added that upon receipt of a Service Reject with GMM cause #10 \"implicitly detached\", an MS operating in MS operation mode A or B in a network operating in NMO I is detached for GPRS and non-GPRS services.\n\n>>> CONSEQUENCES IF NOT REVISED\n1+3) There is a risk that the MS does not start the periodic location update timer (1) or that it starts the timer a long time after the VLR started the corresponding implicit detach timer (1+3). If the implicit detach timer expires before the periodic location update timer, then the VLR stops paging the MS and the MS becomes unreachable for MT CS services.4) If the MS in operation mode B does not deactivate the SIM for non-GPRS services, it can still attempt to access the CS domain and thus create unnecessary signalling load.5) There is a minor risk that in some corner cases where the subsequent attach procedure is not successful, the MS does not perform a location update procedure and remains marked as 'detached' in the VLR."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**************** 1st change *****************\n8\tMS/UE Functionality\n\nOnly GSM [The MS is responsible for recombination of the blocks received via the radio path to reconstitute the CBS message.]\nThe precise method of display of CBS messages is outside the scope of GSM Specifications, however it is assumed that an MS/UE will:\nMS\tUE\n\tdiscard sequences transferred via the radio path (see 3GPP\u00a0TS\u00a044.012\u00a0[7]) which do not consist of consecutive blocks;\tDiscard corrupt CBS messages received on the radio interface\nhave the ability to discard CBS information which is not in a suitable data coding scheme;\nHave the ability to discard a CBS message which has a message identifier indicating that it is of subject matter which is not of interest to the MS;\nHave the ability to ignore repeat primary warning notifications and repeat broadcasts of CBS messages already received (message has not changed since it was last broadcast e.g. sequence number has not changed within the message's indicated geographical area), and also if the MS/UE changes its radio access (e.g. from UTRAN to GERAN) and receives the same information;\tWith regard to duplication detection, primary warning notifications and CBS messages are treated separately, even if the duplication detection is based on the same parameters (e.g. the combination of message identifier and sequence number)\nhave the ability to transfer a CBS message to an external device, when supported ;\n\toptionally enter CBS DRX mode based upon received Schedule Messages (see 3GPP\u00a0TS\u00a044.012 [7]);\tEnter CBS DRX mode based upon received Schedule Messages (see 3GPP\u00a0TS\u00a025.324\u00a0[19])\n\toptionally skip reception of the remaining block(s) of a CBS message which do(es) not contain cell broadcast information (see 3GPP\u00a0TS\u00a044.012 [7]);\tnot applicable\nOptionally read the extended channel\tNot applicable for UMTS.\nenable the user to activate/deactivate CBS through MMI\nEnable the user to maintain a \"search list\" and receive CBS messages with a Message Identifier in the list while discarding CBS messages with a Message Identifier not in the list\nallow the user to enter the Message Identifier via MMI only for the 1 000 lowest codes \nbe capable of receiving CBS messages consisting of up to 15 pages\nWhen emergency indication is included in the received paging and/or CBS message, behave as specified in 3GPP\u00a0TS\u00a022.268\u00a0[28];\tIf the emergency indication includes the value for \u201ctest\u201d, mobile terminals which are not used for testing purpose silently discard the paging message and do not receive the corresponding CBS message.\n\n\n\n\n\n\n\n\n\n**************** 2nd change *****************\n\n9.1.2\tUMTS Radio Access Network\nCommands interpreted by the RNC will result in one SMS BROADCAST COMMAND sent to the UE. The CBS messages are completely transparent to the Node B, i.e. no manipulation of the data like e.g. fragmentation is done at the Node B.\n\nFigure 4a\nAlternatively, when emergency messages (e.g ETWS message etc.) are to be sent, the following message flow applies. In this case, the paging message with a new emergency indication can invoke mobile terminals to start receiving CBS messages without MMI. Mobile stations invoked to start receiving CBS messages this way may stop receiving CBS messages (without MMI) after a period of time, which should not be less than 30 minutes in case DRX-Level-2 is used, and 2 minutes in case DRX-Level-1 is used.\n\nFigure 4b\n0.\tDevice Management is used to configure the UE with a list of PLMNs that wish the UE to accept ETWS warnings over paging message. By default, the list in the UE shall be empty (i.e. the default setting shall be that security is needed for all PLMNs).\n1.\tNetwork registration and security (e.g. mutual authentication) procedures are performed. The UE stores a flag that indicates whether or not it has authenticated the network.\nNOTE\u00a01:\tThis step is performed each time a UE is attached to a network (e.g. after each power-on).\n2.\tCBE (e.g. Information Source such as PSAP or Regulator) sends emergency information (\"warning type\", \"warning message\", \"impacted area\", and \"time period\") to the CBC. The CBC shall authenticate this request. The \"warning type\" takes one of the following values: earthquake, tsunami, earthquake and tsunami, test, or other. \nNOTE\u00a02:\tThe interface between CBE and CBC is outside the scope of 3GPP.\n3.\tUsing the \"impacted area information\", the CBC identifies which RNCs need to be contacted and constructs the \"Service Area ID list\" for the cells in which the information is to be broadcast. \n\tThe CBC shall send a WRITE-REPLACE message to all the identified RNCs. The message shall include an \"emergency indication\" to differentiate it from normal Cell Broadcast information, as well as the \"Service Area ID list\", \"warning type\", \"warning message\".\nNOTE\u00a03:\tDue to requirements in earlier versions of this document, it is possible for \"digital signature\" and \"timestamp\" information to be transmitted within \"warning message\".\n4.\tThe RNCs use the \"Service Area ID list\" information to identify which NodeBs they need to reach, and then, they relay information to them using the appropriate Iub interface message.\n5.\tThe NodeB receives the Iub message containing the emergency indication. As parallel actions, the RNC/NodeB:\na)\tshall start to broadcast the \"warning message\". This is broadcast by using a Cell Broadcast channel and modified System Information messages. This broadcast information is repeated continuously by the NodeB for the \"time period\" requested by the CBE. \nb)\tshall use paging messages in every paging group to alert idle mode mobiles to receive the broadcast warning message. Typically these paging messages are repeated in all paging groups for several DRX periods. The paging message contains the \"ETWS indication\" based on the \"warning type\" information. When the \"warning type\" is set to 'other', all of the warning information is included in the broadcast \"warning message\".\nc)\tmay send the \"ETWS indication\" in other messages (System Information Change Indication or ETWS Primary Notification With Security) in order to reach mobiles in connected mode. Inclusion of \"ETWS indication\" is the same as that of the paging message mentioned above.\n6.\tThe UE alerts the user immediately, using \"warning type\" value upon the reception of the \"ETWS Indication\", if the UE has been configured to receive ETWS warnings on that PLMN and the UE has authenticated the core network of the NodeB it is camped on.\nNOTE\u00a04:\tIf the UE received the \"ETWS Indication\" more than once it will silently discard the optional primary notification.\nNOTE\u00a05:\tWhen the \"warning type\" is 'test', the UE silently discards the \"ETWS Indication\"  and does not perform the reception of the broadcast message described below. However, the UE specially designed for testing purposes may perform user alerting described above and proceed to the reception of the broadcast message described below\nNOTE\u00a06:\tIf the UE has not authenticated the core network of the NodeB it is camped on, the UE does not perform the reception of the broadcast message described below.\n\tUpon the reception of the\"ETWS Indication\", the UE activates the reception of the broadcast messages containing the \"warning message\" as the secondary notification. The UE indicates the contents of the \"warning message\" to the user.\n\tThe UE shall consider a message duplicated if the combination of \"message identifier\" and \"serial number\" matches that of the previous message received from the same PLMN. The UE shall ignore messages detected as duplicated. Duplicate message detection shall be performed independently for primary and secondary notifications.\n\tThe UE shall ignore the values of \"digital signature\" and \"timestamp\" if received.\nNOTE\u00a07:\tThe \"digital signature\" and \"timestamp\" can be received due to requirements in earlier versions of this document.\n7.\tThe RNC node sends a BMC REPORT-SUCCESS to the CBC in response to Write-Replace.\n8.\tCBC sends acknowledgement message to CBE.\n**************** 3rd change *****************\n9.4.1.2.1\tSerial Number\nThis parameter is a 16-bit integer which identifies a particular CBS message (which may be one to fifteen\u00a0pages in length) from the source and type indicated by the Message Identifier and is altered every time the CBS message with a given Message Identifier is changed.\nThe two octets of the Serial Number field are divided into a 2-bit Geographical Scope (GS) indicator, a 10bit Message Code and a 4-bit Update Number as shown below:\nOctet 1\tOctet 2\n7\t6\t5\t4\t3\t2\t1\t0\t7\t6\t5\t4\t3\t2\t1\t0\nGS\t\tMessage Code\tUpdate Number\n\nThe most significant bit of the update number is octet 2 bit 3. The most significant bit of the Message Code is octet 1 bit 5 and the least significant bit of the Message Code is octet 2 bit 4. The most significant bit of the Geographical Scope is octet 1 bit 7.\nMessage Code:\nThe Message Code differentiates between CBS messages from the same source and type (i.e. with the same Message Identifier). Message Codes are for allocation by PLMN operators.\n\tThe Message Code identifies different message themes. For example, let the value for the Message Identifier be \"Automotive Association\" (= source), \"Traffic Reports\" (= type). Then \"Crash on A1 J5\" could be one value for the message code, \"Cow on A32 J4\" could be another, and \"Slow vehicle on M3 J3\" yet another.\n\tIn the case of transmitting CBS messages for ETWS, i.e. the Message Identifier has a value for ETWS (see subclause\u00a09.4.1.2.2), a part of Message Code can be used to command mobile terminals to activate emergency user alert and message popup in order to alert the users. Message Code format for this purpose is as follows:\n5\t4\t3\t2\t1\t0\t7\t6\t5\t4\nEmergency User Alert\tPopup\n\nNOTE\u00a01:\tThe exact behaviour of the UE is specified in 3GPP\u00a0TS\u00a022.268\u00a0[28]. Whether the UE setting is overridden is subject to regulatory requirements.\nNOTE\u00a02:\tEmergency user alert includes alerting tone and other user alerting means such as vibration, according to the UE\u2019s capability. The types of alert (e.g. the kind of tone, vibration, etc) are implementation\u3000dependent and may be subject to regulatory requirements.\nNOTE\u00a03:\tThe popup indication shall take precedence over the setting of the DCS Message class (see 3GPP\u00a0TS\u00a023.038\u00a0[3]), and the Geographical Scope with regard to Display Mode 'immediate'.\n\tThe codings of the Emergency User Alert and Popup fields are shown below:\nField\tCode\tInstruction to Terminal\nEmergency User Alert\t0\tNo instruction as to emergency user alert.\n\t1\tActivate emergency user alert.\nPopup\t0\tNo instruction as to popup.\n\t1\tActivate popup on the display.\n\nGeographical Scope:\n\tThe Geographical Scope (GS) indicates the geographical area over which the Message Code is unique, and the display mode. The CBS message is not necessarily broadcast by all cells within the geographical area. When two CBS messages are received with identical Serial Numbers/Message Identifiers in two different cells, the Geographical Scope may be used to determine if the CBS messages are indeed identical.\n\tIn particular, the Geographical Scope tells the mobile if the CBS message is:\n-\tonly cell wide (which means that if a message is displayed it is desirable that the message is removed from the screen when the UE selects the next cell and if any CBS message is received in the next cell it is to be regarded as \"new\"), or \n-\tPLMN wide (which means that the Message Code and/or Update Number must change in the next cell, of the PLMN, for the CBS message to be \"new\". The CBS message is only relevant to the PLMN in which it is broadcast, so any change of PLMN (including a change to another PLMN which is an ePLMN) means the CBS message is \"new\"), or\n-\tLocation Area wide (in GSM) (which means that a CBS message with the same Message Code and Update Number may or may not be \"new\" in the next cell according to whether the next cell is in the same Location Area as the current cell), or\n-\tService Area wide (in UMTS) (which means that a CBS message with the same Message Code and Update Number may or may not be \"new\" in the next cell according to whether the next cell is in the same Service Area as the current cell), or\nNOTE\u00a04:\tAccording to 3GPP\u00a0TS\u00a023.003\u00a0[2] a Service Area consists of one cell only.\n-\tTracking Area wide (in E-UTRAN) (which means that a warning message with the same Message Code and Update Number may but need not be \"new\" in the next cell according to whether the next cell is in the same Tracking Area as the current cell).\n\tThe display mode indicates whether the CBS message is supposed to be on the display all the time (\"immediate\") or only when the user wants to see it (\"normal\"). In either case, the CBS message will be displayed only if its Message Identifier is contained within the \"search list\" of the mobile (see subclause\u00a09.3.2). These display modes are indicative of intended use, without indicating a mandatory requirement or constraining the detailed implementation by mobile manufacturers. The user may be able to select activation of these different modes.\nThe coding of the Geographical Scope field is shown below:\nGS Code\tDisplay Mode\tGeographical Scope\n00\tImmediate\tCell wide\n01\tNormal\tPLMN wide\n10\tNormal\tLocation Area wide in GSM,\nService Area wide in UMTS, Tracking Area wide in E-UTRAN\n11\tNormal\tCell wide\n\nImmediate = default direct display.\nNormal = default display under user interaction.\nCode 00 is intended for use by the network operators for base station IDs but this code can also be used for other applications. Use of GS=00 takes precedence over the setting of the DCS Message class (see 3GPP\u00a0TS\u00a023.038\u00a0[3])\nUpdate Number:\n\tThe Update Number indicates a change of the message content of the same CBS message, i.e. the CBS message with the same Message Identifier, Geographical Scope, and Message Code.\n\tIn other words, the Update Number will differentiate between older and newer versions of the same CBS message, within the indicated geographical area. A new CBS message may have Update Number 0000; however this number will increment by 1 for each update. \n\tAny Update Number eight or less higher (modulo 16) than the last received Update Number will be considered more recent, and shall be treated as an updated CBS message, provided the mobile has not been switched off.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current ETWS/PWS specification, the duplication detection is performed using Message ID and Message Code. This duplicate detection mechanism was initially designed for local CBS, and it does not work reliably in PWS that is network-wide service.A problem was found such that UE falsely discards the warning message.  This happens if the UE receive same Message ID and Serial Number when UE receives Message Code part of Serial Number wraps-around.  Such event can happen when 255 messages happens outside the area the UE is camped on after receiving a warning message and then the UE receives the 256th message.  Another example of such event includes UE roams to different PLMN and 255 messages happen in the home PLMN after the UE is camped on after receiving a warning message.In order to avoid false discarding of the message, a solution is required to make sure UE can receive a new message after some time period.The corresponding discussion paper is created in C1-120129.\n\n>>> SUMMARY OF CHANGE\n- Created new subclause (8.2) to capture UE requirement of detecting duplicates- Existing texts specifying how detecting duplicates are replaced with pointer to the new subclause- the check of Update Number is only performed against the messages that are subject to duplicate detection.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt leads to false discarding of warning notifications and may threat lives during disasterous situation."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n6.2.2\tSDP answer generation\nWhen the MCPTT client receives an initial SDP offer for an MCPTT session, the MCPTT client shall process the SDP offer and shall compose an SDP answer according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nWhen composing an SDP answer, the MCPTT client:\n1)\tshall accept the MCPTT speech media stream in the SDP offer;\n2)\tshall set the IP address of the MCPTT client for the accepted MCPTT speech media stream and, if included in the SDP offer, for the accepted media-floor control entity;\nNOTE:\tIf the MCPTT client is behind a NAT the IP address and port included in the SDP answer can be a different IP address and port than the actual IP address and port of the MCPTT client depending on the NAT traversal method used by the SIP/IP Core.\n3)\tshall include an \"m=audio\" media-level section for the accepted MCPTT speech media stream consisting of:\na)\tthe port number for the media stream;\nb)\tmedia-level attributes as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\nc)\tif the \"a=recvonly\" attribute is present in the SDP offer, include an \"a=sendonly\" attribute;\nd)\tif the \"a=sendonly\" attribute is present in the SDP offer, include an \"a=recvonly\" attribute; and\ne)\t\"i=\" field set to \"speech\" according to 3GPP\u00a0TS\u00a024.229\u00a0[4]; and\n4)\tif included in the SDP offer, shall include the media-level section of the offered media-floor control entity consisting of:\na)\tan \"m=application\" media-level section as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5] clause\u00a012; and\nb)\t'fmtp' attributes as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5] clause\u00a014\n.\n***** Next change *****\n\n\n\n\n\n\n\n\n\n\n\n\n\n***** Next change *****\n6.3.2.1.6\tSending a SIP BYE request on receipt of a SIP BYE request\nUpon receiving a SIP BYE request from the MCPTT client, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in subclause\u00a06.4 in 3GPP\u00a0TS\u00a024.380\u00a0[5];\n2)\tshall generate a SIP BYE request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\n3)\tshall set the Request-URI to the MCPTT session identity as included in the received SIP BYE request;\n4)\tshall copy the contents of the P-Asserted-Identity header field of the incoming SIP BYE request to the P-Asserted-Identity header field of the outgoing SIP BYE request;\n and\n5)\tshall send the SIP BYE request toward the controlling MCPTT function, according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the terminating MCPTT function shall forward a SIP 200 (OK) response to the MCPTT client and shall interact with the media plane as specified in subclause\u00a06.4 in 3GPP\u00a0TS\u00a024.380\u00a0[5] for releasing media plane resources associated with the SIP session with the controlling MCPTT function.\n***** Next change *****\n6.3.2.1.8.6\tGenerating a SIP re-INVITE request for emergency private call origination within a pre-established session\nThis subclause is referenced from other procedures.\nUpon receipt of a SIP 2xx response which does not contain a Warning header field as specified in subclause\u00a04.4 with the warning text containing the mcptt-warn-code set to \"149\" to a SIP-INVITE request sent to the controlling MCPTT function which contained a Resource-Priority header field populated for an MCPTT emergency private call as specified in subclause\u00a06.3.2.1.8.4, the participating MCPTT function:\n1)\tshall generate a SIP re-INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer \nbased upon the previously negotiated SDP for the pre-established session;\n\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall skip the remaining steps.\nNOTE\u00a01:\tThis is the case where the MCPTT client's previously sent SIP REFER request was either 1) a request for an MCPTT emergency private call or 2), was not a request for an MCPTT emergency private call but MCPTT emergency private priority state was already set to \"in-progress\". In either case no SIP INFO pending warning was expected or received.\nUpon receipt of a SIP 2xx response from the controlling MCPTT function to a request for an MCPTT emergency private call, that contains a Warning header field as specified in subclause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", the participating MCPTT function shall wait for the receipt of a SIP INFO request from the controlling MCPTT function.\nUpon receipt of a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency private call, the participating MCPTT function :\n1)\tshall generate a SIP re-INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer \nbased upon the previously negotiated SDP for the pre-established session;\n\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body containing:\na)\tan <alert-ind> element if included in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INFO request, set to the value of the <alert-ind> in the SIP INFO request.\nNOTE\u00a02:\tThis is the case where the MCPTT client's previously sent SIP REFER request was a request for an MCPTT emergency private call and a SIP INFO request was received in the dialog with the controlling MCPTT function for the MCPTT emergency private call.\n***** Next change *****\n\n\n\n\n\n\n\n***** Next change *****\n6.3.2.2.8.1\tOn-demand\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in subclause\u00a06.4 in 3GPP\u00a0TS\u00a024.380\u00a0[5] for releasing media plane resource associated with the SIP session with the controlling MCPTT function;\n2)\tshall generate a SIP BYE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4];\n3)\tshall copy the contents of the P-Asserted-Identity header field of the incoming SIP BYE request to the P-Asserted-Identity header field of the outgoing SIP BYE request;\n and\n4)\tshall send the SIP BYE request to the MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the participating MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP BYE request received from the controlling MCPTT function according to 3GPP\u00a0TS\u00a024.229\u00a0[4]; and\n2)\tshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5] for releasing media plane resources associated with the SIP session with the MCPTT client.\n***** Next change *****\n6.3.3.2.4\tReceiving a SIP BYE request\nUpon receiving a SIP BYE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in subclause\u00a06.3 in 3GPP\u00a0TS\u00a024.380\u00a0[5] for releasing the media plane resource associated with the SIP session towards the MCPTT client;\nNOTE:\tThe non-controlling MCPTT function is also regarded as a MCPTT client in a temporary MCPTT group session.\n2)\tshall generate a SIP 200 (OK) response and send the SIP response towards the MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4];\n3)\tshall check the MCPTT session release policy as specified in subclause\u00a06.3.8.1 and subclause\u00a06.3.8.2 whether the MCPTT session needs to be released for each participant of the MCPTT session;\n4)\tif release of the MCPTT session is required, \nperform the procedures as specified in the subclause\u00a06.3.3.1.5; and\n5)\tif a release of the MCPTT session is not required, shall send a SIP NOTIFY request to all remaining MCPTT clients in the MCPTT session with a subscription to the conference event package as specified in subclause\u00a010.1.3.4.2.\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the controlling MCPTT function shall interact with the media plane as specified in subclause\u00a06.3 in 3GPP\u00a0TS\u00a024.380\u00a0[5] for releasing media plane resources associated with the SIP session with the MCPTT participant.\n***** Next change *****\n11.1.1.2.1.1\tClient originating procedures\nUpon receiving a request from an MCPTT user to establish an MCPTT private call the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI of the SIP INVITE request to a public service identity of the participating MCPTT function serving the MCPTT user;\n2)\tif the MCPTT user has requested the origination of a first-to-answer call, if the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure;\n3)\tif the MCPTT user has requested the origination of an MCPTT emergency private call or is originating an MCPTT private call and the MCPTT emergency state is already set, the MCPTT client:\na)\tshall, if this is an authorised request for an MCPTT emergency private call as determined by the procedures of subclause\u00a06.2.8.3.1.1, comply with the procedures in subclause\u00a06.2.8.3.2; and\nb)\tshould, if this is an unauthorised request for an MCPTT emergency private call as determined in step a) above, indicate to the MCPTT user that they are not authorised to initiate an MCPTT emergency private call;\n4)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\n5)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF\u00a0RFC\u00a03840\u00a0[16];\n6)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF\u00a0RFC\u00a03841\u00a0[6];\n7)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4]), in a P-Preferred-Service header field according to IETF\u00a0RFC\u00a06050\u00a0[9] in the SIP INVITE request;\n8)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF\u00a0RFC\u00a03841\u00a0[6];\n9)\tfor the establishment of a private call shall insert in the SIP INVITE request a MIME resource-lists body with the MCPTT ID of the invited MCPTT user, according to rules and procedures of IETF\u00a0RFC\u00a05366\u00a0[20];\n10)\tfor the establishment of a first-to-answer call shall insert in the SIP INVITE request a MIME resource-lists body with the MCPTT IDs of the potential target MCPTT users, according to rules and procedures of IETF\u00a0RFC\u00a05366\u00a0[20];\n11)\tif an end-to-end security context needs to be established then:\na)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nb)\tshall use the keying material to generate a PCK as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nc)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0101\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nd)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user and a time related parameter as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\ne)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP\u00a0TS\u00a033.179\u00a0[46]; and\ng)\tshall add the MCPTT ID of the originating MCPTT to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP\u00a0TS\u00a033.179\u00a0[46]; and\nf)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP\u00a0TS\u00a033.179\u00a0[46].\n12)\tshall include an SDP offer according to 3GPP\u00a0TS\u00a024.229\u00a0[4] with the clarification given in subclause\u00a06.2.1 and with a media stream of the offered media-floor control entity;\n13)\tif implicit floor control is required, shall comply with the conditions specified in subclause\u00a06.4;\n14)\tif the MCPTT user is initiating a private call then:\na)\tif force of automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18];\nb)\tif force of automatic commencement mode at the invited MCPTT client is not requested by the MCPTT user and:\ni)\tif automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18]; and\nii)\tif manual commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Manual\" according to the rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18]; and\nc)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <session-type> element set to a value of \"private\";\n15)\tif the MCPTT user is initiating a first-to-answer call shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <session-type> element set to a value of \"first-to-answer\";\n16)\tif the MCPTT emergency private call state is set to either \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\" or the MCPTT emergency private priority state for this private call is set to \"MEPP 2: in-progress\", the MCPTT client shall comply with the procedures in subclause\u00a06.2.8.3.3; and\n17)\tshall send SIP INVITE request towards the MCPTT server according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP 183(Session Progress) response to the SIP INVITE request the MCPTT client:\n1)\tmay indicate the progress of the session establishment to the inviting MCPTT user.\nUpon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5];\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", shall perform the actions specified in subclause\u00a06.2.8.3.4; and\n3)\tshall notify the user that the call has been successfully established.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\"; or\n2)\tif the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-granted\";\nthe MCPTT client shall perform the actions specified in subclause\u00a06.2.8.3.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing session, the MCPTT client shall follow the actions specified in subclause\u00a06.2.8.3.7.\n***** Next change *****\n11.1.1.2.1.2\tClient terminating procedures\nUpon receipt of an initial SIP INVITE request, the MCPTT client shall follow the procedures for termination of multimedia sessions in the IM CN subsystem as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4] with the clarifications below.\nThe MCPTT client:\n1)\tmay reject the SIP INVITE request if any of the following conditions are met:\na)\tMCPTT client is already occupied in another session and the number of simultaneous sessions exceeds <MaxCall>, the maximum simultaneous MCPTT session for private call, as specified in TS\u00a024.484\u00a0[50];\nb)\tMCPTT client does not have enough resources to handle the call; or\nc)\tany other reason outside the scope of this specification;\notherwise, continue with the rest of the steps.\nNOTE\u00a01:\tIf the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the participating MCPTT function can choose to accept the request.\n2)\tif the SIP INVITE request is rejected in step 1), shall respond toward participating MCPTT function either with appropriate reject code as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4] and warning texts as specified in subclause\u00a04.4.2 or with SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure according to <allow-failure-restriction> as specified in 3GPP\u00a0TS\u00a024.484\u00a0[50] and skip the rest of the steps of this subclause;\n3)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT emergency private call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT emergency private call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tif the <alert-ind> element is set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information; and\nb)\tif the session was established with a <session-type> of \"first-to-answer\"; shall temporarily save the current value of the MCPTT emergency private priority (MEPP) state;\nNOTE\u00a02:\tThe current value of the MCPTT emergency private priority (MEPP) state needs to be temporarily saved because the MCPTT client may not be the one selected to terminate the first to answer emergency private call. Hence, the MCPTT client needs to be able to restore the MCPTT emergency private priority (MEPP) state to the saved value.\nc)\tshall set the MCPTT emergency private priority state to \"MEPP 2: in-progress\" for this private call;\n4)\tif the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the originating MCPTT from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nd)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as specified in IETF\u00a0RFC\u00a04567\u00a0[47], and include warning text set to \"136 authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header field as specified in subclause\u00a04.4; and\ne)\tif the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:\ni)\tshall extract and decrypt the encapsulated PCK using the terminating user's (KMS provisioned) UID key as described in 3GPP\u00a0TS\u00a033.179\u00a0[46]; and\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP\u00a0TS\u00a033.179\u00a0[46];\nNOTE\u00a03:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n\n\n\n\n\n\n\n\n\n5)\tmay check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\n6)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user;\n7)\tif the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request is set to \"first-to-answer\":\na)\tshall notify the user of the incoming call;\nb)\tshall not forward the first-to-answer call;\nc)\tif the MCPTT user is busy on another call, shall send a SIP 486 (Busy Here) to the SIP INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4] and not continue with any further steps in this subclause; and\nd)\tif the MCPTT user does not answer the call within a time decided by the client implementation, the MCPTT client shall send a SIP 480 (Temporarily Unavailable) to the SIP INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4] and not continue with any further steps in this subclause;\nNOTE\u00a04:\tIn the conditions below, as the SIP layer implements the actions for commencement mode, it is assumed that the Answer-Mode or Priv-Answer-Mode header fields are set correctly in line with the setting of the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request.\n8)\tshall perform the automatic commencement procedures specified in subclause\u00a06.2.3.1.1 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode;\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode, yet the invited MCPTT client is willing to answer the call with automatic commencement mode; or\nc)\tSIP INVITE request contains a Priv-Answer-Mode header field with the value of \"Auto\"; and\n9)\tshall perform the manual commencement procedures specified in subclause\u00a06.2.3.2.1 if either of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode;\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode, yet the invited MCPTT client allows the call to be answered with manual commencement mode; or\nc)\tSIP INVITE request contains a Priv-Answer-Mode header field with the value of \"Manual\".\nUpon receiving the SIP CANCEL request cancelling a SIP INVITE request for which a dialog exists at the MCPTT client and a SIP 200 (OK) response has not yet been sent to the SIP INVITE request then the MCPTT client:\n1)\tif the session was established with a <session-type> of \"first-to-answer\", may notify the MCPTT user of the cancellation of the call;\n2)\tif a temporary MCPTT emergency private priority (MEPP) state value was saved in step 3) b) above:\na)\tshall restore the MCPTT emergency private priority (MEPP) state to the temporary MCPTT emergency private priority (MEPP) state value; and\nb)\tshall discard the temporary MCPTT emergency private priority (MEPP) state value;\n3)\tshall send a SIP 200 (OK) response to the SIP CANCEL request according to 3GPP\u00a0TS\u00a024.229\u00a0[4]; and\n4)\tshall send a SIP 487 (Request Terminated) response to the SIP INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP BYE request for an established dialog, the MCPTT client:\n1)\tif the session was established with a <session-type> of \"first-to-answer\" and:\na)\tif the received SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <release-reason> element set to a value of \"not selected for call\":\ni)\tif a temporary MCPTT emergency private priority (MEPP) state value was saved in step 3) b) above, shall restore the MCPTT emergency private priority (MEPP) state to the the temporary MCPTT emergency private priority (MEPP) state value saved in step 3) b) above; and\nb)\tmay notify the MCPTT user of the release of the call; and\n2)\tshall follow the procedures in subclause\u00a011.1.4.2.\nNOTE\u00a05:\tThe above conditions for SIP CANCEL and SIP BYE cover the case for a first-to-answer call where the MCPTT server has already established the private call with another MCPTT client and needs to immediately cancel or release the dialogs with other MCPTT clients.\n***** Next change *****\n11.1.1.2.2.1\tClient originating procedures\nUpon receiving a request from an MCPTT user to establish an MCPTT private call within a pre-established session the MCPTT client shall generate a SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[4], IETF\u00a0RFC\u00a04488\u00a0[22] and IETF\u00a0RFC\u00a03515\u00a0[25] as updated by IETF\u00a0RFC\u00a06665\u00a0[26] and IETF\u00a0RFC\u00a07647\u00a0[27], with the clarifications given below.\nIf and an end-to-end security context needs to be established the MCPTT client:\n1)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\n2)\tshall use the keying material to generate a PCK as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\n3)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0100\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\n4)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user and a time related parameter as described in 3GPP\u00a0TS\u00a033.179\u00a0[46];\n5)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP\u00a0TS\u00a033.179\u00a0[46];\n6)\tshall add the MCPTT ID of the originating MCPTT to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP\u00a0TS\u00a033.179\u00a0[46]; and\n7)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP\u00a0TS\u00a033.179\u00a0[46].\nThe MCPTT client populates the SIP REFER request as follows:\n1)\tshall include the Request-URI set to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n2)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF\u00a0RFC\u00a04488\u00a0[22];\n3)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF\u00a0RFC\u00a04488\u00a0[22];\n4)\tshall include the option tag \"multiple-refer\" in the Require header field;\n5)\tmay include a P-Preferred-Identity header field in the SIP REFER request containing a public user identity as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\n6)\tshall include a P-Preferred-Service header field set to the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4]), according to IETF\u00a0RFC\u00a06050\u00a0[9];\n7)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF\u00a0RFC\u00a03515\u00a0[25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF\u00a0RFC\u00a02392\u00a0[62] that points to an application/resource-lists MIME body as specified in IETF\u00a0RFC\u00a05366\u00a0[20], and with the Content-ID header field set to this \"cid\" URL.\n8)\tfor the initiation of a private call, shall include in the application/resource-lists MIME body a single <entry> element containing a \"uri\" attribute set to the MCPTT ID of the called user, extended with the following URI header fields:\nNOTE\u00a01:\tCharacters that are not formatted as ASCII characters are escaped in the following URI header fields\na)\tif force of automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18];\nb)\tif force of automatic commencement mode at the invited MCPTT client is not requested by the MCPTT user and:\ni)\tif automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include an Answer-Mode header field with the value \"Automatic\" according to rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18]; and\nii)\tif manual commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include an Answer-Mode header field with the value \"Manual\" according to rules and procedures of IETF\u00a0RFC\u00a05373\u00a0[18]; and\nc)\tshall include in a hname \"body\" URI header field:\ni)\tif the SDP parameters of the pre-established session do not contain a media-level section of a media-floor control entity or if end-to-end security is required for the private call, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP\u00a0TS\u00a024.229\u00a0[4] with the clarification given in subclause\u00a06.2.1; and\nii)\tan application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"private\";\n9)\tfor an initiation of a first-to-answer call, shall include in the application/resource-lists MIME body an <entry> element for each of the targeted MCPTT users, with each <entry> element containing a \"uri\" attribute set to the MCPTT ID of the targeted user, extended with hname \"body\" URI header field containing:\nNOTE\u00a02:\tCharacters that are not formatted as ASCII characters are escaped in the following URI header fields\na)\tif the SDP parameters of the pre-established session do not contain a media-level section of a media-floor control entity or if end-to-end security is required for the first-to-answer call, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP\u00a0TS\u00a024.229\u00a0[4] with the clarification given in subclause\u00a06.2.1; and\nb)\tan application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"first-to-answer\";\n10)\tif the MCPTT user has requested the origination of an MCPTT emergency private call or is originating an MCPTT private call and the MCPTT emergency state is already set, the MCPTT client:\na)\tif this is an authorised request for an MCPTT emergency private call as determined by the procedures of subclause\u00a06.2.8.3.1.1, shall comply with the procedures in subclause\u00a06.2.8.3.2; and\nb)\tif this is an unauthorised request for an MCPTT emergency private call as determined in step a) above, should indicate to the MCPTT user that they are not authorised to initiate an MCPTT emergency private call;\n11)\tif the MCPTT emergency private priority state for this call is set to \"MEPP 2: in-progress\", the MCPTT client shall comply with the procedures in subclause\u00a06.2.8.3.3; and\n12)\tshall include a Target-Dialog header field as specified in IETF\u00a0RFC\u00a04538\u00a0[23] identifying the pre-established session.\nThe MCPTT client shall send the SIP REFER request towards the MCPTT server according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a final SIP 2xx response to the SIP REFER request the MCPTT client shall interact with media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5].\nOn receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the SIP REFER request for an MCPTT emergency private call:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\", the MCPTT client shall perform the actions specified in subclause\u00a06.2.8.3.5; and\n2)\tshall skip the remaining steps.\nUpon receipt of a SIP re-INVITE request within the pre-established session targeted by the sent SIP REFER request, and \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nif the sent SIP REFER request was a request for an MCPTT emergency private call, the MCPTT client:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\":\na)\tshall set the MCPTT emergency private priority state of the call to \"MEPP 2: in-progress\" if it was not already set;\nb)\tshall set the MCPTT emergency private call state to \"MEPC 3: emergency-pc-granted\"; and\nc)\tif the MCPTT private emergency alert state is set to \"MPEA 2: emergency-alert-confirm-pending\" and:\ni)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"true\" or does not contain an <alert-ind> element, shall set the MCPTT private emergency alert state to \" MPEA 3: emergency-alert-initiated \"; or\nii)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"false\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert \";\n2)\tshall check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4]; \n3)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP\u00a0TS\u00a024.229\u00a0[4];\n4)\tshall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4], based upon the parameters already negotiated for the pre-established session; and\n5)\tshall send the SIP 200 (OK) response towards the participating MCPTT function according to rules and procedures of 3GPP\u00a0TS\u00a024.229\u00a0[4].\nOn call release by interaction with the media plane as specified in subclause\u00a09.2.2 of 3GPP\u00a0TS\u00a024.380\u00a0[5] if the sent SIP REFER request was a request for an MCPTT emergency private call, the MCPTT client shall perform the procedures specified in subclause\u00a06.2.8.1.18.\n***** Next change *****\n11.1.1.3.1.2\tPrivate call and first-to-answer call initiation using pre-established session\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header field containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF\u00a0RFC\u00a02392\u00a0[62] that points to an application/resource-lists MIME body as specified in IETF\u00a0RFC\u00a05366\u00a0[20] containing one or more <entry> element(s) with a \"uri\" attribute containing a SIP-URI set to the MCPTT ID of the called user(s);\n2)\ta body\" URI header field of the SIP-URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"private\" or \"first-to-answer\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF\u00a0RFC\u00a03261\u00a0[24] and shall not continue with the rest of the steps;\nNOTE\u00a01:\tIf the application/vnd.3gpp.mcptt-info MIME body included in the SIP REFER request as described at the top of the present subclause contains an <emergency-ind> element or <imminentperil-ind> element set to a value of \"true\", and this is an authorised request for originating a priority call as determined by subclause\u00a06.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with any of the remaining steps;\n4)\tif the received SIP REFER request does not contain an application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with the rest of the steps;\n5)\tif the received SIP REFER request contains an application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field with more than one <entry> element each with an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element:\na)\tnot set to \"first-to-answer\", shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with any of the remaining steps; or\nb)\tset to \"first-to-answer\", determine that the call is a first-to-answer call;\n6)\tif the received SIP REFER request contains an application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field with only one <entry> element with an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element:\na)\tnot set to \"private\", shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with any of the remaining steps; or\nb)\tset to \"private\", determine that the call is a private call;\n7)\tif the call is a:\na)\tprivate call, shall determine the public service identity of the controlling MCPTT function for the private call service associated with the originating user's MCPTT ID; or\nb)\tfirst-to-answer call, shall determine the public service identity of the controlling MCPTT function for the first-to-answer call service associated with the originating user's MCPTT ID;\nNOTE\u00a02:\tHow the participating MCPTT server discovers the public service identity of the controlling MCPTT function associated with the private call service or first-to-answer service of the calling user is out of scope of the current document.\n8)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the private call service or first-to-answer call service associated with the originating user's MCPTT ID, it shall reject the REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with any of the remaining steps;\n9)\tif the <allow-private-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) on the participating MCPTT function or is present with the value \"false\", indicating that the user identified by the MCPTT ID is not authorised to initiate private calls, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response to the SIP INVITE request, with warning text set to \"107 user not authorised to make private calls\" in a Warning header field as specified in subclause\u00a04.4;\n10)\tif the call is a private call:\na)\tif the received SIP REFER request includes an Answer-Mode header field as specified in IETF\u00a0RFC\u00a05373\u00a0[18] set to \"Auto\" contained in the header portion of the SIP URI present in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, and the <allow-automatic-commencement> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) on the participating MCPTT function or is present with the value \"false\" (indicating that the user identified by the MCPTT ID is not authorised to initiate private call with automatic commencement), shall reject the \"SIP REFER request for pre-established session\u201d with a SIP 403 (Forbidden) response including warning text set to \"125 user not authorised to make private call with automatic commencement\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with the rest of the steps;\nb)\tif the received SIP REFER request includes an Answer-Mode header field as specified in IETF\u00a0RFC\u00a05373\u00a0[18] set to \"Manual\" contained in the header portion of the SIP URI present in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, and the <allow-manual-commencement> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) on the participating MCPTT function or is present with the value \"false\" (indicating that the user identified by the MCPTT ID is not authorised to initiate private call with manual commencement), shall reject the \"SIP REFER request for pre-established session\u201d with a SIP 403 (Forbidden) response including warning text set to \"126 user not authorised to make private call with manual commencement\" in a Warning header field as specified in subclause\u00a04.4 and shall not continue with the rest of the steps;\nc)\tif the <allow-force-auto-answer> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) on the participating MCPTT function or is present with the value \"false\", and the SIP REFER request contained a Priv-Answer-Mode header field as specified in IETF\u00a0RFC\u00a05373\u00a0[18] set to \"Auto\" in the header portion of the SIP URI in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"143 not authorised to force auto answer\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with the rest of the steps;\nd)\tif the <PrivateCall> element exists in the MCPTT user profile document with one more <entry> elements (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) and:\ni)\tif the SIP-URI in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field not match with one of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]); and\nii)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\ni)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"144 user not authorised to call this particular user\" in a Warning header field as specified in subclause 4.4 and shall not continue with the rest of the steps;\n11)\tif the call is a first-to-answer call and if the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) and:\na)\tthe \"uri\" attribute of each and every <entry> element of the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field does not match with any of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]); and\nb)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"153 user not authorised to call any of the users requested in the first-to-answer call\" in a Warning header field as specified in subclause 4.4 and shall not continue with the rest of the steps;\n12)\tif the call is a first-to-answer call and:\na)\tif the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]);\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"156 user not authorised to originate a first-to-answer call\" in a Warning header field as specified in subclause 4.4 and shall not continue with the rest of the steps;\n13)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4], IETF\u00a0RFC\u00a03515\u00a0[25] as updated by IETF\u00a0RFC\u00a06665\u00a0[26], and IETF\u00a0RFC\u00a04488\u00a0[22] without establishing an implicit subscription;\n14)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP\u00a0TS\u00a024.229\u00a0[4];\nNOTE\u00a03:\tIn accordance with IETF\u00a0RFC\u00a04488\u00a0[22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n15)\tshall send the response to the \"SIP REFER request for a pre-established session\" towards the MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4];\n16)\tshall generate a SIP INVITE request as specified in subclause\u00a06.3.2.1.4 with the following clarifications:\na)\tif the conditions in step 11) above were executed and the participating MCPTT function determined that the \"uri\" attribute of only one of the <entry> elements of the application/resource-lists MIME body matched with an <entry> element of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) then the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request generated in subclause\u00a06.3.2.1.4 is set to \"private\"; and\nb)\tif the conditions in step 11) above were executed, then only the <entry> element(s) of the application/resource-lists MIME body that have a \"uri\" attribute that matched with an <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) are included in the application/resource-lists MIME body in the SIP INVITE request generated in subclause\u00a06.3.2.1.3;\n17)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the controlling MCPTT function hosting the private call service or first-to-answer call service for the calling MCPTT user as determined above in step 7);\n18)\tif the call is a private call:\na)\tif the SIP REFER request contained a Priv-Answer-Mode header field as specified in IETF\u00a0RFC\u00a05373\u00a0[18] set to \"Manual\" in the header portion of the SIP URI in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, shall copy the Priv-Answer-Mode header field from the incoming SIP REFER request to the outgoing SIP INVITE request;\nb)\tif the <allow-force-auto-answer> element of the <ruleset> element is present in the MCPTT user profile document with the value \"true\" (see the MCPTT user profile document in 3GPP\u00a0TS\u00a024.484\u00a0[50]) on the participating MCPTT function, and the Priv-Answer-Mode header field specified in IETF\u00a0RFC\u00a05373\u00a0[18] was received in the header portion of the SIP URI in the application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field, with a value set to \"Auto\", shall copy the Priv-Answer-Mode header field to the outgoing SIP INVITE request; and\nc)\tif a Priv-Answer-Mode header field containing the value of \"Auto\" has not been copied to the outgoing SIP INVITE request as specified in step 16) above, and the incoming SIP REFER request contained an Answer-Mode header field in the headers portion of the SIP URI in the application/resource-lists referenced by a \"cid\" URL in the Refer-To header field, then copy the Answer-Mode header field to the outgoing SIP INVITE request;\n19)\tif the received SIP REFER request contained a Resource-Priority header field, shall include in the outgoing SIP INVITE request a Resource-Priority header field according to rules and procedures of 3GPP\u00a0TS\u00a024.229\u00a0[4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request; and\nNOTE\u00a04:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n20)\tshall forward the SIP INVITE request according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving SIP provisional responses for the SIP INVITE request the participating MCPTT function:\n1)\tshall discard the received SIP responses without forwarding them.\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the participating MCPTT function:\n1)\t\n\n\n\nshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5]; and\n2)\tif the received SIP 2xx response was in response to a request for an MCPTT emergency private call and does not contain a Warning header field as specified in subclause\u00a04.4 with the warning text containing the mcptt-warn-code set to \"149\":\na)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in subclause\u00a06.3.2.1.8.6; and\nb)\tshall send the SIP re-INVITE request towards the MCPTT client within the pre-established session according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\n\n\n\n\n\nUpon receiving a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency private call, the participating MCPTT function shall:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the controlling MCPTT function as specified in 3GPP\u00a0TS\u00a024.229\u00a0[4];\n2)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in subclause\u00a06.3.2.1.8.6; and\n3)\tshall send the SIP re-INVITE request the MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request\n in step 21) the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5].\n***** Next change *****\n11.1.1.4.2\tTerminating procedures\nIn the procedures in this subclause:\n1)\t<emergency\u2013ind> refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\n2)\t<alert\u2013ind> refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\t<session-type> refers to the <session-type> element of an application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of:\n-\ta \"SIP INVITE request for controlling MCPTT function of a private call\"; or\n-\ta \"SIP INVITE request for controlling MCPTT function of a first-to-answer call\";\nthe controlling MCPTT function:\n1)\tif the <session-type> in the SIP INVITE request is set to \"private\":\na)\tshall check whether the public service identity contained in the Request-URI is allocated for private call and perform the actions specified in subclause\u00a06.3.7.1 if it is not allocated and skip the rest of the steps; and\nb)\tshall perform actions to verify the MCPTT ID of the inviting MCPTT user in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request, and authorise the request according to local policy, and if it is not authorised the controlling MCPTT function shall return a SIP 403 (Forbidden) response with the warning text as specified in \"Warning header field\" and skip the rest of the steps;\n2)\tif the <session-type> in the SIP INVITE request is set to \"first-to-answer\" shall check whether the public service identity contained in the Request-URI is allocated for first-to-answer call and perform the actions specified in subclause\u00a06.3.7.1 if it is not allocated and skip the rest of the steps;\n3)\tif the incoming SIP INVITE request does not contain an application/resource-lists MIME body shall reject the SIP INVITE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with the rest of the steps;\n4)\tif the <session-type> is set to \"private\" and the application/resource-lists MIME body contains more than one <entry> element, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in subclause\u00a04.4, and shall not continue with the rest of the steps;\n5)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec or media format is acceptable by the controlling MCPTT function and if not, reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n6)\tif received SIP INVITE request includes an <emergency-ind>, shall validate the request as described in subclause\u00a06.3.3.1.17;\n7)\tif the received SIP INVITE request contains an unauthorised request for an MCPTT emergency private call as determined by subclause\u00a06.3.3.1.13.2:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response as specified in subclause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n8)\tif a Resource-Priority header field is included in the received SIP INVITE request and if the Resource-Priority header field is set to the value indicated for emergency calls, shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps if neither one of the following conditions are true:\na)\tthe SIP INVITE request does not contain an authorised request for an MCPTT emergency call as determined in step 4 above; or\nb)\tthe originating MCPTT user is not in an in-progress emergency private call state with the targeted MCPTT user;\n9)\tif \nthe SIP INVITE request contains an emergency indication set to a value of \"true\" and \nthe originating MCPTT user is not in an in-progress emergency private call state with the targeted MCPTT user:\n\n\na)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency private call to the targeted user; and\nb)\tshall cache the information that the MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user;\n10)\tshall perform actions as described in subclause\u00a06.3.3.2.2;\n11)\tshall allocate an MCPTT session identity for the MCPTT session; and\n12)\tshall invite the MCPTT user(s) listed in the MIME resource-lists body of received SIP INVITE request as specified in subclause\u00a011.1.1.4.1.\nUpon receiving a SIP 180 (Ringing) response and if the SIP 180 (Ringing) response or the SIP final response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tif the SIP 180 (Ringing) response is associated with a SIP INVITE that contained a <session-type> set to \"private\", shall generate a SIP 180 (Ringing) response to the SIP INVITE request and send the SIP 180 (Ringing) response towards the inviting MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4]; and\n2)\tif the SIP 180 (Ringing) response is associated with a SIP INVITE that contained a <session-type> set to \"first-to-answer\", and no other SIP 180 (Ringing) responses have been received that are associated with a SIP INVITE that contained a <session-type> set to \"first-to-answer\", shall generate a SIP 183 (Session Progress) response to the SIP INVITE request and send the SIP 183 (Session Progress) response towards the inviting MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, the SIP dialog was established as a result of receiving a SIP INVITE request with a <session-type> element set to the value of \"private\" and the SIP final response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the subclause\u00a06.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the subclause\u00a06.3.3.2.2;\n3)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in subclause\u00a06.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in subclause\u00a04.4;\nNOTE\u00a01:\tThis is the case when the MCPTT user's request for an MCPTT emergency private call was granted but the request for the MCPTT emergency alert was denied.\n4)\tshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5]; and\nNOTE\u00a02:\tResulting media plane processing is completed before the next step is performed.\n5)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, the SIP dialog was established as a result of receiving a SIP INVITE request with a <session-type> element set to the value of \"first-to-answer\" and the SIP final response has not yet been sent to the inviting MCPTT client the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the subclause\u00a06.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the subclause\u00a06.3.3.2.2;\n\n\n\n3)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in subclause\u00a06.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in subclause\u00a04.4;\nNOTE\u00a03:\tThis is the case when the MCPTT user's request for an MCPTT emergency private call was granted but the request for the MCPTT emergency alert was denied.\n4)\tshall interact with the media plane as specified in 3GPP\u00a0TS\u00a024.380\u00a0[5]; \nNOTE\u00a04:\tResulting media plane processing is completed before the next step is performed.\n5)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP\u00a0TS\u00a024.229\u00a0[4];\n6)\tfor all other MCPTT clients that were invited due to the controlling MCPTT function receiving a SIP INVITE request with a <session-type> element set to the value of \"first-to-answer\":\na)\tshall send a SIP BYE request to release a SIP dialog that has been established since the SIP 200 (OK) response was sent in step 5) by following the procedures in subclause\u00a06.3.3.1.5 with the clarification that the SIP BYE request contain an application/vnd.3gpp.mcptt-info+xml MIME body including a <release-reason> element set to a value of \"not selected for call\";\nb)\tshall generate and send a SIP CANCEL request according SIP IETF\u00a0RFC\u00a03261\u00a0[24], to cancel a SIP dialog that has not yet been established since the SIP 200 (OK) response was sent in step 5);\nc)\ton receiving a SIP 200 (OK) to a SIP CANCEL request, shall wait to receive a SIP 487 (Request Terminated) to the original SIP INVITE request sent to the client; and\nd)\tif a SIP 487 (Request Terminated) from the MCPTT client is not received within a time determined by the MCPTT server implementation, shall send a SIP BYE towards the MCPTT client by following the procedures in subclause\u00a06.3.3.1.5 with the clarification that the SIP BYE request contain an application/vnd.3gpp.mcptt-info+xml MIME body including a <release-reason> element set to a value of \"not selected for call\"; and\n7)\tif not successful in cancelling or terminating SIP dialogs in step 6) above, may repeat the SIP CANCEL and SIP BYE requests.\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, where the SIP 200 (OK) response was sent with a Warning header field as specified in subclause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", the controlling MCPTT function shall follow the procedures in subclause\u00a06.3.3.1.18.\nThe controlling MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP\u00a0TS\u00a024.229\u00a0[4].\n\n\n\n\n\n***** Next change *****\n11.1.2.2\tMCPTT client procedures\nWhen the MCPTT user wants to make an on-demand private call without floor control or first-to-answer call without floor control, the MCPTT client shall follow the procedures in subclause\u00a011.1.1.2.1.1 with the following exceptions:\n1)\tin step 11) of subclause\u00a011.1.1.2.1.1, the MCPTT client shall not offer a media-level section for a media-floor control entity; and\n2)\tstep 12) of subclause\u00a011.1.1.2.1.1 shall be ignored.\nWhen the MCPTT user wants to make a private call without floor control or first-to-answer call without floor control using a pre-established session, the MCPTT client shall follow the procedures in subclause\u00a011.1.1.2.2.1 with the following exceptions:\n1)\tin step 5d) of subclause\u00a011.1.1.2.2.1, if the MCPTT client includes an SDP offer in the request, it shall not include a media-level section for a media-floor control entity; and\n2)\tstep 6) in the second numbered list of subclause\u00a011.1.1.2.2.1 shall be ignored.\nUpon receipt of an initial SIP INVITE request for the private call or first-to-answer call with an SDP offer not including a media-level section for a media-floor control entity, the MCPTT client shall consider it as the request for private call without floor control and shall follow the procedures as specified in subclause\u00a011.1.1.2.1.2 for on-demand session and subclause\u00a011.1.1.2.2.2 for pre-established session.\n***** Next change *****\nF.1.3\tSemantic\nThe <mcpttinfo> element is the root element of the XML document. The <mcpttinfo> element can contain subelements.\nNOTE\u00a01:\tThe subelements of the <mcptt-info> are validated by the <xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <mcptt-info> element\nIf the <mcpttinfo> contains the <mcptt-Params> element then:\n1)\tthe <mcptt-access-token>, <mcptt-request-uri>, <mcptt-calling-user-id>, <mcptt-called-party-id>, <mcptt-calling-group-id>, <emergency-ind>, <alert-ind>, <imminentperil-ind>, <originated-by> and <mcptt-client-id> can be included with encrypted content;\n2)\tfor each element in 1) that is included with content that is not encrypted:\na)\tthe element has the \"type\" attribute set to \"Normal\";\nb)\tif the element is the <mcptt-request-uri>, <mcptt-calling-user-id>, <mcptt-called-party-id> or <mcptt-calling-group-id> or <originated-by> then the <mcpttURI> element is included;\nc)\tif the element is the <mcptt-access-token> or <mcptt-client-id>, then the <mcpttString> element is included; and\nd)\tif the element is <emergency-ind>, <alert-ind>, <alert-ind-rcvd> or <imminentperil-ind> elements then the <mcpttBoolean> element is included;\n3)\tfor each element in 1) that is included with content that is encrypted:\na)\tthe element has the \"type\" attribute set to \"Encrypted\";\nb)\tthe <xenc:EncryptedData> element from the \"\" namespace is included and:\ni)\tcan have a \"Type\" attribute can be included with a value of \"http://www.w3.org/2001/04/xmlenc#Content\";\nii)\tcan include an <EncryptionMethod> element with the \"Algorithm\" attribute set to value of \"http://www.w3.org/2009/xmlenc11#aes128-gcm\";\niii)\tcan include a <KeyInfo> element with a <KeyName> element containing the base 64 encoded XPK-ID; and\niv)\tincludes a <CipherData> element with a <CipherValue> element containing the encrypted data.\nNOTE\u00a02:\tWhen the optional attributes and elements are not included within the <xenc:EncryptedData> element, the information they contain is known to sender and the receiver by other means.\nIf the <mcpttinfo> contains the <mcptt-Params> element then:\n1)\tthe <mcptt-access-token> can be included with the access token received during authentication procedure as described in 3GPP\u00a0TS\u00a024.482\u00a0[49];\n2)\tthe <session-type> can be included with:\na)\ta value of \"chat\" to indicate that the MCPTT client wants to join a chat group call\nb)\ta value of \"prearranged\" to indicate the MCPTT client wants to make a prearranged group call;\nc)\ta value of \"private\" to indicate the MCPTT client wants to make a private call;\nd)\ta value of \"first-to-answer\" to indicate that the MCPTT client wants to make a first-to-answer call; or\ne)\ta value of \"ambient-listening\" to indicate the MCPTT client wants to make an ambient listening call;\n3)\tthe <mcptt-request-uri> can be included with:\na)\ta value set to an MCPTT group ID or temporary MCPTT group ID when the <session-type> is set to a value of \"prearranged\" or \"chat\"; and\nb)\ta value set to the MCPTT ID of the called MCPTT user when the <session-type> is set to a value of \"private\";\n4)\tthe <mcptt-calling-user-id> can be included, set to MCPTT ID of the originating user;\n5)\tthe <mcptt-called-party-id> can be included, set to the MCPTT ID of the terminating user;\n6)\tthe <mcptt-calling-group-id> can be included to indicate the MCPTT group identity to the terminating user;\n7)\tthe <required> can be included in a SIP 183 (Session Progress) from a non-controlling MCPTT function of an MCPTT group to inform the controlling MCPTT function that the group on the non-controlling MCPTT function has group members in the group document which are marked as <on-network-required>, as specified in 3GPP\u00a0TS\u00a024.481\u00a0[31];\n8)\tthe <emergency-ind> can be:\na)\tset to \"true\" to indicate that the call that the MCPTT client is initiating is an emergency MCPTT call; or\nb)\tset to \"false\" to indicate that the MCPTT client is cancelling an emergency MCPTT call (i.e. converting it back to a non-emergency call)\n9)\tthe <alert-ind> can be:\na)\tset to \"true\" in an emergency call initiation to indicate that an alert to be sent; or\nb)\tset to \"false\" when cancelling an emergency call which requires an alert to be cancelled also\n10)\tif the <session-type> is set to \"chat\" or \"prearranged\":\na)\tthe <imminentperil-ind> can be set to \"true\" to indicate that the call that the MCPTT client is initiating is an imminent peril group MCPTT call; \n11)\tthe <broadcast-ind> can be:\na)\tset to \"true\" indicates that the MCPTT client is initiating a broadcast group call; or\nb)\tset to \"false\" indicates that the MCPTT client is initiating a non-broadcast group call;\n12)\tthe <mc-org> can be:\na)\tset to the MCPTT user's Mission Critical Organization in an emergency alert sent by the MCPTT server to terminating MCPTT clients;\n13)\tthe <floor-state> can be:\na)\tset to \"floor-idle\", if the floor is idle in a non-controlling MCPTT function; or\nb)\tset to \"floor-taken\" if the floor state in a non-controlling MCPTT function is taken;\n14)\tthe <associated-group-id>:\na)\tif the <mcptt-request-uri> element contains a group identity then this element can include an MCPTT group ID associated with the group identity in the <mcptt-request-uri> element. E.g. if the <mcptt-request-uri> element contains a temporary group identity (TGI), then the <associated-group-id> element can contain the constituent MCPTT group ID;\n15)\tthe <originated-by>:\na)\tcan be included, set to the MCPTT ID of the originating user of an MCPTT emergency alert when being cancelled by another authorised MCPTT user;\n16)\tthe <MKFC-GKTPs>:\na)\tcontains a group key transport payload carrying one or more MKFC(s) and MKFC-ID(s) as described in3GPP\u00a0TS\u00a024.481\u00a0[31] subclause\u00a07.4, to be used for protection of multicast floor control signalling when the UE operates on the network;\n17)\tthe <mcptt-client-id>:\na)\tcan be included, set to the MCPTT client ID of the MCPTT client that originated a SIP INVITE request, SIP REFER request or SIP MESSAGE request;\n18)\tthe <alert-ind-rcvd>\na)\tcan be set to true and included in a SIP MESSAGE to indicate that the emergency alert or cancellation was received successfully; and\n19)\tthe <anyExt> can be included with the following elements not declared in the XML schema:\na)\tan <ambient-listening-type> of type \"xs:string\":\ni)\tset to a value of \"remote-init\" when the listening MCPTT user of an ambient listening call initiates the call; or\nii)\tset to a value of \"local-init\" when the listened-to MCPTT user of an ambient listening call initiates the call; and\nb)\ta <release-reason> of type \"xs:string\":\ni)\tset to a value of \"private-call-expiry\" when the ambient listening call is release due to the expiry of the private call timer;\nii)\tset to a value of \"administrator-action\" when the ambient listening call is released by an MCPTT administrator;\niii)\tset to a value of \"not selected for call\" when the when a dialog is released with an MCPTT client that was not selected as the terminating client of a first-to-answer call;\niv)\tset to a value of \"call-request-for-listened-to-client\" when there is a call request targeted to the listened-to client; or\nv)\tset to a value of \"call-request-initiated-by-listened-to-client\" when there is a call request initiated by the listened-to client;\n\nc)\ta <request-type> of type \"xs:string\":\ni)\tset to value of \"private-call-call-back-request\" when a client initiates a private call call-back request;\nii)\tset to a value of \"private-call-call-back-cancel-request\" when a client initiates a private call call-back cancel request; or\niii)\tset to a value of \"group-selection-change-request\" when a client initiates a group selection change request;\nd)\ta <response-type> of type \"xs:string\":\ni)\tset to a value of \"private-call-call-back-response\" when a client responds to a private call call-back request; or\nii)\tset to a value of \"private-call-call-back-cancel-response\" when a client responds to a private call call-back cancel request; or\niii)\tset to a value of \"group-selection-change-response\" when a client responds to a group selection change request;\ne)\tan <urgency indication> of type \"xs:string\":\n(i)\tset to a value of \"low\", \"normal\" or \"high\" to indicate the urgency of a private call call-back request; and\nf)\ta <time-of-request> of type \"xs:dateTime\":\n(i)\tset to the date and time at which the private call call-back request was initiated, in the form: \"YYYY-MM-DDThh:mm:ss\" where:\n-\tYYYY indicates the year;\n-\tMM indicates the month;\n-\tDD indicates the day;\n-\tT indicates the start of the required time section;\n-\thh indicates the hour;\n-\tmm indicates the minute; and\n-\tss indicates the second; and\ng)\ta <selected-group-change-outcome> of type \"xs:string\":\ni)\tset to a value of \"success\" when a client reports that it has successfully changed its selected group as requested by a received group selection change request; or\nii)\tset to a value of \"fail\" when a client reports that it has failed to change its selected group as requested by a received group selection change request; and\nh)\tan<affiliation-required> of type \"xs:Boolean\":\ni)\t set to a value of \"true\" when received by a client in a group-selection-change-request indicates that the client needs to affiliate to the specified group.\nAbsence of the <emergency-ind>, <alert-ind> and <imminentperil-ind> in a SIP INVITE request indicates that the MCPTT client is initiating a non-emergency private call or non-emergency group call.\nAbsence of the <broadcast-ind> in a SIP INVITE request indicates that the MCPTT client is initiating a non-broadcast group call.\nAbsence of the <floor-state> in a SIP 200 (OK) response from the non-controlling MCPTT function indicates that the floor is idle.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe key management currently specified for first-to-answer call in TS 24.379 does not comply with that defined in TS 33.180, which differs from the key management used for private call. Private call includes the MIKEY-SAKKE I_MESSAGE in the SDP answer, whereas in stage 2 subclause 7.2.4.3, TS 33.180 it is stated:...\"MCPTT user at MCPTT client 2 accepts the call, which causes the MCPTT client 2 to send a first-to-answer call response to the MCPTT server. Included in the response, is the PCK (PCK_1) encapsulated to the user associated with the initiating client, MCPTT client 1.  The PCK is then included in the SDP content of the response.\"...\n\n>>> SUMMARY OF CHANGE\nThe changes made include:-PCK generated by terminating client instead of originating client in the case of a first-to-answer call.-PCK included in the SDP answer by the terminating client-verification of I_MESSAGE signature done by originating client instead of terminating client in the case of a first-to-answer call.- release of session with SIP BYE if verification of I_MESSAGE signature fails-on demand and pre-established sessions treated-KMS URI references to TS 24.483 and TS 24.484 are added where needed.\n\n>>> CONSEQUENCES IF NOT REVISED\nFirst-to-answer call will have a security solution non-compliant with TS 33.180 in which multiple MCPTT clients may receive a valid encryption key for the call."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n6.4.1.1.1.2\tSequence generation when transform precoding is enabled\nIf transform precoding for PUSCH is enabled, the reference-signal sequence  shall be generated according to\n\nwhere  with  and  depends on the configuration:\n-\tif the higher-layer parameter dmrsUplinkTransformPrecoding-r16 is configured, \u03c0/2-BPSK modulation is used for PUSCH, and the PUSCH transmission is not a msg3 transmission, and the transmission is not scheduled using DCI format 0_0 in a common search space,  is given by clause 5.2.3 with  given by\n\n\twhere  unless given by the DCI according to clause 7.3.1.1.2 in  [4, TS38.212] for a transmission scheduled by DCI format 0_1 or given by the higher-layer parameter antennaPort for a PUSCH transmission scheduled by a type-1 configured grant; and\n-\t are given by the higher-layer parameters pi2BPSKscramblingID0 and pi2BPSKscramblingID1, respectively, in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_1 or by a PUSCH transmission with a configured grant; \n-\t is given by the higher-layer parameter pi2BPSKscramblingID0 in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_0 with the CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI;\n-\t otherwise; \n-\totherwise,  is given by clause 5.2.2.\nThe sequence group , where  is given by\n-\t if  is configured by the higher-layer parameter nPUSCH-Identity in the DMRS-UplinkConfig IE, the higher-layer parameter dmrsUplinkTransformPrecoding-r16 is not configured, and the PUSCH is neither scheduled by RAR UL grant nor scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI according to clause 8.3 in [5, TS 38.213]; \n-\t if the higher-layer parameter dmrs-UplinkTransformPrecoding-r16 is configured, \u03c0/2-BPSK modulation is used for PUSCH, the PUSCH transmission is not a msg3 transmission, and the transmission is not scheduled using DCI format 0_0 in a common search space;\n-\t otherwise\nwhere  and the sequence number  are given by:\n-\tif neither group, nor sequence hopping is enabled\n\t\n-\tif group hopping is enabled and sequence hopping is disabled \n\t\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame\n-\tif sequence hopping is enabled and group hopping is disabled\n\t\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame. \nThe hopping mode is controlled by higher-layer parameters:\n-\tfor PUSCH transmission scheduled by RAR UL grant or by DCI format 0_0 with CRC scrambled by TC-RNTI, sequence hopping is disabled and group hopping is enabled or disabled by the higher-layer parameter groupHoppingEnabledTransformPrecoding;\n-\tfor all other transmissions, sequence hopping and group hopping are enabled or disabled by the respective higher-layer parameters sequenceHopping and sequenceGroupHopping if these parameters are provided, otherwise, the same hopping mode as for Msg3 shall be used.\nThe UE is not expected to handle the case of combined sequence hopping and group hopping.\nThe quantity  above is the OFDM symbol number except for the case of double-symbol DMRS in which case  is the OFDM symbol number of the first symbol of the double-symbol DMRS.\n\n\n6.4.1.3.3.1\tSequence generation\nThe reference-signal sequence  shall be generated according to\n\nwhere  is given by clause 6.3.2.6.3 and  depends on the configuration:\n-\tif the higher-layer parameter dmrsUplinkTransformPrecodingPUCCH-r16 is configured,  is given by clause 5.2.3 with  given by clause 6.4.1.3.2.1. The sequence group  and the sequence number  depend on the sequence hopping in clause 6.3.2.2.1 and the cyclic shift  depends on the cyclic shift hopping in clause 6.3.2.2.2.\n-\totherwise,  is given by clause 6.3.2.2.\n\n \n\nThe cyclic shift  varies with the symbol number and slot number according to clause 6.3.2.2.2 with  for PUCCH format 3 without interlaced mapping and obtained from Table 6.4.1.3.3.1-1 with the orthogonal sequence index  given by clause 6.3.2.6.3 for PUCCH format 3 with interlaced mapping and PUCCH format 4.\nTable 6.4.1.3.3.1-1: Cyclic shift index  for PUCCH format 3 with interlaced mapping and PUCCH format 4.\nOrthogonal sequence index \tCyclic shift index \n\n0\t0\t0\t0\n1\t-\t6\t6\n2\t-\t-\t3\n3\t-\t-\t9\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe Rel.16 DMRS for low PAPR shall only be used when pi/2 BPSK is used for PUCCH, and not when QPSK is used.The current specification indicates that cyclic shift hopping for Rel.16 DMRS is used for PUCCH Format 3 and 4.  However, this is incorrect since the reference signal sequence in this case does not depend on the cyclic shift alpha.DCI format 0_2 is introduced for URLLC in Rel-16. It should be clarified whether the low-PAPR DMRS agreed in Rel-16 can be used for a PUSCH with \u03c0/2-BPSK modulation scheduled by DCI format 0_2.The hihger-layer parameter naems dmrs-UplinkTransformPrecoding-r16, pi2BPSK-ScramblingID0, and pi2BPSK-ScramblingID1 are incorrectly captured.\n\n>>> SUMMARY OF CHANGE\nClarify the description to indicate that this is for pi/2-BPSK only (R1-2002977)Remove redundant text and indicate that alpha=0 (always) in this case. Re-arrange the text so it\u2019s clear the cyclic shift description only applies to Rel.15 behaviour of PUCCH DMRS. (R1-2002977)Add description on sequence generation for a transmission scheduled by DCI format 0_2 if Antenna ports field in the DCI format 0_2 is not 0 bit. (R1-2002791)Alignment of RRC parameter names with 38.331\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is a risk that low-PAPR DMRS is incorrectly used also for QPSK modulation based PUCCH.Risk of confusion. Incomplete specifications.The low-PAPR DMRS agreed in Rel-16 cannot be used for a PUSCH with \u03c0/2-BPSK modulation scheduled by DCI format 0_2.Misalignment with 38.331 with respect to some parameter names."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n\n\n\n\n\n\n\n***** Next change *****\n10.2\tTimers of EPS mobility management\nTable 10.2.1: EPS mobility management timers \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3402\tDefault 12 min.\tNOTE\u00a01\tEMM-DEREGISTERED\tEMM-REGISTERED\tAt attach failure and the attempt counter is equal to 5.\tAt tracking area updating failure and the attempt counter is equal to 5.\tATTACH ACCEPT with EMM cause #16 or #17 and the attempt counter is equal to 5 for CS/PS mode 2 UE, or ATTACH ACCEPT with EMM cause #22, as described in subclause\u00a05.5.1.3.4.3.\tTRACKING AREA UPDATE ACCEPT with EMM cause #16 or #17 and the attempt counter is equal to 5 for CS/PS mode 2 UE, or TRACKING AREA UPDATE ACCEPT with EMM cause #22, as described in subclause\u00a05.5.3.3.4.3.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tInitiation of the attach procedure, if still required or TAU procedure\nT3410\t15s\tEMM-REGISTERED-INITIATED\tATTACH REQUEST sent\tATTACH ACCEPT received\tATTACH REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.1.2.6\nT3411\t10s\tEMM-DEREGISTERED. ATTEMPTING-TO-ATTACH\t\tEMM-REGISTERED. ATTEMPTING-TO-UPDATE\t\tEMM-REGISTERED. NORMAL-SERVICE\tAt attach failure due to lower layer failure, T3410 timeout or attach rejected with other EMM cause values than those treated in subclause\u00a05.5.1.2.5.\t\tAt tracking area updating failure due to lower layer failure, T3430 timeout or TAU rejected with other EMM cause values than those treated in subclause\u00a05.5.3.2.5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tEMM-CONNECTED mode entered (NOTE\u00a06)\tRetransmission of the ATTACH REQUEST, if still required as described in subclause\u00a05.5.1.2.6 or retransmission of TRACKING AREA UPDATE REQUEST\nT3412\tDefault 54 min.\tNOTE\u00a02\tNOTE\u00a05\tEMM-REGISTERED\tIn EMM-REGISTERED, when EMM-CONNECTED mode is left.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode. \tInitiation of the periodic TAU procedure if the UE is not attached for emergency bearer services or T3423 started under the conditions as specified in subclause\u00a05.3.5.\t\tImplicit detach from network if the UE is attached for emergency bearer services.\nT3416\t30s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tRAND and RES stored as a result of an EPS authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tTRACKING AREA UPDATE ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\tEMM-DEREGISTERED, EMM-NULL or\tEMM-IDLE mode entered\tDelete the stored RAND and RES\nT3417\t5s\tEMM-SERVICE-REQUEST-INITIATED\tSERVICE REQUEST sent\tEXTENDED SERVICE REQUEST sent in case f, g, i and j in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent with service type set to \u201cpacket services via S1\u201d in case a, b, c, h and k in subclause 5.6.1.1\tBearers have been set up\tSERVICE REJECT received\tIndication of system change from lower layer received\tcdma2000\u00ae 1xCS fallback rejection received\tAbort the procedure\nT3417ext\t10s\tEMM-SERVICE-REQUEST-INITIATED\tEXTENDED SERVICE REQUEST sent in case d in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent in case e in subclause\u00a05.6.1.1 and the CSFB response was set to \"CS fallback accepted by the UE\"\tInter-system change from S1 mode to A/Gb mode or Iu mode is completed\tInter-system change from S1 mode to A/Gb mode or Iu mode is failed\tSERVICE REJECT received\tSelect GERAN or UTRAN if EXTENDED SERVICE REQUEST was sent due to mobile originated CS fallback. Otherwise, abort the procedure.\nT3418\t20s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (EMM cause = #20 \"MAC failure\" or #26 \"non-EPS authentication unacceptable\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\twhen entering EMM-IDLE mode\t\tindication of transmission failure of AUTHENTICATION FAILURE message from lower layers\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3420\t15s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (cause = #21 \"synch failure\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\twhen entering EMM-IDLE mode\t\tindication of transmission failure of AUTHENTICATION FAILURE message from lower layers\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3421\t15s\tEMM-DEREGISTERED-INITIATED\tEMM-\nREGISTERED.\nIMSI-DETACH-\nINITIATED\tDETACH REQUEST sent with \tthe Detach type IE not indicating \"switch off\"\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3423\tNOTE\u00a03\tEMM-REGISTERED\tT3412 expires while ISR is activated and either T3346 is running or the UE is in one of the following states:\t- EMM-REGISTERED.NO-CELL-AVAILABLE;\t- EMM-REGISTERED.PLMN-SEARCH; \t-EMM-REGISTERED.UPDATE-NEEDED; or\t-EMM-REGISTERED.LIMITED-SERVICE.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode.\tSet TIN to \"PTMSI\".\tFor A/Gb mode or Iu mode, see 3GPP\u00a0TS\u00a024.008\u00a0[13]\nT3430\t15s\tEMM-TRACKING-AREA-UPDATING-INITIATED\tTRACKING AREA UPDATE REQUEST sent\tTRACKING AREA UPDATE ACCEPT received\tTRACKING AREA UPDATE REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.3.2.6\nT3440\t10s\tEMM-REGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tEMM-REGISTERED\tATTACH REJECT, DETACH REQUEST, TRACKING AREA UPDATE REJECT with any of the EMM cause #7, #8, #11, #12, #13, #14, #15 or #35\tSERVICE REJECT received with any of the EMM cause #7, #8, #11, #12, #13, #15 or #35\tTRACKING AREA UPDATE ACCEPT received after the UE sent TRACKING AREA UPDATE REQUEST in EMM-IDLE mode with no \"active\" flag and the user-plane radio bearers have not been setup\tDETACH ACCEPT received after the UE sent DETACH REQUEST with detach type to \"IMSI detach\"\tNAS signalling connection released\tBearers have been set up or a request for PDN connection for emergency bearer services or a CS emergency call is started\tRelease the NAS signalling connection for the cases a), b) and c) as described in subclause\u00a05.3.1.2\n\t\tEMM-DEREGISTERED\tEMM-DEREGISTERED.NORMAL-SERVICE\tTRACKING AREA UPDATE REJECT, SERVICE REJECT with any of the EMM cause #9, #10 or #40\tNAS signalling connection released\t\tRelease the NAS signalling connection for the cases d) and e) as described in subclause\u00a0 5.3.1.2 and initiation of the attach procedure as specified in subclause\u00a05.5.3.2.5, 5.5.3.3.5 or 5.6.1.5 \nT3442\tNOTE\u00a04\tEMM-REGISTERED\tSERVICE REJECT received with EMM cause #39 \"CS service temporarily not available\" with a non-zero T3442 value\tTRACKING AREA UPDATE REQUEST sent\tNone\n\nNOTE\u00a01:\tThe cases in which the default value of this timer is used are described in subclause\u00a05.3.6.\tNOTE\u00a02:\tThe value of this timer is provided by the network operator during the attach and tracking area updating procedures.\tNOTE\u00a03:\tThe value of this timer may be provided by the network in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. The default value of this timer is identical to the value of T3412.\tNOTE\u00a04:\tThe value of this timer is provided by the network operator when a service request for CS fallback is rejected by the network with EMM cause #39 \"CS service temporarily not available\".\tNOTE\u00a05:\tThe default value of this timer is used if the network does not indicate a value in the TRACKING AREA UPDATE ACCEPT message and the UE does not have a stored value for this timer.\tNOTE\u00a06:\tThe conditions for which this applies are described in subclause\u00a05.5.3.2.6.\n\nTable 10.2.2: EPS mobility management timers \u2013 network side\nTIMER NUM.\tTIMER VALUE\tSTATE \tCAUSE OF START\tNORMAL STOP\tON THE\n1st, 2nd, 3rd, 4th EXPIRY (NOTE\u00a01)\nT3413\tNOTE\u00a02\tEMM-REGISTERED\tPaging procedure for EPS services initiated\tPaging procedure for EPS services completed\tPaging procedure is aborted.\tNetwork dependent\nT3422\t6s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3450\t6s\tEMM-COMMON-PROC-INIT\tATTACH ACCEPT sent\t\tTRACKING AREA UPDATE ACCEPT sent with GUTI\t\tTRACKING AREA UPDATE ACCEPT sent with TMSI\t\tGUTI REALLOCATION COMMAND sent\tATTACH COMPLETE received\tTRACKING AREA UPDATE COMPLETE received\tGUTI REALLOCATION COMPLETE received\tRetransmission of the same message type, i.e. ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT or GUTI REALLOCATION COMMAND\nT3460\t6s\tEMM-COMMON-PROC-INIT\tAUTHENTICATION REQUEST sent\t\tSECURITY MODE COMMAND sent\tAUTHENTICATION RESPONSE received\tAUTHENTICATION FAILURE received\tSECURITY MODE COMPLETE received\tSECURITY MODE REJECT received\tRetransmission of the same message type, i.e. AUTHENTICATION REQUEST\tor SECURITY MODE COMMAND\nT3470\t6s\tEMM-COMMON-PROC-INIT\tIDENTITY REQUEST sent\tIDENTITY RESPONSE received\tRetransmission of IDENTITY REQUEST\nMobile reachable\tNOTE 4\tAll except EMM-DEREGISTERED\tEntering EMM-IDLE mode\tNAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry if the UE is not attached for emergency bearer services.\t\tImplicitly detach the UE which is attached for emergency bearer services.\nImplicit detach timer\tNOTE 3\tAll except EMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in EMM-IDLE mode \tNAS signalling connection established\tImplicitly detach the UE on 1st expiry\nactive timer\tNOTE 5\tAll except EMM-DEREGISTERED\tEntering EMM-IDLE mode\tNAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry if the UE is not attached for emergency bearer services.\nNOTE\u00a01:\tTypically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding procedure description.\tNOTE\u00a02:\tThe value of this timer is network dependent.\tNOTE\u00a03:\tThe value of this timer is network dependent. If ISR is activated, the default value of this timer is 4 minutes greater than T3423.\tNOTE\u00a04:\tThe default value of this timer is 4 minutes greater than T3412. If T3346 is larger than T3412 and the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or SERVICE REJECT message, the value of the mobile reachable timer and implicit detach timer is set such that the sum of the timer values is greater than T3346. If the UE is attached for emergency bearer services, the value of this timer is set equal to T3412.\tNOTE\u00a05:\tIf the MME includes timer T3324 in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message and if the UE is not attached for emergency bearer services and has no PDN connection for emergency bearer services, the value of this timer is equal to the value of timer T3324.\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe current UE behaviour of processing NAS reject messages without protection can result in DoS attacks caused by malicious networks. One of the examples (but not limited to) is as follows: the UE can send a TAU Request message, which is integrity-protected using the existing NAS security context but not encrypted. As a result, a rogue eNodeB can decode it and respond with a \u201cTAU Reject\u201d message including the cause #7 \u201cLTE services not allowed\u201d without the integrity protection. According to the current specification TS24.301, this reject message will be processed by the UE, which reacts on the indicated rejection cause by deleting all existing EPS context. Furthermore, the UE updates the status to \u201cEU3 ROAMING NOT ALLOWED\u201d and considers the USIM (and hence the UE) as invalid for EPS services until it is rebooted or USIM is reinserted.\n\n>>> SUMMARY OF CHANGE\nIf the UE receives the ATTACH REJECT, the TRACKING AREA UPDATE REJECT, or the SERVICE REJECT message which is not integrity protected, UE shall start a timer.\n\n>>> CONSEQUENCES IF NOT REVISED\nTechnical vulnerability in the specification can cause DoS attacks against UEs with high impact."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * First Change * * * *\n6.1.3.1\tDetailed behaviour\nThe HSS shall take note of the subscription request on the data identified by User Identity and Data-Reference. If notifications on changes of repository data are requested, Service-Indication shall be present in the request. If notifications on changes of filter criteria are requested, the Server-Name AVP shall be used as key to the filter criteria. If the request contains a specific Public Service Identity matching a Wildcarded PSI, the HSS shall interpret that the subscription refers to the information associated to the Wildcarded PSI. The Server-Name AVP shall contain the SIP URL of the AS sending the request. If notifications on changes of DSAI are requested, the DSAI-Tag AVP shall be used as key of the DSAI whose changes are to be monitored.\nUpon reception of the Sh-Subs-Notif request, the HSS shall, in the following order (if there is an error in any of the following steps the HSS shall stop processing and return the corresponding error code, see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7]):\n1.\tIn the AS permission list (see section 6.2) the HSS shall check that the AS is allowed to subscribe to notifications (Sh-Subs-Notif) for the requested data by checking the combination of the identity of the AS sending the request (identified by the Origin-Host AVP) and the supplied Data-Reference.\n-\tIf this AS does not have Sh-Subs-Notif permission for the data referenced, Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_NOTIFIED in the Sh-Subs-Notif Response.\n2.\tCheck that the IMS Public User Identity or Public Service Identity in the request exists in HSS. If not, Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Subs-Notif Response.\n3.\tIf the User Identity does not apply to the Data-Reference indicated in the request according to Table 7.6.1, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Subs-Notif Response.\n3a.\tIf Data-Reference is DSAI (19), check whether or not, for the Public Identity, there is an instance of DSAI matching the DSAI-Tag contained in the Sh-Subs-Notif command. If not, Experimental-Result shall be set to DIAMETER_ERROR_DSAI_NOT_AVAILABLE.\n4.\tIf the Sh-Subs-Notif Request contains an Expiry Time, the HSS should also include in the Sh-Subs-Notif Response an Expiry Time IE with the absolute time at which the subscription expires in the case of a successful subscription. This time may be earlier than the requested expiry time. If the HSS includes this IE, then no notification shall be sent to the AS after the expiration time. If the HSS receives a Sh-Subs-Notif Request without the Expiry Time IE, the HSS should treat it as a request for an unlimited subscription. \nIf the HSS does not include this IE in the response, that indicates an unlimited subscription. \nIf a subsequent request is received by the HSS where the Expiry Time IE is present but different from what the HSS has previously stored, the HSS should replace the stored expiration time with what was received in the request. \n5.\tIf Data-Reference is RepositoryData(0) and the transparent data associated with the Service Indication does not exist in the HSS (i.e. Service Data is not present), then Experimental-Result shall be set to DIAMETER_ERROR_SUBS_DATA_ABSENT.\n6.\tIf the Subscription request type information element indicates that this is a request to subscribe, the HSS shall associate the Application Server Identity with the list of entities that need to be notified when the data identified by the request is modified and set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify response.  If the Subscription request type information element indicates that this is a request to unsubscribe, the HSS shall remove the association of the Application Server Identity with the same list.  In this last case, the Result-Code shall be set to DIAMETER_SUCCESS if the operation is successful or if the Application Server Identity was not present in the list.\n7.\tIf the HSS and AS supports the Notif-Eff feature and if multiple Data-Reference AVPs occur in the Sh-Subs-Notif Request, each Data-Reference shall be treated as a request to establish a separate notification request.  When mulitiple notification requests are requested, and all of them succeed, the HSS shall set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify response.\n8.\tIf the HSS and AS supports the Notif-Eff feature and if multiple Service-Indication AVPs occur in the Sh-Subs-Notif Request, each Service-Indication shall be treated as a request to establish a separate notification request for change of Transparent data.  When mulitiple notification requests are requested, and all of them are successful, the HSS shall return the Result-Code set to DIAMETER_SUCCESS in the Sh-Subs-Notify response. \n\n9.\tIf the Send Data Indication information element is present in the request and the HSS supports the return of the User-Data in this request, check whether or not the data that is requested to be downloaded by the AS is currently being updated by another entity.  If there is an update of the data in progress, the HSS may delay the response until the update has been completed. The HSS shall ensure that the data returned is not corrupted by this conflict.\n10.\tIf the Send Data Indication information element is present in the request, the HSS should include the data pertinent to the requested Data Reference in the User-Data AVP and if the HSS supports the Notif-Eff feature, the HSS should include the data pertinent to all the requested Data References in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS. This includes cases where the data is not available to the HSS and an empty tag is included as follows. Empty elements of Sh IMS Data shall be indicated as follows. An empty S-CSCF name shall be indicated with empty SCSCFName element. If all iFCs for the user that are relevant for the AS are empty it shall be indicated with empty IFCs element. Similarly for PSI activation information. \nIf the HSS cannot fulfil the received request for reasons not stated in the above steps, e.g. due to database error, it shall stop processing the request and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.\n\n* * * Next Change * * * *\n6.1.4.1\tDetailed behaviour\nThe keys to the updated data are part of the information element User-Data AVP. When data repository is updated Service-Indication and Sequence Number shall also be part of the information element User-Data.\nSince authentication pending is a transient state of normally very short duration, notification of an IMS user's state change, to and from the authentication pending state shall not be sent to Application Servers, when the previous state before authentication pending and next state after authentication pending are the same. If the states are different before the authentication pending state is entered and after the authentication pending state is left then notification is sent to the AS of this new state.\nIf the HSS and AS supports the Notif-Eff feature and if multiple subscriptions to notifications are associated with a Public User Identity, the HSS may combine the notifications for multiple Data References and Service Indications into a single notification message.\nRemoval of the subscribed data is indicated with the content of User-Data AVP. The content shall be compliant with the XML-schema defined in Annex D. Removed repository data shall be indicated with RepositoryData element that does not contain ServiceData element. Removed S-CSCF name shall be indicated with empty SCSCFName element. Removed IP Address Secure Binding Information shall be indicated with empty IPv4Addres, or IPv6Prefix and/ or IPv6 interface element respectively. If all iFCs for the user that are relevant for the AS have been removed it shall be indicated with empty IFCs element.\nRemoval of Public Identity for which the AS has any active subscription other than IMSPublicIdentity (see table ) shall be indicated in the DeletedIdentities element. \nIf One-Time-Notification AVP was included by the AS in Sh-Subs-Notif, the HSS shall remove the related subscription information after sending Sh-Notif, i.e. no subsequent notifications shall be sent to AS.\nTable 6.1.4.1 details the valid result codes that the AS can return in the response.\nTable 6.1.4.1.1: Sh-Notif response valid result codes\nResult-Code AVP value\tCondition\nDIAMETER_SUCCESS\tThe request succeeded.\nDIAMETER_ERROR_USER_DATA_NOT_RECOGNIZED\tThe request failed. The AS informs the HSS that the received user information contained information, which was not recognized or supported by the AS.\nDIAMETER_ERROR_USER_UNKNOWN\tThe request failed because the Public Identity is not found in the AS. \nDIAMETER_ERROR_TOO_MUCH_DATA\tThe request failed. The AS informs the HSS that it tried to push too much data into the AS.\nDIAMETER_ERROR_NO_SUBSCRIPTION_TO_DATA\tThe request failed. The AS informs the HSS that the notification refers to information to which the AS is not subscribed.\nDIAMETER_UNABLE_TO_COMPLY\tThe request failed.\n\n* * * Next Change * * * *\n\nC.1\tGeneral description\nThe following picture gives an outline of the UML model of the user profile, which is exchanged between the HSS and an AS:\n\nFigure C.1.1: Sh-Data\nEach instance of the Sh-Data class contains 0 or 1 instance of the class PublicIdentifiers, 0 or n instances of the class RepositoryData, 0 or 1 instance of the class Sh-IMS-Data, 0 or 1 instance of the class CSUserState, 0 or 1 instance of the class PSUserState 0 or 1 instance of the class CSLocationInformation and 0 or 1 instance of the class PSLocationInformation, 0 or 1 instance of the class RegisteredIdentities, 0 or 1 instance of the class ImplicitIdentities, 0 or 1 instance of the class AllIdentities, 0 or 1 instance of the class AliasIdentities, and 0 or 1 instance of the class DeletedIdentities.\nIf AS and HSS both support the Notif-Eff feature and AS requires more than one identity sets of a public identity, or it has subscribed to be notifed of changes to IMSPublicIdentity (see table 7.6.1), the class PublicIdentifiers shall not be used. Instead the classes RegisteredIdentities, ImplicitIdentities, AllIdentities and AliasIdentities shall be used and they contain the REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and ALIAS_IDENTITIES associated with the IMS Public Identity included in the request respectively, See Table .1 for the detailed information. The class PublicIdentifiers or the one among the four which may be used to contain the correspongding identity set can both be used when AS requires only one identity set of a public identity.\nIf AS or HSS do not support the Notif-Eff feature, the classes RegisteredIdentities, ImplicitIdentities and AllIdentities shall not be used. Instead the class PublicIdentifiers shall be used. \nIf Public Identity(ies) are deleted and the AS hassubscribed to be notified of changes to IMSPublicIdentity(see table ), the class DeletedIdentities shall not be used.If Public Identity(ies) are deleted and the AS has not subscribed to be notified of changes to IMSPublicIdentity but has any other subscription active for the deleted identity(ies), the HSS shall notify the AS of the deletion of the identity(ies) using the class DeletedIdentities.\nClass RepositoryData contains repository data (transparent data) for a given service that are associated to a Public user Identity or a group of alias Public User Identities. It has attributes ServiceIndication, SequenceNumber and ServiceData.\nClass CSUserState contains the state of a user in the CS domain. Its only attribute, State, is an enumeration whose possible values are defined in section 7.6.7.\nClass PSUserState contains the state of a user in the PS domain. Its only attribute, State, is an enumeration whose possible values are defined in section 7.6.7.\nNOTE: the fact that attribute State is an enumeration is a difference from what can be carried in the MAP protocol.\nClass CSLocationInformation has the attributes Location Number, Service Area ID, GlobalCellId, LocationAreaId, GeographicalInformation, GeodeticInformation, VLR Number, MSC Number, AgeOfLocationInformation and CurrentLocationRetrieved and UserCSGInformation. They are defined in 7.6. \nClass PSLocationInformation has the attributes ServiceAreaId, GlobalCellId, LocationAreaID, RoutingAreaID, GeographicalInformation, GeodeticInformation, SGSN Number, AgeOfLocationInformation and CurrentLocationRetrieved and UserCSGInformation. They are defined in 7.6.\nClass DeletedIdentities contains Public Identities (IMS Public User Identities or Public Service Identities) removed from the HSS.\nClass UEreachabilityForIP contains the UE reachability for IP. Its only attribute, UE-IP-Reachable-MME, is an enumeration whose possible values are defined in section 7.6.17.\n\n* * * End of changes * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the AS has subscribed to be notified of changes to IMSPublicIdentity data reference, for more than one Identity-Set AVP, when identities for any of the subscribed Identity-Sets are modified, the Sh-Notif has to provide the AS with the modified Identities for the corresponding Set, but as well with the means to identify which Identity-Set they belong to. This is required regardless the subscription for multiple Identity-Sets was done by just one single Sh-Subs-Notif message (if Notif-Eff feature is supported) or using different Sh-Subs-Notif messages (support of Notif-Eff is not required).In nowadays TS, the only way to provide information about the corresponding Identity-Set is to use following XML classes in the User-Data AVP that is returned in Sh-Notif: REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and ALIAS_IDENTITIES.However, these XML classes are defined as part of Notif-Eff feature, from Rel-7 (C4-060844 and C4-060845 in CP-060319). This is incorrect, since the HSS needs to provide information about the type of identity included in the Identity-Set even when Notif-Eff feature is not supported.This means, that when Notif-Eff feature is not supported, there is an interoperability problem for this particular case, since Sh-Notif is unable to include the type of identity set. In fact, this interoperability issue was the only reason why in Rel-7 Notif-Eff feature was updated as Mandatory (so new required XML classes were always supported).The proposal is to define  REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and ALIAS_IDENTITIES classes as independent from the Notif-Eff feature, as part of a mandatory behaviour that is required for interoperability reasons. With this, Sh-Notif with multiple Identity-Sets may be supported independently from Notif-Eff feature support.Once these classes are mandatory independently of feature support, Notif-Eff feature can safely be defined as Optional. Anyway, a feature is de facto always defined as optional, as long as a feature always needs to be announced with Supported-Features AVP and it is checked all along the procedure description whether or not the Notif-Eff feature is supported by both the HSS and the AS (e.g. \"If the HSS and the AS supports the Notif-Eff feature\").\n\n>>> SUMMARY OF CHANGE\nIndicate that Sh-Notif may include notifications for multiple Identity-SetsCorrection of which data is returned in Sh-Pull-Response or Sh-Notif when IMSPublicIdentity data reference is requested to be read or notified.Other error correction:Sh-Subs-Notif procedure is update to include that if the HSS and AS supports the Notif-Eff feature, the Sh-Subs-Notif message may include multiple Identity Sets.\n\n>>> CONSEQUENCES IF NOT REVISED\nInteroperability problem.Sh-Notif including information of identity type is not supported unless Notif-Eff feature is supported. This functionality is mandatory for interoperability if the AS subcribes to be notified of changes to IMSPublicIdentity for more than one Identity Sets."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nBEGIN OF CHANGE\n\n4.4\tIssues to be addressed\nThe current specifications of SIM and USIM in 3GPP assume a one-to-one association between the UICC and the Mobile Equipment (ME) to constitute the User Equipment (UE). While this assumption holds in many situations it does not hold for many of the examples illustrated in figure\u00a03, especially in the context of WLAN. This section attempts to capture some of the important issues that need to be addressed for making (U)SIM re-use feasible for the usage scenarios illustrated in figure 3.\nFor these diverse usage models the specific security threats and issues need to be studied and appropriate security requirements need to be specified to counteract the threats. Following are some security related issues:\n-\tIssue 1: The (U)SIM authentication process once it is complete, the key setting procedure that takes place assumes further use of the same radio interface, namely GSM, GPRS or 3G. For the case of GPRS the Kc and CKSN are saved on the SIM for the subsequent authentications. For the 3G case, the CK and IK are saved for subsequent authentications also.\n-\tIssue 2: The ME that needs to check the presence of the (U)SIM may not be effectively able to do that as is done today for 3GPP terminals when the (U)SIM is re-used for WLAN authentication over a BT link. The Bluetooth link, if for some reason encounters some interference that prevents SIM presence detection, the WLAN session authenticated using the local link will have to be dropped.\n-\tIssue 3: If Pseudonyms are used for Identity privacy as specified in EAP-SIM and EAP-AKA protocols they could be stored on the SIM and USIM respectively or on the ME. This may require additional specification for secure storage.\n-\tIssue 4: The SIM and USIM user authentication (PIN entry based) that is performed for the native GPRS/GSM or 3GPP system use and also will be needed for the WLAN use for better protection. This may require additional specification and modifications to the (U)SIM or security architecture specifications.\n-\tIssue 5. How many and which kind of UE's should be allowed to have simultaneous access and should the number of UE's be visible to operators?\n-\tIssue 6. Which degree of control does the device holding the (U)SIM require on the type of operations that other devices perform with its (U)SIM?\nNOTE:\tRelated to issues 1, 3, and 4: The SIM specification was frozen at Rel4 and cannot be changed. If any other information (e.g. keys or pseudonyms) is deemed useful to be stored on the UICC, new fields need to be specified. These fields are expected to be both device- and access-specific (e.g. stored WLAN keys are not useful for 3GPP access).\n\nEND OF CHANGE\n\nBEGIN OF CHANGE\n6\tPotential Requirements\nAccording to the proposal, \"(U)SIM Security Reuse by Peripheral Devices on Local Interfaces\" the (U)SIM card may reside in a 3GPP UE and be accessed by a WLAN-UE through Bluetooth, IR or a USB cable or some other similar wired or wireless interconnect technology. This would facilitate the user to get simultaneous WLAN and 3GPP access with the same (U)SIM. In order to accomplish this, while at the same time addressing the issues and threats mentioned above, following requirements shall be satisfied:\nR1.\tA secured interface between the device holding the (U)SIM and the device with the radio interface is required. This interface must be able to protect against eavesdropping, and undetected modification attacks on security-related signalling data (e.g. authentication challenges and responses). Cryptographic or physical means may be used for this purpose.\nR2.\tFor cryptographic means, the encryption key length shall be at least 128\u00a0bits.\nR3.\tKeys used for local interface transport security should not be shared across local interface links. Each local interface must use unique keys. (For example in Bluetooth, Combination of Link keys shall be used. In case of Bluetooth, the keys may change when a new SIM Access Profile connection is established).\nR4.\tBoth endpoints of the local interface shall be mutually authenticated and authorized.\nR5.\tThe device without (U)SIM should be capable of discovering the device(s) with (U)SIM in its proximity.\nR6.\tThe peripheral device without (U)SIM shall be capable of communicating with the U(SIM) only if the device containing (U)SIM is switched on and a (U)SIM is powered on. Furthermore the device without (U)SIM shall not be allowed to change the status of the device with (U)SIM, or the remote (U)SIM, e.g.\u00a0to reset it, or to switch its power on or off.\nR7.\tThe peripheral device without the (U)SIM shall be capable of detecting the presence and availability of the (U)SIM on the device containing it. It also has the ability to terminate an authenticated network sessions when, the (U)SIM is no longer accessible within a short monitoring time period.\nR8.\tUser shall have the capability to shut off sharing of (U)SIM feature. The owner of the device, holding the (U)SIM should authorize its use.\nR9.\tIntegrity and privacy of signalling between the WLAN system and the 3GPP core network shall be supported. Leakage of (U)SIM information to the user, or any third party over the wireless interface (Bluetooth/WLAN) is the major security threat. This leakage of information should be guarded against.\nR10.\tWhenever someone tries to remotely access a (U)SIM some sort of alert may be sent, e.g. a message will be displayed informing the user of the access. The user can then decide whether the access is authorized and can allow or disallow it. The security level must be the same or better than present GSM System or as defined by IETF (EAPSIM, EAPAKA) and shall apply to Circuit Switched (CS) domain as well as Packet Switched (PS) domain.\nR11.\tIt shall be possible to simultaneously access both WLAN and 3GPP radio access technologies, i.e. it should support simultaneous calls on two different air interfaces. For example, the UE might use the WLAN for data services (internet access) together with the 3GPP system for a speech call. The UE and the WLAN and 3GPP systems might elect to use both access technologies simultaneously in order to balance traffic, system capabilities or for radio resource management.\nR12.\tThe UICC bearing device should be responsible for serializing access to the (U)SIM Application/Data.\nR13.\tThe user should be able to select (U)SIM and TEs as part of their user equipment combination.\nR14.\tA standardized API for access to capabilities provided by an MT (TE) towards a TE (MT) across Operating Systems must be provided.\nR15.\tUICC presence detection shall be supported via the local interface. The local interface may need to address Issue No. 2, e.g. by retransmission of the STATUS command.\nR16.\tSecurity Reuse shall be consistent with current security arrangements for Release 6 and ensure that user security is not compromised.\nR17.\tApplications/Data information could be retrieved from (U)SIM, provided that (U)SIM is inserted in a 3GPP ME. When the (U)SIM is re-used over local interfaces, further access control on the Applications/Data information should be applied by the 3GPP ME bearing the (U)SIM.\nNOTE:\tThis access control, related to Issue No. 6, is ffs.\n\nEND OF CHANGE\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe smart card could be involved in the security mechanisms defined to fulfill the security requirements identified in TR 33.817. So, the terminology shall take into account the presence of the smart card.\n\n>>> SUMMARY OF CHANGE\nTerminology update to not rule out the use fo the smart card for security enhancements.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe smart card could not be involved in the security mechanisms."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*** BEGIN CHANGES ***\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TR\u00a021.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.501: \"System Architecture for the 5G System\".\n[3]\t3GPP\u00a0TS\u00a033.210: \"3G security; Network Domain Security (NDS); IP network layer security\".\n[4]\tIETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\". \n[5]\t3GPP\u00a0TS\u00a033.310: \"Network Domain Security (NDS); Authentication Framework (AF)\". \n[6]\tIETF RFC 4301: \"Security Architecture for the Internet Protocol\".\n[7]\t3GPP TS 22.261: \"Service requirements for next generation new services and markets\".\n[8]\t3GPP TS 23.502: \"Procedures for the 5G System\".\n[9]\t3GPP TS 33.102: \"3G security; Security architecture\".\n[10]\t3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security architecture\".\n[11]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses\".\n[12]\tIETF RFC 5488: \" Network Mobility (NEMO) Management Information Base\".\n[13]\t3GPP TS 24.301: \" Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[14]\t3GPP TS 35.215: \" Specification of the 3GPP Confidentiality and Integrity Algorithms UEA2 & UIA2; Document 1: UEA2 and UIA2 specifications\". \n[15]\tNIST: \"Advanced Encryption Standard (AES) (FIPS PUB 197)\".\n[16]\tNIST Special Publication 800-38A (2001): \"Recommendation for Block Cipher Modes of Operation\".\n[17]\tNIST Special Publication 800-38B (2001): \"Recommendation for Block Cipher Modes of Operation: The CMAC Mode for Authentication\".\n[18]\t3GPP TS 35.221: \" Specification of the 3GPP Confidentiality and Integrity Algorithms EEA3 & EIA3; Document 1: EEA3 and EIA3 specifications\".\n[19]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[20]\t3GPP TS 22.101: \"Service aspects; Service principles\".\n[21]\tIETF RFC 4187: \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)\".\n[22]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol specification\".\n[23]\t3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP) specification\".\n[24]\t3GPP TS 33.117: \"Catalogue of general security assurance requirements\".\n[25]\tIETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\"\n[26]\tIETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\"\n[27]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[28]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA)\".\n[29]\tSECG SEC 1: Recommended Elliptic Curve Cryptography, Version 2.0, 2009. Available \n[30]\tSECG SEC 2: Recommended Elliptic Curve Domain Parameters, Version 2.0, 2010. Available at \n[31]\t3GPP TS 38.470: \"NG-RAN; F1 General aspects and principles\".\n[32]\t3GPP TS 38.472: \"NG-RAN; F1 signalling transport\".\n[33] \t3GPP TS 38.474: \"NG-RAN; F1 data transport\".\n[34]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\"\n[35]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[36] \t3GPP TS 35.217: \"Specification of the 3GPP Confidentiality and Integrity Algorithms UEA2 & UIA2; Document 3: Implementors' test data\".\n[37] \t3GPP TS 35.223: \"Specification of the 3GPP Confidentiality and Integrity Algorithms EEA3 & EIA3; Document 3: Implementors' test data\".\n[38]\tIETF RFC 5216: \"The EAP-TLS Authentication Protocol\".\n[39]\tIETF RFC 4346: \"The Transport Layer Security (TLS) Protocol Version 1.1\". \n[40]\tIETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version 1.2\".\n[41]\t3GPP TS 38.460: \"NG-RAN; E1 general aspects and principles\".\n[42]\tIETF RFC 4282: \"The Network Access Identifier\".\n[43]\tIETF RFC 6749: \"OAuth2.0 Authorization Framework\".\n[44]\tIETF RFC 7519: \"JSON Web Token (JWT)\".\n[45]\tIETF RFC 7515: \"JSON Web Signature (JWS)\".\n[46]\tIETF RFC 7748: \"Elliptic Curves for Security\".\n[47]\tIETF RFC 7540: \" Hypertext Transfer Protocol Version 2 (HTTP/2)\".\n\n\n\n\n*** NEXT CHANGES ***\n\n7.2.1\tAuthentication for Untrusted non-3GPP Access\nThis clause specifies how a UE is authenticated to 5G network via an untrusted non-3GPP access network. It uses a vendor-specific EAP method called \"EAP-5G\", utilizing the \"Expanded\" EAP type and the existing 3GPP Vendor-Id, registered with IANA under the SMI Private Enterprise Code registry. The \"EAP-5G\" method is used between the UE and the N3IWF and is utilized for encapsulating NAS messages. If the UE needs to be authenticated by the 3GPP home network, any of the authentication methods as described in clause 6.1.3 can be used. The method is executed between the UE and AUSF as shown below. \nWhen possible, the UE shall be authenticated by reusing the existing UE NAS security context in AMF.\n\nFigure 7.2.1-1: Authentication for untrusted non-3GPP access\n1.\tThe UE connects to an untrusted non-3GPP access network with procedures outside the scope of 3GPP. When the UE decides to attach to 5GC network, the UE selects an N3IWF in a 5G PLMN, as described in TS 23.501 [2] clause 6.3.6.\n2.\tThe UE proceeds with the establishment of an IPsec Security Association (SA) with the selected N3IWF by initiating an IKE initial exchange according to RFC 7296 [25]. After step 2 all subsequent IKE messages are encrypted and integrity protected by using the IKE SA established in this step.\n3.\tThe UE shall initiate an IKE_AUTH exchange by sending an IKE_AUTH request message. The AUTH payload is not included in the IKE_AUTH request message, which indicates that the IKE_AUTH exchange shall use EAP signalling (in this case EAP-5G signalling). The UE shall set the UE Id field in this message equal to any random number. The UE shall not use its GUTI/SUCI/SUPI as the Id in this step. \n4.\tThe N3IWF responds with an IKE_AUTH response message which includes an EAP-Request/5G-Start packet. The EAP-Request/5G-Start packet informs the UE to initiate an EAP-5G session, i.e. to start sending NAS messages encapsulated within EAP-5G packets.\n5.\tThe UE shall validate the N3IWF certificate and shall confirm that the N3IWF identity matches the N3IWF selected by the UE. An absence of the certificate from the N3IWF or unsuccessful identity confirmation shall result in a connection failure. The UE shall send an IKE_AUTH request which includes an EAP-Response/5G-NAS packet that contains a Registration Request message containing UE security capabilities and the SUCI. The N3IWF shall refrain from sending an EAP-Identity request. The UE may ignore an EAP Identity request or respond with the SUCI it sent in the Registration Request.\nNOTE: \tThe N3IWF does not send an EAP-Identity request because the UE includes its identity in the IKE_AUTH request in message 5. This is in line with RFC 7296 [25], clause 3.16. \n6.\tThe N3IWF shall select an AMF as specified in TS 23.501 [2], clause 6.5.3. The N3IWF forwards the Registration Request received from the UE to the AMF.\n7.\tIf the AMF decides to authenticate the UE, it shall use one of the methods from clause 6.1.3. In this case, the AMF shall send a key request to the AUSF. The AUSF may initiate an authentication procedure as specified in clause 6.1.3. Between AMF and UE, the authentication packets are encapsulated within NAS authentication messages and the NAS authentication messages are encapsulated within EAP-5G/5G-NAS packets. \nIn the final authentication message from the home network, the AUSF shall send the anchor key KSEAF derived from KAUSF to the SEAF. The SEAF shall derive the KAMF from KSEAF and send it to the AMF which is used by the AMF to derive NAS security keys. If EAP-AKA' is used for authentication as described in clause 6.1.3.1, then the AUSF shall include the EAP-Success. The UE also derives the anchor key KSEAF and from that key it derives the KAMF followed by NAS security keys. \n8.\tThe AMF shall send a Security Mode Command (SMC) to the UE in order to activate NAS security. This message is first sent to N3IWF (within an N2 message) together with the N3IWF key (KN3IWF). If EAP-AKA' is used for authentication, the AMF shall encapsulate the EAP-Success received from AUSF within the SMC message. \n9.\tThe N3IWF shall forward the NAS SMC to UE within an EAP-Request/5G-NAS packet.\n10.\tThe UE completes the authentication (if initiated in step 7) and creates a NAS security context. UE shall respond to the NAS SMC it received from the AMF based on the selected algorithms and parameters as described in clause 6.7.2. The UE shall encapsulate the NAS SMC Complete in the EAP-5G Response.\n11. The N3IWF shall forward the NAS packet containg NAS SMC Complete to the AMF over the N2 interface.\n12. The AMF upon reception of the NAS SMC Complete from the UE, initiates the NGAP procedure to set up the AN context. AMF shall compute the N3IWF key, KN3IWF, for the establishment of the IPsec SA between the UE and the N3IWF and shall include it in the NGAP Initial Context Setup Request sent to the N3IWF. \n13. N3IWF sends an EAP-Success/EAP-5G to the UE upon reception of the NGAP Initial Context Setup Request containing the N3IWF key, KN3IWF. This completes the EAP-5G session and no further EAP-5G packets are exchanged. If the N3IWF does not receive the N3IWF key from AMF, the N3IWF shall respond with an EAP-Failure\n14.\tThe IPsec SA is established between the UE and N3IWF by using the common N3IWF key KN3IWF that was created in the UE and was received by N3IWF from the AMF in step 9.\n15. Upon successful establishment of the IPsec SA between the UE and the N3IWF, the N3IWF shall send the NGAP Initial Context Setup Response message to the AMF.\n16. When NGAP Initial Context Setup Response for the UE is received by the AMF, AMF shall send the NAS Registration Accept message for the UE over the N2 towards the N3IWF.\n17. Upon receiving the NAS Registration Accept message from the AMF, the N3IWF shall forward it to the UE over the established IPsec SA. All further NAS messages between the UE and the N3IWF shall be sent over the established IPsec SA. \nEditor\u2019s Note: Steps 16 and 17 above are pending discussion in SA2\n*** END of CHANGES ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCertificate-based N3IWF authentication is not needed for non-3GPP access since there does not exist a threat which would justify that UEs need to be able to validate the certificate of the N3IWF of the visited network.\n\n>>> SUMMARY OF CHANGE\nCertificate-based N3IWF authentication is removed from the TS. Instead the N3IWF is authenticated using keys resulting from EAP authentication.\n\n>>> CONSEQUENCES IF NOT REVISED\nUEs need authenticate the N3IWF with certificates and therefore UEs need to be provisioned with root certificates of the visited networks."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nFIRST CHANGE\n6.1.3.4\tCredit management\nThe credit management applies for online charging only and shall operate on a per charging key basis. The SMF should initiate one credit management session with the CHF for each PDU Session subject to online charging.\nNOTE\u00a01:\tIndependent credit control for an individual service/application may be achieved by assigning a unique charging key value in the corresponding PCC rule.\nThe SMF shall request a credit for each charging key occurring in a PCC rule. It shall be up to operator configuration whether the SMF shall request credit in conjunction with the PCC rule being activated or when the first packet corresponding to the service is detected. The CHF may either grant or deny the request for credit. The CHF shall strictly control the rating decisions.\nNOTE\u00a02:\tThe term 'credit' as used here does not imply actual monetary credit, but an abstract measure of resources available to the user. The relationship between this abstract measure, actual money, and actual network resources or data transfer, is controlled by the CHF.\nDuring PDU Session establishment and modification, the SMF shall request credit using the information after applying policy enforcement action (e.g. upgraded or downgraded QoS information), if applicable, even though the SMF has not signalled this information to the AMF or RAN.\n\n\n\n\n\nSome of the re-authorization triggers are related to PDU Session modifications. PDU Session modifications, which do not match any credit re-authorization trigger (received from the CHF) shall not cause any credit re-authorization interaction with the CHF.\n\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nBased on the agreement addressed in the DP \u201cTS 23.203 Endorsement\u201d (S2-1903636), any reference to 23.203 shall be replaced by the referenced content. However, when the replacement for 6.1.3.4 is implemented by S2-1904118, some content is missed, e.g. credit re-authentication.For EPC, the credit re-authorisation and the triggers are defined in clause 6.1.3 and clause A.4.3.1.1 of TS 23.203.For 5GC, the credit re-authorisation and the triggers are defined in TS clause 5.2.1.4 of TS 32.255.\n\n>>> SUMMARY OF CHANGE\nUpdate 6.1.3.4 to align with credit management defined in TS 32.255 and refer to TS 32.255.\n\n>>> CONSEQUENCES IF NOT REVISED\nSMF doesn\u2019t know how to request credit re-authorization to CHF. In consistant with SA5 for the definition of credit control."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n==================================START OF CHANGES==================================\n6.5.2.1\tGNSS Assistance Data\n\u2013\tGNSS-GenericAssistData\nThe IE GNSS-GenericAssistData is used by the location server to provide assistance data for a specific GNSS (e.g., GPS, Galileo, GLONASS, BDS, etc.). The specific GNSS for which the provided assistance data are applicable is indicated by the IE GNSSID and (if applicable) by the IE SBASID. Assistance for up to 16 GNSSs can be provided.\n-- ASN1START\n\nGNSS-GenericAssistData ::= SEQUENCE (SIZE (1..16)) OF GNSS-GenericAssistDataElement\n\nGNSS-GenericAssistDataElement ::= SEQUENCE {\n\tgnss-ID\t\t\t\t\t\tGNSS-ID,\n\tsbas-ID\t\t\t\t\t\t\tSBAS-ID\t\t\t\t\t\tOPTIONAL, -- Cond GNSS-ID-SBAS\n\tgnss-TimeModels\t\t\t\t\tGNSS-TimeModelList\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-DifferentialCorrections\tGNSS-DifferentialCorrections\tOPTIONAL,\t-- Need ON\n\tgnss-NavigationModel\t\t\tGNSS-NavigationModel\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-RealTimeIntegrity\t\t\tGNSS-RealTimeIntegrity\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-DataBitAssistance\t\t\tGNSS-DataBitAssistance\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-AcquisitionAssistance\t\tGNSS-AcquisitionAssistance\t\tOPTIONAL,\t-- Need ON\n\tgnss-Almanac\t\t\t\t\tGNSS-Almanac\t\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-UTC-Model\t\t\t\t\tGNSS-UTC-Model\t\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-AuxiliaryInformation\t\tGNSS-AuxiliaryInformation\t\tOPTIONAL,\t-- Need ON\n\t...,\n\t[[\n\t\tbds-DifferentialCorrections-r12\t\n\t\t\t\t\t\t\t\t\tBDS-DifferentialCorrections-r12\tOPTIONAL,\t-- Cond\tGNSS-ID-BDS\n\t\tbds-GridModel-r12\t\t\tBDS-GridModelParameter-r12\t\tOPTIONAL\t-- Cond\tGNSS-ID-BDS\n\t]]\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nGNSSIDSBAS\tThe field is mandatory present if the GNSSID = sbas; otherwise it is not present.\nGNSSIDBDS\n\n=================================NEXT CHANGE=====================================\n6.5.2.2\tGNSS Assistance Data Elements\n\u2013\tGNSS-ReferenceTime\nThe IE GNSS-ReferenceTime is used by the location server to provide the GNSS specific system time with uncertainty and the relationship between GNSS system time and network air-interface timing of the eNodeB/NodeB/BTS transmission in the reference cell.\nIf the IE networkTime is present, the IEs gnss-SystemTime and networkTime provide a valid relationship between GNSS system time and air-interface network time, as seen at the approximate location of the target device, i.e. the propagation delay from the the eNodeB/NodeB/BTS to the target device shall be compensated for by the location server. Depending on implementation, the relation between GNSS system time and air-interface network time may have varying accuracy. The uncertainty of this timing relation is provided in the IE referenceTimeUnc. If the propagation delay from the eNodeB/NodeB/BTS to the target device is not accurately known, the location server shall use the best available approximation of the propagation delay and take the corresponding delay uncertainty into account in the calculation of the IE referenceTimeUnc.\nIf the IE networkTime is not present, the IE gnssSystemTime is an estimate of current GNSS system time at time of reception of the IE GNSS-ReferenceTime by the target device. The location server should achieve an accuracy of +/- 3 seconds for this estimate including allowing for the transmission delay between the location server and the target device. Note that the target device should further compensate gnss-SystemTime for the time between the reception of GNSS-ReferenceTime and the time when the gnss-SystemTime is used.\nThe location server shall provide a value for the gnss-TimeID only for GNSSs supported by the target device.\nThe IE GNSS-ReferenceTimeForOneCell can be provided multiple times (up to 16) to provide fine time assistance for several (neighbour) cells.\n-- ASN1START\n\nGNSS-ReferenceTime ::= SEQUENCE  {\n\tgnss-SystemTime\t\t\t\tGNSS-SystemTime,\n\treferenceTimeUnc\t\t\tINTEGER (0..127)\t\t\t\t\tOPTIONAL,\t-- Cond noFTA\n\tgnss-ReferenceTimeForCells  SEQUENCE (SIZE (1..16)) OF\n\t\t\t\t\t\t\t\t\tGNSS-ReferenceTimeForOneCell\tOPTIONAL,\t-- Need ON\n\t...\n}\n\nGNSS-ReferenceTimeForOneCell  ::= SEQUENCE {\t\n\tnetworkTime\t\t\t\tNetworkTime,\n\treferenceTimeUnc\t\t\tINTEGER (0..127),\n\tbsAlign\t\t\t\t\t\tENUMERATED {true}\tOPTIONAL,\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nnoFTA\n\nGNSS-ReferenceTime field descriptions\ngnss-SystemTime\tThis field provides the specific GNSS system time.\nnetworkTime\tThis field specifies the cellular network time at the epoch corresponding to gnss-SystemTime.\nreferenceTimeUnc\tThis field provides the accuracy of the relation between gnssSystemTime and networkTime time if IE networkTime is provided. When IE networkTime is not provided, this field can be included to provide the accuracy of the provided gnssSystemTime.\tIf GNSS TOD is the given GNSS time, then the true GNSS time, corresponding to the provided network time as observed at the target device location, lies in the interval [GNSS TOD - referenceTimeUnc, GNSS TOD + referenceTimeUnc].\tThe uncertainty r, expressed in microseconds, is mapped to a number K, with the following formula:\t\t\t\t\t\t\t\t\t\t\t\t\t\tr = C*(((1+x)K)-1)\twith C = 0.5 and x = 0.14. To encode any higher value of uncertainty than that corresponding in the above formula to K=127, the same value, K=127, shall also be used. The uncertainty is then coded on 7 bits, as the binary encoding of K. Example values for the referenceTimeUnc Format: see table K to uncertainty relation below. \nbsAlign\tThis flag, if present, indicates that the transmission timings of all cells sharing, depending on the RAT, the same carrier frequency and Tracking Area/Location Area/Routing Area as the cell indicated, are frame aligned. This information allows the target device to derive the GNSS - cellular time relation for any of these cells based on the timing relation information provided in GNSS-ReferenceTime. The flag should be set consistently in all these cells. This flag does not guarantee SFN alignment.\n\nK to uncertainty relation\nValue of K\tValue of uncertainty\n0\t0 nanoseconds\n1\t70 nanoseconds\n2\t149.8 nanoseconds\n-\t-\n50\t349.62 microseconds\n-\t-\n127\t\u2265 8.43 seconds\n\n\u2013\tGNSS-SystemTime\n-- ASN1START\n\nGNSS-SystemTime ::= SEQUENCE {\n\tgnss-TimeID\t\t\t\t\t\tGNSS-ID,\n\tgnss-DayNumber\t\t\t\t\tINTEGER (0..32767),\n\tgnss-TimeOfDay\t\t\t\t\tINTEGER (0..86399),\n\tgnss-TimeOfDayFrac-msec\t\t\tINTEGER (0..999)\t\tOPTIONAL,\t-- Need ON\n\tnotificationOfLeapSecond\t\tBIT STRING (SIZE(2))\tOPTIONAL,\t-- Cond gnss-TimeID-glonass\n\tgps-TOW-Assist\t\t\t\t\tGPS-TOW-Assist\t\t\tOPTIONAL,\t-- Cond gnss-TimeID-gps\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\ngnss-TimeID-glonass\ngnss-TimeID-gps\n\nGNSS-SystemTime field descriptions\ngnss-TimeID\tThis field specifies the GNSS for which the GNSS-SystemTime is provided.\ngnss-DayNumber\tThis field specifies the sequential number of days (with day count starting at 0) from the origin of the GNSS System Time as follows:\t\tGPS, QZSS, SBAS \u2013 Days from January 6th 1980 00:00:00 UTC (USNO);\t\tGalileo \u2013 Days from Galileo System Time (GST) start epoch, defined as 13 seconds before midnight between 21st\t\t\t\t\tAugust and 22nd August 1999; i.e., GST was equal to 13 seconds at August 22nd 1999 00:00:00 UTC;\t\tGLONASS \u2013 Days from December 31st 1995 21:00:00 UTC (SU), which is local UTC Moscow                                \t                       January 1st 1996 00:00:00, defined as UTC(SU) + 3 hours in [9];\t\tBDS \u2013 Days from January 1st 2006 00:00:00 UTC (NTSC).\ngnss-TimeOfDay\tThis field specifies the integer number of seconds from the GNSS day change.\ngnss-TimeOfDayFrac-msec\tThis field specifies the fractional part of the gnssTimeOfDay field in 1milliseconds resolution. The total GNSS TOD is gnss-TimeOfDay + gnssTimeOfDayFrac-msec.\nnotificationOfLeapSecond\tThis field specifies the notification of forthcoming leap second correction, as defined by parameter KP in [9, Table 4.7].\ngps-TOW-Assist\tThis field contains several fields in the Telemetry (TLM) Word and Handover Word (HOW) that are currently being broadcast by the respective GPS satellites. Combining this information with GPS TOW enables the target device to know the entire 1.2-second (60-bit) pattern of TLM and HOW that is transmitted at the start of each six-second NAV subframe by the particular GPS satellite.\n\n================================NEXT CHANGE========================================\n\u2013\tAlmanacBDS-AlmanacSet\n-- ASN1START\n\nAlmanacBDS-AlmanacSet-r12 ::= SEQUENCE {\n\tsvID\t\t\t\t\tSV-ID,\n\tbdsAlmToa-r12\t\t\tINTEGER (0..255)\t\t\t\t\tOPTIONAL,\t-- Cond NotSameForAllSV\n\tbdsAlmSqrtA-r12\t\t\tINTEGER (0..16777215),\n\tbdsAlmE-r12\t\t\t\tINTEGER (0..131071),\n\tbdsAlmW-r12\t\t\t\tINTEGER (-8388608..8388607),\n\tbdsAlmM0-r12\t\t\tINTEGER (-8388608..8388607),\n\tbdsAlmOmega0-r12\t\tINTEGER (-8388608..8388607),\n\tbdsAlmOmegaDot-r12\t\tINTEGER (-65536..65535),\n\tbdsAlmDeltaI-r12\t\tINTEGER (-32768..32767),\n\tbdsAlmA0-r12\t\t\tINTEGER (-1024..1023),\n\tbdsAlmA1-r12\t\t\tINTEGER (-1024..1023),\n\tbdsSvHealth-r12\t\t\tBIT STRING (SIZE(9))\t\t\t\tOPTIONAL,\t-- Cond SV-ID\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nNotSameForAllSV\nSV-ID\tThis field is mandatory present if SV-ID is between 0 and 29; otherwise it is not present.\n\nAlmanacBDS-AlmanacSet field descriptions\nsvID\tThis field identifies the satellite for which the GNSS Almanac Model is given.\nbdsAlmToa \tParameter toa, Almanac reference time(seconds) [23]\tScale factor 212 seconds.\nbdsAlmSqrtA \tParameter A1/2, Square root of semi-major axis (meters1/2) [23]\tScale factor 2-11 meters1/2.\nbdsAlmE \tParameter e, Eccentricity , dimensionless [23]\tScale factor 2-21.\nbdsAlmW\t\tParameter , Argument of Perigee (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmM0\tParameter M0, Mean anomaly at reference time (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmOmega0\tParameter 0, Longitude of ascending node of orbital plane computed according to reference time (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmOmegaDot \tParameter  Rate of right ascension (semi-circles/sec) [23]\tScale factor 2-38 semi-circles/sec.\nbdsAlmDeltaI \tParameter i, Correction of orbit reference inclination at reference time (semi-circles) [23]\tScale factor 2-19 semi-circles.\nbdsAlmA0 \tParameter a0, Satellite clock bias (seconds) [23]\tScale factor 2-20 seconds.\nbdsAlmA1\tParameter a1, Satellite clock rate (sec/sec) [23]\tScale factor 2-38 sec/sec.\nbdsSvHealth\tThis field indicates satellites health information as defined in [23] Table 5-15. The left most bit is the MSB.\n\n==============================END OF CHANGES========================================\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current LPP spec, for several optional fields in the downlink message, there is no need code for these fields. Need code needs to be added to let the UE know what should be the UE\u2019s operation when the field is absent.\n\n>>> SUMMARY OF CHANGE\nCorrections are made for IEs introduced in the following releases====R12 Corrections==1/ Add the need code for the following fields under GNSS-GenericAssistDatabds-DifferentialCorrections-r12bds-GridModel-r122/ Add the need code for the following fields under AlmanacBDS-AlmanacSetbdsAlmToa-r12====R9 Corrections==3/ Add the need code for the following fields under GNSS-ReferenceTimereferenceTimeUncbsAlign4/ Add the need code for the following fields under GNSS-System TimenotificationOfLeapSecond gps-TOW-Assist\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE behavior when the field is absent is undefined, which may lead to different understanding on the UE action between the UE and network. If the network mistakenly thinks that the UE has a certain configuration and hence does not transfer this configuration to the UE, the UE may fail to perform measurements and location estimation. Impact analysisImpacted functionalityFor R12GNSS-GenericAssistData, AlmanacBDS-AlmanacSet-r12For R9GNSS-ReferenceTime, GNSS-System TimeInter-operability: If the UE is implemented according to this CR while the network is not, the network does not know what will be the UE behavior when the field is absent.If the network is implemented according to this CR while the UE is not, the UE does not know what should be the UE behavior when the field is absent."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n9.2.6\tCause\nThe purpose of the cause information element is to indicate the reason for a particular event for the whole protocol.\nIE/Group Name\tPresence\tRange\tIE Type and Reference\tSemantics Description\nCHOICE Cause Group\tM\n>Radio Network Layer\n>>Radio Network Layer Cause \tM\t\tENUMERATED\t(\tHandover Desirable for Radio Reasons,\tTime Critical Handover,\tResource Optimisation Handover,\tReduce Load in Serving Cell,\tPartial Handover,\tUnknown New eNB UE X2AP ID, Unknown Old eNB UE X2AP ID, Unknown Pair of UE X2AP ID,\tHO Target not Allowed,\tTX2RELOCoverall Expiry,\tTRELOCprep Expiry,\tCell not Available,\tNo Radio Resources Available in Target Cell,\tInvalid MME Group ID,\tUnknown MME Code,\tUnspecified,\t...\t)\n>Transport Layer\n>>Transport Layer Cause\tM\t\tENUMERATED\n(Transport Resource Unavailable,\tUnspecified,\n...)\n>Protocol\n>>Protocol Cause\tM\t\tENUMERATED\n(Transfer Syntax Error,\nAbstract Syntax Error (Reject),\nAbstract Syntax Error (Ignore and Notify),\nMessage not Compatible with Receiver State,\tSemantic Error,\nUnspecified,\tAbstract Syntax Error (Falsely Constructed Message),...)\n>Misc\n>>Miscellaneous Cause\tM\t\tENUMERATED\n(Control Processing Overload,\nHardware Failure,\nO&M Intervention,\nNot enough User Plane Processing Resources,\nUnspecified,...)\n\nThe meaning of the different cause values is described in the following table. In general, \"not supported\" cause values indicate that the concerned capability is missing. On the other hand, \"not available\" cause values indicate that the concerned capability is present, but insufficient resources were available to perform the requested action.\n\nRadio Network Layer cause\tMeaning\nCell not Available\tThe concerned cell is not available.\nHandover Desirable for Radio Reasons\tThe reason for requesting handover is radio related.\nHandover Target not Allowed\tHandover to the indicated target cell is not allowed for the UE in question\nInvalid MME Group ID\tThe target eNB doesn\u2019t belong to the same pool area of the source eNB i.e. S1 handovers should be attempted instead.\nNo Radio Resources Available in Target Cell\tThe target cell doesn\u2019t have sufficient radio resources available.\nPartial Handover\tProvides a reason for the handover cancellation. The target eNB did not admit all E-RABs included in the HANDOVER REQUEST and the source eNB estimated service continuity for the UE would be better by not proceeding with handover towards this particular target eNB.\nReduce Load in Serving Cell\tLoad on serving cell needs to be reduced.\nResource Optimisation Handover\tThe reason for requesting handover is to improve the load distribution with the neighbour cells.\nTime Critical Handover\thandover is requested for time critical reason i.e. this cause value is reserved to represent all critical cases where the connection is likely to be dropped if handover is not performed.\nTX2RELOCoverall Expiry\tThe reason for the action is expiry of timer TX2RELOCoverall\nTRELOCprep Expiry\tHandover Preparation procedure is cancelled when timer TRELOCprep  expires.\nUnknown MME Code\tThe target eNB belongs to the same pool area of the source eNB and recognizes the MME Group ID. However, the MME Code is unknown to the target eNB.\nUnknown New eNB UE X2AP ID \tThe action failed because the New eNB UE X2AP ID is unknown\nUnknown Old eNB UE X2AP ID\tThe action failed because the Old eNB UE X2AP ID is unknown\nUnknown Pair of UE X2AP ID\tThe action failed because the pair of UE X2 AP IDs is unknown\n\nUnspecified\tSent when none of the above cause values applies but still the cause is Radio Network Layer related\n\nTransport Network Layer cause\tMeaning\nTransport resource unavailable\tThe required transport resources are not available\nUnspecified\tSent when none of the above cause values applies but still the cause is Transport Network Layer related\n\nProtocol cause\tMeaning\nAbstract Syntax Error (Reject)\tThe received message included an abstract syntax error and the concerned criticality indicated \"reject\" (see subclause 10.3)\nAbstract Syntax Error (Ignore and Notify)\tThe received message included an abstract syntax error and the concerned criticality indicated \"ignore and notify\" (see subclause 10.3)\nAbstract syntax error (falsely constructed message)\tThe received message contained IEs or IE groups in wrong order or with too many occurrences (see subclause 10.3)\nMessage not Compatible with Receiver State\tThe received message was not compatible with the receiver state (see subclause 10.4)\nSemantic Error\tThe received message included a semantic error (see subclause 10.4)\nTransfer Syntax Error\tThe received message included a transfer syntax error (see subclause 10.2)\nUnspecified\tSent when none of the above cause values applies but still the cause is Protocol related\n\nMiscellaneous cause\tMeaning\nControl Processing Overload\teNB control processing overload\nHardware Failure\teNB hardware failure\nNot enough User Plane Processing Resources\teNB has insufficient user plane processing resources available\nO&M Intervention\tOperation and Maintenance intervention related to eNB equipment\nUnspecified\tSent when none of the above cause values applies and the cause is not related to any of the categories Radio Network Layer, Transport Network Layer or Protocol.\n\n9.3.5\tInformation Element definitions\n-- **************************************************************\n--\n-- Information Element Definitions\n--\n-- **************************************************************\n\nX2AP-IEs {\nitu-t (0) identified-organization (4) etsi (0) mobileDomain (0) \neps-Access (21) modules (3) x2ap (2) version1 (1) x2ap-IEs (2) }\n\nDEFINITIONS AUTOMATIC TAGS ::= \n\nBEGIN\n\nIMPORTS\n\tid-InterfacesToTrace-Item,\n\tid-E-RAB-Item,\n\n\tmaxnoofBearers,\tmaxCellineNB,\n\tmaxEARFCN,\n\tmaxInterfaces,\n\t\n\tmaxnoofBPLMNs,\n\tmaxnoofEPLMNs,\n\tmaxnoofEPLMNsPlusOne,\n\tmaxnoofForbLACs,\n\tmaxnoofForbTACs,\n\tmaxnoofNeighbours,\n\tmaxnoofPRBs,\n\tmaxNrOfErrors,\n\tmaxPools\n\nFROM X2AP-Constants\n\n\tCriticality,\n\tProcedureCode,\n\tProtocolIE-ID,\n\tTriggeringMessage\nFROM X2AP-CommonDataTypes\n\n\tProtocolExtensionContainer{},\n\tProtocolIE-Single-Container{},\n\t\n\tX2AP-PROTOCOL-EXTENSION,\n\tX2AP-PROTOCOL-IES\nFROM X2AP-Containers;\n\n-- A\n\nAS-SecurityInformation ::= SEQUENCE {\n\tkey-eNB\t\tKey-eNB,\n\tnextHopChainingCounter\t\t\tNextHopChainingCounter,\n\tkeySetIdentifier\t\tKeySetIdentifier,\n\tiE-Extensions\t\t\t\t\t\tProtocolExtensionContainer { { AS-SecurityInformation-ExtIEs} } OPTIONAL,\n\t...\n}\n\nAS-SecurityInformation-ExtIEs X2AP-PROTOCOL-EXTENSION ::= {\n\t...\n}\n\n\nAllocationAndRetentionPriority ::= SEQUENCE {\n\tpriorityLevel\t\t\t\tPriorityLevel,\n\tpre-emptionCapability\t\tPre-emptionCapability,\n\tpre-emptionVulnerability\tPre-emptionVulnerability,\n\tiE-Extensions\t\t\t\tProtocolExtensionContainer { {AllocationAndRetentionPriority-ExtIEs} } OPTIONAL,\n\t...\n}\n\nAllocationAndRetentionPriority-ExtIEs X2AP-PROTOCOL-EXTENSION ::= {\n\t...\n}\n\n\n-- B\n\n\nBitRate ::= INTEGER (0..10000000000)\nBroadcastPLMNs-Item ::= SEQUENCE (SIZE(1..maxnoofBPLMNs)) OF PLMN-Identity\n\n\n-- C\n\nCause ::= CHOICE {\n\tradioNetwork\t\tCauseRadioNetwork,\n\ttransport\t\t\tCauseTransport,\n\tprotocol\t\t\tCauseProtocol,\n\tmisc\t\t\t\tCauseMisc,\n\t...\n}\n\nCauseMisc ::= ENUMERATED {\n\tcontrol-processing-overload,\n\thardware-failure,\n\tom-intervention,\n\tnot-enough-user-plane-processing-resources,\n\tunspecified,\n\t...\n}\n\nCauseProtocol ::= ENUMERATED {\n\ttransfer-syntax-error,\n\tabstract-syntax-error-reject,\n\tabstract-syntax-error-ignore-and-notify,\n\tmessage-not-compatible-with-receiver-state,\n\tsemantic-error,\n\tunspecified,\n\tabstract-syntax-error-falsely-constructed-message,\n\t...\n}\n\nCauseRadioNetwork ::= ENUMERATED {\n\thandover-desirable-for-radio-reasons,\n\ttime-critical-handover,\n\tresource-optimisation-handover,\n\treduce-load-in-serving-cell,\n\tpartial-handover,\n\tunknown-new-eNB-UE-X2AP-ID, \n\tunknown-old-eNB-UE-X2AP-ID, \n\tunknown-pair-of-UE-X2AP-ID,\n\tho-target-not-allowed,\n\ttx2relocoverall-expiry,\n\ttrelocprep-expiry,\n\tcell-not-available,\n\tno-radio-resources-available-in-target-cell,\n\tinvalid-MME-GroupID,\n\tunknown-MME-Code,\n\n\tunspecified,\n\t...\n\n}\n\nCauseTransport ::= ENUMERATED {\n\ttransport-resource-unavailable,\n\tunspecified,\n\t...\n}\n\n\n\n\nCOUNTvalue ::= SEQUENCE {\n\tpDCP-SN\t\t\t\t\tPDCP-SN,\n\thFN\t\t\t\t\t\tHFN,\n\tiE-Extensions\t\t\tProtocolExtensionContainer { { COUNTvalue-ExtIEs} } OPTIONAL,\n\t...\n}\n\nCOUNTvalue-ExtIEs X2AP-PROTOCOL-EXTENSION ::= {\n\t...\n}\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the X2 interface cannot be setup between eNB A and eNB B permanently because not allowed (try-and-failure scenario instead of configuration), the cause value in the X2 SETUP FAILURE should be meaningful so that eNB A doesn\u2019t try again after the Time To Wait value.\n\n>>> SUMMARY OF CHANGE\nThe new cause \u201cX2 setup not allowed\u201d is added.\n\n>>> CONSEQUENCES IF NOT REVISED\neNB A would try again and again to set up a forbidden X2 every Time To Wait value."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**** START OF CHANGES ****\n6.3.3\tAuthentication and key agreement\nThe purpose of this procedure is to authenticate the user and establish a new pair of cipher and integrity keys between the VLR/SGSN and the USIM. During the authentication, the USIM verifies the freshness of the authentication vector that is used.\n\nFigure 8: Successful UMTS Authentication and Key Agreement\nThe VLR/SGSN invokes the procedure by selecting the next unused authentication vector from the ordered array of authentication vectors in the VLR/SGSN database. Authentication vectors in a particular node are used on a first-in / first-out basis. The VLR/SGSN sends to the USIM the random challenge RAND and an authentication token for network authentication AUTN from the selected authentication vector.\nUpon receipt the user proceeds as shown in Figure 9.\n\nFigure 9: User authentication function in the USIM\nUpon receipt of RAND and AUTN the USIM first computes the anonymity key AK = f5K (RAND) and retrieves the sequence number SQN = (SQN  AK)  AK.\nNext the USIM computes XMAC = f1K (SQN || RAND || AMF) and compares this with MAC which is included in AUTN. If they are different, the user sends an authentication failure message  back to the VLR/SGSN with an indication of the cause and the user abandons the procedure. In this case, VLR/SGSN shall initiate an Authentication Failure Report procedure towards the HLR as specified in section 6.3.6. VLR/SGSN may also decide to initiate a new identification and authentication procedure towards the user, cf. TS\u00a024.008 [35].\nNext the USIM verifies that the received sequence number SQN is in the correct range.\nIf the USIM considers the sequence number to be not in the correct range, it sends synchronisation failure back to the VLR/SGSN including an appropriate parameter, and abandons the procedure.\nThe synchronisation failure message contains the parameter AUTS. It is AUTS = Conc(SQNMS ) || MACS. Conc(SQNMS) = SQNMS   f5*K(RAND) is the concealed value of the counter SQNMS in the MS, and MACS = f1*K(SQNMS || RAND || AMF) where RAND is the random value received in the current user authentication request.  f1* is a message authentication code (MAC) function with the property that no valuable information can be inferred from the function values of f1* about those of f1, ... , f5, f5* and vice versa. f5* is the key generating function used to compute AK in re-synchronisation procedures with the property that no valuable information can be inferred from the function values of f5* about those of f1, f1*, f2, ... , f5 and vice versa.\n\nThe AMF used to calculate MACS assumes a dummy value of all zeros so that it does not need to be transmitted in the clear in the re-synch message.\nThe construction of the parameter AUTS in shown in the following Figure 10:\n\n\nFigure 10: Construction of the parameter AUTS\nIf the sequence number is considered to be in the correct range however, the USIM computes RES = f2K (RAND) and includes this parameter in a user authentication response back to the VLR/SGSN. Finally the USIM computes the cipher key CK = f3K (RAND) and the integrity key IK = f4K (RAND). Note that if this is more efficient, RES, CK and IK could also be computed earlier at any time after receiving RAND. If the USIM also supports conversion function c3, it shall derive the 64-bit GSM cipher key Kc from the UMTS cipher/integrity keys CK and IK. UMTS keys are sent to the MS along with the derived 64-bit GSM key for UMTS-GSM interoperability purposes. USIM shall store original CK, IK until the next successful execution of AKA.\nUpon receipt of user authentication response the VLR/SGSN compares RES with the expected response XRES from the selected authentication vector. If XRES equals RES then the authentication of the user has passed. The SGSN shall compute the 128-bit GSM ciphering key Kc128 according to annex B.5 if it is to use a 128-bit GSM ciphering algorithm. The VLR/MSC shall compute the 128-bit GSM ciphering key Kc128 according to annex B.5 if it signals a 128-bit GSM ciphering algorithm as a permitted GSM ciphering algorithm to the BSS. The VLR/SGSN also selects the appropriate cipher key CK and integrity key IK from the selected authentication vector. If XRES and RES are different, VLR/SGSN shall initiate an Authentication Failure Report procedure towards the HLR as specified in section 6.3.6. VLR/SGSN may also decide to initiate a new identification and authentication procedure towards the user, cf. TS\u00a024.008 [35].\nRe-use and re-transmission of (RAND, AUTN)\nThe verification of the SQN by the USIM will cause the MS to reject an attempt by the VLR/SGSN to re-use a quintet to establish a particular UMTS security context more than once. In general therefore the VLR/SGSN shall use a quintet only once.\nThere is one exception however: in the event that the VLR/SGSN has sent out an authentication request using a particular quintet and does not receive a response message (authentication response or authentication failure) from the MS, it may re-transmit the authentication request using the same quintet. However, as soon as a response message arrives no further re-transmissions are allowed. If after the initial transmission or after a series of re-transmissions no response arrives, retransmissions may be abandoned. If retransmissions are abandoned then the VLR/SGSN shall delete the quintet. At the MS side, in order to allow this re-transmission without causing additional re-synchronisation procedures, the ME shall store for the PS domain (and optionally the CS domain) the last received RAND as well as the corresponding RES, CK and IK. If the USIM returned SRES and Kc (for GSM access), the ME shall store these values. When the ME receives an authentication request and discovers that a RAND is repeated, it shall re-transmit the response. The ME shall delete the stored values RAND, RES and SRES (if they exist) as soon as the 3G security mode command or the GSM cipher mode command is received by the ME or the connection is aborted. If the ME can handle the retransmission mechanism for CS domain then it shall be able to handle the retransmission for both PS and CS domain simultaneously.\n**** NEXT CHANGE ****\n6.3.5\tRe-synchronisation procedure\nA VLR/SGSN may send two types of authentication data requests to the HE/AuC, the (regular) one described in subsection 6.3.2 and one used in case of synchronisation failures, described in this subsection.\nUpon receiving a synchronisation failure message from the user, the VLR/SGSN sends an authentication data request with a \"synchronisation failure indication\" to the HE/AuC, together with the parameters:\n-\tRAND sent to the MS in the preceding user authentication request, and\n-\tAUTS received by the VLR/SGSN in the response to that request, as described in subsection 6.3.3.\nAn VLR/SGSN will not react to unsolicited \"synchronisation failure indication\" messages from the MS.\nThe VLR/SGSN does not send new user authentication requests to the user before having received the response to its authentication data request from the HE/AuC (or before it is timed out).\nWhen the HE/AuC receives an authentication data request with a \"synchronisation failure indication\" it acts as follows:\n1.\tThe HE/AuC retrieves SQNMS from Conc(SQNMS) by computing Conc(SQNMS)  f5*K(RAND).\n2.\tThe HE/AuC checks if SQNHE is in the correct range, i.e. if the next sequence number generated SQNHE using would be accepted by the USIM.\n3.\tIf SQNHE is in the correct range then the HE/AuC continues with step (6), otherwise it continues with step\u00a0(4).\n4.\tThe HE/AuC verifies AUTS (cf. subsection 6.3.3).\n5.\tIf the verification is successful the HE/AuC resets the value of the counter SQNHE to SQNMS.\n6.\tThe HE/AuC sends an authentication data response with a new batch of authentication vectors to the VLR/SGSN. If the counter SQNHE was not reset then these authentication vectors can be taken from storage, otherwise they are newly generated after resetting SQNHE. In order to reduce the real-time computation burden on the HE/AuC, the HE/AuC may also send only a single authentication vector in the latter case.\nWhenever the VLR/SGSN receives a new batch of authentication vectors from the HE/AuC in an authentication data response to an authentication data request with synchronisation failure indication it deletes the old ones for that user in the VLR/SGSN.\nThe user may now be authenticated based on a new authentication vector from the HE/AuC. Figure 12 shows how re-synchronisation is achieved by combining a user authentication request answered by a synchronisation failure message (as described in section\u00a06.3.3) with an authentication data request with synchronisation failure indication answered by an authentication data response (as described in this section).\n\nFigure 12: Resynchronisation mechanism\n\n\n**** END OF CHANGES ****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe calculation of the keystream for concealing SQNMS in the case of re-sychronisation only has RAND as a non-key input and hence the same keystream may be used to protect different SQNMSs if an attacker replays an authentication challenge. This leaks at least the xor between the different SQNMS values and it has been shown how this leak can be used to derive the LSBs of SQNMS.\n\n>>> SUMMARY OF CHANGE\nAdd MAC-S as an input parameter to claculate the keystream at re-synchronisation in order to get a differeent keystream for each SQNMS value.\n\n>>> CONSEQUENCES IF NOT REVISED\nKeystream is repeated which should be against security design properties"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n* * * First Change * * * *\n\n6.3.1.2\tDistribution of subscriber identities and security data within one 5G serving network domain\nThe transmission of the following subscriber identities and security data is permitted between 5G core network entities of the same serving network domain: \n-\tSUPI in the clear\n-\t5G security contexts, as described in clause 6.9\nA 5G authentication vector shall not be transmitted between SEAFs. \nOnce the subscriber identities and security data have been transmitted from an old to a new network entity the old network entity shall delete the data. \n\n* * * End Change * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe sentence \u201cOnce the subscriber identities and security data have been transmitted from an old to a new network entity the old network entity shall delete the data. \u201d means that once the old AMF sends the security data to the new network entity, the old AMF will delete the security data in old AMF.  However, in the latest version of TS 23.502 clause 4.2.2.2.3 step 8, the target AMF can retrieve UE context from old AMF and receive UE context from initial AMF. It implies that both old AMF and initial AMF hold the UE context. The old AMF shall not delete the UE context until it receive the Namf_Communication_RegistrationStatusUpdate message which indicated the registration in target AMF is completed.Therefore, old network entity must confirm the security data have been transmitted to new network entity successfully.\n\n>>> SUMMARY OF CHANGE\nClarification for distribution of subscriber identities and security data in clause 6.3.1.2\n\n>>> CONSEQUENCES IF NOT REVISED\nThe old network entity may delete the security data in a wrong way."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n===== BEGIN CHANGE =====\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TS\u00a031.102: \"3rd Generation Partnership Project; Technical Specification Group Terminals; Characteristics of the USIM application\".\n[2]\t3GPP\u00a0TS\u00a033.102: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G Security; Security architecture\".\n[3]\tFranks J., et al,: \"HTTP Authentication: Basic and Digest Access Authentication\", RFC\u00a02617, June 1999.\n[4]\tA. Niemi, et al,: \"Hypertext Transfer Protocol (HTTP) Digest Authentication Using Authentication and Key Agreement (AKA)\", RFC\u00a03310, September 2002.\n[5]\t3GPP\u00a0TS\u00a033.221: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Generic Authentication Architecture (GAA); Support for Subscriber Certificates\".\n[6]\tT. Dierks, et al,: \"The TLS Protocol Version 1.0\", RFC\u00a02246, January 1999.\n[7]\tOMA: \"Provisioning Content Version 1.1\", Version 13Aug2003. Open Mobile Alliance.\n[8]\t3GPP\u00a0TS\u00a023.228: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; IP Multimedia Subsystem (IMS); Stage 2 (Release 6)\".\n[9]\tIETF RFC 3546 (2003): \"Transport Layer Security (TLS) Extensions\".\n[10]\t3GPP\u00a0TS\u00a031.103: \"3rd Generation Partnership Project; Technical Specification Group Terminals; Characteristics of the IP Multimedia Services Identity Module (ISIM) application\".\n[11]\t3GPP\u00a0TS\u00a023.003: \"3rd Generation Partnership Project; Technical Specification Group Core Network; Numbering, addressing and identification\".\n[12]\tIETF\u00a0RFC\u00a03548\u00a0(2003): \"The Base16, Base32, and Base64 Data Encodings\".\n[13]\t3GPP\u00a0TS\u00a033.210: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G Security; Network domain security; IP network layer security\".\n[14]\tIETF\u00a0RFC\u00a03588\u00a0(2003): \"Diameter Base Protocol\".\n[15]\t3GPP\u00a0TS\u00a031.101: \"3rd Generation Partnership Project; Technical Specification Group Terminals; UICC-terminal interface; Physical and logical characteristics\".\n[16]\t3GPP\u00a0TS\u00a033.203: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G security; Access security for IP-based services\".\n[17]\tIETF\u00a0RFC\u00a03280 (2002): \"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile\".\n[18]\tIETF\u00a0RFC\u00a02818 (2000): \"HTTP over TLS\".\n[19]\t3GPP\u00a0TS\u00a033.310: \"3rd Generation Partnership Project; Technical Specification Group Service and System Aspects; Network Domain Security (NDS); Authentication Framework (AF)\".\n[20]\tIETF\u00a0RFC\u00a02560 (1999): \"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP\".\n[21]\tFIPS PUB 180-2 (2002): \"Secure Hash Standard\".\n[22]\tIETF RFC 2104 (1997): \"HMAC: Keyed-Hashing for Message Authentication\".\n[23]\tISO/IEC 10118-3:2004: \"Information Technology \u2013 Security techniques \u2013 Hash-functions \u2013 Part 3: Dedicated hash-functions\".\n[24]\tIETF\u00a0RFC\u00a03629\u00a0(2003): \"UTF-8, a transformation format of ISO 10646\".\n\n\n===== END CHANGE =====\n===== BEGIN CHANGE =====\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n===== END CHANGE =====\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThere are more than one billion people with SIMs in their phones and it will take a long time to provision UICCs capable of 3G authentication to such a large population. In the meanwhile there should be a way to offer services whose authentication is based on GAA also to 2G subscribers, while minimising security risks know from 2G.\n\n>>> SUMMARY OF CHANGE\nNormative annex is added to specify the procedures for 2G GBA. Two references are added.\n\n>>> CONSEQUENCES IF NOT REVISED\nServices cannot make use of large existing 2G authentication base."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n** start of changes **\n2\tReferences\nThe following documents contain provisions, which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\tVoid\n[2]\tVoid\n[3]\tIETF\u00a0RFC\u00a03748: \"Extensible Authentication Protocol (EAP)\".\n[4]\tIETF RFC 4187, January 2006: \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)\". \n[5]\tIETF RFC 4186, January 2006: \"Extensible Authentication Protocol Method for Global System for Mobile Communications (GSM) Subscriber Identity Modules (EAP-SIM)\". \n[6]\tIEEE\u00a0802.11i-2004: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - LAN/MAN  - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) specifications-Amendment 6: MAC Security Enhancements\".\n[7]\tIETF RFC\u00a05216, March 2008: \"The EAP-TLS Authentication Protocol\".\n[8]\tVoid\n[9]\tETSI\u00a0TS\u00a0101\u00a07611\u00a0v1.3.1B: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 1: Basic Data Transport\".\n[10]\tETSI\u00a0TS\u00a0101\u00a07612\u00a0v1.2.1C: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 2: Radio Link Control (RLC) sublayer\".\n[11]\tETSI\u00a0TS\u00a0101\u00a07614\u00a0v1.3.1B: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 4 Extension for Home Environment\".\n[12]\tETSI\u00a0TR\u00a0101\u00a0683\u00a0v1.1.1: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; System Overview\".\n[13]\t3GPP\u00a0TS\u00a023.234: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3GPP system to Wireless Local Area Network (WLAN) Interworking; System Description\".\n[14]\tIETF RFC 4282, December 2005: \"The Network Access Identifier\", (Obsoletes RFC2486)\n[15]\tIETF RFC\u00a02865, June 2000: \"Remote Authentication Dial In User Service (RADIUS)\".\n[16]\tRFC\u00a01421, February 1993: \"Privacy Enhancement for Internet Electronic Mail: Part I: Message Encryption and Authentication Procedures\".\n[17]\tFederal Information Processing Standard (FIPS) draft standard: \"Advanced Encryption Standard (AES)\", November 2001.\n[18]\t3GPP\u00a0TS\u00a023.003: \"3rd Generation Partnership Project; Technical Specification Group Core Network; Numbering, addressing and identification\".\n[19]\tIEEE\u00a0P802.1X/D11 June 2001: \"Standards for Local Area and Metropolitan Area Networks: Standard for Port Based Network Access Control\".\n[20]\t3GPP\u00a0TR\u00a021.905: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Vocabulary for 3GPP Specifications\".\n[21]\t3GPP\u00a0TS\u00a033.102: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G Security; Security Architecture\".\n[22]\tCAR 020 SPEC/0.95cB: \"SIM Access Profile, Interoperability Specification\", version 0.95VD.\n[23]\tRFC 4072, August 2005: \"Diameter Extensible Authentication Protocol (EAP) Application\".\n[24]\tIETF RFC\u00a03588, September 2003: \"Diameter base protocol\".\n[25]\tIETF RFC\u00a03576, July 2003: \"Dynamic Authorization Extensions to Remote Authentication Dial In User Service (RADIUS)\".\n[26]\tIETF RFC\u00a03579, September 2003: \"RADIUS (Remote Authentication Dial In User Service) Support for Extensible Authentication Protocol (EAP)\".\n[27]\tIETF RFC\u00a05247, August 2008: \" Extensible Authentication Protocol (EAP) Key Management Framework\".\n[28]\tE. Barkan, E. Biham, N. Keller: \"Instant Ciphertext-Only Cryptoanalysis of GSM Encrypted Communication\", Crypto 2003, August 2003.\n[29]\tIETF RFC 4306, December 2005: \"Internet Key Exchange (IKEv2) Protocol\".\n[30]\tIETF RFC 4303, December 2005: \"IP Encapsulating Security Payload (ESP)\".\n[31]\tRFC 4308, December 2005: \"Cryptographic Suites for IPsec [32]\tRFC 3948, May 2005: \"UDP Encapsulation of IPsec ESP Packets \". \n[33]\tRFC 4307 December 2005: \"Cryptographic Algorithms for use in the Internet Key Exchange Version 2 (IKEv2)\". \n[34]\tIETF RFC\u00a02104, February 1997: \"HMAC: Keyed-Hashing for Message Authentication\".\n[35]\tIETF RFC\u00a02404, November 1998: \"The Use of HMAC-SHA-1-96 within ESP and AH\".\n[36]\tIETF RFC\u00a02548, March 1999: \" Microsoft Vendor-specific RADIUS Attributes\".\n[37]\tVoid\n[38]\tIETF RFC\u00a03279 April 2002: \"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile\".\n[39]\tIETF RFC\u00a03280 April 2002: \"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile\".\n[40]\t3GPP\u00a0TS\u00a027.007: \"Technical Specification Group Terminals; AT command set for User Equipment (UE)\".\n[41]\tETSI\u00a0TS\u00a0102.310: \"Smart Cards; Extensible Authentication Protocol support in the UICC\".\n[42]\tETSI\u00a0TS\u00a0102.221: \"Smart Cards; UICC-Terminal interface; Physical and logical characteristics\".\n[43]\tOpen Mobile Alliance OMA-WAP-OCSP V1.0: \"Online Certificate Status Protocol Mobile Profile\". URL: \n[44]\tIETF RFC\u00a04806, Februari 2007: Online Certificate Status Protocol (\"OCS)P Extensions to IKEv2\"..\n[45]\tIETF RFC 4739, November 2006: \"Multiple Authentication Exchanges in the Internet Key Exchange (IKEv2) Protocol\".\n[46]\tIETF RFC\u00a04835, April 2007: \"Cryptographic Algorithm Implementation Requirements for Encapsulating Security Payload (ESP) and Authentication Header (AH).\n[47]\t3GPP TS 24.234: \u201c3GPP System to Wireless Local Area Network (WLAN) interworking; WLAN User Equipment (WLAN UE) to network protocols; Stage 3\u201d\n\n** next change **\n6.6A\tProfile for PDG certificates\nCertificates used for authentication of the PDG shall meet the following profile of RFC\u00a03280\u00a0[39].\na)\tThe certificate shall be encoded in DER format.\nb)\tThe version shall be 2 (\"v3\").\nc)\tThe certificate serial number shall meet the requirements in RFC\u00a03280\u00a0[39], section\u00a04.1.2.2.\nd)\tThe signature algorithm shall be \"sha1WithRSAEncryption\"\u00a0[38], and the RSA public key used for signing shall not be longer than 2048\u00a0bits.\n\ne)\tThe issuer name shall not be empty.\nf)\tThe validity period shall meet the requirements in RFC\u00a03280\u00a0[39], section\u00a04.1.2.5.\nf)\tThe subject name may be empty in PDG certificates and shall not be empty in CA certificates.\ng)\tThe subject public key shall use algorithm \"rsaEncryption\" (RFC\u00a03279\u00a0[38]), and the RSA public key shall not be longer than 2048\u00a0bits.\n\nh)\tThe issuerUniqueID or subjectUniqueID fields shall not be present.\ni)\tThe SubjectAltName extension shall be present if this is a PDG certificate, and shall contain at least one dNSName component.\nj)\tThe BasicConstraints extension shall be present if this is a CA certificates with \"CA\" flag asserted. The pathLenConstraint may be present.\nk)\tCA certificates should contain the NameConstraints extension with appropriate dNSName components in the permittedSubtrees field.\nl)\tThe KeyUsage extension shall be present in all certificates. The keyCertSign bit shall be set in CA certificates, and digitalSignature bit shall be set in PDG certificates.\nm)\tThe CRLDistributionPoint extension may be present, and shall not be marked critical. At least one of the distribution points should use HTTP for retrieving the CRL.\nn)\tThe AuthorityInformationAccess extension may be present with id-ad-ocsp access method, and shall not be marked critical.\no)\tOther extensions should not be used; if they are, they shall not be marked as critical.\np)\tThe total length of a certificate shall not exceed 2000\u00a0bytes.\nCertificate processing requirements:\na)\tUE shall send one or more CERTREQ payloads with encoding value 4 (X.509 certificate - Signature).\nb)\tIKEv2 Certificate encoding value shall be 4 (X.509 certificate - Signature).\nc)\tUE shall not assume that any except the first IKEv2 CERT payload is ordered in any way.\nd)\tUE shall be able to support certificate paths containing up to four certificates (e.g. self-signed CA certificate, intermediate CA\u00a01, intermediate CA\u00a02, PDG certificate) (and may support longer path lengths), where the intermediate CA\u00a0certificates and the PDG certificate are obtained from the IKEv2 CERT payload and the self-signed CA certificate is obtained from a UE local store of trusted root certificates.\ne)\tPDG shall not send paths containing more than four certificates.\nf)\tUE shall be prepared to receive irrelevant certificates, or certificates they do not understand.\ng)\tUE shall be able to process certificates (for e.g. chain building) even if naming attributes are unknown.\nh)\tUE shall support both UTCTime and GeneralizedTime encoding for validity time.\ni)\tUE shall check the validity time, and reject certificates that are either not yet valid or are expired.\nj)\tUE shall support processing of the BasicConstraints, NameConstraints, and KeyUsage extensions.\nk)\tUE may check the validity of the certificates using CRLs or OCSP\u00a0[43]. Support for CRLs is optional in the UE. Support for OCSP is mandatory in the UE. In addition, the UE and the PDG may support the extensions to IKEv2, which enable the use of OCSP for in-band signalling of certificate revocation status, according to [44]. \nNOTE:\tA WLAN UE that initiates 3GPP IP Access according to the tunnel full authentication and authorization procedure, may want to check the validity of the PDG certificate, but it might not gain access to the OCSP server. This situation can be handled in the following way: After the UE initiated tunnel is successfully established and before user data is transmitted in the tunnel, the UE sends an OCSP request message to OCSP server. When the UE receives the OCSP response, it checks the certificate status. If the certificate of PDG is valid, the UE will allow user data to be transmitted to the PDG in the tunnel. If the certificate is not valid, the UE may terminate the tunnel that just was established.\n\n\n** end of changes **\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSHA-1 is vulnerable to collision attacks and should not be recommended for use when generating new certificates and CRLs.RSA keys shorter than 2048 bits are allowed.\n\n>>> SUMMARY OF CHANGE\nThe use of SHA-1 is strongly discouraged for newly created certificates and CRLs.The use of key lengths less than 2048 bit is strongly discouraged for newly created certificates, CRLs and OCSP responses.\n\n>>> CONSEQUENCES IF NOT REVISED\nAttackers could exploit SHA-1 weaknesses to generate fake certificates in order to launch attacks.Attackers could exploit short RSA keys to spoof certificates, CRLs and OCSP responses."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n4.4.2\tHandling of 5G NAS security contexts\n4.4.2.1\tGeneral\nThe security parameters for authentication, integrity protection and ciphering are tied together in a 5G NAS security context and identified by a key set identifier (ngKSI). The relationship between the security parameters is defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nBefore security can be activated, the AMF and the UE need to establish a 5G NAS security context. Usually, the 5G NAS security context is created as the result of a primary authentication and key agreement procedure between the AMF and the UE. A new 5G NAS security context may also be created during an N1 mode to N1 mode handover. Alternatively, during inter-system change from S1 mode to N1 mode, the AMF not supporting interworking without N26 and the UE operating in single-registration mode may derive a mapped 5G NAS security context from an EPS security context that has been established while the UE was in S1 mode.\nThe 5G NAS security context is taken into use by the UE and the AMF, when the AMF initiates a security mode control procedure, during an N1 mode to N1 mode handover, or during the inter-system change procedure from S1 mode to N1 mode. The 5G NAS security context which has been taken into use by the network most recently is called current 5G NAS security context. This current 5G NAS security context can be of type native or mapped, i.e. originating from a native 5G NAS security context or mapped 5G NAS security context.\nThe key set identifier ngKSI is assigned by the AMF either during the primary authentication and key agreement procedure or, for the mapped 5G NAS security context, during the inter-system change. The ngKSI consists of a value and a type of security context parameter indicating whether a 5G NAS security context is a native 5G NAS security context or a mapped 5G NAS security context. When the 5G NAS security context is a native 5G NAS security context, the ngKSI has the value of KSIAMF, and when the current 5G NAS security context is of type mapped, the ngKSI has the value of KSIASME.\nThe 5G NAS security context which is indicated by an ngKSI can be taken into use to establish the secure exchange of NAS messages when a new N1 NAS signalling connection is established without executing a new primary authentication and key agreement procedure (see subclause\u00a05.4.1) or when the AMF initiates a security mode control procedure. For this purpose, the initial NAS messages (i.e. REGISTRATION REQUEST, DEREGISTRATION REQUEST, SERVICE REQUEST and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an ngKSI in the ngKSI IE indicating the current 5G NAS security context used to integrity protect the NAS message.\nIn the present document, when the UE is required to delete an ngKSI, the UE shall set the ngKSI to the value \"no key is available\" and consider also the associated keys KAMF or K'AMF, 5G NAS ciphering key and 5G NAS integrity key invalid (i.e. the 5G NAS security context associated with the ngKSI as no longer valid). In the initial registration procedure, when the key KAUSF, is invalid, the UE shall delete the ngKSI.\nNOTE:\tIn some specifications the term ciphering key sequence number might be used instead of the term key set identifier (KSI).\nAs described in subclause\u00a04.8 in order to interwork with E-UTRAN connected to EPC, the UE supporting both S1 mode and N1 mode can operate in either single-registration mode or dual-registration mode. A UE operating in dual-registration mode shall independently maintain and use both EPS security context (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and 5G NAS security context. When the UE operating in dual-registration mode performs an EPS attach procedure, it shall take into use an EPS security context and follow the handling of this security context as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15]. However, when the UE operating in dual-registration mode performs an initial registration procedure, it shall take into use a 5G NAS security context and follow the handling of this security context as described in the present specification.\nThe UE and the AMF need to be able to maintain two 5G NAS security contexts simultaneously, i.e. a current 5G NAS security context and a non-current 5G NAS security context, since:\na)\tafter a 5G re-authentication, the UE and the AMF can have both a current 5G NAS security context and a non-current 5G NAS security context which has not yet been taken into use (i.e. a partial native 5G NAS security context); and\nb)\tafter an inter-system change from S1 mode to N1 mode, the UE and the AMF can have both a mapped 5G NAS security context, which is the current 5G NAS security context, and a non-current native 5G NAS security context that was created during a previous access in N1 mode.\nThe number of 5G NAS security contexts that need to be maintained simultaneously by the UE and the AMF is limited by the following requirements:\na)\tafter a successful 5G (re-)authentication, which creates a new partial native 5G NAS security context, the AMF and the UE shall delete the non-current 5G NAS security context, if any;\nb)\twhen a partial native 5G NAS security context is taken into use through a security mode control procedure, the AMF and the UE shall delete the previously current 5G NAS security context;\nc)\twhen the AMF and the UE create a 5G NAS security context using \"null integrity protection algorithm\" and \"null ciphering algorithm\" during an initial registration procedure for emergency services, or a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session (see subclause\u00a05.4.2.2), the AMF and the UE shall delete the previous current 5G NAS security context;\nd)\twhen a new mapped 5G NAS security context or 5G NAS security context created using \"null integrity protection algorithm\" and \"null ciphering algorithm\" is taken into use during the inter-system change from S1 mode to N1 mode, the AMF and the UE shall not delete the previously current native 5G NAS security context, if any. Instead, the previously current native 5G NAS security context shall become a non-current native 5G NAS security context, and the AMF and the UE shall delete any partial native 5G NAS security context;\n\tIf no previously current native 5G NAS security context exists, the AMF and the UE shall not delete the partial native 5G NAS security context, if any;\ne)\twhen the AMF and the UE derive a new mapped 5G NAS security context during inter-system change from S1 mode to N1 mode, the AMF and the UE shall delete any existing current mapped 5G NAS security context;\nf)\twhen a non-current full native 5G NAS security context is taken into use by a security mode control procedure, then the AMF and the UE shall delete the previously current mapped 5G NAS security context;\ng)\twhen the UE or the AMF moves from 5GMM-REGISTERED to 5GMM-DEREGISTERED state, if the current 5G NAS security context is a mapped 5G NAS security context and a non-current full native 5G NAS security context exists, then the non-current 5G NAS security context shall become the current 5G NAS security context. Furthermore, the UE and the AMF shall delete any mapped 5G NAS security context or partial native 5G NAS security context.\nh)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from N1 mode to S1 mode:\n1)\tif the UE has a mapped 5G NAS security context and the inter-system change is performed in:\ni)\t5GMM-IDLE mode, the UE shall delete the mapped 5G NAS security context after the successful completion of the tracking area update procedure or attach procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]); or\nii)\t5GMM-CONNECTED mode, the UE shall delete the mapped 5G NAS security context after the completion of the inter-system change; and\ni)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has a non-current full native 5G NAS security context, then the UE shall make the non-current full native 5G NAS security context as the current native 5G NAS security context. The UE shall delete the mapped 5G NAS security context, if any.\nThe UE shall mark the 5G NAS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an initial registration procedure as described in subclause\u00a05.5.1.2 or when the UE leaves state 5GMM-DEREGISTERED for any other state except 5GMM-NULL.\nThe UE shall store the current native 5G NAS security context as specified in annex\u00a0C and mark it as valid only when the UE enters state 5GMM-DEREGISTERED from any other state except 5GMM-NULL or when the UE aborts the initial registration procedure without having left 5GMM-DEREGISTERED.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAlignment with TS 33.501 (S3-212796, CR #1182):Currently, when the UE is in N1 mode and moves to 5GMM-DEREGISTERED, if the current 5G NAS security context is a mapped 5G NAS security context and a non-current full native 5G NAS security context exists, then the non-current 5G NAS security context becomes the current 5G NAS security context and any mapped 5G NAS security context or partial native 5G NAS security context is deleted. If the UE later performs an initial registration in 5G (or a mobility registration update after EPS attach and subsequent inter-system change to 5G in IDLE mode), the current native 5G NAS security context can be used for the integrity protection of the Registration Request message. So the UE can avoid a new primary authentication procedure (which would delay the completion of the registration procedure noticeably, by about 30%).However, If the UE is in S1 mode when it moves to EMM-DEREGISTERED and 5GMM-DEREGISTERED, then this mechanism does not work as intended, because when the UE performs an inter-system change from N1 mode to S1 mode, it will delete any current mapped 5G NAS security context. Therefore, the condition in subclause 4.4.2.1, bullet g, \"if the current 5G NAS security context is a mapped 5G NAS security context\" will not be fulfilled, as there is no current 5G NAS security context.But the UE will still keep the non-current native 5G NAS security context, so if we remove the (unnecessary) condition that the UE needs to have a current mapped 5G NAS security context, then the UE can again make the non-current 5G NAS security context the current one and avoid the authentication procedure.\n\n>>> SUMMARY OF CHANGE\nRemove the condition in bullet g) that the UE (or the AMF) needs to have a current mapped 5G NAS security context.\n\n>>> CONSEQUENCES IF NOT REVISED\nA UE in S1 mode will unnecessarily delete a non-current native 5G NAS security context when moving to EMM-/5GMM-DEREGISTERED. This will cause an unnecessary delay during a subsequent initial registration as the network needs to perform a new 5G primary authentication."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********** START CHANGE ***********\n\n5.3.20\tMS Power Saving Mode\nA MS may adopt a PSM that is described in TS\u00a023.682\u00a0[119]. If an MS is capable of adopting a PSM and wants to use the PSM it shall request an Active Time value and may request a Periodic TAU/RAU Timer value during every Attach and RAU procedures, which are handled as described in TS\u00a023.682\u00a0[119]. The MS shall not request a Periodic TAU/RAU Timer value if it is not requesting an Active Time value. The network shall not allocate an Active Time value if the MS has not requested it.\nPSM has no support in the CS domain on the network side, but when PSM is activated the MS shall apply an Active Time regardless if the RR connection was used for accessing the PS or the CS domain.\nNOTE\u00a01:\tWhen the PSM is activated the MS might not be available for paging of Mobile Terminated CS services even though the MS is registered in the CS domain.\nNOTE\u00a02:\tThe Attach and RAU procedures of this specification are not showing the details of the Periodic RAU Time and Active Time negotiation, i.e. are not showing the related IEs.\nIf the network has allocated an Active Time value, the MS starts the Active Timer and the SGSN starts the Mobile Reachable timer (see clause\u00a06.2.3) with the Active Time value allocated by the network when transitioning from READY/PMM-CONNECTED to STANDBY/PMM-IDLE state. When the Active timer expires, the MS deactivates its Access Stratum functions and enters PSM. In PSM, due to deactivation of Access Stratum functions, the MS stops all idle mode procedures, but continues to run any NAS timers that may apply, e.g. periodic RAU timer. The MS shall resume Access Stratum functions and idle mode procedures before the periodic RAU timer expires for performing the periodic RAU procedure as applicable. The MS may resume idle mode procedures and AS functions any time while in PSM, e.g. for mobile originated communications. Any timers and conditions that remain valid during power-off, e.g. for NAS-level back-off, apply in the same way during PSM.\nWhen the mobile reachable timer expires and the SGSN stores an Active Time for the MS, the SGSN knows that the MS entered PSM and is not available for paging. The SGSN handles mobile reachable timer and availability for paging as detailed in clause\u00a06.2.3.\nOn MS side the PSM complies with some substates of GMM-REGISTERED, as specified in TS\u00a024.008\u00a0[13]. The SGSN considers the MS to be GMM-REGISTERED, but not reachable. The MS's Access Stratum functions are considered as deactivated during PSM regardless if the MS is attached to the PS or PS and CS domain and therefore limiting the supported procedures in the respective domains.\n\n\n*********** END CHANGE ***********\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSome key aspects of PSM have not been completed \u2013 specifically with regards to:(1) stopping of the active timer when the UE goes to connected mode. Note also that stage 3 has implemented this and hence stage 2 should align with the expected/adopted approach (see TS 24.008 V12.5.0, section 4.7.2.8) \u2013 quoting relevant text \u2013 \u201cTimer T3324 is stopped when the MS enters PMM-CONNECTED mode or GMM-DEREGISTERED state\u201d.(2) disabling of PSM when an emergency bearer service is active(3) CS service disruption - the MS may have an ongoing CS connection e.g. MO SMS, and hence deactivating the AS functions purely based on expiration of the active timer will disrupt the MS\u2019 CS connection.All of these aspects need to be addressed in order to not disrupt a service that is needed\n\n>>> SUMMARY OF CHANGE\n(1) The MS stops the active timer, if running, upon transitioning to READY/PMM-CONNECTED state (2) The MS does not use/enter PSM if active bearers for emergency services exist(3) After expiry of the active timer, the MS deactivates the AS functions if no CS connection exist\n\n>>> CONSEQUENCES IF NOT REVISED\nIn all cases, the MS\u2019 service will be disrupted undesirably:(1) The MS may initiate an MO session or receive a page for MT session. If the timer is not stopped, the AS will be deactivated and the service is disrupted(2) The MS may not receive any call back for emergency services if it enters PSM when active bearers for emergency service exist (3) The MS\u2019 CS connection will be disrupted"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********** START CHANGE ***********\n\n4.3.22\tUE Power Saving Mode\nA UE may adopt a PSM that is described in TS\u00a023.682\u00a0[74]. If a UE is capable of adopting a PSM and it wants to use the PSM it shall request an Active Time value and may request a Periodic TAU/RAU Timer value during every Attach and TAU procedures, which are handled as described in TS\u00a023.682\u00a0[74]. The UE shall not request a Periodic TAU/RAU Timer value if it is not requesting an Active Time value. The network shall not allocate an Active Time value if the UE has not requested it.\nPSM has no support in the CS domain on the network side.\nNOTE\u00a01:\tWhen the PSM is activated the UE might not be available for paging of Mobile Terminated CS services even though the UE is registered in the CS domain.\nNOTE\u00a02:\tThe Attach and TAU procedures of this specification are not showing the details of the Periodic TAU Time and Active Time negotiation, i.e. are not showing the related IEs.\nIf the network allocates an Active Time value, the UE starts the Active timer and the MME starts the mobile reachable timer (see clause\u00a04.3.5.2) with the Active Time value allocated by the network when transitioning from ECM_CONNECTED to ECM_IDLE. When the Active timer expires, the UE deactivates its Access Stratrum functions and enters PSM. In PSM, due to deactivation of Access Stratum functions, the UE stops all idle mode procedures, but continues to run any NAS timers that may apply, e.g. the periodic TAU timer. The UE shall resume Access Stratum functions and idle mode procedures before the periodic TAU timer expires for performing the periodic TAU procedure as applicable. The UE may resume idle mode procedures and Access Stratum functions any time while in PSM, e.g. for mobile originated communications. Any timers and conditions that remain valid during power-off, e.g. for NAS-level back-off, apply in the same way during PSM.\nWhen the mobile reachable timer expires and the MME stores an Active Time for the UE, the MME knows that the UE entered PSM and is not available for paging. The MME handles mobile reachable timer and availability for paging as detailed in clause\u00a04.3.5.2.\nOn UE side the PSM complies with some substates of EMM_REGISTERED, as specified in TS\u00a024.301. The MME considers the UE to be EMM_REGISTERED, but not reachable. The UE's Access Stratum functions are considered as deactivated during PSM.\n\n\n*********** END CHANGE ***********\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSome key aspects of PSM have not been completed \u2013 specifically with regards to:(1) stopping of the active timer when the UE goes to connected mode. Note also that stage 3 has implemented this and hence stage 2 should align with the expected/adopted approach (see TS 24.008 V12.5.0, section 4.7.2.8) \u2013 quoting relevant text \u2013 \u201cTimer T3324 is stopped when the MS enters PMM-CONNECTED mode or GMM-DEREGISTERED state\u201d.(2) disabling of PSM when an emergency bearer service is active.Both of these aspects need to be addressed in order to not disrupt a service that is needed\n\n>>> SUMMARY OF CHANGE\n(1) The UE stops the active timer, if running, upon transitioning to ECM_CONNECTED mode(2) The UE does not use/enter PSM if active bearers for emergency services exist\n\n>>> CONSEQUENCES IF NOT REVISED\nIn all cases, the UE\u2019s service will be disrupted undesirably:(1) The UE may initiate an MO session or receive a page for MT session. If the timer is not stopped, the AS will be deactivated and the service is disrupted(2) The UE may not receive any call back for emergency services if it enters PSM when active bearers for emergency service exist"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * First Change * * * *\n5.1.2.1.2\t3GPP AAA Server Detailed Behaviour\nOn receipt of the first DER message, the 3GPP AAA Server shall check the validity of the ANID AVP and whether the non-3GPP GW is entitled to use the included value. The correct syntax of the ANID is checked as follows:  \n-\tIn a non-roaming case, i.e. when the 3GPP AAA Server receives the request directly and not via the 3GPP AAA Proxy, checking ANID is mandatory;\n-\tIn a roaming case when the request is received via an 3GPP AAA proxy, checking ANID is optional. The 3GPP AAA Server may decide to check ANID based on local configuration, e.g. depending on the received visited network identifier.\n-\tIf the checking result shows that the included ANID value is not valid (not defined by 3GPP) or that the requesting entity is not entitled to use the received ANID value, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nThe 3GPP AAA Server shall check if user data exists in the 3GPP AAA Server (containing valid authentication information for the current access network identity). If not, the 3GPP AAA Server shall use the procedures defined in SWx interface to obtain access authentication and authorization data. \nIf SWx authentication response indicates that:\n-\tThe user does not exist, then the 3GPP AAA Server shall respond the non-3GPP GW with Experimental-Result-Code DIAMETER_ERROR_USER_UNKNOWN.\n-\tThe user does not have non-3GPP access subscription, then 3GPP AAA Server shall respond the non-3GPP GW with Experimental-Result-Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION.\n-\tThe user is not allowed to roam in the visited network, then 3GPP AAA Server shall respond the non-3GPP GW with Experimental-Result-Code DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\n-\tThe user is currently being served by a different 3GPP AAA Server, then the 3GPP AAA Server shall respond to the non-3GPP GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and the Redirect-Host set to the Diameter identity of the 3GPP AAA Server currently serving the user (as indicated in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tAny other error occurred, then the error code DIAMETER_UNABLE_TO_COMPLY shall be returned to the Non-3GPP GW.\nWhen SWx authentication response includes the requested authentication information, the 3GPP AAA Server shall proceed with the authentication and authorization procedure. The 3GPP AAA Server shall use the procedures defined in SWx interface to obtain the user's subscription profile from HSS. \nBefore sending out the authentication challenge, the 3GPP AAA Server shall decide, whether the access network is handled as Trusted or Untrusted. The 3GPP AAA Server shall make the decision based on the Access Network Identifier and Visited Network Identity information elements, according to its local policies. The local policies of the 3GPP AAA Server shall be based on the security criteria described in 3GPP TS 33.402 [19].\nNOTE:\tThe network operator can configure this e.g. according to the roaming agreements with the non-3GPP AN operator or with VPLMN operator. \nIn a roaming case, if the 3GPP AAA Server has received the trust relationship indicator from the VPLMN (AN-Trusted AVP), the 3GPP AAA Server may use this information as input parameter to the trusted/untrusted evaluation. \nThe VPLMN trust relationship indicator may be utilized only if\n-\tThe local breakout may be used for some of the APN connections of the user and\n-\tThe appropriate trust relationship exists between the HPLMN and VPLMN operators.\nThe 3GPP AAA Server shall identify the possibility for local breakout based on the VPLMNDynamicAddressAllowed AVPs in the user's subscription profile; if the PDN GW may be allocated in the VPLMN for any of the subscribed APNs, local breakout is considered to be possible.\nIf the 3GPP AAA Server has decided to take the received trust relationship indicator into account, it shall combine its own decision (taken as described above) with the received trust relationship indicator in a way that the final decision shall be \"trusted\" only if both initial decisions were \"trusted\"; otherwise, the final decision shall be \"untrusted\".\nBased on the trusted/untrusted decision, the 3GPP AAA Server may send a trust relationship indication to the UE, as described in 3GPP TS 24.302 [26].\nThe 3GPP AAA Server shall indicate the trust relationship assessment of the non-3GPP access network to the UE in the AT_TRUST_IND attribute as defined in 3GPP TS 24.302 [26]. The 3GPP AAA Server shall also indicate the trust relationship assessment to the non-3GPP access network using AN-Trusted AVP in the DEA (EAP-Request/AKA-Challenge) command.\nIf the decision is \"Trusted\", the STa authentication and authorization procedure is executed as described here, in clause 5.1.2.1 and it subclauses. Otherwise, the SWa authentication and authorization procedure is executed as described in clause 4.1.2.1.\nThe 3GPP AAA Server shall run EAP-AKA' authentication as specified in 3GPP TS 33.402 [19]. Exceptions shall be treated as error situations and the result code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nOnce authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error):\n1)\tCheck if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED\n2)\tCheck if the user is barred to use the subscribed APNs. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED \n3)\tCheck RAT-Type AVP. If \n-\tthe access type indicates any value not described in 3GPP TS 29.212 [23] or\n-\tthe received RAT-Type is listed in the user's disallowed RAT-Types, \nthis shall be treated as error and the Result-Code DIAMETER_UNABLE_TO_COMPLY shall be returned.\nThe following steps are only executed if the non-3GPP access network was decided to be Trusted.\n\n4)\tCheck if the user has a subscription for the requested APN. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION\n5)\tIf present, check the flags of the received MIP6-Feature-Vector AVP:\n-\tIf the MIP6-INTEGRATED flag is set and the 3GPP AAA Server has authorized DHCP Home Agent assignment, the 3GPP AAA Server shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6-INTEGRATED flag set. If the HA assignment via DHCPv6 is not used, the MIP6-Feature-Vector AVP with the MIP6-INTEGRATED flag not set shall be sent.\n-\tThe PMIP6_SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP GW supports PMIPv6 or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection. If the 3GPP AAA Server decides that PMIPv6 should be used, the PMIP6_SUPPORTED flag shall be set in the response to indicate the PMIPv6 support of the UE to the trusted non 3GPP GW. If the 3GPP AAA Server decides that a local IP address should be assigned, the ASSIGN_LOCAL_IP flag shall be set in the response to indicate to the trusted non 3GPP GW that a local IP address should be assigned. The 3GPP AAA Server shall not set the PMIP6_SUPPORTED and ASSIGN_LOCAL_IP flags both at the same time in the response. \n-\tThe MIP4_SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP GW supports MIPv4 FA-CoA mode or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection. If the 3GPP AAA Server decides that MIPv4 FA-CoA mode should be used, the MIP4_SUPPORTED flag shall be set in the response.\nNOTE:\tWhen selecting DSMIPv6 the AAA server assumes that the trusted non 3GPP GW has the capability to assign a local IP address to the UE.\nOnce the Authentication and Authorization procedure successfully finishes, the 3GPP AAA Server shall download, together with authentication data, the list of authorized APN\u2019s and the authorized mobility protocols in the authentication and authorization response from the HSS (see SWx procedure in Section 8.1.2.1). \nOnce the Authentication and Authorization procedures successfully finish and if MIPv4 FACoA mode is used the 3GPP AAA Server shall calculate the MIPv4 FACoA mobility security parameters as defined in 3GPP TS 33.402 [19] and  include these in the authentication and authorization response to the trusted non 3GPP GW.\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\n\n* * * Next Change * * * *\n8.2.3.3\tNon-3GPP-IP-Access\nThe Non-3GPP-IP-Access AVP (AVP code 1501) is of type Enumerated, and allows operators to determine barring of 3GPP - non-3GPP interworking subscription. The following values are defined:\n\tNON_3GPP_SUBSCRIPTION_ALLOWED (0)\n\t\tThe subscriber has non-3GPP subscription to access EPC network.\n\tNON_3GPP_SUBSCRIPTION_BARRED (1)\n\t\tThe subscriber has no non-3GPP subscription to access EPC network.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to the existing TS 29.273, the 3GPP AAA Server should authorize if the user is allowed to use non-3GPP access network to access EPC network and should also authorize the subscribed APNs for the trusted and untrusted cases. If any of those steps fail, the 3GPP AAA Server shall stop processing, see the following description:Once authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error):1)Check if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED2)Check if the user is barred to use the subscribed APNs. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED However, if the UE access via untrusted WLAN and obtain a local IP address, although no PDN connectivity to EPC is established, the UE could also get services using the local IP address based on the operator policy and roaming agreements, quote from TS23.402 Rel8:\u201cNOTE:The mismatch case where a trusted non-3GPP network or ePDG only supports DSMIPv6 and the UE does not, may lead to a situation where the UE receives a local IP address in the trusted non-3GPP access network or ePDG, but gains no PDN connectivity in the EPC. Depending on operator policy and roaming agreements, IP connectivity may be provided using this local IP address to access services (e.g. internet access) in the trusted non-3GPP network. However, any such use of the local IP address where the user traffic does not use the EPC is not described in this specification.\u201d Although the above use case is not described in the current SA2 specification, the 3GPP AAA Server should not forbiden this scenario by rejecting the UE only because the UE can not access EPC.\n\n>>> SUMMARY OF CHANGE\nClarify that the 3GPP AAA Server checks if the user is barred to use non-3GPP access. If so, the 3GPP AAA Server will reject the user with Result-code DIAMETER_AUTHORIZATION_REJECTED Remove the check of subscribed APNs from untrusted scenario to the trusted scenario.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe user will be rejected by the 3GPP AAA Server if it cannot access EPC network via non 3GPP access network. But in some cases, although the user cannot access EPC, it can perform direct IP access to the services. So it will seriously impact the user experience as direct IP connectivity will also be forbidden by the 3GPP AAA Server."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nFIRST CHANGE\n5.17.2.1\tGeneral\nInterworking with EPC in this clause refers to mobility procedures between 5GC and EPC/E-UTRAN, except for clause\u00a05.17.2.4. Network slicing aspects for EPS Interworking are specified in clause\u00a05.15.7\nIn order to interwork with EPC, the UE that supports both 5GC and EPC NAS can operate in single-registration mode or dual-registration mode:\n-\tIn single-registration mode, UE has only one active MM state (either RM state in 5GC or EMM state in EPC) and it is either in 5GC NAS mode or in EPC NAS mode (when connected to 5GC or EPC, respectively). UE maintains a single coordinated registration for 5GC and EPC. Accordingly, the UE maps the EPS-GUTI to 5G GUTI during mobility between EPC and 5GC and vice versa following the mapping rules in Annex B. To enable re-use of a previously established 5G security context when returning to 5GC, the UE also keeps the native 5G-GUTI and the native 5G security context when moving from 5GC to EPC.\n-\tIn dual-registration mode, UE handles independent registrations for 5GC and EPC using separate RRC connections. In this mode, UE maintains 5G-GUTI and EPS-GUTI independently. In this mode, UE provides native 5G-GUTI, if previously allocated by 5GC, for registrations towards 5GC and it provides native EPS-GUTI, if previously allocated by EPC, for Attach/TAU towards EPC. In this mode, the UE may be registered to 5GC only, EPC only, or to both 5GC and EPC.\n\tDual-registration mode is intended for interworking between EPS/E-UTRAN and 5GS/NR. A dual-registered UE should not send its E-UTRA connected to 5GC and E-UTRAN radio capabilities to NR access when connected to 5GS/NR to avoid being handed over to 5GC-connected E-UTRA or to E-UTRAN.\nNOTE\u00a01:\tThis is to prevent the dual registered UE from being connected to the same E-UTRA cell either connected to EPC or 5GC simultaneously using separate RRC connections via single RAN node as a result of handover. If a dual- registered UE implementation chooses to send its E-UTRA capability when connected to 5GS/NR, the UE and the network behaviour when UE enters a 5GC-connected E-UTRA is not further specified. If however the UE is registered with 5GS/NR only, the UE can send its E-UTRA capability in order to allow inter-RAT handover to E-UTRA/5GC and Dual Connectivity with multiple RATs.\n\tIf a dual-registered UE had not sent its E-UTRA connected to 5GC and E-UTRAN radio capabilities to 5GS and the UE needs to initiate emergency services, it shall locally re-enable its E-UTRA connected to 5GC and E-UTRAN radio capabilities in order to perform domain selection for emergency services as defined in TS\u00a023.167\u00a0[18].\nNOTE\u00a02:\tHowever even in this case, the UE is still not expected to connect to E-UTRAN/EPC and E-UTRA/5GC simultaneously using separate RRC connection via single RAN node as a result of the domain selection for emergency services.\nThe support of single registration mode is mandatory for UEs that support both 5GC and EPC NAS.\nDuring E-UTRAN Initial Attach, UE supporting both 5GC and EPC NAS shall indicate its support of 5G NAS in UE Network Capability described in clause\u00a05.11.3 of TS\u00a023.401\u00a0[26].\nDuring registration to 5GC, UE supporting both 5GC and EPC NAS shall indicate its support of EPC NAS.\nNOTE\u00a03:\tThis indication may be used to give the priority towards selection of PGW-C + SMF for UEs that support both EPC and 5GC NAS.\nIf the EPC supports \"Ethernet\" PDU Session Type, and the 5GSM Capabilities indicate that the UE supports Ethernet PDN type in EPC, then PDU Session type \"Ethernet\" is transferred to EPC as \"Ethernet\". Otherwise, PDU Session types \"Ethernet\" and \"Unstructured\" are transferred to EPC as \"non-IP\" PDN type (when supported by UE and network). If the UE or EPC does not support Ethernet PDN type in EPC, the UE sets the PDN type to non-IP when it moves from 5GS to EPS and after the transfer to EPS, and the UE and the SMF shall maintain information about the PDU Session type used in 5GS, i.e. information indicating that the PDN Connection with \"non-IP\" PDN type corresponds to PDU Session type Ethernet or Unstructured respectively. This is done to ensure that the appropriate PDU Session type will be used if the UE transfers to 5GS.\nPDN type \"non-IP\" is transferred to 5GS as \"Unstructured\" PDU Session type if it is successfully transferred.\nIt is assumed that if a UE supports Ethernet PDU Session type and/or Unstructured PDU Session type in 5GS it will also support non-IP PDN type in EPS. If this is not the case, the UE shall locally delete any EBI(s) corresponding to the Ethernet/Unstructured PDU Session(s) to avoid that the Ethernet/Unstructured PDU Session(s) are transferred to EPS.\nMTU size consideration for PDU Sessions and PDN Connections towards a SMF+PGW-C follows the requirements in clause\u00a05.6.10.4.\nNetworks that support interworking with EPC, may support interworking procedures that use the N26 interface or interworking procedures that do not use the N26 interface. Interworking procedures with N26 support provides IP address continuity on inter-system mobility to UEs that support 5GC NAS and EPC NAS and that operate in single registration mode. Networks that support interworking procedures without N26 shall support procedures to provide IP address continuity on inter-system mobility to UEs operating in both single-registration mode and dual-registration mode. In such networks, AMF shall provide the indication that interworking without N26 is supported to UEs during initial Registration in 5GC or MME may optionally provide the indication that interworking without N26 is supported in the Attach procedure in EPC as defined in TS\u00a023.401\u00a0[26].\nIf the network does not support interworking with EPC, network shall not indicate support for \"interworking without N26\" to the UE.\nWhen the HSS+UDM is required to provide the subscription data to the MME, for each APN, only one SMF+PGW-C FQDN and associated APN is provided to the MME according to TS\u00a023.401\u00a0[26].\nFor interworking without N26 interface:\n-\tif the PDU session supports interworking, the SMF+PGW-C stores the SMF+PGW-C FQDN to SMF context in HSS+UDM when the SMF is registered to HSS+UDM.\n-\tFor an APN, the HSS+UDM selects one of the stored SMF+PGW-C FQDN based on operator's policy.\nFor interworking with N26 interface:\n-\tFor a DNN, AMF determines PDU session(s) associated with 3GPP access in only one SMF+PGW-C supporting EPS interworking via EBI allocation procedure as described in clause\u00a04.11.1.4.1 of TS\u00a023.502\u00a0[3].\n-\tIf the network supports EPS interworking of non-3GPP access connected to 5GC, the AMF serving 3GPP access notifies the UDM to store the association between DNN and SMF+PGW-C FQDN which supports EPS interworking as Intersystem continuity context, to avoid MME receiving inconsistent SMF+PGW-C FQDN from AMF and HSS+UDM.\n-\tThe AMF updates Intersystem continuity context if the SMF+PGW-C and DNN association is changed due to the AMF selecting another SMF+PGW-C for EPS interworking for the same DNN.\n-\tIf the SMF+PGW-C FQDN and associated DNN exists in Intersystem continuity context, the HSS+UDM provides MME with SMF+PGW-C FQDN and associated APN.\nIt does not assume that the HSS+UDM is aware of whether N26 is deployed in the serving network. The HSS+UDM check the Intersystem continuity context first. If no SMF+PGW-C FQDN associated with an DNN exists in Intersystem continuity context, the HSS+UDM selects one of the SMF+PGW-C FQDN for the APN from SMF context based on operator's policy.\nIn entire clause\u00a05.17.2 the terms \"initial attach\", \"handover attach\" and \"TAU\" for the UE procedures in EPC can alternatively be combined EPS/IMSI Attach and combined TA/LA depending on the UE configuration defined in TS\u00a023.221\u00a0[23].\nIf a UE in MICO mode moves to E-UTRAN connected to EPC and any of the triggers defined in clause\u00a05.4.1.3 occur, then the UE shall locally disable MICO mode and perform the TAU or Attach procedure as defined in clause\u00a05.17.2. The UE can renegotiate MICO when it returns to 5GS during (re-)registration procedure.\nIP address preservation for IP PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to GERAN/UTRAN to a UE that had initially registered in 5GS and moved to EPC/E-UTRAN.\nNOTE\u00a04:\tThe SMF+PGW-C might not include the GERAN/UTRAN PDP Context anchor functionality. Also, 5GC does not provide GERAN/UTRAN PDP Context parameters to the UE when QoS flows of PDU Session are setup or modified in 5GS. Hence, the UE might not be able to activate the PDP contexts when it transitions to GERAN/UTRAN.\nIP address preservation for IP PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to 5GS to a 5GS NAS capable UE that had initially attached via GERAN/UTRAN and moved to EPC/E-UTRAN.\nNOTE\u00a05:\tThe SMF+PGW-C might not include the GERAN/UTRAN PDP Context anchor functionality. Also, 5GS NAS capable UE does not indicate the support of this capability to the network during GPRS attach via GERAN/UTRAN. Hence, SMF+PGW-C might not be selected for the UE's PDP contexts that are setup in GERAN/UTRAN.\nWhen a PDU session is moved from 5GS to EPS, the SMF+PGW-C keeps the registration and subscription in HSS+UDM until the corresponding PDN connection is released. The SMF+PGW-C may receive notification of subscription update regarding the DNN(s) which are associated with the PDN connection(s) connecting via EPS. In this case the SMF+PGW-C shall not trigger any action to those PDN connection(s). Instead, the MME will receive subscription update and trigger corresponding actions according to TS\u00a023.401\u00a0[26].\nIf header compression is used for Control Plane CIoT EPS/5GS Optimisations and when the UE moves from EPS to 5GS or from 5GS to EPS, the UE may initiate the PDU Session Modification Procedure or UE requested bearer resource modification procedure to renegotiate the header compression configuration and to establish the compression context between the UE and MME/SMF, see TS\u00a023.401\u00a0[26] and TS\u00a024.501\u00a0[47].\nIf the UE is moving from 5GS to EPS and the RAT type is also moving from a \"broadband\" RAT (e.g. NR or WB-E-UTRA) to NB-IoT in EMM-IDLE state, the UE should set the mapped EPS bearer context for which the EPS bearer is a dedicated EPS bearer to state BEARER CONTEXT INACTIVE as for NB-IoT UEs in EPS only support the default bearers. In addition, UE shall locally deactivate the related bearers according to the maximum number of supported UP resources and send the latest bearer context status in the TAU Request.\nIf APN Rate Control is used when the UE moves from EPC to 5GC then the P-GW/SCEF and UE store the current APN Rate Control Status for an APN. If while connected to 5GC the last PDU Session to a DNN that is the same as the APN identified in the APN Rate Control Status is released then the APN Rate Control Status may be stored in the AMF in addition to the Small Data Rate Control Status and the UE discards the APN Rate Control Status. The APN Rate Control Status is stored in the AMF so it can be provided to the MME during mobility to EPC and subsequently applied at establishment of a new first PDN Connection to the same APN, if valid. The APN Rate Control Status is provided to the PGW-U+UPF if a first new PDU Session is established towards the DNN that is the same as the APN identified in the APN Rate Control Status if the UE moves back to EPC, taking into account its validity period.\nThe UE may be provided with initial APN Rate Control parameters by the SMF when a first new PDU Session is established for a DNN and S-NSSAI that supports interworking with EPS and the DNN matches an APN. The SMF provides the APN Rate Control Status for the APN that matches the DNN, if available at the SMF, otherwise the configured APN Rate Control parameters for the APN that matches the DNN are provided as the initially applied parameters. If the initially applied parameters differ from the configured APN Rate Control parameters and the first APN Rate Control validity period expires, the UE is updated with the configured APN Rate Control parameters once the UE has moved to EPC.\nNOTE\u00a06:\tIf the APN Rate Control Status is provided to a PGW-U+UPF it is not used for Small Data Rate Control while the UE is connected to 5GC, it is only used as the APN Rate Control Status if the UE moves to EPC.\nNOTE\u00a07:\tEncoding of APN and DNN specified in TS\u00a023.003\u00a0[19] allows the comparison of EPS APN and 5GS DNN.\nIf a Service Gap timer is running in the AMF when the UE moves from 5GC to EPC, the AMF stops the running Service Gap timer. If the UE returns to 5GC from EPC the AMF provides the Service Gap Time to the UE as described in clause\u00a05.31.16.\nIf a Service Gap timer is running in the MME when the UE moves from EPC to 5GC, the MME stops the running Service Gap timer. If the UE returns to E-UTRAN connected to EPC from 5GC the MME provides the Service Gap Time to the UE as described in TS\u00a023.401\u00a0[26].\nIf a Service Gap timer is running in the UE when the UE moves to from 5GC to EPC and if Service Gap Time is received from the MME, the UE stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE and applied for EPC. If a Service Gap timer is running in the UE when the UE moves to 5GC and if Service Gap Time is received from the AMF, the UE stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE and applied in 5GS.\n \n\n\n\n\nNEXT CHANGE (2)\n\n\nNEXT CHANGE (3)\n\n\n\nNEXT CHANGE (4)\n\n\n\n\nNEXT CHANGE (5)\n\n\n\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nC3 has sent to SA2 the LS C3-210377 / S2-2100057 noting the following:CT3 has observed that EAP based Secondary Authentication and Authorization for 5GS interworking with EPS has not been described in 3GPP\u00a0TS\u00a023.501, 3GPP\u00a0TS\u00a023.502 in SA2 and 3GPP\u00a0TS\u00a033.501 in SA3. Correspondingly 3GPP\u00a0TS\u00a029.561 does not include descriptions on how to support EAP based secondary authentication and authorization interworking with the external DN-AAA server, when the UE is under 5GS and EPS interworking scenarios.\n\n>>> SUMMARY OF CHANGE\nIf the access to a DN is to be controlled by mechanisms defined in clause 5.6.6 (secondary authentication / autorization by a DN server), for a PDN connection allowed for mobility to 5GC, \u00a0the PDN connection establishment includes a phase of Secondary authentication/authorization by a DN-AAA server. This is further defined in 23.502.\n\n>>> CONSEQUENCES IF NOT REVISED\nFor a DN whose access is to be controlled by secondary authentication / autorization by a DN server, different levels of security are provided depending on whether a data connection to this DN a has been established by the UE over EPC or over 5GC."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n********************* Start of 1st change *************************\n6.7.3\tProcedures for AS algorithm selection\n6.7.3.0\tInitial AS security context establishment\nThis clause provides the details for AS security algorithms negotiation and consideration during the UE initial AS security context establishment.\nEach gNB shall be configured via network management with lists of algorithms which are allowed for usage. There shall be one list for integrity algorithms, and one for ciphering algorithms. These lists shall be ordered according to a priority decided by the operator. When AS security context is to be established in the gNB, the AMF shall send the UE 5G security capabilities to the gNB. The gNB shall choose the ciphering algorithm which has the highest priority from its configured list and is also present in the UE 5G security capabilities. \nThe gNB shall choose the integrity algorithm which has the highest priority from its configured list and is also present in the UE 5G security capabilities. The chosen algorithms shall be indicated to the UE in the AS SMC. The chosen ciphering algorithm is used for ciphering (when activated) of the user plane and RRC traffic. The chosen integrity algorithm is used for integrity protection (when activated) of the user plane and RRC traffic. Activation of ciphering and integrity protection for the RRC traffic shall be done as defined by clause 6.7.4. Activation of ciphering and integrity protection for the user plane traffic shall be done based on the UP security policy received from the SMF .as defined by clause <\"UP security activation procedure\" >.\n6.7.3.1\tXn-handover \nAt handover from a source gNB over Xn to a target gNB, the source gNB shall include the UE's 5G security capabilities and ciphering and integrity algorithms used in the source cell in the handover request message. The target gNB shall select the algorithm with highest priority from the received 5G security capabilities of the UE according to the prioritized locally configured list of algorithms (this applies for both integrity and ciphering algorithms). The chosen algorithms shall be indicated to the UE in the Handover Command message if the target gNB selects different algorithms compared to the source gNB. If the UE does not receive any selection of integrity and ciphering algorithms, it continues to use the same algorithms as before the handover (see TS 38.331 [22]). In the Path-Switch message, the target gNB shall send the UE's 5G security capabilities received from the source gNB to the AMF. The AMF shall verify that the UE's 5G security capabilities received from the target gNB are the same as the UE's 5G security capabilities that the AMF has locally stored. If there is a mismatch, the AMF shall send its locally stored 5G security capabilities of the UE to the target gNB in the Path-Switch Acknowledge message. Additionally, the AMF may log the event and may take additional measures, such as raising an alarm.\nIf the target gNB receives UE's 5G security capabilities from the AMF in the Path-Switch Acknowledge message, the target gNB shall update the AS security context of the UE with these 5G security capabilities of the UE. The target gNB shall select the algorithm with highest priority from these 5G security capabilities according to the locally configured prioritized list of algorithms (this applies for both integrity and ciphering algorithms). If the algorithms selected by the target gNB are different from the algorithms used at the source gNB, then the target gNB shall initiate RRC Connection Reconfiguration procedure indicating the selected algorithms to the UE.\nNOTE:\tTransferring the ciphering and integrity algorithms used in the source cell to the target gNB in the handover request message is for the target gNB to decipher and verify the integrity of the RRC Reestablishment Complete message on SRB1 in the potential RRC Connection Re-establishment procedure. The information is also used by the target gNB to decide if it is necessary to include a new selection of security algorithms in the Handover Command message.\n6.7.3.2\tN2-handover\nAt handover from a source gNB to a target gNB over N2 (possibly including an AMF change and hence a transfer of the UE's 5G security capabilities from the source AMF to the target AMF), the target AMF shall send the UE's 5G security capabilities to the target in the N2 HANDOVER REQUEST message. The target gNB shall select the algorithm with highest priority from the UE's 5G security capabilities according to the locally configured prioritized list of algorithms (this applies for both integrity and ciphering algorithms). The chosen algorithms shall be indicated to the UE in the Handover Command message if the target gNB selects different algorithms compared to the source gNB. If the UE does not receive any selection of integrity and ciphering algorithms, it continues to use the same algorithms as before the handover (see TS 38.331 [22]). \nEditor's Note: The message names for the signalling messages sent on N2 interface needs to be aligned with RAN3 specifications when available.\n6.7.3.3\tIntra-gNB-CU handover\nIt is not required to change the AS security algorithms during intra-gNB-CU handover. If the UE does not receive an indication of new AS security algorithms during an intra-gNB-CU handover, the UE shall continue to use the same algorithms as before the handover (see TS 38.331 [22]).\n\n\n\n********************* End of 1st change *************************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCorrections to support AS Security context set up for signalling only connections. SA2 TS 23.501 and 23.502 specifies scenarios where AS security context is required only for signalling connection. Such a scenario is not explicitly mentioned in TS 33.501. Without securing the signalling connection, there is security risk to this connection. Hence needs to be protected.\n\n>>> SUMMARY OF CHANGE\nIn clause 6.7.0 Capture that when AS security context is to be established in the gNB, the AMF shall send the \u2018NGAP UE Initial Context Setup Request\u2019 containing \u2018UE 5G security capabilities\u2019 to the gNB. In a separate clause \u20186.7.3.4AS context setup for signalling only connections\u2019 capture that the  connection is always secured using AS Security set up.\n\n>>> CONSEQUENCES IF NOT REVISED\nScenarios specified in TS 23.501 and 23.502 becomes a security risk."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\nSTART OF CHANGES\n5.3.1.2\tSecurity\nAS security comprises of the integrity protection of RRC signalling (SRBs) as well as the ciphering of RRC signalling (SRBs) and user data (DRBs).\nRRC handles the configuration of the security parameters which are part of the AS configuration: the integrity protection algorithm, the ciphering algorithm and two parameters, namely the keyChangeIndicator and the nextHopChainingCount, which are used by the UE to determine the AS security keys upon handover, connection re-establishment, connection resume and/ or UP-EDT.\nThe integrity protection algorithm is common for signalling radio bearers SRB1, SRB2 and SRB4. When configured with MCG only, the ciphering algorithm is common for all radio bearers (i.e. SRB1, SRB2, SRB4 and DRBs). Neither integrity protection nor ciphering applies for SRB0.\nRRC integrity and ciphering are always activated together, i.e. in one message/ procedure. RRC integrity and ciphering are never de-activated. However, it is possible to switch to a 'NULL' ciphering algorithm (eea0).\nThe 'NULL' integrity protection algorithm (eia0) is used only for the UE in limited service mode, as specified in TS 33.401 [32]. In case the 'NULL' integrity protection algorithm is used, 'NULL' ciphering algorithm is also used.\nNOTE 1:\tLower layers discard RRC messages for which the integrity check has failed and indicate the integrity verification check failure to RRC.\nThe AS applies three different security keys: one for the integrity protection of RRC signalling (KRRCint), one for the ciphering of RRC signalling (KRRCenc) and one for the ciphering of user data (KUPenc). All three AS keys are derived from the KeNB key. The KeNB is based on the KASME key for E-UTRA/EPC, or KAMF for E-UTRA/5GC, which is handled by upper layers.\nUpon connection establishment new AS keys are derived. No AS-parameters are exchanged to serve as inputs for the derivation of the new AS keys at connection establishment.\nThe integrity and ciphering of the RRC message used to perform handover is based on the security configuration used prior to the handover and is performed by the source eNB.\nThe integrity and ciphering algorithms can only be changed upon handover. The four AS keys (KeNB, KRRCint, KRRCenc and KUPenc) change upon every handover, connection re-establishment, connection resume and UP-EDT. The keyChangeIndicator is used upon handover and indicates whether the UE should use the keys associated with the KASME key for E-UTRA/EPC, or KAMF for E-UTRA/5GC, taken into use with the latest successful NAS SMC procedure. The nextHopChainingCount parameter is used upon handover, connection re-establishment, connection resume and UP-EDT by the UE when deriving the new KeNB that is used to generate KRRCint, KRRCenc and KUPenc (see TS 33.401 [32]). An intra cell handover procedure may be used to change the keys in RRC_CONNECTED.\nFor each radio bearer an independent counter (COUNT, as specified in TS 36.323 [8] for E-UTRA/EPC, and TS 38.323 [83] for E-UTRA/5GC) is maintained for each direction. For each DRB, the COUNT is used as input for ciphering. For each SRB, the COUNT is used as input for both ciphering and integrity protection. It is not allowed to use the same COUNT value more than once for a given security key. At connection resume the COUNT is reset. In order to limit the signalling overhead, individual messages/ packets include a short sequence number (PDCP SN, as specified in TS 36.323 [8] for E-UTRA/EPC, and TS 38.323 [83] for E-UTRA/5GC). In addition, an overflow counter mechanism is used: the hyper frame number (TX_HFN and RX_HFN, as specified in TS 36.323 [8] for E-UTRA/EPC, and TS 38.323 [83] for E-UTRA/5GC). The HFN needs to be synchronized between the UE and the eNB. The eNB is responsible for avoiding reuse of the COUNT with the same RB identity and with the same KeNB, e.g. due to the transfer of large volumes of data, release and establishment of new RBs. In order to avoid such re-use, the eNB may e.g. use different RB identities for successive RB establishments, trigger an intra cell handover or by triggering a transition from RRC_CONNECTED to RRC_IDLE or RRC_INACTIVE and then back to RRC_CONNECTED.\nFor each SRB, the value provided by RRC to lower layers to derive the 5-bit BEARER parameter used as input for ciphering and for integrity protection is the value of the corresponding srb-Identity with the MSBs padded with zeroes.\nIn case of DC, a separate KeNB is used for SCG-DRBs (S-KeNB). This key is derived from the key used for the MCG (KeNB) and an SCG counter that is used to ensure freshness. To refresh the S-KeNB e.g. when the COUNT will wrap around, E-UTRAN employs an SCG change, i.e. an RRCConnectionReconfiguration message including mobilityControlInfoSCG. When performing handover, while at least one SCG-DRB remains configured, both KeNB and S-KeNB are refreshed. In such case E-UTRAN performs handover with SCG change i.e. an RRCConnectionReconfiguration message including both mobilityControlInfo and mobilityControlInfoSCG. The ciphering algorithm is common for all radio bearers within a CG but may be different between MCG and SCG. The ciphering algorithm for SCG DRBs can only be changed upon SCG change.\nIn case of EN-DC, the network indicates whether the UE shall use either KeNB or S-KgNB for a particular DRB. S-KgNB is derived in the same way as S-KeNB as defined in TS 33.501 [86], uses a different counter (sk-Counter) and is used only for DRBs using NR PDCP. Whenever there is a need to refresh S-KgNB, e.g. upon change of MN or SN, the NR SCG reconfiguration with sync and key change is used (see 5.3.1.1). E-UTRAN provides a UE configured with EN-DC with an sk-Counter even when no DRB is setup using S-KgNB i.e. to facilitate configuration of SRB3. The same ciphering algorithm is used for all radio bearers using the same key (i.e. KeNB or S-KgNB). Likewise, the same integrity algorithm is used for all SRBs using the same key. Although NR RRC uses different values for the security algorithms than E-UTRA, the actual algorithms are the same in case of EN-DC in this version of the specification. Hence, for such algorithms, the security capabilities supported by a UE are consistent across these RATs.\n\neNote\tFFS whether to add any clarification regarding how security algorithms are signalled. I.e. to describe the signalling for all MRDC cases (I.e. that securityConfig in NR RadioBearerConfig is used for both MN and SN terminated bearers).\nNOTE 2:\tThe network ensures that different values are used for the SCG counter and for the sk-Counter when deriving S-KgNB and/or S-KeNB from the same KeNB.\n\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWith the introduction of MR-DC in Rel-15 Late Drop, the description of the security handling for NR-DC, NGEN-DC, and NE-DC is incomplete.\n\n>>> SUMMARY OF CHANGE\nExtended description of security handling for EN-DC and added new paragraph describing security handling for NE-DC and NR-DCImpact analysisImpacted functionality:Security configurationInter-operability: If the network is implemented according to this CR while the UE is not, the UE and network may assume wrong security code points which could result in failed decryption or integrity check.If the UE is implemented according to this CR while the network is not, the UE and network may assume wrong security code points which could result in failed decryption or integrity check.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE and network may use different security codepoints (signalled in E-UTRA or NR message) leading to failed decryption or integrity check"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n------------------------------------------- 1st Change ------------------------------------\n4.5.2.4\tActions at the AS serving the originating UE\nFor an originating user that subscribes to the OIR service in \"permanent mode\", the AS shall insert a Privacy header field set to \"id\" or \"header\" based on the subscription option if the request does not include a Privacy header field that is set to the corresponding value. If the request includes a Privacy header field that is set to \"none\", the AS shall remove the \"none\" value from the Privacy header field. Additionally, based on operator policy, the AS shall either modify the From header field to remove the identification information, or add a Privacy header field set to \"user\". \nFor an originating user that subscribes to the OIR service in \"temporary mode\" with default \"restricted\", if the request does not include a Privacy header field, or the request includes a Privacy header field that is not set to \"none\", the AS shall insert a Privacy header field set to \"id\" or \"header\" based on the subscription option. Additionally based on operator policy, the AS shall either modify the From header field to remove the identification information, or add a Privacy header field set to \"user\".\nNOTE:\tWhen the OIR service is used, the originating UE is supposed to already have removed identity information. However because this UE is not trusted, this is also done by the AS to ensure that this information is removed.\nFor an originating user that subscribes to the OIR service in \"temporary mode\" with default \"not restricted\", if the request includes a Privacy header field is set to \"id\" or \"header\", based on operator policy, the AS shall either, may modify the From header field to remove the identification information or add a Privacy header field set to \"user\". As an originating network option, if the \"no screening\" special arrangement does not exist with the originating user, the network may attempt to match the information in the From header with the set of registered public identities of the originating user. If a match is not found, the AS may set the From header to the SIP URI that includes the default public user identity.\n\n------------------------------------------ End Change -----------------------------------\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe 4.5.2.4 contains a \"shall\" followed by a \"may\". The may can be removed.Further, the subclause 4.5.2.4 talks about the procedures in the originating AS but on one place \"the network\" instead of \"AS\".\n\n>>> SUMMARY OF CHANGE\nThe \"shall\" is kept and the \"may\" is removed.network is replaced with AS.\n\n>>> CONSEQUENCES IF NOT REVISED\nCan cause confusion: is it mandatory or optional and who shall perform the actions the network or the AS! At the end of the day this may cause interoperability problems and that a user's identity incorrectly is revealed to the called party."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n5.5.1.2.4\tAttach accepted by the network\nDuring an attach for emergency bearer services, if not restricted by local regulations, the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.\nIf the attach request is accepted by the network, the MME shall send an ATTACH ACCEPT message to the UE and start timer T3450. \nIf the attach request included the PDN CONNECTIVITY REQUEST message in the ESM message container information element to request PDN connectivity, the MME when accepting the attach request shall:\n-\tsend the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element and discard the ESM message container information element included in the attach request if:\n-\tthe UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message;\n-\tthe MME supports EMM-REGISTERED without PDN connection and PDN connection is restricted according to the user's subscription data;\n-\tthe attach type is not set to \"EPS emergency attach\"; and \n-\tthe request type of the UE requested PDN connection is not set to \"emergency\";\n-\totherwise, send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see subclause\u00a06.4.1). In WB-S1 mode, the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see subclause\u00a06.4.2). In NB-S1 mode the network shall not initiate the activation of dedicated bearers.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.\nIf the attach request is accepted by the network, the MME shall delete the stored UE radio capability information, if any.\nIn NB-S1 mode, if the attach request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.\nIf the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.\nNOTE\u00a02:\tFor further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP\u00a0TS\u00a023.401\u00a0[10].\nIf the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the MME shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data.\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the attach request for EPS services and \"SMS only\", the MME shall indicate \"SMS only\" in the Additional update result IE and shall set the EPS attach result IE to \"EPS only\" in the ATTACH ACCEPT message.\nThe MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of eDRX.\nThe MME shall assign and include the TAI list the UE is registered to in the ATTACH ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. The UE, upon receiving an ATTACH ACCEPT message, shall delete its old TAI list and store the received TAI list. \nNOTE\u00a03:\tWhen assigning the TAI list, the MME can take into account the eNodeB's capability of support ofCIoT EPS optimiz ation.\nThe MME may include T3412 extended value IE in the ATTACH ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message.\nThe MME shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM.\nIf the MME supports and accepts the use of PSM, and the UE included the T3412 extended value IE in the ATTACH REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message.\nNOTE\u00a04:\tBesides the value requested by the UE, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (3GPP\u00a0TS\u00a023.401\u00a0[10] subclause\u00a04.3.17.3).\nIf the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate support for EMM-REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause\u00a05 and in clause\u00a06.\nIf the UE requests \"control plane CIoT EPS optimization\" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the attach request, the MME shall indicate \"control plane CIoT EPS optimization supported\" in the EPS network feature support IE.\nIf the MME supports NB-S1 mode or Non-IP PDN type, then the MME shall support the extended protocol configuration options IE.\nIf the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to \"extended protocol configuration options supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the ATTACH ACCEPT message.\nIf the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nSubject to operator policies, if unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to \"Unsecured redirection to GERAN not allowed\" in the Network policy IE of the ATTACH ACCEPT message.\nUpon receiving the ATTACH ACCEPT message, the UE shall stop timer T3410.\nThe GUTI reallocation may be part of the attach procedure. When the ATTACH REQUEST message includes the IMSI or IMEI, or the MME considers the GUTI provided by the UE is invalid, or the GUTI provided by the UE was assigned by another MME, the MME shall allocate a new GUTI to the UE. The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.4.1.\nFor a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP\u00a0TS\u00a023.251\u00a0[8B]).\nIf the ATTACH ACCEPT message contains a GUTI, the UE shall use this GUTI as the new temporary identity. The UE shall delete its old GUTI and store the new assigned GUTI. If no GUTI has been included by the MME in the ATTACH ACCEPT message, the old GUTI, if any available, shall be kept. \nIf A/Gb mode or Iu mode is supported in the UE, the UE shall set its TIN to \"GUTI\" when receiving the ATTACH ACCEPT message.\nIf the ATTACH ACCEPT message contains the T3412 extended value IE, then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). If the ATTACH ACCEPT message does not contain T3412 extended value IE, then the UE shall use the value in T3412 value IE as periodic tracking area update timer (T3412).\nIf the ATTACH ACCEPT message contains the T3324 value IE, then the UE shall use the included timer value for T3324 as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13], subclause\u00a04.7.2.8.\nIf the ATTACH ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex\u00a0C.\nThe MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the attach procedure is not for emergency bearer services, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. If the ATTACH ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the attach procedure is not for emergency bearer services, and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\" or the list of \"forbidden PLMNs for GPRS service\", any such PLMN identity shall be deleted from the corresponding list(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP\u00a0TS\u00a023.221\u00a0[8A], subclause\u00a07.2a and subclause\u00a07.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP\u00a0TS\u00a024.171\u00a0[13C].\nIf the RestrictDCNR bit is set to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.\nIf the redir-policy bit is set to \"Unsecured redirection to GERAN not allowed\" in the Network policy IE of the ATTACH ACCEPT message, the UE shall store it for the current PLMN and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. The UE shall delete the stored network policy on unsecured redirection to GERAN when \nentering a new PLMN which is not an equivalent PLMN of the registered PLMN\n\n.\nIf the UE has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message; and the UE sent the ATTACH REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.\nWhen the UE receives the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network.\nAdditionally, the UE shall reset the attach attempt counter, service request attempt counter and tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network.\nIf the UE receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause\u00a05.3.7b), then the UE shall reset these counters. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall reset this counter.\nWhen the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) after successful completion of the attach procedure.\nIf the attach procedure was initiated in S101 mode, the lower layers are informed about the successful completion of the procedure.\nUpon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the GUTI sent in the ATTACH ACCEPT message as valid.\nIf the T3448 value IE is present in the received ATTACH ACCEPT message, the UE shall:\n-\tstop timer T3448 if it is running; and\n-\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the ATTACH ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.\n\n***** Next change *****\n5.5.3.2.4\tNormal and periodic tracking area updating procedure accepted by the network\nIf the tracking area update request has been accepted by the network, the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. If the MME assigns a new GUTI for the UE, a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. In this case, the MME shall start timer T3450 and enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.4.1. The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode.\nNOTE\u00a01:\tWhen assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.\nIf the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.\nNOTE\u00a02:\tThis information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.\nNOTE\u00a03:\tFor further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP\u00a0TS\u00a023.401\u00a0[10].\nIn NB-S1 mode, if the tracking area update request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.\nIf a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall delete the stored UE radio capability information, if any.\nIf the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data.\nIf the UE requests \"control plane CIoT EPS optimization\" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, the MME shall indicate \"control plane CIoT EPS optimization supported\" in the EPS network feature support IE.\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the tracking area update request for EPS services and \"SMS only\", the MME shall indicate \"SMS only\" in the Additional update result IE and shall set the EPS update type IE to \"TA updating\" in the TRACKING AREA UPDATE ACCEPT message.\nThe MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of eDRX.\nIf the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause\u00a05 and in clause\u00a06.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.\nIf the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side.\nIf the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates \"periodic updating\", and the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.\nThe MME shall indicate \"combined TA/LA updated\" or \"combined TA/LA updated and ISR activated\" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, if the following conditions apply:\n-\tthe EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates \"periodic updating\" and the UE was previously successfully attached for EPS and non-EPS services; and\n-\tlocation area updating for non-EPS services as specified in 3GPP\u00a0TS\u00a029.118\u00a0[16A] is successful.\nThe MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message.\nThe MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of PSM.\nIf the MME supports and accepts the use of PSM, and the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message.\nNOTE\u00a04:\tBesides the value requested by the MS, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (see 3GPP\u00a0TS\u00a023.401\u00a0[10] subclause\u00a04.3.17.3).\nIf the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, then the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.\nAlso during the tracking area updating procedure without \"active\" flag, if the MME has deactivated EPS bearer context(s) locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.\nAlso during the tracking area updating procedure with \"active\" flag, if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.\nIf the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex\u00a0C.\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but it has a PDN connection for emergency bearer services established, the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure when the tracking area updating procedure is initiated in EMM-CONNECTED mode. When the tracking area updating procedure is initiated in EMM-IDLE mode, the MME locally deactivates all non-emergency EPS bearer contexts and informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not deactivate the emergency EPS bearer contexts. The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.\nIf a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, and if:\n-\ta GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP\u00a0TS\u00a036.413\u00a0[23]); or\n-\tno GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\nthen the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. Furthermore, the MME takes one of the following actions:\n-\tif no active EPS bearer contexts remain for the UE, the MME shall not accept the tracking area update request as specified in subclause\u00a05.5.3.2.5;\n-\tif active EPS bearer contexts remain for the UE and the TRACKING AREA UPDATE REQUEST message is accepted, the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated.\nIf a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, the following different cases can be distinguished:\n1)\tIf the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:\n-\ta SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP\u00a0TS\u00a036.413\u00a0[23]); or\n-\tno SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\n2)\tIf the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:\n-\ta LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP\u00a0TS\u00a036.413\u00a0[23]); or\n-\tno LHN-ID value  is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\nthen the MME takes one of the following actions:\n-\tif the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type \"re-attach required\" (see subclause\u00a05.5.2.3.1);\n-\tif the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, then the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 \"reactivation requested\"for the default EPS bearer context of the SIPTO at the local network PDN connection (see subclause 6.4.4.2); and\n-\tif a PDN connection remains that is not SIPTO at the local network PDN connection, the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause\u00a0#39 \"reactivation requested\"for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause\u00a06.4.4.2);\nFor a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP\u00a0TS\u00a023.401\u00a0[10], subclause\u00a04.3.5.6.\nFor a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP\u00a0TS\u00a023.251\u00a0[8B]).\nIf the \"active\" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. If the \"active\" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication.\nIf the \"signalling active\" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure.\nIf the \"active\" flag is not included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling. If the \"active\" flag is not included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling.\nIf the MME supports NB-S1 mode or Non-IP PDN type, then the MME shall support the extended protocol configuration options IE.\nIf the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to \"extended protocol configuration options supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nThe MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.\nIf the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nSubject to operator policies, if unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to \"Unsecured redirection to GERAN not allowed\" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message.\nUpon receiving a TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3430, reset the service request attempt counter, tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED. If the message contains a GUTI, the UE shall use this GUTI as new temporary identity for EPS services and shall store the new GUTI. If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, the old GUTI shall be used. If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.\nIf the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause\u00a05.3.7b), then the UE shall reset these counters. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall reset this counter.\nIf the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, then the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, but not T3412 extended value IE, then the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). If neither T3412 value IE nor T3412 extended value IE is included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message.\nIf the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, then the UE shall use the timer value for T3324 as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13], subclause\u00a04.7.2.8.\nIf the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the nonceUE was included in the TRACKING AREA UPDATE REQUEST message, the UE shall delete the nonceUE upon receipt of the TRACKING AREA UPDATE ACCEPT message.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE.\nThe MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no PDN connection for emergency bearer services established, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\". If the UE is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of \"forbidden PLMNs for GPRS service\" when the PDN connection for emergency bearer services is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. If the TRACKING AREA UPDATE ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the UE is not attached for emergency bearer services and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\" or the list of \"forbidden PLMNs for GPRS service\", any such PLMN identity shall be deleted from the corresponding list(s).\nThe network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. If the UE is attached for emergency bearer services, the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. If the TRACKING AREA UPDATE ACCEPT message contains:\ni)\tno indication that ISR is activated, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\nii)\tan indication that ISR is activated, then:\n-\tif the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13], annex\u00a0P.5, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\n-\tif the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\n-\tif the UE had initiated the tracking area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running; or\n-\tthe UE shall regard a previously assigned P-TMSI and RAI as valid and registered with the network. If the TIN currently indicates \"P-TMSI\" and the periodic routing area update timer T3312 is running or is deactivated, the UE shall set the TIN to \"RAT-related TMSI\". If the TIN currently indicates \"P-TMSI\" and the periodic routing area update timer T3312 has already expired, the UE shall set the TIN to \"GUTI\".\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP\u00a0TS\u00a023.221\u00a0[8A], subclause\u00a07.2a and subclause\u00a07.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, then the UE shall not locally release any persistent EPS bearer context. When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, then the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP\u00a0TS\u00a024.171\u00a0[13C].\nIf the RestrictDCNR bit is set to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.\nIf the redir-policy bit is set to \"Unsecured redirection to GERAN not allowed\" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall store it for the current PLMN and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. The UE shall delete the stored network policy on unsecured redirection to GERAN \nwhen entering a new PLMN which is not an equivalent PLMN of the registered PLMN\n\n.\nIf the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, and the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.\nIf the TRACKING AREA UPDATE ACCEPT message contained a GUTI, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI.\nIf the UE which was previously successfully attached for EPS and non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating \"combined TA/LA updated\" or \"combined TA/LA updated and ISR activated\" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating \"periodic updating\", the UE shall behave as follows:\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. \n-\tIf neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.\nIf the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation for which the MME indicated that the header compression configuration is not used.\nIf the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, the UE shall:\n-\tstop timer T3448 if it is running; and\n-\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.\nIf the UE in EMM-IDLE mode initiated the tracking area update procedure and the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nUpon receiving a TRACKING AREA UPDATE COMPLETE message, the MME shall stop timer T3450 and change to state EMM-REGISTERED. The GUTI, if sent in the TRACKING AREA UPDATE ACCEPT message, shall be considered as valid.\nNOTE\u00a05:\tUpon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP\u00a0TS\u00a029.118\u00a0[16A].\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take one of the following actions:\n-\tif the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context and integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context;\n-\tif the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, and if the UE has included a valid GPRS ciphering key sequence number, the MME shall create a new mapped EPS security context as specified in 3GPP\u00a0TS\u00a033.401\u00a0[19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause\u00a05.4.3.2); or\n-\tif the UE has not included an Additional GUTI IE, the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, i.e. as if it cannot retrieve the current EPS security context.\nNOTE\u00a06:\tThe handling described above at failure to retrieve the current EPS security context or if no Additional GUTI IE was provided does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, the MME shall create a new mapped EPS security context as specified in 3GPP\u00a0TS\u00a033.401\u00a0[19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause\u00a05.4.3.2).\nNOTE\u00a07:\tThis does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see subclause\u00a04.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:\n-\tif the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or\n-\tif the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) CR #2951 r3 (C1-175425) added new MME requirements to the attach and TAU procedure, e.g.:\"Subject to operator policies, if unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to \"Unsecured redirection to GERAN not allowed\" ...\"In this sentence it is ambiguous whether the phrase \"subject to operator policy\" is referring to - the question whether unsecured redirection is allowed or - to the setting of the redir-policy bit by the MME if that redirection is not allowed.It is proposed to clarify that it is the first one.2) When the UE enters a \"new\" PLMN, it can no longer rely on the policy provided by the previous RPLMN. The corresponding UE requirement in CR #2951 r3 reads:The UE shall delete the stored network policy on unsecured redirection to GERAN when entering a new PLMN which is not an equivalent PLMN of the registered PLMN.But this does not clarify how the UE should behave in the absence of a network policy stored at the UE. \u2013 It is proposed to clarify that for this case the UE should assume \"unsecured redirection to GERAN not allowed\".3) Furthermore, the criterion for deletion is debatable, because \"equivalent PLMNs\" can be used in different scenarios, e.g.i) an operator can be required by regulation to broadcast different PLMN IDs for different RATs (GERAN, UTRAN and E-UTRAN). To facilitate the mobility between the different RATs the operator can configure the different PLMNs as equivalent PLMNs.ii) 2 operators belonging to an international operator group can configure their PLMNS as equivalent PLMNs to facility mobility across borders.iii) 2 operators within the same country can configure their PLMNS as equivalent PLMNs in a certain area to facility national roaming.iv) At an airport, an operator can assign an equivalent PLMN list including \"preferred roaming partners\" so that when the subcriber arrives at the destination country upon switch on the UE registers to a PLMN included in that list.For case i) we agree that it is not necessary to reset the policy for the case the UE performed an inter-RAT change to GERAN/UTRAN which resulted in a PLMN change to the equivalent PLMN. But for cases ii) and iii), keeping the policy \"unsecured redirection to GERAN allowed\" when entering the equivalent PLMN, and especially for case iv), applying this policy after switch on can result in an unnecessary vulnerability.It is proposed that the UE shall set the network policy to \"Unsecured redirection to GERAN not allowed\" when any of the following events occurs:- the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;- the UE is switched on; or - the UICC containing the USIM is removed.\n\n>>> SUMMARY OF CHANGE\n1) Condition for setting the policy flag is corrected to: \"If due to operator policies unsecured redirection to a GERAN cell is not allowed \u2026\"2+3) The UE shall set the network policy to \"Unsecured redirection to GERAN not allowed\" when any of the following events occurs:- the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;- the UE is switched on; or - the UICC containing the USIM is removed.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf for cases ii) to iv) above the UE does not set the policy to \"unsecured redirection to GERAN not allowed\", the UE may unneccessarily remain vulnerable to the security attack."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * First Change * * * *\n6.1.4.1\tCoordination between 5GSM and ESM with N26 interface\nInterworking with EPS is supported for a PDU session, if the PDU session includes the mapped EPS bearer context(s) or has association(s) between QoS flow and mapped EPS bearer after inter-system change from S1 mode to N1 mode. The SMF shall not include any mapped EPS bearer contexts associated with a PDU session for LADN and with a PDU session which is a multi-homed IPv6 PDU session. See coding of the Mapped EPS bearer contexts IE in subclause\u00a09.11.4.8.\nUpon inter-system change from N1 mode to S1 mode, the UE shall create the default EPS bearer context and the dedicated EPS bearer context(s) based on the parameters of the mapped EPS bearer contexts or the associations between QoS flow and mapped EPS bearer in the PDU session, if available. The EPS bearer identity assigned for the QoS flow of the default QoS rule becomes the EPS bearer identity of the default bearer in the corresponding PDN connection. If there is no EPS bearer identity assigned to the QoS flow of the default QoS rule, the UE shall perform a local release of the PDU session. If there is no EPS bearer identity assigned to the QoS flow(s) which is not associated with the default QoS rule, the UE shall locally delete the QoS rules and the QoS flow description(s). The UE uses the parameters from each PDU session for which interworking with EPS is supported to create corresponding default EPS bearer context and optionally dedicated EPS bearer context(s) as follows:\na)\tthe PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows:\n1)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Unstructured\";\n2)\tthe PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";\n3)\tthe PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";\n4)\tthe PDN type shall be set to \"IPv4v6\" if the PDU session type is \"IPv4v6\";\n5)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Ethernet\", and the UE, the network or both of them do not support Ethernet PDN type in S1 mode; and\n6)\tthe PDN type shall be set to \"Ethernet\" if the PDU session type is \"Ethernet\" and the UE and the network support Ethernet PDN type in S1 mode;\nb)\tthe PDU address of the PDU session shall be mapped to the PDN address of the default EPS bearer context as follows:\n1)\tthe PDN address of the default EPS bearer context is set to the PDU address of the PDU session, if the PDU session type is \"IPv4\", \"IPv6\" or \"IPv4v6\"; and\n2)\tthe PDN address of the default EPS bearer context is set to zero, if the PDU session type is \"Ethernet\" or \"Unstructured\";\nc)\tthe DNN of the PDU session shall be mapped to the APN of the default EPS bearer context;\nd)\tthe APN-AMBR and extended APN-AMBR received in the parameters of the default EPS bearer context of the mapped EPS bearer contexts shall be mapped to the APN-AMBR and extended APN-AMBR of the default EPS bearer context;\ne)\tfor each PDU session in state PDU SESSION ACTIVE, PDU SESSION MODIFICATION PENDING or PDU SESSION INACTIVE PENDING the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT ACTIVE; and\nf)\tfor any other PDU session the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT INACTIVE.\nAdditionally, for each mapped EPS bearer context or the association between QoS flow and mapped EPS bearer in the PDU session:\na)\tthe EPS bearer identity shall be set to the EPS bearer identity received in the mapped EPS bearer context, or the EPS bearer identity associated with the QoS flow;\nb)\tthe EPS QoS parameters shall be set to the mapped EPS QoS parameters of the EPS bearer received in the mapped EPS bearer context, or the EPS QoS parameters associated with the QoS flow;\nc)\tthe extended EPS QoS parameters shall be set to the mapped extended EPS QoS parameters of the EPS bearer received in the mapped EPS bearer context, or the extended EPS QoS parameters associated with the QoS flow; and\nd)\tthe traffic flow template shall be set to the mapped traffic flow template of the EPS bearer received in the mapped EPS bearer context, or the stored traffic flow template associated with the QoS flow, if available.\nAfter inter-system change from N1 mode to S1 mode, the UE shall associate the PDU session identity, the S-NSSAI, and the session-AMBR with the default EPS bearer context, and for each EPS bearer context mapped from one or more QoS flows, associate the QoS rule(s) for the QoS flow(s) and the QoS flow description(s) for the QoS flow(s) with the EPS bearer context.\nAfter inter-system change from N1 mode to S1 mode, the UE and the SMF shall maintain the PDU session type of the PDU session until the PDN connection corresponding to the PDU session is released if the UE supports non-IP PDN type and the PDU session type is \"Ethernet\" or \"Unstructured\".\nAfter inter-system change from N1 mode to S1 mode, the UE and the SMF shall maintain the following 5GSM attributions and capabilities associated with the PDU session until the PDN connection corresponding to the PDU session is released:\n-\tthe always-on PDU session indication;\n-\tthe maximum number of supported packet filters;\n-\tthe support of reflective QoS;\n-\tthe maximum data rate per UE for user-plane integrity protection supported by the UE for uplink and the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink; and\n-\tthe support of multi-homed IPv6 PDU session.\nAfter inter-system change from N1 mode to S1 mode, the UE shall deem that the following features are supported by the network on the PDN connection corresponding to the PDU session:\n-\tPS data off; and \n-\tLocal address in TFT.\nIf there is a QoS flow used for IMS signalling, after inter-system change from N1 mode to S1 mode, the EPS bearer associated with the QoS flow for IMS signalling becomes the EPS bearer for IMS signalling.\nWhen the UE is provided with a new session-AMBR in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall discard the corresponding association(s) and associate the new value(s) with the EPS bearer context.\nThe network may provide the UE with one or more QoS rules by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message. The network may provide the UE with one or more QoS flow descriptions by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message.\nWhen the UE is provided with one or more QoS flow descriptions or the EPS bearer identity of an existing QoS flow description is modified in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall check whether the EPS bearer identity included in the QoS flow description corresponds to an active EPS bearer context of the PDN connection associated with the EPS bearer context being modified. If the EPS bearer identity included in the QoS flow description does not correspond to any active EPS bearer context of the PDN connection associated with the EPS bearer context being modified, the UE shall locally delete the QoS flow description and all the associated QoS rules, if any, and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nWhen the UE is provided with one or more QoS rules, or one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall process the QoS rules sequentially starting with the first QoS rule. The UE shall check the QoS rules and QoS flow descriptions for different types of errors as follows:\nNOTE\u00a01:\tIf an error is detected in a QoS rule or a QoS flow description which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, if any.\nNOTE\u00a02:\tIf the EPS bearer context modification procedure is rejected, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, if any.\n\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on the default QoS rule and the DQR bit is set to \"the QoS rule is not the default QoS rule\".\n2)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on a QoS rule which is not the default QoS rule and the DQR bit is set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule with different QoS rule identifier.\n4)\tWhen the rule operation is \"Delete existing QoS rule\" on the default QoS rule.\n5)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\", or \"Modify existing QoS rule without modifying packet filters\" and two or more QoS rules associated with this PDU session would have identical precedence values.\n6)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the packet filter list in the resultant QoS rule is empty.\n7)\tWhen the rule operation is \"Create new QoS rule\" and there is already an existing QoS rule with the same QoS rule identifier.\n8)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\", or \"Modify existing QoS rule without modifying packet filters\" and there is no existing QoS rule with the same QoS rule identifier.\n9)\tWhen the rule operation is \"Delete existing QoS rule\" and there is no existing QoS rule with the same QoS rule identifier.\n10)\tWhen the flow description operation is \"Create new QoS flow description\" and there is already an existing QoS flow description with the same QoS flow identifier.\n11)\tWhen the flow description operation is \"Modify existing QoS flow description\" and there is no existing QoS flow description with the same QoS flow identifier.\n12)\tWhen the flow description operation is \"Delete existing QoS flow description\" and there is no existing QoS flow description with the same QoS flow identifier.\n13)\t\tWhen the UE determines that:\ni)\tthe default EPS bearer context or a dedicated EPS bearer context is associated with one or more QoS flows and the default EPS bearer context is not associated with the default QoS rule.\nii)\ta dedicated EPS bearer context is associated with the default QoS rule.\n\tIn case 4, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 5, if the old QoS rule (i.e. the QoS rule that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received) is not the default QoS rule, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old QoS rule which has identical precedence value. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 6, if the QoS rule is not the default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 7, if the existing QoS rule is not the default QoS rule and the DQR bit of the new QoS rule is set to \"the QoS rule is not the default QoS rule\", the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS rule (i.e. the QoS rule that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received). If the existing QoS rule is the default QoS rule or the DQR bit of the new QoS rule is set to \"the QoS rule is the default QoS rule\", the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 9, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS rule as successfully deleted.\n\tIn case 10, the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS flow description (i.e. the QoS flow description that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received).\n\tIn case 12, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS flow description as successfully deleted.\n\tOtherwise, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\" or \"Modify existing QoS rule and delete packet filters\" and the packet filter list in the QoS rule is empty.\n2)\tWhen the rule operation is \"Delete existing QoS rule\" or \"Modify existing QoS rule without modifying packet filters\" with a non-empty packet filter list in the QoS rule.\n3)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\" and the packet filter to be deleted does not exist in the original QoS rule.\n4)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\" with a packet filter list also including packet filters in addition to the packet filter identifiers.\n5)\tWhen there are other types of syntactical errors in the coding of the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter or the QoS flow descriptions with the length of two octets parameter, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\n\tIn case 3 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.\n\tOtherwise the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tThe UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 \"semantic errors in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\" or \"Modify existing QoS rule and replace all packet filters\", and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIn case 1, if two or more packet filters with identical packet filter identifiers are contained in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall not diagnose an error, further process the MODIFY EPS BEARER CONTEXT REQUEST message and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.\n\tOtherwise the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nUpon successful completion of an EPS attach procedure or tracking area updating procedure after inter-system change from N1 mode to S1 mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE shall delete any UE derived QoS rules. The UE and the SMF shall perform a local release of the PDU session(s) and QoS flow(s) which have not been transferred to EPS.\nFor PDU session(s) associated with non-3GPP access in 5GS, if present, the UE may:\na)\tkeep some or all of these PDU sessions still associated with non-3GPP access in 5GS, if supported;\nb)\trelease some or all of these PDU sessions explicitly by initiating the UE requested PDU session release procedure(s); or\nc)\tattempt to transfer some or all of these PDU sessions from N1 mode to S1 mode by initiating the UE requested PDN connectivity procedure(s) with the PDN CONNECTIVITY REQUEST message created as specified in subclause\u00a06.1.4.2.\nInterworking to 5GS is supported for a PDN connection, if the corresponding default EPS bearer context includes a PDU session identity, session AMBR and one or more QoS flow descriptions received in the Protocol configuration options IE or Extended protocol configuration options IE (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the default EPS bearer context has association with the PDU session identity, the S-NSSAI, the session-AMBR and one or more QoS flow descriptions after inter-system change from N1 mode to S1 mode.\nFor a PDN connection established in S1 mode, the SMF assigning the QoS rules shall consider that the UE supports 16 packet filters for the corresponding PDU session until the UE indicates a higher number (as specified in subclause\u00a06.4.2.2).\nThe network may provide the UE with one or more QoS rules by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The network may provide the UE with one or more QoS flow descriptions by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message.\nWhen the UE is provided with one or more QoS flow descriptions or the EPS bearer identity of an existing QoS flow description is modified in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall check whether the EPS bearer identity included in the QoS flow description corresponds to an active EPS bearer context of the PDN connection associated with the EPS bearer context being activated. If the EPS bearer identity included in the QoS flow description does not correspond to any active EPS bearer context of the PDN connection associated with the EPS bearer context being activated, the UE shall locally delete the QoS flow description and all the associated QoS rules, if any, and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nWhen the UE is provided with one or more QoS rules, or one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall process the QoS rules sequentially starting with the first QoS rule. The UE shall check QoS rules and QoS flow descriptions for different types of errors as follows:\nNOTE\u00a03: \tIf an error is detected in a QoS rule or a QoS flow description which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, if any.\nNOTE\u00a04: \tIf the default EPS bearer context activation procedure or the dedicated EPS bearer context activation procedure is rejected, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, if any.\n\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule.\n2)\tWhen the rule operation is \"Create new QoS rule\", and there is no rule with the DQR bit set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and two or more QoS rules associated with this PDU session would have identical precedence values.\n4)\tWhen the rule operation is an operation other than \"Create a new QoS rule\".\n5)\tWhen the flow description operation is an operation other than \"Create new QoS flow description\".\n6)\t\tWhen the UE determines that:\ni)\tthe default EPS bearer context or a dedicated EPS bearer context is associated with one or more QoS flows and the default EPS bearer context is not associated with the default QoS rules.\nii)\ta dedicated EPS bearer context is associated with the default QoS rule.\n\tIn case 4, if the rule operation is for a non-default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\n\tOtherwise for all the cases above, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\" and the packet filter list in the QoS rule is empty.\n2)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters \", and the packet filter list in the resultant QoS rule is empty.\n3)\tWhen there are other types of syntactical errors in the coding of the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter or the QoS flow descriptions with the length of two octets parameter, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\n\tIn case 1, case 2 or case 3, if the QoS rule is not the default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tThe UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 \"semantic errors in packet filter(s)\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Create new QoS rule\" and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIf the QoS rule is not the default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nUpon inter-system change from S1 mode to N1 mode, the UE uses the parameters from the default EPS bearer context of each PDN connection for which interworking to 5GS is supported to create a corresponding PDU session as follows:\na)\tthe PDN type of the default EPS bearer context shall be mapped to the PDU session type of the PDU session as follows:\n1)\tif the PDN type is \"non-IP\":\n-\tthe PDU session type is set to the locally available information associated with the PDN connection (either \"Ethernet\" or \"Unstructured\"), if available; or\n-\totherwise, the PDU session type is set to \"Unstructured\";\n2)\tif the PDN type is \"IPv4\" the PDU session type is set to \"IPv4\";\n3)\tif the PDN type is \"IPv6\", the PDU session type is set to \"IPv6\";\n4)\tthe PDN type shall be set to \"IPv4v6\" if the PDU session type is \"IPv4v6\"; and\n5)\tif the PDN type is \"Ethernet\", the PDU session type is \"Ethernet\";\nb)\tthe PDN address of the default EPS bearer context shall be mapped to PDU address of the PDU session, if the PDN type is \"IPv4\", \"IPv6\" or \"IPv4v6\";\nc)\tthe APN of the default EPS bearer context shall be mapped to the DNN of the PDU session;\nd)\tfor each default EPS bearer context in state BEARER CONTEXT ACTIVE the UE shall set the state of the mapped PDU session to PDU SESSION ACTIVE; and\ne)\tfor any other default EPS bearer context the UE shall set the state of the mapped PDU session to PDU SESSION INACTIVE.\nAdditionally, the UE shall set:\na)\tthe PDU session identity of the PDU session to the PDU session identity included by the UE in the Protocol configuration options IE or Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or the PDU session identity associated with the default EPS bearer context;\nb)\tthe S-NSSAI of the PDU session to the S-NSSAI included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, the S-NSSAI included by the network in the N1_MODE_INFORMATION Notify payload of the IKE_AUTH response message, or the S-NSSAI associated with the default EPS bearer context;\nc)\tthe session-AMBR of the PDU session to the session-AMBR included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or the MODIFY EPS BEARER CONTEXT REQUEST message, or the session-AMBR associated with the default EPS bearer context;\nd)\tthe SSC mode of the PDU session to \"SSC mode 1\"; and\ne)\tthe always-on PDU session indication to the always-on PDU session indication maintained in the UE, if any.\nAdditionally, for each EPS bearer context of the PDN connection, the UE shall create QoS flow(s) each of which is associated with the QoS flow description received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, and/or MODIFY EPS BEARER REQUEST message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the QoS flow description associated with EPS bearer context.\nAdditionally, for each EPS bearer context of the PDN connection, the UE shall create QoS rules(s), if any, each of which is associated with the QoS rule received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, or MODIFY EPS BEARER CONTEXT REQUEST message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the QoS rules associated with EPS bearer context.\nAdditionally, for each PDU session which was created at inter-system change from S1 mode to N1 mode from a corresponding PDN connection of the \"Ethernet\" PDN type, the UE shall consider that Ethernet PDN type in S1 mode is supported by the network and the SMF shall consider that Ethernet PDN type in S1 mode is supported by the UE.\nThe UE and the network shall locally release the PDN connection(s) and EPS bearer(s) associated with the 3GPP access which have not been transferred to 5GS.\nAfter inter-system change from S1 mode to N1 mode, for each QoS flow mapped from a EPS bearer context the UE shall associate the EPS bearer identity, the EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow template, if available, of the EPS bearer context with the QoS flow.\nIf there is an EPS bearer used for IMS signalling, after inter-system change from S1 mode to N1 mode, the QoS flow of the default QoS rule in the corresponding PDU session is used for IMS signalling.\nFor a PDN connection established when in S1 mode, upon the first inter-system change from S1 mode to N1 mode, the SMF shall determine the PDU session indication as specified in subclause\u00a06.3.2.2.\nWhen the UE is provided with a new EPS bearer identity, a new EPS QoS parameters, or a new extended EPS QoS parameters in the Mapped EPS bearer context IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, the UE shall discard the corresponding association(s) and associate the new value(s) with the QoS flow.\nWhen the UE is provided with a new traffic flow template in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, the UE shall check the traffic flow template for different types of TFT IE errors as specified in subclause\u00a06.3.2.3.\nWhen a QoS flow is deleted, the associated EPS bearer context information that are mapped from the deleted QoS flow shall be deleted from the UE and the network if there is no other existing QoS flow associated with this EPS bearer context. When the EPS bearer identity of a QoS flow is deleted, the associated EPS bearer context information that are mapped from the deleted EPS bearer identity shall be deleted from the UE and the network if there is no other existing QoS flow associated with this EPS bearer context. When an EPS bearer is released, all the associated QoS flow descriptions and QoS rules that are mapped from the released EPS bearer shall be deleted from the UE and the network.\nNOTE\u00a05:\tIf T3584 is running or deactivated for the S-NSSAI and optionally the DNN combination, the UE is allowed to initate ESM procedures in EPS with or without APN corresponding to that DNN, and if the APN is congested in EPS, the MME can send a back-off timer for the APN to the UE as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nFor PDN connection(s) associated with non-3GPP access in EPS, if present, the UE may:\na)\tkeep some or all of these PDN connections still associated with non-3GPP access in EPS, if supported;\nb)\trelease some or all of these PDN connections explicitly by initiating the UE requested PDN disconnect procedure(s) as specified in 3GPP\u00a0TS\u00a024.301; or\nc)\tattempt to transfer some or all of these PDN connections from S1 mode to N1 mode by initiating the PDU session establishment procedure(s) with the PDU SESSION ESTABLISHMENT REQUEST message created as specified in subclause\u00a06.1.4.2.\nAfter handover of an existing PDU session from 3GPP access to non-3GPP access, the network and the UE shall locally delete EPS bearer identities for the PDU session, if any.\n* * * End of Change * * * *\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn TS 24.501 subclause 6.1.4.1, the current UE handling on checking on EPS bearer ID (EBI) for the received 5G QoS parameters in (e)PCO was specified. This handling actually was based on a wrong assumption. As per current principle of ESM procedures in EPS and current stage 2 and stage 3 specifications, only the 5G QoS parameters related to the current EPS bearer been activated/modified are allocated and sent to the UE via (e)PCO. The current specified UE handling in TS 24.501 subclause 6.1.4.1 actually has broken the current principle of ESM procedures in EPS and mis-aligned with current stage 2 and stage 3 specifications. This indeed opens the \"Pandora Box\" and added the ESM protocol complexity for implementation, typically includes:Problem 1: The network can provide whatever 5G QoS parameters for whatever EBIs to the UE, including some EBIs which are inactive at the UE side. Considering 5G QoS parameters take long octets (both are type 6 IEs) and hence this indeed waste the network signalling resources.Problem 2: The UE has always firstly to check the validity of whatever received 5G QoS parameters per EBI upon receipt of each EPS bearer context activation/modification request message before further handling, including for EBIs which are inactive or invalid at the UE. This indeed created unnecessary UE complexity for related ESM procedures for which the UE never needs to do before.Problem 3: During an ESM procedure for EBI#1, the UE needs also to update the EPS bearer contexts for EBI#2 and to perform error check as per current handling. Once a semantic/syntactical error happens related to EBI#2, the UE has to handle the errors and report the errors to the network. If all handling related to EBI#1 is successful but errors happens for EBI#2, then what the UE should do for report the error to the network? To send an ESM complete message or ESM reject message? All these are very strange and not specified in the current protocol.Problem 4: It could happen that in a network initiated EPS bearer context modification procedure for EBI#1, the UE has nothing to modify with EBI#1 but to modify other EBIs than current EBI#1, which looks very strange in protocol. More other problems may happen and hence we would propose:Proposal 1: To remove Case#2 and Case#3 in section 2.1 that the UE needs not to check active EBI for which the provided 5G QoS parameters associated and simply stores the received 5G QoS parameters for the current EBI.Proposal 2: To align with TS 24.301, to clearly specify in TS 24.501 that the network only provides the 5G QoS parameters related to the current EPS bearer been activated/modified to the UE via (e)PCO.Proposal 3: To add a NOTE that the UE just simply discard any received 5G QoS parameters for the EBIs other than the current EPS bearer been activated/modified.Detail discussion see disc paper C1-196043.\n\n>>> SUMMARY OF CHANGE\nIt proposes to catupre the propopals in above reaons for change\n\n>>> CONSEQUENCES IF NOT REVISED\nThe current specified UE handling in TS 24.501 subclause 6.1.4.1 on checking on EPS bearer ID (EBI) for the received 5G QoS parameters in (e)PCO, actually has broken the current principle of ESM procedures in EPS and mis-aligned with current stage 2 and stage 3 specifications. This indeed opens the \"Pandora Box\" and added the ESM protocol complexity for implementation."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st change\n7.4.6.2.3\tInterworking ISUP to SIP\nFor the interworking of 180 (Ringing) response and 200 (OK) response (to the INVITE request) to the regarding ISUP messages and parameters no additional procedures beyond the basic call procedures are needed.\nTo interwork the redirecting number at the O-MGCF it can be needed to create placeholder History-Info hi-entries. Such a History-Info hi-entry has to provide a hi-targeted-to-uri with a placeholder value \"unknown@unknown.invalid\", a Reason \"headers\" component with a cause parameter and a hi-index as described within table 7.4.6.2.3.1.\nTable 7.4.6.2.3.1: Mapping of IAM to SIP INVITE request\nISUP Parameter or IE \tDerived value of parameter field\tSIP component\t\tValue\nIAM\t\tINVITE request\nRedirecting number\t\tHistory-Info header field\nNature of address indicator:\t\"national (significant) number\"\t\thi-targeted-to-uri \n\t\"international number\"\t\tMap complete Redirecting number Address Signals to E.164 number in URI.\nAddress Signals\tIf NOA is \"national (significant) number\" then the format of the Address Signals is:\tNDC + SN\tIf NOA is \"international number\"\tthen the format of the Address Signals is:\tCC + NDC + SN \thi-targeted-to-uri \tAddr-spec\t\"+\" CC NDC SN mapped to userinfo portion of SIP URI.\t(NOTE\u00a05)\tAdd \"user=phone\".\nRedirecting number\tAPRI\tPrivacy \"headers\" component of the penultimate hi-targeted-to-uri entry in the History-Info header\tPriv-value\n\t\"presentation restricted\"\t\t\"history\"\n\t\"presentation allowed\"\t\tPrivacy header field absent or \"none\" (NOTE 3)\nRedirection Information\tRedirecting indicator\tPrivacy \"header s\" component of the penultimate hi-targeted-to-uri entry in the History-Info header\tPriv-value\n\tCall diverted\t\t\"none\" (NOTE 4)\n\tCall diverted, all redirection information presentation restricted\t\t\"history\"\nRedirection Information\tRedirection counter\t1\thi-index\tNumber of diversions are shown to the number of levels in hi-index.\tIndex for Original called number = 1\tIndex for Called party number = 1.1\n\t2\t\tIndex for Original called number = 1\tIndex for Redirecting number = 1.1\tIndex for Called party number = 1.1.1\n\tN\t\tIndex for Original called number = 1\tPlaceholder History-Info hi-entry with Index = 1.1\t\u2026\tFill up\t\u2026\tIndex for Redirecting number = 1[(N-1)*\".1\"]\tIndex for Called party number = 1 N* \".1\" (e.g. N=3  1.1.1.1)\nRedirection Information\tRedirecting Reason and\tOriginal Redirection Reason\t(NOTE 1)\thi-targeted-to-uri; Reason \"headers\" component as defined in IETF\u00a0RFC\u00a04244 [91] with cause parameter.\tFor a placeholder History-Info hi-entry the value \"404\" shall be taken (NOTE 2).\tCause parameter for redirecting reason will be put in the entry of redirecting number, and cause parameter for original redirection reason will be put in the entry of original called number. \tCause parameter value\n\tunknown/not available \t\t404\n\tunconditional\t\t302\n\tUser Busy \t\t486\n\tNo reply\t\t408\n\tDeflection during alerting\t\t302\n\tDeflection immediate response \t\t302\n\tMobile subscriber not reachable\t\t503\nCalled Party Number\tSee Redirecting number \tNature of address indicator and Address signal\tHistory-Info header field see hi-targeted-to-uri\tURI of the last hi-targeted-to-uri entry of History-Info header field\t(NOTE\u00a06)\nOriginal Called number\tSee Redirecting number \tNature of address indicator and Address signal\tHistory-Info header field see hi-targeted-to-uri \nOriginal called number\tAPRI\tPrivacy \"header s\"component  of the first hi-targeted-to-uri entry of History-Info header \tPriv-value\n\t\"presentation restricted\"\t\t\"history\" \n\t\"presentation allowed\"\t\t\"none\"\nNOTE 1:\tOriginal Redirection Reason contains only the \"unknown/not available \" parameter\tNOTE 2:\tFor all History-Info hi-entries except the last one a cause parameter in Reason \"headers\" component as defined in IETF\u00a0RFC\u00a04244 [91] has to be included.\tNOTE 3:\tIf the Redirecting indicator has the value \"Call diverted, all redirection information presentation restricted\", the privacy value \"history\" shall be set.\tNOTE 4:\tIf the redirecting number APRI has the value \"presentation restricted\", the privacy value \"history\" shall be set. \tNOTE\u00a05:\tUsed URI scheme shall be SIP URI. The Reason \"headers\" component with a cause parameter cannot be added if hi-targeted-to-uri is a tel URI.\tNOTE\u00a06:\tThe used URI scheme can be tel or SIP since the last hi-targeted-to-uri entry of the History-Info header field does not contain the Reason \"headers\" component with a cause parameter.\n\nnext change\n7.5.4.2.2\tCall forwarding within the ISUP Network appeared\nThe following scenario shows if a Call Forwarding appears in the ISUP/PSTN and the diverted-to number is within the SIP network. Table 7.5.4.2.2.1 should be seen as an example.\nFor the mapping of 180 (Ringing) response and 200 (OK) response to the regarding ISUP messages and parameters no additional procedures beyond the basic call procedures are needed.\nTo interwork the redirecting number at the O-MGCF it can be needed to create placeholder History entries. Such a History entry has to provide a hi-targeted-to-uri with a placeholder value , a \"cause\" URI parameter and a hi-index as described within table 7.5.4.2.2.1.\nTable 7.5.4.2.2.1: Mapping of IAM to SIP INVITE request\nISUP Parameter or IE \tDerived value of parameter field\tSIP component\t\tValue\nIAM\t\tINVITE request\nRedirecting number\t\tHistory-Info header field\nNature of address indicator:\t\"national (significant) number\"\t\thi-targeted-to-uri \tAdd CC (of the country where the MGCF is located) to Redirecting number Address Signals to construct E.164 number in URI.\n\t\"international number\"\t\tMap complete Redirecting number Address Signals to E.164 number in URI.\nAddress Signals\tIf NOA is \"national (significant) number\" then the format of the Address Signals is:\tNDC + SN\tIf NOA is \"international number\"\tthen the format of the Address Signals is:\tCC + NDC + SN \thi-targeted-to-uri \tAddr-spec\t\"+\" CC NDC SN mapped to userinfo portion of SIP URI. (NOTE\u00a05)\tAdd \"user=phone\".\nRedirecting number\tAPRI\tPrivacy header field that\tcorresponds to the penultimate hi-targeted-to-uri entry in the History-Info header\tPriv-value\n\t\"presentation restricted\"\t\t\"history\"\n\t\"presentation allowed\"\t\tPrivacy header field absent or \"none\" (NOTE 3)\nRedirection Information\tRedirecting indicator\tPrivacy header field that\tcorresponds to the penultimate hi-targeted-to-uri entry in the History-Info header\tPriv-value\n\tCall diverted\t\t\"none\" (NOTE 4)\n\tCall diverted, all redirection info presentation restricted\t\t\"history\"\nRedirection Information\tRedirection counter\t1\thi-index\tNumber of diversions are shown due to the number of hi-index Entries\tIndex for original called number = 1\tAddress Signals (CdPN)\tNumber = 1.1\n\t2\t\tIndex for original called number = 1\tIndex for Redirecting number\twith Index = 1.1\tAddress Signals (CdPN)\tNumber = 1.1.1\n\tN\t\tIndex for original called number = 1\tPlaceholder History entry with Index = 1.1\t\u2026\tFill up\t\u2026\tIndex for Redirecting Number\twith = 1.[(N-1)*\".1\"]\tIndex for Address Signals (CdPN)\t= 1.N* \".1\" (e.g. N=3  1.1.1.1)\nRedirection Information\tRedirecting Reason and\tOriginal Redirection Reason\t(NOTE 1)\thi-targeted-to-uri; \"cause\" URI parameter, as defined in IETF RFC 4458 [113].\tThe Redirecting Reason shall be mapped to the last hi-targeted-to-uri.\tIf the redirection counter is 2 or higher, the Original Redirection Reason shall be mapped to the second hi-targeted-to-uri.\tIf the redirection counter is 3 or higher, for each hi-targeted-to-uri following a placeholder History entry the value \"404\" shall be taken (NOTE 2)\tcause value\n\tunknown \t\t404\n\tunconditional\t\t302 \n\tUser Busy \t\t486\n\tNo reply\t\t408\n\tDeflection during alerting\t\t487\n\tDeflection immediate response \t\t480\n\tMobile subscriber not reachable\t\t503\nCalled Party Number\tSee Redirecting number\tHistory-Info header field see hi-targeted-to-uri\tURI of the last hi-targeted-to-uri entry of History-Info header field\nOriginal called number\tSee Redirecting number\tHistory-Info header field see hi-targeted-to-uri \tURI of first hi-targeted-to-uri entry of History-Info header field (NOTE\u00a06)\nOriginal called number\tAPRI\tPrivacy header field of the first hi-targeted-to-uri entry of History-Info header \tPriv-value\n\t\"presentation restricted\"\t\t\"history\" \n\t\"presentation allowed\"\t\t\"none\"\nNOTE 1:\tOriginal Redirection Reason contains only the \"unknown\" parameter.\tNOTE 2:\tFor all History entries except the first one a \"cause\" URI parameter as defined in IETF RFC 4458 [113] has to be included.\tNOTE 3:\tIf the Redirecting Indicator has the value \"Call diverted, all redirection info presentation restricted\", the privacy value \"history\" shall be set.\tNOTE 4:\tIf the Redirecting Number APRI has the value \"presentation restricted\", the privacy value \"history\" shall be set.\tNOTE\u00a05:\tUsed URI scheme shall be SIP URI. The \"cause\" URI parameter cannot be added if hi-targeted-to-uri is a tel URI.\tNOTE\u00a06:\tThe used URI scheme can be tel URI or SIP URI since the first hi-targeted-to-uri entry of the History-Info header field does not contain the \"cause\" URI parameter.\n\nend of changes\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to ITU-T Q.763, chapter 4, table 32 (IAM), the \u201cOriginal Called Number\u201d (OCdNo) is an optional parameter in an ISUP IAM. That is, it can be present in an IAM, but doesn\u2019t have to. This applies even if Call Forwarding is signalled in such an IAM (e.g. if a Call Forwarding had occured in a private network in a DSS1 PBx). Further, no validation check is done in ISUP whether or not a OCdNO is present, and no mandatory functionality is based theron. For the forwarded call leg, the sole relevant parameter is the Redirecting Number, which is used as both the billing and routing origin for this call leg.However, this was not taken into account when the SIP-ISUP interworking was standardised. Thus, implementations are in the market which \u2013 because of the missing OCdNo parameter \u2013 do not set up a call forward information towards SIP for call forwarding scenarios (missing History-Info header field).Subsequently, this leads to severe accounting problems for forwarded calls (e.g. for intercarrier billing if the call forwarding party uses the feature Carrier Selection). Further, routing problems and service failures will happen, as, because the last forwarding party will not be recognised, the information of the actual A-party (CgPNo, P-Asserted-Identity header field) will be checked.\n\n>>> SUMMARY OF CHANGE\nWhen either the Original Called Number or the Redirecting Number are missing, a placeholder value unknown@unknown.invalid is set up in the respective History-Info header field.\n\n>>> CONSEQUENCES IF NOT REVISED\nEven when a Call Diversion had occured in a Circuit Switched network with no Original Called Number parameter being present, the History-Info header field may not be set up correctly or even not be present at all in a SIP INVITE message. Because of this, (intercarrier) Billing and Lawful Intercept problems may happen as the wrong customer will be identified, and the use of this supplementary service may not be visible any more."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***First Change***\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.203: \"Policy and Charging Control Architecture\"\n[3]\t3GPP TS 29.212: \"Policy and charging control over Gx reference point\" \n[4]\t3GPP TS 29.213: \"Policy and charging control signalling flows and Quality of Service (QoS) parameter mapping\"\n[5]\t3GPP TS 29.214: \"Policy and charging control over Rx reference point\"\n[6]\t\tIETF RFC 3588: \"Diameter Base Protocol\".\n[7]\t3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol; Protocol details\"\n[8]\tIETF RFC 4960: \"Stream Control Transmission Protocol\".\n[9]\t3GPP TS23.003:\t\"Numbering, addressing and identification\".\n[10]\t3GPP TS 23.261: \"IP flow mobility and seamless Wireless Local Area Network (WLAN) offload; Stage 2\".\n[11]\t3GPP\u00a0TS\u00a023.335: \"User Data Convergence (UDC); Technical realization and information flows; Stage 2\".\n[12]\t3GPP\u00a0TS\u00a029.335: \"User Data Convergence (UDC); User Data Repository Access Protocol over the Ud interface; Stage 3\".\n[13]\t3GPP\u00a0TS\u00a023.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".\n[14]\tBroadband Forum WT-203: \"Interworking between Next Generation Fixed and 3GPP Wireless Access\" (work in progress).\n[15]\tBroadband Forum WT-134: \"Policy Control Framework \" (work in progress).\n[16]\tBroadband Forum WT-146: \"Subscriber Sessions\" (work in progress)\n[17]\tDSL Forum TR-059: \"DSL Evolution \u2013 Architecture. Requirements for the Support of QoS-Enabled IP Services\", September 2003\n[18]\t3GPP\u00a0TS\u00a023.402: \"Architecture Enhancements for non-3GPP accesses\".\n\n\n\n***Second Change***\nA.5.1.2.1\tS9a* Session Establishment\nFor NSWO scenario, when the BPCF receives the trigger that a UE is accessing over Fixed Broadband access network and policy interworking with PCRF is supported, the BPCF shall send a CCR command with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\", the CCR command shall include the type of IP-CAN within the IP-CAN-Type AVP.\nThe BPCF shall include the local UE IP address within UE-Local-IP-Address AVP, the NSWO-APN within Called-Station-Id AVP and the IMSI within the Subscription-Id AVP. \nFor the roaming case, the V-PCRF shall initiate the S9 Session Establishment procedure according to clause A.6.1.2. \nThe PCRF shall check if the policy control is performed for NSWO traffic for that UE based on operator policies (e.g. network where the UE is offloading). The PCRF shall provide the result in a CCA command within Result-Code AVP. If policy control is not performed, then the PCRF shall indicate DIAMETER_AUTHORIZATION_REJECTED in the CCA command.\n\n\n***Third Change***\nA.6.1.2\tNSWO Traffic\nWhen the V-PCRF receives an S9a* Session Establishment from the BPCF, then the V-PCRF determines if an S9 session is already present for that subscriber. If the S9 session is not already established, the V-PCRF initiates an S9 Session Establishment Procedure; otherwise, the V-PCRF initiates an S9 Subsession Establishment Procedure.\nThe V-PCRF shall send a CCR command following current S9 procedures including the information received over S9a*.\nThe V-PCRF shall link the S9a* session with the corresponding S9 session.\nThe H-PCRF shall acknowledge the request using a CCA command.\n\n\n\n***Fouth Change***\nA.8.4\tS9a* re-used AVPs\nA.8.4.1\tGeneral\nTable A.8.4.1.1 lists the Diameter AVPs re-used by the S9a* Diameter Application from other reference points (e.g. Gx, Gxx, S9 reference points) and other existing Diameter Applications, reference to their respective specifications, short description of their usage within the S9a reference point, the applicability of the AVPs to a specific access, and which supported features the AVP is applicable to. When reused from S9 reference point, the specific clause in the present specification is referred. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table A.8.4.1.1, but they are re-used for the S9a reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings. Where RADIUS VSAs are re-used, unless otherwise stated, they shall be translated to Diameter AVPs as described in IETF RFC 4005 [12] with the exception that the \u2018M\u2019 flag shall be set and the \u2018P\u2019 flag may be set.\nTable A.8.4.1.1: S9a* re-used Diameter AVPs\nAttribute Name\tReference\tDescription\tAcc. type\tApplicability\tNote 1 \nCalled-Station-Id\tIETF RFC 4005 [12]\tIt is set to a fixed value and indicates that the S9a* session is related to NSWO traffic (i.e. conveys the NSWO-APN). It is a fixed value set by the operator. The naming convention is left to operator\u2019s implementation decision.\t\tNon-3GPP-EPS\t\tPC\nCC-Request-Number\tIETF RFC 4006 [9]\tThe number of the request for mapping requests and answers\tNon-3GPP-EPS\t\tPC\nCC-Request-Type\tIETF RFC 4006 [9]\tThe type of the request (initial, update, termination)\tNon-3GPP-EPS\t\tPC\nIP-CAN-Type\t3GPP TS 29.212 [3]\tIndicates the type of Connectivity Access Network that the user is connected to. It is set to Non-3GPP-EPS.\tNon-3GPP-EPS\t\tPC\nQoS-Information\t3GPP TS 29.212 [3]\tDefines the QoS information that can be accepted by the BPCF.\tNon-3GPP-EPS\tPC\nCharging-Rule-Install\t3GPP TS 29.212 [3]\tIt is used to activate, install or modify PCC rules at Fixed Broadband access network. Only Charging-Rule-Definition, Charging-Rule-Name, Charging-Rule-Base-Name are applicable.\t\tNon-3GPP-EPS\t\tPC\nCharging-Rule-Remove\t3GPP TS 29.212 [3]\tIt is used to deactivate or remove PCC rules in the BPCF.\tNon-3GPP-EPS\t\tPC\nCharging-Rule-Report\t3GPP TS 29.212 [3]\tIt is used to report the status of the PCC Rules.\tNon-3GPP-EPS\t\tPC\nNon-3GPP-EPS\t\tPC\nSession-Release-Cause\t3GPP TS 29.212 [3]\tIndicate the reason of termination initiated by the PCRF. \tNon-3GPP-EPS\t\tPC\nSubscription-Id\tIETF RFC 4006 [9]\tThe identification of the subscription (i.e. IMSI)\tNon-3GPP-EPS\t\tPC\nSupported-Features\t3GPP TS 29.229 [7]\tIf present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange\tNon-3GPP-EPS\t\tPC\nUE-Local-IP-Address\t3GPP TS 29.212[3]\tContains the UE local IP address\tNon-3GPP-EPS\tPC\nNOTE 1:\tAVPs marked with \u201cPC\u201d are applicable to policy control.\n\n\n***Fifth Change***\nA.8.6.2\tCC-Request (CCR) Command\nThe CCR command, indicated by the Command-Code field set to 272 and the 'R' bit set in the Command Flags field, is sent by the BPCF to the PCRF in order to initiate an S9a* session establishment and to request PCC rules. The CCR command is also sent by the BPCF to the PCRF in order to indicate PCC rule related events.\nMessage Format:\n<CC-Request> ::= < Diameter Header: 272, REQ, PXY >\n\t\t\t\t < Session-Id >\n\t\t\t\t { Auth-Application-Id }\n\t\t\t\t { Origin-Host }\n\t\t\t\t { Origin-Realm }\n\t\t\t\t { Destination-Realm }\n\t\t\t\t { CC-Request-Type }\n\t\t\t\t { CC-Request-Number }\n\t\t\t\t [ Destination-Host ]\n\t\t\t\t [ Origin-State-Id ]\n\t\t\t\t [ Subscription-Id ]\n\t\t\t\t [ Called-Station-Id ]\n\t\t\t\t*[ Supported-Features ]\n\t\t\t\t*[ Charging-Rule-Report ]\n\t\t\t\t [ IP-CAN-Type ]\n\t\t\t\t [ RAT-Type ]\n\t\t\t\t [ UE-Local-IP-Address ]\n\t\t\t\t [ UE-Local-IPv6-Prefix ]\n\t\t\t\t [ QoS-Information ]\n\t\t\t\t [ Termination-Cause ]\n\t\t\t\t*[ Proxy-Info ]\n\t\t\t\t*[ Route-Record ]\n\t\t\t\t*[ AVP ]\n\n\n***End of Changes***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the NSWO scenario the RAT-Type AVP with the value \"BBF-WLAN\" mixes two different pieces of information, radio access technology information and transport access information, whereas the AVP has only been used so far to report radio access technology information and to indicate the nature of Location Information. Introducing an additional semantic to the RAT-Type AVP is confusing, creates impacts in multiple nodes and may also require operators to update their user's subscriptions in the HSS (e.g. to provision the new RAT-Type value as an allowed/disallowed RAT-Type value). This would also spread in the code a lot of \"If RAT-Type= WLAN or RAT-Type=BBF-WLAN or RAT-Type= xxxx-WLAN\" conditions. It is also backward incompatible with legacy 3GPP AAA Server that use the RAT-Type during their authorization process: cf TS 29.273 clause 5.1.2.1.2: Check RAT-Type AVP. If the access type indicates any value not described in 3GPP TS 29.212 [23] orthe received RAT-Type is listed in the user's disallowed RAT-Types, this shall be treated as error and the Result-Code DIAMETER_UNABLE_TO_COMPLY shall be returned.Per above requirements a legacy 3GPP AAA Server does not grant authorization for an unsupported RAT-Type.Therefore the RAT-Type AVP with the value BBF-WLAN is replaced by a new Transport-Access-Type AVP, which is introduced as a S9a* re-used AVP.\n\n>>> SUMMARY OF CHANGE\n1/ Adding a reference to 3GPP TS 29.2732/ Replacement of the RAT-Type AVP by the Transport-Access-Type AVP in the NSWO scenario (S9a*).3/ Hint that the V-PCRF identifies the the transport access technology by the Transport-Access-Type AVP.\n\n>>> CONSEQUENCES IF NOT REVISED\nWhatever the discussion resolves onto whether there is one parameter that mixes radio access technology and transport access information (WLAN, BBF-WLAN) or one parameter that indicates the transport access type clearly (BBF), one parameter, which mixes different kind of information, wouldrequire to spread the new value on many interfaces and nodes (GTP, PMIP, Gx, Gxx\u2026) to ensure a consistent setting of the parameter on all EPC interfacesspread the configuration of the mapping from IP @ to BBF transport type onto other entities than the PCRF (e.g. ePDG)creates backward compatibility problems with entities not supporting the new RAT-Type valuepotentially requires operators to update their users' subscriptions to configure the new RAT value in the list of allowed/disallowed RAT types"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*** 1st Change ***\n16.4.7.1\tPresence of the 3GPP Vendor-Specific attribute in RADIUS messages.\nTable 7: List of the 3GPP Vendor-Specific sub-attributes\nSub-attr #\tSub-attribute Name\tDescription\tPresence Requirement\tAssociated attribute\t(Location of Sub-attr)\tApplicable Reference Points\n1\t3GPP-IMSI\tIMSI for this user\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n2\t3GPP-Charging-Id\tFor GGSN, Charging ID for this PDP Context (this together with the GGSN IP Address constitutes a unique identifier for the PDP context).\nFor P-GW, Charging ID for this IP-CAN bearer (this together with the P-GW IP address constitutes a unique identifier for the IP-CAN bearer).\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi,\tSgi\n3\t3GPP-PDP-Type\tFor GGSN, it indicates the type of PDP context, e.g. IP or PPP.\tFor P-GW, it indicates the PDN Type, i.e. Ipv4, Ipv6, Ipv4v6.\tConditional\t(mandatory if attribute 7 is present)\tAccess-Request Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi\tSgi\n4\t3GPP-CG-Address\tCharging Gateway IP address\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi,\tSgi\n5\t3GPP-GPRS-Negotiated-QoS-Profile\tFor GGSN, it represents the QoS profile for the PDP context.\tFor P-GW, it represents the QoS profile for the EPS bearer and the authorized APN-AMBR.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi\tSgi\n6\t3GPP-SGSN-Address\tFor GGSN, it represents the SGSN Ipv4 address that is used by the GTP control plane for the handling of control messages. \tFor P-GW, it represents the Ipv4 address of the S-GW, trusted non-3GPP IP access or ePDG that is used on S5/S8, S2a or S2b, or the SGSN Ipv4 address for GnGp SGSN accesses to the PGW for the handling of control messages. \tThe address may be used to identify the PLMN to which the user is attached.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi, \tSgi\n7\t3GPP-GGSN-Address\tFor GGSN, it represents the GGSN Ipv4 address that is used by the GTP control plane for the context establishment.\tFor P-GW, it representsthe P-GW Ipv4 address that is used on S5/S8, S2a, S2b or S2c control plane for the IP-CAN session establishment. The address is the same as the GGSN/P-GW Ipv4 address used in the CDRs generated by the GGSN/P-GW.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi, \tSgi\n8\t3GPP-IMSI-MCC-MNC\tMCC and MNC extracted from the user\u2019s IMSI (first 5 or 6 digits, as applicable from the presented IMSI).\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\t\tGi,\tSgi\n9\t3GPP-GGSN- MCC-MNC\tMCC-MNC of the network the GGSN or the P-GW belongs to.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi, \tSgi\n10\t3GPP-NSAPI\tFor GGSN, it identifies a particular PDP context for the associated PDN and MSISDN/IMSI from creation to deletion.\tFor P-GW, it identifies the EPS Bearer ID if it is known to the P-GW (i.e. GTP-based S5/S8 is in use). \tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP Accounting-Request Interim-Update\tGi, \tSgi\n11\t3GPP-Session-Stop-Indicator\tIndicates to the AAA server that the last PDP context or EPS Bearer of a session is released and that the IP-CAN session has been terminated.\tOptional\tAccounting Request STOP\tGi,\tSgi\n12\t3GPP-Selection-Mode\tFor GGSN it contains the Selection mode for this PDP Context received in the Create PDP Context Request message \nFor P-GW it contains the Selection mode for this EPS Bearer received in the Create Session Request message.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n13\t3GPP-Charging-Characteristics\tFor GGSN, it contains the charging characteristics for this PDP Context received in the Create PDP Context Request Message (only available in R99 and later releases).\tFor P-GW, it contains the charging characteristics for the IP-CAN bearer.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi,\tSgi\n14\t3GPP-CG-Ipv6-Address\tCharging Gateway Ipv6 address\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi,\tSgi\n15\t3GPP-SGSN-Ipv6-Address\tFor GGSN, it represents the SGSN Ipv6 address that is used by the GTP control plane for the handling of control messages.\tFor P-GW, it represents the Ipv6 address of the S-GW, trusted non-3GPP IP access or ePDG that is used on S5/S8, S2a or S2b, or the SGSN Ipv6 address for GnGp SGSN accesses to the PGW for the handling of control messages. \tThe address may be used to identify the PLMN to which the user is attached.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi, \tSgi\n16\t3GPP-GGSN-Ipv6-Address\tFor GGSN, it represents the GGSN Ipv6 address that is used by the GTP control plane for the context establishment.\tFor P-GW, it represents the P-GW Ipv6 address that is used on S5/S8, S2a, S2b or S2c control plane for the IP-CAN session establishment.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update \tGi, \tSgi\n17\t3GPP-Ipv6-DNS-Servers\tList of Ipv6 addresses of DNS servers for an APN\tOptional\tAccess-Accept \tGi,\tSgi\n18\t3GPP-SGSN-MCC-MNC\tFor GGSN and PGW connected to a Gn/Gp SGSN, it represents the\tMCC and MNC extracted from the RAI within the Create PDP Context Request or Update PDP Context Request message.\tFor P-GW in GTP/PMIP S5/S8 it represents the MCC and MNC extracted from the Serving Network.\tFor PGW connected to S2a, it represents the MCC and MNC extracted from the Serving Network.\tFor PGW connected to S2b, it represents the MCC and MNC extracted from the Serving Network.\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n19\t3GPP-Teardown-Indicator\tIndicate to the GGSN/P-GW that all IP-CAN bearers for this particular user and sharing the same user session need to be deleted.\tOptional\tDisconnect Request\tGi\nSgi\n20 \t3GPP-IMEISV\tInternational Mobile Equipment Id and its Software Version \tOptional\tAccounting-Request START, Accounting-Request STOP, Access-Request \tGi,\tSgi\n21\t3GPP-RAT-Type\tIndicate which Radio Access Technology is currently serving the UE\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n22\t3GPP-User-Location-Info\tIndicate details of where the UE is currently located (e.g. SAI or CGI).\t\tOptional\tAccounting-Request START, Access-Request, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi \n23\t3GPP-MS-TimeZone\tIndicate the offset between universal time and local time in steps of 15 minutes of where the MS/UE currently resides.\tOptional\tAccounting-Request START, Access-Request, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n24\t3GPP-CAMEL-Charging-Info\tUsed to copy any CAMEL Information present in SCDR(s).\tOptional\tAccounting-Request START, Access-Request\tGi\n25\t3GPP-Packet-Filter\tPacket Filter used for this PDP context or EPS bearer.\tOptional \tAccounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\nSgi\n26\t3GPP-Negotiated-DSCP\tDSCP used to mark the IP packets of this PDP context on the Gi interface or EPS Bearer context on the Sgi interface\tOptional\tAccess-Request, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n27\t3GPP-Allocate-IP-Type\tIndicates whether the Access-Request is sent for user authentication only and/or for allocation of an Ipv4 address and/or of an Ipv6 prefix\tConditional (see subclause 16.4.7.2 for conditions)\tAccess-Request\tGi,\tSgi\n28\tExternal-Identifier\tA globally unique identifier of a UE used towards external servers instead of IMSI and MSISDN, refer to 3GPP TS\u00a023.682\u00a0[100] and 3GPP TS\u00a023.003\u00a0[40].\tOptional\tAccess-Request, Access-Accept, Accounting-Request START, Accounting-Request STOP, Accounting-Request Interim-Update\tGi,\tSgi\n29\tTWAN-Identifier\tIndicates the UE location in a Trusted WLAN Access Network.\tOptional\tAccounting-Request START, Access-Request, Accounting-Request STOP, Accounting-Request Interim-Update\tSgi\n30\t3GPP-User-Location-Info-Time\tIndicate the time at which the UE was last known to be in the location which is reported during bearer deactivation or PDN disconnection procedure.\tOptional\t  Accounting-Request STOP\tGi,\tSgi\n\nThe information represented by some of the Sgi sub-attributes may not be available to the P-GW depending on the UE\u2019s radio access and the S5/S8 protocol type (GTP or PMIP). For example, the P-GW will be aware of the User Location Info (e.g. TAI) if the user is in LTE access and GTP based S5/S8 is used.  However, such information is not passed to the P-GW when PMIP based S5/S8 is utilised. In such scenarios, if a sub-attribute is configured in the P-GW to be transferred to the RADIUS AAA server, but the information in the P-GW is not up to date or not available; the P-GW shall not send the corresponding sub-attribute, unless otherwise stated in the following subclause where the encoding of each sub-attribute is specified. \n\n*** 2nd Change ***\n16.4.7.2\tCoding 3GPP Vendor-Specific RADIUS attributes\nIn this subclause the provisions of IETF RFC 2865\u00a0[38] apply, which in particular specify the following:\n-\tthe Length field of an attribute is one octet, and it indicates the length of this Attribute including the Type, Length and Value fields.\n-\ttype String may be 1-253 octets long and it contains binary data (values 0 through 255 decimal, inclusive).  Strings of length zero (0) shall not be sent, but the entire attribute shall be omitted. A NULL terminating character shall not be appended to an attribute of type String.\n-\ttype Text may be 1-253 octets long and it contains UTF-8 encoded characters.  Text of length zero (0) shall not be sent, but the entire attribute shall be omitted. A NULL terminating character shall not be appended to an attribute of type Text.\n-\ttype Address is 32 bit value and most significant octet is the first one.\n-\ttype Integer is 32 bit unsigned value and most significant octet is the first one.\nThe RADIUS vendor Attribute is encoded as follows (as per IETF RFC 2865\u00a0[38])\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t Type = 26\n2\t\tLength = n\n3 \t\tVendor id octet 1\n4\t\tVendor id octet 2\n5\t\tVendor id octet 3\n6\t\tVendor id octet 4\n7-n\t\tString\n\nn  7\n3GPP Vendor Id = 10415\nThe string part is encoded as follows:\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = \n2\t\t3GPP Length = m\n3 \u2013m\t\t3GPP value\n\nm  2 and m  248\nThe 3GPP specific attributes encoding is clarified below.\nNOTE:\t\tUnless otherwise stated, the encoding of the value field of a 3GPP vendor-specific attribute is identical for Gi and Sgi. \n1 \u2013 3GPP-IMSI\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 1\n2\t\t3GPP Length= m\n3-m\t\tIMSI digits 1-n (UTF-8 encoded characters)\n\n3GPP Type: 1\nn 15\nLength: m  17\nIMSI value: Text type:\nA GGSN (or a P-GW) receives IMSI that is encoded according to 3GPP TS\u00a029.060\u00a0[24] (or 3GPP TS\u00a029.274\u00a0[81]) and converts IMSI into the UTF-8 characters, which are encoded as defined in 3GPP TS\u00a023.003\u00a0[40]. There shall be no padding characters between the MCC and MNC, and between the MNC and MSIN. If the IMSI is less than 15 digits, the padding in the GTP information element shall be removed by the GGSN (or the P-GW) and not encoded in this sub-attribute.\n2 \u2013 3GPP-Charging ID\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 2\n2\t\t3GPP Length= 6\n3\t\tCharging ID value Octet 1\n4\t\tCharging ID value Octet 2\n5\t\tCharging ID value Octet 3\n6\t\tCharging ID value Octet 4\n\n3GPP Type: 2\nLength: 6\nCharging ID value: 32 bits unsigned integer\n3 \u2013 3GPP-PDP type\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 3\n2\t\t3GPP Length= 6\n3\t\tPDP type octet 1\n4\t\tPDP type octet 2\n5\t\tPDP type octet 3\n6\t\tPDP type octet 4\n\n3GPP Type: 3\nLength: 6\nPDP type value: Unsigned 32 bits integer type\nPDP type may have the following values:\n0 = Ipv4\n1 = PPP\n2 = Ipv6\n3 = Ipv4v6\n4 = Non-IP\nFor P-GW, this sub-attribute represents PDN Type and therefore only the values \"0\", \"2\", \"3\" and \"4\" are applicable. \n4 \u2013 3GPP-Charging Gateway address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 4\n2\t\t3GPP Length= 6\n3\t\tCharging GW addr Octet 1\n4\t\tCharging GW addr Octet 2\n5\t\tCharging GW addr Octet 3\n6\t\tCharging GW addr Octet 4\n\n3GPP Type: 4\nLength: 6\nCharging GW address value: Address type.\n5 \u2013 3GPP-GPRS Negotiated QoS profile\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 5\n2\t\t3GPP Length= L\n3 \u2013 L\t\tUTF-8 encoded QoS profile\n\n3GPP Type: 5\nLength: For GGSN, L  37 (release 7 or higher) or L  33 (release 6 or release 5) or L  27 (release 4 or release 99) or L = 11 (release 98). For P-GW, the length varies depending on the value of QCI. See below for details.\nQoS profile value: Text type\nUTF-8 encoded QoS profile syntax:\n\"<Release indicator> \u2013 <release specific QoS IE UTF-8 encoding>\"\n<Release indicator> = UTF-8 encoded number (two characters) :\n\tFor GGSN:\n\"98\" = Release 98\n\"99\"= Release 99 or release 4\n\"05\"= Release 5 or release 6\n\"07\"= Release 7 or higher\nFor P-GW:\n\"08\"= Release 8 or higher\n\t<release specific QoS profile UTF-8 encoding> = UTF-8 encoded QoS profile for the release indicated by \tthe release indicator.\n\tThe UTF-8 encoding of a QoS IE is defined as follows: each octet is described by 2 UTF-8 encoded characters, defining its hexadecimal representation. \n\tFor GGSN:\n\tThe QoS profile definition is in 3GPP TS\u00a024.008\u00a0[54].\n\t\tThe release 98 QoS profile data is 3 octets long, which then results in a 6 octets UTF-8 encoded string.\n\t\tThe release 99 and release 4 QoS profile data is 11 octets long, which results in a 22 octets UTF-8 encoded string. \n\tThe release 5 and release 6 QoS profile data is 14 octets long, which results in a 28 octets UTF-8 encoded string.\n\tThe release 7 (and higher) QoS profile data is 16 octets long, which results in a 32 octets UTF-8 encoded string.\n\tFor P-GW: \n\tIt contains the following QoS parameters associated with the EPS bearer:\n-\tQCI\n-\tARP\n-\tGBR QoS information (UL/DL MBR, UL/DL GBR) or UL/DL APN-AMBR. In other words if the value of QCI indicates a GBR bearer, the GBR QoS information shall be present. If the value of QCI indicates a non-GBR bearer, the APN-AMBR information shall be present.\n\tThe encoding of the EPS bearer QoS profile parameters is specified in 3GPP TS\u00a029.274\u00a0[81]: ARP is specified in Bearer QoS IE; QCI, UL MBR, DL MBR, UL MBR and DL MBR are specified in Flow QoS IE; UL APN-AMBR and DL APN-AMBR are specified in AMBR IE.\n\tFor GBR QCIs, the encoding of UTF-8 encoded QoS Profile field shall be as follows:\n\n1-3\t\t<Release indicator> -\u201c = \u201c08-\u201c (UTF-8 encoded)\n4-5\t\tARP (UTF-8 encoded)\n6-7\t\tQCI (UTF-8 encoded)\n8-m\t\tUL MBR (UTF-8 encoded)\n(m+1)-n\t\tDL MBR (UTF-8 encoded)\n(n+1)-o\t\tUL GBR (UTF-8 encoded)\n(o+1)-p\t\tDL GBR (UTF-8 encoded)\n\n\tFor non-GBR QCIs, the UL/DL MBR and UL/DL GBR fields shall not be present; UL APN-AMBR and DL APN-AMBR fields shall be encoded (in UTF-8 encoded format) respectively after the QCI field.\n6 \u2013 3GPP-SGSN address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 6\n2\t\t3GPP Length= 6\n3\t\tSGSN addr Octet 1\n4\t\tSGSN addr Octet 2\n5\t\tSGSN addr Octet 3\n6\t\tSGSN addr Octet 4\n\n3GPP Type: 6\nLength: 6\nSGSN address value: Address type.\n7 \u2013 3GPP-GGSN address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 7\n2\t\t3GPP Length= 6\n3\t\tGGSN addr Octet 1\n4\t\tGGSN addr Octet 2\n5\t\tGGSN addr Octet 3\n6\t\tGGSN addr Octet 4\n\n3GPP Type: 7\nLength: 6\nGGSN address value: Address type.\n8 \u2013 3GPP-IMSI MCC-MNC\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 8\n2\t\t3GPP Length= n\n3\t\tMCC digit1 (UTF-8 encoded character)\n4\t\tMCC digit2 (UTF-8 encoded character)\n5\t\tMCC digit3 (UTF-8 encoded character)\n6\t\tMNC digit1 (UTF-8 encoded character)\n7\t\tMNC digit2 (UTF-8 encoded character)\n8\t\tMNC digit3 if present (UTF-8 encoded character)\n\n3GPP Type: 8\nLength: n shall be 7 or 8 octets depending on the presence of MNC digit 3\nIMSI MCC-MNC address value: Text type.\nThis is the UTF-8 encoded characters representing the IMSI MCC-MNC numerical values. In accordance with 3GPP TS\u00a029.060\u00a0[24] (for GGSN), 3GPP TS\u00a029.274\u00a0[81] (for P-GW) and 3GPP TS\u00a023.003\u00a0[40], the MCC shall be 3 digits and the MNC shall be either 2 or 3 digits. There shall be no padding characters between the MCC and MNC.\n9 \u2013 3GPP-GGSN MCC-MNC\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 9\n2\t\t3GPP Length= n\n3\t\tMCC digit1 (UTF-8 encoded character)\n4\t\tMCC digit2 (UTF-8 encoded character)\n5\t\tMCC digit3 (UTF-8 encoded character)\n6\t\tMNC digit1 (UTF-8 encoded character)\n7\t\tMNC digit2 (UTF-8 encoded character)\n8\t\tMNC digit3 if present (UTF-8 encoded character)\n\n3GPP Type: 9\nLength: n shall be 7 or 8 octets depending on the presence of MNC digit 3\nGGSN address value: Text type.\nThis is the UTF-8 encoding of the GGSN MCC-MNC values. In accordance with 3GPP TS\u00a023.003\u00a0[40] and 3GPP TS\u00a029.060\u00a0[24] the MCC shall be 3 digits and the MNC shall be either 2 or 3 digits. There shall be no padding characters between the MCC and MNC.\n10 \u2013 3GPP-NSAPI\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 10\n2\t\t3GPP Length= 3\n3\t\tNSAPI (UTF-8 encoded character)\n\n3GPP Type: 10\nLength: 3\nNSAPI value: Text Type.\nIt is the value of the NSAPI of the PDP context the RADIUS message is related to. It is encoded as its hexadecimal representation, using one UTF-8 encoded character. The GGSN should receive NSAPI values in the following hexadecimal range 05 \u2013 0F. The GGSN shall discard digit 0 and convert the remaining digit into one UTF-8 coded character.\nFor P-GW, the value of this sub-attribute represents the EPS Bearer ID as specified in 3GPP TS\u00a029.274\u00a0[81]. \n11 \u2013 3GPP-Session Stop Indicator\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 11\n2\t\t3GPP Length= 3\n3\t\t1 1 1 1 1 1 1 1 (bit string)\n\n3GPP Type: 11\nLength: 3\nValue is set to all 1.\n3GPP-Session Stop Indicator value: Bit String type. \n12 \u2013 3GPP-Selection-Mode\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 12\n2\t\t3GPP Length= 3\n3\t\tUTF-8 encoded Selection mode character \n\n3GPP Type: 12\nLength: 3\nSelection mode value: Text type.\nThe format of this sub-attribute shall be a character that represents a single digit, mapping from the binary value of the selection mode in the Create PDP Context message (3GPP TS\u00a029.060\u00a0[24]) for the GGSN, and the Create Session Request message (3GPP TS\u00a029.274\u00a0[81]) for the P-GW. Where 3GPP TS\u00a029.060\u00a0[24] provides for interpretation of the value, e.g. map \u20183\u2019 to \u20182\u2019, this shall be done by the GGSN.\n13 \u2013 3GPP-Charging-Characteristics\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 13\n2\t\t3GPP Length= 6\n3-6\t\tUTF-8 encoded Charging Characteristics value \n\n3GPP Type: 13\nLength: 6\nCharging characteristics value: Text type.\n\tThe charging characteristics is value of the 2 octets. The value field is taken from the GTP IE described in 3GPP TS\u00a029.060\u00a0[24], subclause 7.7.23 for the GGSN and 3GPP TS\u00a029.274\u00a0[81] for the P-GW.\nEach octet of this IE field value is represented via 2 UTF-8 encoded character, defining its hexadecimal representation.\n14 \u2013 3GPP-Charging Gateway Ipv6 address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 14\n2\t\t3GPP Length= 18\n3\t\tCharging GW Ipv6 addr Octet 1\n4\t\tCharging GW Ipv6 addr Octet 2\n5-18\t\tCharging GW Ipv6 addr Octet 3-16\n\n3GPP Type: 14\nLength: 18\nCharging GW Ipv6 address value: Ipv6 Address.\nCharging GW Ipv6 address is Octet String type.\n15 \u2013 3GPP-SGSN Ipv6 address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 15\n2\t\t3GPP Length= 18\n3\t\tSGSN Ipv6 addr Octet 1\n4\t\tSGSN Ipv6 addr Octet 2\n5-18\t\tSGSN Ipv6 addr Octet 3-16\n\n3GPP Type: 15\nLength: 18\nSGSN Ipv6 address value: Ipv6 Address.\nSGSN Ipv6 address is Octet String type.\n16 \u2013 3GPP-GGSN Ipv6 address\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 16\n2\t\t3GPP Length= 18\n3\t\tGGSN Ipv6 addr Octet 1\n4\t\tGGSN Ipv6 addr Octet 2\n5-18\t\tGGSN Ipv6 addr Octet 3-16\n\n3GPP Type: 16\nLength: 18\nGGSN Ipv6 address value: Ipv6 Address.\nSGSN Ipv6 address is Octet String type.\n17 \u2013 3GPP-Ipv6-DNS-Servers\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 17\n2\t\t3GPP Length= m\n3-18\t\t(1st) DNS Ipv6 addr Octet 1-16\n19-34\t\t(2nd) DNS Ipv6 addr Octet 1-16\nk-m\t\t(n-th) DNS Ipv6 addr Octet 1-16\n\n3GPP Type: 17\nLength: m = n \u00d7 16 + 2; n  1 and n  15; k = m-15\nIpv6 DNS Server value: Ipv6 Address.\nIpv6 DNS Server address is Octet String type.\nThe 3GPP- Ipv6-DNS-Servers sub-attribute provides a list of one or more (\u2018n\u2019) Ipv6 addresses of Domain Name Server (DNS) servers for an APN. The DNS servers are listed in the order of preference for use by a client resolver, i.e. the first is \u2018Primary DNS Server\u2019, the second is \u2018Secondary DNS Server\u2019 etc. The sub-attribute may be included in Access-Accept packets.\n18 \u2013 3GPP-SGSN MCC-MNC\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 18\n2\t\t3GPP Length= n\n3\t\tMCC digit1 (UTF-8 encoded character)\n4\t\tMCC digit2 (UTF-8 encoded character)\n5\t\tMCC digit3 (UTF-8 encoded character)\n6\t\tMNC digit1 (UTF-8 encoded character)\n7\t\tMNC digit2 (UTF-8 encoded character)\n8\t\tMNC digit3 if present (UTF-8 encoded character)\n\n3GPP Type: 18\nLength: n shall be 7 or 8 octets depending on the presence of MNC digit 3\nSGSN MCC-MNC address value: Text type.\nThis is the UTF-8 encoding of the MCC-MNC values extracted from the RAI or from the Serving Network. In accordance with 3GPP TS\u00a023.003\u00a0[40] and 3GPP TS\u00a029.060\u00a0[24] (for the GGSN and P-GW connected to a Gn/Gp SGSN) and 3GPP\u00a0TS\u00a029.274\u00a0[81] (for the P-GW in GTP/PMIP S5/S8, S2a, S2b), the MCC shall be 3 digits and the MNC shall be either 2 or 3 digits. There shall be no padding characters between the MCC and MNC.\n19 \u2013 3GPP-Teardown Indicator\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 19\n2\t\t3GPP Length= 3\n3\t\tspare\tTI\n\n3GPP Type: 19\nLength: 3\nOctet 3 is Octet String type.\nFor GGSN, if the value of TI is set to \"1\", then all PDP contexts that share the same user session with the PDP context identified by the Acct-Session-Id shall be torn down. Only the PDP context identified by the Acct-Session-Id shall be torn down if the value of TI is \"0\" (see subclause 16.3.4 \"AAA-Initiated PDP context termination\"), or if TI is missing.\nFor P-GW, the usage of Teardown-Indicator is as follows (see subclause 16.3a.3 for more deails):\n-\tif the value of TI is set to \"1\", then all IP-CAN bearers that share the same user session with the IP-CAN bearer identified by the Acct-Session-Id shall be torn down.  \n-\tif the value of TI is \"0\", or if TI is missing, only the IP-CAN bearer identified by the Acct-Session-Id shall be torn down. If the Acct-Sesssion-Id identifies the default bearer, the P-GW shall tear down all the IP-CAN bearers that share the same user session identified by the Acct-Session-Id. \n20 -3GGP- IMEISV\n\nBits\nOctets\t8\t7\t6\t5\t4\t3\t2\t1\n1\t3GPP Type = 20\n2\t3GPP Length = 2+n\n3 \u2013 (2+n)\tIMEI(SV) digits 1 \u2013 n (UTF-8 encoded characters)\n\n3GPP Type: 20\nIMEISV value: Text type.\nA GGSN receives IMEI(SV) that is encoded according to 3GPP TS\u00a029.060\u00a0[24]. A P-GW receives IMEI(SV) that is encoded in ME Identity IE specified in 3GPP TS\u00a029.274\u00a0[81]. The GGSN or the P-GW converts IMEI(SV) into a  sequence of UTF-8 characters.IMEI(SV) shall be encoded as defined in 3GPP TS\u00a023.003\u00a0[40].\n14  n  16\nn = 16 for IMEISV, where TAC = 8 digits  SNR = 6 digits & SVN = 2 digits;\nn = 15 for IMEI, where TAC = 8 digits  SNR = 6 digits & Spare = 1 digit;\nn = 14 for IMEI, where TAC = 8 digits  SNR = 6 digits (Spare digit is not sent)\n21 \u2013 3GPP-RAT-Type\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 21\n2\t\t3GPP Length= 3\n3\t\tRAT (octet string)\n\n3GPP Type: 21\nThe 3GPP-RAT-Type sub-attribute indicates which Radio Access Technology is currently serving the UE. \nRAT field: Radio Access Technology type values. RAT field is Octet String type. For GGSN, it shall be coded as specified in 3GPP TS\u00a029.060\u00a0[24]. For P-GW, it shall be coded as follows:\n0-8\t\tAs specified in 3GPP TS\u00a029.274\u00a0[81]\n9-100\t\tSpare for future use\n101\t\tIEEE 802.16e\n102\t\t3GPP2 eHRPD\n103\t\t3GPP2 HRPD\n104\t\t3GPP2 1xRTT\n105\t\t3GPP2 UMB\n106-255\tSpare for future use\n22 \u2013 3GPP-User-Location-Info\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 22\n2\t\t3GPP Length= m\n3\t\tGeographic Location Type \n4-m\t\tGeographic Location (octet string)\n\n3GPP Type: 22\nLength=m, where m depends on the Geographic Location Type\n\t\tFor example, m= 10 in the CGI and SAI types.\nGeographic Location Type field is used to convey what type of location information is present in the \u2018Geographic Location\u2019 field. For GGSN, the Geographic Location Type values and coding are as defined in 3GPP TS\u00a029.060\u00a0[24]. For P-GW, the Geographic Location Type values and coding are defined as follows:\n0\t\t\tCGI\n1\t\t\tSAI\n2\t\t\tRAI\n3-127\t\tSpare for future use\n128\t\tTAI\n129\t\tECGI\n130\t\tTAI and ECGI\n131\t\teNodeB ID\n132\t\tTAI and eNodeB ID\n133-255\tSpare for future use\nGeographic Location field is used to convey the actual geographic information as indicated in the Geographic Location Type. For GGSN, the coding of this field is as specified in 3GPP TS\u00a029.060\u00a0[24]. For P-GW, the coding of this field shall be as follows:\n-\tIf the Geographic Location Type has a value indicating CGI, SAI, RAI, TAI or ECGI (i.e. the value field is equal to 0, 1, 2, 128, or 129), the coding of the Geographic Location field shall be as per clauses 8.21.1 to 8.21.5, respectively, in 3GPP TS\u00a029.274\u00a0[81],\n-\tIf the Geographic Location Type has a value indicating TAI and ECGI (i.e. the value field is equal to 130), in Geographic Location field both TAI and ECGI shall be encoded one after another as per clauses 8.21.4 and 8.21.5 in 3GPP TS\u00a029.274\u00a0[81]. TAI information shall be encoded first starting with Octet 4 of 3GPP-User-Location-Info.\n-\tIf the Geographic Location Type has a value indicating eNodeB ID (i.e. the value field is equal to 131), the coding of the Geographic Location field shall be as defined in subclause\u00a08.21.7 in 3GPP\u00a0TS\u00a029.274\u00a0[81].\n-\tIf the Geographic Location Type has a value indicating TAI and eNodeB ID (i.e. the value field is equal to 132), in Geographic Location field both TAI and eNodeB ID shall be encoded one after another as per subclauses\u00a08.21.4 and 8.21.7 in 3GPP\u00a0TS\u00a029.274\u00a0[81].\nGeographic Location Type and Geographic Location fields are Octet String type.\n23 \u2013 3GPP-MS-TimeZone\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 23\n2\t\t3GPP Length= 4\n3\t\tTime Zone \n4\t\tDaylight Saving Time (octet string)\n\n3GPP Type: 23\nLength=4\nThe Time Zone field and the Daylight Saving Time fields are used to indicate the offset between universal time and local time in steps of 15 minutes of where the MS/UE currently resides. \nFor GGSN, both fields are coded as specified in 3GPP TS\u00a029.060\u00a0[24] and represented as Octet String type. For, P-GW, both fields are coded as specified in 3GPP TS\u00a029.274\u00a0[81] in UE-Time Zone IE and represented as Octet String type.\n24 \u2013 3GPP-Camel-Charging-Info\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 24\n2\t\t3GPP Length= m\n3-m\t\tCAMEL Charging Information Container (octet string)\n\n3GPP Type: 24\nLength=m\nm depends  on the size of the CAMELInformationPDP IE.\nThe CAMEL Charging Information Container field is used to copy the CAMELInformationPDP IE including Tag and Length from the SGSN\u2019s CDR (SCDR). \nThe coding of this field is as specified in 3GPP TS\u00a029.060\u00a0[24] and represented as Octet String type.\n25 \u2013 3GPP-Packet-Filter\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 25\n2\t\t3GPP Length= n\n3-z\t\tPacket Filter\n\n3GPP Type: 25\nLength: n\nEach 3GPP-Packet-Filter sub-attribute contains only one packet filter. Multiple 3GPP-Packet-Filter sub-attributes can be sent in one RADIUS Accounting Request message. \nWhen the GGSN/P-GW sends the packet filter information, the RADIUS message shall carry ALL (or none) of the packet filters.\nPacket Filter Value:\n\n\t8\t7\t6\t5\t4\t3\t2\t1\n\tPacket filter identifier \tOctet 1\n\tPacket filter evaluation precedence \tOctet 2\n\tLength of Packet filter contents \tOctet 3\n\tDirection of Packet Filter\tOctet 4\n\tPacket filter contents \tOctet 5\tOctet m\n\nDirection Value:\n00000000: Downlink\n00000001: Uplink\nThe packet filter content is represented as Octet String type. The packet filter content is defined below:\n\nType\tValue\n1: Ipv4 address type\tContains the source address if the direction value is set to Downlink, and the destination address if the direction value is set to Uplink.\tShall be encoded as a sequence of a four octet Ipv4 address field and a four octet Ipv4 address mask field. The Ipv4 address field shall be transmitted first\n2: Ipv6 address type\tContains the source address if the direction value is set to Downlink, and the destination address if the direction value is set to Uplink.\tShall be encoded as a sequence of a sixteen octet Ipv6 address field and a sixteen octet Ipv6 address mask field. The Ipv6 address field shall be transmitted first\n3: Protocol identifier/Next header type\tshall be encoded as one octet which specifies the Ipv4 protocol identifier or Ipv6 next header\n4\u00a0: Single destination port type\tshall be encoded as two octet which specifies a port number\n5\u00a0: Destination port range type\tshall be encoded as a sequence of a two octet port range low limit field and a two octet port range high limit field. The port range low limit field shall be transmitted first\n6\u00a0: Single source port type \tshall be encoded as two octet which specifies a port number\n7\u00a0: Source port range type\tshall be encoded as a sequence of a two octet port range low limit field and a two octet port range high limit field. The port range low limit field shall be transmitted first\n8: Security parameter index type (Ipv6)\tshall be encoded as four octet which specifies the IPSec security parameter index\n9: Type of service/Traffic class type\tshall be encoded as a sequence of a one octet Type-of-Service/Traffic Class field and a one octet Type-of-Service/Traffic Class mask field. The Type-of-Service/Traffic Class field shall be transmitted first\n10: Flow label type (Ipv6)\tshall be encoded as three octets which specify the Ipv6 flow label. The bits 8 through 5 of the first octet shall be spare whereas the remaining 20 bits shall contain the Ipv6 flow label\n\nNote:  The sending of this sub-attribute is not recommended for an inter-operator interface for security reason\n26 \u2013 3GPP-Negotiated-DSCP\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 26\n2\t\t3GPP Length= 3\n3\t\tNegotiated DSCP (octet string)\n\n3GPP Type: 26\nLength:  3\nNegotiated DSCP value: Octet String\nDSCP value: Octet String type.\n27 \u2013 3GPP-Allocate-IP-Type\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 27\n2\t\t3GPP Length= 3\n3\t\tIP Type (octet string)\n\n3GPP Type: 27\nIf multiple Access-Request signalling towards a AAA server is needed during the lifetime of a PDN connection (e.g. for PDN/PDP type Ipv4v6 and deferred Ipv4 addressing), this sub-attribute shall be included in the Access-Request message to indicate how the AAA server needs to treat the request. The P-GW/GGSN may also use this sub-attribute if the AAA server is configured to allocate both Ipv4 address and Ipv6 prefix but the P-GW/GGSN requires assignment of only one IP type or both IP types (e.g. because the UE supports single IP stack and it has requested PDN/PDP type of Ipv4 or Ipv6).\nIf this sub-attribute does not exist in Access-Request from P-GW/GGSN to the AAA server, the IP address allocation shall be based on the IP address allocation policy configured in the the AAA server. \nIP Type field: It is encoded in Octet String type and the following decimal equivalent values apply:\n0\tDo not allocate Ipv4 address or Ipv6 prefix. \nThe typical use case is for PDN/PDP type Ipv4v6 and deferred Ipv4 addressing and only Ipv4 address is allocated by the AAA 21orrec but Ipv6 prefix is allocated by some other means, e.g. local pool in the P-GW/GGSN. The Access-Request from the P-GW/GGSN to the AAA server during the UE\u2019s initial access to the network shall set the value of this sub-attribute to 0.\n1\tAllocate Ipv4 address\nThe typical use case is for PDN/PDP type Ipv4v6 and deferred Ipv4 addressing and the Ipv4 address (and/or Ipv6 prefix) is allocated by the AAA server. The Access-Request from the P-GW/GGSN to the AAA server when the P-GW/GGSN receives UE-initiated Ipv4 address allocation signalling (e.g. DHCPv4) after UE\u2019s successful initial access to the PDN shall set the value of this attribute to 1.  In this case, if the AAA server had allocated an Ipv6 prefix earlier during UE\u2019s initial access to the network, same Ipv6 prefix shall be kept allocated. \n2\tAllocate Ipv6 prefix\nThe typical use case is for PDN/PDP type Ipv4v6 and deferred Ipv4 addressing and both Ipv4 address and Ipv6 prefix are allocated by the AAA server. The Access-Request from the P-GW/GGSN to the AAA server during the UE\u2019s initial access to the network shall set the value of this sub-attribute to 2.\n3\tAllocate Ipv4 address and Ipv6 prefix\nCurrently there is no use case identified to use this specific value for PDN/PDP tpe Ipv4v6 and deferred Ipv4 addressing. One potential use case is for PDN/PDP type Ipv4v6 and non-deferred Ipv4 addressing and both Ipv4 address and Ipv6 prefix are allocated by the AAA server. The Accesss-Request from the P-GW/GGSN to the AAA server may use this value to have both Ipv4 address and Ipv6 prefix assigned to the UE. \n4-255\tReserved for future use\n28 \u2013 External-Identifier\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 28\n2\t\t3GPP Length= m\n3-m\t\tIdentifier characters 1-n (UTF-8 encoded characters)\n\n3GPP Type: 28\nn   72 / 253                (n  72 octets shall be supported, n   253 octets recommended, refer to 3GPP TS\u00a029.336\u00a0[101] and  IETF RFC 4282\u00a0[102])\nLength: m  74 / 255   (m  74 octets shall be supported, m   255 octets recommended, refer to 3GPP TS\u00a029.336\u00a0[101] and  IETF RFC 4282\u00a0[102])\nExternal-Identifier value: Text type.\nA globally unique identifier of a UE used towards external server instead of IMSI and MSISDN, refer to 3GPP TS\u00a023.682\u00a0[100] and 3GPP TS\u00a023.003\u00a0[40]. \n29 \u2013 TWAN-Identifier\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 29\n2\t\t3GPP Length= m\n3-m\t\tTWAN Identifier (octet string)\n\n3GPP Type: 29\nLength=m, where m depends on the type of location that is present as described in 3GPP TS\u00a029.274\u00a0[81].\nTWAN Identifier field is used to convey the location information in a Trusted WLAN Access Network (TWAN). The coding of this field shall be the same as for the GTP TWAN Identifier starting with Octet 5, as per clause 8.100 in 3GPP TS\u00a029.274\u00a0[81].\nTWAN Identifier field is Octet String type.\n30 \u2013 3GPP-User-Location-Info-Time\n\n\t\tBits\nOctets\t\t8\t7\t6\t5\t4\t3\t2\t1\n1\t\t3GPP type = 30\n2\t\t3GPP Length= 6\n3-6\t\tUser Location Info time\n\n3GPP Type: 30\nLength=6\nUser Location Info time field is Unsigned32 type, it indicates the NTP time at which the UE was last known to be in the location which is reported during bearer deactivation or UE detach procedure.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*** 3rd Change ***\n16.3a.1\tAuthentication, Authorization and Accounting procedures\nWhen a P-GW receives an initial access request (e.g. Create Session Request or Proxy Binding Update) message for a given APN, the P-GW may (depending on the configuration for this APN) send a RADIUS Access-Request to an AAA server. The AAA server authenticates and authorizes the user. If the RADIUS server is also responsible for Ipv4 address and/or Ipv6 prefix allocation, the AAA server shall return the allocated Ipv4 address and/or Ipv6 prefix in the Access-Accept message.\nWhen PDN type is Ipv4v6 and deferred Ipv4 addressing via Ipv4 address pool in the AAA server is used, the P-GW may intiate RADIUS re-authorization procedures after successful initial attach for the purpose of Ipv4 address allocation or to renew the lease for a previously allocated Ipv4 address. In this case, the P-GW shall set the Service-Type attribute to \"Authorize Only\" and the 3GPP-Allocate-IP-Type subattribute to the type of IP address to be allocated in the Access-Request message sent to the AAA server. See subclause 16.4.7.2 for the conditions to use 3GPP-Allocate-IP-Type sub-attribute in Access-Request messages. If the P-GW is using DHCPv4 signalling towards the UE and the RADIUS server includes the Session-Timeout attribute in the Access-Accept, the P-GW may use the Session-Timeout value as the DHCPv4 lease time. The P-GW shall not set the DHCPv4 lease time value higher than the Session-Timeout value. The P-GW may renew the DHCP lease to the UE without re-authorization towards the AAA server providing that the new lease expiry is no later than the Session-Timeout timer expiry. If the P-GW wishes to extend the lease time beyond the current Session-Timeout expiry, it shall initiate a new AAA re-authorization.\nEven if the P-GW was not involved in user authentication, it may send a RADIUS Accounting-Request (START) message to an AAA server. This message may contain parameters, e.g. the tuple which includes the user-id and Ipv4 address and/or Ipv6 prefix, to be used by application servers (e.g. WAP gateway) in order to identify the user. This message also indicates to the AAA server that the user session has started. The session is uniquely identified by the Acct-Session-Id that is composed of the Charging-Id and the PGW-Address.\nIf some external applications require RADIUS Accounting-Request (START) information before they can process user packets, then the selected APN (P-GW) may be configured in such a way that the P-GW drops user data until the Accounting-Response (START) is received from the AAA server. The P-GW may wait for the Accounting-Response (START) before sending the initial access response (e.g. Create Session Response or Proxy Binding Acknowledgement). The P-GW may reject the initial access request if the Accounting-Response (START) is not received. The authentication and accounting servers may be separately configured for each APN.\nFor PDN type Ipv4, at Ipv4 address allocation via DHCPv4 signalling between the UE and the PDN, no Ipv4 address is available at initial access. In that case the P-GW may wait to send the Accounting-Request (START) message until the UE receives its Ipv4 address in a DHCPACK.\nFor PDN type Ipv4v6 and deferred Ipv4 addressing, when the Ipv4 address is allocated or re-allocated, the accounting session that was established for the Ipv6 prefix allocation shall be used to inform the accounting server about the allocated Ipv4 address by sending RADIUS Accounting-Request Interim-Update with the Framed-IP-Address attribute and its value field containing the allocated Ipv4 address.\nWhen the P-GW receives a message indicating a bearer deactivation request or PDN disconnection request or detach request (e.g. Delete Bearer Command or Proxy Binding Update with lifetime equal 0) and providing a RADIUS Accounting-Request (START) message was sent previously, the P-GW shall send a RADIUS Accounting-Request (STOP) message to the AAA server, which indicates the termination of this particular bearer or user session. The P-GW shall immediately send the corresponding response (e.g. Delete Bearer Request or Proxy Binding Ack with lifetime equal 0) to the peer node (e.g. S-GW) in the Packet Domain, without waiting for an Accounting-Response (STOP) message from the AAA server.\nThe AAA server shall deallocate the Ipv4 address and/or Ipv6 prefix initially allocated to the subscriber, if there is no session for the subscriber.\nFor PDN type Ipv4v6 and deferred Ipv4 addressing, when the P-GW receives a message from the UE or the network indicating the release of the Ipv4 address (e.g. receiving DHCPRELEASE) or decides to release the Ipv4 address on its own (e.g. due to DHCP lease timer expiry or P-GW assigned Ipv4 address), the P-GW shall inform the accounting server about the deallocation of the Ipv4 address by sending RADIUS Accounting-Request Interim-Update without the Framed-IP-Address attribute.\nAccounting-Request (ON) and Accounting-Request (OFF) messages may be sent from the P-GW to the AAA server to ensure the correct synchronization of the session information in the P-GW and the AAA server.\nThe P-GW may send an Accounting-Request (ON) message to the AAA server to indicate that a restart has occurred. The AAA server may then release the associated resources.\nPrior to a scheduled restart, the P-GW may send Accounting-Request (OFF) message to the AAA server. The AAA server may then release the associated resources.\n\nIf an Access-Challenge is sent to the P-GW when an Access-Request message is pending, the P-GW shall silently discard the Access-Challenge message and it shall treat an Access-Challenge as though it had received an Access-Reject instead RFC 2865\u00a0[38]. \nFor example, figure 25a.1 represents the RADIUS message flows between a P-GW and an Authentication, Authorization and Accounting (AAA) server, which is applicable for GTP based S5/S8:\n\nNOTE 1:\tIf some external applications\u00a0require RADIUS Accounting request (Start) information before they can process user packets,\u00a0then the selected APN (P-GW) may be configured in such a way that the P-GW drops user data until the Accounting Response (START) is received from the AAA server. The P-GW may wait for the Accounting Response (START) before sending the Create Session Response. The P-GW may reject the bearer if the Accounting Response (START) is not received.\nNOTE 2:\tSeparate accounting and authentication servers may be used.\n\nFigure 25a.1: An example of RADIUS message flow on Sgi interface for GTP-based S5/S8 (successful user authentication case)\n\n*** End of Changes ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nOne CP may connnect with multiple UPs for CUPS senario, if one of the UP fails, the CP need send the accounting message for each users of the failed UP to AAA. Considering the UP supports millions of user, the CP need send millions accounting messages to AAA, which may cause signalling storm.   To resolve above problem, this CR proposes to use User Plane Identifier to identify the UP. When the Sx session is established, the CP will send the accounting start message to AAA including user identifier and also the User Plane Identifier of the UP, then AAA can know which user is related with which UP. When the UP is fails, the CP only sends the User Plane Identifier of the failed UP to AAA, AAA can then remove the context information of all users for the failed UP. The CP need not send millions accounting messages to AAA because of this optimisation.\n\n>>> SUMMARY OF CHANGE\nUser-Plane-Identifier and User-Plane-Recovery are added for Accounting-Request (START) message and Accounting-Request (ON) message.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe PGW-C need send millions accounting messages to AAA if one of the PGW-U fails."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n******************START OF CHANGES************\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the USIM application\".\n[2]\t3GPP\u00a0TS\u00a033.102: \"3G Security; Security architecture\".\n[3]\tIETF\u00a0RFC\u00a02617: \"HTTP Authentication: Basic and Digest Access Authentication\".\n[4]\tIETF\u00a0RFC\u00a03310: \"Hypertext Transfer Protocol (HTTP) Digest Authentication Using Authentication and Key Agreement (AKA)\".\n[5]\t3GPP\u00a0TS\u00a033.221: \"Generic Authentication Architecture (GAA); Support for Subscriber Certificates\".\n[6]\tVoid\n[7]\tVoid\n[8]\t3GPP\u00a0TS\u00a023.228: \"IP Multimedia Subsystem (IMS); Stage 2 (Release 6)\".\n[9]\tVoid.\n[10]\t3GPP\u00a0TS\u00a031.103: \"Characteristics of the IP Multimedia Services Identity Module (ISIM) application\".\n[11]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[12]\tIETF\u00a0RFC\u00a03548: \"The Base16, Base32, and Base64 Data Encodings\".\n[13]\t3GPP\u00a0TS\u00a033.210: \"3G Security; Network domain security; IP network layer security\".\n[14]\tVoid.\n[15]\t3GPP\u00a0TS\u00a031.101: \"UICC-terminal interface; Physical and logical characteristics\".\n[16]\t3GPP\u00a0TS\u00a033.203: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G security; Access security for IP-based services\".\n[17]\tVoid.\n[18]\tIETF\u00a0RFC\u00a02818: \"HTTP over TLS\".\n[19]\t3GPP\u00a0TS\u00a033.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[20]\tVoid.\n[21]\tVoid.\n[22]\tIETF RFC 2104: \"HMAC: Keyed-Hashing for Message Authentication\".\n[23]\tISO/IEC 10118-3:2004: \"Information Technology \u2013 Security techniques \u2013 Hash-functions \u2013 Part 3: Dedicated hash-functions\".\n[24]\tIETF\u00a0RFC\u00a03629: \"UTF-8, a transformation format of ISO 10646\".\n[25]\t3GPP\u00a0TS\u00a033.222: \"Generic Authentication Architecture (GAA); Access to network application functions using Hypertext Transfer Protocol over Transport Layer Security (HTTPS)\".\n[26]\t3GPP\u00a0TS\u00a033.246: \"3G Security; Security of Multimedia Broadcast/Multicast Service (MBMS)\".\n[27]\tVoid.\n[28]\tIETF\u00a0RFC\u00a02246: \"The TLS Protocol Version 1\".\n[29]\t\t3GPP\u00a0TS\u00a024.109: \"Bootstrapping interface (Ub) and network application function interface (Ua); Protocol details\".\n[30]\t(void)\n[31]\t(void)\n[32]\t3GPP\u00a0TS\u00a029.109: \"Generic Authentication Architecture (GAA); Zh and Zn Interfaces based on the Diameter protocol; Stage\u00a03\".\n[33]\tIETF\u00a0RFC\u00a02616: \"Hypertext Transfer Protocol -- HTTP/1.1\".\n[34]\t3GPP TS 23.002: \u201cNetwork architecture \u201c.\n[35]\t3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security Architecture\".\n[36]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses\".\n[37]\t\"Unicode Standard Annex #15; Unicode Normalization Forms\", Unicode 5.1.0, March 2008.  \n[38]\t3GPP TS 26.237: \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols\".\n[39]\t3GPP TS 33.224: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push Layer\".\n[40]\t3GPP TS 33.328: \"IMS Media plane security\".\n[41]\tIETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version 1.2\".\n[42]\t(void)\n[43]\tVoid.\n[44]\tIETF\u00a0RFC\u00a05705: \"Keying Material Exporters for Transport Layer Security (TLS)\".\n[45]\t3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function\".\n\n\n\n\n\n******************NEXT CHANGES************\nI.2.4\tUE\nThe required functionalities from the UE are:\n-\tthe support of HTTP Digest AKA protocol;\n-\tthe support of TLS; \n-\tthe capability to use a SIM in bootstrapping;\n-\tthe capability for a Ua application on the ME to indicate to the GBA Function on the ME whether a SIM is allowed for use in bootstrapping (see clause\u00a0I.4.8);\n-\tthe capability to derive new key material to be used with the protocol over Ua interface from Kc, RAND, SRES and Ks-input;\n-\tsupport of NAF-specific application protocol (For an example see TS\u00a033.221\u00a0[5]).\nA 2G GBA-aware ME shall support both 3G GBA_U, as specified in clause\u00a05.2 and 3G GBA_ME procedures, as specified in clause\u00a04.5. \n\n\n\n\n\n******************NEXT CHANGES************\nI.6.2\tAuthentication of the BSF\nThe Client shall authenticate the BSF by use of a server certificate. The client shall match the server name as specified in RFC\u00a02818\u00a0[18] section\u00a03.1.\nThe ME shall use a preconfigured list of trusted root certificates for 2G GBA BSF server certificate validation. BSF server certificate validation shall not require manual user interaction.\n\n\n******************NEXT CHANGES************\nL.1\tImpersonation of the UE to the BSF during the run of the Ub protocol\nThis is the main threat to the 2G GBA solution. \n1)\tAn attacker (being in the possession of 2G GBA equipment) could try to perform a Man-in-the-middle-attack, impersonating a genuine GSM user to the BSF. In this scenario the attacker would be at the client end of the TLS tunnel to the BSF and send the challenge RAND to the target GSM user, in order to obtain SRES and Kc. However, for the attack to be successful, he would have to find also Kc within the runtime allowed for steps 3 to 5 of the protocol over Ub, as specified in Annex I.5.2. This may be feasible when the terminal of the target GSM user still runs A5/2, but is infeasible for the foreseeable future when one of the other GSM encryption algorithms is used. A5/2 will be removed from networks by the end of 2006, and will not be present in any 2G GBA enabled terminals. A vulnerability caused by A5/2 would only exist in the case where a GSM user has subscribed to 2G GBA feature, but uses his SIM in an old terminal with A5/2 enabled while being targeted by the attacker. But the practical implications of this remaining vulnerability are expected to be limited as a user subscribed to 2G GBA will own a Release 7 terminal (2G GBA will be a Release 7 feature), and the likelihood of him inserting his SIM in an old terminal, and an attacker obtaining this information and exploiting it for a man-in-the-middle attack, may be low in practice. Furthermore, old terminals will gradually disappear. \n2)\tSIM cloning: an attacker being able to find the long-term key Ki of a genuine GSM user is able to fully impersonate him in all contexts, including the 2G-GBA one (if this has been subscribed by the genuine user).. The attacker could do this by exploiting weaknesses of A3/A8 as they were found for COMP128, while in possession of the SIM i.e. the attacker tries to find the long term key K. Even if 2G GBA does not increase the risk of possible A3/A8 breakages, it has to be noted that the COMP128-related issue disappears when more secure A3/A8 algorithms are used. These are available today, cf. \"GSM MILENAGE\", as specified in TS 55.205 v610. Operators are advised in general to discontinue the use of COMP128 \n3).\tUnauthorized access to SIM needs to be countered by platform security methods. The impacts of a compromised SIM/ME or UICC/ME interface on GAA security are similar in 2G GBA and 3G GBA.\n******************NEXT CHANGES************\nL.2\tImpersonation of the BSF to the UE during the run of the Ub protocol \nTo prevent an impersonation attack of the BSF to the UE during the run of the Ub protocol the authentication of the BSF to the UE is improved by protecting the communication with TLS. An attacker succeeds only if he can break both, the certificate-based TLS authentication to the UE and mutual authentication provided by HTTP Digest using a password derived from GSM procedures. One way to break TLS is to compromise the certificate.\n\n\n\n******************END OF CHANGES************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe security of 2G GBA depends on the security of GSM, as explained in Annex L. Due to advances in cracking the GSM encryption algorithms A5/1 (CS domain) and GEA1 (PS domain) since the normative text on 2G GBA in Annex I and the threat analysis in Annex L were written, additional precautions on the UE side seem in order. These precautions consist in additional requirements on the ME that link 2G GBA to changes to TSs 44.006 and 43.020 introduced to counter the advances in cracking the GSM encryption algorithms. This link has so far been missing from the 2G GBA specification.It is proposed to explicitly include the additional requirements on the ME instead of relying only on the assumption that a Rel-12 2G GBA client would be implemented only on a Rel-12 ME because, in practice, application SW and baseband features are often implemented without checking for the consistency of the releases. Furthermore, there was a discussion for different GBA variants on the feasibility of a certain man-in-the-middle attack using a forged certificate obtained from a compromised Certification Authority. It shows that this man-in-the-middle attack also applies to 2G GBA. Measures to protect against it include channel binding. However, due to the relatively low risk of a CA compromise in comparison to the risk of a GSM breach and the backward compatibility issues with older 2G GBA versions, it is questionable whether a change to the Ub interface of 2G GBA could be justified.  We therefore propose to leave it unchanged. For more explanation, cf. the discussion paper in S3-130369.\n\n>>> SUMMARY OF CHANGE\nReferences are added. UE requirements are added providing the link to TSs 44.006 and 43.020. The threat analysis is updated.\n\n>>> CONSEQUENCES IF NOT REVISED\nInsecure usage of 2G GBA due to increased risk of cracking GSM encryption algorithms."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n****************** change  ******************\n5.1.6.8.1\tGeneral\nThe UE shall translate any user indicated emergency number as specified in 3GPP\u00a0TS\u00a022.101\u00a0[1A] to an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" service type as specified in RFC\u00a05031\u00a0[69]. \n\n\n\nA Request-URI of an initial request for a dialog or a standalone transaction, or an unknown method transmitted as part of UE detected emergency call procedures as defined in subclause\u00a05.1.6 shall include one of the following service URNs; \"urn:service:sos\", \"urn:service:sos.ambulance\", \"urn:service:sos.police\", \"urn:service:sos.fire\", \"urn:service:sos.marine\", \"urn:service:sos.mountain\". If the UE can determine the type of emergency service the UE shall include a sub-service type.\nNOTE\u00a01:\tA service URN with a top-level service type of \"sos\" is used only when the user intends to establish an emergency call.\n\nIn the event the UE receives a 380 (Alternative Service) response to an INVITE request the response containing a XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table\u00a07.7AA), the UE shall automatically send an ACK request to the P-CSCF as per normal SIP procedures and terminate the session.\nNOTE\u00a02:\tThe UE can attempt an emergency call setup according to the procedures described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\nNOTE\u00a03:\tEmergency numbers which the UE does not detect, will be treated as a normal call.\n****************** change  ******************\n5.2.10.4\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method - non-emergency registration\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user the P-CSCF shall inspect the Request URI independent of values of possible entries in the received Route header fields for known emergency service identifiers. The P-CSCF shall consider the Request URI of the initial request as an emergency service identifier, if it is an emergency number or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to;\n-\tfor inbound roamers , the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP URI belonging to the user; and\n-\tthe country of roaming partners, if the request originates from a different country then the country of the network to which the P-CSCF belongs to. Access technology specific procedures are described in each access technology specific annex to determine from which country and roaming partner the request was originated. If the country from which the request originates can not be determined all lists are associated.\nIf the P-CSCF detects that the Request-URI of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n0A)\tdetermine the geographic location of the UE. Access technology specific procedures are described in each access technology specific annex:\na)\tif the UE is roaming and the P-CSCF is in the home operator's network,\nI)\tshall reject the request by returning a 380 (Alternative Service) response to the UE;\nII)\tshall assume that the UE supports version 1 of the XML Schema for the IM CN subsystem XML body if support for the 3GPP IMS XML body in the Accept header field is not indicated;\nIII)\tshall include in the 380 (Alternative Service) response:\na)\ta Content-Type header field with the value set to associated MIME type of the 3GPP IMS XML body as described in subclause\u00a07.6.1, and\nb)\ta P-Asserted-Identity header field set to the value of the SIP URI of the P-CSCF included in the Path header field during the registration of the user whose UE sent the request causing this response; and\n\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"emergency\" (see table\u00a07.7AA) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table\u00a07.7AB) if the P-CSCF is accordingly configured by the operator; and\nb)\tif the UE is roaming and the P-CSCF is in the same network where the UE is roaming, or the UE is not roaming, then the P-CSCF, depending on operator policies, shall either:\nI)\tapply items of bullet a) of bullet 0A); or\nII)\tcontinue with the next steps; and\nNOTE\u00a01:\tRoaming is when a UE is in a geographic area that is outside the serving geographic area of the home IM CN subsystem.\nNOTE\u00a02:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\n1)\tinclude in the Request-URI an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69], if necessary, and execute the procedure described in step 2, 3, 4, 5, and 6, in subclause\u00a05.2.6.3 dealing with the procedure when the P-CSCF receives an initial request from the UE. If information on the type of emergency service is known include a sub-service type. The entry in the Request-URI that the P-CSCF includes shall be:\n-\tas received from the UE in the Request URI in accordance with RFC\u00a05031\u00a0[69]; or\n-\tas deduced from the Request-URI received from the UE;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE protected server port, for the security association on which the request was received such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-URI; and\n3)\texecute the procedures as specified in subclause\u00a05.2, except for the procedure described in step 3, 4, 5, and 6, in subclause 5.2.6.3 dealing with the procedure when the P-CSCF receives an initial request from the UE, and with the following additions:\na)\tthe P-CSCF shall:\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP URI and if a tel URI belongs to the set of implicitly registered public user identities that contains the SIP URI, add a second P-Asserted-Identity header field that contains the tel URI;\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel URI, add a second P-Asserted-Identity header field that contains a SIP URI belonging to the set of implicitly registered public user identities that contains the tel URI;\niii)\tremove all Route header fields; and\niv)\tselect an E-CSCF and add a Route header field with the URI of the selected E-CSCF.\nNOTE\u00a03:\tIt is implementation dependant as to how the P-CSCF obtains the list of E-CSCFs.\nIf the P-CSCF:\n-\tdoes not receive any response to the initial request for a dialog or standalone transaction or an unknown method (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method, the P-CSCF shall select a different E-CSCF that has not been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), and forward the request. If all E-CSCFs have been tried before for this initial request for the dialog or standalone transaction (including its retransmissions) and if the entry in the Request-URI as received from the UE is not in accordance with RFC\u00a05031\u00a0[69], the P-CSCF shall reject the request by returning a 380 (Alternative Service) response to the UE as described in items\u00a0I), II), III) and IV) within bullet\u00a00A);\n-\treceives:\n1)\tany 4xx response other than a 480 (Temporarily Unavailable) response;\n2)\tany 5xx response; or\n3)\tany 6xx response,\n\tand the entry in the Request-URI as received from the UE is not in accordance with RFC\u00a05031\u00a0[69], then the P-CSCF shall reject this request by returning a 380 (Alternative Service) response to the UE as described withinitems\u00a0I), II), III) and IV) of bullet\u00a00A).\nWhen the P-CSCF receives a target refresh request for a dialog with the Request-URI containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE protected server port related to the GRUU contained in the Request-URI and rewrite the Request-URI with that UE IP address and UE protected server port; and\n-\tperform the steps in subclause\u00a05.2.6.4 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\n****************** change  ******************\n5.2.10.5\tAbnormal cases\nIf the IM CN subsystem to where the P-CSCF belongs to is not capable to handle emergency sessions or due to local policy does not handle emergency sessions or only handles certain type of emergency session request or does not support emergency sessions for either the geographical location of the UE is located or the IP-CAN to which the UE is attached, the P-CSCF shall not forward the request. The P-CSCF:\nI)\tshall respond to the initial request for a dialog or standalone transaction or an unknown method with a 380 (Alternative Service) response;\nII)\tshall assume that the UE supports version 1 of the XML Schema for the IM CN subsystem XML body if support for the 3GPP IMS XML body in the Accept header is not indicated;\nIII)\tshall include in the 380 (Alternative Service) response:\na)\ta Content-Type header field with the value set to associated MIME type of the 3GPP IMS XML body as described in subclause\u00a07.6.1; and\nb)\ta P-Asserted-Identity header field set to the value of the SIP URI of the P-CSCF included in the Path header field during the registration of the user whose UE sent the request causing this response; and\n\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"emergency\" (see table\u00a07.7AA) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table\u00a07.7AB) if the P-CSCF is accordingly configured by the operator.\nNOTE\u00a01:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\nNOTE\u00a02:\tSome networks only allow session requests with a Request-URI containing an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69].\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the I-WLAN IP-CAN and the WLAN IP-CAN, the UE can roam to a country other than the country of the HPLMN, and unless the UE and the access point support 802.11u, the UE is not provided with the emergency numbers valid in the country of the VPLMN.In GPRS and EPS, the national regulator can introduce country specific types of emergency services where type of emergency service cannot be provided in USIM or sent over NAS signalling. According to http://en.wikipedia.org/wiki/Emergency_telephone_number there are country specific types of emergency services already in place. Examples are:- 122 in China is a number for the emergency service for traffic accidents.- 128 in Austria is a number for the emergency service for gas defects.- 156 in Czech republic is a number for emergency service of municipal police (while 158 in Czech republic is a number for the emergency service of the national police).- 114 in Italy is a number for emergency service for child protection.In such cases, when user dials such emergency number, the UE will attempt to establish a normal call, the P-CSCF has the option to: (a) forward the call towards E-CSCF; or (b) to reject the call with 380 (Alternative Service) response which triggers the UE to establish the UE detectable emergency call. In the option (b), as the P-CSCF does not provide the type of the emergency service in 380 (Alternative Service) response and as the UE has no configuration of the emergency numbers and the related types of emergency service, the UE cannot indicate the type of emergency service in Request-URI in the UE detectable emergency call triggered by 380 (Alternative Service) response. The UE can reach only the PSAP serving the urn:service:sos URN.\n\n>>> SUMMARY OF CHANGE\nif the type of emergency service can be deduced from the Request-URI received from the UE, the P-CSCF includes the emergency service URN with sub-service indicating the type of emergeny service in a Contact header field of 380 (Alternative Service) response.the UE copies the service URN from the Contact header field of 380 (Alternative Service) response to the Request-URI of the INVITE request establishing the UE detectable emergency callIn Rel-10, Rel-11 and Rel-12 mirrors, modification of subclause 5.2.10.4 is not needed due to the state of the Rel-10, Rel-11 and Rel-12 baselines.In Rel-11 and Rel-12 mirrors, further modification is needed in subclause 5.1.2A.1.1 to remove prohibition of recursion since the proposed procedures are recursion according to the RFC3261 definition:      Recursion: A client recurses on a 3xx response when it generates a         new request to one or more of the URIs in the Contact header         field in the response.\n\n>>> CONSEQUENCES IF NOT REVISED\nWhen the UE initiates a UE non detectable emergency call, the dialled digits indicate a type of emergency service other than the default, and if the P-CSCF decides to reject the call with 380 response (e.g. since the UE roams and the P-CSCF is in the home network or (since Rel-9) the PLMN wishes to be able to perform emergency SRVCC), then the emergency call is routed to incorrect PSAP. Instead of reaching the PSAP serving the type of emergency service indicated by the dialled digits, the default PSAP is reached. As result:- the regulatory requirements are not fulfilled.- there is additional delay since the operator of the default PSAP needs to determine the requested type of emergency service by discussion with the caller (since the type of emergency service indicated by the dialled digits was lost).- possible failure of emergency call as the traffic model of the default PSAP does not necessarily expect receiving such misrouted emergency calls since this errorneous routing does not happen in CS domain."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st CHANGE\n6.3.1.6\tProcedures with release of PDN connection\nThis clause defines interactions between the CP and UP function during the following procedures:\n-\tUE-initiated Detach procedure for E-UTRAN (TS\u00a023.401\u00a0[2] clause\u00a05.3.8.2.1)\n-\tUE-initiated Detach procedure for GERAN/UTRAN with ISR activated (TS\u00a023.401\u00a0[2] clause\u00a05.3.8.2.2)\n-\tMME-initiated Detach procedure (TS\u00a023.401\u00a0[2] clause\u00a05.3.8.3)\n-\tSGSN-initiated Detach procedure with ISR activated (TS\u00a023.401\u00a0[2] clause\u00a05.3.8.3A)\n-\tHSS-initiated Detach procedure (TS\u00a023.401\u00a0[2] clause\u00a05.3.8.4)\n-\tUE or MME requested PDN disconnection (TS\u00a023.401\u00a0[2] clause\u00a05.10.3)\nDuring the above procedures following is the nature of interactions between the CP and UP function:\n-\tThe SGW-C terminates the Sx session at the SGW-U.\n-\tThe PGW-C terminates the Sx session at the PGW-U.\n\nFigure 6.3.1.6-1: Interaction between CP and UP function during release of PDN connection\n1.\tProcedure as listed in this step\u00a0is initiated as specified in the relevant clauses of this specification. The relevant steps of the procedure as specified in the figure above are executed.\n2.\tThe SGW-C sends an Sx Session Termination Request to the SGW-U.\n3.\tThe SGW-U sends an Sx Session Termination Response to the SGW-C confirming the successful termination of the Sx session. Additionally, if the usage reporting is configured by the SGW-C (as specified in clause\u00a05.3.2) the SGW-U shall provide the usage report(s) for the PDN connection (as specified in clause\u00a05.3.3) to the SGW-C.\n4.\tThe relevant steps of the procedure as specified in the figure above are executed.\n5.\tThe PGW-C sends an Sx Session Termination Request to the PGW-U.\n6.\tThe PGW-U sends an Sx Session Termination Response to the PGW-C confirming the successful termination of the Sx session. Additionally, if the usage reporting is configured by the PGW-C (as specified in clause\u00a05.3.2) the PGW-U shall provide the usage report(s) for the PDN connection (as specified in clause\u00a05.3.3) to the PGW-C.\n7.\tThe relevant steps of the procedure as specified in the figure above are executed.\n\n\n2nd CHANGE\n6.3.1.7\tProcedures with modification of bearer\nThis clause defines interactions between the CP and UP function during the following procedures:\n-\tDedicated bearer activation (TS\u00a023.401\u00a0[2] clause\u00a05.4.1)\n-\tPDN GW initiated bearer modification with bearer QoS update (TS\u00a023.401\u00a0[2] clause\u00a05.4.2.1)\n-\tPDN GW initiated bearer modification without bearer QoS update (TS\u00a023.401\u00a0[2] clause\u00a05.4.3)\n-\tPDN GW initiated bearer deactivation (TS\u00a023.401\u00a0[2] clause\u00a05.4.4.1)\n\n\nNOTE\u00a01:\tInteractions between CP and UP during \"HSS Initiated Subscribed QoS Modification\" (3GPP\u00a0TS\u00a023.401\u00a0[2] clause 5.4.2.2) and \"MME Initiated Dedicated Bearer Deactivation\" (3GPP\u00a0TS\u00a023.401\u00a0[2] clause 5.4.4.2) procedures are also covered as part of the above procedures.\nDuring the above procedures following is the nature of interactions between the CP and UP function:\n-\tThe PGW-C modifies the Sx session at the PGW-U.\n-\tThe SGW-C modifies the Sx session at the SGW-U.\n\n\nFigure 6.3.1.7-1: Interaction between CP and UP function during modification of bearer\n1.\tProcedure as listed in this step\u00a0is initiated as specified in the relevant clauses of this specification. The relevant steps of the procedure as specified in the figure above are executed.\n2.\tThe PGW-C sends an Sx Session Modification Request to the PGW-U.\n3.\tThe PGW-U sends an Sx Session Modification Response to the PGW-C confirming the successful modification of the Sx session.\n4.\tThe relevant steps of the procedure as specified in the figure above are executed.\n5.\tThe SGW-C sends an Sx Session Modification Request to the SGW-U.\n6.\tThe SGW-U sends an Sx Session Modification Response to the SGW-C confirming the successful modification of the Sx session.\n7.\tThe relevant steps of the procedure as specified in the figure above are executed.\nNOTE\u00a02:\tThe following steps apply only for the dedicated bearer activation procedure (TS\u00a023.401\u00a0[2], clause\u00a05.4.1) .\n8.\tThe SGW-C sends an Sx Session Modification Request to the SGW-U. The SGW-C shall include the F-TEIDu of the activated bearer received from the eNodeB.\n9.\tThe SGW-U sends an Sx Session Modification Response to the SGW-C confirming the successful modification of the Sx session.\n10.\tThe relevant steps of the procedure as specified in the figure above are executed.\n11.\tThe PGW-C sends an Sx Session Modification Request to the PGW-U. The PGW-C shall include the F-TEIDu of the activated bearer received from the SGW.\n12.\tThe PGW-U sends an Sx Session Modification Response to the PGW-C confirming the successful modification of the Sx session.\n\nEND of CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs discussed in discussion paper S2-175806, Sx session procedures embedded to procedrues specified in TS 23.401 may indicate PDR removal, e.g. PDN-GW initiated bearer deactivation or QER update, e.g. bearer modification with QoS update. If the UPF removes the PDR immeidately indicated by the CPF, it may send error indication message to the sender node. The amount of error indication message maybe high so that it\u2019s a big issue for UPF implementation.It is proposed to apply solution 2 described in S2-175806, which is a two-time interactions between CPF and UPF.Another scenario is when PGW initiated bearer modification with QoS update, core network nodes should only apply the updated QoS parameters after eNodeB accept the update. Thirdly, there are two missing procedures in TS 23.401 not captured in TS 23.214. It is propsoed to add it in TS 23.214.\n\n>>> SUMMARY OF CHANGE\nCPF executes two-time interactions with UPF in case of PGW initiated bearer deactivation.Sx session providing updated QoS parameters should happen after eNodeB accept the updated QoS.Add two procedures from TS 23.401 into TS 23.214.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf the UPF removes the PDR immeidately indicated by the CPF, it will send error indication to the sender node. The amount of error indication message maybe high so that it\u2019s a big issue for UPF implementation.RAN may reject the updated QoS request, thus core network nodes will handle this case, e.g. inform UPF not to apply the updated QoS parameters.Procedure of \u201cHSS Initiated Subscribed QoS Modification\u201d and \u201cMME initiated dedicate bearer deactivation\u201d is missing in TS 23.214."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * * First Change * * * *\n4.4.2.1\tGeneral\nThe security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP\u00a0TS\u00a033.401\u00a0[19].\nBefore security can be activated, the MME and the UE need to establish an EPS security context. Usually, the EPS security context is created as the result of an EPS authentication procedure between MME and UE. Alternatively, during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode.\nThe EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context. This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.\nThe key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. When the EPS security context is a native EPS security context, the eKSI has the value of KSIASME, and when the current EPS security context is of type mapped, the eKSI has the value of KSISGSN.\nThe eKSI indicates the EPS security context which can be taken into use to establish the secure exchange of NAS messages at the next establishment of a NAS signalling connection without executing a new EPS authentication procedure (see subclause\u00a04.4.2.3).To this purpose the initial NAS messages (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST and EXTENDED SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message.\nIn the present document, when the UE is required to delete an eKSI, the UE shall set the eKSI to the value \"no key is available\" and consider also the associated keys KASME or K'ASME , EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid).\nNOTE:\tIn some specifications the term ciphering key sequence number might be used instead of the term Key Set Identifier (KSI).\nThe UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since:\n-\tafter an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non-current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and\n-\tafter an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.\nThe number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements:\n-\tAfter a successful EPS (re-)authentication, which creates a new partial native EPS security context, the MME and the UE shall delete the non-current EPS security context, if any.\n-\tWhen a partial native EPS security context is taken into use through a security mode control procedure, the MME and the UE shall delete the previously current EPS security context.\n-\tWhen a new mapped EPS security context is taken into use during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall not delete the previously current native EPS security context, if any. Instead, the previously current native EPS security context shall become a non-current native EPS security context, and the MME and the UE shall delete any partial native EPS security context.\n\tIf no previously current native EPS security context exists, the MME and the UE shall not delete the partial native EPS security context, if any.\n-\tWhen the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall delete any existing current mapped EPS security context.\n-\tWhen a non-current full native EPS security context is taken into use by a security mode control procedure, then the MME and the UE shall delete the previously current mapped EPS security context.\n-\tWhen the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the non-current EPS security context shall become the current EPS security context. Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context.\nAt state transition to EMM-DEREGISTERED, the UE shall store the current native EPS security context, if any, as specified in annex\u00a0C.\n* * * * Next Change * * * *\n5.5.1.2.2\tAttach procedure initiation\nIn state EMM-DEREGISTERED, the UE initiates the attach procedure by sending an ATTACH REQUEST message to the MME, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure\u00a05.5.1.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. \nIf the UE supports neither A/Gb mode nor Iu mode, the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message as follows:\n-\tThe UE shall include in the ATTACH REQUEST message a valid GUTI together with the last visited registered TAI, if available. If there is no valid GUTI available, the UE shall include the IMSI in the ATTACH REQUEST message.\nIf the UE supports A/Gb mode or Iu mode, the UE shall handle the EPS mobile identity as follows:\n-\tIf the TIN indicates \"P-TMSI\" and the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE. If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.\nNOTE:\tThe mapping of the P-TMSI and the RAI to the GUTI is specified in 3GPP\u00a0TS\u00a023.003\u00a0[2].\n-\tIf the TIN indicates \"GUTI\" or \"RAT-related TMSI\" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE.\n-\tIf the TIN is deleted and \n-\tthe UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE; or\n-\totherwise, if the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE. If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE.\n-\tOtherwise the UE shall include the IMSI in the EPS mobile identity IE.\nIf the UE is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.\nThe UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container information element to request PDN connectivity.\nIf UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameter to the network, the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message.\nIf a valid NAS security context exists, the UE shall integrity protect the ATTACH REQUEST message combined with the PDN CONNECTIVITY REQUEST message. When the UE does not have a valid NAS security context, the ATTACH REQUEST message combined with the PDN CONNECTIVITY REQUEST message is not integrity protected.\n\nFigure 5.5.1.2.2.1: Attach procedure and combined attach procedure\n* * * * Next Change * * * *\n9.9.3.21\tNAS key set identifier\nThe NAS key set identifier is allocated by the network.\nThe NAS key set identifier information element is coded as shown in figure\u00a09.9.3.21.1 and table\u00a09.9.3.21.1.\nThe NAS key set identifier is a type 1 information element.\n\n8\t7\t6\t5\t4\t3\t2\t1\nNAS key set identifier IEI\tTSC\t\tNAS key set identifier\toctet 1\n\nFigure 9.9.3.21.1: NAS key set identifier information element\nTable 9.9.3.21.1: NAS key set identifier information element\nType of security context flag (TSC) (octet 1)\n\nBit\n4\n0\t\t\tnative security context (for KSIASME)\n1\t\t\tmapped security context (for KSISGSN)\n\nTSC does not apply for NAS key set identifier value \"111\".\n\nNAS key set identifier (octet 1)\n\nBits\n3\t2\t1\n\n0\t0\t0\nthrough\tpossible values for the NAS key set identifier\n1\t1\t0\n\n1\t1\t1\n\n* * * * End of Change * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs specified in TS 33.401 subclause 6.3 that:\"\u2026Seven values are used to identify the key set. A value of '111' is used by the UE to indicate that a valid KASME is not available for use \u2026 The value '111' in the other direction from network to mobile station is reserved.\"An eKSI is mandatory in the initial NAS messages (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST and EXTENDED SERVICE REQUEST). If the UE does not have a current EPS NAS security context, the UE shall set the eKSI to the value \"111\" (no key is available) in these initial NAS messages to indicate the UE has no keys available. However, it is not described in 24.301 how the eKSI value for \"no key is available\" is set in the initial NAS messages (except for TAU procedure in subclause 5.5.3.2.2).Furthermore, The value \"111\" (no key is available) for eKSI in the direction from network to mobile station is reserved, which is also specified in TS 33.401.\n\n>>> SUMMARY OF CHANGE\nIf there is no current EPS NAS security context available, the UE shall set the eKSI to the value \"no key is available\" in the initial NAS messages.The value \"111\" (no key is available) for eKSI in the direction from network to mobile station is reserved.\n\n>>> CONSEQUENCES IF NOT REVISED\nWhen there is no current EPS NAS security context available for a UE, the value setting for the eKSI is unknown for the UE. This is not aligned with the SA3 on security and may result in some security issues."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n5.4.1.2.2.3\tUE successfully authenticates network\nIf a USIM is present and the SNN check is successful, the UE shall handle the EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40]. The USIM shall derive CK and IK and compute the authentication response (RES) using the 5G authentication challenge data received from the ME, and pass RES to the ME. The ME shall derive CK' and IK' from CK and IK, and EMSK from CK' and IK'. Furthermore, the ME may generate KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA received together with the EAP-request/AKA'-challenge message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request/AKA'-challenge message in subclause\u00a05.4.1.2.4.2 in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context, and shall send an EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nIf the EAP-request/AKA'-challenge message contains AT_RESULT_IND attribute, the UE may include AT_RESULT_IND attribute in the EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\n\n***** Next change *****\n5.4.1.2.2.8\tUE handling EAP-success message\nUpon receiving an EAP-success message, if the ME has not generated a partial native 5G NAS security context as described in subclause\u00a05.4.1.2.2.3, the ME shall:\na)\tgenerate the KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]; \nb)\tcreate a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; and\nc)\tstore the KAMF in the created partial native 5G NAS security context.\nThe UE shall consider the procedure complete.\n\n***** Next change *****\n5.4.1.2.3.1\tGeneral\nThe UE may support acting as EAP-TLS peer as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AUSF may support acting as EAP-TLS server as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe EAP-TLS enables mutual authentication of the UE and the network.\nWhen initiating an EAP based primary authentication and key agreement procedure using EAP-TLS, the network shall select an ngKSI value. If an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall select a different ngKSI value. The network shall send the selected ngKSI value to the UE along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the UE along with the EAP-request message and EAP-success message.\nWhen the EAP based primary authentication and key agreement procedure uses EAP-TLS, the ME and the AUSF shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen handling of an EAP-request message results into generation of EMSK, the ME may generate the KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA received together with the EAP-request message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause\u00a05.4.1.2.4.2, in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context.\nWhen handling of an EAP response message results into generation of EMSK, the AUSF shall generate the KAUSF from the EMSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a01:\tThe AUSF provides the KSEAF to the SEAF. Upon reception of the KSEAF, the SEAF generates the KAMF based on the ABBA and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI, and stores the KAMF in the created partial native 5G NAS security context.\nIf the UE does not accept the server certificate of the network, the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the UE shall stop timer T3520, if running, and then process the EAP-request message as normally.\nIf the network does not accept the client certificate of the UE, the network handling depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the UE and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful the EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nDepending on local requirements or operator preference for emergency services, if the UE initiates a registration procedure with 5GS registration type IE set to \"emergency registration\" and the AMF is configured to allow emergency registration without user identity, the AMF needs not follow the procedures specified for transporting the EAP-failure message in the AUTHENTICATION REJECT message of the EAP result message transport procedure in the present subclause. The AMF may include the EAP-failure message in a response of the current 5GMM specific procedure or in the AUTHENTICATION RESULT of the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message:\na)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n1)\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of PLMN, the USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed;\n\tIn case of SNPN, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated;\n2)\tthe UE shall set:\ni)\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events, the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events, and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or \nii)\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN; \nNOTE\u00a02:\tThe term \"non-3GPP access\" used in the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events, is used to express access to SNPN services via a PLMN.\n\tto UE implementation-specific maximum value; and\n3)\tif the UE is operating in single-registration mode, the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nb)\tif the AUTHENTICATION REJECT message is received without integrity protection, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). Additionally, the UE shall:\n1)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"SIM/USIM considered invalid for GPRS services\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-a) of subclause\u00a05.3.20.2 (if the UE is not SNPN enabled or is not operating in SNPN access mode) or list item a) 1) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access mode) for the case that the 5GMM cause value received is #3; \n2)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-b) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access mode) or list item a)-2) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access mode) for the case that the 5GMM cause value received is #3; or\n3)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access: \nA)\tthe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services via 3GPP access and invalid for non-EPS service until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, the UE shall consider the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access until the UE is switched off or the entry is updated;\nB)\tthe UE shall set:\n-\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events  and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value; and\nC)\tIf the UE is operating in single-registration mode, the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access: \nA)\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. In case of PLMN, the USIM shall be considered invalid for 5GS services via non-3GPP access until switching off the UE or the UICC containing the USIM is removed. In case of SNPN, the UE shall consider the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access until the UE is switched off or the entry is updated; and\nB)\tthe UE shall set the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN to UE implementation-specific maximum value.\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message, if the ME has not generated a partial native 5G NAS security context when handling the EAP-request message which resulted into generation of EMSK as described above , the ME shall generate the KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], shall create a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME, and shall store the KAMF in the created partial native 5G NAS security context.\nThe UE shall consider the procedure complete.\nUpon receiving an EAP-failure message, the UE shall delete the partial native 5G NAS security context if any was created when handling the EAP-request message which resulted into generation of EMSK as described above.\nThe UE shall consider the procedure complete.\n\n***** Next change *****\n5.4.1.2.3A.1\tGeneral\nThis subclause applies when an EAP method:\na)\tsupporting mutual authentication;\nb)\tsupporting EMSK generation; and\nc)\tother than EAP-AKA' and EAP-TLS;\nis used for primary authentication and key agreement in an SNPN.\nThe UE may support acting as EAP peer of such EAP method as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AUSF may support acting as EAP server of such EAP method as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen initiating an EAP based primary authentication and key agreement procedure using such EAP method, the network shall select an ngKSI value. If an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall select a different ngKSI value. The network shall send the selected ngKSI value to the UE along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the UE along with the EAP-request message and EAP-success message.\nWhen the EAP based primary authentication and key agreement procedure uses such EAP method, the ME and the AUSF shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen handling of an EAP-request message results into generation of EMSK, the ME may generate the KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA received together with the EAP-request message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause\u00a05.4.1.2.4.2, in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context.\nWhen handling of an EAP response message results into generation of EMSK, the AUSF shall generate the KAUSF from the EMSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a01:\tThe AUSF provides the KSEAF to the SEAF. Upon reception of the KSEAF, the SEAF generates the KAMF based on the ABBA and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI, and stores the KAMF in the created partial native 5G NAS security context.\nIf the UE fails to authenticate the network, the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the UE shall stop timer T3520, if running, and then process the EAP-request message as normally.\nIf the network fails to authenticate the UE, the network handling depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the UE and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful the EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message:\na)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n1)\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated; and\n2)\tthe UE shall set the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN to UE implementation-specific maximum value; and\nNOTE\u00a02:\tThe term \"non-3GPP access\" used in the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events, is used to express access to SNPN services via a PLMN.\nb)\tif the AUTHENTICATION REJECT message is received without integrity protection, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). Additionally, the UE shall:\n1)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events has a value less than a UE implementation-specific maximum value, proceed as specified in list item a) 1) of subclause\u00a05.3.20.3 for the case that the 5GMM cause value received is #3;\n2)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events has a value less than a UE implementation-specific maximum value, proceed as specified in list item a)-2) of subclause\u00a05.3.20.3 for the case that the 5GMM cause value received is #3; or\n3)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access: \n-\tthe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access until the UE is switched off or the entry is updated; and\n-\tthe UE shall set the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events to UE implementation-specific maximum value; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access:\n-\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access until the UE is switched off or the entry is updated; and\n-\tthe UE shall set the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value. \nNOTE\u00a03:\tThe AUTHENTICATION REJECT message \"received over non-3GPP access\" in this subclause refers to an AUTHENTICATION REJECT message received via a PLMN when the UE attempts to access SNPN services via a PLMN.\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message, if the ME has not generated a partial native 5G NAS security context when handling the EAP-request message which resulted into generation of EMSK as described above , the ME shall generate the KAUSF from the EMSK, the KSEAF from the KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], shall create a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME, and shall store the KAMF in the created partial native 5G NAS security context.\nThe UE shall consider the procedure complete.\nUpon receiving an EAP-failure message, the UE shall delete the partial native 5G NAS security context if any was created when handling the EAP-request message which resulted into generation of EMSK as described above .\nThe UE shall consider the procedure complete.\n\n***** Next change *****\n5.4.1.3.1\tGeneral\nThe purpose of the 5G AKA based primary authentication and key agreement procedure is to provide mutual authentication between the UE and the network and to agree on the keys KAUSF, KSEAF and KAMF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The cases when the 5G AKA based primary authentication and key agreement procedure is used are defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe network initiates the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REQUEST message to the UE without the EAP message IE. The network shall include the ngKSI and the ABBA in AUTHENTICATION REQUEST message.\nThe 5G AKA based primary authentication and key agreement procedure is always initiated and controlled by the network. However, the UE can reject the 5G authentication challenge sent by the network.\nThe UE shall proceed with a 5G authentication challenge only if a USIM is present.\nA partial native 5G NAS security context is established in the UE and the network when a 5G authentication is successfully performed. During a successful 5G AKA based primary authentication and key agreement procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute a new key, KAMF. KAMF is stored in the 5G NAS security contexts (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) of both the network and in the volatile memory of the ME while registered to the network, and is the root for the 5GS integrity protection and ciphering key hierarchy.\nThe 5G AKA based primary authentication and key agreement procedure is initiated by an AUTHENTICATION REQUEST message without the EAP message IE.\n\n***** Next change *****\n5.4.1.3.3\tAuthentication response by the UE\nThe UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in subclause\u00a05.4.1.3.6 and 5.4.1.3.7 case l, the UE shall process the 5G authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.\nUpon a successful 5G authentication challenge, the UE shall determine the PLMN identity to be used for the calculation of the new KAMF from the 5G authentication challenge data according to the following rules:\na)\tWhen the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and\nb)\tAfter handover or inter-system change to N1 mode in 5GMM-CONNECTED mode,\n1)\tif the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;\n2)\tif the target cell is a shared network cell and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI; and\n3)\tif the target cell is a shared network cell and the UE has a valid 4G-GUTI, but not a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 4G-GUTI.\nUpon a successful 5G authentication challenge, the new KAMF calculated from the 5G authentication challenge data shall be stored in a new 5G NAS security context in the volatile memory of the ME.\nThe USIM will compute the authentication response (RES) using the 5G authentication challenge data received from the ME, and pass RES to the ME. From the RES, RES* is then generated according to Annex A of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nIn order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES*, in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES*. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES* with the new ones and start, or reset and restart timer T3516.\nThe RAND and RES* values stored in the ME shall be deleted and timer T3516, if running, shall be stopped:\na)\tupon receipt of a\n1)\tSECURITY MODE COMMAND message,\n2)\tSERVICE REJECT message,\n3)\tREGISTRATION REJECT message,\n4)\tREGISTRATION ACCEPT message,\n5)\tAUTHENTICATION REJECT message, or\n6)\tSERVICE ACCEPT message;\nb)\tupon expiry of timer T3516;\nc)\tif the UE enters the 5GMM state 5GMM-DEREGISTERED or 5GMM-NULL; or\nd)\tif the UE enters 5GMM-IDLE mode.\n\n***** Next change *****\n5.4.5.3.3\tNetwork-initiated NAS transport of messages\nUpon reception of a DL NAS TRANSPORT message, the UE shall stop the timer T3346 if running.\nUpon reception of a DL NAS TRANSPORT message, if the Payload container type IE is set to:\na)\t\"N1 SM information\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the 5GSM message in the Payload container IE and the PDU session ID are handled in the 5GSM procedures specified in clause\u00a06;\nb)\t\"SMS\", the UE shall forward the content of the Payload container IE to the SMS stack entity;\nc)\t\"LTE Positioning Protocol (LPP) message container\", the UE shall forward the payload container type, the content of the Payload container IE and the routing information included in the Additional information IE to the upper layer location services application;\nd)\t\"SOR transparent container\" and if the Payload container IE:\n1)\tsuccessfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates a list of preferred PLMN/access technology combinations is provided and the list type indicates:\ni)\t\"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nii)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\n2)\tdoes not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\ne)\tVoid;\nf)\tVoid;\ng)\t\"N1 SM information\" and:\n1)\tthe 5GMM cause IE is set to the 5GMM cause #22 \"Congestion\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n2)\tthe 5GMM cause IE is set to the 5GMM cause #28 \"Restricted service area\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to service area restrictions along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, enters the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE and, if the DL NAS TRANSPORT message is received over 3GPP access, performs the registration procedure for mobility and periodic registration update (see subclauses\u00a05.3.5 and 5.5.1.3);\n3)\tthe 5GMM cause IE is set to the 5GMM cause #65 \"maximum number of PDU sessions reached\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the PLMN's maximum number of PDU sessions has been reached, along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message;\n4)\tthe 5GMM cause IE is set to the 5GMM cause #67 \"insufficient resources for specific slice and DNN\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI and DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n5)\tthe 5GMM cause IE is set to the 5GMM cause #69 \"insufficient resources for specific slice\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI only based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n6)\tthe 5GMM cause IE is set to the 5GMM cause #90 \"payload was not forwarded\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to routing failure along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message;\n7)\tthe 5GMM cause IE is set to the 5GMM cause #91 \"DNN not supported or not subscribed in the slice\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the DNN is not supported or not subscribed in a slice along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message;\n8)\tthe 5GMM cause IE is set to the 5GMM cause #92 \"insufficient user-plane resources for the PDU session\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to insufficient user-plane resources along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message.\nh)\t\"UE policy container\", the UE policy container in the Payload container IE is handled in the UE policy delivery procedures specified in Annex\u00a0D;\ni)\t\"UE parameters update transparent container\" and if the Payload container IE\n1)\tsuccessfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\ni)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", \nA)\tthe ME shall behave as if an SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of UE parameters update transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A]; and\nB)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and if the ME receives status bytes from the UICC indicating that the UICC has received the secured packet successfully, the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2; and\nC)\tif the ME receives a REFRESH command from the UICC as specified in 3GPP\u00a0TS\u00a031.111\u00a0[22A] and if the REG bit of the UE parameters update header in the UE parameters update transparent container IE is set to \"re-registration requested\", and:\nC1)\tthe UE is registered over 3GPP access, then the UE shall wait until it enters 5GMM-IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication, and then perform a de-registration procedure, delete its 5G-GUTI and initiate a registration procedure for initial registration as specified in subclause\u00a05.5.1.2;\nC2)\tthe UE is registered over non-3GPP access and does not have emergency services ongoing over non-3GPP access, then the UE shall locally release the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure, delete its 5G-GUTI if the UE is registered to different PLMN on 3GPP access or the UE is not registered over 3GPP access, and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; and\nC3)\tthe UE is registered over non-3GPP access and has an emergency services ongoing over non-3GPP access, then the UE shall wait until the emergency services are completed before locally releasing the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure, delete its 5G-GUTI if the UE is registered to different PLMN on 3GPP access or if the UE is not registered over 3GPP access, and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2.\nii)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"Default configured NSSAI update data\",\nA)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and if the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2\nB)\tthe ME shall replace the stored default configured NSSAI with the default configured NSSAI included in the default configured NSSAI update data; and\nC)\tif the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the UE used the old default configured NSSAI to create the requested NSSAI in a REGISTRATION REQUEST message, the UE does not have a configured NSSAI for the current PLMN and the UE has an allowed NSSAI for the current PLMN which contains one or more S-NSSAIs that are not included in the new default configured NSSAI, the UE shall wait until it enters 5GMM-IDLE mode and then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3; and\n2)\tdoes not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall discard the content of the payload container IE;\nj)\t\"Location services message container\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the UE shall forward the payload container type, the content of the Payload container IE and the routing information in the Additional information IE if included to the upper layer location services application;\nk)\t\"CIoT user data container\", the UE shall forward the content of the Payload container IE and the PDU session ID to the 5GSM sublayer; and\nl)\t\"CIoT user data container\" and:\n1)\tthe 5GMM cause IE is set to the 5GMM cause #22 \"Congestion\", the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to DNN based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE.\n2)\tthe 5GMM cause IE is set to the 5GMM cause #90 \"payload was not forwarded\", the UE passes to the 5GSM sublayer an indication that the user data container was not forwarded due to routing failure along with the user data container from the Payload container IE and the PDU session ID from the PDU session ID IE of the DL NAS TRANSPORT message.\nm)\t\"Multiple payloads\", the UE shall first decode the content of the Payload container IE (see subclause\u00a09.11.3.39) to obtain the number of payload container entries and for each payload container entry, the UE shall:\n1)\tdecode the payload container type field;\n2)\tdecode the optional IE fields and the payload container contents field in the payload container entry; and\n3)\thandle the content of each payload container entry the same as the content of the Payload container IE and the associated optional IEs as specified in bullets a) to l) above according to the payload container type field.\n\n***** Next change *****\n5.5.1.2.4\tInitial registration accepted by the network\nDuring a registration procedure with 5GS registration type IE set to \"emergency registration\", the AMF shall not check for mobility and access restrictions, regional restrictions or subscription restrictions, or CAG restrictions when processing the REGISTRATION REQUEST message.\nIf the initial registration request is accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe AMF shall assign and include a TAI list as a registration area the UE is registered to in the REGISTRATION ACCEPT message. The AMF shall not assign a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If the REGISTRATION REQUEST message was received over non-3GPP access, the AMF shall include only the N3GPP TAI in the TAI list.\nNOTE\u00a02:\tThe N3GPP TAI is operator-specific.\nNOTE\u00a03:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may include service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with the service area restrictions shall act as described in subclause\u00a05.3.5.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the initial registration procedure is not for emergency services, the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause\u00a05.3.13A. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the initial registration procedure is not for emergency services, and if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s).\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nIf the REGISTRATION REQUEST message contains the LADN indication IE, based on the LADN indication IE, UE subscription information, UE location and local configuration about LADN and:\n-\tif the LADN indication IE includes requested LADN DNNs, the UE subscribed DNN list includes the requested LADN DNNs or the wildcard DNN, and the LADN service area of the requested LADN DNN has an intersection with the current registration area, the AMF shall determine the requested LADN DNNs included in the LADN indication IE as LADN DNNs for the UE;\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is included in the UE subscribed DNN list, the AMF shall determine the LADN DNN(s) configured in the AMF whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE; or\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is not included in the UE subscribed DNN list, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE.\nIf the LADN indication IE is not included in the REGISTRATION REQUEST message, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose service area has an intersection with the current registration area as LADN DNNs for the UE, except for the wildcard DNN included in the UE subscribed DNN list.\nIf the UE supports WUS assistance information and the AMF supports and accepts the use of WUS assistance information for the UE, then the AMF shall determine the negotiated UE paging probability information for the UE, store it in the 5GMM context of the UE, and if the UE is not performing the initial registration for emergency services, the AMF shall include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.\nNOTE\u00a04:\tBesides the UE paging probability information requested by the UE, the AMF can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE. \nThe AMF shall include the LADN information which consists of the determined LADN DNNs for the UE and LADN service area(s) available in the current registration area in the LADN information IE of the REGISTRATION ACCEPT message.\nThe UE, upon receiving the REGISTRATION ACCEPT message with the LADN information, shall store the received LADN information. If there exists one or more LADN DNNs which are included in the LADN indication IE of the REGISTRATION REQUEST message and are not included in the LADN information IE of the REGISTRATION ACCEPT message, the UE considers such LADN DNNs as not available in the current registration area.\nThe 5G-GUTI reallocation shall be part of the initial registration procedure. During the initial registration procedure, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI together with the assigned TAI list.\nIf the UE has set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the AMF needs to update the \"CAG information list\" stored in the UE, the AMF shall include the CAG information list IE in the REGISTRATION ACCEPT message.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE, the Extended emergency number list IE or the CAG information list IE are included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message included an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer indication\" is indicated in the MICO indication IE in the REGISTRATION REQUEST, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE in the REGISTRATION ACCEPT message.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nThe AMF shall include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF shall include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent for the non-3GPP access.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nThe AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message if:\n-\tthe UE has indicated support for service gap control in the REGISTRATION REQUEST message; and\n-\ta service gap time value is available in the 5GMM context.\nIf there is a running T3447 timer in the AMF and the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the flag and proceed as if the flag was not received except for the following cases:\na)\tthe UE is configured for high priority access in the selected PLMN; or \nb)\tthe 5GS registration type IE in the REGISTRATION REQUEST message is set to \"emergency registration\".\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nIf:\n-\tthe UE in NB-N1 mode is using control plane CIoT 5GS optimization; and\n-\tthe network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations;\nthe AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message and set the \"Truncated AMF Set ID value\" and the \"Truncated AMF Pointer value\" in the Truncated 5G-S-TMSI configuration IE based on network policies. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events, if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in the T3512 value IE as periodic registration update timer (T3512).\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active timer (T3324).\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contained a 5G-GUTI, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, stop timer T3519 if running, and delete any stored SUCI. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", or contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information.\nIf the REGISTRATION ACCEPT message contains the CAG information list IE and the UE had set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the UE shall:\na)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE when received in the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN; or\nb)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE when the UE receives the CAG information list IE in a serving PLMN other than the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN.\nNOTE\u00a05:\tWhen the UE receives the CAG information list IE in a serving PLMN other than the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE are ignored.\nThe UE shall store the \"CAG information list\" received in the CAG information list IE as specified in annex\u00a0C.\nIf the received \"CAG information list\" includes an entry containing the identity of the registered PLMN, the UE shall operate as follows:\na)\tif the UE receives the REGISTRATION ACCEPT message via a CAG cell, the entry for the registered PLMN in the received \"CAG information list\" does not include any of the CAG-ID(s) supported by the current CAG cell, and:\n1)\tthe entry for the registered PLMN in the received \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\"; or\n2)\tthe entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\ni)\tif the entry for the registered PLMN in the received \"CAG information list\" includes one or more CAG-IDs, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\nii)\tif the entry for the registered PLMN in the received \"CAG information list\" does not include any CAG-ID and:\nA)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] with the updated \"CAG information list\"; or\nB)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session; or\nb)\tif the UE receives the REGISTRATION ACCEPT message via a non-CAG cell and the entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tif the \"allowed CAG list\" for the registered PLMN in the received \"CAG information list\" includes one or more CAG-IDs, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\n2)\tif the entry for the registered PLMN in the received \"CAG information list\" does not include any CAG-ID and:\ni)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] with the updated \"CAG information list\"; or\nii)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session.\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE, the Extended emergency number list IE or the CAG information list IE , the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions, the extended local emergency numbers list or the \"CAG information list\".\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\", and SMSF selection is successful, then the AMF shall send the REGISTRATION ACCEPT message after the SMSF has confirmed that the activation of the SMS service was successful. When sending the REGISTRATION ACCEPT message, the AMF shall:\na)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS allowed\" in the REGISTRATION ACCEPT message, if the UE has set the SMS requested bit of the 5GS update type IE to \"SMS over NAS supported\" in the REGISTRATION REQUEST message and the network allows the use of SMS over NAS for the UE; and\nb)\tstore the SMSF address and the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context and consider the UE available for SMS over NAS.\nIf:\na)\tthe SMSF selection in the AMF is not successful; \nb)\tthe SMS activation via the SMSF is not successful; \nc)\tthe AMF does not allow the use of SMS over NAS; \nd)\tthe SMS requested bit of the 5GS update type IE was set to \"SMS over NAS not supported\" in the REGISTRATION REQUEST message; or\ne)\tthe 5GS update type IE was not included in the REGISTRATION REQUEST message;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result IE value indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access only; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access;\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access only; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and Non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nThe AMF shall include the allowed NSSAI for the current PLMN and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI from the UE if available, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs in the requested NSSAI.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message. Rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s) with the following restrictions:\na)\trejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not allowed; and\nb)\trejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not allowed.\nNOTE\u00a06:\tThe UE can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, which was included in the previous requested NSSAI but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; otherwise the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\n1)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\n2)\tfor which the network slice-specific authentication and authorization has been successfully performed;\nb)\toptionally, the rejected NSSAI;\nc)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing, if any; and\nd)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate whether network slice-specific authentication and authorization procedure will be performed by the network, if the allowed NSSAI is not included in the REGISTRATION ACCEPT message.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and\nb)\tall subscribed S-NSSAIs marked as default are subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate whether network slice-specific authentication and authorization procedure will be performed by the network; and\nb)\tpending NSSAI containing one or more subscribed S-NSSAIs marked as default for which network slice-specific authentication and authorization will be performed or is ongoing.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and\nb)\tone or more subscribed S-NSSAIs marked as default are not subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tpending NSSAI containing one or more subscribed S-NSSAIs marked as default for which network slice-specific authentication and authorization will be performed or is ongoing, if any;\nb)\tallowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\nc)\tallowed NSSAI containing one or more subscribed S-NSSAIs marked as default, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed.\nWhen the REGISTRATION ACCEPT includes a pending NSSAI, the pending NSSAI shall contain all S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing from the requested NSSAI of the REGISTRATION REQUEST message that was received over the 3GPP access, non-3GPP access, or both the 3GPP access or non-3GPP access.\nThe AMF may include a new configured NSSAI for the current PLMN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include the requested NSSAI;\nb)\tthe REGISTRATION REQUEST message included the requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN;\nc)\tthe REGISTRATION REQUEST message included the requested NSSAI containing S-NSSAI(s) with incorrect mapped S-NSSAI(s); or\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\".\nIf a new configured NSSAI for the current PLMN is included in the REGISTRATION ACCEPT message, the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT message. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe UE receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause 4.6.2.2.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2. \n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.1 and 4.6.2.2.\nIf the UE sets the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization and one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default which are not subject to network slice-specific authentication and authorization are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default which are not subject to network slice-specific authentication and authorization;\n2)\tthe allowed NSSAI containing the subscribed S-NSSAIs marked as default, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; and\n3)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not subject to NSSAA; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the S-NSSAI is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not subject to NSSAA; and\nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nIf the UE does not indicate support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message; or\nb)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nand one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default which are not subject to network slice-specific authentication and authorization are available, the AMF shall:\na)\tput the allowed S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message;\nb)\tput the subscribed S-NSSAIs marked as default and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; and\nc)\tdetermine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN and the registration area as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message:\na)\tincludes the \"NSSAA to be performed\" indicator in the 5GS registration result IE;\nb)\tincludes a pending NSSAI; and\nc)\tdoes not include an allowed NSSAI,\nthe UE shall not initiate a:\na)\t5GSM procedure except for emergency services until the UE receives an allowed NSSAI; and\nb)\tservice request procedure except for cases f) and i) in subclause\u00a05.6.1.1.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting interworking with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 interface not supported\" if the AMF supports N26 interface; or\nb)\t\"interworking without N26 interface supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a07:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the received interworking without N26 interface indicator for interworking with EPS as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback and ATSSS, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. In a UE with LCS capability, location services indicator (5G-LCS) shall be provided to the upper layers. When initiating an emergency call, the upper layers also take the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator into account for the access domain selection. In a UE with the capability for ATSSS, the network support for ATSSS shall be provided to the upper layers.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a08:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based on operator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a09:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nIf the UE is not operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 1 is only applicable while the UE is in N1 mode.\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; and\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode.\nIf the UE is operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects another SNPN. Access identity 1 is only applicable while the UE is in N1 mode.\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; and\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects another SNPN. Access identity 2 is only applicable while the UE is in N1 mode.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and:\na)\tin WB-N1 mode, the AMF decides to restrict the use of CE mode B for the UE, then the AMF shall set the RestrictEC bit to \"CE mode B is restricted\";\nb)\tin WB-N1 mode, the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, then the AMF shall set the RestrictEC bit to \" Both CE mode A and CE mode B are restricted\"; or\nc)\tin NB-N1 mode, the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\",\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nIf the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, and the user's subscription context obtained from the UDM if available.\nIf:\na)\tthe UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, the SOR transparent container IE is not included in the REGISTRATION ACCEPT message or the SOR transparent container IE does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C, then the UE may locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message.\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates list of preferred PLMN/access technology combinations is provided and the list type indicates:\na)\t\"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nb)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, in the current registration area; or\nb)\totherwise:\n1)\tif the UE has NSSAI inclusion mode for the current PLMN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode;\n2)\tif the UE does not have NSSAI inclusion mode for the current PLMN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type;\nii)\tuntrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type; or\niii)\ttrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\n3)\tif the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, and the 5G-RG is performing the registration procedure over wireline access, the 5G-RG shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, then the UE shall store the included truncated 5G-S-TMSI configuration and return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration.\nNOTE\u00a010: The UE provides the truncated 5G-S-TMSI configuration to the lower layers.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN stored at the UE, then the UE shall, after the completion of the ongoing registration procedure, initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2 over the existing N1 NAS signalling connection; and\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\n\n***** Next change *****\n5.5.1.3.4\tMobility and periodic registration update accepted by the network\nIf the registration update request has been accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nIf timer T3513 is running in the AMF, the AMF shall stop timer T3513 if a paging request was sent with the access type indicating non-3GPP and the REGISTRATION REQUEST message includes the Allowed PDU session status IE.\nIf timer T3565 is running in the AMF, the AMF shall stop timer T3565 when a REGISTRATION REQUEST message is received.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe 5G-GUTI reallocation shall be part of the registration procedure for mobility registration update. The 5G-GUTI reallocation should be part of the registration procedure for periodic registration update. During the registration procedure for mobility registration update, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI.\nIf the UE has set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the AMF needs to update the \"CAG information list\" stored in the UE, the AMF shall include the CAG information list IE in the REGISTRATION ACCEPT message.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE or the Extended emergency number list IE or the CAG information list IE are included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF may include a new TAI list for the UE in the REGISTRATION ACCEPT message. The new TAI list shall not contain both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If there is no TAI list received, the UE shall consider the old TAI list as valid.\nNOTE\u00a02:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no emergency PDU session established, the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause\u00a05.3.13A. If the UE is not registered for emergency services and there is an emergency PDU session established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the forbidden PLMN list as specified in subclause\u00a05.3.13A, when the emergency PDU session is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the UE is not registered for emergency services, and if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s).\nThe AMF may include new service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with new service area restrictions shall act as described in subclause\u00a05.3.5.\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message includes an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer supported\" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE and may include the T3512 value IE in the REGISTRATION ACCEPT message. If the timer value received in T3512 IE is different from the already stored value of the timer T3512 and the timer T3512 is running, the UE shall restart T3512 with the new value received in the T3512 value IE.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nIf the UE does not include MICO indication IE in the REGISTRATION REQUEST message, then the AMF shall disable MICO mode if it was already enabled.\nThe AMF may include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF may include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent for the non-3GPP access.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nIf the AMF decides to deactivate the congestion control for transport of user data via the control plane, then the AMF shall delete the stored control plane data back-off time for the UE and the AMF shall not include timer T3448 value IE in the REGISTRATION ACCEPT message.\nIf:\n-\tthe UE in NB-N1 mode is using control plane CIoT 5GS optimization; and\n-\tthe network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations;\nthe AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message and set the \"Truncated AMF Set ID value\" and the \"Truncated AMF Pointer value\" in the Truncated 5G-S-TMSI configuration IE based on network policies. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nFor inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has included a ngKSI indicating a current 5G NAS security context in the REGISTRATION REQUEST message by which the REGISTRATION REQUEST message is integrity protected, the AMF shall take one of the following actions:\na)\tif the AMF retrieves the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall integrity check the REGISTRATION REQUEST message using the current 5G NAS security context and integrity protect the REGISTRATION ACCEPT message using the current 5G NAS security context;\nb)\tif the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall treat the REGISTRATION REQUEST message fails the integrity check and take actions as specified in subclause\u00a04.4.4.3; or\nc)\tif the UE has not included an Additional GUTI IE, the AMF may treat the REGISTRATION REQUEST message as in the previous item, i.e. as if it cannot retrieve the current 5G NAS security context.\nNOTE\u00a03:\tThe handling described above at failure to retrieve the current 5G NAS security context or if no Additional GUTI IE was provided does not preclude the option for the AMF to perform a primary authentication and key agreement procedure and create a new native 5G NAS security context.\nFor inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the AMF shall integrity check REGISTRATION REQUEST message using the current K'AMF as derived when triggering the handover to N1 mode (see subclause\u00a04.4.2.2). The AMF shall verify the received UE security capabilities in the REGISTRATION REQUEST message. The AMF shall then take one of the following actions:\na)\tif the REGISTRATION REQUEST does not contain a valid KSIAMF in the Non-current native NAS key set identifier IE, the AMF shall remove the non-current native 5G NAS security context, if any, for any 5G-GUTI for this UE. The AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K'AMF and take the mapped 5G NAS security context into use; or\nb)\tif the REGISTRATION REQUEST contains a valid KSIAMF in the Non-current native NAS key set identifier IE and:\n1)\tthe AMF decides to take the native 5G NAS security context into use, the AMF shall initiate a security mode control procedure to take the corresponding native 5G NAS security context into use and then integrity protect and cipher the REGISTRATION ACCEPT message using the corresponding native 5G NAS security context; and\n2)\totherwise, the AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K'AMF and take the mapped 5G NAS security context into use.\nNOTE\u00a04:\tIn above bullet b), it is recommended for the AMF to initiate a security mode control procedure to take the corresponding native 5G NAS security context into use.\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter and service request attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\", if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in T3512 value IE as periodic registration update timer (T3512). If the T3512 value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active time timer (T3324). If the REGISTRATION ACCEPT message does not include a T3324 value IE, UE shall not start the timer T3324 until a new value is received from the network.\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer. If non-3GPP de-registration timer value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message. If non-3GPP de-registration timer value IE is not included and there is no stored non-3GPP de-registration timer value in the UE, the UE shall use the default value of the non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contains a 5G-GUTI, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, stop timer T3519 if running, and delete any stored SUCI. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", or contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information.\nIf the REGISTRATION ACCEPT message contains the CAG information list IE and the UE had set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the UE shall:\na)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE when received in the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN;\nb)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE when the UE receives the CAG information list IE in a serving PLMN other than the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN.\nNOTE\u00a04:\tWhen the UE receives the CAG information list IE in a serving PLMN other than the HPLMN, a PLMN equivalent to the HPLMN, or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE are ignored.\nThe UE shall store the \"CAG information list\" received in the CAG information list IE as specified in annex\u00a0C.\nIf the received \"CAG information list\" includes an entry containing the identity of the registered PLMN, the UE shall operate as follows.\na)\tif the UE receives the REGISTRATION ACCEPT message via a CAG cell, the entry for the registered PLMN in the received \"CAG information list\" does not include any of the CAG-ID(s) supported by the current CAG cell, and:\n1)\tthe entry for the registered PLMN in the received \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\"; or\n2)\tthe entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\ni)\tif the entry for the registered PLMN in the received \"CAG information list\" includes one or more CAG-IDs, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\nii)\tif the entry for the registered PLMN in the received \"CAG information list\" does not include any CAG-ID and:\nA)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] with the updated \"CAG information list\"; or\nB)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session; or\nb)\tif the UE receives the REGISTRATION ACCEPT message via a non-CAG cell and the entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tif the \"allowed CAG list\" for the registered PLMN in the received \"CAG information list\" includes one or more CAG-IDs, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\n2)\tif the entry for the registered PLMN in the received \"CAG information list\" does not include any CAG-ID and:\ni)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] with the updated \"CAG information list\"; or\nii)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session.\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE or the Extended emergency number list IE or the CAG information list IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions or the extended local emergency numbers list or the CAG information list IE.\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the UE in 5GMM-IDLE mode initiated the registration procedure for mobility and periodic registration update and the REGISTRATION ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT message, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\" and:\na)\tthe SMSF address is stored in the UE 5GMM context and:\n1)\tthe UE is considered available for SMS over NAS; or\n2)\tthe UE is considered not available for SMS over NAS and the SMSF has confirmed that the activation of the SMS service is successful; or\nb)\tthe SMSF address is not stored in the UE 5GMM context, the SMSF selection is successful and the SMSF has confirmed that the activation of the SMS service is successful;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclause\u00a05.5.1.2.4. If the UE 5GMM context does not contain an SMSF address or the UE is not considered available for SMS over NAS, then the AMF shall:\na)\tstore the SMSF address in the UE 5GMM context if not stored already; and\nb)\tstore the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context and consider the UE available for SMS over NAS.\nIf SMSF selection in the AMF or SMS activation via the SMSF is not successful, or the AMF does not allow the use of SMS over NAS, then the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS not supported\" or the 5GS update type IE was not included in the REGISTRATION REQUEST message, then the AMF shall:\na)\tmark the 5GMM context to indicate that the UE is not available for SMS over NAS; and\nNOTE\u00a05:\tThe AMF can notify the SMSF that the UE is deregistered from SMS over NAS based on local configuration.\nb)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \" UE radio capability update needed\", the AMF shall delete the stored UE radio capability information for NG-RAN or the UE radio capability ID, if any.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result IE value indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access only; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access;\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access only; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and Non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nIf the UE is not currently registered for emergency services and the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to \"Registered for emergency services\", the UE shall consider itself registered for emergency services and shall release locally PDU session(s) not associated with emergency services, if any.\nThe AMF shall include the allowed NSSAI for the current PLMN and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) from the UE if available, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs for the current PLMN in the Requested NSSAI IE or one or more mapped S-NSSAIs in the Requested NSSAI IE or Requested mapped NSSAI IE. The S-NSSAI associated with each of the active PDN connections for which interworking to 5GS is supported, shall be included in the allowed NSSAI if the UE included the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message and the AMF supports N26 interface.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message. Rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s) with the following restrictions:\na)\trejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not allowed; and\nb)\trejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not allowed.\nNOTE\u00a06:\tThe UE can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, which was included in the previous requested NSSAI but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; otherwise the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\ni)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\nii)\tfor which the network slice-specific authentication and authorization has been successfully performed;\nb)\toptionally, the rejected NSSAI;\nc)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing, if any; and\nd)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate whether network slice-specific authentication and authorization procedure will be performed by the network, if the allowed NSSAI is not included in the REGISTRATION ACCEPT message.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and \nb)\tall subscribed S-NSSAIs marked as default are subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include: \na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate whether network slice-specific authentication and authorization procedure will be performed by the network; and\nb)\tpending NSSAI containing one or more subscribed S-NSSAIs marked as default for which network slice-specific authentication and authorization will be performed or is ongoing.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and \nb)\tone or more subscribed S-NSSAIs marked as default are not subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tpending NSSAI containing one or more subscribed S-NSSAIs marked as default for which network slice-specific authentication and authorization will be performed or is ongoing, if any;\nb)\tallowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\nc)\tallowed NSSAI containing one or more subscribed S-NSSAIs marked as default, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed.\nWhen the REGISTRATION ACCEPT includes a pending NSSAI, the pending NSSAI shall contain all S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing from the requested NSSAI of the REGISTRATION REQUEST message that was received over the 3GPP access, non-3GPP access, or both the 3GPP access or non-3GPP access.\nThe AMF may include a new configured NSSAI for the current PLMN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include a requested NSSAI;\nb)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN;\nc)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI with incorrect mapping information to an S-NSSAI of the HPLMN;\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\"; or\ne)\tthe REGISTRATION REQUEST message included the requested mapped NSSAI.\nIf a new configured NSSAI for the current PLMN is included, the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT message. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the S-NSSAI(s) associated with the existing PDU session(s) of the UE is not included in the requested NSSAI of the REGISTRATION REQUEST message, the AMF shall perform a local release of the PDU session(s) associated with the S-NSSAI(s) and shall request the SMF to perform a local release of those PDU session(s).\nThe UE receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause\u00a04.6.2.2.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.1 and 4.6.2.2.\nIf the UE sets the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization and one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default which are not subject to network slice-specific authentication and authorization are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default which are not subject to network slice-specific authentication and authorization;\n2)\tthe allowed NSSAI containing the subscribed S-NSSAIs marked as default, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; and\n3)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not subject to NSSAA; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these mapped S-NSSAIs are not subject to NSSAA; and\nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE does not indicate support for network slice-specific authentication and authorization, and:\na)\tthe UE is not in NB-N1 mode; and\nb)\tif:\n1)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message; or\n2)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nand one or more subscribed S-NSSAIs marked as default which are not subject to network slice-specific authentication and authorization are available, the AMF shall:\na)\tput the allowed S-NSSAI(s) for the current PLMN each of which corresponds to a subscribed S-NSSAI marked as default and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message;\nb)\tput the subscribed S-NSSAIs marked as default and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; and\nc)\tdetermine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"periodic registration updating\"; or\nb)\t\"mobility registration updating\" and the UE is in NB-N1 mode;\nthe AMF may provide a new allowed NSSAI, or a pending NSSAI, or both a new allowed NSSAI and a pending NSSAI to the UE in the REGISTRATION ACCEPT message. Additionally, if only a pending NSSAI and no new allowed NSSAI is provided, the REGISTRATION ACCEPT message shall include the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\" in the 5GS registration result IE of the REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN and the registration area as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs.\nWith respect to each of the PDU session(s) active in the UE, if the allowed NSSAI contains neither:\na)\tan S-NSSAI matching to the S-NSSAI of the PDU session; nor\nb)\ta mapped S-NSSAI matching to the mapped S-NSSAI of the PDU session;\nthe UE shall perform a local release of all such PDU sessions except for an emergency PDU session, if any.\nFor each of the PDU session(s) active in the UE, if the allowed NSSAI contains a mapped S-NSSAI matching to the mapped S-NSSAI of the PDU session, the UE shall locally update the S-NSSAI associated with the PDU session to the corresponding S-NSSAI received in the allowed NSSAI.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message:\na)\tincludes the 5GS \"NSSAA to be performed\" indicator in the 5GS registration result IE;\nb)\tincludes a pending NSSAI; and\nc)\tdoes not include an allowed NSSAI;\nthe UE:\na)\tshall not perform the registration procedure for mobility and registration update with the Uplink data status IE except for emergency services;\nb)\tshall not initiate a service request procedure except for emergency services, for responding to paging or notification over non-3GPP access, for cases f) and i) in subclause\u00a05.6.1.1;\nc)\tshall not initiate a 5GSM procedure except for emergency services, indicating a change of 3GPP PS data off UE status, or to request the release of a PDU session; and\nd)\tshall not initiate the NAS transport procedure to send a CIoT user data container except for sending user data that is related to an exceptional event.\nuntil the UE receives an allowed NSSAI.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"periodic registration updating\"; or\nb)\t\"mobility registration updating\" and the UE is in NB-N1 mode;\nif the REGISTRATION ACCEPT message:\na)\tincludes the 5GS registration result IE with the \"NSSAA to be performed\" indicator not set to \"Network slice-specific authentication and authorization is to be performed\" and the message does not contain an allowed NSSAI, the UE considers the previously received allowed NSSAI as valid; or\nb)\tincludes the 5GS registration result IE with the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\" and the message contains a pending NSSAI, the UE considers the previously received allowed NSSAI as invalid.\nIf the Uplink data status IE is included in the REGISTRATION REQUEST message:\na)\tif the AMF determines that the UE is in non-allowed area or is not in allowed area, and the PDU session(s) indicated by the Uplink data status IE is non-emergency PDU session(s) or the UE is not configured for high priority access in selected PLMN, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session(s) cannot be re-established, and shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\";\nb)\totherwise, the AMF shall:\n1)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU session;\n2)\tinclude PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; and\n3)\tdetermine the UE presence in LADN service area and forward the UE presence in LADN service area towards the SMF, if the corresponding PDU session is a PDU session for LADN.\nIf the Uplink data status IE is not included in the REGISTRATION REQUEST message and the REGISTRATION REQUEST message is sent for the trigger d) in subclause\u00a05.5.1.3.2, the AMF may indicate the SMF to re-establish the user-plane resources for the PDU sessions.\nIf a PDU session status IE is included in the REGISTRATION REQUEST message:\na)\tfor single access PDU sessions, the AMF shall:\n1)\tperform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the REGISTRATION REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE; and\n2)\tinclude a PDU session status IE in the REGISTRATION ACCEPT message to indicate which PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVEin the AMF; and\nb)\tfor MA PDU sessions:\n1)\tfor all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE and have user plane resources established on the access the REGISTRATION REQUEST message is sent over on the AMF side, but are indicated by the UE as no user plane resources established:\ni)\tfor PDU sessions having user plane resources established only on the access the REGISTRATION REQUEST message is sent over, the AMF shall perform a local release of all those PDU sessions; and\nii)\tfor PDU sessions having user plane resources established on both accesses, the AMF shall perform a local release on the user plane resources associated with the access type the REGISTRATION REQUEST message is sent over; and\n2)\tthe AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate which MA PDU sessions having user plane resources established on the AMF side on the access the REGISTRATION ACCEPT message is sent over.\nIf the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, the AMF shall:\na)\tfor a 5GSM message from each SMF that has indicated pending downlink signalling only, forward the received 5GSM message via 3GPP access to the UE after the REGISTRATION ACCEPT message is sent;\nb)\tfor each SMF that has indicated pending downlink data only:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; and\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE.\nc)\tfor each SMF that have indicated pending downlink signalling and data:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE;\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; and\n3)\tdiscard the received 5GSM message for PDU session(s) associated with non-3GPP access; and\nd)\tinclude the PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any.\nIf the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was requested by the UE in the Allowed PDU session status IE, the UE considers the corresponding PDU session to be associated with the 3GPP access. If the user-plane resources of a PDU session have been successfully reactivated over the 3GPP access, the AMF and SMF update the associated access type of the corresponding PDU session.\nIf an EPS bearer context status IE is included in the REGISTRATION REQUEST message, the AMF handles the received EPS bearer context status IE as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the EPS bearer context status information is generated for the UE during the inter-system change from S1 mode to N1 mode as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] and the AMF supports N26 interface, the AMF shall include an EPS bearer context status IE in the REGISTRATION ACCEPT message to indicate the UE which mapped EPS bearer contexts are active in the network.\nIf the user-plane resources cannot be established for a PDU session, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and:\na)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 \"LADN not available\";\nb)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"restricted service area\"\nc)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\"; or\nd)\totherwise, the AMF may include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources.\nNOTE\u00a07:\tIt is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\".\nIf the AMF needs to initiate PDU session status synchronization the AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate the UE:\n-\twhich single access PDU sessions associated with the access the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; and\n-\twhich MA PDU sessions are not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the AMF on the access the REGISTRATION ACCEPT message is sent over.\nThe AMF may include the LADN information IE in the REGISTRATION ACCEPT message as described in subclause\u00a05.5.1.2.4. The UE, upon receiving the REGISTRATION ACCEPT message with the LADN information IE, shall delete its old LADN information (if any) and store the received new LADN information.\nIf the AMF does not include the LADN information IE in the REGISTATION ACCEPT message during registration procedure for mobility and registration update, the UE shall delete its old LADN information.\nIf the PDU session status IE is included in the REGISTRATION ACCEPT message:\na)\tfor single access PDU sessions, the UE shall perform a local release of all those PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side, but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE; and\nb)\tfor MA PDU sessions, for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING and have user plane resources established in the UE on the access the REGISTRATION ACCEPT message is sent over, but are indicated by the AMF as no user plane resources established:\n1)\tfor MA PDU sessions having user plane resources established only on the access the REGISTRATION ACCEPT message is sent over, the UE shall perform a local release of those MA PDU sessions; and\n2)\tfor MA PDU sessions having user plane resources established on both accesses, the UE shall perform a local release on the user plane resources on the access the REGISTRATION ACCEPT message is sent over.\nIf:\na)\tthe UE included a PDU session status IE in the REGISTRATION REQUEST message;\nb)\tthe UE is operating in the single-registration mode; \nc)\tthe UE is performing inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode; and\nd)\tthe UE has received the IWK N26 bit set to \"interworking without N26 interface supported\";\nthe UE shall ignore the PDU session status IE if received in the REGISTRATION ACCEPT message.\nIf the EPS bearer context status IE is included in the REGISTRATION ACCEPT message, the UE shall locally delete all those QoS flow descriptions and all associated QoS rules, if any, which are associated with inactive EPS bearer contexts as indicated by the AMF in the EPS bearer context status IE.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting inter-system change with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 interface not supported\" if the AMF supports N26 interface; or\nb)\t\"interworking without N26 interface supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for inter-system interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a08:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the received interworking without N26 interface indicator for inter-system change with EPS as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback and ATSSS, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers take the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in N1 mode, then the UE shall not perform a local release of any persistent PDU session if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. When the UE determines via the Emergency services support indicator that the network does not support emergency services in N1 mode, then the UE shall not perform a local release of any emergency PDU session if user-plane resources associated with that emergency PDU session are established if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. In a UE with LCS capability, location services indicators (5G-LCS) shall be provided to the upper layers. In a UE with the capability for ATSSS, the network support for ATSSS shall be provided to the upper layers.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a09:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based on operator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a010:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nIf the UE is not operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 1 is only applicable while the UE is in N1 mode;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 1 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 2 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and:\na)\tin WB-N1 mode, the AMF decides to restrict the use of CE mode B for the UE, then the AMF shall set the RestrictEC bit to \"CE mode B is restricted\";\nb)\tin WB-N1 mode, the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, then the AMF shall set the RestrictEC bit to \" Both CE mode A and CE mode B are restricted\"; or\nc)\tin NB-N1 mode, the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\",\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nIf the UE is operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects another SNPN. Access identity 1 is only applicable while the UE is in N1 mode;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 1 in the RSNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects another SNPN. Access identity 2 is only applicable while the UE is in N1 mode; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 2 in the RSNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nIf the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, and the user's subscription context obtained from the UDM if available.\nIf the UE included in the REGISTRATION REQUEST message the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" and the AMF does not support N26 interface, the AMF shall operate as described in subclause\u00a05.5.1.2.4.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message, a service gap time value is available in the 5GMM context, the AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nIf the UE supports WUS assistance information and the AMF supports and accepts the use of WUS assistance information for the UE, then the AMF shall determine the negotiated UE paging probability information for the UE, store it in the 5GMM context of the UE, and include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.\nNOTE\u00a011:\tBesides the UE paging probability information requested by the UE, the AMF can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE.\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA or due to CAG restrictions the UE is not allowed access the cell, but the UE has an emergency PDU session established, the AMF may accept the REGISTRATION REQUEST message and indicate to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions) and informs the UE via the PDU session status IE in the REGISTRATION ACCEPT message. The AMF shall not indicate to the SMF to release the emergency PDU session. The network shall behave as if the UE is registered for emergency services.\nIf the REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE and behave as specified in subclause\u00a05.3.5.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and:\na)\tthe SOR transparent container IE does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C then the UE may release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message.\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates list of preferred PLMN/access technology combinations is provided and the list type indicates:\na)\t\"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nb)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, in the current registration area; or\nb)\totherwise:\n1)\tif the UE has NSSAI inclusion mode for the current PLMN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode;\n2)\tif the UE does not have NSSAI inclusion mode for the current PLMN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type;\nii)\tuntrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0C in the current PLMN and the current access type; or\niii)\ttrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\n3)\tif the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, and the 5G-RG is performing the registration procedure over wireline access, the 5G-RG shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf there is a running T3447 timer in the AMF and the Uplink data status IE is included or the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the Uplink data status IE or that the Follow-on request indicator is set to \"Follow-on request pending\" and proceed as if the Uplink data status IE was not received or the Follow-on request indicator was not set to \"Follow-on request pending\" except for the following case:\n-\tthe PDU session(s) indicated by the Uplink data status IE is emergency PDU session(s);\n-\tthe UE is configured for high priority access in selected PLMN;\n-\tthe REGISTRATION REQUEST message is as a paging response; or\n-\tthe UE is establishing an emergency PDU session or performing emergency services fallback.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, then the UE shall store the included truncated 5G-S-TMSI configuration and return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration.\nNOTE\u00a012: The UE provides the truncated 5G-S-TMSI configuration to the lower layers.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN stored at the UE, then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2 over the existing N1 NAS signalling connection; and\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\nIf the registration procedure for mobility and periodic registration update was initiated and there is a request from the upper layers to perform \"emergency services fallback\" pending, the UE shall restart the service request procedure after the successful completion of the mobility and periodic registration update.\n\n***** Next change *****\nC.1\tStorage of 5GMM information for UEs not operating in SNPN access mode\nThe following 5GMM parameters shall be stored on the USIM if the corresponding file is present:\na)\t5G-GUTI;\nb)\tlast visited registered TAI;\nc)\t5GS update status;\nd)\t5G NAS security context parameters from a full native 5G NAS security context (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\ne)\t\nSOR counter (see subclause\u00a09.11.3.51); and\nf) \tUE parameter update counter (see subclause\u00a09.11.3.53A).\nThe presence and format of corresponding files on the USIM is specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nIf the corresponding file is not present on the USIM, these 5GMM parameters are stored in a non-volatile memory in the ME together with the SUPI from the USIM. These 5GMM parameters can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory; else the UE shall delete the 5GMM parameters.\nThe following 5GMM parameters shall be stored in a non-volatile memory in the ME together with the SUPI from the USIM:\n-\tconfigured NSSAI(s);\n-\tNSSAI inclusion mode(s);\n-\tMPS indicator;\n-\tMCS indicator;\n-\toperator-defined access category definitions;\n-\tnetwork-assigned UE radio capability IDs; and\n-\t\"CAG information list\", if the UE supports CAG.\nEach configured NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. The UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the configured NSSAI for the current PLMN and any necessary mapped S-NSSAI(s). The configured NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the configured NSSAI(s).\nEach NSSAI inclusion mode is associated with a PLMN identity and access type. The NSSAI inclusion mode(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the NSSAI inclusion mode(s).\nThe MPS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MPS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MPS indicator.\nThe MCS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MCS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MCS indicator.\nOperator-defined access category definitions are stored together with a PLMN identity of the PLMN that provided them, and is valid in that PLMN or equivalent PLMN. The operator-defined access category definitions can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the operator-defined access category definitions. The maximum number of stored operator-defined access category definitions is UE implementation dependent.\nEach network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).\nThe allowed NSSAI(s) can be stored in a non-volatile memory in the ME together with the SUPI from the USIM. Allowed NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. If the allowed NSSAI is stored, then the UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the allowed NSSAI for the serving PLMN and any necessary mapping of the allowed NSSAI for the serving PLMN to the S-NSSAI(s) of the HPLMN. The allowed NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the allowed NSSAI(s).\nIf the UE is registered for emergency services, the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is deregistered.\nIf the UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters 5GMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.\nThe \"CAG information list\" can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the \"CAG information list\".\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) According to TS 33.501, subclause 6.2.2.2, if the USIM supports 5G parameters storage, KAUSF and KSEAF shall be stored in the USIM. Otherwise, KAUSF and KSEAF shall be stored in the non-volatile memory of the ME.Currently, there is no explicit requirement in TS 24.501 that these keys need to be stored on the USIM or in the non-volatile memory of the ME.2) CR#1426r1 (C1-196364) added requirements in annex C.1 of TS 24.501 to  store the SOR counter and UE parameter update counter on the USIM or in the non-volatile memory of the ME. But this CR did not add a requirement to store the key KAUSF, which is also necessary to check the integrity of the SOR and the UPU container, and it also did not specify the exact point in time when the UE needs to store any of these parameters.It looks like it was assumed that KAUSF and KSEAF were already covered by the requirement in annex C.1, item d, to store the \"5G NAS security context parameters from a full native 5G NAS security context \", but this is not the case, because according to the definition in TS 33.501 which is referenced by TS\u00a024.501, KAUSF and KSEAF do not belong to the NAS security context:5G NAS security context: The key KAMF with the associated key set identifier, the UE security capabilities, the uplink and downlink NAS COUNT values. Therefore, it is proposed to add an explicit requirement to annex C.1 that KAUSF and KSEAF shall be stored in the USIM or in the non-volatile memory of the ME, respectively.It is also proposed that the UE shall store KAUSF and KSEAF on the USIM or in the non-volatile memory of the UE immediately when the UE generated these keys. (Note: This requires a successful generation of CK/IK, so it will occur less frequently than an update of the NAS COUNT values in the 5G NAS security context. Therefore, there is no need to keep the KAUSF and KSEAF in the volatile memory of the ME until the UE moves to 5GMM-DEREGISTERED.) It also proposed to handle the SOR counter and the UE parameter counter in a similar way. I.e. the UE shall store the SOR counter and the UE parameter counter on the USIM or in the non-volatile memory of the ME immediately when the counter value was used for the successful verification of the integrity of an SOR or UPU container.\n\n>>> SUMMARY OF CHANGE\n1) Explicit requirements are added to annex C.1 and to the description of  the authentication procedure that the UE shall reset SOR counter and UE parameter update counter to zero, and store KAUSF, KSEAF, SOR counter and UE parameter update counter on the USIM (or in the non-volatile memory of the UE, respectively) immediately when the UE generated these keys. 2) Explicit requirements are added to the description of the Network-initiated NAS transport of messages procedure that the UE shall store the SOR counter or the UE parameter counter on the USIM (or in the non-volatile memory of the ME, respectively) immediately when the respective counter value was used for the successful verification of the integrity of an SOR or UPU container.\n\n>>> CONSEQUENCES IF NOT REVISED\nWithout this CR, there is no explicit requirement to store KAUSF and KSEAF on the USIM (or in the non-volatile memory of the UE, respectively). As a consequence, the key KAUSF could get lost when the UE is powered off, and the UE would subsequently not be able to verify the integrity of any SOR or UPU container, until the network performs a new authentication procedure."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*************** Start of the 1st Change ****************\n11.1.2\tProcedure\n Figure 11.1.2-1: Initial EAP Authentication with an external AAA server\n\n\nThe following procedure is based on subclauses 4.3.2.2.1 and 4.3.2.3 in TS 23.502 [8].\nNOTE:\tSteps 1-6 are borrowed from clause 4.3.2.2.1 TS 23.502 and are for information only. Steps 7 to 15are related to authentication and are normative text.\n1-3. The NG-UE registers with the network performing primary authentication with the AUSF/ARPF based on its network access credentials and establishes a NAS security context with the AMF.\n4. The UE initiates establishment of a new PDU Session by sending an SM NAS message containing a PDU Session Establishment Request message. The UE includes slice information (identified by S-NSSAI) and the PDN it would like to connect to (identified by DNN).\n\tThe NAS message may contain SM PDU DN Request Container IE containing information for the PDU session authorization by the external DN. \n5a. The AMF selects a V-SMF and sends a Nsmf_PDUSession_CreateSMContext Request message with SM NAS as one of its payload. It also forwards the Permanent User ID, the received S-NSSAI, and the DNN.\n5b. The V-SMF sends an Nsmf_PDUSession_CreateSMContext Request message to the AMF. \nIn case of a single SMF being involved in the PDU session setup, e.g., non-roaming or local breakout, that single SMF takes the role of both V-SMF and H-SMF. In this case, steps 6 and 17 are skipped.\n6. The V-SMF sends an Nsmf_PDUSession_Create Request to the H-SMF.\n7. The H-SMF obtains subscription data from the UDM for the given SUPI obtained from the AMF in step 5. The SMF checks whether the UE request is compliant with the user subscription and with local policies. If not, the H-SMF will reject UE's request via SM-NAS signalling and skip rest of the procedure. The SMF may also check whether the UE has been authenticated and/or authorized by the same DN, as indicated DNN in step 5, or the same AAA server in a previous PDU session establishment. The SMF may skip the rest of the procedure if positive.\n     Note:\tThe information on a successful authentication/authorization between a UE and an SMF may be saved in SMF and/or UDM.\n8. The H-SMF shall trigger EAP Authentication to obtain authorization from an external DN-AAA server. \n9. The H-SMF shall send an EAP Request/Identity message to the UE.\n10. The UE shall send an EAP Response/Identity message. The UE includes its DN-specific identity complying with Network Access Identifier (NAI) format.\nTo avoid the additional round-trip in steps 9 and 10, the secondary authentication identity may be sent by the UE in step 4.11. The H-SMF selects a UPF and establishes an N4 Session with it. The SM PDU DN Request Container, if provided by the UE, is forwarded to the UPF.  The H-SMF identifies the DN AAA server based on the SM PDU DN Request Container provided by the UE and on local configuration.\n12. The H-SMF shall forward the EAP Response/Identity message to the DN AAA Server. \n13. The DN AAA server and the UE shall exchange EAP messages as required by the EAP method. In addition, it may send additional authorization information as defined in TS 23.501 clause 5.6.6.\n\n\n14. After the completion of the authentication procedure, DN AAA server shall send EAP Success message to the H-SMF.\n15. This completes the authentication procedure at the SMF. The SMF may save the UE ID and DNN (or DN\u2019s AAA server ID if available) in a list for successful authentication/authorization between UE and an SMF. Alternatively, the SMF may update the list in UDM.\nIf the authorization is successful, PDU Session Establishment proceeds further starting at step 9a of Figure 4.3.2.2.1-1 in TS 23.502 [8].\n16a-16b. The SMF initiates a N4 Session Modification procedure with the selected UPF as in steps 9.a and 9.b of Fig 4.3.2.2.1-1 in TS 23.502 [8].\n17. The H-SMF sends an Nsmf_PDUSession_Create Response to the V-SMF. This message shall include EAP Success to be sent to the UE to V-SMF.\n18. The V-SMF sends an Namf_Communication_N1N2MessageTransfer to the AMF as in step 10 of Figure 4.3.2.2.1-1 in TS 23.502 [8]. This message shall include EAP Success to be sent to the UE within the NAS SM PDU Session Establishment Accept message.\n19. The AMF forwards NAS SM PDU Session Establishment Accept message along with EAP Success to the UE as described in steps 11 and step 12 of Figure 4.3.2.2.1-1 in TS 23.502 [8].\nThe UE-requested PDU Session Establishment proceeds further as described in subclause 4.3.2.3 in TS 23.502 [8].\n\n\n*************** End of the 1st Change ****************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nDuring PDU session establishment requiring Secondary Authentication, a public identity, i.e. Public User Identity (PUI), will be sent from SMF to DN, as specified in TS23.502, to allow DN to identify the UE and request for PDU session modification subsequently, if needed. The PUI is sent after the successful Secondary Authentication and upon DN\u2019s request. This CR proposes that PUI can also be sent based on local policy and during Secondary Authentication. This modification allows DN to check the binding of Primary Authentication and Secondary Authentication as requested by DN service providers to increase the security.\n\n>>> SUMMARY OF CHANGE\nIncluding PUI in the Secondary Authentication request\n\n>>> CONSEQUENCES IF NOT REVISED\nDN could not check the binding of Primary and Secondary authentication and leave some vulnerabilities unattended."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n1\tScope\nThe present specification adds detailed flows of Policy and Charging Control (PCC) over the Rx ,Gx, Gxx, Sd, Sy and S9 reference points and their relationship with the bearer level signalling flows over the Gn/Gp, S4, S5/S8, S2a and S2c  interfaces.\nThe calls flows depicted in this Technical Specification represent usual cases, i.e. not all situations are covered. Detailed information provided in 3GPP TS 29.212 [9], 3GPP TS 29.214 [10], 3GPP TS 29.215 [22], and 3GPP TS 29.219 [28] shall be taken into consideration.\nThe present specification also describes the binding and the mapping of QoS parameters among SDP, UMTS QoS parameters, and QoS authorization parameters.\nThe present specification also describes the PCRF addressing using DRA.\n\n\n* * * Next Change * * * *\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n* * * End of Changes * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nGx-based apps are vulnerable to certain race conditions as specified in the discussion paper C3-13xxxx. Standardized procedures are needed to ensure the client and server for such applications don\u2019t end up in state mismatches when such race conditions occur.\n\n>>> SUMMARY OF CHANGE\nIntroduced procedures for handling race conditions for Gx-based apps in a deterministic manner.\n\n>>> CONSEQUENCES IF NOT REVISED\nRace conditions in Gx-based apps can cause mismatches in session state resulting in potentially outdated rules and other mismatches that can have QoS and charging impacts."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * Start of first change * * * *\n4.7.4.1.1\tMS initiated GPRS detach procedure initiation\nThe GPRS detach procedure is initiated by the MS by sending a DETACH REQUEST message. The detach type information element may indicate \"GPRS detach with switching off\", \"GPRS detach without switching off\", \"IMSI detach\", \"GPRS/IMSI detach with switching off\" or \"GPRS/IMSI detach without switching off\".\n\nIf the MS has a valid P-TMSI, the MS shall include the P-TMSI in the DETACH REQUEST message. The MS shall also include a valid P-TMSI signature, if available.\nIf the MS is not switched off and the MS is in the state GMM_REGISTERED, timer T3321 shall be started after the DETACH REQUEST message has been sent. If the detach type information element value indicates \"IMSI Detach\" the MS shall enter GMM-REGISTERED.IMSI-DETACH_INITIATED, otherwise the MS shall enter the state GMM-DEREGISTERED-INITIATED. If the detach type information element value indicates \"IMSI Detach\" or \"GPRS/IMSI Detach\", state MM IMSI DETACH PENDING is entered. If the MS is to be switched off, the MS shall try for a period of 5 seconds to send the DETACH REQUEST message. If the MS is able to send the DETACH REQUEST message during this time the MS may be switched off.\n\nIf the detach type information element value indicates \"GPRS detach without switching off \" and the MS is attached for GPRS and non-GPRS services and the network operates in network operation mode I, then if in the MS the timer T3212 is not already running, the timer T3212 shall be set to its initial value and restarted after the DETACH REQUEST message has been sent.\n* * * End of first change * * * *\n\n* * * Start of second change * * * *\n4.7.4.1.4\tAbnormal cases in the MS\nThe following abnormal cases can be identified:\na)\tT3321 time-out\n\tOn the first expiry of the timer, the MS shall retransmit the DETACH REQUEST message and shall reset and restart timer T3321. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3321, the GPRS detach procedure shall be aborted, the MS shall change to state:\n-\tMM-NULL if \"IMSI detach\" was requested; \n-\tGMM-REGISTERED.NORMAL-SERVICE if \"IMSI Detach\" was requested;\n-\tGMM-DEREGISTERED if \"GPRS detach\" was requested;\n-\tGMM-DEREGISTERED and MM-NULL if \"GPRS/IMSI\" detach was requested.\nb)\tLower layer failure before reception of DETACH ACCEPT message\n\tThe detach procedure is aborted and the MS shall change to one of the following states, except in the following implementation option cases b.1, b.2 and b3: \n-\tMM-NULL if \"IMSI detach\" was requested;\n-\tGMM-REGISTERED.NORMAL-SERVICE if \"IMSI Detach\" was requested;\n-\tGMM-DEREGISTERED if \"GPRS detach\" was requested;\n-\tGMM-DEREGISTERED and MM-NULL if \"IMSI/GPRS\" detach was requested.\nb.1)\tRelease of PS signalling connection before the completion of the GPRS detach procedure\n\tThe release of the PS signalling connection before completion of the GPRS detach procedure shall result in the GPRS detach procedure being initiated again, if the following conditions apply:\n\ti)\tThe original GPRS detach procedure was initiated over an existing PS signalling connection; and\n\tii)\tNo SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause\u00a04.7.7) were received after the DETACH REQUEST message was transmitted.\nb.2)\tRR release in Iu mode (i.e. RRC connection release) with cause different than \"Directed signalling connection re-establishment\", for example, \"Normal\", or\"User inactivity\" (see 3GPP\u00a0TS\u00a025.331\u00a0[23c] and 3GPP\u00a0TS\u00a044.118\u00a0[111])\n\tThe GPRS detach procedure shall be initiated again, if the following conditions apply:\n\ti)\tThe original GPRS detach procedure was initiated over an exisiting RRC connection; and\n\tii)\tNo SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause\u00a04.7.7) were received after the DETACH REQUEST message was transmitted.\nNOTE: \tThe RRC connection release cause different than \"Directed signalling connection re-establishment\" that triggers the re-initiation of the GPRS detach procedure is implementation specific. \nb.3)\tRR release in Iu mode (i.e. RRC connection release) with cause \"Directed signalling connection re-establishment\" (see 3GPP\u00a0TS\u00a025.331\u00a0[23c] and 3GPP\u00a0TS\u00a044.118\u00a0[111])\n\tThe routing area updating procedure shall be initiated followed by completion of the GPRS detach procedure if the following conditions apply:\n\ti)\tThe original GPRS detach procedure was not due to SIM removal; and\n\tii)\tThe original GPRS detach procedure was not due to a rerun of the procedure due to \"Directed signalling connection reestablishment\".\nc)\tDetach procedure collision\n\tGPRS detach containing cause \"power off\":\n-\tIf the MS receives a DETACH REQUEST message before the MS initiated GPRS detach procedure has been completed, this message shall be ignored and the MS initiated GPRS detach procedure shall continue.\n\tGPRS detach containing other causes than \"power off\":\n-\tIf the MS receives a DETACH REQUEST message before the MS initiated GPRS detach procedure has been completed, the MS shall treat the message as specified in subclause\u00a04.7.4.2.2 with the following modifications:\n-\tIf the DETACH REQUEST message received by the MS contains detach type \"re-attach required\", and the MS initiated detach procedure is with detach type \"GPRS detach\" or \"Combined GPRS/IMSI detach\", the MS need not initiate the GPRS attach or combined GPRS attach procedure.\n-\tIf the DETACH REQUEST message received by the MS contains detach type \"IMSI detach\", and the MS initiated detach procedure is with detach type \"IMSI detach\", the MS in operation mode A or B in network operation mode I need not re-attach to non-GPRS services by performing the combined routing area updating procedure according to subclause\u00a04.7.5.2.\nd)\tDetach and GMM common procedure collision\n\tGPRS detach containing cause \"power off\":\n-\tIf the MS receives a message used in a GMM common procedure before the GPRS detach procedure has been completed, this message shall be ignored and the GPRS detach procedure shall continue.\n\tGPRS detach containing other causes than \"power off\" and containing detach type \"IMSI detach\":\n-\tIf the MS receives a message used in a GMM common procedure before the GPRS detach procedure has been completed, both the GMM common procedure and the GPRS detach procedure shall continue.\n\tGPRS detach containing other causes than \"power off\" and containing other detach types than \"IMSI detach\":\n-\tIf the MS receives a P-TMSI REALLOCATION COMMAND, a GMM STATUS, or a GMM INFORMATION message before the GPRS detach procedure has been completed, this message shall be ignored and the GPRS detach procedure shall continue. \n-\tIf the MS receives an AUTHENTICATION AND CIPHERING REQUEST or IDENTITY REQUEST message, before the GPRS detach procedure has been completed, the MS shall respond to it as described in subclauses\u00a04.7.7 and 4.7.8 respectively.\ne)\tChange of cell within the same RA (A/Gb mode only)\n\tIf a cell change occurs within the same RA before a DETACH ACCEPT message has been received, then the cell update procedure shall be performed before completion of the detach procedure.\nf)\tChange of cell into a new routing area\n\tIf a cell change into a new routing area occurs before a DETACH ACCEPT message has been received, the GPRS detach procedure shall be aborted and re-initiated after successfully performing a routing area updating procedure. If the detach procedure is performed due to the removal of the SIM/USIM the MS shall abort the detach procedure and enter the state GMM-DEREGISTERED.\ng)\tAccess barred because of access class control\n\tThe signalling procedure for GPRS detach shall not be started. The MS starts the signalling procedure as soon as possible and if still necessary, i.e. when the barred state is removed or because of a cell change, or performs a local detach immediately or after an implementation dependent time. \n\nMS\nNetwork\nDETACH REQUEST\nStart T3321\nDETACH ACCEPT\nStop T3321\nor at MS power switch off or SIM/USIM removal\nDETACH REQUEST\n\nFigure 4.7.4/1 3GPP TS 24.008: MS initiated GPRS detach procedure\n* * * End of second change * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is unclear to what value the MS shall set the \u201cPower off\u201d field of the Detach Type IE when initiating a Detach Procedure upon SIM/USIM removal. If the MS treats SIM/USIM removal as a case for \u201cnon-power-off\u201d detach, the MS might encounter situations where the NW might, in response, initiate common procedures including Authentication, SMC or Identity Request. Further, the NW will respond to the MS\u2019 request with a security protected Detach Accept. The MS may not be able to progress these common procedures or process the Detach Accept message if it has already locally deleted the security keys as required by TS 33.102 which states the following \u2026In section 6.5.4.2,\u201cThe ME shall delete IK from memory after power-off as well as after removal of the USIM.\u201dIn section 6.6.4.2\u201cThe ME shall delete CK from memory after power-off as well as after removal of the USIM.\u201dMoreover if the MS treats SIM/USIM removal as a case for \u201cnon-switch-off\u201d detach, the MS will be required to start timer T3321 and to re-transmit the Detach Request up to 4 times if no Detach Accept is received. This will require it to keep the security keys during that time and will conflict with the requirement in TS 33.102 to delete the security context.\n\n>>> SUMMARY OF CHANGE\nIt is clarified that upon SIM/USIM removal, the MS shall perform \u201cpower-off\u201d detach.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe NW will respond to the Detach Request unnecessarily, and the MS might not be able to process the message. The NW might trigger common procedures that the MS can\u2019t fulfill. The MS might keep and use security context. This will conflict with the requirements in TS 33.102."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n7.1\t3GPP specific AVP codes\nThe 3GPP specific AVPs have the Vendor-Specific bit ('V' bit) set in the AVP header and they carry the 3GPP\u2019s vendor identifier in the Vendor-ID field of the AVP header. The 3GPP specific AVP codes are presented in the following table.  \nTable 7.1: 3GPP specific AVP codes \n***************text not shown for clarity***********\n600\tVisited-Network-Identifier\tOctetString\t29.229 [2]]\n601\tPublic-Identity\tUTF8String\n602\tServer-Name\tUTF8String\n603\tServer-Capabilities\tGrouped\n604\tMandatory-Capability\tUnsigned32\n605\tOptional-Capability\tUnsigned32\n606\tUser-Data\tOctetString\n607\tSIP-Number-Auth-Items\tUnsigned32\n608\tSIP-Authentication-Scheme\tUTF8String\n609\tSIP-Authenticate\tOctetString\n610\tSIP-Authorization\tOctetString\n611\tSIP-Authentication-Context\tOctetString\n612\tSIP-Auth-Data-Item\tGrouped\n613\tSIP-Item-Number\tUnsigned32\n614\tServer-Assignment-Type\tEnumerated\n615\tDeregistration-Reason\tGrouped\n616\tReason-Code\tEnumerated\n617\tReason-Info\tUTF8String\n618\tCharging-Information\tGrouped\n619\tPrimary-Event-Charging-Function-Name\tDiameterURI\n620\tSecondary-Event-Charging-Function-Name\tDiameterURI\n621\tPrimary-Charging-Collection-Function-Name\tDiameterURI\n622\tSecondary-Charging-Collection-Function-Name\tDiameterURI\n623\tUser-Authorization-Type\tEnumerated\n624\tUser-Data-Already-Available\tEnumerated\n625\tConfidentiality-Key\tOctetString\n626\tIntegrity-Key\tOctetString\n627\tUser-Data-Request-Type\tEnumerated\n628\tSupported-Features\tGrouped\n629\tFeature-List-ID\tUnsigned32\n630\tFeature-List\tUnsigned32\n631\tSupported-Applications\tGrouped\n632\tAssociated-Identities\tGrouped\n633\tOriginating-Request\tEnumerated\n634\tUTF8String\n635\tSIP-Digest-Authenticate\tGrouped\n636\n637\tUAR-Flags\tUnsigned32\n638\tLoose-Route-Indication\tEnumerated\n639\tSCSCF-Restoration-Info\tGrouped\n640\tPath\tOctetString\n641\tContact\tOctetString\n642\tSubscription-Info\tGrouped\n643\tCall-ID-SIP-Header\tOctetString\n644\tFrom-SIP-Header\tOctetString\n645\tTo-SIP-Header\tOctetString\n646\tRecord-Route\tOctetString\n647\tAssociated-Registered-Identities\tGrouped\n648\tMultiple-Registration-Indication\tEnumerated\n649\tRestoration-Info\tGrouped\n650\tSession-Priority\tEnumerated\n651\tIdentity-with-Emergency-Registration\tGrouped\nNote: The AVP codes from 652 to 699 are reserved for TS 29.229.\n\n***************text not shown for clarity***********\n\n* * * End of Change * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCx interface was modified in Rel-8 to use only one information element for Wildcarded Identities: Wildcarded-Public-Identity, rather that Wildcarded-IMPU or Wildcarded-PSI, avoiding that S-CSCF has to be aware of the nature of the wildcarded identity, keeping it transparent for this information.This implied some changes in the AVPs, former Cx Wildcarded-PSI AVP (code 634) was renamed to Wildcarded-Public-Identity, while former Cx Wildcarded-IMPU was removed (code 636 is reserved).However, Sh interface was not modified, then it keeps having both Wildcarded-IMPU and Wildcarded-PSI information elements, but they referred to the Cx AVPs, what is inconsistent, since Sh Wildcarded-PSI is code 634, that is within Cx scope and refers to Wildcarded-Public-Identity, while Sh Wildcarded-IMPU is code 636, that is within Cx scope, and in fact is set to \u201creserved\u201d.As a summary:Code 636 (\u201creserved\u201d) is still in use in Sh for Wildcarded-IMPU. Code 634, is Wildcarded-Public-Identity in Cx, while it is Wildcarded-PSI in Sh.\n\n>>> SUMMARY OF CHANGE\nFormer AVP name for code 636 (\u201creserved\u201d) is recovered, i.e. it is set again to Wildcarded-IMPU. As the AVP code value has been marked as reserved to avoid any reuse of this value for any other AVP, it is possible to re-allocate the same value to the same AVP. And there will be therefore no impact for existing Sh implementationSh AVP Wildcarded-PSI makes usage of 634, this is reflected in the table.\n\n>>> CONSEQUENCES IF NOT REVISED\nSh AVP code used for Wildcarded-PSI is not defined in 29.230, in fact being marked as \u201creserved\u201d it should not be used.Sh AVP code used for Wildcarded-IMPU is defined in 29.230 to be used only for Cx Wildcarded-Public-Identity. 29.230 is incorrect."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n4.6.2\tFunctional Split\nThe HeNB hosts the same functions as an eNB as described in section 4.1, with the following additional specifications in case of connection to the HeNB GW:\n-\tDiscovery of a suitable Serving HeNB GW;\n-\tA HeNB shall only connect to a single HeNB GW at one time, namely no S1 Flex function shall be used at the HeNB:\n-\tThe HeNB will not simultaneously connect to another HeNB GW, or another MME.\n-\tThe TAC and PLMN ID used by the HeNB shall also be supported by the HeNB GW;\n-\tSelection of an MME at UE attachment is hosted by the HeNB GW instead of the HeNB;\n-\tHeNBs may be deployed without network planning. A HeNB may be moved from one geographical area to another and therefore it may need to connect to different HeNB GWs depending on its location;\n-\tSignalling the GUMMEI of the Source MME to the HeNB GW in the S1 PATH SWITCH REQUEST message.\nRegardless of HeNB GW connection:\n-\tThe HeNB may support the LIPA function. See section 4.6.5 for details.\nThe HeNB GW hosts the following functions:\n-\tRelaying UE-associated S1 application part messages between the MME serving the UE and the HeNB serving the UE;\n-\tIn case of S1 INITIAL CONTEXT SETUP REQUEST message and S1 HANDOVER REQUEST message, informing the HeNB about any GUMMEI corresponding to the serving MME, the MME UE S1AP ID assigned by the MME and the MME UE S1AP ID assigned by the HeNB GW for the UE.\n-\tTerminating non-UE associated S1 application part procedures towards the HeNB and towards the MME. Note that when a HeNB GW is deployed, non-UE associated procedures shall be run between HeNBs and the HeNB GW and between the HeNB GW and the MME.\n-\tOptionally terminating S1-U interface with the HeNB and with the S-GW.\n-\tSupporting TAC and PLMN ID used by the HeNB.\n-\tX2 interfaces shall not be established between the HeNB GW and other nodes.\n-\tRouting the S1 PATH SWITCH REQUEST message towards the MME based on the GUMMEI of the source MME received from the HeNB.\nA list of CSG IDs may be included in the PAGING message. If included, the HeNB GW may use the list of CSG IDs for paging optimization.\nIn addition to functions specified in section 4.1, the MME hosts the following functions:\n-\tAccess control for UEs that are members of Closed Subscriber Groups (CSG):\n-\tIn case of handovers to CSG cells, access control is based on the target CSG ID provided to the MME by the serving E-UTRAN.\n-\tMembership Verification for UEs handing over to hybrid cells:\n-\tIn case of handovers to hybrid cells Membership Verification is triggered by the presence of the Cell Access Mode and it is based on the target CSG ID provided to the MME by the serving E-UTRAN.\n-\tCSG membership status signalling to the target E-UTRAN in case of attachment/handover to hybrid cells and in case of the change of membership status when a UE is served by a CSG cell or a hybrid cell.\n-\tSupervising the eNB action after the change in the membership status of a UE.\n-\tRouting of handover messages and MME configuration transfer messages towards HeNB GWs based on the TAI contained in these messages.\nNOTE:\tThe MME or HeNB GW should not include the list of CSG IDs for paging when sending the paging message directly to an un-trusted HeNB or eNB.\nThe MME may support the LIPA function with HeNB. See details of this support in section 4.6.5.\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe Handling of Overload message is not clearly described in the specification.\n\n>>> SUMMARY OF CHANGE\nThe HeNB GW must include the list of GUMMEIs corresponding to the overloaded MME in the Overload message.Impact assessment towards the previous version of\u00a0the specification (same release): This CR has isolated impact towards the previous version of\u00a0the specification (same release).This CR has an impact under functional point of view.The impact can be considered isolated since it only affects the Overload procedure.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe CN Overload defense cannot work with an HeNB GW deployed.- in case the HeNB GW forwards the Overload messages transparently, traffic reduced towards MMEs that are not overloaded will worsen the imbalances.- in case the HeNB GW filters the full Overload messages, traffic heavily reduced in HeNBs connected directly to the MME compared to others."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of changes\n5.2.2.3.3\tRequest for on demand system information\nThe UE shall:\n\n1>\tif SIB1 includes si-SchedulingInfo containing si-RequestConfig or si-RequestConfigSUL:\n2>\ttrigger the lower layer to initiate the Random Access procedure in accordance with [3] using the PRACH preamble(s) and PRACH resource(s) in si-RequestConfig corresponding to the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;\n2>\tif acknowledgement for SI request is received from lower layers;\n3>\tacquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2;\n1>\telse\n2>\tapply the timeAlignmentTimerCommon included in SIB1;\n2>\tapply the CCCH configuration as specified in 9.1.1.X;\n2>\tinitiate transmission of the RRCSystemInfoRequest message in accordance with 5.2.2.3.4;\n2>\tif acknowledgement for RRCSystemInfoRequest message is received from lower layers;\n3>\tacquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2;\nNOTE:\tAfter RACH failure for SI request it is UE implementation when to retry the SI request.\n5.2.2.3.4\tActions related to transmission of RRCSystemInfoRequest message\nThe UE shall set the contents of RRCSystemInfoRequest message as follows:\n1>\tset the requested-SI-List to indicate the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting.\nThe UE shall submit the RRCSystemInfoRequest message to lower layers for transmission.\n\nEnd of changes\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen/While UE in RRC_IDLE or RRC_INACTIVE performs RRC Connection Establishment procedure or RRC Connection Resume procedure, i.e. while T300 or T319 is running, UE should not initiate transmission of the RRCSystemInfoRequest message. If the RRCSystemInfoRequest message is submitted to lower layers in this case, UE will transmit the RRCSystemInfoRequest message after entering RRC_CONNECTED.While UE in RRC_IDLE or RRC_INACTIVE is performing RACH procedure for SI Request, if RRC Connection Establishment procedure or RRC Connection Resume procedure is initiated, UE may delay entering RRC_CONNECTED until completion of ongoing RACH procedure. However, it could be better for UE to stop ongoing RACH procedure for SI Request and flush RLC buffer on CCCH i.e. discard the RRCSystemInfoRequest message, if available, in order to immediately enter RRC_CONNECTED, noting that on-demand SI is not essential for RRC_CONNECTED.\n\n>>> SUMMARY OF CHANGE\nIt is clarified in 5.2.2.3.3 that UE shall not initiate SI Request while T300 or T319 is running.One NOTE is added in 5.2.2.3.4 to clarify that when UE initiaties RRC Connection Establishment procedure or RRC Connection Resume procedure, UE may stop ongoing RACH procedure for SI Request and flush RLC buffer on CCCH i.e. discard the RRCSystemInfoRequest message, if available, before submission of the RRCSetupRequest message or the RRCResumeRequest message to lower layers.Impact AnalysisImpacted functionalityUE\u2019s request for on demand system information when trying to establish or resume a RRC Connection.Inter-operabilityIf the network is implemented according to this CR while the UE is not, the network may receive an unexpected message from the UE.If the UE is implemented according to this CR while the network is not, there is no inter-operability issue.\n\n>>> CONSEQUENCES IF NOT REVISED\nWhile T300 or T319 is running, the UE is allowed to submit the RRCSystemInfoRequest message to lower layers for transmission.If the RRCSystemInfoRequest message is submitted to lower layers after initiation of RRC Connection Establishment procedure or RRC Connection Resume procedure, UE will transmit the RRCSystemInfoRequest message after entering RRC_CONNECTED.If the RRCSystemInfoRequest message is submitted to lower layers before initiation of RRC Connection Establishment procedure or RRC Connection Resume procedure, UE delays entering RRC_CONNECTED until completion of ongoing RACH procedure.If the RRCSystemInfoRequest message is submitted to lower layers before initiation of RRC Connection Establishment procedure or RRC Connection Resume procedure, and if UE stops ongoing RACH procedure triggered for SI Request, L2 buffers may still have the RRCSystemInfoRequest message for transmission as well as RRCSetupRequest message or RRCResumeRequest message. Thus, UE will transmit the RRCSystemInfoRequest message after entering RRC_CONNECTED, if the message is still in L2 buffer."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*** BEGIN SET OF CHANGES ***\n\n2\tReferences\nThe following documents contain provisions, which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TR\u00a022.934: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Feasibility study on 3GPP system to Wireless Local Area Network (WLAN) interworking\".\n[2]\t3GPP\u00a0TR\u00a023.934: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3GPP system to Wireless Local Area Network (WLAN) Interworking; Functional and architectural definition\".\n[3]\tIETF\u00a0RTC\u00a03748: \"Extensible Authentication Protocol (EAP)\".\n[4]\tdraft-arkko-pppext-eap-aka-12, April 2004: \"Extensible Authentication Protocol Method for UMTS Authentication and Key Agreement (EAP-AKA)\". IETF Work in progress\n[5]\tdraft-haverinen-pppext-eap-sim-13, April 2004: \"Extensible Authentication Protocol Method for GSM Subscriber Identity Modules (EAP-SIM)\". IETF Work in progress\n[6]\tIEEE\u00a0Std 802.11i/D7.0, October 2003: \"Draft Supplement to Standard for Telecommunications and Information Exchange Between Systems - LAN/MAN Specific Requirements - Part 11: Wireless Medium Access Control (MAC) and physical layer (PHY) specifications: Specification for Enhanced Security\".\n[7]\tRFC\u00a02716, October 1999: \"PPP EAP TLS Authentication Protocol\".\n[8]\tSHAMAN/SHA/DOC/TNO/WP1/D02/v050, 22-June-01: \"Intermediate Report: Results of Review, Requirements and Reference Architecture\".\n[9]\tETSI\u00a0TS\u00a0101\u00a07611\u00a0v1.3.1B: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 1: Basic Data Transport\".\n[10]\tETSI\u00a0TS\u00a0101\u00a07612\u00a0v1.2.1C: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 2: Radio Link Control (RLC) sublayer\".\n[11]\tETSI\u00a0TS\u00a0101\u00a07614\u00a0v1.3.1B: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; Data Link Control (DLC) layer; Part 4 Extension for Home Environment\".\n[12]\tETSI\u00a0TR\u00a0101\u00a0683\u00a0v1.1.1: \"Broadband Radio Access Networks (BRAN); HIPERLAN Type 2; System Overview\".\n[13]\t3GPP\u00a0TS\u00a023.234: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3GPP system to Wireless Local Area Network (WLAN) Interworking; System Description\".\n[14]\tRFC\u00a02486, January 1999: \"The Network Access Identifier\".\n[15]\tRFC\u00a02865, June 2000: \"Remote Authentication Dial In User Service (RADIUS)\".\n[16]\tRFC\u00a01421, February 1993: \"Privacy Enhancement for Internet Electronic Mail: Part I: Message Encryption and Authentication Procedures\".\n[17]\tFederal Information Processing Standard (FIPS) draft standard: \"Advanced Encryption Standard (AES)\", November 2001.\n[18]\t3GPP\u00a0TS\u00a023.003: \"3rd Generation Partnership Project; Technical Specification Group Core Network; Numbering, addressing and identification\".\n[19]\tIEEE\u00a0P802.1X/D11 June 2001: \"Standards for Local Area and Metropolitan Area Networks: Standard for Port Based Network Access Control\".\n[20]\t3GPP\u00a0TR\u00a021.905: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Vocabulary for 3GPP Specifications\".\n[21]\t3GPP\u00a0TS\u00a033.102: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G Security; Security Architecture\".\n[22]\tCAR 020 SPEC/0.95cB: \"SIM Access Profile, Interoperability Specification\", version 0.95VD.\n[23]\tdraft-ietf-aaa-eap-08.txt, June 2004: \"Diameter Extensible Authentication Protocol (EAP) Application\". IETF Work in progress\n[24]\tRFC\u00a03588, September 2003: \"Diameter base protocol\".\n[25]\tRFC\u00a03576, July 2003: \"Dynamic Authorization Extensions to Remote Authentication Dial In User Service (RADIUS)\".\n[26]\tRFC\u00a03579, September 2003: \"RADIUS (Remote Authentication Dial In User Service) Support for Extensible Authentication Protocol (EAP)\".\n[27]\tdraft-ietf-eap-keying-02.txt, June 2004: \"EAP Key Management Framework\". IETF Work in progress\n[28]\tE. Barkan, E. Biham, N. Keller: \"Instant Ciphertext-Only Cryptoanalysis of GSM Encrypted Communication\", Crypto 2003, August 2003.\n[29]\tdraft-ietf-ipsec-ikev2-14.txt, May 2004: \"Internet Key Exchange (IKEv2) Protocol\".\n[30]\tRFC 2406, November 1998: \"IP Encapsulating Security Payload (ESP)\".\n[31]\tdraft-ietf-ipsec-ui-suites-06.txt, April 2004: \"Cryptographic Suites for IPsec\". IETF Work in progress\n[32]\tdraft-ietf-ipsec-udp-encaps-09.txt, May 2004: \"UDP Encapsulation of IPsec Packets\". IETF Work in progress\n[33]\tdraft-ietf-ipsec-ikev2-algorithms-05.txt, April 2004: \"Cryptographic Algorithms for use in the Internet Key Exchange Version 2\". IETF Work in progress\n[34]\tRFC\u00a02104, February 1997: \"HMAC: Keyed-Hashing for Message Authentication\".\n[35]\tRFC\u00a02404, November 1998: \"The Use of HMAC-SHA-1-96 within ESP and AH\".\n[36]\tRFC\u00a02548, March 1999: \" Microsoft Vendor-specific RADIUS Attributes\".\n[37]\tdraft-mariblanca-aaa-eap-lla-01.txt, June 2004: \"EAP lower layer attributes for AAA protocols\".\n\n*** END SET OF CHANGES ***\n\n*** BEGIN SET OF CHANGES ***\n\n\n\n\n\n\n\n*** END SET OF CHANGES ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently in TS 33.234 it is described how to force a re-authentication process from a full authentication (sending a re-authentication identity from the AAA server), but it is not clearly described how to request again a full authentication when re-authentications have been started\n\n>>> SUMMARY OF CHANGE\nIt is indicated in the TS that, in order to be able to perform a full authentication after a re-authentication, the AAA server has to issue a pseudonym together with a re-authentication id. The AAA server, when it decides to have full authentication, will reject the re-authentication identity and request the pseudonym\n\n>>> CONSEQUENCES IF NOT REVISED\nFallback from fast re-authentication to full authentication may be performed using the permanent user identity (IMS), which is not desirable from identity privacy perspective. The fallback process is not currently described properly in the TS and implementations may vary."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n\n\nStart of Change 1\n6.2.1\tGeneral message structure\n--unrelated sections are omitted\nThe RRCConnectionRequest message is used to request the establishment of an RRC connection.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: UE to EUTRAN\nRRCConnectionRequest message\n-- ASN1START\n\nRRCConnectionRequest ::=\t\t\tSEQUENCE {\n\tcriticalExtensions\t\t\t\t\tCHOICE {\n\t\trrcConnectionRequest-r8\t\t\t\tRRCConnectionRequest-r8-IEs,\n\t\tcriticalExtensionsFuture\t\t\tSEQUENCE {}\n\t}\n}\n\nRRCConnectionRequest-r8-IEs ::=\t\tSEQUENCE {\n\tue-Identity\t\t\t\t\t\t\tInitialUE-Identity,\n\testablishmentCause\t\t\t\t\tEstablishmentCause,\n\tspare\t\t\t\t\t\t\t\tBIT STRING (SIZE (1))\n}\n\nInitialUE-Identity ::=\t\t\t\tCHOICE {\n\ts-TMSI\t\t\t\t\t\t\t\tS-TMSI,\n\trandomValue\t\t\t\t\t\t\tBIT STRING (SIZE (40))\n}\n\nEstablishmentCause ::=\t\t\t\tENUMERATED {\n\t\t\t\t\t\t\t\t\t\temergency, highPriorityAccess, mt-Access, mo-Signalling,\n\t\t\t\t\t\t\t\t\t\tmo-Data, spare3, spare2, spare1}\n\n-- ASN1STOP\n\nRRCConnectionRequest field descriptions\nue-Identity\tUE identity included to facilitate contention resolution by lower layers.\nestablishmentCause\nrandomValue\tInteger value in the range 0 to 240  1.\n\n\nEnd of Change 1\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is currently not specified how the network should handle  the spare establishment cause value and this has been left to implementation. However, based on some precedence of networks not handling spare establishment cause values properly (see GP-021695), there is a risk that a similar situation arises in LTE once we have Release 10 UEs and future release UEs indicating spare values as establishment causes. Hence, this problem should be fixed as soon as possible so that networks do not e.g. reject RRC Connections indicating as spare as establishment cause value.\n\n>>> SUMMARY OF CHANGE\nIn establishment cause IE field description, indicate that if a \u2018spare\u2019 value is received, the network should handle it similarly as if one of the existing establishment cause values was received.\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is a risk that some network implementations will reject devices which indicate a spare as establishment cause value"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*** FIRST CHANGE ***\n9.2.1\tSC UE procedures for PS to CS access transfer\nIf SC UE uses ICS capabilities, this subclause applies for IMS sessions containing speech media component only, otherwise subclause\u00a011.2.1.2 applies.\nThe SC UE may be engaged in one or more ongoing sessions at the time of initiating access transfer. By an ongoing session, it is meant a session for which the SIP 2xx response for the initial SIP INVITE request to establish this session has been sent or received.\nIf SC using ICS is enabled then if the SC UE is using Gm, then for each session with speech media component to be transferred and starting with the session with active speech media component, the SC UE shall send a SIP INVITE request to the SCC AS according to the ICS UE using Gm procedures for call origination as specified in 3GPP\u00a0TS\u00a024.292\u00a0[4]. The SC UE shall populate the SIP INVITE request as specified for PS-PS access transfer with full media transfer in subclause\u00a010.2.1 (including the STI of the dialog to be transferred) with the following exceptions:\n-\tThe SC UE shall indicate in the SIP INVITE request that the speech media component is using CS bearer with its corresponding media description.\n-\tUpon receiving the PSI DN from the SCC AS, the SC UE shall follow the procedures for call origination for ICS UE using Gm in 3GPP\u00a0TS\u00a024.292\u00a0[4] to set up the CS bearer.\nIf the SC UE is not using ICS capabilities and if the SC UE does not apply the MSC Server assisted mid-call feature as specified in subclause\u00a09.2.1A, subject to the SC_non_transferrable_media node value in the Communication Continuity MO (see subclause\u00a05.27 in 3GPP\u00a0TS\u00a024.216\u00a0[5]), the SC UE shall:\na)\tif more than one full-duplex session with speech media component exists, first initiate the release of all the ongoing full-duplex sessions with speech media component except the full-duplex session with active speech media component that was most recently made active and then the SC UE shall transfer the remaining ongoing full-duplex session with active speech media component.\nWhen transferring the session(s) not using ICS capabilities, the SC UE shall send, a CC\u00a0SETUP message  as specified in 3GPP\u00a0TS\u00a024.008\u00a0[8], to the SCC AS to set up a call over the CS domain. When sending CC SETUP message, the SC UE shall populate the CC SETUP message as follows:\n1)\tthe called party BCD number information element set to the static STN; and\n2)\tType Of Number set to \"International\" and Numbering Plan Indicator set to \"E.164\".in the Called Party BCD Number information element.\nIf the SC UE receives a release message to the CC SETUP message sent, then PS-CS access transfer has not completed successfully and the call will continue in the Source Access Leg.\n\n\n\n*** SECOND CHANGE ***\n9.2.2\tSC UE procedures for CS to PS access transfer\nThe SC UE may be engaged in one or more ongoing sessions before performing access transfer. By an ongoing session, it is meant a CS call for which the CS call setup procedure is complete, e.g. a CC CONNECT message has been sent or received as described in 3GPP\u00a0TS\u00a024.008\u00a0[8] or a call for which the SIP 2xx response for the initial SIP INVITE request to establish this session has been sent or received. \nIf not already registered in the IM CN subsystem, the SC UE shall follow the procedures specified in subclause\u00a06.2 to perform registration over the Target Access Leg before performing CS to PS access transfer.\nIf SC using ICS is enabled then if the original sessions are established using ICS capabilities as defined in 3GPP\u00a0TS\u00a024.292\u00a0[4], then for each session with speech media component to be transferred and starting with the one with active speech media component, the SC UE shall send a SIP INVITE request to the SCC AS in accordance with the UE procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SC UE shall populate the SIP INVITE request as specified for PS-PS access transfer with full media transfer in subclause\u00a010.2.1.\nIf the original sessions are not established using ICS capabilities and the SC UE does not support the MSC Server assisted mid-call feature as described in subclause\u00a09.2.3, subject to the SC_non_transferrable_media node value in the Communication Continuity MO (see subclause\u00a05.27 in 3GPP\u00a0TS\u00a024.216\u00a0[5]) the SC UE shall:\na)\tif more than one full-duplex session with speech media component exists, first initiate the release of all the ongoing sessions that are currently not active with the UE procedures specified in 3GPP\u00a0TS\u00a024.083\u00a0[43] and then the SC UE shall transfer the remaining ongoing full-duplex session with active speech media component.\nWhen transferring the session(s) not using ICS capabilities, the SC UE shall send a SIP INVITE request to the SCC AS in accordance with the UE procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] . The SC UE shall populate the SIP INVITE request as follows:\n1)\tthe Request-URI set to the static STI; and\n2)\tinclude in the Contact header field a public GRUU or temporary GRUU as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2], if a GRUU was received at registration.\nIf the SC UE receives any SIP 4xx \u2013 6xx response to the SIP INVITE request, then session transfer has not occurred and the call will continue in the CS domain.\nWhen the SC UE receives a CS call release message, e.g. CC DISCONNECT message as specified in 3GPP\u00a0TS\u00a024.008\u00a0[8], from the network, the SC UE shall comply with network initiated call release procedures to release the CS bearer.\n\n\n\n*** THIRD CHANGE ***\n9.3.2\tSCC AS procedures for PS to CS access transfer\nThis subclause does not apply to reception of a SIP INVITE request due to STI with CS media and other kind of media or without CS media.\nWhen the SCC AS receives a SIP INVITE request due to STI with CS media only on the Target Access Leg, the SCC AS shall follow the procedures specified in subclause\u00a010.3.2 with the following exceptions:\n-\tAs the SIP INVITE request includes an active speech media component using CS bearer, then the SCC AS shall follow the procedures for SCC AS for service control over Gm in 3GPP\u00a0TS\u00a024.292\u00a0[4] to send the PSI DN to the SC UE and wait for the SC UE to set up CS bearer before sending SIP re-INVITE to the remote end.\n-\tThe SCC AS shall correlate the STI with the allocated PSI DN in order to identify the remote leg to be updated.\nWhen the SCC AS receives SIP INVITE request due to static STN, the SCC AS shall associate the SIP INVITE request with an ongoing dialog supporting a session based on information associated with the received IMRN (as described in 3GPP\u00a0TS\u00a024.292\u00a0[4]) or based on information from the SIP History-Info header field or P-Asserted-Identity header field or Contact header field, and send a SIP re-INVITE request towards the remote UE using the existing established dialog. By an ongoing dialog supporting a session, it is meant a dialog for which a SIP 2xx response to the initial SIP INVITE request has been sent or received. Multiple dialogs supporting a session associated with the same SC UE may have been anchored when the SCC AS receives a SIP INVITE request due to static STN. This can occur in the event that the UE does not succeed in releasing all dialogs supporting a session with inactive speech media component or if the UE applies the MSC Server assisted mid-call feature. The identification of the associated dialog is subject to the following conditions:\n1.\tif only one dialog supporting a session with active speech media component exists for the user identified in the P-Asserted-Identity header field and a SIP 2xx response has been sent, then continue the session transfer with the dialog supporting a session with active speech media component;\n2.\tif no dialogs supporting a session with active speech media component exist for the user identified in the P-Asserted-Identity header field and a SIP 2xx response has been sent and the SCC AS does not apply the MSC Server assisted mid-call feature as specified in subclause\u00a09.3.2A, then send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request relating to the session transfer;\n3.\tif more than one dialog supporting a session with active speech media component exists for the user identified in the P-Asserted-Identity header field for which SIP 2xx responses have been sent, then the SCC AS shall perform session transfer procedures for the dialog that originates from the same device that initiated the received SIP INVITE request due to static STN. If more than one such dialogs exists from the same device, the SCC AS shall proceed with the next step in this list; and\nNOTE\u00a01:\tWhether the dialog originates from the same UE as the received SIP INVITE request is determined based on local information and information related to the correlation MSISDN or the GRUU of the originating user as determined via registration procedures as defined in subclause\u00a06.3.\n4.\tif more than one dialog supporting a session exists for the user identified in the P-Asserted-Identity header field and exactly one dialog supporting a session with active speech media component exists and a SIP 2xx response has been sent for that dialog, then:\n-\tif the SCC AS does not apply the MSC Server assisted mid-call feature as specified in subclause\u00a09.3.2A, then the SCC AS may release the dialogs supporting a session with inactive speech media component and continue the session transfer procedures with the dialog supporting a session with active speech media component; or\n-\tif the SCC AS is not able to identify one dialog for session transfer, then the SCC AS shall send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request relating to the session transfer.\n5.\tif more than one dialog supporting a session with active speech media component exist for the user identified in the P-Asserted-Identity header field and a SIP 2xx response has been sent for that dialog, then:\n-\tif the SCC AS does not apply the MSC Server assisted mid-call feature as specified in subclause\u00a09.3.2A, the SCC AS may release all dialogs supporting a session with speech media component of the user identified in the P-Asserted-Identity header field for which a SIP 2xx response has been sent except the one with the active speech media component that was most recently made active and continue the session transfer procedures; or\n-\tif the SCC AS is not able to identify one dialog for session transfer, then the SCC AS shall send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request relating to the session transfer.\nContinuing the session transfer procedures, the SCC AS shall populate the SIP re-INVITE request as follows:\n1)\tset the Request-URI to the URI contained in the Contact header field returned at the creation of the dialog with the remote UE; and\n2)\tset the contact header field to the contact header field provided by the served UE at the creation of the dialog with the remote UE; and\n3)\ta new SDP offer, including the media characteristics as received in the SIP INVITE request due to static STN, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2].\nUpon receiving the SIP ACK request from the IM CN subsystem, then:\n-\tif the source access leg contains only one speech media component the SCC AS shall initiate release of the source access leg by sending a SIP BYE request toward the S-CSCF for sending to the served SC UE; or\n\n-\tIf the Source Access Leg contains media components other than speech media component, the SCC AS should send a SIP re-INVITE request to update the source access leg.\n\n\n*** FOURTH CHANGE ***\nA.6.1\tPS-CS access transfer: CS-PS\nIn this example, SC UE A has an ongoing session with remote UE B over CS bearer before access transfer. When SC UE connects to an IP-CAN, it decides to transfer the session over the new IP-CAN.\n\nFigure\u00a0A.6.1-1: Signalling flow for PS-CS Access Transfer: CS to PS\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\nSC UE A has an ongoing session with remote UE B\n\tThe call has been anchored at the SCC AS which is in the HPLMN of originating SC UE A. \n2.\tSC UE A connects to a new IP-CAN:\n\tThe SC UE A decides to transfer the session over the new IP-CAN. The UE A obtains an IP address that it will use for the signalling and media. It registers with the S-CSCF over the new IP-CAN using standard registration procedure and reserves resources in the new IP-CAN.\n3.\tSIP INVITE request (SC UE A to intermediate IM CN subsystem entities) - see example in table\u00a0A.6.1-3\nThe SC UE A sends an initial SIP INVITE request to request the new call replaces the existing call. \nTable\u00a0A.6.1-3: SIP INVITE request (UE A to intermediate IM CN subsystem entities)\nINVITE sip:domain.xfer@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.home1.net:7531;lr >, <sip:orig@scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info: IEEE-802.11b\nPrivacy: none\nFrom: <sip:user1_public1@home1.net>; tag=171828\nTo: <tel:+1-237-555-2222>\nCall-ID: cb03a0s09a2sdfglkj490237\nCseq: 127 INVITE \nSupported: 100rel; precondition\nRequire: sec-agree\nProxy-Require: sec-agree\nSecurity-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321; port1=7531\nContact: <sip:user1_public1@home1.net;gr= urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\";+g.3gpp.ics=\"principal\";\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE\nAccept: application/sdp; application/3gpp-ims+xml \nContent-Type: application/sdp\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=\nc=IN IP6 5555::aaa:bbb:ccc:ddd\nt=0 0\nm=audio 3456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n4. \tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n5.\tSIP INVITE request (intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP INVITE request is forwarded to the SCC AS as the result of the evaluation of iFC.\n6.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the remote UE.\n7.\tSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)- See example in table\u00a0A.6.1-7\n\tThe SCC AS modifies the message in accordance with routeing B2BUA functionality, e.g. mapping of From, To, Cseq and Call-ID header fields from one side of the B2BUA to the other. In this example the SCC AS includes the contents of the Contact header field from the received SIP INVITE request.The SIP re-INVITE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the initial SIP INVITE request from the UE A (Step 3).\nTable\u00a0A.6.1-7: SIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\nINVITE < sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6> SIP/2.0 \nVia: SIP/2.0/UDP sccas.home1.net; branch=z9hG4bK332b33.3; \nMax-Forwards: 67\nRoute: <scscf1.home1.net;lr >,<sip:scscf2.home2.net;lr>, <sip:pcscf2.visited2.net;lr> \nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>, <tel:+1-237-555-1111>\nP-Access-Network-Info: IEEE-802.11b \nPrivacy: none\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"\nP-Charging-Function-Addresses:\nFrom: <sip:user1_public1@home1.net>; tag=1717777 \nTo: <tel:+1-237-555-2222>, tag=4321\nCall-ID: dc14b1t10b3teghmlk5013237\nCseq: 111 INVITE\nSupported: precondition, 100rel\nContact: <sip:user2_public1@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\" \nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE\nAccept: application/sdp\nContent-Type: application/sdp\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=\nc=IN IP6 5555::aaa:bbb:ccc:ddd\nt=0 0\nm=audio 3456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n8.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE B)\n\tThe intermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE B.\n9-10:\tSIP 200 (OK) response (UE B to SCC AS via Intermediate IM CN subsystem entities)\n\tThe UE B generates the SIP 200 (OK) response to the SIP re-INVITE request and forwards it to the SCC AS.\n11-12:\tSIP ACK request (SCC AS to UE B via Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the remote UE B.\n13-14:\tSIP 200 (OK) response (SCC AS to UE A via Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request and forwards it to the SC UE A.\n15-16:\tSIP ACK request (SC UE A to SCC AS via Intermediate IM CN subsystem entities)\n\tThe SC UE A generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the SCC AS\n17.\tMedia paths between UE A and UE B\n\tThe media path is using the new IP-CAN.\n18-19.\tSIP BYE request (SCC AS to interworking entities via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg, which was using the CS bearer, by sending a BYE request.\n20-22.\tCC DISCONNECT message (interworking entities to SC UE A)\n\tUpon receiving the CC DISCONNECT message, the SC UE A relinquishes all resources pertaining to the CS bearer.\n\n23-24.\tSIP 200 (OK) response (Interworking entities to SCC AS via intermediate IM CN subsystem entities)\n\n\n*** FIFTH CHANGE ***\nA.6.2\tPS-CS access transfer: PS-CS\nIn this example, SC UE A has an ongoing session with remote UE B over PS bearer before access transfer which is anchored at SCC AS. When the SC UE attaches to the CS domain, it decides to transfer the session over the CS bearer without ICS capability.\n\nFigure\u00a0A.6.2-1 Signalling flow for PS-CS access transfer: PS-CS\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\nSC UE A is on an active session with UE B:\nThere is an ongoing IP bearer between the SC UE and the remote end UE B. The call is achored at SCC AS.\nSC UE A attaches to the CS domain\nThe SC UE attaches to the CS domain and decides to transfer the session over the CS bearer.\n3.\tCC SETUP messages\n\tThe SC UE sends the CC SETUP message with the static STN as the called party number.\nSIP INVITE request (Interworking entities to Intermediate IM CN subsystem entities) -see example in table\u00a0A.6.2-4\nTable\u00a0A.6.2-4: SIP INVITE request (interworking entities to intermediate IM CN subsystem entities) \nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP mgcf1.home1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nRoute: <sip:icscf1.home1.net;lr>\nP-Asserted-Identity: <tel: +1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nPrivacy: none\nFrom: <tel: +1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490333 \nCseq: 127 INVITE\nSupported: 100rel, precondition\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:mgcf1.home1.net;gr>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the IMRN, as obtained from CS networks signalling.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MGW.\nEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n6.\tSIP INVITE request (Intermediate IM CN subsystem entities to SCC AS)\n7.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the remote UE.\nSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities) \u2013see example in table\u00a0A.6.2-8\n\tThe SCC AS acting as a routing B2BUA generates a SIP INVITE request based upon the received SIP INVITE request and the information previously stored against this session and routes it towards UE B via the intermediate IM CN subsystem entities.\nTable\u00a0A.6.2-8: SIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\nINVITE sip:user2_public1@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74 SIP/2.0\nVia: SIP/2.0/UDP sccas1.home1.net;branch=z9hG4bKnas34r5\nMax-Forwards: 67\nRoute: <sip:scscf1.home1.net:lr>\nP-Asserted-Identity: <tel: +1-237-555-1111>\nP-Charging-Function-Addresses: ccf=[5555::b99:c88:d77:e66]; ccf=[5555::a55:b44:c33:d22]; ecf=[5555::1ff:2ee:3dd:4ee]; ecf=[5555::6aa:7bb:8cc:9dd]\nP-Charging-Vector: icid-value=\"BzyretyU0dm+6O2IrT5tAFrbHLso=023551034\"; orig-ioi=\"type3home1.net\" \nPrivacy: none\nFrom: <tel: +1-237-555-1111>;tag=569812\nTo: <tel:+1-237-555-2222>; tag=26545\nCall-ID: dd13a0s09a2sdfglkj490378\nCseq: \nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow:\nContent-Type: Content-Length:\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVPF 97 96\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\nm=message 0 TCP/MSRP 98\na=accept-types:text/plain\n\n9.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE B)\n\tIntermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE B.\n10.\tSIP 200 (OK) response (UE B to intermediate IM CN subsystem entities)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer, since the UE B has all resources available, it sends immediately the SIP 200 (OK) response to the SIP re-INVITE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n11.\tSIP 200 (OK) response (intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SIP re-INVITE request to the SCC AS in the originating network.\n12-13.\tSIP ACK request (SCC AS to UE B via IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response, and forwards the SIP ACK request to the remote UE B.\n14-15.\tSIP 200 (OK) response (SCC AS to interworking entities via IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response to the interworking entities.\n16.\tCC CONNECT message (interworking entities to SC UE A)\n17.\tCC CONNECT ACKNOWLEDGE message (SC UE A to interworking entities)\n18-19.\tSIP ACK request (interworking entities to SCC AS via IM CN subsystem entities)\n\tThe interworking entities generate the SIP ACK request to the SIP 200 (OK) response, and forward it to the SCC AS.\n20.\tMedia paths between SC UE A and UE B:\n\tThe CS bearer is setup while the PS bearer is still existing. \n21-22:\tSIP BYE request (SCC AS to SC UE A via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n23-24.\tSIP 200 (OK) response (SC UE A to SCC AS via intermediate IM CN subsystem entities)\nUpon receiving the SIP BYE request over the old IP-CAN, the SC UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the SC UE A relinquishes all resources pertaining to the old IP-CAN.\n\n25.\tMedia paths between SC UE A and UE B\n\tFinally, the session is transferred from PS bearer to CS bearer.\n\n\n*** SIXTH CHANGE ***\nA.15.2\tCS to PS access transfer with MSC server assisted mid-call feature\nIn the example flow at the figure\u00a0A.15.2-1, SC UE A has two ongoing sessions over CS bearer which are anchored at SCC AS. The active session X is with UE B, the held session Y is with UE C. The session X and session Y are two party sessions. The session Y contains rejected video stream and accepted speech media component. When the SC UE connects to an IP-CAN, it decides to transfer the sessions over the IP-CAN.\n\nFigure\u00a0A.15.2-1: Signalling flow for PS-CS Access Transfer: CS to PS\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tSC UE A has an ongoing active session X with remote UE B and a held session Y with remote UE C\n\tThe calls have been anchored at the SCC AS which is in the HPLMN of originating SC UE A. \n2.\tSC UE A connects to a new IP-CAN:\n\tThe SC UE A decides to transfer the sessions over the new IP-CAN. The UE A obtains an IP address that it will use for the signalling and media. It registers with the S-CSCF over the new IP-CAN using standard registration procedure and reserves resources in the new IP-CAN.\n3.\tSIP INVITE request transferring the active session X (SC UE A to intermediate IM CN subsystem entities) - see example in table\u00a0A.15.2-3\n\tThe SC UE A sends an initial SIP INVITE request to request the new call replaces the existing call X.\nTable\u00a0A.15.2-3: SIP INVITE request (UE A to intermediate IM CN subsystem entities)\nINVITE sip:domain.xfer@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.home1.net:7531;lr>, <sip:orig@scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info: IEEE-802.11b\nPrivacy: none\nFrom: <sip:user1_public1@home1.net>; tag=171828\nTo: <tel:+1-237-555-2222>\nCall-ID: cb03a0s09a2sdfglkj490237\nCseq: 127 INVITE \nSupported: 100rel, precondition, 199, gruu, norefersub\nRequire: sec-agree\nProxy-Require: sec-agree\nSecurity-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321; port1=7531\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6> ;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\";+g.3gpp.mid-call\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE\nAccept: application/sdp; application/3gpp-ims+xml, application/vnd.3gpp.mid-call+xml \nContent-Type: application/sdp\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=\nc=IN IP6 5555::aaa:bbb:ccc:ddd\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tContact:\tcontains the g.3gpp.mid-call media feature tag as defined in annex\u00a0C indicating the support for the MSC server assisted mid-call feature.\n\tAccept:\tcontains the MSC Server assisted mid-call feature MIME type.\n4. \tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n5.\tSIP INVITE request (intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP INVITE request is forwarded to the SCC AS as the result of the evaluation of iFC.\n6.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n7.\tSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS modifies the message in accordance with routeing B2BUA functionality, e.g. mapping of From, To, Cseq and Call-ID header fields from one side of the B2BUA to the other. The SIP re-INVITE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the initial SIP INVITE request from the UE A (Step 3).\n8.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE B)\n\tThe intermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE B.\n9-10:\tSIP 200 (OK) response (UE B to SCC AS via Intermediate IM CN subsystem entities)\n\tThe UE B generates the SIP 200 (OK) response to the SIP re-INVITE request and forwards it to the SCC AS.\n11-12:\tSIP ACK request (SCC AS to UE B via Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the remote UE B.\n13-14:\tSIP 200 (OK) response (SCC AS to UE A via Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request and forwards it to the SC UE A.\n15-16:\tSIP ACK request (SC UE A to SCC AS via Intermediate IM CN subsystem entities) \n\tThe SC UE A generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the SCC AS\n17.\tMedia paths between UE A and UE B\n\tThe media path of session X is using the new IP-CAN but the media path of the session Y is still using the CS bearer.\n18-19.\tSIP BYE request (SCC AS to MSC Server via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg, which was using the CS bearer, by sending a SIP BYE request.\n20-22.\tCC DISCONNECT message (interworking entities to SC UE A)\n\tUpon receiving the CC DISCONNECT message, the SC UE A relinquishes all resources pertaining to the CS bearer.\n\n23-24. SIP 200 (OK) response (MSC Server to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the MSC Server sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. \n25:\tSIP REFER request (SCC AS to Intermediate IM CN subsystem entities) -see example in table\u00a0A.15.2-25\n\tThe SCC AS sends SIP REFER request towards UE A inside the dialog created by the message 13.\nTable\u00a0A.15.2-25: SIP REFER request (SCC AS to IM CN subsystem entities)\nREFER sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6 SIP/2.0\nVia: SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bk731b8a\nMax-Forwards: 70\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nFrom: <tel:+1-237-555-2222>; tag=aasdfgaag\nTo: <sip:user1_public1@home1.net>; tag=171828\nCall-ID: cb03a0s09a2sdfglkj490237\nCseq: 55998 REFER\nContent-Length: ...\nRoute: <sip:scscf1.home1.net;lr>, <sip:pcscf1.home1.net:7531;lr>\nContact: <sip:sccas1.home1.net;gr>\nRefer-Sub: false\nSupported: norefersub, gruu\nRefer-To: <sip:additional.session.xfer@sccas.home1.net?Target-Dialog=a84b4c76e66710%3Bremote-tag=654364735%3Blocal-tag=1928301774&Require=tdialog&From=tel:+1-237-555-1111&To=tel:+1-987-654-3210&Content-Type=application%2Fsdp&body=v%3D0%0D%0Ao%3D-%202987933623%202987933623%20IN%20IP6%205555::ggg:fff:aaa:bbb%0D%0As%3D-%0D%0Ac%3DIN%20IP6%205555::ggg:fff:aaa:bbb%0D%0At%3D0%200%0D%0Am%3Dvideo%200%20RTP%2FAVP%2098%0D%0Am%3Daudio%203456%20RTP%2FAVP%2097%2096%0D%0Ab%3DAS:25.4%0D%0Aa%3Drtpmap:97%20AMR%0D%0Aa%3Dfmtp:97%20mode-set%3D0%2C2%2C5%2C7%3B%20mode-change-period%3D2%0D%0Aa%3Dmaxptime:20%0D%0A>\nContent-Type: application/vnd.3gpp.mid-call+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<mid-call/>\n\n\tRefer-To:\t\tcontains the additional transferred session SCC AS URI and the following URI header fields:\n\t\tTarget-Dialog:\tthe dialog identifier of the source access leg.\n\t\tRequire:\tcontaining \"tdialog\" option tag\n\t\tFrom:\t\tcontains the public user identity of the UE A\n\t\tTo:\t\tcontains the public user identity of the UE C\n\t\tContent-Type:\tcontaining \"application/sdp\" MIME type of the \"body\" URI header field\n\t\tbody:\t\tSDP describing the media used in the session\n26.\tSIP REFER request (intermediate IM CN subsystem entities to UE A)\n\tThe SIP REFER request is forwarded towards the UE A.\n27-28.\tSIP 202 (Accepted) response (UE A to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP REFER request, the UE A sends a SIP 202 (Accepted) response.\n29.\tSIP INVITE request transferring the held session Y (SC UE A to intermediate IM CN subsystem entities) - see example in table\u00a0A.15.2-29\n\tThe SC UE A sends an initial SIP INVITE request to request the new call replacing the existing call Y.\nTable\u00a0A.15.2-29: SIP INVITE request (UE A to intermediate IM CN subsystem entities)\nINVITE sip:additional.session.xfer@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.home1.net:7531;lr>, <sip:orig@scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info: IEEE-802.11b\nPrivacy: none\nFrom: <tel:+1-237-555-1111>; tag=171828\nTo: <tel:+1-987-654-3210>\nCall-ID: asdfqweasas\nCseq: 127 INVITE \nSupported: 100rel, precondition, 199, gruu\nRequire: sec-agree\nProxy-Require: sec-agree\nSecurity-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321; port1=7531\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6> ;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\";+g.3gpp.mid-call\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE\nAccept: application/sdp; application/3gpp-ims+xml\nTarget-Dialog: a84b4c76e66710;remote-tag=654364735;local-tag=1928301774\nContent-Type: application/sdp\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=\nc=IN IP6 5555::aaa:bbb:ccc:ddd\nt=0 0\nm=video 0 RTP/AVP 98\nm=audio 3456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos loca\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1l sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\na=sendonly\n\n\tRequest-URI:\tcontains the additional transferred session SCC AS URI as received in the Refer-To URI in the SIP REFER request.\n\tTarget-Dialog:\tcontains the dialog identifier as received in the Refer-To URI in the SIP REFER request.\n\tContact:\tcontains the g.3gpp.mid-call media feature tag as defined in annex\u00a0C indicating the support for the MSC server assisted mid-call feature.\n\tSDP:\tAll the media are offered with the sendonly directionality.\n30.\tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n31.\tSIP INVITE request (intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP INVITE request is forwarded to the SCC AS as the result of the evaluation of iFC.\n32.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n33.\tSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS modifies the message in accordance with routeing B2BUA functionality, e.g. mapping of From, To, Cseq and Call-ID header fields from one side of the B2BUA to the other. The SIP re-INVITE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the initial SIP INVITE request from the UE A.\n34.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE C)\n\tThe intermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE C.\n35-36:\tSIP 200 (OK) response (UE C to SCC AS via Intermediate IM CN subsystem entities)\n\tThe UE C generates the SIP 200 (OK) response to the SIP re-INVITE request and forwards it to the SCC AS.\n37-38:\tSIP ACK request (SCC AS to UE C via Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the remote UE C.\n39:\tSIP 200 (OK) response (SCC AS to Intermediate IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request and forwards it to the SC UE A.\n40:\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to UE A)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request and forwards it to the SC UE A.\n41-42:\tSIP ACK request (SC UE A to SCC AS via Intermediate IM CN subsystem entities) \n\tThe SC UE A generates the SIP ACK request to the SIP 200 (OK) response and forwards it to the SCC AS\n43.\tMedia paths between UE A and UE B\n\tThe media paths of session X and session Y are using the new IP-CAN but the the CS bearer is still not released.\n44-45.\tSIP BYE request (SCC AS to MSC Server via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg, which was using the CS bearer, by sending a SIP BYE request.\n46-48.\tCC DISCONNECT message (interworking entities to SC UE A)\n\tUpon receiving the CC DISCONNECT message, the SC UE A relinquishes all resources pertaining to the CS bearer.\n\n49-50.\tSIP 200 (OK) response (MSC Server to SCC AS via intermediate IM CN subsystem entities)\n51.\tMedia paths between UE A and UE B\n\tThe media paths of session X and session Y are using the new IP-CAN.\n\n\n*** SEVENTH CHANGE ***\nA.15.3\tPS to CS access transfer with MSC server assisted mid-call feature\nIn the example flow at the figure\u00a0A.15.3-1, SC UE A has two ongoing sessions over PS bearer which are anchored at SCC AS. When both sessions were established the SC UE and the SCC AS included the g.3gpp.mid-call media feature tag as specified in annex\u00a0C into the Contact header fields. The active session X is with UE B, the held session Y is with UE C. The session X and session Y are two party sessions. The session Y contains a rejected video stream and an accepted speech media component. When the SC UE attaches to the CS domain, it decides to transfer the sessions over the CS bearer without using the ICS capability.\n\n\nFigure\u00a0A.15.3-1: Signalling flow for PS-CS access transfer: PS-CS\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tSC UE A is on an active session X with UE B and a held session Y with UE C:\n\tThere is an ongoing IP bearer between the SC UE and the remote UE B and another IP bearer between the SC UE and the remote UE C. Both sessions are anchored at SCC AS.\n2. SC UE A attaches to the CS domain\n\tThe SC UE attaches to the CS domain and decides to transfer the sessions over the CS bearer.\n3.\tCC SETUP messages\n\tTransaction Identifier:\t3\n4.\tSIP INVITE request transferring the active session X (MSC Server to Intermediate IM CN subsystem entities) -see example in table\u00a0A.15.3-4\n\tUpon receiving the CC SETUP message the MSC Server sends a SIP INVITE request and associates the transaction identifier 3 with the SIP INVITE request.\nTable\u00a0A.15.3-4: SIP INVITE request (MSC Server to intermediate IM CN subsystem entities) \nINVITE tel:+1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.home1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490333 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu, 199, norefersub\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6> ;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\" ;+g.3gpp.ics=\"server\";+g.3gpp.mid-call\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nContent-Type: application/sdp \nContent-Length: (\u2026)\nAccept: application/sdp; application/3gpp-ims+xml, application/vnd.3gpp.mid-call+xml \nRecv-Info: g.3gpp.mid-call\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the IMRN, as obtained from CS networks signalling.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MSC Server.\n\tContact:\tcontains the g.3gpp.mid-call media feature tag as defined in annex\u00a0C indicating the support for the MSC server assisted mid-call feature.\n\tAccept:\tcontains the MSC Server assisted mid-call feature MIME type.\n5.\tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n6.\tSIP INVITE request (Intermediate IM CN subsystem entities to SCC AS)\n7.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n8.\tSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acting as a routing B2BUA generates a SIP re-INVITE request based upon the received SIP INVITE request and the information previously stored against this session and routes it towards UE B via the intermediate IM CN subsystem entities.\n9.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE B)\n\tIntermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE B.\n10.\tSIP 200 (OK) response (UE B to intermediate IM CN subsystem entities)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer, since the UE B has all resources available, it sends immediately the SIP 200 (OK) response to the SIP re-INVITE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n11.\tSIP 200 (OK) response (intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SIP re-INVITE request to the SCC AS in the originating network.\n12-13.\tSIP ACK request (SCC AS to UE B via IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response, and forwards the SIP ACK request to the remote UE B.\n14-15.\tSIP 200 (OK) response (SCC AS to MSC Server via IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response towards the MSC Server. \n16.\tCC CONNECT message (MSC Server to SC UE A)\n\t17.\tCC CONNECT ACKNOWLEDGEMENT message (SC UE A to MSC Server)\n18-19.\tSIP ACK request (MSC Server to SCC AS via IM CN subsystem entities)\n\tThe MSC Server generates the SIP ACK request to the SIP 200 (OK) response, and forwards it to the SCC AS.\n20.\tMedia paths between SC UE A and UE B:\n\tThe CS bearer is setup while the PS bearers are still existing. \n21-22:\tSIP BYE request (SCC AS to SC UE A via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg of the session X, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n23-24.\tSIP 200 (OK) response (SC UE A to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the SC UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the SC UE A relinquishes all resources pertaining to the old IP-CAN.\n\n25.\tMedia paths between SC UE A and UE B\n\tThe session X is transferred from PS bearer to CS bearer, but the session Y is still at the PS bearer.\n26.\tSIP REFER request (SCC AS to IM CN subsystem entities) -see example in table\u00a0A.15.3-26\n\tThe SCC AS sends SIP REFER request towards MSC Server inside the dialog created by the the message 14.\nTable\u00a0A.15.3-26: SIP REFER request (SCC AS to IM CN subsystem entities) \nREFER sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6 SIP/2.0\nVia: SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bk731b8a\nMax-Forwards: 70\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nTo: <tel:+1-237-555-1111>;tag=171828\nFrom: <tel:+1-237-555-3333>;tag=sdfsdf\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 55998 REFER\nContent-Length: 125\nRoute: <sip:scscf1.home1.net;lr>\nRefer-Sub: false\nSupported: norefersub, gruu\nContact: sip:sccas1.home1.net\nRefer-To: <additional.session.xfer@sccas.home1.net?Target-Dialog=ksdjfhwrklf%3Bremote-tag=676723565%3Blocal-tag=45418454&Require=tdialog&From=tel:+1-237-555-1111&To=tel:+1-987-654-3210&Content-Type=application%2Fsdp&body=v%3D0%0D%0Ao%3D-%202987933623%202987933623%20IN%20IP6%205555::ggg:fff:aaa:bbb%0D%0As%3D-%0D%0Ac%3DIN%20IP6%205555::ggg:fff:aaa:bbb%0D%0At%3D0%200%0D%0Am%3Dvideo%200%20RTP%2FAVP%2098%0D%0Am%3Daudio%203456%20RTP%2FAVP%2097%2096%0D%0Ab%3DAS:25.4%0D%0Aa%3Drtpmap:97%20AMR%0D%0Aa%3Dfmtp:97%20mode-set%3D0%2C2%2C5%2C7%3B%20mode-change-period%3D2%0D%0Aa%3Dmaxptime:20%0D%0A>\nContent-Type: application/vnd.3gpp.mid-call+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<mid-call/>\n\n\tRefer-To:\t\tcontains the additional transferred session SCC AS URI and the following URI header fields:\n\t\tTarget-Dialog:\tthe dialog identifier of the source access leg.\n\t\tRequire:\tcontaining \"tdialog\" option tag\n\t\tFrom:\t\tcontains the public user identity of the UE A\n\t\tTo:\t\tcontains the public user identity of the UE C\n\t\tContent-Type:\tcontaining \"application/sdp\" MIME type of the \"body\" URI header field\n\t\tbody:\t\tSDP describing the media used in the session\n27.\tSIP REFER request (intermediate IM CN subsystem entities to MSC Server)\n\tThe SIP REFER request is forwarded towards the MSC Server.\n28-29.\tSIP 202 (Accepted) response (MSC Server to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP REFER request, the MSC Server sends a SIP 202 (Accepted) response.\n30.\tSIP INVITE request for the held session Y (MSC Server to Intermediate IM CN subsystem entities) -see example in table\u00a0A.15.3-30\n\tUpon receiving the SIP REFER request the MSC Server sends a SIP INVITE request and associates the transaction identifier 4 with the SIP INVITE request.\nTable\u00a0A.15.3-30: SIP INVITE request (MSC Server to intermediate IM CN subsystem entities) \nINVITE \nsip:additional.session.xfer@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP msc1.home1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-987-654-3210>\nCall-ID: asdfgqwerq \nCseq: 1275 INVITE\nSupported: 100rel, precondition, 199, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6> ;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\" ;+g.3gpp.ics=\"server\";+g.3gpp.mid-call\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nContent-Type: application/sdp \nTarget-Dialog: ksdjfhwrklf;remote-tag=676723565;local-tag=45418454\nRequire: tdialog\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=video 0 RTP/AVP 98\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\na=sendonly\n\n\tRequest-URI:\tcontains the additional transferred session SCC AS URI as received in the Refer-To URI in the SIP REFER request.\n\tTarget-Dialog:\tcontains the dialog identifier as received in the Refer-To URI in the SIP REFER request.\n\tContact:\tcontains the g.3gpp.mid-call media feature tag as defined in annex\u00a0C indicating the support for the MSC server assisted mid-call feature.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MSC Server. All the media are offered with the sendonly directionality.\n31.\tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n32.\tSIP INVITE request (Intermediate IM CN subsystem entities to SCC AS)\n33.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n34.\tSIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities) \n\tThe SCC AS acting as a routing B2BUA generates a SIP INVITE request based upon the received SIP INVITE request and the information previously stored against this session and routes it towards UE C via the intermediate IM CN subsystem entities. The SIP re-INVITE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the initial SIP INVITE request from the UE A.\n35.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to UE C)\n\tIntermediate IM CN subsystem entities forward the SIP re-INVITE request to remote UE C.\n36.\tSIP 200 (OK) response (UE C to intermediate IM CN subsystem entities)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer, since the UE C has all resources available, it sends immediately the SIP 200 (OK) response to the SIP re-INVITE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n37.\tSIP 200 (OK) response (intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SIP re-INVITE request to the SCC AS in the originating network.\n38-39.\tSIP ACK request (SCC AS to UE C via IM CN subsystem entities)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response, and forwards the SIP ACK request to the remote UE C.\n40.\tSIP 200 (OK) response (SCC AS to IM CN subsystem entities)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response towards the MSC Server. \n41.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to MSC Server)\n\tIntermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SIP INVITE request to MSC Server.\n42-43.\tSIP ACK request (MSC Server to SCC AS via IM CN subsystem entities)\n\tThe MSC Server generates the SIP ACK request to the SIP 200 (OK) response, and forwards it to the SCC AS.\n44.\tMedia paths between SC UE A and UE B:\n\tThe CS bearer and PS bearers for both the sessions are established but there is still the original IP bearer for the held session Y.\n45-46:\tSIP BYE request (SCC AS to SC UE A via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg of the session Y, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n47-48.\tSIP 200 (OK) response (SC UE A to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the SC UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the SC UE A relinquishes all resources pertaining to the old IP-CAN.\n\n49.\tMedia paths between SC UE A and UE B\n\tBoth sessions X and Y are transferred from PS bearer to CS bearer.\n\n\n*** EIGHTH CHANGE ***\nA.15.4\tPS to CS access transfer with MSC server assisted mid-call feature with an incoming waiting call in alerting phase\nIn the example flow at the figure\u00a0A.15.4-1, SC UE A has an ongoing sessions with speech media component and an incoming waiting session with speech media component which are anchored at SCC AS. The incoming waiting call is in alerting state. The ongoing session X is with UE B, the incoming waiting session Y is with UE C. The session X and session Y are two party sessions. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC procedure to CS access.\n\nFigure\u00a0A.15.4-1: Signalling flow for PS to CS access transfer with MSC server assisted mid-call feature with an incoming waiting call in alerting phase\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tSC UE A is on an active session X with UE B and an incoming waiting session Y with UE C:\n\tThere is an ongoing PS bearer between the SC UE and the remote UE B and another PS bearer between the SC UE and the remote UE C. Both sessions are anchored at SCC AS.\n2.\tSC UE A sends the measurement reports to E-UTRAN\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.237\u00a0[9].\n3-24.\tAccess transfer for the active session X\n\tThe procedure for transfering the active session X is the same as described in subclause\u00a0A.15.3.\n25.\tMedia paths between SC UE A and UE B\n\tThe session X is transferred from PS bearer to CS bearer, but the session Y is still at the PS bearer.\n26.\tSIP REFER request (SCC AS to IM CN subsystem entities) -see example in table\u00a0A.15.4-26\n\tThe SCC AS sends SIP REFER request towards MSC server inside the dialog created by the the message 14, and it also contain the state-and-event-info XML body to indicate that the additional session is an incoming session in alerting phase.\nTable\u00a0A.15.4-26: SIP REFER request (SCC AS to IM CN subsystem entities) \nREFER sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6 SIP/2.0\nVia: SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bk731b8a\nMax-Forwards: 70\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nTo: <tel:+1-237-555-1111>;tag=171828\nFrom: <tel:+1-237-555-3333>;tag=sdfsdf\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 55998 REFER\nContent-Length: 125\nRoute: <sip:scscf1.home1.net;lr>\nRefer-Sub: false\nSupported: norefersub, gruu\nContact: sip:sccas1.home1.net\nRefer-To: <additional.session.xfer@sccas.home1.net?Target-Dialog=ksdjfhwrklf%3Bremote-tag=676723565%3Blocal-tag=45418454&Require=tdialog&From=tel:+1-237-555-1111&To=tel:+1-987-654-3210&Content-Type=application%2Fsdp&body=v%3D0%0D%0Ao%3D-%202987933623%202987933623%20IN%20IP6%205555::ggg:fff:aaa:bbb%0D%0As%3D-%0D%0Ac%3DIN%20IP6%205555::ggg:fff:aaa:bbb%0D%0At%3D0%200%0D%0Aaudio%203456%20RTP%2FAVP%2097%2096%0D%0Ab%3DAS:25.4%0D%0Aa%3Drtpmap:97%20AMR%0D%0Aa%3Dfmtp:97%20mode-set%3D0%2C2%2C5%2C7%3B%20mode-change-period%3D2%0D%0Aa%3Dmaxptime:20%0D%0A>\nContent-Type: boundary=boundary1\n\n--boundary1\nContent-Type: application/vnd.3gpp.mid-call+xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<mid-call/>\n\n--boundary1\nContent-Type: application/vnd.3gpp.state-and-event-info+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n    <state-info>early</state-info>\n    <direction>receiver</direction>\n</state-and-event-info>\n\n--boundary--\n\n\t\tRefer-To:\t\tcontains the additional transferred session SCC AS URI and the following URI header fields:\n\t\tTarget-Dialog:\tthe dialog identifier of the source access leg.\n\t\tRequire:\tcontaining \"tdialog\" option tag\n\t\tFrom:\t\tcontains the public user identity of the UE A\n\t\tTo:\t\tcontains the public user identity of the UE C\n\t\tContent-Type:\tcontaining \"application/sdp\" MIME type of the \"body\" URI header field\n\t\tbody:\t\tSDP describing the media used in the session.\n\t\tXML Schema:\tcontain the session state information that the additional session is an incoming session in alerting state.\n27.\tSIP REFER request (intermediate IM CN subsystem entities to MSC server)\n\tThe SIP REFER request is forwarded towards the MSC server.\n28-29.\tSIP 202 (Accepted) response (MSC server to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP REFER request, the MSC server sends a SIP 202 (Accepted) response.\n30.\tSIP INVITE request for the held session Y (MSC server to Intermediate IM CN subsystem entities) -see example in table\u00a0A.15.4-30\n\tUpon receiving the SIP REFER request which contain the session state information to indicate that the additional session in an incoming session in alerting state, the MSC server moves to Call Received state as described in the SIP REFER request but does not generate an in-band ring tone to the calling party, and sends a SIP INVITE request and associates the transaction identifier with the SIP INVITE request.\nTable\u00a0A.15.4-30: SIP INVITE request (MSC server to intermediate IM CN subsystem entities) \nINVITE \nsip:additional.session.xfer@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP msc1.home1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-987-654-3210>\nCall-ID: asdfgqwerq \nCseq: 1275 INVITE\nSupported: 100rel, precondition, 199, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1@home1.net> ;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\" ;+g.3gpp.ics=\"server\";+g.3gpp.mid-call\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nContent-Type: application/sdp \nTarget-Dialog: ksdjfhwrklf;remote-tag=676723565;local-tag=45418454\nRequire: tdialog\nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the additional transferred session SCC AS URI as received in the Refer-To URI in the SIP REFER request.\n\tTarget-Dialog:\tcontains the dialog identifier as received in the Refer-To URI in the SIP REFER request.\n\tContact:\tcontains the g.3gpp.mid-call media feature tag as defined in annex\u00a0C indicating the support for the MSC server assisted mid-call feature.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MSC server. \n31.\tEvaluation of initial filter criteria\n\tThe S-CSCF evaluates initial filter criteria for the served SC user and as a result routes the SIP INVITE request towards the SCC AS.\n32.\tSIP INVITE request (Intermediate IM CN subsystem entities to SCC AS)\n33.\tRemote Leg Update\n\tThe SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n34.\tSIP UPDATE request (SCC AS to intermediate IM CN subsystem entities) \n\tThe SCC AS acting as a routing B2BUA generates a SIP UPDATE request based upon the received SIP INVITE request and the information previously stored against this session and routes it towards UE C via the intermediate IM CN subsystem entities. The SIP UPDATE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the initial SIP INVITE request from the UE A.\n35.\tSIP UPDATE request (Intermediate IM CN subsystem entities to UE C)\n\tIntermediate IM CN subsystem entities forward the SIP UPDATE request to remote UE C.\n36.\tSIP 200 (OK) response (UE C to intermediate IM CN subsystem entities)\n\tUpon receiving the SIP UPDATE request containing the SDP offer, since the UE C has all resources available, it sends immediately the SIP 200 (OK) response to the SIP UPDATE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n37.\tSIP 200 (OK) response (intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SIP UPDATE request to the SCC AS in the originating network.\n38-39.\tSIP 183 (Session Progress) response (SCC AS to MSC server via IM CN subsystem entities)\n\tThe SCC AS sends a 183 (Session Progress) containing the SDP answer as received from the UE C. The SDP answer indicates that resources are available\n40. SIP PRACK request (MSC Server to Intermediate IM CN subsystem entities)\n\tThe MSC server acknowledges the receipt of the 183 Session Progress. \n41.\tSIP PRACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem forward the SIP PRACK request to the SCC AS\n42-43.\tSIP 200 (OK) response (SCC AS to MSC server via IM CN subsystem entities)\n\tThe SCC AS acknowledges the PRACK with a SIP 200 (OK) response to the MSC server.\n44.\tCS HOLD Message (SC UE to MSC server)\n\tThe SC UE A put the active session on hold.\n45.\tSIP re-INVITE request (MSC server to intermediate IM CN subsystem entities)\n\tUpon receiving the CS HOLD Message from the UE, MSC server sends a SIP re-INVITE request towords session X, which put session X on hold.The SDP in this SIP re-INVITE request is based on the last SDP offer/answer negotiation for the active session transfer form step 3 to 24, but for each media streams set the SDP attribute to \"sendonly\".\n46.\tSIP re-INVITE request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP re-INVITE request is forwarded to the SCC AS.\n47-48.\tSIP re-INVITE request (SCC AS to UE B)\n\tSCC AS sends SIP re-INVITE request to UE B, The SIP re-INVITE request contains the SDP offer that is identical to the SDP offer that the SCC AS received in the SIP re-INVITE request from the MSC server.\n49-50.\tSIP 200 (OK) response (UE B to SCC AS)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer which contain the SDP attribute for each media streams to \"sendonly\", UE B response the SIP re-INVITE request with a SIP 200 (OK), which set the SDP attribute for each media streams to \"receonly\".\n51-52.\tSIP ACK request (SCC AS to UE B)\n53-54.\tSIP 200 (OK) response (SCC AS to MSC server via intermediate IM CN subsystem entities )\n\tThe SCC AS sends 200 (OK) to indicate the succesfull activity to the MSC server that put session X on hold.\n55.\tCS HOLD ACKNOWLEDGE Message (MSC server to SC UE A)\n56-57.\tSIP ACK request (MSC server to SCC AS via intermediate IM CN subsystem entities)\n\tMSC server acknowledges the 200 OK received from SCC AS.\n58.\tCS Connect Message from SC UE A to MSC server\n\tThe SC UE A accepts the call and sends CS Connect Message.\n59.\tSIP INFO request (MSC server to intermediate IM CN subsystem entities) - see example in table\u00a0A.15.4-59\nA.15.4-59: INFO (SCC AS to intermediate IM CN subsystem entities)\nINFO sip:sccas1.home1.net;gr SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 68\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>;tag=171828\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 130 INFO\nInfo-Package: g.3gpp.state-and-event\nContent-Type: application/vnd.3gpp.state-and-event-info+xml\nContent-Length: \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n   <event>call-accepted</event>\n</state-and-event-info>\n\n\n\t\tXML Schema:\tcontain the session state information indicating that the remote party has answered the call.\n\n60.\tSIP INFO request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP INFO request to the SCC AS. The SCC AS gets informed that the SC UE A has accepted the call.\n61.\tSIP 200 (OK) response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the receipt of the SIP INFO request indicating that the SC UE A has accepted the call\n62.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe SIP 200 (OK)response is forwarded to the MSC server.\n63.\tSIP 200 (OK) response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS sends SIP 200 (OK) response to indicate to the far end that the SC UE A has accepted the call.\n64.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to far end) \n\tThe SIP 200 (OK) response is forwarded to the far end)\n65.\tSIP ACK request (far end to intermediate IM CN subsystem entities)\n\tThe far end UE acknowledges the SIP 200 (OK) response received from the SCC AS\n66.\tSIP ACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP ACK request is forwarded to the SCC AS.\n67.\tSIP 200 (OK) response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS sends 200 (OK) response to indicate the succesfull access transfer to the MSC server.\n68.\tSIP 200 (OK) response (Intermdeiat IM CN subsystem entities to far end) \n\tThe SIP 200 (OK) response is forwarded to the MSC server.\n69.\tCS Connect Ack (MSC server to SC UE A) \n70.\tSIP ACK request (MSC server to intermediate IM CN subsystem entities)\n\tMSC server acknowledges the SIP 200 (OK) response received from SCC AS.\n71.\tSIP ACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP ACK request is forwarded to the SCC AS.\n72-73:\tSIP BYE request (SCC AS to SC UE A via intermediate IM CN subsystem entities)\n\tThe SCC AS terminates the replaced call leg of the session Y, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n74-75.\tSIP 200 (OK) response (SC UE A to SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the SC UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the SC UE A relinquishes all resources pertaining to the old IP-CAN.\n\n76.\tMedia paths between SC UE A and UE B\n\tBoth sessions X and Y are transferred from PS bearer to CS bearer.\n\n\n*** NINETH CHANGE ***\nA.16.3\tSession transfer for emergency session using SRVCC procedure: PS-CS\nIn the example in figure\u00a0A.16.3-1, UE A (which has a valid subscription, is authenticated and authorized for PS service and is normal attached to the network) has an ongoing emergency session with a PSAP using a PS bearer which is anchored at EATF. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC handover to CS access.\n\nFigure\u00a0A.16.3-1 Signalling flow for emergency session transfer using SRVCC procedure\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tUE A is on an active emergency session with a PSAP\n\tThere is an ongoing IP bearer between the UE A and the remote end PSAP. The call is achored at EATF.\n2.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC Server initiates the session transfer with the E-STN-SR, refer to 3GPP\u00a0TS\u00a023.237\u00a0[9].\n3.\tSIP INVITE request (Interworking entities to Intermediate IM CN subsystem entities) -see example in table\u00a0A.16.3-2\nTable\u00a0A.16.3-2: SIP INVITE request (interworking entities to intermediate IM CN subsystem entities)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nRoute: <sip:icscf1.visit1.net;lr>\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net>;+sip.instance=\"<urn:gsma:imei:90420156-025763-0>\";+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the E-STN-SR, as routed to the EATF\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MGW.\n\tContact:\tcontains the \"sip.instance\" media feature tag as specified in IETF\u00a0RFC\u00a05626\u00a0[22] with a value formed from an IMEI as defined in 3GPP\u00a0TS\u00a023.003\u00a0[12].\n4.\tSIP INVITE request\n\tThe I-CSCF routes the SIP INVITE request directly to the EATF by using the procedure defined in 3GPP\u00a0TS\u00a023.228\u00a0[15] for PSI based application Server termination.\nNOTE\u00a02:\tThe use of indirect routing for PSI based Application Server Termination as described in 3GPP\u00a0TS\u00a023.228\u00a0[15] in subclause\u00a05.7.6 cannot be used for routing the SIP INVITE request to the EATF.\n5.\tRemote Leg Update\n\tThe EATF based on the content of the \"gr\" parameter in the Contact header field correlates the SIP INVITE request to the local and remote call legs of the existing session between the UE A and the remote end. The EATF performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n6.\tSIP re-INVITE request (EATF to intermediate IM CN subsystem entities) \u2013see example in table\u00a0A.16.3-3\nTheEATF acting as a routing B2BUA generates a SIP INVITE request based upon the received SIP INVITE request and the information previously stored against this session and routes it towards PSAP via the intermediate IM CN subsystem entities.\nTable\u00a0A.16.3-3: SIP re-INVITE request (SCC AS to intermediate IM CN subsystem entities)\nINVITE urn:service:sos.fire SIP/2.0\nVia: SIP/2.0/UDP esccas1.home1.net;branch=z9hG4bKnas34r5\nMax-Forwards: 68\nRoute: <sip:ecscf1.home1.net:lr>\nP-Asserted-Identity: <tel: +1-237-555-1111>\nP-Charging-Function-Addresses: ccf=[5555::b99:c88:d77:e66]; ccf=[5555::a55:b44:c33:d22]; ecf=[5555::1ff:2ee:3dd:4ee]; ecf=[5555::6aa:7bb:8cc:9dd]\nP-Charging-Vector: icid-value=\"BzyretyU0dm+6O2IrT5tAFrbHLso=023551034\"; orig-ioi=\"type3home1.net\" \nPrivacy: none\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: <urn:service:sos.fire>;tag=232456\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: \nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+sip.instance=\"<urn:gsma:imei:90420156-025763-0>\"\nAllow:\nContent-Type: Content-Length:\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVPF 97 96\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\nm=message 0 TCP/MSRP 98\na=accept-types:text/plain\n\n7.\tSIP re-INVITE request (E-CSCF to PSAP)\n\tE-CSCF forward the SIP re-INVITE request to the PSAP.\n8.\tSIP 200 (OK) response (PSAP to E-CSCF)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer, since the PSAP has all resources available, it sends immediately the SIP 200 (OK) response to the SIP re-INVITE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n9.\tSIP 200 (OK) response (E-CSCF to EATF)\n\tE-CSCF forward the SIP 200 (OK) response to the SIP re-INVITE request to the EATF in the originating network.\n10-11.\tSIP ACK request (EATF to PSAP via IM CN subsystem entities)\n\tThe EATF generates the SIP ACK request to the SIP 200 (OK) response, and forwards the SIP ACK request to the PSAP.\n12-13.\tSIP 200 (OK) response (EATF to interworking entities via IM CN subsystem entities)\n\tThe E- SCC AS generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response to the interworking entities.\n14-15.\tSIP ACK request (interworking entities to EATF via IM CN subsystem entities)\n\tThe interworking entities generate the SIP ACK request to the SIP 200 (OK) response, and forward the SIP ACK request to the EATF.\n16-18:\tSIP BYE request (EATF to UE A via intermediate IM CN subsystem entities)\n\tThe EATF terminates the source access leg, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n19-21.\tSIP 200 (OK) response (UE A to E- SCC AS via intermediate IM CN subsystem entities)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the UE A sends a SIP 200 (OK) response over the old IP-CAN to the EATF. Subsequently, the UE A relinquishes all resources pertaining to the old IP-CAN.\n\n\n22a.\tCS bearer establishment (interworking entities to UE A)\n22b.\tIP bearer establishment (interworking entities to PSAP)\n\n\n*** TENTH CHANGE ***\nA.17.2\tSession transfer for incoming call is in alerting phase using SRVCC procedure: PS to CS \nIn the example flow at the figure\u00a0A.15.2-1, SC UE A has an incoming session with speech media component which is anchored at SCC AS. The session is in alerting phase. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC handover to CS access.\n\n\nFigure\u00a0A.17.2-1: PS-CS SRVCC, incoming call in alerting phase\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tSC UE A has received an incoming call and is in Ringing State\n\tThe incoming call has been anchored at the SCC AS of SC UE A. Both ends have reserved the resources and SC UE A has sent a 180 (Ringing) response.\n2.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.237\u00a0[9]. The UE continues ringing.\n3.\tSIP INVITE request transferring the session (MSC server to intermediate IM CN subsystem entities) - see example in table\u00a0A.17.2-1\n\tThe MSC server sends an initial SIP INVITE request with STN SR\nTable A.17.2-1: SIP INVITE request (MSC server to intermediate IM CN subsystem entities)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nRoute: <sip:icscf1.visit1.net;lr>\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nRecv-Info: g.3gpp.state-and-event-info\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the STN-SR.\n\tSDP:\tThe SDP contains set of codecs supported by the MGW.\n4.\tSIP INVITE request transferring the session (intermediate IM CN subsystem entities to SCC AS) \nThe SIP INVITE request is routed towards the SCC AS, based on filter criteria in S-CSCF.\n4a.\tRemote Leg Update\n\tThe SCC AS correlates SIP INVITE request to the local and remote call legs of the existing session between the UE A and the remote end. The SCC AS performs the Remote Leg update by sending the SIP sending a SIP UPDATE request towards the Remote Leg.\n5.\tSIP UPDATE request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acting as a B2BUA generates a SIP UPDATE request based upon the received SIP INVITE request and the information previously stored against this session .\n6.\tSIP UPDATE request (Intermediate IM CN subsystem entities to UE B)\n\tThe intermediate IM CN subsystem entities forward the SIP UPDATE request to remote UE B.\n7.\tSIP 200 (OK) response (far end UE to Intermediate IM CN subsystem entities)\n\tUpon receiving the SIP UPDATE request containing the SDP offer for the leg to the MSC, the far end sends a SIP 200 (OK) response.\n8.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SCC AS.\n9.\tSIP 183 (Session Progress) response (SCC AS to Intermediate IM CN subsystem entities)\n\tThe SCC AS sends a 183 (Session Progress) containing the SDP answer as received from the far end UE. The SDP answer indicates that resources are available. The SIP 183 (Session Progress) will contain a Recv-Info header field set to g.3gpp.state-and-event-info.\n10.\tSIP 183 (Session Progress) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the 183 (Session Progress) to the MSC server.\n11.\tSIP PRACK request (MSC server to Intermediate IM CN subsystem entities)\n\tThe MSC acknowledges the receipt of the 183 Session Progress..\n12.\tSIP PRACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem forward the SIP PRACK request to the SCC AS.\n13.\tSIP 200 (OK) response (SCC AS to Intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the PRACK\n14.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forwards the SIP 200 (OK) reponse to the MSC server.\n15.\tSIP INFO request (SCC AS to intermediate IM CN subsystem entities) - see example in table\u00a0A.17.2-2\nTable A.17.2-2: INFO request (SCC AS to intermediate IM CN subsystem entities)\nINFO sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6SIP/2.0\nVia SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bK332b23.1\nMax-Forwards: 68\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <tel: +1-237-555-3333>;tag=314159\nTo: <tel:+1-237-555-1111>;tag=171828\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 129 INFO\nInfo-Package: g.3gpp.state-and-event-info\nContent-Type: application/vnd.3gpp.state-and-event-info+xmls\nContent-Length: \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n   <state-info>early</state-info>\n   <direction>receiver</direction>\n</state-and-event-info>\n\n16.\tSIP INFO request (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the SIP INFO request to the MSC server. The MSC server is aware that the call that is transferred is in terminating alerting state. \n17.\tSIP 200 (OK) response (MSC server to Intermediate IM CN subsystem entities)\n\tThe MSC server acknowledges the receipt of the SIP INFO request.\n18.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forwards the SIP 200 (OK) response to the SCC AS.\n19.\tMSC goes in Call received state\n\tThe MSC enters Call received state due to the information received in the INFO request.\n20a.\tUser answers the call\n20.\tCS Connect Message from SC UE A to MSC server\nThe SC UE A accepts the call and sends CS Connect Message.\n21.\t\tSIP INFO request (MSC server to intermediate IM CN subsystem entities) - see example in table\u00a0A.17.2-3\nTable A.17.2-3: INFO request (SCC AS to intermediate IM CN subsystem entities)\nINFO sip:sccas1.home1.net;gr SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 68\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>;tag=171828\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 130 INFO\nInfo-Package: g. 3gpp.state-and-event-info\nContent-Type: application/vnd.3gpp.state-and-event-info+xmls\nContent-Length: \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n   <event>call-accepted</event>\n</state-and-event-info>\n\n22.\tSIP INFO request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP INFO request to the SCC AS. The SCC AS gets informed that the SC UE A has accepted the call.\n23\tSIP 200 (OK)  response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the receipt of the INFO request indicating that the SC UE A has accepted the call\n24\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe SIP 200 (OK) response is forwarded to the MSC server.\n25\tSIP 200 (OK) response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS sends a SIP 200 (OK) response to indicate to the far end that the SC UE A has accepted the call.\n26\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to far end) \n\tThe SIP 200 (OK) response is forwarded to the far end)\n27\tSIP ACK request (far end to intermediate IM CN subsystem entities)\n\tThe far end UE  acknowledges the SIP 200 (OK) response received from SCC AS\n28\tSIP ACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP ACK request is forwarded to the SCC AS.\n29\tSIP 200 (OK)  response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS sends a SIP 200 (OK) response to indicate the successful access transfer to the MSC server.\n30\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to far end) \n\tThe SIP 200 (OK) response is forwarded to the MSC server.\n31\tCS Connect Ack (MSC server to SC UE A) \n32\tSIP ACK request (MSC server to intermediate IM CN subsystem entities)\n\tMSC server acknowledges the 200 OK received from SCC AS\nSIP ACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP ACK request is forwarded to the SCC AS.\n34-41\tCANCEL Processing\n\tThe SCC AS cancels the SIP dialog towards the SC UE\n\n\n\n*** ELEVENTH CHANGE ***\nA.17.3\tSession transfer for originating call is in alerting phase using SRVCC procedure: PS to CS \nIn the example flow at the figure\u00a0A.17.3-1, SC UE A has invited for an originating session with speech media component which is anchored at SCC AS. The session is in alerting phase. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC handover to CS access.\n\n\nFigure\u00a0A.17.3-1: PS-CS SRVCC, incoming call in alerting phase\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tSC UE A has setup an outgoing call\n\tThe outgoing call has been anchored at the SCC AS of SC UE A. Both ends have reserved the resources and SC UE A has received a SIP 180 (Ringing) response.\n2.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.237\u00a0[9]. The UE continues ringing.\n3.\tSIP INVITE request transferring the session (MSC server to intermediate IM CN subsystem entities) - see example in table\u00a0A.17.3-1\n\tThe MSC server sends an initial SIP INVITE request with STN-SR\nTable A.17.3-1: SIP INVITE request (MSC server to intermediate IM CN subsystem entities)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nRoute: <sip:icscf1.visit1.net;lr>\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nRecv-Info: g.3gpp.state-and-event-info\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the STN-SR.\n\tSDP:\tThe SDP contains set of codecs supported by the MGW.\n4.\tSIP INVITE request transferring the session (intermediate IM CN subsystem entities to SCC AS)\nThe SIP INVITE is routed towards the SCC AS, based on filter criteria in S-CSCF.\n4a.\tRemote Leg Update\n\tThe SCC AS correlates SIP INVITE request to the local and remote call legs of the existing session between the UE A and the remote end. The SCC AS performs the Remote Leg update by sending SIP UPDATE request towards the Remote Leg.\n5.\tSIP UPDATE request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acting as a B2BUA generates a SIP UPDATE request based upon the received SIP INVITE request and the information previously stored against this session.\n6.\tSIP UPDATE request (Intermediate IM CN subsystem entities to UE B)\n\tThe intermediate IM CN subsystem entities forward the SIP UPDATE request to remote UE B.\n7.\tSIP 200 (OK) response (far end UE to Intermediate IM CN subsystem entities)\n\tUpon receiving the SIP UPDATE request containing the SDP offer for the leg to the MSC, the far end sends 200 OK.\n8.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) response to the SCC AS.\n9.\tSIP 183 (Session Progress) response (SCC AS to Intermediate IM CN subsystem entities)\n\tThe SCC AS sends a 183 (Session Progress) containing the SDP answer as received from the far end UE. The SDP answer indicates that resources are available\n10.\tSIP 183 (Session Progress) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the 183 (Session Progress) to the MSC server.\n11.\tSIP PRACK request (MSC server to Intermediate IM CN subsystem entities)\n\tThe MSC acknowledges the receipt of the 183 Session Progress.\n12.\tSIP PRACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forward the SIP PRACK request to the SCC AS.\n13.\tSIP 200 (OK) response (SCC AS to Intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the PRACK\n14.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the SIP 200 (OK) reponse to the MSC server.\n15.\tSIP INFO request (SCC AS to intermediate IM CN subsystem entities) - see example in table\u00a0A.17.3-2\nTable A.17.3-2: INFO request (SCC AS to intermediate IM CN subsystem entities)\nINFO sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6SIP/2.0\nVia SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bK332b23.1\nMax-Forwards: 68\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <tel: +1-237-555-3333>;tag=314159\nTo: <tel:+1-237-555-1111>;tag=171828\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 129 INFO\nInfo-Package: g.3gpp.state-and-event-info\nContent-Type: application/ vnd.3gpp.state-and-event-info+xmls\nContent-Length: \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n   <state-info>early</state-info>\n   <direction>initiator</direction>\n</state-and-event-info>\n\n16.\tSIP INFO request (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the SIP INFO request to the MSC server. The MSC server is aware that the call that is transferred is in originating alerting state.\n17.\tSIP 200 (OK) response (MSC server to Intermediate IM CN subsystem entities)\n\tThe MSC Server acknowledges the receipt of the SIP INFO request.\n18.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forwards the SIP 200 (OK) response to the SCC AS.\n19.\tMSC goes in Call delivered state\n\tThe MSC enters Call delivered state due to the information received in the SIP INFO request.\n20.\tSIP 200 (OK) response (UE B to intermediate IM CN subsystem entities)\n\tThe UE B accepts the call and sends 200 (OK) response.\n21.\t200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe 200 (OK) response is forwarded to SCC AS.\n22\tSIP 200 (OK) response (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS sends the 200 (OK) response to indicate that the terminating UE B has accepted the call.\n23\t200 (OK) response (Intermediate IM CN subsystem entities to MSC server)\n\tThe 200 (OK) response is forwarded to the MSC server.\n24\tCS CONNECT (MSC server to SC UE A)\n\tThe MSC server indicates to the SC UA A that the far end has accepted the call.\n25\tCS CONNECTACK (MSC server to SC UE A)\n\tSC UE A acknowledges the CS CONNECT.\n26\tSIP ACK request (MSC server to intermediate IM CN subsystem entities)\n\tThe MSC server acknowledges the SIP 200 (OK) response  received from SCC AS\n27.\tSIP ACK request (Intermediate IM CN subsystem entities to SCC AS)\n\tThe SIP ACK request is forwarded to the SCC AS.\n28\tSIP ACK request (SCC AS to intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the SIP 200 (OK) response received towards far end..\n29\tSIP ACK request (Intermediate IM CN subsystem entities to far end) \n\tThe SIP ACK request is forwarded towards the far end.\n30 \u2013 33 The SCC AS releases the original source leg towards the SC UE A\n\tThe SCC AS sends a SIP 404 (Not Found) response in order to release to original source dialog towards the SC UE A\n\n\n\n*** TWELFTH CHANGE ***\nA.17.4\tUser answers in PS domain; Handover to CS successful \nIn the example flow in figure\u00a0A.17.4-1, SC UE A has an incoming session with speech media component which is anchored at SCC AS. The session is in alerting phase. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC handover to CS access. However the user answers the call in E-UTRAN and the SC UE sends a SIP 200 (OK) response to the SCC AS. It this scenario the handover to CS is successful.\n\nFigure\u00a0A.17.4-1: SIP 200 OK from SC UE received by SCC AS: Handover to CS successful\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1\t\tSC UE A has received an incoming call and is in Ringing State\nThe incoming call has been anchored at the SCC AS of SC UE A. Both ends have reserved the resources and SC UE A has sent a 180 (Ringing) response.\n2-5\t\tMSC server sends session transfer request. SCC AS sends SIP UPDATE to update the remote end\n\t\tThese steps are identical to steps 3-6 in subclause A.17.2.\n6\t\tUser answers the call when the UE is still in the source E-UTRAN access\n7-8\t\tSIP 200 (OK) response (SC UE to intermediate IM CN subsystem entities to SCC AS)\nThe SCC AS performs no additional actions on receipt of the SIP 200 (OK) i.e. the SCC AS does not confirm reception of the SIP 200 (OK) response with SIP ACK request and performs no actions on dialogs with UE B and with MSC server.\n9-21\tContinuation of procedure for SRVCC in Alerting Phase\n\t\tThese steps are identical to steps 7-19 in subclause A.17.2.\n22\t\tUE receives H/O command from source E-UTRAN\n23\t\tUE retunes to 3G\n24\t\tCS Connect Message from SC UE A to MSC server\nThe SC UE A sends CS Connect Message as it did not receive a SIP ACK to the SIP 200 (OK) sent in step 7.\n25-37 \tContinuation of procedure for SRVCC in Alerting Phase\n\t\tThese steps are identical to steps 21-33 in subclause A.17.2.\n38-39\tSIP ACK request (SCC AS to intermediate IM CN subsystem entities to SC UE)\n\t\tThe SCC AS confirms reception of the SIP 200 (OK) response received in message 8.\n40\t\tRelease original SIP dialog\n\t\tThe SCC AS releases the SIP dialog towards the SC UE.\n\n\n\n*** THIRTEENTH CHANGE ***\nA.17.6\tSession transfer for originating call is in alerting phase with forked responses using SRVCC procedure: PS to CS \nIn the example flow at the figure\u00a0A.17.6-1, SC UE A initiates an originating session with speech media component which has received several forked responses. The call is anchored at SCC AS and in alerting phase. Based upon measurement reports sent from the UE to E-UTRAN, the source E-UTRAN decides to trigger a SRVCC handover to CS access.\n\nFigure\u00a0A.17.6-1: PS-CS SRVCC, incoming call in alerting phase with forked responses\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1-4.\tSIP INVITE request (SC UE A to Terminating network Intermediate IM CN subsystem entities) - see example in table\u00a0A.17.6-1\n\tSC UE A sends an outgoing call to the terminating party. The call has been anchored at the SCC AS.\nTable\u00a0A.17.6-1: SIP INVITE request (UE to Intermediate IM CN subsystem entities)\nINVITE tel:+1-212-555-2222 SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.visited2.net:7531;lr;comp=sigcomp>, <sip:orig@scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nP-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11\nPrivacy: none\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: <tel:+1-212-555-2222>\nCall-ID: cb03a0s09a2sdfglkj490333 \nCseq: 127 INVITE\nRequire: sec-agree\nSupported: precondition, 100rel, gruu \nProxy-Require: sec-agree\nSecurity-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6;comp=sigcomp>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=-\nc=IN IP6 5555::aaa:bbb:ccc:ddd \nt=0 0\nm=audio 3456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR \na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=rtpmap:96 telephone-event \n\n5.\tSIP INVITE request (Terminating network Intermediate IM CN subsystem entities to UE B)\n\tThe Terminating network Intermediate IM CN subsystem entities, i.e. S-CSCF serving for remote UE, determine that the SIP INVITE request should be forked, and send the SIP INVITE request to UE B.\n6.\tSIP INVITE request (Terminating network Intermediate IM CN subsystem entities to UE C)\n\tThe Terminating network Intermediate IM CN subsystem entities, i.e. S-CSCF serving for remote UE, determine that the SIP INVITE request should be forked, and send the SIP INVITE request to UE C.\n7-11.\tSIP 180 (Ringing) response to SIP INVITE request (UE B to UE A though SCC AS)\n\tThe remote UE B responds with SIP 180 (Ringing) response. And a dialog (dialog 1) has been established between UE A and UE B.\nTable\u00a0A.17.6-7: SIP 180 (Ringing) response (UE B to Terminating network Intermediate IM CN subsystem entities)\nSIP/2.0 180 Ringing\nRecord-Route: <sip:pcscf1.visited1.net;lr>\nVia: \nMax-Forwards: 60\nP-Asserted-Identity: <tel:+1-212-555-2222>\nPrivacy: \nFrom: \nTo: <tel:+1-212-555-2222>; tag=aaa\nCall-ID: \nCseq: \nRequire: \nSupported: \nContact: <sip:user2_public1@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: \nContent-Type: \nContent-Length: \n\nv=0\no=- 462346 5654 IN IP6 1234::55:66:77:88\ns=-\nc=IN IP6 1234::55:66:77:88\nt=0 0\nm=audio 4456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos local none\na=curr:qos remote sendrecv\na=des:qos mandatory local sendrecv\na=des:qos mandatory remote sendrecv\na=rtpmap:97 AMR \na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=rtpmap:96 telephone-event \n\n12-16.\tSIP 180 (Ringing) response to SIP INVITE request (UE C to UE A though SCC AS)\n\tThe remote UE C responds with SIP 180 (Ringing) response. And a dialog (dialog 2) has been established between UE A and UE B.\nTable\u00a0A.17.6-12: SIP 180 (Ringing) response (UE B to Terminating network Intermediate IM CN subsystem entities)\nSIP/2.0 180 Ringing\nRecord-Route: <sip:pcscf1.visited1.net;lr>\nVia: \nMax-Forwards: 60\nP-Asserted-Identity: <tel:+1-212-555-2222>\nPrivacy: \nFrom: \nTo: <tel:+1-212-555-2222>; tag=bbb\nCall-ID: \nCseq: \nRequire: \nSupported: \nContact: <sip:user2_public1@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: \nContent-Type: \nContent-Length: \n\nv=0\no=- 462346 5654 IN IP6 1234::55:66:77:88\ns=-\nc=IN IP6 1234::55:66:77:88\nt=0 0\nm=audio 4456 RTP/AVP 97 96\nb=AS:25.4\na=curr:qos local none\na=curr:qos remote sendrecv\na=des:qos mandatory local sendrecv\na=des:qos mandatory remote sendrecv\na=rtpmap:97 AMR \na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=rtpmap:96 telephone-event \n\n17.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.237\u00a0[9]. The UE continues ringing.\n18.\tSIP INVITE request transferring the session (MSC server to originating network intermediate IM CN subsystem entities) - see example in table\u00a0A.17.6-18\n\tThe MSC server sends an initial SIP INVITE request with STN-SR\nTable A.17.6-18: SIP INVITE request (MSC server to intermediate IM CN subsystem entities)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nRoute: <sip:icscf1.visit1.net;lr>\nP-Asserted-Identity: <tel:+1-237-555-1111>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel:+1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nRecv-Info: g.3gpp.state-and-event-info\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the STN-SR.\n\tSDP:\tThe SDP contains set of codecs supported by the MGW.\n19.\tSIP INVITE request transferring the session (intermediate IM CN subsystem entities to SCC AS)\nThe SIP INVITE is routed towards the SCC AS, based on filter criteria in S-CSCF.\n20.\tRemote Leg Update\n\tThe SCC AS correlates SIP INVITE request to the local and remote call legs of the existing session between the UE A and the remote end. Since the existing session has forked responses, more than one dialog can be correlated to the SIP INVITE due to STN-SR The SCC AS performs the Remote Leg update towards all the correlated dialogs.\n21-23.\tSIP UPDATE request (SCC AS to UE B through Intermediate IM CN subsystem entities)\n\tThe SCC AS acting as a B2BUA generates a SIP UPDATE request towards dialog 1 to remote UE B based upon the received SIP INVITE request in step 19.\n24-26.\tSIP 200 (OK) response (Remote UE B to SCC AS through Intermediate IM CN subsystem entities)\n\tUpon receiving the SIP UPDATE request containing the SDP offer for the leg to the MSC, the remote UE B sends 200 OK.\n27-28.\tSIP 183 (Session Progress) response (SCC AS to MSC server through Intermediate IM CN subsystem entities)\n\tThe SCC AS sends a 183 (Session Progress) containing the SDP answer as received from the remote UE B to the MSC server. The SDP answer indicates that resources are available\n29-30.\tSIP PRACK request (MSC server to SCC AS through Intermediate IM CN subsystem entities)\n\tThe MSC acknowledges the receipt of the 183 Session Progress by sending SIP PRACK request to the SCC AS.\n31-32.\tSIP 200 (OK) response (SCC AS to MSC server through Intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the PRACK with the SIP 200 (OK) reponse to the MSC server.\n33.\tSIP INFO request (SCC AS to Originating network intermediate IM CN subsystem entities) - see example in table\u00a0A.17.3-2\nTable A.17.3-2: INFO request (SCC AS to intermediate IM CN subsystem entities)\nINFO sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6SIP/2.0\nVia SIP/2.0/UDP sip:sccas1.home1.net;branch=z9hG4bK332b23.1\nMax-Forwards: 68\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <tel: +1-237-555-3333>;tag=314159\nTo: <tel:+1-237-555-1111>;tag=171828\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 129 INFO\nInfo-Package: g.3gpp.state-and-event-info\nContent-Type: application/ vnd.3gpp.state-and-event-info+xmls\nContent-Length: \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<state-and-event-info>\n   <state-info>early</state-info>\n   <direction>initiator</direction>\n</state-and-event-info>\n\n34.\tSIP INFO request (Intermediate IM CN subsystem entities to MSC server)\n\tThe intermediate IM CN subsystem entities forward the SIP INFO request to the MSC server. The MSC server is aware that the call that is transferred is in originating alerting state.\n35.\tSIP 200 (OK) response (MSC server to Intermediate IM CN subsystem entities)\n\tThe MSC Server acknowledges the receipt of the SIP INFO request.\n36.\tSIP 200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe intermediate IM CN subsystem entities forwards the SIP 200 (OK) response to the SCC AS.\n37-39.\tSIP UPDATE request (SCC AS to UE C through Intermediate IM CN subsystem entities)\n\tIn parallel with step 21, the SCC AS acting as a B2BUA generates a SIP UPDATE request towards dialog 2 to remote UE C based upon the received SIP INVITE request in step 19.\n40-42.\tSIP 200 (OK) response (Remote UE C to SCC AS through Intermediate IM CN subsystem entities)\n\tUpon receiving the SIP UPDATE request containing the SDP offer for the leg to the MSC, the remote UE C sends 200 OK.\n43-44.\tSIP 183 (Session Progress) response (SCC AS to MSC server through Intermediate IM CN subsystem entities)\n\tThe SCC AS sends a SIP 183 (Session Progress) containing the SDP answer as received from the remote UE C to the MSC server. The SDP answer indicates that resources are available\n45-46.\tSIP PRACK request (MSC server to SCC AS through Intermediate IM CN subsystem entities)\n\tThe MSC acknowledges the receipt of the 183 Session Progress by sending SIP PRACK request to the SCC AS.\n47-48.\tSIP 200 (OK) response (SCC AS to MSC server through Intermediate IM CN subsystem entities)\n\tThe SCC AS acknowledges the PRACK with the SIP 200 (OK) reponse to the MSC server.\n49.\tSIP 200 (OK) response (UE B to intermediate IM CN subsystem entities)\n\tIn this example, the remote UE B accepts the call first and sends 200 (OK) response.\n50-51.\t200 (OK) response (Intermediate IM CN subsystem entities to SCC AS)\n\tThe 200 (OK) response is forwarded to SCC AS.\n52-53\t200 (OK) response (SCC AS to MSC server through Intermediate IM CN subsystem entities)\n\tThe 200 (OK) response is forwarded to the MSC server based on the route established during step 24-28.\n54\tCS CONNECT (MSC server to SC UE A)\n\tThe MSC server indicates to the SC UA A that the remote UE B has accepted the call.\n55\tCS CONNECTACK (MSC server to SC UE A)\n\tSC UE A acknowledges the CS CONNECT.\n56-60.\tSIP ACK request (MSC server to remote UE B through intermediate IM CN subsystem entities)\n\tThe MSC server acknowledges the SIP 200 (OK) response by sending The SIP ACK request to remote UE B.\n61 \tSIP CANCEL request (Terminating network intermediate IM CN subsystem entities to remote UE C)\n\tThe intermediate IM CN subsystem entities send the SIP CANCEL request to remote UE C to release the call towards remote UE C.\n62 \tSIP 200 (OK) response to SIP CANCEL request (UE-3 to Intermediate IM CN subsystem entities)\n\tRemote UE C responds SIP 200 (OK) response to the SIP CANCEL request.\n63\u201366 \tThe SCC AS releases the original source leg towards the SC UE A\n\tThe SCC AS sends a SIP 404 (Not Found) response in order to release to original source dialog towards the SC UE A\n\n\n\n*** FOURTEENTH CHANGE ***\nA.18.2\tSignalling flows for PS to CS Access Transfer: SRVCC enhancements using ATCF and without media anchored\nThe signalling flow shown in figure\u00a0A.18.2-1 gives an example for PS to CS access transfer when using ATCF enhancements and without media anchored. In this case, the ATCF has been included in the path for subsequent transactions created at registration, but media has not been anchored in ATGW.\n\nFigure\u00a0A.18.2-1 Signalling flows for PS to CS access transfer: SRVCC enhancements using ATCF and without media anchored\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tUE A is on an active session with UE B\n\tThere is an ongoing PS bearer between the UE A and the remote end UE B. The media is not anchored at ATGW.\n2.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.216\u00a0[49].\n3.\tSIP INVITE request (MSC server to ATCF)-see example in table\u00a0A.18.2-3\nTable\u00a0A.18.2-3: SIP INVITE request (MSC server to ATCF)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-2222>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the STN-SR, as routed to the ATCF.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MGW.\n\tP-Asserted-Identity:\tthe C-MSISDN of the served UE.\n4-5.\tSIP INVITE request (ATCF to SCC AS via I-CSCF)- see example in table\u00a0A.18.2-4\nSince the media has not been anchored at the ATGW, the ATCF forwards the SIP INVITE request to the SCC AS by replacing the request URI to the stored ATU-STI.\nTable\u00a0A.18.2-4: SIP INVITE request (ATCF to I-CSCF)\nINVITE sip:AUT-STI1@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-2222>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-4444>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n6-7.\tSIP re-INVITE request (SCC AS to UE B via S-CSCF)\n\tThe SCC AS based on the content of the C-MSISDN correlates the SIP INVITE request to the local and remote call legs of the existing session between the UE A and the remote end. The SCC AS performs the Remote Leg update by sending the SIP re-INVITE request towards the Remote Leg.\n8-9.\tSIP 200 (OK) response (UE B to SCC AS via S-CSCF)\n\tUpon receiving the SIP re-INVITE request containing the SDP offer, since the UE B has all resources available, it sends immediately the SIP 200 (OK) response to the SIP re-INVITE request that contains the SDP answer. The SDP answer indicates that the resources are available.\n10-11.\tSIP ACK request (SCC AS to UE B via S-CSCF)\n\tThe SCC AS generates the SIP ACK request to the SIP 200 (OK) response, and forwards the SIP ACK request to the remote UE B.\n12-13.\tSIP 200 (OK) response (SCC AS to ATCF via I-CSCF)\n\tThe SCC AS generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response towards the ATCF.\n14.\tSIP 200 (OK) response (ATCF to MSC server)\n\tThe ATCF generates the SIP 200 (OK) response to the SIP INVITE request, and forwards the SIP 200 (OK) response towards the MSC server.\n15.\tSIP ACK request (MSC server to ATCF)\n\tThe MSC server generates the SIP ACK request to the SIP 200 (OK) response, and forwards it to the ATCF.\n16-17.\tSIP ACK request (ATCF to SCC AS via I-CSCF)\n\tThe ATCF generates the SIP ACK request to the SIP 200 (OK) response, and forwards it to the SCC AS.\n18-21.\tSIP BYE request (SCC AS to UE via I-CSCF, ATCF and P-CSCF)\n\tThe SCC AS terminates the source access leg, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n22-24.\tSIP 200 (OK) response (UE A to SCC AS via P-CSCF, ATCF and I-CSCF)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the SC UE A relinquishes all resources pertaining to the old IP-CAN.\n\n\n\n*** FIFTEENTH CHANGE ***\nA.18.3\tSignalling flows for PS to CS Access Transfer: SRVCC enhancements using ATCF and media anchored\nThe signalling flow shown in figure\u00a0A.18.3-1 gives an example for PS to CS access transfer for SRVCC enhancements using ATCF and media anchored. In this case, the media is anchored in ATGW and ATCF has been included in the path for subsequent transactions created at registration.\n\nFigure\u00a0A.18.3-1 Signalling flows for PS to CS access transfer: SRVCC enhancements using ATCF and media anchored\nNOTE\u00a01:\tFor clarity, the SIP 100 (Trying) responses are not shown in the signalling flow.\n1.\tUE A is on an active session with UE B\n\tThere is an ongoing IP bearer between the UE A and the remote end UE B. The media is anchored at ATGW.\n2.\tSC UE A attaches to the CS domain\n\tUE A sends the measurement reports to E-UTRAN, and the source E-UTRAN decides to trigger an SRVCC handover to CS access. The MSC server initiates the session transfer with the STN-SR, refer to 3GPP\u00a0TS\u00a023.216\u00a0[49].\n3.\tSIP INVITE request (MSC server to ATCF)-see example in table\u00a0A.18.3-3\nTable\u00a0A.18.3-3: SIP INVITE request (MSC server to ATCF)\nINVITE tel: +1-237-555-3333 SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-2222>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-1111>;tag=171828\nTo: <tel: +1-237-555-3333>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:eee\ns=\nc=IN IP6 5555::aaa:bbb:ccc:eee\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\tRequest-URI:\tcontains the STN-SR, as routed to the ATCF.\n\tSDP:\tThe SDP contains preconfigured set of codecs supported by the MGW.\n\tP-Asserted-Identity:\tthe C-MSISDN of the served UE.\n4.\tConfigure ATGW (ATCF to ATGW)\nUpon receiving the access transfer message, the ATCF correlates the transferred session using C-MSISDN. The ATCF updates the ATGW by replacing the existing PS access leg media path information with the new CS access leg media path information, by sending a Configure ATGW message to ATGW. \n5.\tConfigure ATGW ACK (ATGW to ATCF)\n\tThe ATGW sends Configure ATGW Acknowledgment message back to ATCF.\n6.\tSIP 200 (OK) response (ATCF to MSC server)\n\tThe ATCF sends the SIP 200 OK response to the MSC server with the media information allocated by the ATGW during session establish procedure.\n7.\tSIP ACK request (MSC server to ATCF)\n8.\tSIP INVITE request (ATCF to I-CSCFs)-see example in table\u00a0A.18.3-8\n\tAfter receiving the access transfer message, the ATCF re-establishes the communication with the SCC AS and updates the SCC AS that the transfer has taken place by sending a new SIP INVITE request to the SCC AS using the stored ATU-STI. As there is no update in the SDP information, no remote end update will be performed.\nTable\u00a0A.18.3-8: SIP INVITE request (ATCF to I-CSCF)\nINVITE sip:AUT-STI1@sccas.home1.net SIP/2.0\nVia: SIP/2.0/UDP msc1.visit1.net;branch=z9hG4bk731b87\nMax-Forwards: 70\nP-Asserted-Identity: <tel:+1-237-555-2222>\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-ioi=visit1.net\nPrivacy: none\nFrom: <tel:+1-237-555-3333>;tag=171828\nTo: <tel: +1-237-555-4444>\nCall-ID: cb03a0s09a2sdfglkj490334 \nCseq: 127 INVITE\nSupported: 100rel, precondition, gruu\nTarget-Dialog: me03a0s09a2sdfgjkl491777; to-tag=774321; from-tag=64727891\nAccept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContact: <sip:msc1.home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER\nContent-Type: application/sdp \nContent-Length: (\u2026)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ggg\ns=\nc=IN IP6 5555::aaa:bbb:ccc:ggg\nt=0 0\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local sendrecv\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=rtpmap:96 telephone-event\na=maxptime:20\n\n\n\tRequest-URI:\tcontains the ATU-STI, as routed to the SCC AS.\n\tTarget-Dialog:\tspecifies that the existing dialog is related with this request.\n\tP-Asserted-Identity:\tthe C-MSISDN of the served UE.\n\tSDP:\tthe media information at ATGW.\n9.\tSIP INVITE request (I-CSCF to SCC AS)\nThe I-CSCF forwards the SIP INVITE request to the SCC AS.\n10.\t SIP 200 (OK) response (SCC AS to I-CSCF)\n\tSince there is no update in the session description, no remote end update will be performed. The SCC AS sends confirmation response to the ATCF which contain the SDP answer that the SCC AS stored during the original session establishment procedure.\n11.\tSIP 200 (OK) response (I-CSCF to ATCF)\n12-13.\tSIP ACK request (ATCF to SCC AS via I-CSCF)\n14-17.\tSIP BYE request (SCC AS to UE A via I-CSCF, ATCF and P-CSCF)\n\tThe SCC AS terminates the source access leg, which was using the old IP-CAN, by sending a SIP BYE request to the UE A.\n18-21.\tSIP 200 (OK) response (UE A to SCC AS via P-CSCF, ATCF and I-CSCF)\n\tUpon receiving the SIP BYE request over the old IP-CAN, the UE A sends a SIP 200 (OK) response over the old IP-CAN to the SCC AS. Subsequently, the UE A relinquishes all resources pertaining to the old IP-CAN.\n\n*** END OF CHANGES ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe flows and the text currently imply that after an access transfer, it is possible to release the source access leg by exchanging of signaling messages between the UE and SCC AS over the associated signaling path. However, it is possible that this signaling path is no longer available and hence it is not possible for the UE and SCC AS to send and receive signaling messages over the access that is to be released.\n\n>>> SUMMARY OF CHANGE\nIt is clarified that when it is not possible to exchange signaling messages between the UE and the network after access transfer procedure is completed, the UE and the network will release the resources locally.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE and the network may keep resources allocated to the no-longer useful bearers and signaling paths. When signaling procedures fail on the network side, SCC AS may interpret this failure as a trigger to release the remote leg, even though the session is active through a different access"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nFIRST CHANGE\n6.1.3.3\tReporting\nReporting refers to the differentiated PDU Session resource usage information (measured at the UPF) being reported by the SMF to the CHF.\nNOTE\u00a01:\tReporting usage information to the CHF is distinct from credit management. Hence multiple PCC rules may share the same charging key for which one credit is assigned whereas reporting may be at higher granularity if serviced identifier level reporting is used.\nThe SMF shall report usage information for online and offline charging.\nThe SMF shall report usage information for each charging key value.\nFor service data flow charging, for the case of sponsored data connectivity, the reports for offline charging shall report usage for each charging key, Sponsor Identity and Application Service Provider Identity combination if Sponsor Identity and Application Service Provider Identifier have been provided in the PCC rules.\nNOTE\u00a02:\tUsage reports for online charging that include Sponsor Identity and Application Service Provider Identity is not within scope of the specification in this release. Online charging for sponsored data connectivity can be based on charging key as described in Annex X.\nThe SMF shall report usage information for each charging key/service identifier combination if service identifier level reporting is requested in the PCC rule.\nNOTE\u00a03:\tFor reporting purposes when charging is performed by the SMF:\na)\tthe charging key value identifies a service data flow if the charging key value is unique for that particular service data flow, and\nb)\tif the service identifier level reporting is present then the service identifier value of the PCC rule together with the charging key identify the service data flow.\n\nCharging information shall be reported based on the result from the service data flow detection and measurement on a per PDU Session basis.\nA report may contain multiple containers, each container associated with a charging key, charging key and Sponsor Identity (in case of sponsored connectivity) or charging key/service identifier.\nNEXT CHANGE\n6.1.3.4\tCredit management\nThe credit management applies for online charging only and shall operate on a per charging key basis. The SMF should initiate one credit management session with the CHF for each PDU Session subject to online charging.\nNOTE\u00a01:\tIndependent credit control for an individual service/application may be achieved by assigning a unique charging key value in the corresponding PCC rule.\nThe SMF shall request a credit for each charging key occurring in a PCC rule. It shall be up to operator configuration whether the SMF shall request credit in conjunction with the PCC rule being activated or when the first packet corresponding to the service is detected. The CHF may either grant or deny the request for credit. The CHF shall strictly control the rating decisions.\nNOTE\u00a02:\tThe term 'credit' as used here does not imply actual monetary credit, but an abstract measure of resources available to the user. The relationship between this abstract measure, actual money, and actual network resources or data transfer, is controlled by the CHF.\nDuring PDU Session establishment and modification, the SMF shall request credit using the information after applying policy enforcement action (e.g. upgraded or downgraded QoS information), if applicable, even though the SMF has not signalled this information to the AMF or RAN.\n\n\n\n\n\nSome of the re-authorization triggers are related to PDU Session modifications. PDU Session modifications, which do not match any credit re-authorization trigger (received from the CHF) shall not cause any credit re-authorization interaction with the CHF.\n\nNEXT CHANGE\nD.2\tReporting for sponsored data connectivity\nThere are two deployment scenarios for usage reporting for sponsored data connectivity. The Sponsor Identifier and Application Service Provider Identifier are provided for sponsored services to the PCF from the AF over the Rx/N5 interface.\nIn the first scenario the PCF assigns a service specific Charging Key for a sponsored IP flow. The Charging key is used by the SMF to generate separate accounting records for offline charging and and/or usage data records for online charging for the sponsored flows. Correlation of accounting records and usage data records from multiple users per sponsor and/or application service provider is then performed using the charging key.\nIn a second scenario the Sponsor Identifier and Application Service Provider Identity is included in PCC rules from the PCF to the SMF as defined in clause\u00a06.3.1. For this scenario the same Charging Key may be used both for IP flows that are sponsored and for flows that are not sponsored. Accounting records generated by the SMF for offline charging include the Sponsor Identity and the Application Service Provider Identity. Correlation of accounting records from multiple users per sponsor and/or application service provider can then be based on Sponsor Identity and Application Service Provider Identity instead of the Charging Key. Usage reporting for online charging including Sponsor Identity and Application Service Provider Identity has not been specified in this release of the specification. PCC rules that include a Sponsor Identity and an Application Service Provider Identity should include a Charging Method that indicates offline charging.\n\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nBased on the agreement addressed in the DP \u201cTS 23.203 Endorsement\u201d (S2-1903636), any reference to 23.203 shall be replaced by the referenced content. However, when the replacement for 6.1.3.4 is implemented by S2-1904118, some content is missed, e.g. credit re-authentication.For EPC, the credit re-authorisation and the triggers are defined in clause 6.1.3 and clause A.4.3.1.1 of TS 23.203.For 5GC, the credit re-authorisation and the triggers are defined in TS clause 5.2.1.4 of TS 32.255.Converged charging introduced for 5G includes quota management and usage reporting. Usage reporting is commonly applied for both online charging and offline charging, then it is not distinct to credit management (quota management).\n\n>>> SUMMARY OF CHANGE\nUpdate 6.1.3.4 to align with credit management defined in TS 32.255 and refer to TS 32.255.Update 6.1.3.3 and Annex D to align with usage reporting defined in TS 32.255 and refer to TS 32.255.\n\n>>> CONSEQUENCES IF NOT REVISED\nSMF doesn\u2019t know how to request credit re-authorization to CHF. In consistant with SA5 for the definition of credit control, usage reporting and Sponsored data connectivity charging."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** start of change *****\n4.4.4.2\tIntegrity checking of NAS signalling messages in the UE\nExcept the messages listed below, no NAS signalling messages shall be processed by the receiving 5GMM entity in the UE or forwarded to the 5GSM entity, unless the network has established secure exchange of 5GS NAS messages for the NAS signalling connection:\na)\tIDENTITY REQUEST (if requested identification parameter is SUCI);\nb)\tAUTHENTICATION REQUEST; \nc)\tAUTHENTICATION RESULT;\nd)\tAUTHENTICATION REJECT;\ne)\tREGISTRATION REJECT (if the 5GMM cause is not #76);\nf)\tDEREGISTRATION ACCEPT (for non switch off); and\ng)\tSERVICE REJECT (if the 5GMM cause is not #76).\nNOTE:\tThese messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.\nIntegrity protection is never applied directly to 5GSM messages, but to the 5GMM message in which the 5GSM message is included.\nThe network can provide the SOR transparent container IE during the registration procedure to the UE in the REGISTRATION ACCEPT message. The SOR transparent container IE is integrity protected by the HPLMN as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nOnce the secure exchange of NAS messages has been established, the receiving 5GMM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in subclause\u00a05.4.2.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.\n***** next change *****\n\n\n\n\n\n***** End of changes *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) Due to the difference between the integrity protection of NAS messages and the integrity protection of NAS IEs, it is proposed to add a new subclause to spcifiy the integrity protection of NAS IEs.2)The integrity protection of the payload container IE when the Payload container type IE is set to \"SOR transparent container\" or \"UE parameters update transparent container\" is not captured in subclause\u00a04.4.Quote:\"5.4.5.3.3Network-initiated NAS transport of messagesUpon reception of a DL NAS TRANSPORT message, the UE shall stop the timer T3346 if running.Upon reception of a DL NAS TRANSPORT message, if the Payload container type IE is set to:\u2026\u2026d)\"SOR transparent container\" and if the Payload container IE:1)successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates a list of preferred PLMN/access technology combinations is provided and the list type indicates:\u2026\u20262)does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\u2026\u2026i)\"UE parameters update transparent container\" and if the Payload container IE1)successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\u2026..2)does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall discard the content of the payload container IE;\u2026\u2026\"3) The generating of SoR-MAC-IUE (i.e. a part of the security mechanism for Steering of roaming ) and UPU-MAC-IUE  (i.e. a part of the security mechanism for UE parameters update via UDM control plane procedure) in NAS IEs is not specified in subclause\u00a04.4 NAS security.\n\n>>> SUMMARY OF CHANGE\n1) Propose to have a new subclause\u00a04.4.x to specify the integrity protection of NAS IEs.2) Propose to capture the specification of the integrity protection of the payload container IE in subclause\u00a04.4.x.3) Propose to capture the generating of SoR-MAC-IUE or UPU-MAC-IUE in subclause\u00a04.4.x.\n\n>>> CONSEQUENCES IF NOT REVISED\n1)The general specification of integrity protection of NAS IEs is not complete.2)Including the integrity checking of the NAS IEs in the subclause\u00a04.4.4 (i.e. Integrity protection of NAS signaling messages) can lead to confusion on the integrity protection of NAS messages and the integrity protection of NAS IEs."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n<Start of Change>\n5.2.2.3.3\tRequest for on demand system information\nThe UE shall:\n\n\n\n \n1> if SIB1 includes si-SchedulingInfo containing si-RequestConfigSUL and criteria to select supplementary uplink as defined in TS 38.321[13], clause 5.1.1 is met:\n2> trigger the lower layer to initiate the Random Access procedure on supplementary uplink in accordance with [3] using the PRACH preamble(s) and PRACH resource(s) in si-RequestConfigSUL corresponding to the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;\n2> if acknowledgement for SI request is received from lower layers:\n3> acquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1> else if SIB1 includes si-SchedulingInfo containing si-RequestConfig and criteria to select normal uplink as defined in TS 38.321[13], clause 5.1.1 is met:\n2> trigger the lower layer to initiate the random access procedure on normal uplink in accordance with TS 38.321 [3] using the PRACH preamble(s) and PRACH resource(s) in si-RequestConfig corresponding to the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;\n2> if acknowledgement for SI request is received from lower layers:\n3> acquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1> else:\n2> apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;\n2> apply the default MAC Cell Group configuration as specified in 9.2.2;\n2> apply the timeAlignmentTimerCommon included in SIB1;\n2> apply the CCCH configuration as specified in 9.1.1.2;\n2> initiate transmission of the RRCSystemInfoRequest message in accordance with 5.2.2.3.4;\n2> if acknowledgement for RRCSystemInfoRequest message is received from lower layers:\n3> acquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1> if cell reselection occurs while waiting for the acknowledgment for SI request from lower layers:\n2> reset MAC;\n2> if SI request is based on RRCSystemInfoRequest message:\n3> release RLC entity for SRB0.\nNOTE:\tAfter RACH failure for SI request it is up to UE implementation when to retry the SI request.\n\n5.2.2.3.3a\tRequest for on demand positioning system information\nThe UE shall:\n\n \n\n \n1>\tif SIB1 includes posSI-SchedulingInfo containing posSI-RequestConfigSUL and criteria to select supplementary uplink as defined in TS 38.321[13], clause 5.1.1 is met:\n2>\ttrigger the lower layer to initiate the Random Access procedure on supplementary uplink in accordance with [3] using the PRACH preamble(s) and PRACH resource(s) in posSI-RequestConfigSUL corresponding to the SI message(s) that the UE requires to operate within the cell, and for which posSI-BroadcastStatus is set to notBroadcasting;\n2>\tif acknowledgement for SI request is received from lower layers:\n3>\tacquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1>\telse if SIB1 includes posSI-SchedulingInfo containing posSI-RequestConfig and criteria to select normal uplink as defined in TS 38.321[13], clause 5.1.1 is met:\n2>\ttrigger the lower layer to initiate the random access procedure on normal uplink in accordance with TS 38.321 [3] using the PRACH preamble(s) and PRACH resource(s) in posSI-RequestConfig corresponding to the SI message(s) that the UE upper layers require for positioning operations , and for which posSI-BroadcastStatus is set to notBroadcasting;\n2>\tif acknowledgement for SI request is received from lower layers:\n3>\tacquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1>\telse:\n2>\tapply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;\n2>\tapply the default MAC Cell Group configuration as specified in 9.2.2;\n2>\tapply the timeAlignmentTimerCommon included in SIB1;\n2>\tapply the CCCH configuration as specified in 9.1.1.2;\n2>\tinitiate transmission of the RRCSystemInfoRequest message with rrcPosSystemInfoRequest in accordance with 5.2.2.3.4;\n2>\tif acknowledgement for RRCSystemInfoRequest message with rrcPosSystemInfoRequest is received from lower layers:\n3>\tacquire the requested SI message(s) as defined in sub-clause 5.2.2.3.2, immediately;\n1>\tif cell reselection occurs while waiting for the acknowledgment for SI request from lower layers:\n2>\treset MAC;\n2>\tif SI request is based on RRCSystemInfoRequest message with rrcPosSystemInfoRequest:\n3>\trelease RLC entity for SRB0.\nNOTE:\tAfter RACH failure for SI request it is up to UE implementation when to retry the SI request.\n\n5.2.2.4.2\tActions upon reception of the SIB1\nUpon receiving the SIB1 the UE shall:\n1>\tstore the acquired SIB1;\n1>\tif the cellAccessRelatedInfo contains an entry with the PLMN-Identity of the selected PLMN:\n2>\tin the remainder of the procedures use plmn-IdentityList, trackingAreaCode, and cellIdentity for the cell as received in the corresponding PLMN-IdentityInfo containing the selected PLMN;\n1>\tif the cellAccessRelatedInfo contains an entry of npn-IdentityInfoList with the NPN identity of the selected PLMN or SNPN:\n2>\tin the remainder of the procedures use npn-IdentityList, trackingAreaCode, and cellIdentity for the cell as received in the corresponding entry of npn-IdentityInfoList containing the selected PLMN or SNPN;\n1>\tif in RRC_CONNECTED while T311 is not running:\n2>\tdisregard the frequencyBandList, if received, while in RRC_CONNECTED;\n2>\tforward the cellIdentity to upper layers;\n2>\tforward the trackingAreaCode to upper layers;\n2>\tforward the received posSIB-MappingInfo to upper layers, if included;\n2>\tapply the configuration included in the servingCellConfigCommon;\n2>\tif the UE has a stored valid version of a SIB or posSIB, in accordance with sub-clause 5.2.2.2.1, that the UE requires to operate within the cell in accordance with sub-clause 5.2.2.1:\n3>\tuse the stored version of the required SIB or posSIB;\n2>\telse:\n3>\tacquire the required SIB or posSIB requested by upper layer as defined in sub-clause 5.2.2.3.5;\nNOTE:\tVoid.\n1>\telse:\n2>\tif the UE supports one or more of the frequency bands indicated in the frequencyBandList for downlink for TDD, or one or more of the frequency bands indicated in the frequencyBandList for uplink for FDD, and they are not downlink only bands, and\n2>\tif the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList for a supported band in the downlink for TDD, or a supported band in uplink for FDD, and\n2>\tif the UE supports an uplink channel bandwidth with a maximum transmission bandwidth configuration (see TS 38.101-1 [15] and TS 38.101-2 [39]) which\n-\tis smaller than or equal to the carrierBandwidth (indicated in uplinkConfigCommon for the SCS of the initial uplink BWP), and which\n-\tis wider than or equal to the bandwidth of the initial uplink BWP, and\n2>\tif the UE supports a downlink channel bandwidth with a maximum transmission bandwidth configuration (see TS 38.101-1 [15] and TS 38.101-2 [39]) which\n-\tis smaller than or equal to the carrierBandwidth (indicated in downlinkConfigCommon for the SCS of the initial downlink BWP), and which\n-\tis wider than or equal to the bandwidth of the initial downlink BWP:\n3>\tif trackingAreaCode is not provided for the selected PLMN nor the registered PLMN nor PLMN of the equivalent PLMN list:\n4>\tconsider the cell as barred in accordance with TS 38.304 [20];\n4>\tif intraFreqReselection is set to notAllowed:\n5>\tconsider cell re-selection to other cells on the same frequency as the barred cell as not allowed, as specified in TS 38.304 [20];\n4>\telse:\n5>\tconsider cell re-selection to other cells on the same frequency as the barred cell as allowed, as specified in TS 38.304 [20];\n3>\telse if UE is IAB-MT and if iab-Support is not provided for the selected PLMN nor the registered PLMN nor PLMN of the equivalent PLMN list nor the selected SNPN nor the registered SNPN:\n4>\tconsider the cell as barred for IAB-MT in accordance with TS 38.304 [20];\n3>\telse:\n4>\tapply a supported uplink channel bandwidth with a maximum transmission bandwidth which\n-\tis contained within the carrierBandwidth indicated in uplinkConfigCommon for the SCS of the initial uplink BWP, and which\n-\tis wider than or equal to the bandwidth of the initial BWP for the uplink;\n4>\tapply a supported downlink channel bandwidth with a maximum transmission bandwidth which\n- is contained within the carrierBandwidth indicated in downlinkConfigCommon for the SCS of the initial downlink BWP, and which\n- is wider than or equal to the bandwidth of the initial BWP for the downlink;\n4>\tselect the first frequency band in the frequencyBandList, for FDD from frequencyBandList for uplink, or for TDD from frequencyBandList for downlink, which the UE supports and for which the UE supports at least one of the additionalSpectrumEmission values in nr-NS-PmaxList, if present;\n4>\tforward the cellIdentity to upper layers;\n4>\tforward the trackingAreaCode to upper layers;\n4>\tforward the received posSIB-MappingInfo to upper layers, if included;\n4>\tforward the PLMN identity or SNPN identity or PNI-NPN identity to upper layers;\n4>\tif in RRC_INACTIVE and the forwarded information does not trigger message transmission by upper layers:\n5>\tif the serving cell does not belong to the configured ran-NotificationAreaInfo:\n6>\tinitiate an RNA update as specified in 5.3.13.8;\n4>\tforward the ims-EmergencySupport to upper layers, if present;\n4>\tforward the eCallOverIMS-Support to upper layers, if present;\n4>\tforward the uac-AccessCategory1-SelectionAssistanceInfo to upper layers, if present;\n4>\tapply the configuration included in the servingCellConfigCommon;\n4>\tapply the specified PCCH configuration defined in 9.1.1.3;\n4>\tif the UE has a stored valid version of a SIB, in accordance with sub-clause 5.2.2.2.1, that the UE requires to operate within the cell in accordance with sub-clause 5.2.2.1:\n5>\tuse the stored version of the required SIB;\n\n\n4>\tif the UE has not stored a valid version of a SIB, in accordance with sub-clause 5.2.2.2.1, of one or several required SIB(s), in accordance with sub-clause 5.2.2.1:\n5>\tfor the SI message(s) that, according to the si-SchedulingInfo, contain at least one required SIB and for which si-BroadcastStatus is set to broadcasting:\n6>\tacquire the SI message(s) as defined in sub-clause 5.2.2.3.2;\n5>\tfor the SI message(s) that, according to the si-SchedulingInfo, contain at least one required SIB and for which si-BroadcastStatus is set to notBroadcasting:\n6>\ttrigger a request to acquire the SI message(s) as defined in sub-clause 5.2.2.3.3;\n4>\tif the UE has received request from upper layers:\n5>\tfor the SI message(s) that, according to the posSI-SchedulingInfo, contain at least one requested posSIB and for which posSI-BroadcastStatus is set to broadcasting:\n6>\tacquire the SI message(s) as defined in sub-clause 5.2.2.3.2;\n5>\tfor the SI message(s) that, according to the posSI-SchedulingInfo, contain at least one requested posSIB for which posSI-BroadcastStatus is set to notBroadcasting:\n6>\ttrigger a request to acquire the SI message(s) as defined in sub-clause 5.2.2.3.3a;\n\n\n\n\n4>\tapply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandList in uplinkConfigCommon for FDD or in downlinkConfigCommon for TDD;\n4>\tif the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList:\n5>\tapply the additionalPmax for UL;\n4>\telse:\n5>\tapply the p-Max in uplinkConfigCommon for UL;\n4>\tif supplementaryUplink is present in servingCellConfigCommon; and\n4>\tif the UE supports one or more of the frequency bands indicated in the frequencyBandList of supplementary uplink; and\n4>\tif the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList for a supported supplementary uplink band; and\n4>\tif the UE supports an uplink channel bandwidth with a maximum transmission bandwith configuration (see TS 38.101-1 [15] and TS 38.101-2 [39]) which\n-\tis smaller than or equal to the carrierBandwidth (indicated in supplementaryUplink for the SCS of the initial uplink BWP), and which\n-\tis wider than or equal to the bandwidth of the initial uplink BWP of the SUL:\n5>\tconsider supplementary uplink as configured in the serving cell;\n5>\tselect the first frequency band in the frequencyBandList of supplementary uplink which the UE supports and for which the UE supports at least one of the additionalSpectrumEmission values in nr-NS-PmaxList, if present;\n5>\tapply a supported supplementary uplink channel bandwidth with a maximum transmission bandwidth which\n-\tis contained withn the carrierBandwidth (indicated in supplementaryUplink for the SCS of the initial uplink BWP), and which\n-\tis wider than or equal to the bandwidth of the initial BWP of the SUL;\n5>\tapply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandList for the supplementaryUplink;\n5>\tif the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList for the supplementaryUplink:\n6>\tapply the additionalPmax in supplementaryUplink for SUL;\n5>\telse:\n6>\tapply the p-Max in supplementaryUplink for SUL;\n2>\telse:\n3>\tconsider the cell as barred in accordance with TS 38.304 [20]; and\n3>\tperform barring as if intraFreqReselection is set to notAllowed;\n<End of Change>\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIssue 1: In release 16, new SIBs such V2X SIBs are defined. These are acquired only when V2X service is initiated. If V2X service is initiated in modification period \u2018N\u2019 and in the modification period \u2018N\u2019 UE has acquired SIB1 before the intiation of V2X service, it is not required to acquire SIB1 again. However, in the current specification, on demand SI acquisition procedure in RRC_IDLE/RRC_INACTIVE is triggered only as part of SIB1 processing. As a result, UE has to reacquire SIB1.Note that similar issue was observed in RRC_CONNECTED and was resolved in earlier meetings.Issue 2:In RRC_IDLE/RRC_INACTIVE, UE should use the stored posSIB if it is valid like in RRC_CONNECTED state. However, as per current procedure, if posSIB is requested by upper layer and UE is in RRC_IDLE/RRC_INACTIVE, it does not uses the stored posSIB and instead always acquires the posSIB.\n\n>>> SUMMARY OF CHANGE\nChecking of si-SchedulingInfo and si-BroadcastStatus to determine whether to initiate SI request or not is moved from section 5.2.2.4.2 to section 5.2.2.3.3 and 5.2.2.3.3a for SIB and posSIB respectively.Specified in section 5.2.2.4.2 that if the UE has a stored valid version of a posSIB, UE use the stored version of the required posSIBImpacted functionality:On demand SIB acquisition in RRC_IDLE/RRC_INACTIVEInter-operability:If the network is implemented according to the CR and the UE is not, there are no interoperability issues.If the UE is implemented according to the CR and the network is not, there are no interoperability issues.\n\n>>> CONSEQUENCES IF NOT REVISED\nFor issue 1, UE unecessarily acquires SIB1 even if it has a valid SIB1. For issue 2, UE unecessarily acquires posSIB, even if has a stored valid version of that SIB."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * \n4.1.3.2\tNetworks Supporting Multiple IP Mobility Mechanisms\nIP Mobility management Selection (IPMS) consist of two components:\n\n-\tIP MM protocol selection between Network Based Mobility (NBM) and Host based mobility (HBM - MIPv4 orDSMIPv6).\n-\tDecision on IP address preservation if NBM is selected.\nIPMS does not relate to the selection between PMIPv6 and GTP over S5/S8/S2b.\nUpon initial attachment to a 3GPP access, no IPMS is necessary since connectivity to a PDN GW is always established with a network-based mobility mechanism.\nUpon initial attachment to a trusted non-3GPP access or ePDG and upon handover from 3GPP to a trusted non-3GPP access or ePDG, IPMS is performed before an IP address is allocated and provided to the UE.\nThe UE support for a specific IP Mobility Management protocol and/or IP address preservation mechanism for inter-access mobility may be known by the network-based on explicit indication from the UE.\nUpon attachment to a trusted non-3GPP access or ePDG, if the access network (supporting at least NBM) is not aware of the UE capabilities and the home and access network's policies allow the usage of NBM, then NBM is used for establishing connectivity for the UE to the EPC.\nWhen a NBM mechanism is used for establishing connectivity in the target access upon inter-access mobility, IP address preservation for session continuity based on NBM may take place as per PMIPv6 specification (RFC\u00a05213\u00a0[8]) or according to clause\u00a08.6 for GTP, and additionally based on the knowledge in the network of UE's capability (if available) to support NBM. Such knowledge may be based on an explicit indication from the UE upon handover that IP address preservation based on NBM management can be provided.\nIP address preservation for session continuity based on HBM may take place if the network is aware of the UE capability to support DSMIPv6 or MIPv4. Such knowledge may be based on an indication to the target trusted non-3GPP access or ePDG from the HSS/AAA (e.g. in case of DSMIPv6, the UE performed S2c bootstrap before moving to the target trusted non-3GPP access or ePDG). In such a case, the trusted non-3GPP access network or ePDG provides the UE with a new IP address, local to the access network if IP mobility management protocol selected is DSMIPv6. In that case, in order to get IP address preservation for session continuity, the UE shall use DSMIPv6 over S2c reference point. This IP address shall be used as a care-of address for DSMIPv6. If the IP mobility management protocol selected is MIPv4, the address provided to the UE by the non-3GPP access network is a FACoA and IP address preservation is performed over S2a using MIPv4 FACoA procedures.\nThe final decision on the mobility management mechanism is made by the HSS/AAA upon UE authentication in the trusted non-3GPP access system or ePDG (both at initial attachment and handover), based on the information it has regarding the UE, local/home network capabilities and local/home network policies. If the UE provided an explicit indication of the supported mobility mechanisms, the network shall provide an indication to the UE identifying the selected mobility management mechanism.\nSupport of different IP mobility management protocols at local/home network is known by the AAA/HSS in one of the following ways:\n-\tthrough static pre-configuration, or\n-\tthrough indication of the supported IP mobility management protocols (NBM and/or MIPv4 FA CoA mode) by the trusted non-3GPP access system or ePDG as part of the AAA exchange for UE authentication.\nUpon selecting a mobility management mechanism, as part of the AAA exchange for UE authentication in the trusted non-3GPP access system or ePDG, the HSS/AAA returns to the trusted non-3GPP access system or ePDG an indication on whether a local IP address shall be allocated to the UE, or if instead NBM shall be used to establish the connectivity, or the HSS/AAA returns to the trusted non-3GPP access system an indication that the address of the MIPv4 Foreign Agent shall be provided to the UE.\nIPMS is performed in the following scenarios:\n-\tUpon initial attach to a trusted non-3GPP access or ePDG, the IPMS is performed to decide how to establish IP connectivity for the UE.\n-\tUpon handover without optimization from a 3GPP access to a non-3GPP access, the IPMS is performed to decide how to establish IP connectivity for the UE over the trusted non-3GPP access or ePDG.\n-\tUpon change of access between a non-3GPP access and a 3GPP access or between two non-3GPP accesses, if the IP MM protocol used to provide connectivity to the UE over the trusted non-3GPP access or ePDG is a NBM protocol, then a decision is performed on whether IP address preservation is provided or not as per PMIPv6 specification, (RFC\u00a05213\u00a0[8]) or according to clause\u00a08.6 for GTP and additionally based on the knowledge in the network of UE's capability (if available) to support NBM.\n\n* * * Next Change * * * \n4.1.3.2.1\tIP Mobility Management Selection During Initial Attach to a Non-3GPP Access\nThe IPMS decision is performed as described in the following:\n\n-\tIf the UE indicates DSMIPv6 support only, and the network supports and selects DSMIPv6, the trusted non-3GPP access network or ePDG provides a local IP address to the UE to be used as CoA for DSMIPv6/S2c.\n-\tIf the UE indicates MIPv4 support only, and the network supports and selects MIPv4, then the trusted non-3GPP access network provides a FACoA to the UE.\n-\tIf the UE indicates DSMIPv6 or MIPv4 support only, and the network selects NBM for providing connectivity, then NBM is used for providing connectivity.\n-\tIf the UE does not indicate any capabilities, it is assumed that the UE is not able to support DSMIPv6 or MIPv4, and NBM is used for providing connectivity if the network supports NBM.\n\n* * * Next Change * * * \n4.1.5\tNon-seamless WLAN offload\nNon-seamless WLAN offload is an optional capability of a UE supporting WLAN radio access in addition to 3GPP radio access.\nA UE supporting non-seamless WLAN offload may, while connected to WLAN access, route specific IP flows via the WLAN access without traversing the EPC. These IP flows are identified via user preferences, the Local Operating Environment Information defined in TS\u00a023.261\u00a0[55], and via policies that may be statically pre-configured by the operator on the UE, or dynamically set by the operator via the ANDSF. For such IP flows the UE uses the local IP address allocated by the WLAN access network and no IP address preservation is provided between WLAN and 3GPP accesses.\nFor performing the non-seamless WLAN offload, the UE needs to acquire a local IP address on WLAN access, and it is not required to connect to an ePDG.\nAlso, in the case the WLAN access is EPC connected, it is possible for a UE which also supports seamless WLAN offload to perfom seamless WLAN offload for some IP flows and non seamless WLAN offload for some other IP flows simultaneously.\n\n* * * End of Changes * * * \n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFrom Rel-8 onwards, IPMS (IP Mobility Management Selection) has been specified to only cover the mobility mechanisms when the UE has connectivity to a PGW, and this is documented in a specific clause (4.1.3). But IPMS is not considered as optional for the network as the only values listed in clause 4.1.3.2 are: DSMIPv6, MIPv4, NBM. In other words, it is not possible to notify the UE that EPC access is not allowed for the UE. Furthermore, NSWO has been introduced in Rel-10 but it is not clear in clause 4.1.5 how the network can forbid NSWO for an UE and indicate it to the UE (it is just mentioned that NSWO is optional for the UE). Also note that the two concepts, i.e. IPMS (4.1.3) and NSWO (4.1.5), should remain separated because a UE can be authorized by the AAA server for EPC only, NSWO only, or both EPC and NSWO. Whether the UE establishes a PDN connection or NSWO access is a different matter:      When the 3GPP AAA server allows the UE for EPC access only, or to NSWO only, then there is no need for complementary decision: the UE has to connect to EPC (resp. to NSWO);     When the 3GPP AAA server allows the UE for both EPC access and NSWO, the decision needs to be taken in other entities (either by proper configuration in UE and in the network (e.g. ePDG configuration from Rel-10, TWAN configuration in Rel-11), or by means of e.g. a connection protocol (as planned in further releases for SaMOG)).\n\n>>> SUMMARY OF CHANGE\nIt is specified that, in addition to mobility type (DSMIPv6, MIPv4, NBM), IPMS shall indicate whether EPC access is allowed for the UE.It is specified that the network shall indicate whether NSWO is allowed for the UE independently from IPMS.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe AAA server would not be able to notify the UE on whether EPC access is allowed independently from NSWO. The AAA server would not be able to notify the UE on whether NSWO is allowed independently from EPC access.The AAA server would not be able to notify the UE that EPC access is not allowed in scenarios where it only wants to authorize NSWO (the AAA server shall indicate the IPMS decision to the UE per TS 24.302, but no value exists to indicate 'no EPC access'). The cases \u201cNSWO only allowed\u201d and \u201cEPC access only allowed\u201d cannot be differentiated by the UE as e.g. the NBM value would be used for both cases.UEs would be able to activate functionalities or applications that cannot be provided by the access method actually granted to the UE; e.g. UE may activate applications that require EPC connectivity while only being granted non-seamless WLAN offload service."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n4.5\tDisabling and re-enabling of UE's E-UTRA capability\nWhen the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, the UE shall disable the E-UTRA capability.\n-\tThe UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP\u00a0TS\u00a024.008\u00a0[13], subclause\u00a010.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP\u00a0TS\u00a024.008\u00a0[13], subclause\u00a010.5.1.7) and the ISR support bit of the MS network capability IE (see 3GPP\u00a0TS\u00a024.008\u00a0[13], subclause\u00a010.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN; and\n-\tthe UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.\nNOTE:\tThe UE can only disable the E-UTRA capability when in EMM-IDLE mode.\nThe UE shall enable the E-UTRA capability again in the following cases:\n- \tthe UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation;\n-\tthe UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation;\n-\tthe UE powers off and powers on again; or\n- \tfor the PLMN selection purpose\n\nIf the E-UTRA capability was disabled due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see subclause\u00a04.3.1), the criteria to enable the E-UTRA capability again is UE implementation specific.\n\n* * * Next Change * * * *\n5.5.1.3.4\tCombined attach accepted by the network\n5.5.1.3.4.1\tGeneral\nDepending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, the following different cases can be distinguished:\n1)\tThe EPS attach result IE value indicates \"combined EPS/IMSI attach\": attach for EPS and non-EPS services, or for EPS services and \"SMS only\" have been successful.\n2)\tThe EPS attach result IE value indicates \"EPS only\": attach for EPS services has been successful but attach for non-EPS services or \"SMS only\" has failed.\n5.5.1.3.4.2\tCombined attach successful\nThe description for attach for EPS services as specified in subclause\u00a05.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or \"SMS only\" applies.\nThe TMSI reallocation may be part of the combined attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message, together with the location area identification (LAI). In this case the MME shall start timer T3450 as described in subclause\u00a05.4.1.4, and enter state EMM-COMMON-PROCEDURE-INITIATED. If the MME does not indicate \"SMS only\" in the ATTACH ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.\nThe UE, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3410, resets the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the UE is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the UE shall use this TMSI as the new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept.\nIf the UE requested \"SMS only\" in the Additional update type IE, the network shall indicate \"SMS only\" in the Additional update result IE.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"SMS only\" or \"CS Fallback not preferred\", a UE operating in CS/PS mode 1 with \"IMS voice not available\" and configured to use CS fallback shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the selected PLMN or equivalent PLMN. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"SMS only\", a UE operating in CS/PS mode 2 shall not attempt to use CS fallback for mobile originating services.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"CS Fallback not preferred\", this indicates to a UE operating in CS/PS mode 2 that it is attached for EPS and non-EPS services and that it can use CS fallback.\nIf the LAI contained in the ATTACH ACCEPT message is a member of the list of \"forbidden location areas for regional provision of service\" or the list of \"forbidden location areas for roaming\" then such entry shall be deleted.\nThe UE, when receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network after which it shall enter state EMM-REGISTERED and MM state MM-IDLE and set the EPS update status to EU1 UPDATED.\nUpon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the new TMSI sent in the ATTACH ACCEPT message as valid.\n5.5.1.3.4.3\tCombined attach successful for EPS services only\nApart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause\u00a05.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.\nThe UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t\t(IMSI unknown in HSS)\n\tThe UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.\n#16\t(MSC temporarily not reachable);\n#17\t(Network failure); or\n#22\t(Congestion)\n\tThe UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\n\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered.\n\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\nNOTE\u00a01:\tIt is up to the UE implementation when to enable E-UTRAN radio access technology selection.\n#18\t(CS domain not available)\n\tThe UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\n\tThe UE shall set the update status to U2 NOT UPDATED.\n\tA UE in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the selected PLMN or equivalent PLMN. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\n\tA UE in CS/PS mode 2 of operation may provide a notification to the user or the upper layers that the CS domain is not available.\n\tThe UE shall not attempt combined attach or combined tracking area update procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed. \nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for EPS and non-EPS services. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.3.6.\n\n* * * Next Change * * * *\n5.5.1.3.6\tAbnormal cases in the UE\nThe UE shall proceed as follows:\n-\tif the UE requested the combined attach for EPS services and \"SMS only\" and the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, the UE shall behave as if the combined attach was successful for EPS services and \"SMS only\".\nNOTE:\tIn this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to \"CS\", as specified in subclause\u00a05.6.2.3.2.\n-\tif the combined attach was successful for EPS services only and the ATTACH ACCEPT message contained an EMM cause value not treated in subclause\u00a05.5.1.3.4.3 or the EMM cause IE is not included in the message, the UE shall follow the procedure specified in subclause\u00a05.5.1.2.6 item\u00a0d, with the following modification;\n-\totherwise, the abnormal cases specified in subclause\u00a05.5.1.2.6 apply with the following modification.\nIf the attach attempt counter is incremented according to subclause\u00a05.5.1.2.6 the next actions depend on the value of the attach attempt counter:\n-\tif the update status is U1 UPDATED and the attach attempt counter is less than 5, then the UE shall keep the update status to U1 UPDATED, the new MM state is MM IDLE substate NORMAL SERVICE;\n-\tif the attach attempt counter is less than 5 and, additionally, the update status is different from U1 UPDATED, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The MM state remains MM LOCATION UPDATING PENDING; or\n-\tif the attach attempt counter is equal to 5, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. A UE operating in CS/PS mode 1 of operation shall select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures.\nNOTE:\tIt is up to the UE implementation when to enable E-UTRAN radio access technology selection.\n\n* * * Next Change * * * *\n5.5.2.2.2\tUE initiated detach procedure completion for EPS services only\nWhen the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the UE and store the current EPS security context, if the Detach type IE does not indicate \"switch off\". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message. On reception of a DETACH REQUEST message indicating \"switch off\", the MME shall delete the current EPS security context if it is a mapped EPS security context.\nThe network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME.\nThe UE, when receiving the DETACH ACCEPT message, shall stop timer T3421.\nThe UE is marked as inactive in the network for EPS services. State EMM-DEREGISTERED is entered in the network.\nThe UE in PS mode of operation shall enter the EMM-DEREGISTERED state.\nThe UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, disable EUTRAN and select GERAN or UTRAN access technology and enter the EMM-NULL state.\n\n* * * Next Change * * * *\n5.5.3.3.4\tCombined tracking area updating procedure accepted by the network\n5.5.3.3.4.1\tGeneral\nDepending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, the following different cases can be distinguished:\n1)\tThe EPS update result IE value indicates \"combined TA/LA updated\": Tracking and location area updating is successful for EPS and non-EPS services, or for EPS services and \"SMS only\";\n2)\tThe EPS update result IE value indicates \"TA updated\": Tracking area updating is successful, but location area updating for non-EPS services or \"SMS only\" is not successful.\nA TRACKING AREA UPDATE COMPLETE message shall be returned to the network if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a mobile identity or both.\n5.5.3.3.4.2\tCombined tracking area updating successful\nThe description for normal tracking area update as specified in subclause\u00a05.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.\nThe TMSI reallocation may be part of the combined tracking area updating procedure. The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). In this case the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3450 as described in subclause\u00a05.4.1. The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. If the MME does not indicate \"SMS only\" in the TRACKING AREA UPDATE ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area. \nThe UE, receiving a TRACKING AREA UPDATE ACCEPT message, stores the received location area identification, resets the location update attempt counter, sets the update status to U1 UPDATED and enters MM state MM IDLE.\nIf the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of \"forbidden location areas for regional provision of service\" or the list of \"forbidden location areas for roaming\" then such entry shall be deleted.\nIf the UE requested \"SMS only\" in the Additional update type IE, the network shall indicate \"SMS only\" in the Additional update result IE.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"SMS only\" or \"CS Fallback not preferred\", a UE operating in CS/PS mode 1 with \"IMS voice not available\" and configured to use CS fallback shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the selected PLMN or equivalent PLMN. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"SMS only\", a UE operating in CS/PS mode 2 shall not attempt to use CS fallback for mobile originating services.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"CS Fallback not preferred\", this indicates to a UE operating in CS/PS mode 2 that it is attached for EPS and non-EPS services and that it can use CS fallback.\nHow to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. \n-\tIf neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.\nThe network receiving a TRACKING AREA UPDATE COMPLETE message stops timer T3450, changes to state EMM-REGISTERED and considers the new TMSI as valid.\n5.5.3.3.4.3\tCombined tracking area updating successful for EPS services only\nApart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in subclause\u00a05.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.\nThe UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t\t(IMSI unknown in HSS)\n\tThe UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.\n#16\t(MSC temporarily not reachable);\n#17\t(Network failure); or\n#22\t(Congestion)\n\tThe UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\n\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again.\n\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\nNOTE\u00a01:\tIt is up to the UE implementation when to enable E-UTRAN radio access technology selection.\n#18\t(CS domain not available)\n\tThe UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\n\tThe UE shall set the update status to U2 NOT UPDATED.\n\tA UE in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the selected PLMN or equivalent PLMN. The UE shall disable the E-UTRA capability (see subclause\u00a04.5). If the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN or UTRAN radio access technology.\n\tA UE in CS/PS mode 2 of operation may provide a notification to the user or the upper layers that the CS domain is not available.\n\tThe UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.\nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for EPS and non-EPS services. The behaviour of the UE in those cases is specified in subclause\u00a05.5.3.3.6.\n\n\n* * * Next Change * * * *\n5.5.3.3.6\tAbnormal cases in the UE\nThe UE shall proceed as follows:\n-\tif the UE requested the combined tracking area update for EPS services and \"SMS only\" and the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and \"SMS only\".\nNOTE:\tIn this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to \"CS\", as specified in subclause\u00a05.6.2.3.2.\n-\tif the combined tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in subclause\u00a05.5.3.3.4.3 or the EMM Cause IE is not included in the message, the UE shall follow the procedure specified in subclause\u00a05.5.3.2.6, item\u00a0d with the following modification;\n-\totherwise, the abnormal cases specified in subclause\u00a05.5.3.2.6 apply with the following modification.\nIf the tracking area updating attempt counter is incremented according to subclause\u00a05.5.3.2.6 the next actions depend on the value of the tracking area updating attempt counter.\n-\tif the update status is U1 UPDATED and the tracking area updating attempt counter is less than 5, then the UE shall keep the update status to U1 UPDATED, the new MM state is MM IDLE substate NORMAL SERVICE;\n-\tif the tracking area updating attempt counter is less than 5 and, additionally, the update status is different from U1 UPDATED UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The MM state remains MM LOCATION UPDATING PENDING; or\n-\tif the tracking area updating attempt counter is equal to 5, the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. A UE operating in CS/PS mode 1 of operation shall select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures.\nNOTE:\tIt is up to the UE implementation when to enable E-UTRAN radio access technology selection.\n\n* * * Next Change * * * *\n8.2.1\tAttach accept\n8.2.1.1\tMessage definition\nThis message is sent by the network to the UE to indicate that the corresponding attach request has been accepted. See table\u00a08.2.1.1.\nMessage type:\tATTACH ACCEPT\nSignificance:\t\tdual\nDirection:\t\t\tnetwork to UE\nTable 8.2.1.1: ATTACH ACCEPT message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tProtocol discriminator\tProtocol discriminator\t9.2\tM\tV\t1/2\n\tSecurity header type\tSecurity header type\t9.3.1\tM\tV\t1/2\n\tAttach accept message identity\tMessage type\t9.8\tM\tV\t1\n\tEPS attach result\tEPS attach result\t9.9.3.10\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.9.2.9\tM\tV\t1/2\n\tT3412 value\tGPRS timer\t9.9.3.16\tM\tV\t1\n\tTAI list\tTracking area identity list\t9.9.3.33\tM\tLV\t7-97\n\tESM message container\tESM message container\t9.9.3.15\tM\tLV-E\t5-n\n50\tGUTI\tEPS mobile identity\t9.9.3.12\tO\tTLV\t13\n13\tLocation area identification\tLocation area identification\t9.9.2.2\tO\tTV\t6\n23\tMS identity\t\tMobile identity\t9.9.2.3\tO\tTLV\t7-10\n53\tEMM cause\tEMM cause\t9.9.3.9\tO\tTV\t2\n17\tT3402 value\tGPRS timer\t9.9.3.16\tO\tTV\t2\n59\tT3423 value\tGPRS timer\t9.9.3.16\tO\tTV\t2\n4A\tEquivalent PLMNs\tPLMN list\t9.9.2.8\tO\tTLV\t5-47\n34\tEmergency number list\tEmergency number list\t9.9.3.37\tO\tTLV\t5-50\n64\tEPS network feature support\tEPS network feature support\t9.9.3.12A\tO\tTLV\t3\nF-\tAdditional update result\tAdditional update result\n9.9.3.0A\tO\tTV\t1\n5E\tT3412 extended value\tGPRS timer 3\t9.9.3.16B\tO\tTLV\t3\n\n8.2.1.2\tGUTI\nThis IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.\n8.2.1.3\tLocation area identification\nThis IE may be included to assign a new location area identification to a UE during a combined attach.\n8.2.1.4\tMS identity\nThis IE may be included to assign or unassign a new TMSI to a UE during a combined attach.\n8.2.1.5\tEMM cause\nThis IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.\n8.2.1.6\tT3402 value\nThis IE may be included to indicate a value for timer T3402.\nIf this IE is not included, the UE shall use the default value.\n8.2.1.7\tT3423 value\nThis IE may be included to indicate a value for timer T3423.\nIf this IE is not included, the UE shall use the default value.\n8.2.1.8\tEquivalent PLMNs\nThis IE may be included in order to assign a new equivalent PLMNs list to a UE.\n8.2.1.9\tEmergency number list\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same MCC as in the cell on which this IE is received.\n8.2.1.10\tEPS network feature support\nThe network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\n8.2.1.11\tAdditional update result\nThe network may include this IE to provide the UE with additional information about the result of a combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and \"SMS only\".\n8.2.1.12\tT3412 extended value\nThe network may include this IE to provide the UE with longer periodic tracking area update timer.\n\n\n\n\n* * * Next Change * * * *\n8.2.26\tTracking area update accept\n8.2.26.1\tMessage definition\nThis message is sent by the network to the UE to provide the UE with EPS mobility management related data in response to a tracking area update request message. See table\u00a08.2.26.1.\nMessage type:\tTRACKING AREA UPDATE ACCEPT\nSignificance:\t\tdual\nDirection:\t\t\tnetwork to UE\nTable 8.2.26.1: TRACKING AREA UPDATE ACCEPT message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tProtocol discriminator\tProtocol discriminator\t9.2\tM\tV\t1/2\n\tSecurity header type\tSecurity header type\t9.3.1\tM\tV\t1/2\n\tTracking area update accept message identity\tMessage type\t9.8\tM\tV\t1\n\tEPS update result\tEPS update result\t9.9.3.13\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.9.2.9\tM\tV\t1/2\n5A\tT3412 value\tGPRS timer\t9.9.3.16\tO\tTV\t2\n50\tGUTI\tEPS mobile identity\t9.9.3.12\tO\tTLV\t13\n54\tTAI list\tTracking area identity list\t9.9.3.33\tO\tTLV\t8-98\n57\tEPS bearer context status\tEPS bearer context status\t9.9.2.1\tO\tTLV\t4\n13\tLocation area identification\tLocation area identification\t9.9.2.2\tO\tTV\t6\n23\tMS identity\tMobile identity\t9.9.2.3\tO\tTLV\t7-10\n53\tEMM cause\tEMM cause\t9.9.3.9\tO\tTV\t2\n17\tT3402 value\tGPRS timer\t9.9.3.16\tO\tTV\t2\n59\tT3423 value\tGPRS timer\t9.9.3.16\tO\tTV\t2\n4A\tEquivalent PLMNs\tPLMN list\t9.9.2.8\tO\tTLV\t5-47\n34\tEmergency number list\tEmergency number list\t9.9.3.37\tO\tTLV\t5-50\n64\tEPS network feature support\tEPS network feature support\t9.9.3.12A\tO\tTLV\t3\nF-\tAdditional update result\tAdditional update result\n9.9.3.0A\tO\tTV\t1\n5E\tT3412 extended value\tGPRS timer 3\t9.9.3.16B\tO\tTLV\t3\n\n8.2.26.2\tT3412 value\nThe MME shall include this IE during normal and combined tracking area updating procedure, and may include this IE during periodic tracking area updating procedure.\nThe MME shall include this IE if it includes the T3412 extended value IE.\n8.2.26.3\tGUTI\nThis IE may be included to assign a GUTI to a UE.\n8.2.26.4\tTAI list\nThis IE may be included to assign a TAI list to a UE.\n8.2.26.5\tEPS bearer context status\nThis IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.\n8.2.26.6\tLocation area identification\nThis IE may be included to assign a new location area identification to a UE during a combined TA/LA update.\n8.2.26.7\tMS identity\nThis IE may be included to assign or unassign a new TMSI to a UE during a combined TA/LA update.\n8.2.26.8\tEMM cause\nThis IE shall be included if the combined tracking area updating procedure was successful for EPS services only.\n8.2.26.9\tT3402 value\nThis IE may be included to indicate a value for timer T3402.\nIf this IE is not included, the UE shall use the default value.\n8.2.26.10\tT3423 value\nThis IE may be included to indicate a value for timer T3423.\nIf this IE is not included, the UE shall use the default value.\n8.2.26.11\tEquivalent PLMNs\nThis IE may be included in order to assign a new equivalent PLMNs list to a UE.\n8.2.26.12\tEmergency number list\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same MCC as in the cell on which this IE is received.\n8.2.26.13\tEPS network feature support\nThe network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\n8.2.26.14\tAdditional EPS result\nThe network may include this IE to provide the UE with additional information about the result of a combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and \"SMS only\".\n8.2.26.15\tT3412 extended value\nThe network may include this IE to provide the UE with a longer periodic tracking area update timer.\n\n\n\n\n* * * Next Change * * * *\n10.2\tTimers of EPS mobility management\nTable 10.2.1: EPS mobility management timers \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3402\tDefault 12 min.\tNOTE\u00a01\tEMM-DEREGISTERED\tEMM-REGISTERED\tAt attach failure and the attempt counter is equal to 5.\tAt tracking area updating failure and the attempt counter is equal to 5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tInitiation of the attach procedure, if still required or TAU procedure\nT3410\t15s\tEMM-REGISTERED-INITIATED\tATTACH REQUEST sent\tATTACH ACCEPT received\tATTACH REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.1.2.6\nT3411\t10s\tEMM-DEREGISTERED. ATTEMPTING-TO-ATTACH\t\tEMM-REGISTERED. ATTEMPTING-TO-UPDATE\t\tEMM-REGISTERED. NORMAL-SERVICE\tAt attach failure due to lower layer failure, T3410 timeout or attach rejected with other EMM cause values than those treated in subclause\u00a05.5.1.2.5.\t\tAt tracking area updating failure due to lower layer failure, T3430 timeout or TAU rejected with other EMM cause values than those treated in subclause\u00a05.5.3.2.5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tEMM-CONNECTED mode entered (NOTE\u00a06)\tRetransmission of the ATTACH REQUEST, if still required as described in subclause\u00a05.5.1.2.6 or retransmission of TRACKING AREA UPDATE REQUEST\nT3412\tDefault 54 min.\tNOTE\u00a02\tNOTE\u00a05\tEMM-REGISTERED\tIn EMM-REGISTERED, when EMM-CONNECTED mode is left.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode. \tInitiation of the periodic TAU procedure if the UE is not attached for emergency bearer services.\t\tImplicit detach from network if the UE is attached for emergency bearer services.\nT3416\t30s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tRAND and RES stored as a result of an EPS authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tTRACKING AREA UPDATE ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\tEMM-DEREGISTERED or EMM-NULL entered\tDelete the stored RAND and RES\nT3417\t5s\tEMM-SERVICE-REQUEST-INITIATED\tSERVICE REQUEST sent\tEXTENDED SERVICE REQUEST sent in case f, g, i and j in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent with service type set to \u201cpacket services via S1\u201d in case a, b, c, h and k in subclause 5.6.1.1\tBearers have been set up\tSERVICE REJECT received\tAbort the procedure\nT3417ext\t10s\tEMM-SERVICE-REQUEST-INITIATED\tEXTENDED SERVICE REQUEST sent in case d in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent in case e in subclause\u00a05.6.1.1 and the CSFB response was set to \"CS fallback accepted by the UE\"\tInter-system change from S1 mode to A/Gb mode or Iu mode is completed\tInter-system change from S1 mode to A/Gb mode or Iu mode is failed\tSERVICE REJECT received\tAbort the procedure\nT3418\t20s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (EMM cause = #20 \"MAC failure\" or #26 \"non-EPS authentication unacceptable\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3420\t15s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (cause = #21 \"synch failure\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3421\t15s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3423\tNOTE\u00a03\tEMM-REGISTERED\tT3412 expires while ISR is activated and the UE is in one of the following states:\t- EMM-REGISTERED.NO-CELL-AVAILABLE ;\t- EMM-REGISTERED.PLMN-SEARCH; \t-EMM-REGISTERED-UPDATE-NEEDED; or\t-EMM-REGISTERED.LIMITED-SERVICE.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode.\tSet TIN to \"PTMSI\"\nT3430\t15s\tEMM-TRACKING-AREA-UPDATING-INITIATED\tTRACKING AREA UPDATE REQUEST sent\tTRACKING AREA UPDATE ACCEPT received\tTRACKING AREA UPDATE REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.3.2.6\nT3440\t10s\tEMM-REGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tEMM-REGISTERED\tATTACH REJECT, DETACH REQUEST, TRACKING AREA UPDATE REJECT with any of the EMM cause #11, #12, #13, #14 or #15\tSERVICE REJECT received with any of the EMM cause #11, #12, #13 or #15\tTRACKING AREA UPDATE ACCEPT received after the UE sent TRACKING AREA UPDATE REQUEST in EMM-IDLE mode with no \"active\" flag and the user plane radio bearers have not been setup\tDETACH ACCEPT received after the UE sent DETACH REQUEST with detach type to \"IMSI detach\"\tSignalling connection released\tBearers have been set up\tRelease the signalling connection and proceed as described in subclause\u00a05.3.1.2\nT3442\tNOTE\u00a04\tEMM-REGISTERED\tSERVICE REJECT received with EMM cause #39 \"CS service temporarily not available\" with a non-zero T3442 value\tTRACKING AREA UPDATE REQUEST sent\tNone\n\nNOTE\u00a01:\tThe cases in which the default value of this timer is used are described in subclause\u00a05.3.6.\tNOTE\u00a02:\tThe value of this timer is provided by the network operator during the attach and tracking area updating procedures.\tNOTE\u00a03:\tThe value of this timer may be provided by the network in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. The default value of this timer is identical to the value of T3412.\tNOTE\u00a04:\tThe value of this timer is provided by the network operator when a service request for CS fallback is rejected by the network with EMM cause #39 \"CS service temporarily not available\".\tNOTE\u00a05:\tThe default value of this timer is used if the network does not indicate a value in the TRACKING AREA UPDATE ACCEPT message and the UE does not have a stored value for this timer.\tNOTE\u00a06:\tThe conditions for which this applies are described in subclause\u00a05.5.3.2.6.\n\nTable 10.2.2: EPS mobility management timers \u2013 network side\nTIMER NUM.\tTIMER VALUE\tSTATE \tCAUSE OF START\tNORMAL STOP\tON THE\n1st, 2nd, 3rd, 4th EXPIRY (NOTE\u00a01)\nT3413\tNOTE\u00a02\tEMM-REGISTERED\tPaging procedure for EPS services initiated\tPaging procedure for EPS services completed\tNetwork dependent\nT3422\t6s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3450\t6s\tEMM-COMMON-PROC-INIT\tATTACH ACCEPT sent\t\tTRACKING AREA UPDATE ACCEPT sent with GUTI\t\tTRACKING AREA UPDATE ACCEPT sent with TMSI\t\tGUTI REALLOCATION COMMAND sent\tATTACH COMPLETE received\tTRACKING AREA UPDATE COMPLETE received\tGUTI REALLOCATION COMPLETE received\tRetransmission of the same message type, i.e. ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT or GUTI REALLOCATION COMMAND\nT3460\t6s\tEMM-COMMON-PROC-INIT\tAUTHENTICATION REQUEST sent\t\tSECURITY MODE COMMAND sent\tAUTHENTICATION RESPONSE received\tAUTHENTICATION FAILURE received\tSECURITY MODE COMPLETE received\tSECURITY MODE REJECT received\tRetransmission of the same message type, i.e. AUTHENTICATION REQUEST\tor SECURITY MODE COMMAND\nT3470\t6s\tEMM-COMMON-PROC-INIT\tIDENTITY REQUEST sent\tIDENTITY RESPONSE received\tRetransmission of IDENTITY REQUEST\nMobile reachable\tNOTE 4\tAll except EMM-DEREGISTERED\tEntering EMM-IDLE mode\tNAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry if the UE is not attached for emergency bearer services.\t\tImplicitly detach the UE which is attached for emergency bearer services.\nImplicit detach timer\tNOTE 3\tAll except EMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in EMM-IDLE mode \tNAS signalling connection established\tImplicitly detach the UE on 1st expiry\nNOTE\u00a01:\tTypically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding procedure description.\tNOTE\u00a02:\tThe value of this timer is network dependent.\tNOTE\u00a03:\tThe value of this timer is network dependent. If ISR is activated, the default value of this timer is 4 minutes greater than T3423.\tNOTE\u00a04:\tThe default value of this timer is 4 minutes greater than T3412. If T3346 is larger than T3412 and the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or SERVICE REJECT message, the value of the Mobile reachable timer is 4 minutes greater than T3346. If the UE is attached for emergency bearer services, the value of this timer is set equal to T3412. \n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the temporary failure or congestion of network occur, a UE operating in CS/PS mode1 of operation with \u201cIMS voice not available\u201d shall disable E-UTRA capability when the UE\u2019s Attach/TAU attempt counter reaches to 5. Once the UE disables E-UTRA capability, the UE cannot camp on LTE cell until the UE mode of operation is changed, the UE powers off and powers on again or the PLMN selection is performed, which is described in TS24.301 Clause 4.5. This UE\u2019s behaviour has a problem of useability because the UE might not be able to use LTE until either above UE\u2019s actions to enable E-UTRA capability, which tend to be triggered by user operation, is executed even if the network recovers from temporary failure or congestion. The solution to resolve this useability problem is needed. In this case, it is preferred that the UE can enable E-UTRA capability without user operation.\n\n>>> SUMMARY OF CHANGE\nTimer T34XX is introduced. Timer T34XX is started when the UE operating in CS/PS mode1 of operation with \u201cIMS voice not available\u201d disables E-UTRA capability. If timer T34XX expires, the UE shall enable E-UTRA capability.The trigger to start timer T34XX is only the case that the UE operates in CS/PS mode1 of operation with \u201cIMS voice not available\u201d and the Attach/TAU attempt counter reaches to 5. The following cases are excluded from the trigger to start timer T34XX.The UE receives Attach/TAU Accept including Additional update result IE with value \u201cSMS only\u201d or \u201cCS Fallback not preffered\u201d(TS 24.301 Clause 5.5.1.3.4.2 and 5.5.3.3.4.2)Combined Attach/TAU procedure results in success for EPS services only with EMM cause value \u201c#18: CS domain not available\u201d(TS 24.301 Clause 5.5.1.3.4.3 and 5.5.3.3.4.3)UE initiated detach procedure for EPS services only is completed.(TS 24.301 Clause 5.5.2.2.2) If the NAS signalling connection is established when timer T34XX expires, enabling E-UTRAN capability shall be delayed until the NAS signalling connection is released.It is proposed that the value of timer T34XX is controlled by including in Attach/TAU Accept like timer T3402 so that the operator can control the value of timer T34XX.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf the temporary failure or congestion of network occur, a UE operating in CS/PS mode1 of operation with \u201cIMS voice not available\u201d would disable E-UTRA capability when the UE\u2019s Attach/TAU attempt counter reaches to 5. Thereafter, the UE might not be able to use LTE until the specific user operation is excuted even if the network recovers from temporary failure or congestion."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n**** START OF CHANGES ****\n13.4\tAuthorization of NF service access\n13.4.1\tOAuth 2.0 based authorization of Network Function service access\n13.4.1.0\tGeneral\nThe authorization framework described in clause 13.4.1 allows NF service producers to authorize the requests from NF service requestors. \nThe authorization framework uses the OAuth 2.0 framework as specified in RFC 6749 [43]. Grants shall be of the type Client Credentials Grant, as described in clause 4.4 of RFC 6749 [43]. Access tokens shall be JSON Web Tokens as described in RFC 7519 [44] and are secured with digital signatures or Message Authentication Codes (MAC) based on JSON Web Signature (JWS) as described in RFC 7515 [45]. \nThe basic extent provided by the authorization token is at service level (i.e. the \"scope\" claim includes allowed services per NF type). Depending on the NF service producer configuration, higher level of granularity for the authorization token can be defined adding \"additional scope\" information within the token e.g. to authorize specific service operations and/or resources/data sets within service operations per NF consumer type.\nNOTE 1: The additional scope(s) included within the access token add additional security checks at the NF service producer that authorizes the services operations, resources and NF consumer type related to the additional scope(s).    \nThe authorization framework described in clause 13.4.1 is mandatory to support for NRF and NF.\n13.4.1.1\tService access authorization within the PLMN\nOAuth 2.0 roles, as defined in clause 1.1 of RFC 6749 [43], are as follows:\na.\tThe Network Resource Function (NRF) shall be the OAuth 2.0 Authorization server.\nb.\tThe NF service consumer shall be the OAuth 2.0 client.\nc.\tThe NF service producer shall be the OAuth 2.0 resource server.\n\nOAuth 2.0 client (NF service consumer) registration with the OAuth 2.0 authorization server (NRF)\nThe NF service registration procedure, as defined in clause 4.17.1 of TS 23.502 [8], shall be used to register the OAuth 2.0 client (NF service consumer) with the OAuth 2.0 Authorization server (NRF), as described in clause 2.0 of RFC 6749 [43]. The client id, used during OAuth 2.0 registration, shall be the NF Instance Id of the NF.\n\n\n\n\n\nOAuth 2.0 resource server (NF service producer) registration with the OAuth 2.0 authorization server (NRF)\nThe NF service registration procedure, as defined in clause 4.17.1 of TS 23.502 [8], shall be used to register the OAuth 2.0 resource server (NF service producer) with the OAuth 2.0 Authorization server (NRF). The NF service producer, as part of its NF profile, may include \"additional scope\" information related to the allowed service operations and resources per NF consumer type.\n\nFigure 13.4.1.1-1b NF service producer registers in NRF\nThe NF service producer registers as OAuth 2.0 resource server in the NRF. The NF profile configuration data of the NF service producer may include the \"additional scope\". The \"additional scope\" information indicates the resources and the actions (service operations) that are allowed on these resources for the NF service consumer. These resources may be per NF type of the consumer or per NF instance ID of the consumer.\nAfter storing the NF Profile, NRF responds successfully.\nAccess token request before service access\nThe following procedure describes how the NF service consumer obtains an access token before service access to NF service producers of a specific NF type.  \nPre-requisite:\na.\tThe NF Service consumer (OAuth2.0 client) is registered with the NRF (Authorization Server) with its NF type.\nThe NF Service producer (OAuth2.0 resource server) is registered with the NRF (Authorization Server) with \"additional scope\" information per NF type.\nc.\tThe NRF and NF service producer share the required credentials. \nd. The NRF and NF have mutually authenticated each other. \n\n\n\nFigure 13.4.1.1-1: NF service consumer obtaining access token before NF service access\n1. The NF service consumer shall request an access token from the NRF in the same PLMN using the Nnrf_AccessToken_Get request operation. The message shall include the NF Instance Id(s) of the NF service consumer, the requested \"scope\" including the expected NF service name(s) and optionally \"additional scope\" information (i.e. requested resources and requested actions (service operations) on the resources), NF type of the expected NF producer instance and NF consumer. The service consumer may also include a list of NSSAIs or list of NSI IDs for the expected NF producer instances. The message may include the NF Set ID of the expected NF service producer instances.\n2. The NRF may optionally authorize the NF service consumer. It shall then generate an access token with appropriate claims included. The NRF shall digitally sign the generated access token based on a shared secret or private key as described in RFC 7515 [45].\nThe claims in the token shall include the NF Instance Id of NRF (issuer), NF Instance Id of the NF Service consumer (subject), NF type of the NF Service producer (audience), expected service name(s), scope (scope), expiration time (expiration) and optionally \"additional scope\" information (allowed resources and allowed actions (service operations) on the resources). The claims may include a list of NSSAIs or NSI IDs for the expected NF producer instances. The claims may include the NF Set ID of the expected NF service producer instances.\n3. If the authorization is successful, the NRF shall send access token to the NF service consumer in the Nnrf_AccessToken_Get response operation, otherwise it shall reply based on Oauth 2.0 error response defined in RFC 6749 [43]. The other parameters (e.g. the expiration time, allowed scope) sent by NRF in addition to the access token are described in TS 29.510 [68].\nThe NF service consumer may store the received token(s). Stored tokens may be re-used for accessing service(s) from producer NF type listed in claims (scope, audience) during their validity time. \n\nAccess token request for a specific NF Producer/NF Producer service instance\nThe NF service consumer shall request an access token from the NRF for a specific NF Producer instance/NF Producer service instance. The request shall include the NF Instance Id(s) of the requested NF Producer, the expected NF service name, optionally \"additional scope\" information (allowed resources and allowed actions (service operations) on the resources) and NF Instance Id of the NF service consumer. \nThe NRF may optionally authorize the NF service consumer to use the requested NF Producer instance/NF Producer service instance, and then proceeds to generate an access token with the appropriate claims included.  \nThe claims in the token shall include the NF Instance Id of NRF (issuer), NF Instance Id of the NF Service consumer (subject), NF Instance Id or several NF Instance Id(s) of the requested NF Service Producer (audience), expected service name(s) (scope) , optionally \"additional scope\" information (allowed resources and allowed actions (service operations) on the resources), and expiration time (expiration). The token shall be included in the Nnrf_AccessToken_Get response sent to the NF service consumer.\n\nService access request based on token verification\nThe following figure and procedure describe how authorization is performed during Service request of the NF service consumer. Prior to the request, the NF service consumer may perform Nnrf_NFDiscovery_Request operation with the requested additional scopes to select a suitable NF service producer (resource server) which is able to authorize the Service Access request.\n\nFigure 13.4.1.1-2: NF service consumer requesting service access with an access token\nPre-requisite: The NF service consumer is in possession of a valid access token before requesting service access from the NF Service producer.\n1.\tThe NF Service consumer requests service from the NF service producer. The NF Service Consumer shall include the access token. \nThe NF Service consumer and NF service producer shall authenticate each other following clause 13.3.\n2.\tThe NF Service producer shall verify the token as follows:\n -\tThe NF Service producer ensures the integrity of the token by verifying the signature using NRF\u2019s public key or checking the MAC value using the shared secret. If integrity check is successful, the NF Service producer shall verify the claims in the token as follows:\nNOTE: Void.\n-\tIt checks that the audience claim in the access token matches its own identity or the type of NF service producer. If a list of NSSAIs or list of NSI IDs is present, the NF service producer shall check that it serves the corresponding slice(s).\n-\tIf an NF Set ID present, the NF service producer shall check the NF Set ID in the claim matches its own NF Set ID.\n-\tIf scope is present, it checks that the scope matches the requested service operation.\n- \tIf the access token contains \"additional scope\" information (i.e. allowed resources and allowed actions (service operations) on the resources), it checks that the additional scope matches the requested service operation.\n\n-\tIt checks that the access token has not expired by verifying the expiration time in the access token against the current data/time.\n3.\tIf the verification is successful, the NF Service producer shall execute the requested service and responds back to the NF Service consumer. Otherwise it shall reply based on Oauth 2.0 error response defined in RFC 6749 [43]. The NF service consumer may store the received token(s). Stored tokens may be re-used for accessing service(s) from producer NF type listed in claims (scope, audience) during their validity time.\n13.4.1.2\tService access authorization in roaming scenarios \nIn the roaming scenario, OAuth 2.0 roles are as follows:\na.\tThe visiting Network Resource Function (vNRF) shall be the OAuth 2.0 Authorization server for vPLMN and authenticates the NF service consumer. \nb.\tThe home Network Resource Function (hNRF) shall be OAuth 2.0 Authorization server for hPLMN and generates the access token.\nc.\tThe NF service consumer in the visiting PLMN shall be the OAuth 2.0 client.\nd.\tThe NF service producer in the home PLMN shall be the OAuth 2.0 resource server.\n\nOAuth 2.0 client (NF service consumer) registration with the OAuth 2.0 authorization server (NRF) in the vPLMN\nSame as in the non-roaming scenario in 13.4.1.1.\n\nOAuth 2.0 resource server (NF service producer) registration with the OAuth 2.0 authorization server (NRF) in the hPLMN\nSame as in the non-roaming scenario in 13.4.1.1.\n\nObtaining access token independently before NF service access\nThe following procedure describes how the NF service consumer obtains an access token for NF service producers of a specific NF type for use in the roaming scenario. \n\nFigure 13.4.1.2-1: NF service consumer obtaining access token before NF service access (roaming)\nPre-requisite:\na.\tThe NF Service consumer (OAuth2.0 client) is registered with the vNRF (Authorization Server in the vPLMN).\nb.\tThe hNRF and NF service producer share the required credentials. Additionally, the NF Service producer (OAuth2.0 resource server) is registered with the hNRF (Authorization Server in the hPLMN) with \"additional scope\" information per NF type.\nc.\tThe two NRFs have mutually authenticated each other.\nd.\tThe NRF in the serving PLMN and NF service consumer have mutually authenticated each other. \n\n1.\tThe NF service consumer shall invoke Nnrf_AccessToken_Get Request (NF Instance Id of the NF service consumer, the requested \"scope\" including the expected NF service Name (s) and optionally \"additional scope\" information (i.e. requested resources and requested actions (service operations) on the resources), NF Type of the expected NF Producer instance, NF type of the NF consumer, home and serving PLMN IDs, optionally list of NSSAIs or list of NSI IDs for the expected NF producer instances), optionally NF Set ID of the expected NF service producer from NRF in the same PLMN. \n2.\tThe NRF in serving PLMN shall identify the NRF in home PLMN (hNRF) based on the home PLMN ID and request an access token from hNRF as described in clause 4.17.5 of TS 23.502 [8]. The vNRF shall forward the parameters it obtained from the NF service consumer, including NF service consumer type, to the hNRF.\n3.\tThe hNRF may optionally authorize the NF service consumer and shall generate an access token with appropriate claims included as defined in clause 13.4.1.1. The hNRF shall digitally sign the generated access token based on a shared secret or private key as described in RFC 7515 [45].\n\nThe claims in the token shall include the NF Instance Id of NRF (issuer), NF Instance Id of the NF Service consumer appended with its PLMN ID (subject), NF type of the NF Service Producer appended with its PLMN ID (audience), expected services name(s), scope (scope) and expiration time (expiration), and optionally \"additional scope\" information (allowed resources and allowed actions (service operations) on the resources). The claims may include a list of NSSAIs or NSI IDs for the expected NF producer instances. The claims may include the NF Set ID of the expected NF service producer instances.\n4.\tIf the authorization is successful, the access token shall be included in Nnrf_AccessToken_Get Response message to the vNRF. Otherwise it shall reply based on Oauth 2.0 error response defined in RFC 6749 [43]. The NF service consumer may store the received token(s). Stored tokens may be re-used for accessing service(s) from producer NF type listed in claims (scope, audience) during their validity time. The other parameters (e.g., the expiration time, allowed scope) sent by NRF in addition to the access token are described in TS 29.510 [68].\n5.\tThe vNRF shall forward the Nnrf_AccessToken_Get Response or error message to the NF service consumer.\n\nObtain access token for a specific NF Producer/NF Producer service instance\nThe NF service consumer shall request an access token from the NRF for a specific NF Producer instance/NF Producer service instance. The request shall include the NF Instance Id of the requested NF Producer, appended with its PLMN ID the expected NF service name and NF Instance Id of the NF service consumer, appended with its PLMN ID \nThe NRF in the visiting PLMN shall forward the request to the NRF in the home PLMN\nThe NRF may optionally authorize the NF service consumer to use the requested NF Producer instance/NF Producer service instance and shall then proceed to generate an access token with the appropriate claims included.  \nThe claims in the token shall include the NF Instance Id of NRF (issuer), NF Instance Id of the NF Service consumer appended with its PLMN ID (subject), NF Instance Id of the requested NF Service Producer appended with its PLMN ID (audience), expected service name(s) (scope) and expiration time (expiration). The token shall be included in the Nnrf_AccessToken_Get response sent to the NRF in the visiting PLMN. The NRF in the visiting PLMN shall forward the Nnrf_AccessToken_Get response message to the NF service consumer. The NF service consumer may store the received token(s). Stored tokens may be re-used for accessing service(s) from producer NF type listed in claims (scope, audience) during their validity time.\n\nService access request based on token verification\nIn addition to the steps described in the non-roaming scenario in 13.4.1.1, the NF service producer shall verify that the PLMN-ID contained in the API request is equal to the one inside the access token.\n\nFigure 13.4.1.2-2: NF service consumer requesting service access with an access token in roaming case\nThe NF service producer shall check that the home PLMN ID of audience claim in the access token matches its own PLMN identity.\nThe pSEPP shall check that the serving PLMN ID of subject claim in the access token matches the remote PLMN ID corresponding to the N32-f context Id in the N32 message.\n**** END OF CHANGES ****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFor the \"Subscribe-Notify\" scenarios (delegated or non-delegated), the access token defined in SA3 for service authorization is not sufficient. Because the service producer cannot assure whether the URI sent in the subscription request is authorized or not, which may lead to a notification message leakage attack. In short, the notification message may forward to an unauthorized NF routed by the received URI.Therefore, the NRF is introduced here to authorize the callback URI, and put the URI into the access token after success authorization, from the security point of view. In order to support the verification by NRF, the NF consumer shall firstly register its notification URI into its NF profile stored in the NRF. Furthermore, considerring the difference between the delegated and non-delegated scenaro, whether the NF consumer could be able to delegate on behalf of the other NF shall be clearly defined in its NF profile also. Then during the Oauth authorization, the NRF could verify the correctness of the received URI, and the delegated capability. If the authorization successes, the notification URI and the delegated capablity will be added into the token.For the roaming scenario, the vNRF shall verify the token request first, since the NF consumer profile is stored in the vNRF based on the NF profile.\n\n>>> SUMMARY OF CHANGE\nAdding the notification URI of the NF consumer into the NF profile during the NF registration.Adding the subscribe indication (i.e. the delegated capablity) of the NF consumer into the NF profile during the NF registration.Update the Oauth procedure including the token generation and token verification for the subscribe/notify service in the non-roaming and roaming scenarios.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe unauthorized Callback URI may be used to trigger the data leakage attack."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * First Change * * * *\n\n4.2\tProtocol stack\nThe protocol stack for GTPv2 shall be as depicted in Figure 4.2-1.\n\nFigure 4.2-1: GTPv2 stack\nThe GTPv2 headers are specified in the respective clauses of this specification.\nThe source and destination IP addresses and UDP ports used for each GTP-C message depend on the role that the message plays in a message exchange. Messages can be initial messages, or triggered messages. An initial message is sent to a peer GTP entity with a sequence number chosen by the sending entity (see subclause 7.6). Triggered messages are sent in response to an initial message or to another triggered message.\nNOTE:\tExamples of initial messages are all command or notification messages.\nExamples of triggered messages are all responses or acknowledge messages as well as Version Not Supported Indication and Update Bearer Complete.\nSome request messages are initial messages in some procedures, but triggered messages in other procedures where they are triggered by an initial command message.\nPiggybacked messages are handled as triggered messages.\n4.2.1\tUDP header and port numbers\nA User Datagram Protocol (UDP) compliant with IETF RFC 768 [7] shall be used.\n4.2.1.1\tInitial Messages\nThe UDP Destination Port number for GTP-C request messages shall be 2123. It is the registered port number for GTP-C. \nThe UDP Source Port is a locally allocated port number at the sending GTP entity.\n4.2.1.2\tTriggered Messages\nThe UDP Destination Port value shall be the value of the UDP Source Port of the corresponding request message, except in the case of the SGSN pool scenario.\nThe UDP Source Port shall be the value from the UDP Destination Port of the corresponding request message, except in the case of the SGSN pool scenario.\nIn the SGSN pool scenario, if the Identification Request or the Context Request messages have been forwarded by another SGSN in the pool, the UDP Destination Port for the Identification Response or the Context Response message shall be determined in the following way. The value from the information element \"UDP Source Port Number\", which was sent in the corresponding forwarded request, shall be copied into the UDP Destination Port field. The UDP Source Port for the Identification Response or the Context Response message may be a locally allocated port number at the sending GTP entity.\n4.2.2\tIP header and IP addresses\n4.2.2.1\tInitial Messages\nThe IP Source Address shall be an IP address of the source GTPv2 entity from which the message is originating.\nThe IP Destination Address in a GTP request message shall be an IP address of the destination GTPv2 entity.\n4.2.2.2\tTriggered Messages\nThe IP Source Address shall be copied from the IP destination address of the GTP request message to which this GTPv2 entity is replying, except in the case of SGSN pool scenario. \nThe IP Destination Address shall be copied from the IP Source Address of the GTP request message to which this GTPv2 entity is replying, except in the case of the SGSN pool scenario.\nIn the SGSN pool scenario, if the Identification Request or the Context Request messages have been forwarded by another SGSN in the pool, the IP Source address for the Identification Response or the Context Response messages shall be locally allocated by the sending GTP entity. The IP Destination Address for the Identification Response or Context Response messages shall be determined in the following way. The value from the information element \"Address for Control Plane\", which was sent in the corresponding Identification Request message; or the value from the information element \"S3/S16/S10 Address and TEID for Control Plane\", which was sent in the corresponding Context Request message, shall be copied into the IP Destination Address field.\n4.2.3\tLayer 2\nTypically Ethernet should be used as a Layer 2 protocol, but operators may use any other technology.\n4.2.4\tLayer 1\nOperators may use any appropriate Layer 1 technology.\n\n\n\n\n\n\n\n\n\n* * * Second Change * * * *\n\n7.6\tReliable Delivery of Signalling Messages\n\n\n\nFor each triplet of local IP address, local UDP port and remote peer's IP address a GTP entity maintains a queue with signalling messages to be sent to that peer. The message at the front of the queue, if it is a request for which a response has been defined, shall be sent with a Sequence Number, and shall be held in a list until a response is received. The same provision is applicable to notification messages with an associated acknowledge message.  The Sequence Number shall be unique for each outstanding request message sourced from the same IP/UDP endpoint. A node running GTP may have several outstanding requests while waiting for responses. A single request shall be answered with a single response, regardless whether it is per UE, per APN, or per bearer. A request / response pair of messages shall have the same sequence number.\nThe Sequence Number shall be unique for each outstanding notification message sourced from the same IP/UDP endpoint. A node running GTP may have several outstanding notifications while waiting for acknowledge messages. A single notification shall be answered with a single acknowledge, regardless whether it is per UE, per APN, or per bearer. A notification / acknowledge pair of messages shall have the same sequence number.\nIn the specific case of GTP Command Messages which do not have an explicit response, but which trigger a Request Message, the sequence number used by Command Message shall be the same for all three messages: the Command, the triggered Request and the corresponding Response messages.\nA sequence number used for a Command Message and its associated messages shall have the most significant bit set to 1. A sequence number used for a Request Message not triggered by a Command Message shall have the most significant bit set to 0.\nThis setting of the most significant bit of the sequence number is done to avoid potential clashes between the sequence number selected for a Command Message, and the sequence number selected by a GTP peer for a Request Message which was not triggered by a Command Message.\nA timer shall be started when a signalling request message (for which a response has been defined) is sent. A signalling message request or response has probably been lost if a response has not been received before the timer expires. \nA timer shall be started when a notification message (for which an acknowledge messages has been defined) is sent. A notification or acknowledge message has probably been lost if a response has not been received before the timer expires.\nA timer shall be started when a command message is sent. A command or request message has probably been lost if a request has not been received before the timer expires.\nOnce a timer expires, the request is then retransmitted if the total number of request attempts is less than N3REQUESTS times. T3-RESPONSE timer and N3REQUESTS counter setting is implementation dependent. That is, the timers and counters may be configurable per procedure. Multileg communications (e.g. Create Session Requests and Responses) however require longer timer values and possibly a higher number of retransmission attempts compared to single leg communication.\n\nAll received request messages shall be responded to and all response messages associated with a certain request shall always include the same information. Duplicated response messages shall be discarded. A response message without a matching outstanding request should be considered as a duplicate.\nIf a GTPv2 node is not successful with the transfer of a non-Echo signalling message, e.g. a Create Bearer Context Request message, it shall inform the upper layer of the unsuccessful transfer so that the controlling upper entity may take the necessary measures.\n\n* * * Third Change * * * *\n7.7.1 \tProtocol Errors\nA protocol error is defined as a message or an Information Element received from a peer entity with unknown type, or if it is unexpected, or if it has an erroneous content. \nThe term silently discarded is used in the following subclauses to mean that the receiving GTP entity's implementation shall discard such a message without further processing, or that the receiving GTP entity discards such an IE and continues processing the message. The conditions for the receiving GTP entity to silently discard an IE are specified in the subsequent subclauses.\nThe handling of unknown, unexpected or erroneous GTP messages and IEs shall provide for the forward compatibility of GTP. Therefore, the sending GTP entity shall be able to safely include in a message a new conditional or an optional IE. Such an IE may also have a new type value. Any legacy receiving GTP entity shall, however, silently discard such an IE and continue processing the message.\nIf a protocol error is detected by the receiving GTP entity, it should log the event including the erroneous message and should include the error in a statistical counter.\nAn information element with \"Mandatory\" in the \"Presence requirement\" column of a message definition shall always be present in that message.\nAn information element with \"Conditional\" in the \"Presence requirement\" column of a message definition shall be sent when the conditions detailed in the \"Presence requirement\" are met.\nThe Version Not Supported Indication message shall be considered as Response for the purpose of this subclause.\n The receiving GTP entity shall apply the error handling specified in the subsequent subclauses in decreasing priority.\nIf the received erroneous message is a response to a pending GTP request message, the GTP transaction layer shall stop retransmissions and notify the GTP application layer of the error even if the response is silently discarded.\n* * * End Changes * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nGTPv2 sequence number behavior is not documented for all message types since in many cases text was written based on GTPv1 text where almost all messages are simple requests or simple responses this is no longer true in GTPv2 the naming of convention of messages are now much more varied.   . Retransmission of messages that are triggered messages that have a triggered reply is not documented at all in Clause 7.6 (example: \"Context Response\"). Note these are interelated topics since they are associated with a single GTPv2 initial message, its possible reply and then a possible reply to reply and so on that all share the same sequence number.\n\n>>> SUMMARY OF CHANGE\nAll sets of messages with the same sequence number are documented in a new subclause 4.2.x.  All text in 4.2 and 7.6 are updated to use the terms based on initial and triggered messages (previously it was used in some places but not others) . Retransmission is documented for all messages requiring retransmission (including triggered messages that are triggered by triggered messages). Timer T3-RESPONSE and counter N3-REQUEST were not completely defined in subclause 7.6 and this is corrected (unrelated change)\n\n>>> CONSEQUENCES IF NOT REVISED\nNo retransmissions of some messages such as \"Context Response\".to trigger the \"Context Acknowledge\", similarly no retransmission of \"Update Bearer Response\" when there is a following \"Update Bearer Complete:. Potentially unclear requirements in many other cases and a few contradictions in existing text. Possible incorrect handling of UDP ports or IP addresses for cases of a reply to a reply. This can result in messages being rejected or ignored. Handling of sequence numbers for messages with names other than Request and Response not fully specified."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * * First change * * * *\n5.30.2.3\tUE configuration and subscription aspects\n\nAn SNPN-enabled UE is configured with the following information for each subscribed SNPN:\n-\tPLMN ID and NID of the SNPN;\n-\tSubscriber identifier (SUPI) and credentials;\n-\tOptionally, an N3IWF FQDN and an identifier of the country where the configured N3IWF is located;\n-\tOptionally, if the UE supports access to an SNPN using credentials from a Credentials Holder:\n-\tUser controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of GINs.\nThe Credentials Holder controlled prioritized lists of preferred SNPNs and GINs can be updated by the Credentials Holder.\nEditor's note:\tWhether the Credentials Holder controlled lists can be updated using the UE Parameters Update (UPU) via UDM Control Plane Procedure as defined in TS\u00a023.502\u00a0[3] clause\u00a04.20 or the Steering of Roaming (SoR) procedure as defined in TS\u00a023.122\u00a0[17] Annex\u00a0C will be determined based on feedback from CT\u00a0WG1 and SA\u00a0WG3.\nA subscriber of an SNPN is either:\n-\tidentified by a SUPI containing a network-specific identifier that takes the form of a Network Access Identifier (NAI) using the NAI RFC 7542\u00a0[20] based user identification as defined in TS\u00a023.003\u00a0[19] clause\u00a028.7.2. The realm part of the NAI may include the NID of the SNPN; or\n-\tidentified by a SUPI containing an IMSI.\nIn the case of access to an SNPN using credentials owned by a Credentials Holder as specified in clause\u00a05.30.2.9.3, the SUPI shall also contain identification for the Credentials Holder (i.e. the realm in the case of Network Specific Identifier based SUPI or the MCC and MNC in the case of an IMSI based SUPI).\nNOTE\u00a01:\tWhen Credentials Holder is an SNPN, and the MCC and MNC of the SNPN is not unique, then IMSI based SUPI is not supported as the MCC and MNC need not be unique always; instead USIM credentials are supported using Network Specific Identifier based SUPI.\nNOTE\u00a02:\tNetwork Specific Identifier are not supported for the case the Credentials Holder is provided by a PLMN.\nAn SNPN-enabled UE that supports access to an SNPN using credentials from a Credentials Holder and that is equipped with a PLMN subscription may additionally be configured with the following information for SNPN selection and registration using the PLMN subscription in SNPN access mode:\n-\tUser controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred GINs.\nThe Credentials Holder controlled prioritized lists of preferred SNPNs and GINs can be updated by the Credentials Holder.\nEditor's note:\tWhether the Credentials Holder controlled lists can be updated using the UE Parameters Update (UPU) via UDM Control Plane Procedure as defined in TS\u00a023.502\u00a0[3] clause\u00a04.20 or the Steering of Roaming (SoR) procedure as defined in TS\u00a023.122\u00a0[17] Annex\u00a0C will be determined based on feedback from CT\u00a0WG1 and SA\u00a0WG3.\n* * * * Second change * * * *\n5.30.2.5\tNetwork access control\nIf a UE performs the registration or service request procedure in an SNPN identified by a PLMN ID and a self-assigned NID and there is no subscription for the UE, then the AMF shall reject the UE with an appropriate cause code to temporarily prevent the UE from automatically selecting and registering with the same SNPN.\nIf a UE performs the registration or service request procedure in an SNPN identified by a PLMN ID and a coordinated assigned NID and there is no subscription for the UE, then the AMF shall reject the UE with an appropriate cause code to permanently prevent the UE from automatically selecting and registering with the same SNPN.\n\nNOTE:\tThe details of rejection and cause codes is defined in TS\u00a024.501\u00a0[47].\nIn order to prevent access to SNPNs for authorized UE(s) in the case of network congestion/overload, Unified Access Control information is configured per SNPN (i.e. as part of the subscription information that the UE has for a given SNPN) and provided to the UE as described in TS\u00a024.501\u00a0[47].\n\n* * * * End of changes * * * *\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nObservation 1: If a UE supports access to an SNPN using credentials from a CH (Credentials Holder), the UE may attempt to access to an SNPN not authorized to use by using the credentials from a CH.Observation 2: If a UE supports operating in SNPN access mode, the UE may attempt to access to an SNPN not authorized to use by using the credentials from a 5G network other than the SNPN the UE attempts to register.In this scenario, the UE may attempt to register to a SNPN not authorized to use, it is proposed to reject such attempts based on UE subscription.\n\n>>> SUMMARY OF CHANGE\nWhen UE supports access to an SNPN using credentials from a CH and attempts to select and register to an unauthorized SNPN using the credentials from a CH, the SNPN should reject the UE\u2019s registration attempt and subsequently the UE should not try to select this SNPN again using credentials from a CH, at least in a period.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE may register to a unauthorized SNPN successfully using the credentials from a CH"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n1.2\tDefinitions and abbreviations\nFor the purposes of the present document, the abbreviations defined in 3GPP\u00a0TR\u00a021.905\u00a0[36] apply.\n(A/Gb mode only): Indicates this clause applies only to a GSM system which operates in A/Gb mode. For multi system case this is determined by the current serving radio access network.\n(Iu mode only): Indicates this clause applies only to UMTS system. For multi system case this is determined by the current serving radio access network.\nAcceptable Cell: This is a cell that the MS may camp on to make emergency calls. It must satisfy criteria which are defined for A/Gb mode in 3GPP\u00a0TS\u00a043.022\u00a0[35], for Iu mode in 3GPP\u00a0TS\u00a025.304\u00a0[32], and for S1 mode in 3GPP\u00a0TS\u00a036.304\u00a0[43].\nAccess Technology: The access technology associated with a PLMN. The MS uses this information to determine what type of radio carrier to search for when attempting to select a specific PLMN (e.g., GSM, UTRAN, GSM COMPACT or E-UTRAN). A PLMN may support more than one access technology.\nAllowable PLMN: In the case of a MS operating in MS operation mode A or B, this is a PLMN which is not in the list of \"forbidden PLMNs\" in the MS. In the case of a MS operating in MS operation mode C, this is a PLMN which is not in the list of \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\" in the MS\n\n\n\nAvailable PLMN: For GERAN A/Gb mode see 3GPP\u00a0TS\u00a043.022\u00a0[35]. For UTRAN see 3GPP\u00a0TS\u00a025.304\u00a0[32]. For E-UTRAN see 3GPP\u00a0TS\u00a036.304\u00a0[43]. For cdma2000\u00ae 1xRTT and cdma2000\u00ae HRPD see 3GPP2\u00a0C.S0016\u00a0[44].\nAvailable PLMN/access technology combination: This is an available PLMN in a specific access technology.\nCamped on a cell: The MS (ME if there is no SIM) has completed the cell selection/reselection process and has chosen a cell from which it plans to receive all available services. Note that the services may be limited, and that the PLMN may not be aware of the existence of the MS (ME) within the chosen cell.\nCountry: A country is identified by a single MCC value, with the exception that MCC values 310 through 316 identify a single country (USA) and MCC values 404 through 406 identify a single country (India).\nCSG whitelist: See 3GPP\u00a0TS\u00a036.304\u00a0[43].\nCurrent serving cell: This is the cell on which the MS is camped.\nCTS MS: An MS capable of CTS services is a CTS MS.\nEAB: Extended Access Barring, see 3GPP\u00a0TS\u00a022.011\u00a0[9].\nEHPLMN: Any of the PLMN entries contained in the Equivalent HPLMN list.\nEquivalent HPLMN list: To allow provision for multiple HPLMN codes, PLMN codes that are present within this list shall replace the HPLMN code derived from the IMSI for PLMN selection purposes. This list is stored on the USIM and is known as the EHPLMN list. The EHPLMN list may also contain the HPLMN code derived from the IMSI. If the HPLMN code derived from the IMSI is not present in the EHPLMN list then it shall be treated as a Visited PLMN for PLMN selection purposes.\nGeneric Access Network (GAN): See 3GPP\u00a0TS\u00a043.318\u00a0[35A].\nGAN mode: See 3GPP\u00a0TS\u00a043.318\u00a0[35A].\nGPRS MS: An MS capable of GPRS services is a GPRS MS. \nMS operation mode: See 3GPP\u00a0TS\u00a023.060\u00a0[27].\nHigh quality signal: The high quality signal limit is used in the PLMN selection procedure. It is defined in the appropriate AS specification: 3GPP\u00a0TS\u00a043.022\u00a0[35] for the GSM radio access technology, 3GPP\u00a0TS\u00a025.304\u00a0[32] for the UMTS radio access technology (FDD or TDD mode), 3GPP\u00a0TS\u00a036.304\u00a0[43] for the EUTRAN radio access technology. For 3GPP2 access technologies the high quality signal limit is defined in 3GPP2\u00a0C.S0011\u00a0[45] for cdma2000\u00ae 1xRTT and in 3GPP2\u00a0C.S0033\u00a0[46] for cdma2000\u00ae HRPD.\nHome PLMN: This is a PLMN where the MCC and MNC of the PLMN identity match the MCC and MNC of the IMSI. Matching criteria are defined in Annex A.\nIn A/Gb mode,...: Indicates this clause applies only to a GSM system which operates in A/Gb mode. For multi system case this is determined by the current serving radio access network.\nIn Iu mode,...: Indicates this clause applies only to UMTS system. For multi system case this is determined by the current serving radio access network.\nLocalised Service Area (LSA): A localised service area consists of a cell or a number of cells. The cells constituting a LSA may not necessarily provide contiguous coverage. \nLocation Registration (LR): An MS which is IMSI attached to non-GPRS services only performs location registration by the Location Updating procedure. A GPRS MS which is IMSI attached to GPRS services or to GPRS and non-GPRS services performs location registration by the Routing Area Update procedure only when in a network of network operation mode I. Both location updating and routing area update procedures are performed independently by the GPRS MS when it is IMSI attached to GPRS and non-GPRS services in a network of network operation mode II (see 3GPP\u00a0TS\u00a023.060\u00a0[27]). An MS which is attached via the E-UTRAN performs location registration by the tracking area update procedure.\nMS: Mobile Station. The present document makes no distinction between MS and UE.\nNetwork Type: The network type associated with HPLMN or a PLMN on the PLMN selector (see 3GPP\u00a0TS\u00a031.102\u00a0[40]). The MS uses this information to determine what type of radio carrier to search for when attempting to select a specific PLMN. A PLMN may support more than one network type. \nRegistered PLMN (RPLMN): This is the PLMN on which certain LR outcomes have occurred (see table\u00a01). In a shared network the RPLMN is the PLMN defined by the PLMN identity of the CN operator that has accepted the LR.\nRegistration: This is the process of camping on a cell of the PLMN and doing any necessary LRs.\nRegistration Area: A registration area is an area in which mobile stations may roam without a need to perform location registration. The registration area corresponds to location area (LA) for performing location updating procedure, to routing area for performing the GPRS attach or routing area update procedures, and to list of tracking areas (TAs) for performing the EPS attach or tracking area update procedure.\nThe PLMN to which a cell belongs (PLMN identity) is given in the system information transmitted on the BCCH (MCC + MNC part of LAI). In a shared network a cell belongs to all PLMNs given in the system information transmitted on the BCCH.\nSelected PLMN: This is the PLMN that has been selected according to subclause\u00a03.1, either manually or automatically.\nShared Network: An MS considers a cell to be part of a shared network, when multiple PLMN identities are received on the BCCH.  \nSIM: Subscriber Identity Module (see 3GPP\u00a0TS\u00a021.111\u00a0[38]). The present document makes no distinction between SIM and USIM.\nSoLSA exclusive access: Cells on which normal camping is allowed only for MS with Localised Service Area (LSA) subscription.\nSuitable Cell: This is a cell on which an MS may camp. It must satisfy criteria which are defined for GERAN A/Gb mode in 3GPP\u00a0TS\u00a043.022\u00a0[35], for UTRAN in 3GPP\u00a0TS\u00a025.304\u00a0[32] and for E-UTRAN in 3GPP\u00a0TS\u00a036.304\u00a0[43]. For 3GPP2 access technologies the criteria are defined in 3GPP2\u00a0C.S0011\u00a0[45] for cdma2000\u00ae 1xRTT and in 3GPP2\u00a0C.S0033\u00a0[46] for cdma2000\u00ae HRPD.\nSteering of Roaming: A technique whereby a roaming UE is encouraged to roam to a preferred roamed-to network by the HPLMN.\nVisited PLMN: This is a PLMN different from the HPLMN (if the EHPLMN list is not present or is empty) or different from an EHPLMN (if the EHPLMN list is present).\n***** Next change *****\n4.4.3.2.1\tAutomatic Network Selection Mode\nThe MS selects and attempts registration on PLMNs, if available and allowable, in all of its bands of operation in accordance with the following order:\ni)\tthe HPLMN (if the EHPLMN list is not present or is empty) or the highest priority EHPLMN that is available (if the EHPLMN list is present);\nii)\tPLMN/access technology combinations contained in the \"User Controlled PLMN Selector with Access Technology\" data file in the SIM (in priority order) excluding the previously selected PLMN/access technology combination;\niii)\tPLMN/access technology combinations contained in the \"Operator Controlled PLMN Selector with Access Technology\" data file in the SIM (in priority order) excluding the previously selected PLMN/access technology combination;\niv)\tother PLMN/access technology combinations with the received high quality signal in random order excluding the previously selected PLMN/access technology combination;\nv)\tother PLMN/access technology combinations, excluding the previously selected PLMN/access technology combination in order of decreasing signal quality or, alternatively, the previously selected PLMN/access technology combination may be chosen ignoring its signal quality;\nvi)\tThe previously selected PLMN/access technology combination.\nThe previously selected PLMN/access technology combination is the PLMN/access technology combination which the MS has selected prior to the start of the user reselection procedure.\nNOTE\u00a01:\t If the previously selected PLMN is chosen, and registration has not been attempted on any other PLMNs, then the MS is already registered on the PLMN, and so registration is not necessary.\nThe equivalent PLMNs list shall not be applied to the user reselection in Automatic Network Selection Mode.\nWhen following the above procedure the requirements a), b), c), e), f), g), h) in subclause 4.4.3.1.1 apply: Requirement d) shall apply as shown below:\nd)\tIn iv, v, and vi, the MS shall search for all access technologies it is capable of before deciding which PLMN/access technology combination to select.\nNOTE\u00a02:\tHigh quality signal is defined in the appropriate AS specification.\n***** That's all, folks! *****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nBackgroundAn MS, supporting S1 mode and A/Gb mode or Iu mode, that needs to perform PLMN selection for ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.334 shall not attempt to select a PLMN on the \"forbidden PLMNs for GPRS service\". In fact, in general, an MS selecting a PLMN on an access technology that only supports GPRS services shall not attempt to select a PLMN on the \"forbidden PLMNs for GPRS service\".ObservationA definition for \u201cavailable PLMN/access technology combination\u201d exists, but a separate definition for \"Allowable PLMN/access technology combination\" is missing even though the term in is used in 4.4.3.1.1:4.4.3.1.1Automatic Network Selection Mode ProcedureThe MS selects and attempts registration on other PLMN/access technology combinations, if available and allowable, in the following order:In the qouted text above, both \u201cavailable and allowable\u201d are not referring to the PLMN, but to the PLMN/access technology combination.In Rel-6, when this text was introduced (CR 23.122-069r5), it was correct to say that a PLMN/access technology combination is allowable when the respective PLMN is allowable. After the introduction of E-UTRAN, things have changed.\n\n>>> SUMMARY OF CHANGE\nThe definition of allowable PLMN is updated to apply also to MSs not supporting A/Gb mode and not supporting Iu mode. A separate definition is introduced for defining allowable PLMN/access technology combinations. An allowable PLMN/access technology combination is an allowable PLMN with an additional restriction. Where the allowable PLMN is listed in the \"forbidden PLMNs for GPRS service\", the PLMN/E-UTRA combination is not an allowable PLMN/access technology combination.\n\n>>> CONSEQUENCES IF NOT REVISED\nDefinition of 'allowable PLMN' is unclear.Definition of 'allowable PLMN/access technology combination' is missing. 'allowable PLMN/access technology combination' is used in \"Automatic Network Selection Mode Procedure\", but not in \"Automatic Network Selection Mode\". The mismatch may cause compliant implementations behaving in unanticipated ways.Inefficient network selection procedure wastes UE and network resources by not considering \"forbidden PLMNs for GPRS service\" when attempting to register via access technology only supporting GPRS services.A MS operating in MS operation mode C may select a PLMN that is in the \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\".Potential for conflicting requirements in subclause\u00a04.4.3.2.1 and in the \"PLMN selection triggered by ProSe direct communication\" procedure.An MS that needs to perform PLMN selection for ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.334 can attempt to select a PLMN on the \"forbidden PLMNs for GPRS service\" and subsequenlty receive a rejection. This preventable error delays access to ProSe direct communication."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***   First Change   ***\n4.6.2.4\tNetwork slice-specific authentication and authorization\nThe UE and network may support network slice-specific authentication and authorization.\nA serving PLMN shall perform network slice-specific authentication and authorization for the S-NSSAIs of the HPLMN which are subject to it based on subscription information. The UE shall indicate whether it supports network slice-specific authentication and authorization in the 5GMM Capability IE in the registration procedure.\nThe upper layer stores an association between each S-NSSAI and its corresponding credentials for the network slice-specific authentication and authorization.\nNOTE:\tThe credentials for network slice-specific authentication and authorization and how to provision them in the upper layer are out of the scope of 3GPP.\nThe network slice-specific authentication and authorization procedure shall not be performed unless:\na)\tthe primary authentication and key agreement procedure as specified in the subclause\u00a05.4.1 has successfully been completed; and\nb)\tthe initial registration procedure or the mobility and periodic registration update procedure has been completed.\nThe AMF informs the UE about S-NSSAIs subject to network slice-specific authentication and authorization in the pending NSSAI. The AMF handles allowed NSSAI, pending NSSAI, rejected NSSAI, service area list, and 5GS registration result in the REGISTRATION ACCEPT message according to subclauses\u00a05.5.1.2.4 and 5.5.1.3.4.\nTo perform network slice-specific authentication and authorization for an S-NSSAI, the AMF invokes an EAP- based network slice-specific authorization procedure for the S-NSSAI (see subclause\u00a05.4.7, 3GPP\u00a0TS\u00a033.501\u00a0[24] and 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nThe AMF updates the allowed NSSAI and the rejected NSSAI using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 after the network slice-specific authentication and authorization procedure has been performed.\nThe network slice-specific authentication and authorization procedure can be invoked or revoked by an AMF for a UE supporting network slice-specific authentication and authorization at any time. After the network performs the network slice-specific re-authentication and re-authorization procedure:\na)\tif network slice-specific authentication and authorization for some but not all S-NSSAIs in the allowed NSSAI fails; the AMF updates the allowed NSSAI and the rejected NSSAI accordingly using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4; or \nb)\tif network slice-specific authentication and authorization fails for all S-NSSAIs in the allowed NSSAI and the pending NSSAI, then AMF performs the network-initiated de-registration procedure and includes the rejected NSSAI in the DEREGISTRATION REQUEST message as specified in the subclause\u00a05.5.2.3 except when the UE has a PDU session for emergency services or the UE is establishing a PDU session for emergency services. In this case the AMF shall send CONFIGURATION UPDATE COMMAND containing rejected NSSAI. After the PDU session for the emergency service is released, the AMF performs the network-initiated de-registration procedure as specified in the subclause\u00a05.5.2.3.\n\nIf authorization is revoked for an S-NSSAI that is in the current allowed NSSAI for an access type, the AMF shall provide a new allowed NSSAI, excluding the S-NSSAI(s) for which the authorization is revoked, to the UE using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 and release all PDU sessions associated with the S-NSSAI for this access type.\nEditor's Note: How to secure that a UE does not wait indefinitely for completion of the network slice-specific authentication and authorization is FFS.\nEditor's Note: How the AMF rejects the S-NSSAI(s) for which the NSSAA has failed or has been revoked is FFS.\n***   Next Change   ***\n5.5.1.2.4\tInitial registration accepted by the network\nDuring a registration procedure with 5GS registration type IE set to \"emergency registration\", the AMF shall not check for mobility and access restrictions, regional restrictions or subscription restrictions, or perform CAG access control when processing the REGISTRATION REQUEST message.\nIf the initial registration request is accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe AMF shall assign and include a TAI list as a registration area the UE is registered to in the REGISTRATION ACCEPT message. The AMF shall not assign a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If the REGISTRATION REQUEST message was received over non-3GPP access, the AMF shall include only the N3GPP TAI in the TAI list.\nNOTE\u00a02:\tThe N3GPP TAI is operator-specific.\nNOTE\u00a03:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may include service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with the service area restrictions shall act as described in subclause\u00a05.3.5.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the initial registration procedure is not for emergency services, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the initial registration procedure is not for emergency services, and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\", any such PLMN identity shall be deleted from the corresponding list(s).\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nIf the REGISTRATION REQUEST message contains the LADN indication IE, based on the LADN indication IE, UE subscription information, UE location and local configuration about LADN and:\n-\tif the LADN indication IE includes requested LADN DNNs, the UE subscribed DNN list includes the requested LADN DNNs or the wildcard DNN, and the LADN service area of the requested LADN DNN has an intersection with the current registration area, the AMF shall determine the requested LADN DNNs included in the LADN indication IE as LADN DNNs for the UE;\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is included in the UE subscribed DNN list, the AMF shall determine the LADN DNN(s) configured in the AMF whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE; or\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is not included in the UE subscribed DNN list, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE.\nIf the LADN indication IE is not included in the REGISTRATION REQUEST message, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose service area has an intersection with the current registration area as LADN DNNs for the UE, except for the wildcard DNN included in the UE subscribed DNN list.\nThe AMF shall include the LADN information which consists of the determined LADN DNNs for the UE and LADN service area(s) available in the current registration area in the LADN information IE of the REGISTRATION ACCEPT message.\nThe UE, upon receiving the REGISTRATION ACCEPT message with the LADN information, shall store the received LADN information. If there exists one or more LADN DNNs which are included in the LADN indication IE of the REGISTRATION REQUEST message and are not included in the LADN information IE of the REGISTRATION ACCEPT message, the UE considers such LADN DNNs as not available in the current registration area.\nThe 5G-GUTI reallocation shall be part of the initial registration procedure. During the initial registration procedure, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI together with the assigned TAI list.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE or the Extended emergency number list IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. In this case, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message included an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer indication\" is indicated in the MICO indication IE in the REGISTRATION REQUEST, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE in the REGISTRATION ACCEPT message.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nThe AMF shall include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF shall include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent for the non-3GPP access.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nThe AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message if:\n-\tthe UE has indicated support for service gap control in the REGISTRATION REQUEST message; and\n-\ta service gap time value is available in the 5GMM context.\nIf there is a running T3447 timer in the AMF and the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the flag and proceed as if the flag was not received except for the following cases:\na)\tthe UE is configured for high priority access in the selected PLMN; or \nb)\tthe 5GS registration type IE in the REGISTRATION REQUEST message is set to \"emergency registration\".\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events, if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in the T3512 value IE as periodic registration update timer (T3512).\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active timer (T3324).\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contained a 5G-GUTI, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, stop timer T3519 if running, and delete any stored SUCI. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", or contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information.\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE or the Extended emergency number list IE or both, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions or the extended local emergency numbers list or both.\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\", and SMSF selection is successful, then the AMF shall send the REGISTRATION ACCEPT message after the SMSF has confirmed that the activation of the SMS service was successful. When sending the REGISTRATION ACCEPT message, the AMF shall:\na)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS allowed\" in the REGISTRATION ACCEPT message, if the UE has set the SMS requested bit of the 5GS registration type IE to \"SMS over NAS supported\" in the REGISTRATION REQUEST message and the network allows the use of SMS over NAS for the UE; and\nb)\tstore the SMSF address and the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context, and consider the UE available for SMS over NAS.\nIf:\na)\tthe SMSF selection in the AMF is not successful; \nb)\tthe SMS activation via the SMSF is not successful; \nc)\tthe AMF does not allow the use of SMS over NAS; \nd)\tthe SMS requested bit of the 5GS update type IE was set to \"SMS over NAS not supported\" in the REGISTRATION REQUEST message; or\ne)\tthe 5GS update type IE was not included in the REGISTRATION REQUEST message;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result IE value indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access only; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access;\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access only; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and Non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nThe AMF shall include the allowed NSSAI for the current PLMN and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI from the UE if available, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs in the requested NSSAI.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message. Rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s).\nIf the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tif the Requested NSSAI IE only includes the S-NSSAIs: \n1)\twhich are subject to network slice-specific authentication and authorization; and\n2)\tfor which the network slice-specific authentication and authorization procedure has not been initiated;\nthe AMF shall in the REGISTRATION ACCEPT message include: \n1)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate whether network slice-specific authentication and authorization procedure will be performed by the network; \n2)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed; and\n3)\tthe current registration area in the list of \"non-allowed tracking areas\" in the Service area list IE; \nor\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAIs or the mapped S-NSSAIs which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\n2)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed, if any\n.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are present in the subscribed S-NSSAIs; and \nb)\tall of the S-NSSAIs in the subscribed S-NSSAIs are subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include: \na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate whether network slice-specific authentication and authorization procedure will be performed by the network;\nb)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed; and\nc)\tthe current registration area in the list of \"non-allowed tracking areas\" in the Service area list IE\n. \nEditor\u2019s Note: How to secure that a UE does not wait indefinitely for completion of the network slice-specific authentication and authorization is FFS.\nThe AMF may include a new configured NSSAI for the current PLMN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include the requested NSSAI;\nb)\tthe REGISTRATION REQUEST message included the requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN;\nc)\tthe REGISTRATION REQUEST message included the requested NSSAI containing S-NSSAI(s) with incorrect mapped S-NSSAI(s); or\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\".\nIf a new configured NSSAI for the current PLMN is included in the REGISTRATION ACCEPT message, the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT message. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe UE receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected NSSAI:\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN as specified in subclause\u00a04.6.2.2 and not attempt to use this S-NSSAI in the current PLMN until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2. \n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and not attempt to use this S-NSSAI in the current registration area until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\nIf the UE set the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAIs subject to network slice-specific authentication and authorization and one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the subscribed S-NSSAIs marked as default S-NSSAI(s); and\n2)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN\"; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN\"; and \nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nIf the UE does not indicate support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message;\nb)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are present in the subscribed S-NSSAIs; or\nc)\tall of the S-NSSAIs included in the requested NSSAI in the REGISTRATION REQUEST message are considered to be rejected by the network;\nand one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default are available, the AMF shall put the subscribed S-NSSAIs marked as default S-NSSAIs in the allowed NSSAI of the REGISTRATION ACCEPT message. The AMF shall determine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN and the registration area as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting interworking with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 interface not supported\" if the AMF supports N26 interface ; or\nb)\t\"interworking without N26 interface supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a04:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the received interworking without N26 interface indicator for interworking with EPS as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services or emergency services fallback, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. In a UE with LCS capability, location services indicator (5G-LCS) shall be provided to the upper layers. When initiating an emergency call, the upper layers also take the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator into account for the access domain selection.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a05:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based on operator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a06:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nIf the UE is not operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 1 is only applicable while the UE is in N1 mode.\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; and\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode.\nIf the UE is operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects another SNPN. Access identity 1 is only applicable while the UE is in N1 mode.\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; and\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects another SNPN. Access identity 2 is only applicable while the UE is in N1 mode.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, and the user's subscription context obtained from the UDM if available.\nIf:\na)\tthe UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, the SOR transparent container IE is not included in the REGISTRATION ACCEPT message or the SOR transparent container IE does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C, then the UE may locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message.\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates list of preferred PLMN/access technology combinations is provided and the list type indicates:\na)\t\"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nb)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, in the current registration area; or\nb)\totherwise if:\n1)\tthe UE has NSSAI inclusion mode for the current PLMN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode; or\n2)\tthe UE does not have NSSAI inclusion mode for the current PLMN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\nii)\tnon-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0C in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN stored at the UE, then the UE shall, after the completion of the ongoing registration procedure, initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE configuration, the UE shall include the manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\n***   Next Change   ***\n5.5.1.3.2\tMobility and periodic registration update initiation\nThe UE in state 5GMM-REGISTERED shall initiate the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message to the AMF,\na)\twhen the UE detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the AMF;\nb)\twhen the periodic registration updating timer T3512 expires in 5GMM-IDLE mode;\nc)\twhen the UE receives a CONFIGURATION UPDATE COMMAND message indicating \"registration requested\" in the Registration requested bit of the Configuration update indication IE as specified in subclauses\u00a05.4.4.3;\nd)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE either receives a paging or the UE receives a NOTIFICATION message with access type indicating 3GPP access over the non-3GPP access for PDU sessions associated with 3GPP access;\ne)\tupon inter-system change from S1 mode to N1 mode and if the UE previously had initiated an attach procedure or a tracking area updating procedure when in S1 mode;\nf)\twhen the UE receives an indication of \"RRC Connection failure\" from the lower layers and does not have signalling pending (i.e. when the lower layer requests NAS signalling connection recovery) except for the case specified in subclause\u00a05.3.1.4;\ng)\twhen the UE changes the 5GMM capability or the S1 UE network capability or both;\nh)\twhen the UE's usage setting changes;\ni)\twhen the UE needs to change the slice(s) it is currently registered to;\nj)\twhen the UE changes the UE specific DRX parameters;\nk)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE receives a request from the upper layers to establish an emergency PDU session or perform emergency services fallback;\nl)\twhen the UE needs to register for SMS over NAS, indicate a change in the requirements to use SMS over NAS, or de-register from SMS over NAS;\nm)\twhen the UE needs to indicate PDU session status to the network after performing a local release of PDU session(s) as specified in subclauses\u00a06.4.1.5 and 6.4.3.5;\nn)\twhen the UE in 5GMM-IDLE mode changes the radio capability for NG-RAN;\no)\twhen the UE receives a fallback indication from the lower layers and does not have signalling pending (i.e. when the lower layer requests NAS signalling connection recovery, see subclauses\u00a05.3.1.4 and\u00a05.3.1.2);\np)\tvoid;\nq)\twhen the UE needs to request new LADN information;\nr)\twhen the UE needs to request the use of MICO mode or needs to stop the use of MICO mode or to request the use of new T3324 value;\ns)\twhen the UE in 5GMM-CONNECTED mode with RRC inactive indication enters a cell in the current registration area belonging to an equivalent PLMN of the registered PLMN and not belonging to the registered PLMN;\nt)\twhen the UE receives over 3GPP access a SERVICE REJECT message or a DL NAS TRANSPORT message, with the 5GMM cause value set to #28 \"Restricted service area\";\nu)\twhen the UE needs to request the use of eDRX, when a change in the eDRX usage conditions at the UE requires different extended DRX parameters, or needs to stop the use of eDRX;\nNOTE\u00a01:\tA change in the eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.\nv)\twhen the UE supporting 5G-SRVCC from NG-RAN to UTRAN changes the mobile station classmark 2 or the supported codecs;\nw)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE decides to request new network slices after being rejected due to no allowed network slices requested;\nx)\twhen the UE is not in NB-N1 mode and the applicable UE radio capability ID for the current UE radio configuration changes due to a reselection to a new PLMN or SNPN, or a revocation of the network-assigned UE radio capability IDs by the serving PLMN or SNPN;\ny)\twhen the UE receives a REGISTRATION REJECT message with 5GMM cause values #3, #6 or #7 without integrity protection over another access; or\nz)\twhen the UE needs to request new ciphering keys for ciphered broadcast assistance data.\nIf case b) is the only reason for initiating the registration procedure for mobility and periodic registration update, the UE shall indicate \"periodic registration updating\" in the 5GS registration type IE; otherwise the UE shall indicate \"mobility registration updating\".\nIf the UE indicates \"mobility registration updating\" in the 5GS registration type IE and the UE supports S1 mode, the UE shall:\n-\tset the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message;\n-\tinclude the S1 UE network capability IE in the REGISTRATION REQUEST message; and\n-\tif the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer a PDU session from N1 mode to S1 mode, set the HO attach bit to \"attach request message containing PDN connectivity request with request type set to handover to transfer PDU session from N1 mode to S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the LTE positioning protocol (LPP) in N1 mode as specified in 3GPP\u00a0TS\u00a036.355\u00a0[26], the UE shall set the LPP bit to \"LPP in N1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the Location Services (LCS) notification mechanisms in N1 mode as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B], the UE shall set the 5G-LCS bit to \" LCS notification mechanisms supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b), when the UE is not in NB-N1 mode and the UE supports RACS, the UE shall set the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP\u00a0TS\u00a023.216\u00a0[6A], the UE shall set:\n-\tthe 5G-SRVCC from NG-RAN to UTRAN capability bit to \"5G-SRVCC from NG-RAN to UTRAN supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case\u00a0b; and\n-\tinclude the Mobile station classmark 2 IE and the Supported codecs IE in the REGISTRATION REQUEST message for all cases except case\u00a0b.\nIf the UE supports the restriction on use of enhanced coverage, the UE shall set the RestrictEC bit to \"Restriction on use of enhanced coverage supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice-specific authentication and authorization, the UE shall set the NSSAA bit to \"network slice-specific authentication and authorization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case\u00a0b.\nIf the UE supports CAG feature, the UE shall set the CAG bit to \"CAG Supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode and has one or more stored UE policy sections identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, the UE shall set the Payload container type IE to \"UE policy container\" and include the UE STATE INDICATION message (see annex\u00a0D) in the Payload container IE of the REGISTRATION REQUEST message.\nNOTE\u00a02:\tIn this version of the protocol, the UE can only include the Payload container IE in the REGISTRATION REQUEST message to carry a payload of type \"UE policy container\".\nThe UE in state 5GMM-REGISTERED shall initiate the registration procedure for mobility and periodic update by sending a REGISTRATION REQUEST message to the AMF when the UE needs to request the use of SMS over NAS transport or the current requirements to use SMS over NAS transport change in the UE. The UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message as specified in subclause\u00a05.5.1.2.2.\nWhen initiating a registration procedure for mobility and periodic registration update and the UE needs to send the 5GS update type IE for a reason different than indicating a change in requirement to use SMS over NAS, the UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message to the same value as indicated by the UE in the last REGISTRATION REQUEST message.\nIf the UE no longer requires the use of SMS over NAS, then the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS not supported\".\nAfter sending the REGISTRATION REQUEST message to the AMF the UE shall start timer T3510. If timer T3502 is currently running, the UE shall stop timer T3502. If timer T3511 is currently running, the UE shall stop timer T3511.\nIf the last visited registered TAI is available, the UE shall include the last visited registered TAI in the REGISTRATION REQUEST message.\nThe UE shall handle the 5GS mobile identity IE in the REGISTRATION REQUEST message as follows:\na)\tif the UE is operating in the single-registration mode, performs inter-system change from S1 mode to N1 mode, and the UE holds a valid 4G-GUTI, the UE shall include the 5G-GUTI mapped from the 4G-GUTI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4] in the 5GS mobile identity IE. Additionally, if the UE holds a valid 5GGUTI, the UE shall include the 5G-GUTI in the Additional GUTI IE in the REGISTRATION REQUEST message in the following order:\n1)\ta valid 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration, if available;\n2)\ta valid 5G-GUTI that was previously assigned by an equivalent PLMN, if available; and\n3)\ta valid 5G-GUTI that was previously assigned by any other PLMN, if available; and\nb)\tfor all other cases, if the UE holds a valid 5G-GUTI, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE.\nIf the UE supports MICO mode and requests the use of MICO mode, then the UE shall include the MICO indication IE in the REGISTRATION REQUEST message. If the UE requests to use an active time value, it shall include the active time value in the T3324 IE in the REGISTRATION REQUEST message.  Additionally, if the UE supports strictly periodic registration timer, the UE shall set the Strictly Periodic Registration Timer Indication bit of the MICO indication IE in the REGISTRATION REQUEST message to \"strictly periodic registration timer supported\". If the UE needs to stop the use of MICO mode, then the UE shall not include the MICO indication IE in the REGISTRATION REQUEST message.\nIf the UE needs to change the UE specific DRX parameters, the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message.\nEditor's note:\tWhether different UE specific DRX parameters are used for NB-N1 mode and how to request them is FFS.\nIf the UE supports eDRX and requests the use of eDRX, the UE shall include the Requested extended DRX parameters IE in the REGISTRATION REQUEST message.\nIf the UE needs to request LADN information for specific LADN DNN(s) or indicates a request for LADN information as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall include the LADN indication IE in the REGISTRATION REQUEST message and:\n-\trequest specific LADN DNNs by including a LADN DNN value in the LADN indication IE for each LADN DNN for which the UE requests LADN information; or\n-\tto indicate a request for LADN information by not including any LADN DNN value in the LADN indication IE.\nIf the UE is initiating the registration procedure for mobility and periodic registration update, the UE may include the Uplink data status IE to indicate which PDU session(s) that is:\n-\tnot associated with control plane only indication;\n-\tassociated with the access type the REGISTRATION REQUEST message is sent over; and\n-\thave pending user data to be sent over user plane.\nIf the UE has one or more active always-on PDU sessions associated with the access type over which the REGISTRATION REQUEST message is sent and the user-plane resources for these PDU sessions are not established, the UE shall include the Uplink data status IE and indicate that the UE has pending user data to be sent for those PDU sessions. If the UE is located outside the LADN service area, the UE shall not include the PDU session for LADN in the Uplink data status IE. If the UE is in a non-allowed area or is not in an allowed area as specified in subclause\u00a05.3.5, the UE shall not include the Uplink data status IE except for emergency services or for high priority access.\nIf the UE has one or more active PDU sessions which are not accepted by the network as always-on PDU sessions and no uplink user data pending to be sent for those PDU sessions, the UE shall not include those PDU sessions in the Uplink data status IE in the REGISTRATION REQUEST message.\nWhen the registration procedure for mobility and periodic registration update is initiated in 5GMM-IDLE mode, the UE may include a PDU session status IE in the REGISTRATION REQUEST message, indicating which PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over are active in the UE.\nIf the UE received a paging message with the access type indicating non-3GPP access, the UE shall include the Allowed PDU session status IE in the REGISTRATION REQUEST message indicating the PDU session(s) for which the UE allows to re-establish the user-plane resources over 3GPP access.\nWhen the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, the UE shall indicate that a PDU session is not allowed to be transferred to the 3GPP access if the 3GPP PS data off UE status is \"activated\" for the corresponding PDU session and the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause\u00a06.2.10).\nIf the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, the UE:\na)\tshall include the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message;\nNOTE\u00a03:\tInclusion of the UE status IE with this setting corresponds to the indication that the UE is \"moving from EPC\" as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], subclause\u00a04.11.1.3.3 and 4.11.2.3.\nb)\tmay include the PDU session status IE in the REGISTRATION REQUEST message indicating the status of the PDU session(s) mapped during the inter-system change from S1 mode to N1 mode from the PDN connection(s) for which the EPS indicated that interworking to 5GS is supported, if any (see subclause\u00a06.1.4.1);\nc)\tshall include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] in the EPS NAS message container IE in the REGISTRATION REQUEST message; and\nd)\tshall include an EPS bearer context status IE in the REGISTRATION REQUEST message indicating which EPS bearer contexts are active in the UE, if the UE has locally deactivated EPS bearer context(s) for which interworking to 5GS is supported while the UE was in S1 mode without notifying the network.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE:\na)\tis in NB-N1 mode and:\n1)\tthe UE needs to change the slice(s) it is currently registered to within the same registration area; or\n2)\tthe UE has entered a new registration area; or\nb)\tthe UE is not in NB-N1 mode;\nthe UE shall include the Requested NSSAI IE containing the S-NSSAI(s) corresponding to the network slices to which the UE intends to register and associated mapped S-NSSAI(s), if available, in the REGISTRATION REQUEST message as described in this subclause. When the UE is entering a visited PLMN and intends to register to the slices for which the UE has only mapped S-NSSAI(s) available, the UE shall include these S-NSSAI(s) in the Requested mapped NSSAI IE.\nNOTE\u00a04:\tThe REGISTRATION REQUEST message can include both the Requested NSSAI and the Requested mapped NSSAI as described below.\nIf the UE has allowed NSSAI or configured NSSAI for the current PLMN, the Requested NSSAI IE shall include either:\na)\tthe configured NSSAI for the current PLMN, or a subset thereof as described below, if the UE has no allowed NSSAI for the current PLMN;\nb)\tthe allowed NSSAI for the current PLMN, or a subset thereof as described below, if the UE has an allowed NSSAI for the current PLMN; or\nc)\tthe allowed NSSAI for the current PLMN, or a subset thereof as described below, plus one or more S-NSSAIs from the configured NSSAI for which no corresponding S-NSSAI is present in the allowed NSSAI and those are neither in the rejected NSSAI for the current PLMN nor in the rejected NSSAI for the current registration area.\nand in addition the Requested NSSAI IE shall include S-NSSAI(s) applicable in the current PLMN, and if available the associated mapped S-NSSAI(s) for:\na)\teach PDN connection that is established in S1 mode when the UE is operating in the single-registration mode and the UE is performing an inter-system change from S1 mode to N1 mode; or\nb)\teach active PDU session.\nThe Requested mapped NSSAI IE shall include mapped S-NSSAI(s), if available, when the UE does not have S-NSSAI(s) applicable in the current PLMN for:\na)\teach PDN connection established in S1 mode when the UE is operating in the single-registration mode and the UE is performing an inter-system change from S1 mode to N1 mode to a visited PLMN; or\nb)\teach active PDU session when the UE is performing mobility from N1 mode to N1 mode to a visited PLMN.\nNOTE\u00a05:\tThe Requested NSSAI IE is used instead of Requested mapped NSSAI IE in REGISTRATION REQUEST message when the UE enters (E)HPLMN.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE is in NB-N1 mode and the procedure is initiated for all cases except case a), c), e), i), s), t), w), and x), the REGISTRATION REQUEST message shall not include the Requested NSSAI IE.\nIf the UE has:\n-\tno allowed NSSAI for the current PLMN;\n-\tconfigured NSSAI for the current PLMN;\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN; and\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s);\nand has a default configured NSSAI, then the UE shall:\na)\tinclude the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION REQUEST message using the default configured NSSAI; and\nb)\tinclude the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\" in the REGISTRATION REQUEST message.\nIf the UE has:\n-\tno allowed NSSAI for the current PLMN;\n-\tno configured NSSAI for the current PLMN;\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s); and\n-\tno default configured NSSAI\nthe UE shall include neither Requested NSSAI IE nor Requested mapped NSSAI IE  in the REGISTRATION REQUEST message.\nThe subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to this PLMN, if the S-NSSAI is neither in the rejected NSSAIs for the current PLMN nor in the rejected NSSAI for the current registration area.\nThe subset of allowed NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the allowed NSSAI for this PLMN.\nNOTE\u00a06:\tHow the UE selects the subset of configured NSSAI or allowed NSSAI to be provided in the requested NSSAI is implementation specific. The UE can take preferences indicated by the upper layers (e.g. policies, applications) into account.\nNOTE\u00a07:\tThe number of S-NSSAI(s) included in the requested NSSAI cannot exceed eight.\nThe UE shall set the Follow-on request indicator to \"Follow-on request pending\", if the UE:\na)\tinitiates the mobility and periodic registration updating procedure upon request of the upper layers to establish an emergency PDU session;\nb)\tinitiates the mobility and periodic registration updating procedure upon receiving a request from the upper layers to perform emergency service fallback; or\nc)\tneeds to prolong the established NAS signalling connection after the completion of the registration procedure for mobility and periodic registration update (e.g. due to uplink signalling pending but no user data pending).\nNOTE\u00a08:\tThe UE does not have to set the Follow-on request indicator to 1 even if the UE has to request resources for V2X communication over PC5 reference point.\nFor case n), the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"NG-RAN radio capability update needed\". Additionally, if the UE is not in NB-N1 mode, the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the serving PLMN or SNPN, the UE shall include the applicable UE radio capability ID in the UE radio capability ID of the REGISTRATION REQUEST message.\nIf the UE is in the 5GMM-CONNECTED mode and the UE changes the radio capability for NG-RAN, the UE may locally release the established N1 NAS signalling connection and enter the 5GMM-IDLE mode. Then, the UE shall initiate the registration procedure for mobility and periodic updating including the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"NG-RAN radio capability update needed\".\nFor case o), the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) without active user-plane resources for which the UE has pending user data to be sent, if any, and the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any. If the UE is in a non-allowed area or if the UE is not in allowed area, the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, except if the PDU session for which user-plane resources were active prior to receiving the fallback indication is an emergency PDU session, or if the UE is configured for high priority access in the selected PLMN as specified in subclause\u00a05.3.5.\nFor case f), the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving \"RRC Connection failure\" indication from the lower layers, if any. If the UE is in non-allowed area or not in allowed area, the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, except that the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication is emergency PDU session(s), or that the UE is configured for high priority access in selected PLMN, as specified in subclause\u00a05.3.5.\nIf the UE supports service gap control, then the UE shall set the SGC bit to \"service gap control supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor case x) or if the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, the UE shall:\na)\tif the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\nb)\tif the UE:\n1)\tdoes not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN; and\n2)\thas an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,\n\tinclude the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message.\nFor all cases except cases b and z, if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case z, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case a, if the UE supports ciphered broadcast assistance data and the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case b, if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3512, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nIf the UE does not have a valid 5G NAS security context and the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. The UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-cleartext IEs, if any) in the NAS message container IE that is sent as part of the SECURITY MODE COMPLETE message as described in subclauses\u00a04.4.6 and\u00a05.4.2.3.\nIf the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2X bit to \"V2X supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X communication over E-UTRA-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X communication over NR-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nThe UE shall send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6:\na)\twhen the UE is sending the message from 5GMM-IDLE mode, the UE has a valid 5G NAS security context, and needs to send non-cleartext IEs; and\nb)\twhen the UE is sending the message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode and the UE has a valid 5G NAS security context and needs to send non-cleartext IEs.\nThe UE with a valid 5G NAS security context shall send the REGISTRATION REQUEST message without including the NAS message container IE when the UE does not need to send non-cleartext IEs and the UE is sending the message:\na)\tfrom 5GMM-IDLE mode; and\nb)\tafter an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode.\nIf the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode and the UE needs to send non-cleartext IEs, the UE shall cipher the NAS message container IE using the mapped 5G NAS security context and send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6. If the UE does not need to send non-cleartext IEs, the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE.\nIf the REGISTRATION REQUEST message includes a NAS message container IE, the AMF shall process the REGISTRATION REQUEST message that is obtained from the NAS message container IE as described in subclause\u00a04.4.6.\nIf the UE is in NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to \"Control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE is capable of NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to \"Control plane CIoT EPS optimization supported\" in the S1 UE network capability IE of the REGISTRATION REQUEST message.\n\nFigure\u00a05.5.1.3.2.1: Registration procedure for mobility and periodic registration update\n***   Next Change   ***\n5.5.1.3.4\tMobility and periodic registration update accepted by the network\nIf the registration update request has been accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nIf timer T3513 is running in the AMF, the AMF shall stop timer T3513 if a paging request was sent with the access type indicating non-3GPP and the REGISTRATION REQUEST message includes the Allowed PDU session status IE.\nIf timer T3565 is running in the AMF, the AMF shall stop timer T3565 when a REGISTRATION REQUEST message is received.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe 5G-GUTI reallocation shall be part of the registration procedure for mobility registration update. The 5G-GUTI reallocation should be part of the registration procedure for periodic registration update. During the registration procedure for mobility registration update, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE or the Extended emergency number list IE is included in the REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. In this case, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF may include a new TAI list for the UE in the REGISTRATION ACCEPT message. The new TAI list shall not contain both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If there is no TAI list received, the UE shall consider the old TAI list as valid.\nNOTE\u00a02:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no emergency PDU session established, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\". If the UE is not registered for emergency services and there is an emergency PDU session established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the \"forbidden PLMNs list\" when the emergency PDU session is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the UE is not registered for emergency services, and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\", any such PLMN identity shall be deleted from the corresponding list(s).\nThe AMF may include new service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with new service area restrictions shall act as described in subclause\u00a05.3.5.\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message includes an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer supported\" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE and may include the T3512 value IE in the REGISTRATION ACCEPT message. If the timer value received in T3512 IE is different from the already stored value of the timer T3512 and the timer T3512 is running, the UE shall restart T3512 with the new value received in the T3512 value IE.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nIf the UE does not include MICO indication IE in the REGISTRATION REQUEST message, then the AMF shall disable MICO mode if it was already enabled.\nThe AMF may include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF may include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent for the non-3GPP access.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nFor inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has included a ngKSI indicating a current 5G NAS security context in the REGISTRATION REQUEST message by which the REGISTRATION REQUEST message is integrity protected, the AMF shall take one of the following actions:\na)\tif the AMF retrieves the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall integrity check the REGISTRATION REQUEST message using the current 5G NAS security context and integrity protect the REGISTRATION ACCEPT message using the current 5G NAS security context;\nb)\tif the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall treat the REGISTRATION REQUEST message fails the integrity check and take actions as specified in subclause\u00a04.4.4.3; or\nc)\tif the UE has not included an Additional GUTI IE, the AMF may treat the REGISTRATION REQUEST message as in the previous item, i.e. as if it cannot retrieve the current 5G NAS security context.\nNOTE\u00a03:\tThe handling described above at failure to retrieve the current 5G NAS security context or if no Additional GUTI IE was provided does not preclude the option for the AMF to perform a primary authentication and key agreement procedure and create a new native 5G NAS security context.\nEditor's note:\tThe integrity check at the AMF for inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode is FFS.\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter and service request attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\", if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in T3512 value IE as periodic registration update timer (T3512). If the T3512 value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active time timer (T3324). If the REGISTRATION ACCEPT message does not include a T3324 value IE, UE shall not start the timer T3324 until a new value is received from the network.\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer. If non-3GPP de-registration timer value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message. If non-3GPP de-registration timer value IE is not included and there is no stored non-3GPP de-registration timer value in the UE, the UE shall use the default value of the non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contains a 5G-GUTI, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, stop timer T3519 if running, and delete any stored SUCI. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", or contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information.\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE or the Extended emergency number list IE or both, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions or the extended local emergency numbers list or both.\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the UE in 5GMM-IDLE mode initiated the registration procedure for mobility and periodic registration update and the REGISTRATION ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT message, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\" and:\na)\tthe SMSF address is stored in the UE 5GMM context and:\n1)\tthe UE is considered available for SMS over NAS; or\n2)\tthe UE is considered not available for SMS over NAS and the SMSF has confirmed that the activation of the SMS service is successful; or\nb)\tthe SMSF address is not stored in the UE 5GMM context, the SMSF selection is successful and the SMSF has confirmed that the activation of the SMS service is successful;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclause\u00a05.5.1.2.4. If the UE 5GMM context does not contain an SMSF address or the UE is not considered available for SMS over NAS, then the AMF shall:\na)\tstore the SMSF address in the UE 5GMM context if not stored already; and\nb)\tstore the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context and consider the UE available for SMS over NAS.\nIf SMSF selection in the AMF or SMS activation via the SMSF is not successful, or the AMF does not allow the use of SMS over NAS, then the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS not supported\" or the 5GS update type IE was not included in the REGISTRATION REQUEST message, then the AMF shall:\na)\tmark the 5GMM context to indicate that the UE is not available for SMS over NAS; and\nNOTE\u00a04:\tThe AMF can notify the SMSF that the UE is deregistered from SMS over NAS based on local configuration.\nb)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"NG-RAN radio capability update needed\", the AMF shall delete any stored UE radio capability information for NG-RAN.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result IE value indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access only; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access;\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access only; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and Non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nIf the UE is not currently registered for emergency services and the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to \"Registered for emergency services\", the UE shall consider itself registered for emergency services and shall release locally PDU session(s) not associated with emergency services, if any.\nThe AMF shall include the allowed NSSAI for the current PLMN and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) from the UE if available, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs for the current PLMN in the Requested NSSAI IE or one or more mapped S-NSSAIs in the Requested NSSAI IE or Requested mapped NSSAI IE. The S-NSSAI associated with each of the active PDN connections for which interworking to 5GS is supported, shall be included in the allowed NSSAI if the UE included the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message and the AMF supports N26 interface.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message. Rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s).\nIf the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tif the Requested NSSAI IE only includes the S-NSSAIs:\n1)\twhich are subject to network slice-specific authentication and authorization; and\n2)\tfor which the network slice-specific authentication and authorization procedure has not been initiated; \nthe AMF shall in the REGISTRATION ACCEPT message include: \n1)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate whether network slice-specific authentication and authorization procedure will be performed by the network; \n2)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed; and\n3)\tthe current registration area in the list of \"non-allowed tracking areas\" in the Service area list IE; \nor\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAIs or the mapped S-NSSAIs which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\n2)\tpending  NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed, if any\n.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are present in the subscribed S-NSSAIs; and \nb)\tall of the S-NSSAIs in the subscribed S-NSSAIs are subject to network slice-specific authentication and authorization;\nthe AMF shall in the REGISTRATION ACCEPT message include: \na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate whether network slice-specific authentication and authorization procedure will be performed by the network;\nb)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization will be performed; and\nc)\tthe current registration area in the list of \"non-allowed tracking areas\" in the Service area list IE\n. \nEditor\u2019s note:\tHow to secure that a UE does not wait indefinitely for completion of the network slice-specific authentication and authorization is FFS.\nThe AMF may include a new configured NSSAI for the current PLMN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include a requested NSSAI;\nb)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN;\nc)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI with incorrect mapping information to an S-NSSAI of the HPLMN;\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\"; or\ne)\tthe REGISTRATION REQUEST message included the requested mapped NSSAI.\nIf a new configured NSSAI for the current PLMN is included, the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT message. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the S-NSSAI(s) associated with the existing PDU session(s) of the UE is not included in the requested NSSAI of the REGISTRATION REQUEST message, the AMF shall perform a local release of the PDU session(s) associated with the S-NSSAI(s) and shall request the SMF to perform a local release of those PDU session(s).\nThe UE receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected NSSAI:\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN as specified in subclause\u00a04.6.2.2 and not attempt to use this S-NSSAI in the current PLMN until switching off the UE,the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and not attempt to use this S-NSSAI in the current registration area until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause\u00a04.6.2.2.\nIf the UE set the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAIs subject to network slice-specific authentication and authorization and one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) marked as default are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the subscribed S-NSSAIs marked as default S-NSSAI(s); and\n2)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN\"; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN\"; and \nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE does not indicate support for network slice-specific authentication and authorization, and:\na)\tthe UE is not in NB-N1 mode; and\nb)\tif:\n1)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message;\n2)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are present in the subscribed S-NSSAIs; or\n3)\tall the S-NSSAIs included in the requested NSSAI in the REGISTRATION REQUEST message are considered to be rejected by the network;\nand one or more subscribed S-NSSAIs marked as default are available, the AMF shall put the subscribed S-NSSAIs marked as default S-NSSAIs in the allowed NSSAI of the REGISTRATION ACCEPT message. The AMF shall determine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"periodic registration updating\"; or\nb)\t\"mobility registration updating\" and the UE is in NB-N1 mode;\nthe AMF may provide a new allowed NSSAI to the UE in the REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN and the registration area as specified in subclause\u00a04.6.2.2.\nWith respect to each of the PDU session(s) active in the UE, if the allowed NSSAI contains neither:\na)\tan S-NSSAI matching to the S-NSSAI of the PDU session; nor\nb)\ta mapped S-NSSAI matching to the mapped S-NSSAI of the PDU session;\nthe UE shall perform a local release of all such PDU sessions except for the persistent PDU session(s).\nFor each of the PDU session(s) active in the UE, if the allowed NSSAI contains a mapped S-NSSAI matching to the mapped S-NSSAI of the PDU session, the UE shall locally update the S-NSSAI associated with the PDU session to the corresponding S-NSSAI received in the allowed NSSAI.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"periodic registration updating\"; or\nb)\t\"mobility registration updating\" and the UE is in NB-N1 mode;\nif the REGISTRATION ACCEPT message does not contain an allowed NSSAI, the UE considers the previously received allowed NSSAI as valid.\nIf the Uplink data status IE is included in the REGISTRATION REQUEST message:\na)\tif the AMF determines that the UE is in non-allowed area or is not in allowed area, and the PDU session(s) indicated by the Uplink data status IE is non-emergency PDU session(s) or the UE is not configured for high priority access in selected PLMN, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session(s) cannot be re-established, and shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\";\nb)\totherwise, the AMF shall:\n1)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU session;\n2)\tinclude PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; and\n3)\tdetermine the UE presence in LADN service area and forward the UE presence in LADN service area towards the SMF, if the corresponding PDU session is a PDU session for LADN.\nIf the Uplink data status IE is not included in the REGISTRATION REQUEST message and the REGISTRATION REQUEST message is sent for the trigger d) in subclause\u00a05.5.1.3.2, the AMF may indicate the SMF to re-establish the user-plane resources for the PDU sessions.\nIf a PDU session status IE is included in the REGISTRATION REQUEST message, the AMF shall:\na)\tperform a local release of all those PDU session which are in 5GSM state PDU SESSION ACTIVE on the AMF side associated with the access type the REGISTRATION REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE; and\nb)\tinclude a PDU session status IE in the REGISTRATION ACCEPT message to indicate which PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over are active in the AMF.\nIf the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, the AMF shall:\na)\tfor a 5GSM message from each SMF that has indicated pending downlink signalling only, forward the received 5GSM message via 3GPP access to the UE after the REGISTRATION ACCEPT message is sent;\nb)\tfor each SMF that has indicated pending downlink data only:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; and\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE.\nc)\tfor each SMF that have indicated pending downlink signalling and data:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE;\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; and\n3)\tdiscard the received 5GSM message for PDU session(s) associated with non-3GPP access; and\nd)\tinclude the PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any.\nIf the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was requested by the UE in the Allowed PDU session status IE, the UE considers the corresponding PDU session to be associated with the 3GPP access. If the user-plane resources of a PDU session have been successfully reactivated over the 3GPP access, the AMF and SMF update the associated access type of the corresponding PDU session.\nIf the AMF has included the PDU session reactivation result IE in the REGISTRATION ACCEPT message and there exist one or more PDU sessions for which the user-plane resources cannot be re-established, then the AMF may include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources.\nIf an EPS bearer context status IE is included in the REGISTRATION REQUEST message, the AMF handles the received EPS bearer context status IE as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the EPS bearer context status information is generated for the UE during the inter-system change from S1 mode to N1 mode as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] and the AMF supports N26 interface, the AMF shall include an EPS bearer context status IE in the REGISTRATION ACCEPT message to indicate the UE which mapped EPS bearer contexts are active in the network.\nIf the user-plane resources cannot be established for a PDU session, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and shall include the PDU session reactivation result error cause IE with the 5GMM cause set to:\na)\t#43 \"LADN not available\" if the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]);\nb)\t#28 \"restricted service area\" if the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]); or\nc)\t#92 \"insufficient user-plane resources for the PDU session\" if the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]).\nNOTE\u00a05:\tIt is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\".\nIf the AMF needs to initiate PDU session status synchronization the AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate the UE which PDU sessions are active in the AMF.\nThe AMF may include the LADN information IE in the REGISTRATION ACCEPT message as described in subclause\u00a05.5.1.2.4. The UE, upon receiving the REGISTRATION ACCEPT message with the LADN information IE, shall delete its old LADN information (if any) and store the received new LADN information.\nIf the AMF does not include the LADN information IE in the REGISTATION ACCEPT message during registration procedure for mobility and registration update, the UE shall delete its old LADN information.\nIf the PDU session status IE is included in the REGISTRATION ACCEPT message, the UE shall perform a local release of all those PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over which are in 5GSM state PDU SESSION ACTIVE on the UE side, but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE.\nIf: \na)\tthe UE included a PDU session status IE in the REGISTRATION REQUEST message;\nb)\tthe UE is operating in the single-registration mode; \nc)\tthe UE is performing inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode; and\nd)\tthe UE has received the IWK N26 bit set to \"interworking without N26 interface supported\";\nthe UE shall ignore the PDU session status IE if received in the REGISTRATION ACCEPT message.\nIf the EPS bearer context status IE is included in the REGISTRATION ACCEPT message, the UE shall locally delete all those QoS flow descriptions and all associated QoS rules, if any, which are associated with inactive EPS bearer contexts as indicated by the AMF in the EPS bearer context status IE.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting inter-system change with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 not supported\" if the AMF supports N26 interface; or\nb)\t\"interworking without N26 supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for inter-system interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a06:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the received interworking without N26 interface indicator for inter-system change with EPS as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services or emergency services fallback, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers take the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in N1 mode, then the UE shall not perform a local release of any persistent PDU session if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. When the UE determines via the Emergency services support indicator that the network does not support emergency services in N1 mode, then the UE shall not perform a local release of any emergency PDU session if user-plane resources associated with that emergency PDU session are established if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. In a UE with LCS capability, location services indicators (5G-LCS) shall be provided to the upper layers.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a07:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based on operator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a08:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nIf the UE is not operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 1 is only applicable while the UE is in N1 mode;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 1 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 2 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nIf the UE is operating in SNPN access mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\", the UE shall act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or until the UE selects another SNPN. Access identity 1 is only applicable while the UE is in N1 mode;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 1 in the RSNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\", the UE shall act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or until the UE selects another SNPN. Access identity 2 is only applicable while the UE is in N1 mode; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 2 in the RSNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, and the user's subscription context obtained from the UDM if available.\nIf the UE included in the REGISTRATION REQUEST message the UE status information IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" and the AMF does not support N26 interface, the AMF shall operate as described in subclause\u00a05.5.1.2.4.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message, a service gap time value is available in the 5GMM context, the AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but the UE has an emergency PDU session established, the AMF may accept the REGISTRATION REQUEST message and indicate to the SMF to release all non-emergency PDU sessions when the registration procedure is initiated in 5GMM-CONNECTED mode. When the registration procedure is initiated in 5GMM-IDLE mode, the AMF indicates to the SMF to release all non-emergency PDU sessions and informs the UE via the PDU session status IE in the REGISTRATION ACCEPT message. The AMF shall not indicate to the SMF to release the emergency PDU session. The network shall behave as if the UE is registered for emergency services.\nIf the REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, and behave as specified in subclause\u00a05.3.5.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and:\na)\tthe SOR transparent container IE does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]):\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C then the UE may release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message.\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), indicates list of preferred PLMN/access technology combinations is provided and the list type indicates:\na)\t\"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nb)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, in the current registration area; or\nb)\totherwise if:\n1)\tthe UE has NSSAI inclusion mode for the current PLMN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode; or\n2)\tthe UE does not have NSSAI inclusion mode for the current PLMN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\nii)\tnon-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0C in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf there is a running T3447 timer in the AMF and the Uplink data status IE is included or the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the Uplink data status IE or that the Follow-on request indicator is set to \"Follow-on request pending\" and proceed as if the Uplink data status IE was not received or the Follow-on request indicator was not set to \"Follow-on request pending\" except for the following case:\n-\tthe PDU session(s) indicated by the Uplink data status IE is emergency PDU session(s);\n-\tthe UE is configured for high priority access in selected PLMN;\n-\tthe REGISTRATION REQUEST message is as a paging response; or\n-\tthe UE is establishing an emergency PDU session or performing emergency services fallback.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN stored at the UE, then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE configuration, the UE shall include the manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\n***   Next Change   ***\n8.2.7.1\tMessage definition\nThe REGISTRATION ACCEPT message is sent by the AMF to the UE. See table\u00a08.2.7.1.1.\nMessage type:\tREGISTRATION ACCEPT\nSignificance:\tdual\nDirection:\t\tnetwork to UE\nTable\u00a08.2.7.1.1: REGISTRATION ACCEPT message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tExtended protocol discriminator\tExtended protocol discriminator\t9.2\tM\tV\t1\n\tSecurity header type\tSecurity header type\t9.3\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.5\tM\tV\t1/2\n\tRegistration accept message identity\tMessage type\t9.7\tM\tV\t1\n\t5GS registration result\t5GS registration result\t9.11.3.6\tM\tLV\t2\n77\t5G-GUTI\t5GS mobile identity\t9.11.3.4\tO\tTLV-E\t14\n4A\tEquivalent PLMNs\tPLMN list\t9.11.3.45\tO\tTLV\t5-47\n54\tTAI list\t5GS tracking area identity list\t9.11.3.9\tO\tTLV\t9-114\n15\tAllowed NSSAI\tNSSAI\t9.11.3.37\tO\tTLV\t4-74\n11\tRejected NSSAI\tRejected NSSAI\t9.11.3.46\tO\tTLV\t4-42\n31\tConfigured NSSAI\tNSSAI\t9.11.3.37\tO\tTLV\t4-146\n21\t5GS network feature support\t5GS network feature support\t9.11.3.5\tO\tTLV\t3-5\n50\tPDU session status\tPDU session status\t9.11.3.44\tO\tTLV\t4-34\n26\tPDU session reactivation result\tPDU session reactivation result\t9.11.3.42\tO\tTLV\t4-34\n72\tPDU session reactivation result error cause\tPDU session reactivation result error cause\t9.11.3.43\tO\tTLV-E\t5-515\n79\tLADN information\tLADN information\t9.11.3.30\tO\tTLV-E\t12-1715\nB-\tMICO indication\tMICO indication\t9.11.3.31\tO\tTV\t1\n9-\tNetwork slicing indication\tNetwork slicing indication\t9.11.3.36\tO\tTV\t1\n27\tService area list\tService area list\t9.11.3.49\tO\tTLV\t6-114\n5E\tT3512 value\tGPRS timer 3\t9.11.2.5\tO\tTLV\t3\n5D\tNon-3GPP de-registration timer value\tGPRS timer 2\t9.11.2.4\tO\tTLV\t3\n16\tT3502 value\tGPRS timer 2\t9.11.2.4\tO\tTLV\t3\n34\tEmergency number list\tEmergency number list\t9.11.3.23\tO\tTLV\t5-50\n7A\tExtended emergency number list\tExtended emergency number list\t9.11.3.26\tO\tTLV-E\t7-65538\n73\tSOR transparent container\tSOR transparent container\t9.11.3.51\tO\tTLV-E\t20-n\n78\tEAP message\tEAP message\t9.11.2.2\tO\tTLV-E\t7-1503\nA-\tNSSAI inclusion mode\tNSSAI inclusion mode\t9.11.3.37A\tO\tTV\t1\n76\tOperator-defined access category definitions\tOperator-defined access category definitions\t9.11.3.38\tO\tTLV-E\t3-n\n51\tNegotiated DRX parameters\t5GS DRX parameters\t9.11.3.2A\tO\tTLV\t3\nD-\tNon-3GPP NW policies\tNon-3GPP NW provided policies\t9.11.3.36A\tO\tTV\t1\n60\tEPS bearer context status\tEPS bearer context status\t9.11.3.23A\tO\tTLV\t4\n6E\tNegotiated extended DRX parameters\tExtended DRX parameters\t9.11.3.26A\tO\tTLV\t3\n6C\tT3447 value\tGPRS timer 3\t9.11.2.5\tO\tTLV\t3\n6B\tT3448 value\tGPRS timer 3\t9.11.2.4\tO\tTLV\t3\n6A\tT3324 value\tGPRS timer 3\t9.11.2.5\tO\tTLV\t3\n67\tUE radio capability ID\tUE radio capability ID\t9.11.3.68\tO\tTLV\t3-n\n68\tUE radio capability ID deletion indication\tUE radio capability ID deletion indication\t9.11.3.69\tO\tTV\t1\n39\tPending NSSAI\tNSSAI\t9.11.3.37\tO\tTLV\t4-74\n74\tCiphering key data\tCiphering key data\t9.11.3.18C\tO\tTLV-E\tx-n\n\nEditor's note [WI: 5G_eLCS, CR#1705]:\tThe Ciphering key data IE includes positioning SIBs that are still being discussed in RAN2 for Rel-16. The minimum and maximum length for this IE will need to be calculated and added to table 8.2.7.1.1 after RAN2 agreements for Rel-16.\n***   Next Change   ***\n\n\n***   Next Change   ***\n10.2\tTimers of 5GS mobility management\nTimers of 5GS mobility management are shown in table\u00a010.2.1 and table\u00a010.2.2\nNOTE:\tTimer T3346 is defined in 3GPP\u00a0TS\u00a024.008\u00a0[12]. Timers T3444, T3445, T3447 and T3448 are defined in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nTable\u00a010.2.1: Timers of 5GS mobility management \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3502\tDefault 12 min.\tNOTE\u00a01\t5GMM-DEREGISTERED 5GMM-REGISTERED\tAt registration failure and the attempt counter is equal to 5\tTransmission of REGISTRATION REQUEST message\tInitiation of the registration procedure, if still required\nT3510\t15s\tNOTE\u00a07\tNOTE\u00a08\tIn WB-N1/CE mode, 85s\t5GMM-REGISTERED-INITIATED\tTransmission of REGISTRATION REQUEST message\tREGISTRATION ACCEPT message received or REGISTRATION REJECT message received\tStart T3511 or T3502 as specified in subclause\u00a05.5.1.2.7 if T3510 expired during registration procedure for initial registration.\t\tStart T3511 or T3502 as specified in subclause\u00a05.5.1.3.7 if T3510 expired during the registration procedure for mobility and periodic registration update\nT3511\t10s\t5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION\t\t5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE\t\t5GMM-REGISTERED.NORMAL-SERVICE\tAt registration failure due to lower layer failure, T3510 timeout or registration rejected with other 5GMM cause values than those treated in subclause\u00a05.5.1.2.5 for initial registration or subclause\u00a05.5.1.3.5 for mobility and periodic registration\tTransmission of REGISTRATION REQUEST message\t\t5GMM-CONNECTED mode entered (NOTE\u00a05)\tRetransmission of the REGISTRATION REQUEST, if still required\nT3512\tDefault 54 min\tNOTE\u00a01\tNOTE\u00a02\t5GMM-REGISTERED\tIn 5GMM-REGISTERED, when 5GMM-CONNECTED mode is left and if the NW does not indicate support for strictly periodic registration timer as specified in subclause\u00a05.3.7.\t\tIf the network indicates support for strictly periodic registration timer, T3512 is started after the successful completion of registration update procedure. T3512 is restarted if it expires in 5GMM-CONNECTED mode as specified in subclause\u00a05.3.7.\tWhen entering state 5GMM-DEREGISTERED \t\tWhen entering 5GMM-CONNECTED mode if the NW does not indicate support for strictly periodic registration timer as specified in subclause\u00a05.3.7.\tIn 5GMM-IDLE mode, Initiation of the periodic registration procedure if the UE is not registered for emergency services.\t\tIn 5GMM-CONNECTED mode, restart the timer T3512.\t\tLocally deregister if the UE is registered for emergency services\nT3516\t30s\tNOTE\u00a07\tNOTE\u00a08\tIn WB-N1/CE mode, 48s\t5GMM-REGISTERED-INITIATED\t5GMM-REGISTERED\t5GMM-DEREGISTERED-INITIATED\t5GMM-SERVICE-REQUEST-INITIATED\tRAND and RES* stored as a result of an 5G authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tREGISTRATION ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\t5GMM-DEREGISTERED, 5GMM-NULL or\t5GMM-IDLE mode entered\tDelete the stored RAND and RES*\nT3517\t15s\tNOTE\u00a07\tNOTE\u00a08 \tIn WB-N1/CE mode, 61s\t5GMM-SERVICE-REQUEST-INITIATED\tTransmission of SERVICE REQUEST message\t(a)\tIndication from the lower layers that the UE has changed to S1 mode or E-UTRA connected to 5GCN for case h) in subclause\u00a05.6.1.1; or\t(b)\tSERVICE ACCEPT message received, or\tSERVICE REJECT message received for cases other than h) in subclause\u00a05.6.1.1\tAbort the procedure\nT3519\t60s\tNOTE\u00a07\tNOTE\u00a08 \tIn WB-N1/CE mode, 90s\t\t5GMM-REGISTERED-INITIATED\t5GMM-REGISTERED\t5GMM-DEREGISTERED-INITIATED\t5GMM-SERVICE-REQUEST-INITIATED (NOTE\u00a06)\tTransmission of IDENTITY RESPONSE message, REGISTRATION REQUEST message, or DEREGISTRATION REQUEST message with freshly generated SUCI\tREGISTRATION ACCEPT message with new 5G-GUTI received\tCONFIGURATION UPDATE COMMAND message with new 5G-GUTI received DEREGISTRATION ACCEPT message\tDelete stored SUCI\nT3520\t15s\tNOTE\u00a07\tNOTE\u00a08\tIn WB-N1/CE mode, 33s\t5GMM-REGISTERED-INITIATED\t5GMM-REGISTERED\t5GMM-DEREGISTERED-INITIATED\t5GMM-SERVICE-REQUEST-INITIATED\tTransmission of AUTHENTICATION FAILURE message with any of the 5GMM cause #20, #21, #26 or #71\t\tTransmission of AUTHENTICATION RESPONSE message with an EAP-response message after detection of an error as described in subclause\u00a05.4.1.2.2.4\tAUTHENTICATION REQUEST message received or AUTHENTICATION REJECT message received\tor\tSECURITY MODE COMMAND message received\t\twhen entering 5GMM-IDLE mode\t\tindication of transmission failure of AUTHENTICATION FAILURE message from lower layers\tOn first expiry during a 5G AKA based primary authentication and key agreement procedure, the UE should consider the network as false and follow item g of subclause\u00a05.4.1.3.7, if the UE is not registered for emergency services.\t\tOn first expiry during a 5G AKA based primary authentication and key agreement procedure, the UE will follow subclause\u00a05.4.1.3.7 under \"For items\u00a0c, d, e and f:\", if the UE is registered for emergency services.\t\tOn first expiry during an EAP based primary authentication and key agreement procedure, the UE should consider the network as false and follow item e of subclause\u00a05.4.1.2.4.5, if the UE is not registered for emergency services.\t\tOn first expiry during an EAP based primary authentication and key agreement procedure, the UE will follow subclause\u00a05.4.1.2.4.5 under \"For item e:\", if the UE is registered for emergency services\nT3521\t15s\tNOTE\u00a07\tNOTE\u00a08\tIn WB-N1/CE mode, 45s\t5GMM-DEREGISTERED-INITIATED\tTransmission of DEREGISTRATION REQUEST message when de-registration procedure is not due to a \"switch off\"\tDEREGISTRATION ACCEPT message received\tRetransmission of DEREGISTRATION REQUEST message\nT3525\tDefault 60s\tNOTE\u00a03\tNOTE\u00a07\tNOTE\u00a08\tIn WB-N1/CE mode, default 120s\t5GMM-REGISTERED.NORMAL-SERVICE\tT3517 expires and service request attempt counter is greater than or equal to 5\tWhen entering state other than 5GMM-REGISTERED.NORMAL-SERVICE state,\tor\tUE camped on a new PLMN other than the PLMN on which timer started,\tor\tUser-plane resources established with the network\tThe UE may initiate service request procedure\nT3540\t10s\t5GMM-DEREGISTERED\t\t5GMM-REGISTERED\tREGISTRATION REJECT message or DEREGISTRATION REQUEST message received with any of the 5GMM cause #3, #6, #7, #11, #12, #13, #15, #27, #31, #62, #72, #73, #74, #75 or #76\tSERVICE REJECT message received with any of the 5GMM cause #3, #6, #7, #11, #12, #13, #15, #27, #72, #73, #74, #75 or #76.\tREGISTRATION ACCEPT message received as described in subclause 5.3.1.3 case b)\tSERVICE ACCEPT message received as described in subclause\u00a05.3.1.3 case f)\tAUTHENTICATION REJECT message received\tN1 NAS signalling connection released\tPDU sessions have been set up\tRelease the NAS signalling connection for the cases a), b), f) and g) as described in subclause\u00a05.3.1.3\n\t\t5GMM-REGISTERED\tCONFIGURATION UPDATE COMMAND message received as described in subclause\u00a05.3.1.3 case e)\tN1 NAS signalling connection released\tRelease the NAS signalling connection for the case e) and perform a new registration procedure as described in subclause 5.5.1.3.2\n\t\t5GMM-DEREGISTERED\t\t5GMM-DEREGISTERED.NORMAL-SERVICE\t\t5GMM-REGISTERED.NON-ALLOWED-SERVICE\tREGISTRATION REJECT message received with the 5GMM cause #9 or #10\tSERVICE REJECT message received with the 5GMM cause #9, #10 or #28\t\tRelease the NAS signalling connection for the cases c) and d) as described in subclause\u00a05.3.1.3 and initiation of the registration procedure as specified in subclause\u00a05.5.1.2.2 or 5.5.1.3.2\n\nNon-3GPP de-registration timer\tDefault 54 min.\tNOTE\u00a01\tNOTE\u00a02\tNOTE\u00a04\tAll 5GMM state over non-3GPP access except 5GMM-DEREGISTERED over non-3GPP access\tEntering 5GMM-IDLE mode over non-3GPP access\tN1 NAS signalling connection over non-3GPP access established or when entering state 5GMM-DEREGISTERED over non-3GPP access\tImplicitly de-register the UE for non-3GPP access on 1st expiry\nNOTE\u00a01:\tThe value of this timer is provided by the network operator during the registration procedure.\tNOTE\u00a02:\tThe default value of this timer is used if the network does not indicate a value in the REGISTRATION ACCEPT message and the UE does not have a stored value for this timer.\tNOTE\u00a03:\tThe value of this timer is UE implementation specific, with a minimum value of 60 seconds if not in NB-N1 mode and if not in WB-N1/CE mode.\tNOTE\u00a04:\tIf the T3346 value received in the mobility management messages is greater than the value of the non-3GPP de-registration timer, the UE sets the non-3GPP de-registration timer value to be 4 minutes greater than the value of timer T3346.\tNOTE\u00a05:\tThe conditions for which this applies are described in subclause\u00a05.5.1.3.7.\tNOTE\u00a06:\tThe conditions for which this applies to the 5GMM-SERVICE-REQUEST-INITIATED state are described in subclause\u00a05.4.1.3.7 case\u00a0c) and case\u00a0d).\tNOTE\u00a07:\tIn NB-N1 mode, the timer value shall be calculated as described in subclause 4.17.\tNOTE\u00a08:\tIn WB-N1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this table for the case of WB-N1/CE mode (see subclause\u00a04.19).\nTable\u00a010.2.2: Timers of 5GS mobility management \u2013 AMF side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3513\tNOTE\u00a07 \tNOTE\u00a09\tNOTE\u00a04\t5GMM-REGISTERED\tPaging procedure initiated\tPaging procedure completed as specified in subclause\u00a05.6.2.2.1\tNetwork dependent\nT3522\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 24s\t5GMM-DEREGISTERED-INITIATED\tTransmission of DEREGISTRATION REQUEST message\tDEREGISTRATION ACCEPT message received\tRetransmission of DEREGISTRATION REQUEST message\nT3550\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 18s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of REGISTRATION ACCEPT message with 5G-GUTI, with SOR transparent container IE, the Extended emergency number list IE or the Operator-defined access category definitions IE\tTransmission of REGISTRATION ACCEPT message with any of a) Network slicing subscription changed indication, and b) new configured NSSAI and optionally new mapped S-NSSAI(s)\tREGISTRATION COMPLETE message received\tRetransmission of REGISTRATION ACCEPT message\nT3555\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 24s\t5GMM-REGISTERED\tTransmission of CONFIGURATION UPDATE COMMAND message with \"acknowledgement requested\" set in the Acknowldgement bit of the Configuration update indication  IE\tCONFIGURATION UPDATE COMPLETE message received\tRetransmission of CONFIGURATION UPDATE COMMAND message\nT3560\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 24s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of AUTHENTICATION REQUEST message\tTransmission of SECURITY MODE COMMAND message\tAUTHENTICATION RESPONSE message received\tAUTHENTICATION FAILURE message received\tSECURITY MODE COMPLETE message received\tSECURITY MODE REJECT message received\tRetransmission of AUTHENTICATION REQUEST message or SECURITY MODE COMMAND message\nT3565\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 24s\t5GMM-REGISTERED\tTransmission of NOTIFICATION message\tSERVICE REQUEST message received\tNOTIFICATION RESPONSE message received\tREGISTRATION REQUEST\tMessage received\tDEREGISTRATION REQUEST message received\tRetransmission of NOTIFICATION message\nT3570\tNOTE\u00a06\tNOTE\u00a08\t6s\tIn WB-N1/CE mode, 24s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of IDENTITY REQUEST message\tIDENTITY RESPONSE message received\tRetransmission of IDENTITY REQUEST message\nT35xx\t15s\t5GMM-REGISTERED\tTransmission of NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message\tNETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message received\tRetransmission of NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message\nActive timer\tTBD\tAll except 5GMM-DEREGISTERED\tEntering 5GMM-IDLE mode after indicating MICO mode activation to the UE with an active timer value.\tN1 NAS signalling\tconnection established\tActivate MICO mode for the UE.\nImplicit de-registration timer\tNOTE\u00a02\tAll except 5GMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in 5GMM-IDLE mode\t\tEntering 5GMM-IDLE mode over 3GPP access if the MICO mode is activated and strictly periodic monitoring timer is not running\t\tThe strictly periodic monitoring timer expires while the network is in 5GMM-IDLE mode\tN1 NAS signalling connection established\tImplicitly de-register the UE on 1st expiry\nMobile reachable timer\tNOTE\u00a01 \tAll except 5GMM-DEREGISTERED\tEntering 5GMM-IDLE mode\tN1 NAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry, and start implicit de-registration timer, if the UE is not registered for emergency services.\t\tImplicitly de-register the UE which is registered for emergency services\nNon-3GPP implicit de-registration timer\tNOTE\u00a03\tAll except 5GMM-DEREGISTERED\tEntering 5GMM-IDLE mode over non-3GPP access\tN1 NAS signalling connection over non-3GPP access established\tImplicitly de-register the UE for non-3GPP access on 1s expiry\nStrictly periodic monitoring timer\tNOTE\u00a05\tAll except 5GMM-DEREGISTERED\tAt the successful completion of registration update procedure if strictly periodic registration timer indication is supported as specified in subclause\u00a05.3.7.\tEntering 5GMM-DEREGISTERED.\tIn 5GMM-IDLE mode, start implicit de-registration timer as specified in subclause\u00a05.3.7.\t\tIn 5GMM-CONNECTED mode, Strictly periodic monitoring timer is started again as specified in subclause\u00a05.3.7.\nNOTE\u00a01:\tThe default value of this timer is 4 minutes greater than the value of timer T3512. If the UE is registered for emergency services, the value of this timer is set equal to the value of timer T3512. If the T3346 value provided in the mobility management messages is greater than the value of the timer T3512, the AMF sets the mobile reachable timer and the implicit de-registration timer such that the sum of the timer values is greater than the value of timer T3346.\tNOTE\u00a02:\tThe value of this timer is network dependent. If MICO is activated, the default value of this timer is 4 minutes greater than the value of timer T3512.\tNOTE\u00a03:\tThe value of this timer is network dependent. The default value of this timer is 4 minutes greater than the non-3GPP de-registration timer. If the T3346 value provided in the mobility management messages is greater than the value of the non-3GPP de-registration timer, the AMF sets the non-3GPP implicit de-registration timer value to be 8 minutes greater than the value of timer T3346.\tNOTE\u00a04:\tThe value of this timer is network dependent.\tNOTE\u00a05:\tThe value of this timer is the same as the value of timer T3512.\tNOTE\u00a06:\tIn NB-N1 mode, the timer value shall be calculated as described in subclause\u00a04.17.\tNOTE\u00a07:\tIn NB-N1 mode, the timer value shall be calculated by using an NAS timer value which is network dependent.\tNOTE\u00a08:\tIn WB-N1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this table for the case of WB-N1/CE mode (see subclause\u00a04.19).\tNOTE\u00a09:\tIn WB-N1 mode, if the UE supports CE mode B, then the timer value shall be calculated by using an NAS timer value which value is network dependent.\n\n***   End of Changes   ***\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe editor's note \u201cHow to secure that a UE does not wait indefinitely for completion of the network slice-specific authentication and authorization is FFS.\u201d is yet not resolved.The open issue is proposed resolved by the AMF providing a timer to the UE.This option will use existing behaviour for successful and unsuccessful scenarios in the UE and the AMF, also for advanced scenarios on the network side - like AMF relocation.\n\n>>> SUMMARY OF CHANGE\nThis CR propose to resolve the editor\u2019s note by the AMF providing a timer the UE. The timer is running until either:the network slice-specific authentication and authorization procedure is completed (successfully or unsuccessfully); orexpiry, where the UE will initiate a registration procedure to request this S-NSSAI if still required.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE can wait indefinitely for completion of the network slice-specific authentication and authorization."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n-------------------------------------------- 1st Change ---------------------------------------------\n6.1.1.3.1\tTrust and no trust relationship\nThe IBCF acting as exit point shall apply the procedures described in clause 5.10.2 of TS 24.229 [5] before forwarding the SIP signalling to the IBCF acting as entry point; this one shall apply the procedures described in clause 5.10.3 of TS 24.229 [5]. \nAdditionally, in case there is no trust relationship between the two IM CN subsystems connected by II-NNI, the IBCF acting as exit point shall apply the procedures described in clause 4.4 of TS 24.229 [5], before forwarding the SIP signalling to the next IBCF.\nThese procedures may be utilized on a per header basis to realize overall trust as well as per service level screening of headers. Trust relationships and trust domains may be defined by inter-operator agreements for individual services and/or individual SIP headers.\nThe management of the SIP headers (if present) over II-NNI in case of a presence or not of a trust relationship between the two interconnected IM subsystems is wrapped up in the following table.\nTable\u00a06.2: Management of SIP headers over II-NNI in presence or not of a trust relationship\nItem\tHeader\tTrust relationship\tNot trust relationship\n1\tP-Asserted-Identity\n2\tP-Access-Network-Info\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4\n3\tResource-Priority\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4\n4\tHistory-Info\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in Clause 4.3.3 of RFC 4244 [25] and in 3GPP TS 24.229 [5], clause 4.4  \n5\tP-Asserted-Service\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t(NOTE 3)\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4 \t(NOTE 3)\n6\tP-Charging-Vector (see RFC 3455 [24])\tAs specified in 3GPP TS 24.229 [5], clause 5.10\tAs specified in 3GPP TS 24.229 [5], clause 5.10\n7\tP-Charging-Function-Addresses (see RFC 3455 [24])\tAs specified in 3GPP TS 24.229 [5], clause 5.10\tAs specified in 3GPP TS 24.229 [5], clause 5.10\n8\tP-Profile-Key\n(NOTE 2)\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4\n9\tP-Private-Network-Indication\n(NOTE 1)\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4\n10\tP-Served-User\t(NOTE 1, NOTE 2)\tAs specified in 3GPP TS 24.229 [5], clause 4.4\t\tAs specified in 3GPP TS 24.229 [5], clause 4.4\n11\tReason (in a response) \tAs specified in 3GPP TS 24.229 [5], clause 4.4\tAs specified in 3GPP TS 24.229 [5], clause 4.4\nNOTE 1: \tFor a roaming II-NNI between a home IMS and a visited IMS, a trust relationship with respect to this header is required.\tNOTE 2: \tThis header is only applicable on an II-NNI between a home IMS and a visited IMS.\tNOTE 3: \tIn addition, value-dependent operator policies may be applied.  \n\n\n------------------------------------------ End Changes -------------------------------------------\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe Table 6.2. \"Management of SIP headers over II-NNI in presence or not of a trust relationship\" lists Headers where special treatment over the II-NNI. The Table includes a reference to an appropriate document to read about the special treatment. However, the special handling of CPC and OLI uri parameters in the P-Asserted-Identity is described in annex J and not not included hence a reference is needed in the P-Asserted-Identity row.\n\n>>> SUMMARY OF CHANGE\nA reference to the subclause J.2 is included in Table 6.2.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe handling of CPC and OLI may be forgotten when passing a non-trusted border."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n******************* First Change ***********************\n4.4.9\tRequirements on reference point Ua\nThe generic requirements for reference point Ua are:\n-\tthe UE and the NAF shall be able to secure the reference point Ua using the GBA-based shared secret;\nNOTE\u00a01:\tThe exact method of securing the reference point Ua depends on the application protocol used over reference point Ua.\n-\tthe NAF shall be able to indicate to the UE that GBA-based shared secret should be used;\nthe NAF shall be able to indicate to the UE that the current shared secret has expired and the UE should use newer shared secret with the NAF.\n\n\n\n\n******************* Next Change ***********************\n4.5.2\tBootstrapping procedures\nWhen a UE wants to interact with a NAF, and it knows that the bootstrapping procedure is needed, it shall first perform a bootstrapping authentication (see figure\u00a04.3). Otherwise, the UE shall perform a bootstrapping authentication only when it has received bootstrapping initiation required message or a bootstrapping negotiation indication from the NAF, or when the lifetime of the key in UE has expired (cf. subclause\u00a04.5.3).\nNOTE\u00a01:\tThe main steps from the specifications of the AKA protocol in TS\u00a033.102\u00a0[2] and the HTTP digest AKA protocol in RFC\u00a03310\u00a0[4] are repeated in figure\u00a03 for the convenience of the reader. In case of any potential conflict, the specifications in TS\u00a033.102\u00a0[2] and RFC\u00a03310\u00a0[4] take precedence.\n\nFigure 4.3: The bootstrapping procedure\n1.\tThe UE sends an HTTP request towards the BSF.\n2.\tBSF retrieves the complete set of GBA user security settings and one or a whole batch of Authentication Vectors (AV, AV = RAND||AUTN||XRES||CK||IK) over the reference point Zh from the HSS.\n3.\tThen BSF forwards the RAND and AUTN to the UE in the 401 message (without the CK, IK and XRES). This is to demand the UE to authenticate itself.\n4.\tThe UE checks AUTN to verify that the challenge is from an authorised network; the UE also calculates CK, IK and RES. This will result in session keys IK and CK in both BSF and UE.\n5.\tThe UE sends another HTTP request, containing the Digest AKA response (calculated using RES), to the BSF.\n6.\tThe BSF authenticates the UE by verifying the Digest AKA response.\n7.\tThe BSF generates key material Ks by concatenating CK and IK. The B-TID value shall be also generated in format of NAI by taking the base64 encoded\u00a0[12] RAND value from step 3, and the BSF server name, i.e. base64encode(RAND)@BSF_servers_domain_name.\n8.\tThe BSF shall send a 200 OK message, including a B-TID, to the UE to indicate the success of the authentication. In addition, in the 200 OK message, the BSF shall supply the lifetime of the key Ks. The key material Ks is generated in UE by concatenating CK and IK.\n9.\tBoth the UE and the BSF shall use the Ks to derive the key material Ks_NAF during the procedures as specified in clause\u00a04.5.3. Ks_NAF shall be used for securing the reference point Ua.\n\tKs_NAF is computed as Ks_NAF = KDF (Ks, key derivation parameters), where KDF is a suitable key derivation function, and the key derivation parameters consist of the user's IMPI, the NAF_Id and RAND. The NAF_Id consists of the full DNS name of the NAF. KDF shall be implemented in the ME.\nNOTE\u00a02:\tTo allow consistent key derivation based on NAF name in UE and BSF, at least one of the three following prerequisites shall be fulfilled:\n(1)\tThe NAF is known in DNS under one domain name (FQDN) only, i.e. no two different domain names point to the IP address of the NAF. This has to be achieved by administrative means.\nThis prerequisite is not specific to 3GPP, as it is necessary also under other circumstances, e.g. for TLS V1.0 without use of wildcard or multiple-name certificates.\n(2)\tEach DNS entry of the NAF points to a different IP address. The NAF responds to all these IP addresses. Each IP address is tied to the corresponding FQDN by NAF configuration. The NAF can see from the IP address, which FQDN to use for key derivation.\n(3)\tUa uses a protocol which transfers the host name (FQDN of NAF as used by UE) to NAF (e.g. HTTP/1.1 with mandatory Host request header field). This requires the NAF to check the validity of the host name, to use this name in all communication with UE where appropriate, and to transfer this name to BSF to allow for correct derivation of Ks_NAF.\nIn case of a TLS tunnel this requires either multiple-identities certificates or the deployment of RFC\u00a03546\u00a0[9] or other protocol means with similar purpose.\nEditor's note:\tThe definition of the KDF is left to ETSI SAGE and is to be included in the Annex B of the present specification.\n\tThe UE and the BSF shall store the key Ks with the associated B-TID for further use, until the lifetime of Ks has expired, or until the key Ks is updated.\n4.5.3\tProcedures using bootstrapped Security Association\nBefore communication between the UE and the NAF can start, the UE and the NAF first have to agree whether to use shared keys obtained by means of the GBA. If the UE does not know whether to use GBA with this NAF, it uses the Initiation of Bootstrapping procedure described in clause\u00a04.5.1.\nOnce the UE and the NAF have established that they want to use GBA then every time the UE wants to interact with an NAF the following steps are executed as depicted in figure 4.4.\n\n\nUE starts communication over reference point Ua with the NAF:\n-\tin general, UE and NAF will not yet share the key(s) required to protect the reference point Ua. If they already do (i.e. if a key Ks_NAF for the corresponding key derivation parameter NAF_Id is already available),, the UE and the NAF can start to securely communicate right away. If the UE and the NAF do not yet share a key, the UE proceeds as follows:\n-\tif a key Ks for the selected UICC application is available in the UE, the UE derives the key Ks_NAF from Ks, as specified in clause 4.5.2;\n-\tif no key Ks for the selected UICC application is available in the UE, the UE first agrees on a new key Ks with the BSF over the reference point Ub, and then proceeds to derive Ks_NAF;\nNOTE\u00a01:\tIf it is not desired by the UE to use the same Ks for the selected UICC application to derive more than one Ks_NAF then the UE should agree on a new key Ks with the BSF over the reference point Ub, and then proceed to derive Ks_NAF;\n-\tif the NAF shares a key with the UE, but the NAF requires an update of that key, e.g. because the key\u2019s lifetime has expired, it shall send a suitable bootstrapping renegotiation request to the UE and terminates the protocol used over reference point Ua, see figure 4.5. The form of this indication depends on the particular protocol used over reference point Ua. If the UE receives a bootstrapping renegotiation request, it starts a run of the protocol over reference point Ub, as specified in clause\u00a04.5.2, in order to obtain a new key Ks.\nNOTE\u00a02:\tTo allow for consistent key derivation in BSF and UE, both have to use the same FQDN for derivation (see NOTE\u00a02 of clause\u00a04.5.2). For each protocol used over Ua it shall be specified if only cases (1) and (2) of NOTE\u00a02 of clause\u00a04.5.2 are allowed for the NAF or if the protocol used over Ua shall transfer also the FQDN used for key derivation by UE to NAF.\nNOTE\u00a03:\tIf the shared key between UE and NAF is invalid , the NAF can set deletion conditions to the corresponding security association for subsequent removal.\n-\tthe UE supplies the B-TID to the NAF, in the form as specified in clause\u00a04.3.2, to allow the NAF to retrieve the corresponding keys from the BSF;\nNOTE\u00a04:\tThe UE may adapt the key material Ks_NAF to the specific needs of the reference point Ua. This adaptation is outside the scope of this specification.\n-\twhen the UE is powered down, or when the UICC is removed, any keys Ks and Ks_NAF shall be deleted from storage;\n-\twhen a new Ks is agreed over the reference point Ub and a key Ks_NAF, derived from one NAF_Id, is updated, the other keys Ks_NAF, derived from different values NAF_Id, stored on the UE shall not be affected;\nNAF starts communication over reference point Zn with BSF\n-\tThe NAF requests key material corresponding to the B-TID supplied by the UE to the NAF over reference point Ua. If the NAF has several FQDNs, which may be used in conjunction with this specification, then the NAF shall transfer in the request over Zn the same FQDN, which was used over Ua (see NOTE\u00a02 on key derivation in this clause);\n-\tThe NAF may also request application-specific user security settings for the applications, which the request received over Ua from UE may access;\n-\tWith the key material request, the NAF shall supply NAF\u2019s public hostname that UE has used to access NAF to BSF, and BSF shall be able verify that NAF is authorized to use that hostname;\n-\tThe BSF derives the keys required to protect the protocol used over reference point Ua from the key Ks and the key derivation parameters, as specified in clause 4.5.2, and supplies to NAF the requested key Ks_NAF, as well as the lifetime of that key. If the key identified by the B-TID supplied by the NAF is not available at the BSF, the BSF shall indicate this in the reply to the NAF. The NAF then indicates a bootstrapping renegotiation request to the UE.\nNOTE\u00a05:\tThe NAF shall adapt the key material Ks_NAF to the specific needs of the reference point Ua in the same way as the UE did. This adaptation is outside the scope of this specification.\n-\tThe BSF may also send the private user identity (IMPI) and requested user security settings to NAF according to the BSF's policy;\nNAF continues with the protocol used over the reference point Ua with the UE.\nOnce the run of the protocol used over reference point Ua is completed the purpose of bootstrapping is fulfilled as it enabled UE and NAF to use reference point Ua in a secure way.\n\nFigure 4.4: The bootstrapping usage procedure\n\nFigure 4.5: Bootstrapping renegotiation request\n\n\n\n\n\n\n\n\n******************* Next Change ***********************\n5.3.2\tBootstrapping procedure\nThe procedure specified in this clause differs from the procedure specified clause\u00a04.5.2 in the local handling of keys and Authentication Vectors in the UE and the BSF. The messages exchanged over the Ub reference point are identical for both procedures.\nWhen a UE wants to interact with a NAF, and it knows that the bootstrapping procedure is needed, it shall first perform a bootstrapping authentication (see figure 5.1). Otherwise, the UE shall perform a bootstrapping authentication only when it has received bootstrapping initiation required message or a bootstrapping renegotiation indication from the NAF, or when the lifetime of the key in UE has expired (see clause\u00a05.3.3).\nNOTE:\tThe main steps from the specifications of the AKA protocol in TS\u00a033.102\u00a0[2] and the HTTP digest AKA protocol in RFC\u00a03310\u00a0[4] are repeated in figure\u00a05.1 for the convenience of the reader. In case of any potential conflict, the specifications in TS\u00a033.102\u00a0[2] and RFC\u00a03310\u00a0[4] take precedence.\n\nFigure 5.1: The bootstrapping procedure with UICC-based enhancements\n1.\tThe ME sends an HTTP request towards the BSF.\n2.\tThe BSF retrieves the complete set of GBA user security settings and one or a whole batch of Authentication Vectors \n(AV, AV = RAND||AUTN||XRES||CK||IK) over the Zh reference point from the HSS. The BSF can then decide to perform GBA_U, based on the user security settings (USSs). In this case, the BSF proceeds in the following way:\n-\tBSF computes MAC* = MAC \uf0c5 SHA-1(IK1) (where IK= IK1|| IK2 and * is a exclusive or as described in TS\u00a033.102\u00a0[2])\nEditor's note:\tThe exact format of the MAC modification function is to be reviewed. The output of SHA-1 needs to be truncated to exact amount of bits needed (64 bits).\nThe BSF stores the XRES after flipping the least significant bit.\n3.\tThen BSF forwards the RAND and AUTN* (where AUTN* = SQN  AK || AMF || MAC*) to the UE in the 401 message (without the CK, IK and XRES). This is to demand the UE to authenticate itself.\n4.\tThe ME sends RAND and AUTN* to the UICC. The UICCcalculates IK and MAC (by performing MAC= MAC*\u00a0\u00a0SHA-1(IK1 )). Then the UICC checks AUTN(i.e. SQN  AK || AMF || MAC) to verify that the challenge is from an authorised network; the UICC also calculates CK and RES. This will result in session keys CK and IK in both BSF and UICC.\n5.\tThe UICC then applies a suitable key derivation function h1 to Ks, which is the concatenation of CK and IK, and possibly further h1-key derivation parameters to obtain two keys, Ks_ext and Ks_int, each of length 128 bit, i.e. h1(Ks, h1 key derivation parameters) = Ks_ext || Ks_int (see also figure 5.2). The UICC then transfers RES (after flipping the least significant bit) and Ks_ext to the ME and stores Ks_int/ks_ext on the UICC.\nEditors' Note:\tThe definition of the h1 is left to ETSI SAGE and is to be included in the Annex B of the present specification.\nEditors' Note:\tThe location (whether in the UICC or in the ME) of the storage of Ks_ext is ffs.\n6.\tThe ME sends another HTTP request, containing the Digest AKA response (calculated using RES), to the BSF.\n7.\tThe BSF authenticates the UE by verifying the Digest AKA response.\n8.\tThe BSF generates the key Ks by concatenating CK and IK. Then the BSF applies the key derivation function h1 to Ks and possibly further h1-key derivation parameters to obtain two keys, Ks_ext and Ks_int, in the same way as the UICC did in step\u00a05. The B-TID value shall be also generated in format of NAI by taking the base64 encoded\u00a0[12] RAND value from step\u00a03, and the BSF server name, i.e. base64encode(RAND)@BSF_servers_domain_name.\n9.\tThe BSF shall send a 200 OK message, including the B-TID, to the UE to indicate the success of the authentication. In addition, in the 200 OK message, the BSF shall supply the lifetime of the keys Ks_ext and Ks_int, The lifetimes of the keys Ks_ext and Ks_int shall be the same.\n10.\tThe BSF shall use the keys Ks_ext and Ks_int to derive the NAF-specific keys Ks_ext_NAF and Ks_int_NAF, if requested by a NAF over the Zn reference point. Ks_ext_NAF and Ks_int_NAF are used for securing the Ua reference point. The UE shall use the key Ks_ext to derive the NAF-specific key Ks_ext_NAF, if applicable. The UICC shall use the key Ks_int to derive the NAF-specific key Ks_int_NAF, if applicable.\n\tKs_ext_NAF is computed as Ks_ext_NAF = h2 (Ks_ext, h2-key derivation parameters), and Ks_int_NAF is computed in the UICC as Ks_int_NAF = h2 (Ks_int, h2-key derivation parameters), where h2 is a suitable key derivation function, and the h2-key derivation parameters include the user's IMPI, the NAF_Id and RAND. The NAF_Id consists of the full DNS name of the NAF.\nEditors' Note:\tThe definition of the h2 is left to ETSI SAGE and is to be included in the Annex B of the present specification.\nNOTE:\tThe NOTE\u00a02 of clause\u00a04.5.2 also applies here.\n\tThe ME, the UICC and the BSF store the keys Ks_ext and Ks_int together with the associated B-TID for further use, until the lifetime of Ks_ext and Ks_int has expired, or until the keys Ks_ext and Ks_int are updated.\n\nFigure 5.2: Key derivation for GBA-aware UICC when GBA-run was triggered\n5.3.3\tProcedures using bootstrapped Security Association\nBefore communication between the UE and the NAF can start, the UE and the NAF first have to agree whether to use shared keys obtained by means of the GBA. If the UE does not know whether to use GBA with this NAF, it uses the Initiation of Bootstrapping procedure described in clause\u00a05.3.1.\nOnce the UE and the NAF have established that they want to use GBA then every time the UE wants to interact with a NAF the following steps are executed as depicted in figure\u00a05.3.\nNext, the UE and the NAF have to agree, which type of keys to use, Ks_ext_NAF or Ks_int_NAF, or both. The default is the use of Ks_ext_NAF only. This use is also supported by MEs and NAFs, which are GBA_U unaware. If Ks_int_NAF, or both Ks_ext and Ks_int are to be used, this use has to be agreed between UE and NAF prior to the execution of the procedure described in the remainder of this clause\u00a05.3.3. Any such agreement overrules the default use of the keys. How this agreement is reached is application-specific and is not within the scope of this document.\nNOTE\u00a01:\tThis agreement may be mandated by the specification, which defines the Ua reference point between UE and NAF, e.g. TS 33.246 for the use of GBA in MBMS, or negotiated by the NAF and the UE over the Ua reference point, or reached by configuration.\nEditors' Note:\tThe support of unaware GBA_U MEs, which are GBA_ME aware only is FFS.\n\n\nIn general, UE and NAF will not yet share the key(s) required to protect the Ua reference point. If they do not, the UE proceeds as follows:\n-\tif Ks_ext_NAF is required and a key Ks_ext for the selected UICC application is available in the UE, the UE derives the key Ks_ext_NAF from Ks_ext, as specified in clause\u00a05.3.2;\n-\tif Ks_int_NAF is required and a key Ks_int for the selected UICC application is available in the UICC, the ME requests the UICC to derive the key Ks_int_NAF from Ks_int, as specified in clause\u00a05.3.2;\nNOTE\u00a02:\tIf it is not desired by the UE to use the same Ks_ext/int for the selected UICC application to derive more than one Ks_ext/int_NAF then the UE should first agree on new keys Ks_ext and Ks_int with the BSF over the Ub reference point, as specified in clause\u00a05.3.2, and then proceeds to derive Ks_ext_NAF or Ks_int_NAF, or both, as required.\n-\tif Ks_ext and Ks_int for the selected UICC application are not available in the UE, the UE first agrees on new keys Ks_ext and Ks_int with the BSF over the Ub reference point, as specified in clause\u00a05.3.2, and then proceeds to derive Ks_ext_NAF or Ks_int_NAF, or both, as required;\n-\tif the NAF shares a key with the UE, but the NAF requires an update of that key, it shall send a suitable bootstrapping renegotiation request to the UE and terminate the protocol used over Ua reference point. The form of this indication depends on the particular protocol used over Ua reference point. If the UE receives a bootstrapping renegotiation request, it starts a run of the protocol over Ub, as specified in clause\u00a05.3.2, in order to obtain new keys.\nNOTE\u00a03:\tIf the shared keys between UE and NAF become invalid, the NAF can set deletion conditions to the corresponding security association for subsequent removal.\nNOTE\u00a04:\tIf it is not desired by the NAF to use the same Ks to derive more than one Ks_int/ext_NAF then the NAF should always reply to the first request sent by a UE by sending a key update request to the UE.\nUE and NAF can now start the communication over Ua reference point using the keys Ks_ext_NAF or Ks_int_NAF, or both, as required. They proceed as follows:\n-\tThe UE supplies the B-TID to the NAF, as specified in clause\u00a05.3.2, to allow the NAF to retrieve the corresponding keys from the BSF\nNOTE\u00a05:\tTo allow for consistent key derivation in BSF and UE, both have to use the same FQDN for derivation (cf. NOTE\u00a02 of clause\u00a04.5.2). For each protocol used over Ua it shall be specified if only cases (1) and (2) of NOTE\u00a02 of clause\u00a04.5.2 are allowed for the NAF or if the protocol used over Ua shall transfer also the FQDN used for key derivation by UE to NAF.\nNOTE\u00a06:\tThe UE may adapt the keys Ks_ext_NAF or Ks_int_NAF to the specific needs of the Ua reference point. This adaptation is outside the scope of this specification.\n-\twhen the UE is powered down, or when the UICC is removed, any GBA_U keys shall be deleted from storage in the ME. There is no need to delete keys Ks_int and Ks_int_NAF from storage in the UICC;\nNOTE\u00a07:\tAfter each run of the protocol over the Ub reference point, new keys Ks_ext and Ks_int, associated with a new B-TID, are derived in the UE according to clause\u00a05.3.2, so that it can never happen, that keys Ks_ext and Ks_int with different B-TIDs simultaneously exist in the UE.\n-\tWhen new keys Ks_ext and Ks_int are agreed over the Ub reference point and new NAF-specific keys need to be derived for one NAF_Id, then both, Ks_ext_NAF and Ks_int_NAF (if present), shall be updated for this NAF_Id, but further keys Ks_ext_NAF or Ks_int_NAF relating to other NAF_Ids, which may be stored on the UE, shall not be affected;\nNOTE\u00a08:\tThis rule ensures that the keys Ks_ext_NAF and Ks_int_NAF are always in synch at the UE and the NAF.\nNAF now starts communication over the Zn reference point with the BSF.\n-\tThe NAF requests from the BSF the keys corresponding to the B-TID, which was supplied by the UE to the NAF over the Ua reference point. If the NAF is GBA_U aware it indicates this by including a corresponding flag in the request. If the NAF has several FQDNs, which may be used in conjunction with this specification, then the NAF shall transfer in the request over Zn the same FQDN, which was used over Ua (see note above on key derivation in this clause).\n-\tThe NAF may also request application-specific user security settings for the applications, which the request received over Ua from UE may access;\n-\tWith the keys request over the Zn reference point, the NAF shall supply NAF\u2019s public hostname that UE has used to access NAF to BSF, and BSF shall be able to verify that NAF is authorized to use that hostname.\n-\tThe BSF derives the keys Ks_ext_NAF, and Ks_int_NAF (if additionally required), as specified in clause\u00a05.3.2. If the NAF indicated in its request that it is GBA_U aware, the BSF supplies to NAF both keys, Ks_ext_NAF, and Ks_int_NAF, otherwise the BSF supplies only Ks_ext_NAF. In addition, the BSF supplies the lifetime time of these keys. If the key identified by the B-TID supplied by the NAF is not available at the BSF, the BSF shall indicate this in the reply to the NAF. The NAF then indicates a bootstrapping renegotiation request (See figure\u00a04.5) to the UE;\nNOTE:\tThe NAF may adapt the keys Ks_ext_NAF and Ks_int_NAF to the specific needs of the Ua reference point in the same way as the UE did. This adaptation is outside the scope of this specification.\n-\tThe BSF may also send the private user identity (IMPI) and requested user security settings to NAF according to the BSF\u2019s policy.\nThe NAF now continues with the protocol used over the Ua reference point with the UE.\nOnce the run of the protocol used over Ua reference point is completed the purpose of bootstrapping is fulfilled as it enabled the UE and NAF to use Ua reference point in a secure way.\n\nFigure 5.3: The bootstrapping usage procedure with UICC-based enhancements\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWithout forcing a re-run of AKA, there is currently no way for a NAF to guarantee that a Ks_NAF is fresh.\n\n>>> SUMMARY OF CHANGE\nEnhanced key freshness is added to the specification. It is described how the UE and NAF may support adding random numbers to the B-TID that is sent to the BSF. It is also described how the BSF uses these random numbers in the generation of the NAF specific key.\n\n>>> CONSEQUENCES IF NOT REVISED\nSome possible Ua protocols may be vulnerable to replay attacks unless they force a run of AKA to generate a new key."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********************************FIRST CHANGE************************\nN.2.1.2\tAuthentication Requirements for Non-registration Messages\nFor the purposes of this subsection, the name \"authentication\" is used synonymously with \"message origin authentication\".\nThe IP address check table (cf. subclause N.2.1.1) shall be used by the P-CSCF to identify the initiator of subsequent requests as follows: one of the public user identities associated with the packet IP address (and port if applicable) is selected and asserted to the S-CSCF according to the rules in TS 24.229 [8], subclause 5.2.6.3.\nIn addition, subsequent requests (e.g. INVITE) may be authenticated with SIP Digest, as described in the following:\nNOTE 1: The assertion of IMPUs based on checks of IP address (and ports if applicable) provides a reasonable level of security only in environments where the risk from source IP address and port spoofing or from IP address re-assignment unnoticed by the SIP application is sufficiently low. If the environment does not fulfill this condition then it is recommended to use SIP Digest in conjunction with either TLS, as specified in Annex O of this specification, or with the SIP Digest proxy authentication mechanism as specified in this subclause. It is not part of this specification to determine which environments fulfill the conditions in this NOTE. This is left to specifications, possibly maintained by standardization bodies other than 3GPP, describing these environments.\nWhen the S-CSCF receives a SIP request with a method other than the REGISTER method from the UE, the S-CSCF may perform authentication on the SIP request according to the operator's policy and according to the following procedures. \nIf the request does not contain a Proxy-Authorization header or the Proxy-Authorization header does not contain a digest response the S-CSCF shall send a 407 (Proxy Authentication Required) response to challenge the UE. The 407 response shall contain digest challenge parameters in a Proxy-Authenticate header as defined by RFC 2617 [12]. Upon receiving the challenge the UE  shall extract digest challenge parameters from the Proxy-Authenticate header field and calculate a digest response as indicated in RFC 2617[12]. The UE should store the received digest challenge. The UE then sends a new request to the network containing a Proxy-Authorization header in which the header fields are populated as described in RFC 2617 [12] using the calculated digest response. Upon receiving the new request which contains a digest response, the S-CSCF verifies the user\u2019s identity by validating the digest response information (e.g. the nonce-count) contained in the Proxy-Authorization header field against the expected information;\n If the check is successful then the request has been authenticated, and the S-CSCF sends a Proxy-Authentication-Info header along with the 2xx AUTH_OK towards the UE. The S-CSCF includes the response-auth parameter containing the S-CSCF's challenge response in the Proxy-Authentication-Info header which allows the UE to authenticate the S-CSCF;\nEditor's Note: The Proxy-Authentication-Info header is not currently defined in RFC 3261 [bb]. The progress of this issue in the IETF will need to be evaluated and a decision made on whether to include this feature in Release 8 of this specification.\nIf the check fails, based on local policy the S-CSCF may choose to re-challenge the user by using the same procedure described in this subclause, or reject the request by sending a 403 response. \nWhen the UE is to send a non-REGISTER SIP request it should first check whether it has a digest challenge stored which was previously received in a Proxy-Authorization header. If such a digest challenge is available in the UE the UE should use it together with the nonce-count mechanism as specified in RFC 2617 [12] to calculate a digest response, include the digest response in a Proxy-Authorization header and send this header together with the non-REGISTER SIP request.\nNOTE 2: According to RFC 2617 [12], the S-CSCF may send a 407 (Proxy Authentication Required) as a response to any non-REGISTER request, indicating that the nonce is stale and the digest response shall be recomputed using the fresh challenge sent in the same 407 message.\nWhen the S-CSCF has successfully used the SIP Digest proxy authentication mechanism it shall check the public user identities associated with the authenticated user against the public user identity asserted by the P-CSCF. In case of conflict, the result of SIP Digest proxy authentication shall take precedence, and the S-CSCF shall base further processing of the message on one of the public identities associated with the authenticated user.\nNOTE 3: Such a conflict may occur when one of the conditions mentioned in NOTE x is not fulfilled.\nAlternatively, TLS may be used by the P-CSCF to authenticate non-registration messages, cf. Annex O.\n******************************END FIRST CHANGE***********************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAnnex Q (informative) explains that there are limitations to the authentication of non-registration message by IP address check. SIP Digest proxy authentication is a stronger mechanism, hence when it is also used it shall take precedence over IP address check.\n\n>>> SUMMARY OF CHANGE\nIt is clarified that the S-CSCF shall ensure that the public user identity asserted in a SIP non-registration message is identical to the one authenticated by means of SIP Digest proxy authentication.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe weaker authentication mechanism may take precedence."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**** START OF CHANGE ****\n7.2.1\tIMS registration via CS access\n7.2.1.1\tOverview\nThe UE may register (attach) in the CS domain whenever in CS coverage. The existing mobility management mechanisms are used in the UE and the CS network.\nAfter performing a successful Location Area Update procedure to the UE, the MSC Server receives subscriber data from the HSS/HLR. This subscriber data may include an optional flag per VPLMN.\nAn MSC Server that is enhanced for ICS shall perform the following:\n-\tIf the flag is received and is supported by the MSC Server, then the MSC Server shall analyse the value of the flag as follows:\n-\tIf the flag is set to true and optionally if the MSC Server is configured to know that the VPLMN has a suitable roaming agreement with the HPLMN of the UE, the MSC Server shall attempt the IMS registration using the I2 reference point.\n-\tIf the flag is set to false, the MSC Server shall not attempt the IMS registration.\n-\tIf the flag is not received or is not supported, the MSC Server may perform some pre-screening (e.g. IMSI range analysis) based on operator-policy in order to determine whether or not to attempt IMS registration for this subscriber.\nNOTE\u00a01:\tExact prescreening procedures are operator specific.\nNOTE\u00a02:\tAn MSC Server that is not enhanced for ICS will ignore the flag and thus will continue normal CS operation.\nIf MSC Server decides not to perform registration in the IMS, the MSC Server falls back to the behaviour of an MSC Server that is not enhanced for ICS.\nWhen attempting initial IMS registration on behalf of the ICS User, the MSC Server shall derive a home IMS domain name using the identity of the subscriber (e.g. IMSI). This domain name identifies the node (e.g. ICSCF or IBCF) to which the MSC Server shall send the IMS registration. The MSC Server shall also derive IMS user identities required for the registration from this identity. The MSC Server shall derive these identities in a manner that prevents collisions with other identities automatically derived from the same subscriber identity. See clause\u00a04.6.2 of the present document for more information on the identities used.\nThe MSC Server then initiates a registration on behalf of the ICS User towards the home IMS indicating support for GRUU and including an InstanceID. If a GRUU is received, the MSC Server shall store it. The MSC Server shall not apply the mechanism for multiple simultaneous registrations.\nNOTE\u00a03:\tIMS authorization of registrations from an MSC Server enhanced for ICS is defined in clause\u00a09.\nThe MSC Server shall indicate in the registration the media capabilities that it supports (as listed in TS\u00a022.101\u00a0[9]).\nThe routing of the registration messaging is performed by standard IMS routing procedures. The SCSCF shall perform 3rd party registration towards the SCC AS. The SCC AS shall obtain from the SCSCF the necessary information related to the contact address for performing TADS.\nIf IMS registration is successful, then subsequent IMS sessions described in clause\u00a04.4.2 shall be supported in IMS using the MSC Server procedures described in this specification.\nThe success or failure of the IMS registration shall not impact the CS attach status of the UE.\nThe MSC Server enhanced for ICS shall initiate IMS re-registration as necessary to maintain an active IMS registration during the period of time in which the UE is attached to the CS domain.\nNOTE\u00a04:\tDue to the MSC Server not applying the mechanism for multiple simultaneous registrations, this results in the behaviour of when a UE attaches to a new MSC Server enhanced for ICS and the old MSC Server enhanced for ICS has not deregistered the user, the new registration over-writes the existing one in the SCSCF.\nAfter successful initial IMS registration, the MSC Server enhanced for ICS shall subscribe to the registration event package described in TS\u00a023.228\u00a0[2] on behalf of the ICS User. The MSC Server shall use the default Public User Identity received during initial IMS registration for subscription to this package. The MSC Server enhanced for ICS shall refresh this subscription as necessary during the period of time in which its IMS registration on behalf of the ICS User is active.\nThe MSC Server enhanced for ICS shall initiate IMS deregistration on behalf of the ICS User upon receipt of any indication that the UE is no longer considered active at this MSC Server (e.g. Location Cancellation procedure, Purge MS procedure, etc.). In order to ensure that the registration request from the target MSC Server arrives at the SCSCF prior to the deregistration request from the source MSC Server, the MSC Server should delay the deregistration procedure, such as by starting a timer. If the SCSCF finds an existing binding upon receiving the deregistration request as specified in TS\u00a024.229\u00a0[31] and identifies that is a request initiated by the MSC Server enhanced for ICS on behalf of the ICS User, the SCSCF shall compare the contact address in the deregistration request with the contact address in the existing binding using the URI comparison rules. If it agrees, the SCSCF will remove the existing binding. Otherwise, the de-registration request fails. Per operator policy, the MSC Server enhanced for ICS shall also initiate IMS re-registrations to obtain additional temporary-GRUUs as need.\nUpon receipt of a network-initiated deregistration from the IMS, the MSC Server enhanced for ICS shall remove all registration details relating to the Public User Identities contained in the deregistration. Network-initiated deregistration from IMS shall not impact the UE\u2019s CS registration status.\n7.2.1.2\tRegistration using I2 reference point\nFigure 7.2.1.2-1 describes how IMS registration is performed by the MSC Server enhanced for ICS upon receiving of a Location Update Request.\n\nFigure 7.2.1.2-1: Initial IMS Registration via CS Access\n1.\tThe UE sends a Location Update Request towards the CS network.\n\n2.\tThe CS network performs standard CS location update, authentication and obtains subscriber data.\n3.\tA Location Update Accept is returned to the UE.\n\n4.\tThe MSC Server enhanced for ICS decides to initiate IMS registration for this subscriber. If the subscriber is already registered via this MSC Server enhanced for ICS, no IMS registration is sent.\n5.\tThe MSC Server enhanced for ICS derives a domain name from the subscriber\u2019s identity (e.g. IMSI) and discovers the address of the appropriate ICSCF/IBCF.\n6.\tThe MSC Server enhanced for ICS sends a SIP REGISTER to the IMS with a private and temporary Public User Identity derived from the subscriber\u2019s IMSI as well as an InstanceID. The REGISTER also contains information indicating the capabilities (e.g. media types) supported and characteristics of the MSC Server as a SIP User Agent Client. The ICSCF verifies that the incoming REGISTER origins from a trusted MSC Server (in the same way it would check that a normal REGISTER origins from a trusted PCSCF).\n7.\tThe ICSCF initiates standard procedures for SCSCF location/allocation.\n8.\tThe ICSCF forwards the REGISTER to the SCSCF.\n9.\tThe SCSCF identifies the REGISTER as being from the MSC Server. The SCSCF skips any further authentication procedures and performs registration procedures with the HSS. \n10.\tThe SCSCF performs standard service control execution procedures. Filter criteria directs the SCSCF to send a REGISTER to the SCC AS.\n11.\tIMS registration procedures are completed.\n**** NEXT CHANGE ****\n7.2.1.4\tRegistration after Deregistration using I2 reference point\nFigure\u00a07.2.1.4-1 describes how IMS deregistration is performed by the MSC Server enhanced for ICS upon detection of the Location Cancellation procedure. In this scenario, the UE is moving between two MSC Servers enhanced for ICS. Identical IMS deregistration procedures are initiated by the source MSC Server enhanced for ICS upon receiving of any other indication that the UE is no longer considered registered. The registration request from the target MSC Server enhanced for ICS arrives at the SCSCF after the deregistration request from the source MSC Server enhanced for ICS.\n\nFigure 7.2.1.4-1: IMS Deregistration via CS Access by source MSC Server enhanced for ICS when moving to a target MSC Server enhanced for ICS\n1.\tThe UE initiates standard location updating procedures towards the CS network.\n\n2.\tThe CS network performs standard CS location updating and authentication procedures.\n3.\tThe HSS initiates location cancellation procedures towards the source MSC Server enhanced for ICS.\n4.\tThe source MSC Server enhanced for ICS initiates IMS de-registration as described in clause\u00a07.2.1.3. The SCSCF removes the existing binding related to the source MSC Server enhanced for ICS.\n5.\tThe target MSC Server that is also enhanced for ICS initiates IMS registration as described in clause\u00a07.2.1.2. The SCSCF establishes a new binding related to the target MSC Server enhanced for ICS.\nNOTE:\tIf step\u00a05 is performed before step\u00a04, the de-registration of the source MSC Server enhanced for ICS does not affect the new registered contact of the target MSC Server enhanced for ICS.\n7.2.1.5\tRegistration before Deregistration using I2 reference point\nFigure\u00a07.2.1.5-1 describes how IMS deregistration is performed by the MSC Server enhanced for ICS upon detection of the Location Cancellation procedure. In this scenario, the UE is moving between two MSC Servers enhanced for ICS. Identical IMS deregistration procedures are initiated by the source MSC Server enhanced for ICS upon receiving of any other indication that the UE is no longer considered registered. The registration request from the target MSC Server enhanced for ICS arrives at the SCSCF before the deregistration request from the source MSC Server enhanced for ICS.\n\nFigure 7.2.1.5-1: IMS Deregistration via CS Access by source MSC Server enhanced for ICS when moving to a target MSC Server enhanced for ICS\n1.\tThe UE initiates standard location updating procedures towards the CS network.\n\n2.\tThe CS network performs standard CS location updating and authentication procedures.\n3.\tThe HSS initiates location cancellation procedures towards the source MSC Server enhanced for ICS.\n4.\tThe target MSC Server that is also enhanced for ICS initiates IMS registration as described in clause\u00a07.2.1.2. The SCSCF updates a existing binding related to the source MSC Server enhanced for ICS.\n5.\tThe source MSC Server that is enhanced for ICS initiates IMS deregistration for this subscriber.\n6.\tThe ICSCF initiates standard procedures for SCSCF location/allocation.\n7.\tThe ICSCF forwards the REGISTER to the SCSCF.\n8.\tThe SCSCF identifies the REGISTER as being from an MSC Server enhanced for ICS that is a trusted network node. The SCSCF skips any further authentication procedures and performs deregistration procedures as described in clause\u00a07.2.1.1. As the contact address in the REGISTER differs from the contact address in the existing binding related to the target MSC Server, the SCSCF returns an error response to the source MSC Server enhanced for ICS.\n**** END OF CHANGE ****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is not clear whether the current text about IMS registration via CS access using I2 reference point is applicable to the case of Combined Attach via SGs, i.e. whether the reception of a Location Update Request from the MME shall trigger the MSC Server to perform an I2 registration.\n\n>>> SUMMARY OF CHANGE\n- Text updated to refer to \"location updating procedure\" (i.e. the legacy MAP procedure between VLR and HLR) instead of the specific \"Location Area Update\" message.- NOTEs added to the relevant procedures to clarify that they also apply when Combined TA/LA Update is used instead of a Location Update request from the UE.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe MSC Server enhanced for ICS could be implemented in such a way that it does not perform I2 registration upon Combined Attach. As a consequence, in the 2 cases below, VoLTE (ICS) users would not be served correctly because they would not be registered in IMS:- the user inserts their USIM into a UE supporting CSFB but not VoLTE - the user roams into a PLMN supporting LTE, CSFB and I2, but is not able to use VoLTE in this PLMN (because VoLTE is not supported, lack of VoLTE roaming agreeement or incompatibility between UE and network)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nCHANGE START\n5.5.3.1\tGeneral\n<Text removed here>\nThe UE capable of CBR measurement when configured to transmit non-P2X related V2X sidelink communication shall:\n1>\tif in coverage on the frequency used for V2X sidelink communication transmission as defined in TS 36.304 [4, 11.4]; or\n1>\tif the concerned frequency is included in v2x-InterFreqInfoList in RRCConnectionReconfiguration or in v2x-InterFreqInfoList within SystemInformationBlockType21:\n2>\tif the UE is in RRC_IDLE:\n3>\tif the concerned frequency is the camped frequency:\n4>\tperform CBR measurement on the pools in v2x-CommTxPoolNormalCommon and v2x-CommTxPoolExceptional if included in SystemInformationBlockType21;\n3>\telse if v2x-CommTxPoolNormal or v2x-CommTxPoolExceptional is included in v2x-InterFreqInfoList for the concerned frequency within SystemInformationBlockType21:\n4>\tperform CBR measurement on pools in v2x-CommTxPoolNormal and v2x-CommTxPoolExceptional in v2x-InterFreqInfoList for the concerned frequency in SystemInformationBlockType21;\n3>\telse if the concerned frequency broadcasts SystemInformationBlockType21:\n4>\tperform CBR measurement on pools in v2x-CommTxPoolNormalCommon and v2x-CommTxPoolExceptional if included in SystemInformationBlockType21 broadcast on the concerned frequency;\n2>\tif the UE is in RRC_CONNECTED:\n3>\tif tx-ResourcePoolToAddList is included in VarMeasConfig:\n4>\tperform CBR measurements on each resource pool indicated in tx-ResourcePoolToAddList;\n3>\tif the concerned frequency is the PCell\u2019s frequency:\n4>\tperform CBR measurement on the pools in v2x-CommTxPoolNormalDedicated or v2x-SchedulingPool if included in RRCConnectionReconfiguration, v2x-CommTxPoolExceptional if included in SystemInformationBlockType21 and v2x-CommTxPoolExceptional if included in mobilityControlInfoV2X;\n3>\telse if v2x-CommTxPoolNormal, v2x-SchedulingPool or v2x-CommTxPoolExceptional is included in v2x-InterFreqInfoList for the concerned frequency within RRCConnectionReconfiguration:\n4>\tperform CBR measurement on pools in v2x-CommTxPoolNormal, v2x-SchedulingPool, and v2x-CommTxPoolExceptional if included in v2x-InterFreqInfoList for the concerned frequency in RRCConnectionReconfiguration;\n3>\telse if the concerned frequency broadcasts SystemInformationBlockType21:\n4>\tperform CBR measurement on pools in v2x-CommTxPoolNormalCommon and v2x-CommTxPoolExceptional if included in SystemInformationBlockType21;\n1>\telse:\n2>\tperform CBR measurement on pools in v2x-CommTxPoolList in SL-V2X-Preconfiguration for the concerned frequency;\n\nNEXT CHANGE \n5.10.7.3\tTransmission of SLSS\nThe UE shall select the SLSSID and the subframe in which to transmit SLSS as follows:\n1>\tif triggered by sidelink discovery announcement and in coverage on the frequency used for sidelink discovery, as defined in TS 36.304 [4, 11.4]:\n2>\tselect the SLSSID included in the entry of discSyncConfig included in the received SystemInformationBlockType19, that includes txParameters;\n2>\tuse syncOffsetIndicator corresponding to the selected SLSSID;\n2>\tfor each pool used for the transmission of discovery announcements (each corresponding to the selected SLSSID):\n3>\tif a subframe indicated by syncOffsetIndicator corresponds to the first subframe of the discovery transmission pool;\n4>\tif discTxGapConfig is configured and includes the concerned subframe; or the subframe is not used for regular uplink transmission:\n5>\tselect the concerned subframe;\n3>\telse\n4>\tif discTxGapConfig is configured and includes the concerned subframe; or the subframe is not used for regular uplink transmission:\n5>\tselect the subframe indicated by syncOffsetIndicator that precedes and which, in time domain, is nearest to the first subframe of the discovery transmission pool;\n3>\tif the sidelink discovery announcements concern PS; and if syncTxPeriodic is included:\n4>\tadditionally select each subframe that periodically occurs 40 subframes after the selected subframe;\n1>\tif triggered by sidelink communication and in coverage on the frequency used for sidelink communication, as defined in TS 36.304 [4, 11.4]:\n2>\tselect the SLSSID included in the entry of commSyncConfig that is included in the received SystemInformationBlockType18 and includes txParameters;\n2>\tuse syncOffsetIndicator corresponding to the selected SLSSID;\n2>\tif in RRC_CONNECTED; and if networkControlledSyncTx is configured and set to on:\n3>\tselect the subframe(s) indicated by syncOffsetIndicator;\n2>\telse (when transmitting communication):\n3>\tselect the subframe(s) indicated by syncOffsetIndicator within the SC period in which the UE intends to transmit sidelink control information or data;\n1>\tif triggered by V2X sidelink communication and in coverage on the frequency used for V2X sidelink communication, as defined in TS 36.304 [4, 11.4]; or\n1>\tif triggered by V2X sidelink communication, and out of coverage on the frequency used for V2X sidelink communication, and the concerned frequency is included in v2x-InterFreqInfoList in RRCConnectionReconfiguration or in v2x-InterFreqInfoList within SystemInformationBlockType21 of the serving cell/ PCell;\n2>\tif the UE has selected GNSS as synchronization reference in accordance with 5.10.8.2:\n3>\tselect SLSSID 0;\n3>\tuse syncOffsetIndicator included in the entry of v2x-SyncConfig corresponding to the concerned frequency in v2x-InterFreqInfoList, that includes txParameters and gnss-Sync;\n3>\tselect the subframe(s) indicated by syncOffsetIndicator;\n2>\tif the UE has selected a cell as synchronization reference in accordance with 5.10.8.2:\n3>\tselect the SLSSID included in the entry of v2x-SyncConfig configured for the concerned frequency, that includes txParameters and does not include gnss-Sync;\n3>\tuse syncOffsetIndicator corresponding to the selected SLSSID;\n3>\tselect the subframe(s) indicated by syncOffsetIndicator;\n1>\telse if triggered by V2X sidelink communication and the UE has GNSS as the synchronization reference:\n2>\tselect SLSSID 0;\n2>\tif syncOffsetIndicator3 is configured for the frequency used for V2X sidelink communication in SL-V2X-Preconfiguration:\n3>\tselect the subframe indicated by syncOffsetIndicator3;\n2>\telse:\n3>\tselect the subframe indicated by syncOffsetIndicator1;\n1>\telse:\n2>\tselect the synchronisation reference UE (i.e. SyncRef UE) as defined in 5.10.8;\n2>\tif the UE has a selected SyncRef UE and inCoverage in the MasterInformationBlock-SL or MasterInformationBlock-SL-V2X message received from this UE is set to TRUE; or\n2>\tif the UE has a selected SyncRef UE and inCoverage in the MasterInformationBlock-SL or MasterInformationBlock-SL-V2X message received from this UE is set to FALSE while the SLSS from this UE is part of the set defined for out of coverage, see TS 36.211 [21]:\n3>\tselect the same SLSSID as the SLSSID of the selected SyncRef UE;\n3>\tselect the subframe in which to transmit the SLSS according to the syncOffsetIndicator1 or syncOffsetIndicator2 included in the preconfigured sidelink parameters (i.e. preconfigSync in SL-Preconfiguration or v2x-CommPreconfigSync in SL-V2X-Preconfiguration defined in 9.3) corresponding to the concerned frequency, such that the subframe timing is different from the SLSS of the selected SyncRef UE;\n2>\telse if the UE has a selected SyncRef UE and the SLSS from this UE was transmitted on the subframe indicated by syncOffsetIndicator3 that is included in the syncOffsetIndicators in SL-V2X-Preconfiguration, and is corresponding to the frequency used for V2X sidelink communication:\n3>\tselect SLSSID 169;\n3>\tselect the subframe indicated by syncOffsetIndicator2;\n2>\telse if the UE has a selected SyncRef UE:\n3>\tselect the SLSSID from the set defined for out of coverage having an index that is 168 more than the index of the SLSSID of the selected SyncRef UE, see TS 36.211 [21];\n3>\tselect the subframe in which to transmit the SLSS according to syncOffsetIndicator1 or syncOffsetIndicator2 included in the preconfigured sidelink parameters (i.e. preconfigSync in SL-Preconfiguration or v2x-CommPreconfigSync in SL-V2X-Preconfiguration defined in 9.3), such that the subframe timing is different from the SLSS of the selected SyncRef UE;\n2>\telse (i.e. no SyncRef UE selected):\n3>\tif triggered by V2X sidelink communication, randomly select, using a uniform distribution, an SLSSID from the set of sequences defined for out of coverage except SLSSID 168 and 169, see TS 36.211 [21];\n3>\telse, randomly select, using a uniform distribution, an SLSSID from the set of sequences defined for out of coverage, see TS 36.211 [21];\n3>\tselect the subframe in which to transmit the SLSS according to the syncOffsetIndicator1 or syncOffsetIndicator2 (arbitrary selection between these) included in the preconfigured sidelink parameters (i.e. preconfigSync in SL-Preconfiguration or v2x-CommPreconfigSync in SL-V2X-Preconfiguration defined in 9.3);\n\nNEXT CHANGE \n6.2.2\tMessage definitions\n<Text removed here>\n\u2013\tRRCConnectionReconfiguration\nThe RRCConnectionReconfiguration message is the command to modify an RRC connection. It may convey information for measurement configuration, mobility control, radio resource configuration (including RBs, MAC main configuration and physical channel configuration) including any associated dedicated NAS information and security configuration.\n<Text removed here>\nRRCConnectionReconfiguration field descriptions\ndedicatedInfoNASList\tThis field is used to transfer UE specific NAS layer information between the network and the UE. The RRC layer is transparent for each PDU in the list.\nfullConfig\tIndicates the full configuration option is applicable for the RRC Connection Reconfiguration message.\nkeyChangeIndicator\ttrue is used only in an intra-cell handover when a KeNB key is derived from a KASME key taken into use through the latest successful NAS SMC procedure, as described in TS 33.401 [32] for KeNB re-keying. false is used in an intra-LTE handover when the new KeNB key is obtained from the current KeNB key or from the NH as described in TS 33.401 [32].\nlwa-Configuration\tThis field is used to provide parameters for LWA configuration. E-UTRAN does not simultaneously configure LWA with DC, LWIP or RCLWI for a UE.\nlwip-Configuration\tThis field is used to provide parameters for LWIP configuration. E-UTRAN does not simultaneously configure LWIP with DC, LWA or RCLWI for a UE.\nnas-securityParamToEUTRA\tThis field is used to transfer UE specific NAS layer information between the network and the UE. The RRC layer is transparent for this field, although it affects activation of AS- security after inter-RAT handover to E-UTRA. The content is defined in TS 24.301.\nnetworkControlledSyncTx\tThis field indicates whether the UE shall transmit synchronisation information (i.e. become synchronisation source). Value On indicates the UE to transmit synchronisation information while value Off indicates the UE to not transmit such information.\nnextHopChainingCount\tParameter NCC: See TS 33.401 [32]\nperCC-GapIndicationRequest\tIndicates that UE shall include perCC-GapIndicationList and numFreqEffective in the RRCConnectionReconfigurationComplete message. numFreqEffectiveReduced may also be included if frequencies are configured for reduced measurement performance.\np-MeNB\tIndicates the guaranteed power for the MeNB, as specified in TS 36.213 [23]. The value N corresponds to N-1 in TS 36.213 [23].\npowerControlMode\tIndicates the power control mode used in DC. Value 1 corresponds to DC power control mode 1 and value 2 indicates DC power control mode 2, as specified in TS 36.213 [23].\np-SeNB\tIndicates the guaranteed power for the SeNB as specified in TS 36.213 [23, Table 5.1.4.2-1]. The value N corresponds to N-1 in TS 36.213 [23].\nrclwi-Configuration\tWLAN traffic steering command as specified in 5.6.16.2. E-UTRAN does not simultaneously configure RCLWI with DC, LWA or LWIP for a UE.\nsCellIndex\tIn case of DC, the SCellIndex is unique within the scope of the UE i.e. an SCG cell can not use the same value as used for an MCG cell. For pSCellToAddMod, if sCellIndex-r13 is present the UE shall ignore sCellIndex-r12. sCellIndex-r13 in sCellToAddModListExt-r13 shall not have same values as sCellIndex-r10 in sCellToAddModList-r10.\nsCellToAddModList, sCellToAddModListExt\tIndicates the SCell to be added or modified. Field sCellToAddModList is used to add the first 4 SCells with sCellIndex-r10 while sCellToAddModListExt is used to add the rest. If E-UTRAN includes SCellToAddModListExt-v1430 it includes the same number of entries, and listed in the same order, as in SCellToAddModListExt-r13.\nsCellToAddModListSCG, sCellToAddModListSCG-Ext\tIndicates the SCG cell to be added or modified. The field is used for SCG cells other than the PSCell (which is added/ modified by field pSCellToAddMod). Field sCellToAddModListSCG is used to add the first 4 SCells with sCellIndex-r10 while sCellToAddModListSCG-Ext is used to add the rest.\nsCellToReleaseListSCG, sCellToReleaseListSCG-Ext\tIndicates the SCG cell to be released. The field is also used to release the PSCell e.g. upon change of PSCell, upon system information change for the PSCell.\nscg-Counter\tA counter used upon initial configuration of SCG security as well as upon refresh of S-KeNB. E-UTRAN includes the field upon SCG change when one or more SCG DRBs are configured. Otherwise E-UTRAN does not include the field.\nsl-P2X-ConfigDedicated\tIndicates sidelink configuration for P2X related V2X sidelink communication.\nsl-V2X-ConfigDedicated\tIndicates sidelink configuration for non-P2X related V2X sidelink communication as well as P2X related V2X sidelink communication.\nsrs-SwitchFromServCellIndex\tIndicates the serving cell whose UL transmission may be interrupted during SRS transmission on a PUSCH-less cell. During SRS transmission on a PUSCH-less cell, the UE may temporarily suspend the UL transmission on a serving cell with PUSCH in the same CG to allow the PUSCH-less cell to transmit SRS. The PUSCH-less cell is always a TDD cell but the serving cell with PUSCH may be either a FDD or TDD cell.\nsystemInformationBlockType1Dedicated\tThis field is used to transfer SystemInformationBlockType1 or SystemInformationBlockType1-BR to the UE.\nsystemInformationBlockType2Dedicated\tThis field is used to transfer BR version of SystemInformationBlockType2 to BL UEs or UEs in CE.\nt350\tTimer T350 as described in section 7.3. Value minN corresponds to N minutes.\n\nNEXT CHANGE \n6.3.8\tSidelink information elements\n<Text removed here>\n\u2013\tSL-CommResourcePool\nThe IE SL-CommResourcePool and SL-CommResourcePoolV2X specifies the configuration information for an individual pool of resources for sidelink communication and V2X sidelink communication respectively. The IE covers the configuration of both the sidelink control information and the data.\nSL-CommResourcePool information element\n-- ASN1START\n\nSL-CommTxPoolList-r12 ::=\t\tSEQUENCE (SIZE (1..maxSL-TxPool-r12)) OF SL-CommResourcePool-r12\n\nSL-CommTxPoolListExt-r13 ::=\tSEQUENCE (SIZE (1..maxSL-TxPool-v1310)) OF SL-CommResourcePool-r12\n\nSL-CommTxPoolListV2X-r14 ::=\t\tSEQUENCE (SIZE (1..maxSL-V2X-TxPool-r14)) OF SL-CommResourcePoolV2X-r14\n\nSL-CommRxPoolList-r12 ::=\t\tSEQUENCE (SIZE (1..maxSL-RxPool-r12)) OF SL-CommResourcePool-r12\n\nSL-CommRxPoolListV2X-r14 ::=\t\tSEQUENCE (SIZE (1..maxSL-V2X-RxPool-r14)) OF SL-CommResourcePoolV2X-r14\n\nSL-CommResourcePool-r12 ::=\t\tSEQUENCE {\n\tsc-CP-Len-r12\t\t\t\t\t\tSL-CP-Len-r12,\n\tsc-Period-r12\t\t\t\t\t\tSL-PeriodComm-r12,\n\tsc-TF-ResourceConfig-r12\t\t\tSL-TF-ResourceConfig-r12,\n\tdata-CP-Len-r12\t\t\t\t\t\tSL-CP-Len-r12,\n\tdataHoppingConfig-r12\t\t\t\tSL-HoppingConfigComm-r12,\n\tue-SelectedResourceConfig-r12\t\t\tSEQUENCE {\n\t\tdata-TF-ResourceConfig-r12\t\t\t\tSL-TF-ResourceConfig-r12,\n\t\ttrpt-Subset-r12\t\t\t\t\t\tSL-TRPT-Subset-r12 \tOPTIONAL\t-- Need OP\n\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOPTIONAL, \t-- Need OR\n\trxParametersNCell-r12\t\t\t\tSEQUENCE {\n\t\ttdd-Config-r12\t\t\t\t\tTDD-Config\t\t\t\t\tOPTIONAL, \t-- Need OP\n\t\tsyncConfigIndex-r12\t\t\tINTEGER (0..15)\n\t} \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOPTIONAL, \t-- Need OR\n\ttxParameters-r12\t\t\t\t\tSEQUENCE {\n\t\tsc-TxParameters-r12\t\t\t\tSL-TxParameters-r12,\n\t\tdataTxParameters-r12\t\t\tSL-TxParameters-r12\n\t} \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOPTIONAL, \t-- Cond Tx\n\t...,\n\t[[\tpriorityList-r13\t\t\t\tSL-PriorityList-r13\t\t\tOPTIONAL \t-- Cond Tx\n\t]]\n\n}\n\nSL-CommResourcePoolV2X-r14 ::=\t\tSEQUENCE {\n\tsl-OffsetIndicator-r14\t\t\t\tSL-OffsetIndicator-r12\t\tOPTIONAL, \t-- Need OR\n\tsl-Subframe-r14\t\t\t\t\t\tSubframeBitmapSL-r14,\n\tadjacencyPSCCH-PSSCH-r14\t\t\tBOOLEAN,\n\tsizeSubchannel-r14\t\t\t\t\tENUMERATED {\n\t\t\t\t\t\t\t\t\t\tn4, n5, n6, n8, n9, n10, n12, n15, n16, n18, n20, n25, n30,\n\t\t\t\t\t\t\t\t\t\tn48, n50, n72, n75, n96, n100, spare13, spare12, spare11,\n\t\t\t\t\t\t\t\t\t\tspare10, spare9, spare8, spare7, spare6, spare5, spare4, \n\t\t\t\t\t\t\t\t\t\tspare3, spare2, spare1},\n\tnumSubchannel-r14\t\t\t\t\tENUMERATED {n1, n3, n5, n8, n10, n15, n20, spare1},\n\tstartRB-Subchannel-r14\t\t\t\tINTEGER (0..99),\n\tstartRB-PSCCH-Pool-r14\t\t\t\tINTEGER (0..99)\t\t\t\tOPTIONAL, \t-- Need OR\n\trxParametersNCell-r14\t\t\t\tSEQUENCE {\n\t\ttdd-Config-r14\t\t\t\t\tTDD-Config\t\t\t\t\tOPTIONAL, \t-- Need OP\n\t\tsyncConfigIndex-r14\t\t\t\tINTEGER (0..15)\n\t} \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOPTIONAL, \t-- Need OR\n\tdataTxParameters-r14\t\t\t\tSL-TxParameters-r12\t\t\tOPTIONAL, \t-- Cond Tx\n\tzoneID-r14\t\t\t\t\t\t\tINTEGER (0..7) \t\t\t\tOPTIONAL, \t-- Need OR\n\tthreshS-RSSI-CBR-r14\t\t\t\t\tINTEGER (0..45)\t\t\t\tOPTIONAL,\t-- Need OR\n\tpoolReportId-r14\t\t\t\t\tSL-V2X-TxPoolReportIdentity-r14\t\tOPTIONAL,\t-- Need OR\n\tcbr-pssch-TxConfigList-r14\t\t\tSL-CBR-PPPP-TxConfigList-r14\tOPTIONAL,\t-- Need OR\n\tresourceSelectionConfigP2X-r14\t\tSL-P2X-ResourceSelectionConfig-r14\tOPTIONAL,\t-- Cond P2X\n\tsyncAllowed-r14\t\t\t\t\t\tSL-SyncAllowed-r14\t\t\t\tOPTIONAL,\t-- Need OR\n\trestrictResourceReservationPeriod-r14\tSL-RestrictResourceReservationPeriodList-r14\tOPTIONAL,\t-- Need OR\n\t...\n}\n\nSL-TRPT-Subset-r12 ::=\t\t\tBIT STRING (SIZE (3..5))\n\nSL-V2X-TxPoolReportIdentity-r14::=\t\tINTEGER (1..maxSL-PoolToMeasure-r14)\n\n-- ASN1STOP\n\n<Text removed here>\n\nConditional presence\tExplanation\nTx\tThe field is mandatory present when included in commTxPoolNormalDedicated, commTxPoolNormalDedicatedExt, commTxPoolNormalCommon, commTxPoolNormalCommonExt, commTxPoolExceptional, sc-CommTxConfig, v2x-CommTxPoolNormalCommon, v2x-CommTxPoolExceptional, v2x-CommTxPoolNormalDedicated, p2x-CommTxPoolNormalCommon or v2x-CommTxPoolNormal and p2x-CommTxPoolNormal in v2x-InterFreqInfoList. Otherwise the field is not present.\nP2X\n\nNEXT CHANGE \n6.3.8\tSidelink information elements\n<Text removed here>\n\u2013\tSL-TxParameters\nThe IE SL-TxParameters identifies a set of parameters configured for sidelink transmission, used for communication, discovery and synchronisation.\nSL-TxParameters information element\n-- ASN1START\n\nSL-TxParameters-r12 ::=\t\t\t\tSEQUENCE\t{\n\talpha-r12\t\t\t\t\t\t\t\tAlpha-r12,\n\tp0-r12\t\t\t\t\t\t\t\t\tP0-SL-r12\n}\n\nP0-SL-r12 ::=\t\t\t\t\t\t\tINTEGER (-126..31)\n\n-- ASN1STOP\n\nSL-TxParameters field descriptions\nalpha\np0\n\nCHANGE END\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCBR measurement should be performed on the concerned frequency.For a SyncRef UE that camps on the serving frequency for V2X sidelink commnucation and uses GNSS for synchronization, it should select the subframes(s) indicated by syncOffsetIndicator corresponding to the serving frequency, but not the frequency that is included in v2x-InterFreqInfoList, to transmit SLSS. However, this procedure is not captured in current specification.The field description of sl-P2X-ConfigDedicated is still in the specification mistakenly; however, IE sl-P2X-ConfigDedicated was already removed.The IE sl-V2X-ConfigDedicated is commonly used by P2X related and non-P2X related V2X sidelink communication.So, it needs to tell the details whether sl-V2X-ConfigDedicated configured is actually used for P2X related or non-P2X related V2X sidelink communication.The description of the following parameters defined in TS 36.213 are missing in the related field description, i.e., ,, ,.\n\n>>> SUMMARY OF CHANGE\nIn 5.5.3.1, CBR measurement on transmission pools is limited to the concerned frequency.In section 5.10.7.3, modify the subframe selection related description to enable a UE, which is interest in using serving frequency for V2X sidelink communication, to select the correct timing to transmit GNSS-based SLSS.In 6.2.2, the field description of sl-P2X-ConfigDedicated is deletedIn 6.3.8, P2X related sidelink communication is added in sl-V2X-ConfigDedicated.In 6.3.8,,, , are added into the field description of the IE SL-TxParameters.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE may perform CBR measurement on an incorrect transmission pool.The UE may select incorrect subframe(s) for its SLSS transmission. Some field descriptions mistakenly exist in the specification. The condition for the configuration of some fields in the SL-CommResourcePool is unclear.Some field descriptions are not completed."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n\n*** Begin of change ****\n4\tConfidentiality of signalling information elements, connectionless data and user information elements on physical connections\n4.1\tGenerality\nIn GSM\u00a002.09, some signalling information elements are considered sensitive and must be protected.\nTo ensure identity confidentiality (see clause 2), the Temporary Subscriber Identity must be transferred in a protected mode at allocation time and at other times when the signalling procedures permit it.\nThe confidentiality of connection less user data requires at least the protection of the message part pertaining to OSI layers 4 and above.\nThe user information confidentiality of user information on physical connections concerns the information transmitted on a traffic channel on the MS-BSS interface (e.g. for speech). It is not an end-to-end confidentiality service.\nThese needs for a protected mode of transmission are fulfilled with the same mechanism where the confidentiality function is a OSI layer 1 function. The scheme described below assumes that the main part of the signalling information elements is transmitted on DCCH (Dedicated Control Channel), and that the CCCH (Common Control Channel) is only used for the allocation of a DCCH.\nFour points have to be specified:\n-\tthe ciphering method;\n-\tthe key setting;\n-\tthe starting of the enciphering and deciphering processes;\n-\tthe synchronization.\n4.2\tThe ciphering method\nThe layer 1 data flow (transmitted on DCCH or TCH) is ciphered by a bit per bit or stream cipher, i.e. the data flow on the radio path is obtained by the bit per bit binary addition of the user data flow and a ciphering bit stream, generated by algorithm A5 using a key determined as specified in subclause 4.3. The key is denoted below by Kc, and is called \"Ciphering Key\".\nFor multislot configurations (e.g. HSCSD) different ciphering bit streams are used on the different timeslots. On timeslot \"n\" a ciphering bit stream, generated by algorithm A5, using a key Kcn is used. Kcn is derived from Kc as follows:\n\tLet BN denote a binary encoding onto 64 bits of the timeslot number \"n\" (range 07). Bit \"i\" of Kcn, Kcn(i), is then calculated as Kc(i) xor (BN<<32(i)) (\"xor\" indicates: \"bit per bit binary addition\" and \"<<32\" indicates: \"32 bit circular shift\"), the number convention being such that the lsb of Kc is xored with the lsb of the shifted BN.\nDeciphering is performed by exactly the same method.\nAlgorithm A5 is specified in annex\u00a0C.\n4.3\tKey setting\nMutual key setting is the procedure that allows the mobile station and the network to agree on the key Kc to use in the ciphering and deciphering algorithms A5.\nA key setting is triggered by the authentication procedure. Key setting may be initiated by the network as often as the network operator wishes.\nKey setting must occur on a DCCH not yet encrypted and as soon as the identity of the mobile subscriber (i.e. TMSI or IMSI) is known by the network.\nThe transmission of Kc to the MS is indirect and uses the authentication RAND value; Kc is derived from RAND by using algorithm A8 and the Subscriber Authentication key Ki, as defined in annex\u00a0C.\nAs a consequence, the procedures for the management of Kc are the authentication procedures described in subclause 3.3.\nThe values Kc are computed together with the SRES values. The security related information (see subclause 3.3.1) consists of RAND, SRES and Kc.\nThe key Kc is stored by the mobile station until it is updated at the next authentication.\nKey setting is schematized in figure 4.1.\n\nFigure 4.1: Key setting\n4.4\tCiphering key sequence number\nThe ciphering key sequence number is a number which is associated with the ciphering key Kc and they are stored together in the mobile station and in the network.\nHowever since it is not directly involved in any security mechanism, it is not addressed in this specification but in GSM\u00a004.08 instead.\n4.5\tStarting of the ciphering and deciphering processes\nThe MS and the BSS must co-ordinate the instants at which the enciphering and deciphering processes start on DCCH and TCH.\nOn DCCH, this procedure takes place under the control of the network some time after the completion of the authentication procedure (if any), or after the key Kc has been made available at the BSS.\nNo information elements for which protection is needed must be sent before the ciphering and deciphering processes are operating.\nThe transition from clear text mode to ciphered mode proceeds as follows: deciphering starts in the BSS, which sends in clear text to the MS a specific message, here called \"Start cipher\". Both the enciphering and deciphering start on the MS side after the message \"Start cipher\" has been correctly received by the MS. Finally, enciphering on the BSS side starts as soon as a frame or a message from the MS has been correctly deciphered at the BSS.\nThe starting of enciphering and deciphering processes is schematized in figure 4.2.\n\nFigure 4.2: Starting of the enciphering and deciphering processes\nWhen a TCH is allocated for user data transmission, the key used is the one set during the preceding DCCH session (Call Set-up). The enciphering and deciphering processes start immediately.\n4.6\tSynchronization\nThe enciphering stream at one end and the deciphering stream at the other end must be synchronized, for the enciphering bit stream and the deciphering bit streams to coincide. The underlying Synchronization scheme is described in annex C.\n4.7\tHandover\nWhen a handover occurs, the necessary information (e.g. key Kc, initialization data) is transmitted within the system infrastructure to enable the communication to proceed from the old BSS to the new one, and the Synchronization procedure is resumed. The key Kc remains unchanged at handover.\n4.8\tNegotiation of A5 algorithm\nNot more then seven versions of the A5 algorithm will be defined.\nWhen an MS wishes to establish a connection with the network, the MS shall indicate to the network which of the seven versions of the A5 algorithm it supports. The network shall not provide service to an MS which indicates that it does not support the ciphering algorithm(s) required by GSM\u00a002.07.\nThe network shall compare its ciphering capabilities and preferences, and any special requirements of the subscription of the MS, with those indicated by the MS and act according to the following rules:\n1)\tIf the MS and the network have no versions of the A5 algorithm in common and the network is not prepared to use an unciphered connection, then the connection shall be released.\n2)\tIf the MS and the network have at least one version of the A5 algorithm in common, then the network shall select one of the mutually acceptable versions of the A5 algorithm for use on that connection.\n3)\tIf the MS and the network have no versions of the A5 algorithm in common and the network is willing to use an unciphered connection, then an unciphered connection shall be used.\n\n\n\n\n*** End of change ****\n*** Next change ****\nD.4\tConfidentiality of user information and signalling between MS and SGSN\nD.4.1\tGenerality\nIn GSM\u00a002.09, some signalling information elements are considered sensitive and must be protected.\nTo ensure identity confidentiality (see clause 2), the new TLLI must be transferred in a protected mode at allocation time.\nThe confidentiality of user information  concerns the information transmitted  on the logical connection between MS and SGSN.\nThese needs for a protected mode of transmission are fulfilled by a ciphering function in the LLC layer. It is not an end-to-end confidentiality service.\nFour points have to be specified:\n-\tthe ciphering method;\n-\tthe key setting;\n-\tthe starting of the enciphering and deciphering processes;\n-\tthe synchronisation.\nD.4.2\tThe ciphering method\nThe LLC layer information flow is ciphered by the algorithm GPRS-A5 as described in GSM\u00a001.61.\nD.4.3\tKey setting\nMutual key setting is the procedure that allows the mobile station and the network to agree on the key GPRS-Kc to use in the ciphering and deciphering algorithms GPRS-A5. This procedure corresponds to the procedure described in subclause 4.3 besides the different confidential subscriber identity. The GPRS-Kc is handled by the SGSN independently from the MSC. If a MS is using both circuit switched and packet switched, two different ciphering keys will be used independently, one (Kc) in the MSC and one (GPRS-Kc) in the SGSN.\nA key setting is triggered by the authentication procedure. Key setting may be initiated by the network as often as the network operator wishes. If an authentication procedure is performed during a data transfer, the new ciphering parameters shall be taken in use immediately at the end of the authentication procedure in both SGSN and MS.\nKey setting may  not be encrypted and shall be performed as soon as the identity of the mobile subscriber (i.e. TLLI or IMSI) is known by the network.\nThe transmission of GPRS-Kc to the MS is indirect and uses the authentication RAND value; GPRS-Kc is derived from RAND by using algorithm A8 and the Subscriber Authentication key Ki, in the same way as defined in annex\u00a0C for Kc.\nAs a consequence, the procedures for the management of GPRS-Kc are the authentication procedures described in subclause D.3.3.\nThe values GPRS-Kc are computed together with the SRES values. The security related information (see subclause\u00a0D.3.3.1) consists of RAND, SRES and GPRS-Kc.\nThe key GPRS-Kc is stored by the mobile station until it is updated at the next authentication.\nKey setting is schematised in figure D.4.1.\n\n\tMS\t\t\t\t\t\t\t\t\tNetwork side\n\n\t\t\t\tRAI and TLLI or IMSI\n\t\t\t\t\t>\n\n\t\t\t\tRAND\n\t\t\t\t<\n\n\tKi\t\t\tRAND\t\t\t\t\t\t\t\t\t\tRAND\t\tKi\nV\t\t  V\t\t\t\t\t\t\t\t\t\t   V\t\t     V\nA8\t\t\t\t\t\t\t\t\tA8\n\n\t\t\tGPRS-Kc\t\t\t\t\t\t\t\t\t\t\t\tGPRS-Kc\n\t\tV\t\t\t\t\t\t\t\t\t\t\t\t\tV\nStore GPRS-Kc\t\t\t\t\t\t\t\t\tStore GPRS-Kc\n\nFigure D.4.1: Key setting\nD.4.4\tCiphering key sequence number\nThe GPRS-CKSN (Ciphering Key Sequence Number) is a number which is associated with each ciphering key GPRS-Kc. The GPRS-CKSN and GPRS-Kc are stored together in the mobile station and in the network. It permits the consistency check of the keys stored in the MS and in the network. Two independent pairs, Kc and CKSN (for circuit switched), and GPRS-Kc and GPRS-CKSN (for packet switched) may be stored in the MS simultaneously.\nHowever since it is not directly involved in any security mechanism, it is not addressed in this specification but in GSM\u00a004.08 instead.\nD.4.5\tStarting of the ciphering and deciphering processes\nThe MS and the SGSN must co-ordinate the instants at which the ciphering and deciphering processes start. The authentication procedure governs the start of ciphering. The SGSN indicates if ciphering shall be used or not in the Authentication and Ciphering Request message. If ciphering is used, the MS starts ciphering after sending the Authentication and Ciphering Response message. The SGSN starts ciphering when a valid Authentication and Ciphering Response message is received from the MS.\nUpon GPRS Attach, if ciphering is to be used, an Authentication and Ciphering Request message shall be sent to the MS to start ciphering.\nIf the GPRS-CKSN stored in the network does not match the GPRS-CKSN received from the MS in the Attach Request message, then the network should authenticate the MS.\nAs an option, the network may decide to continue ciphering without authentication after receiving a Routing Area Update Request message with a valid GPRS-CKSN. Both the MS and the network shall use the latest ciphering parameters. The MS starts ciphering after a receiving a valid ciphered Routing Area Update Accept message from the network. The SGSN starts ciphering when sending the ciphered Routing Area Update Accept message to the MS.\nUpon delivery of the Authentication and Ciphering Response message or the Routing Area Update Accept message, the GPRS Mobility and Management entity in both SGSN and MS shall be aware if ciphering has started or not. LLC provides the capability to send both ciphered and unciphered PDUs. The synchronisation of ciphering at LLC frames level is done by a bit in the LLC header indicating if the frame is ciphered or not. Only a few identified signalling messages (e.g., Routing Area Update Request message) described in GSM\u00a004.08 may be sent unciphered, any other frames sent unciphered shall be deleted. Once the encryption has been started, neither the MS nor the network shall go to an unciphered session.\nD.4.6\tSynchronisation\nThe enciphering stream at one end and the deciphering stream at the other end must be synchronised, for the enciphering bit stream and the deciphering bit streams to coincide. Synchronisation is guaranteed by driving Algorithm GPRS-A5 by an explicit variable INPUT per established LLC and direction.\nThese initial INPUT values shall not be identical for the different LLC link. The initial INPUT value shall be determined by the network. It may be identical for uplink and downlink value because the direction is given to the ciphering algorithm as described in GSM\u00a001.61 and illustrated on the figure D.4.2. In a given direction, the INPUT value shall be unique for each frame. \nThe calculation of the INPUT value is described in GSM. The use of the INPUT value is described in GSM\u00a001.61 and illustrated on the figure D.4.2.\n\nFigure D.4.2: Use of the INPUT parameter\nD.4.7\tInter SGSN routing area update\nWhen an Inter SGSN routing area update occurs, the necessary information (e.g. key Kc, INPUT  parameters) is transmitted within the system infrastructure to enable the communication to proceed from the old SGSN to the new one, and the Synchronisation procedure is resumed. The key Kc may remains unchanged at Inter SGSN routing area update. \nD.4.8\tNegotiation of GPRS-A5 algorithm\nNot more than seven versions of the GPRS-A5 algorithm will be defined.\nWhen an MS wishes to establish a connection with the network, the MS shall indicate to the network which version(s) of the GPRS-A5 algorithm it supports. The negotiation of GPRS-A5 algorithm happens during the authentication procedure.\nThe network may renegotiate the version of the GPRS-A5 algorithm in use at inter SGSN routing area update by performing an authentication procedure.\nThe network shall compare its ciphering capabilities and preferences, and any special requirements of the subscription of the MS, with those indicated by the MS and may take one of the following decisions:\n1)\tIf the MS and the network have no versions of the GPRS A5 algorithm in common and the network is not prepared to use an unciphered connections, then the connection is released.\n2)\tIf the MS and the network have at least one version of the GPRS A5 algorithm in common, then the network shall select one of the mutually acceptable versions of the GPRS A5 algorithms for use on that connection.\n3)\tIf the MS and the network have no versions of the GPRS A5 algorithm in common and the network is willing to use an unciphered version, then an unciphered connection shall be used.\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSince the publication of the Barkan-Biham-Keller attack, the A5/2 algorithm is not considered safe anymore. Therefore it should not be supported in Rel-6 mobile stations. It is also considered appropriate to mandate A5/3 support in Rel-6 mobile stations and to mandate GEA2 and GEA3 support. The mandatory support of other algorithms that are currently implemented in mobile stations is made more explicit. It is also specified that other undefined A5 or GEA algorithms should not be supported since these could open up opportunities for attack.\n\n>>> SUMMARY OF CHANGE\nClarify the support of A5 and GEA algorithms within mobile stations.\n\n>>> CONSEQUENCES IF NOT REVISED\nAttacks which exploit A5/2 weaknesses will persist for Rel-6 UEs. Opportunities are missed to take advantage of new algorithms implemented in networks."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n** start of changes **\nO.5.1\tTLS Certificate\nX.509 digital certificates [35] shall be used for authentication in TLS. All X.509 certificates shall be signed by a trusted party. \n\nThe certificates shall be profiled as follows: \nEditor\u2019s Note: X.509 certificate profiles are discussed in other technical specifications (e.g., 33.222, 33.234 and 33.310). Alignment of these and the text in this clause is ffs. The IETF is about to publish two RFCs related to X.509 which would have impact on the X.509 profiling. Therefore it has been decided to wait for the publication of the RFCs before aligning the X.509 profiles in 3GPP specifications.\nTLS Server Certificates\nSubject Name Form\tC=<Country>\nO=<Company>\nCN=<FQDN>\tAdditional fields may be present in the subject name.\tFQDN is the server\u2019s fully qualified domain name (e.g., server.example.com). Only a single FQDN is allowed in the CN field.\nIntended Usage\tThese certificates are used to authenticate TLS handshake exchanges (and encrypt when using RSA key exchange). \nValidity Period\tSet by operator policy\nModulus Length\t1024, 1536, 2048\nExtensions\tKeyUsage[critical](digitalSignature, keyEncipherment)\textendedKeyUsage (id-kp-serverAuth, id-kp-clientAuth)\tauthorityKeyIdentifier (keyIdentifier=<subjectKeyIdentifier value from CA cert>)\n\n** end of changes **\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSHA-1 is vulnerable to collision attacks and should not be recommended for use when generating new CRLs and OCSP responses.RSA keys shorter than 2048 bits are allowed.\n\n>>> SUMMARY OF CHANGE\nThe use of SHA-1 is strongly discouraged for newly created CRLs and OCSP responses.The use of key lengths less than 2048 bit is strongly discouraged for newly created certificates and CRLs.\n\n>>> CONSEQUENCES IF NOT REVISED\nAttackers could exploit SHA-1 weaknesses to generate fake CRLs and OCSP responses in order to launch attacks.Attackers could exploit short RSA keys spoof certificates and CRLs."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***First Change***\nAnnex C (normative):\nProtection schemes for concealing the subscription permanent identifier \nC.1 \tIntroduction \nThe present Annex specifies the protection schemes for concealing the subscription permanent identifier. \n Annex C.3 for example). Otherwise, this type information will be included as a part of plaintext.\n\n\n\n\n\n\n***End of First Change***\n***Second Change***\nC.3.4\tECIES profiles\nC.3.4.0\tGeneral\nUnless otherwise stated, the ECIES profiles follow the terminology and processing specified in SECG version 2 [29] and [30]. The profiles shall use \"named curves\" over prime fields.\nProfile A shall use its own standardized processing for key generation (section 6 of RFC 7748 [46]) and shared secret calculation (section 5 of RFC 7748 [46]). The Diffie-Hellman primitive X25519 (section 5 of RFC 7748 [46]) takes two random octet strings as input, decodes them as scalar and coordinate, performs multiplication, and encodes the result as an octet string. The shared secret output octet string from X25519 shall be used as the input Z in the ECIES KDF (section 3.6.1 of [29]).\nProfile B shall use point compression to save overhead and shall use the Elliptic Curve Cofactor Diffie-Hellman Primitive (section 3.3.2 of [29]) to enable future addition of profiles with cofactor h \u2260 1. For curves with cofactor h = 1 the two primitives (section 3.3.1 and 3.3.2 of [29]) are equal.\n (in this instance, \u201cSUPI\u201d).\nThe profiles shall not use backwards compatibility mode (therefore are not compatible with version 1 of SECG).\nC.3.4.1\tProfile <A>\nThe ME and SIDF shall implement this profile. The ECIES parameters for this profile shall be the following:\n-\tEC domain parameters\t\t\t\t\t\t\t: Curve25519 [46]\n-\tEC Diffie-Hellman primitive\t\t\t\t\t: X25519 [46]\n-\tpoint compression\t\t\t\t\t\t\t\t: N/A\n-\tKDF\t\t\t\t\t\t\t\t\t\t\t\t: ANSI-X9.63-KDF [29]\n-\tHash\t\t\t\t\t\t\t\t\t\t\t\t: SHA-256\n-\tSharedInfo1\t\t\t\t\t\t\t\t\t\t:  (the ephemeral public key octet string \u2013 see [29] section 5.1.3)\n-\tMAC\t\t\t\t\t\t\t\t\t\t\t\t: HMAC\u2013SHA-256\n-\tmackeylen\t\t\t\t\t\t\t\t\t\t: 256\n-\tmaclen\t\t\t\t\t\t\t\t\t\t\t: 64\n-\tSharedInfo2\t\t\t\t\t\t\t\t\t\t: the empty string\n-\tENC\t\t\t\t\t\t\t\t\t\t\t\t: AES\u2013128 in CTR mode\n-\tenckeylen\t\t\t\t\t\t\t\t\t\t\t: 128\n-\tbackwards compatibility mode\t\t\t\t\t: false\nThe scheme properties for this ECIES profile <A> shall be the following: \n-\tscheme identifier\t\t\t\t\t\t\t\t\t: <TBD>\n-\tsize of scheme-output\t\t\t\t: <TBD> bits\nNOTE:\tCare should be taken when using unique schemes for small groups of users, as this may impact the effectiveness of the privacy scheme for these users. \nEditor's Note: It is FFS to contact other WGs (like CT1) or wait for their progress before finalizing the identifier, and size of the null-scheme. The maximum size should cover both the IMSI and NAI formats.\nC.3.4.3\tProfile <B>\nThe ME and SIDF shall implement this profile. The ECIES parameters for this profile shall be the following:\n-\tEC domain parameters\t\t\t\t\t\t\t: secp256r1 [30]\n-\tEC Diffie-Hellman primitive\t\t\t\t\t: Elliptic Curve Cofactor Diffie-Hellman Primitive [29]\n-\tpoint compression\t\t\t\t\t\t\t\t: true\n-\tKDF\t\t\t\t\t\t\t\t\t\t\t\t: ANSI-X9.63-KDF [29]\n-\tHash\t\t\t\t\t\t\t\t\t\t\t\t: SHA-256\n-\tSharedInfo1\t\t\t\t\t\t\t\t\t\t:  (the ephemeral public key octet string \u2013 see [29] section 5.1.3)\n-\tMAC\t\t\t\t\t\t\t\t\t\t\t\t: HMAC\u2013SHA-256\n-\tmackeylen\t\t\t\t\t\t\t\t\t\t: 256\n-\tmaclen\t\t\t\t\t\t\t\t\t\t\t: 64\n-\tSharedInfo2\t\t\t\t\t\t\t\t\t\t: the empty string\n-\tENC\t\t\t\t\t\t\t\t\t\t\t\t: AES\u2013128 in CTR mode\n-\tenckeylen\t\t\t\t\t\t\t\t\t\t\t: 128\n-\tbackwards compatibility mode\t\t\t\t\t: false\n\nEditor's Note: As stated in LS S3-172505 from ETSI SAGE, a rogue PLMN may sell a SUCI decryption service to parties operating false base stations in other networks. Moving the SUPI reveal into the 5G-ACA message mitigates this attack. If the SUPI reveal is not moved, the attack needs to be mitigated in other ways, e.g. by including the PLMN id of the serving network in SharedInfo2. It if ffs if a binding to PLMN id causes other problems.\n\n\n***End of Second Change***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTo improve the use of encryption shemes, use type information is added to the parameters of the SUPI encryption scheme.\n\n>>> SUMMARY OF CHANGE\n\u201cSUPI\u201d type information is added to SUCI construnction scheme in Annex C\n\n>>> CONSEQUENCES IF NOT REVISED\nSUCI construction will not follow the good use practice of cryptographic schemes, which may be prone to faults and attacks."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n5.4.3\tSecurity mode control procedure\n5.4.3.1\tGeneral\nThe purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.\nFurthermore, the network may also initiate a SECURITY MODE COMMAND \nin order to change the NAS security algorithms for a current EPS security context already in use.\n\nFor restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP\u00a0TS\u00a033.401\u00a0[19], subclause\u00a07.2.10. \n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCRs to TS 33.401 (CRs #0509 and #0510) were submitted to SA3#69 (5-9 Nov 2012), but postponed in order to give CT1 and RAN2 the chance to comment. C1124636 was the corresponding reply LS from CT1#81 to SA3. The CRs to TS 33.401 were re-submitted to SA3#70 (21-25 Jan 2013) as S3-130145 (#509) and S3-130146 (#510). While CR#509 is only a clarification of existing procedures CR#510 introduces a new variant of KeNB re-keying. This new variant includes running a NAS Security Mode procedure for the sole purpose of obtaining a fresh value for the parameter \u2018uplink NAS COUNT used in the latest NAS Security Mode Complete message\u2019 (i.e. the NAS Security Mode procedure does not change KASME nor NAS algorithms). The reason for this addition is enabling a KeNB re-keying without a prior run of EPS AKA, saving the MME one roundtrip each with the UE and the HSS in this way. This addition needs to be reflected in TS 24.301.\n\n>>> SUMMARY OF CHANGE\nAdd a corresponding paragraph to clause 5.4.3.1 i.e. add a new trigger for NAS SMC procedure.\n\n>>> CONSEQUENCES IF NOT REVISED\nNot in line with CR 0508 and 0510 to TS 33.401 for Rel-12. It was argued that one could leave KeNB re-keying without AKA to MME implementation as no other entity is affected. However, it is easy to get security procedures wrong and forget e.g. the need of an extra NAS SMC run, which would lead to a security vulnerability due to lack of key freshness."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nNext change\n\n4.3.17.4\tUsage of low priority and MTC indicators\nA subscriber can by agreement with its operator be required to use UEs that indicate low priority and/or MTC when accessing the network.\nNOTE:\tAny MTC application using a UE with a low priority access subscription need to be designed to be tolerant to delays when accessing the network. Delays may e.g. occur during congestion and overload situations.\nA low priority indicator and/or an MTC indicator are set in an OMA Device Management MO in the UE (e.g. at manufacturing or when accessing the network).\nWhen requesting access to the mobile network a UE, configured to use low priority and/or MTC, indicates low priority and/or MTC to the RAN node in the radio protocol and to the SGSN/MME node in the non-access stratum. For PDN connection establishment requests the SGSN/MME includes the low priority and/or MTC indicators in the request message to the SGW/PGW. The low priority and/or MTC indicators are stored in MM/EPS bearer/PGW Contexts and is passed as part of these contexts to other core network nodes in mobility management procedures.\nAn SGSN/MME may in a congestion or overload situation selectively reject Downlink Data Notifications received from SGW for PDN connections that has been established for UEs using the low priority and/or MTC indication.\n\nEnd of changes\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nUnclear handling of the indicators in session management procedures\n\n>>> SUMMARY OF CHANGE\nClarification that the indicators orginiate from the UE and not from the MME/SGSN for session management procedures. Clarification that all session management procedures shall use the indicators and not only the PDN connection establishment procedure. Clarification how EMM procedures pass indicators between CN nodes.\n\n>>> CONSEQUENCES IF NOT REVISED\nAn efficient congestion control may not be possible when a UE accesses the network for session management purposes. For maximum robustness all access requests that may consume resources in the network shall be subject to congestion and overload control."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n*** Next change ***\n10.3.2.2\tBroadcast group call control state machine\nThe figure\u00a010.3.2.2-1 gives an overview of the main states and transitions on the UE for broadcast group call control.\n\nFigure\u00a010.3.2.2-1: Broadcast group call control state machine\n\n*** Next change ***\n\n10.3.2.4.1\tUser initiating a broadcast group call\nWhen in the \"B1: start-stop\" state, upon the indication from MCPTT user to initiate the broadcast group call, the MCPTT client:\n1)\tshall generate an SDP body as specified in subclause\u00a010.2.1.1.2 and store it as the SDP body of the call;\n2)\tshall generate a random number with uniform distribution between 0 and 65535 and store it as the call identifier of the call;\n3)\tshall store own MCPTT user ID as the originating MCPTT user ID of the call;\n4)\tshall store \"BROADCAST GROUP CALL\" as the current call type;\n5)\tshall generate a GROUP CALL BROADCAST message as specified in subclause\u00a015.1.20. In the GROUP CALL BROADCAST message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Call type IE to the stored current call type;\nc)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call;\nd)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\ne)\tshall set the SDP IE to the stored SDP body of the call;\n6)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network broadcast callas described in 3GPP\u00a0TS\u00a024.383\u00a0[45];\n7)\tshall start floor control as originating floor participant as described specified in subclause\u00a07.2 in 3GPP\u00a0TS\u00a024.380\u00a0[5];\n8)\tshall send the GROUP CALL BROADCAST message as specified in subclause\u00a010.2.1.1.1;\n9)\tshall establish a media session based on the stored SDP body of the call;\n10)\tshall start timer TFB2 (broadcast retransmission); \nand\n11)\tshall enter the \"B2: in-progress broadcast group call\" state.\n\n*** Next change ***\n\n10.3.2.4.2\tTerminating UE receiving a GROUP CALL BROADCAST message when not participating in the in-progress broadcast group call\nWhen in the \"B1: start-stop\" state, upon receiving a GROUP CALL BROADCAST message with the Call identifier IE not matching any in-progress broadcast group call, the MCPTT client:\n1)\tshall store the value of the Call identifier IE of the GROUP CALL BROADCAST message as the call identifier of the call;\n2)\tshall store the value of the Call type IE of the GROUP CALL BROADCAST message as the received current call type;\n3)\tshall store the value of the SDP IE of the GROUP CALL BROADCAST message as the SDP body of the call;\n4)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL BROADCAST message as the originating MCPTT user ID of the call;\n5)\tshall store the value of the MCPTT group ID IE of the GROUP CALL BROADCAST message as the MCPTT group ID of the call;\n6)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is required upon a terminating call request reception:\ni)\tshall start timer TFB3 (waiting for the user); \nand\nii)\tshall enter the \"B3: pending user action\" state; and\n7)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is not required upon a terminating call request reception:\ni)\tshall establish a media session based on the stored SDP body of the call;\nii) shall start floor control as terminating floor participant as specified in subclause\u00a07.2 in 3GPP\u00a0TS\u00a024.380\u00a0[5];\niii)\tshall start timer TFB1 (max duration); and\niv)\tshall enter the \"B2: in-progress broadcast group call\" state.\n\n*** Next change ***\n\n10.3.2.4.7\tOriginating user releasing the call\nWhen in the \"B2: in-progress broadcast group call\" state, upon an indication from the originating MCPTT user to release the in-progress broadcast group call, the MCPTT client:\n1)\tshall release the media session;\n2)\tshall generate a GROUP CALL BROADCAST END message as specified in subclause\u00a015.1.21. In the GROUP CALL BROADCAST END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call; and\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\n3)\tshall send the GROUP CALL BROADCAST END message as specified in subclause\u00a010.2.1.1.1;\n4)\tshall stop timer TFB2 (broadcast retransmission);\n\n5)\tshall clear the stored call identifier;\n6)\tshall stop floor control; and\n7)\tshall enter the \"B1: start-stop\" state.\n\n*** Next change ***\n\n10.3.2.4.11\tReleasing the call\nWhen in the \"B2: in-progress broadcast group call\" state or \"B4: ignoring same call ID\" state, upon expiry of timer TFB1 (max duration) the MCPTT client:\n1)\tshall release the media session;\n2)\tshall clear the stored call identifier;\n3)\tshall stop floor control, if running; and\n4)\tshall enter the \"B1: start-stop\" state.\n\n\n\n\n\n\n\n\n\n\n\n\n*** Next change ***\n\n\n\n\n\n\n\n*** Next change ***\n\n\n\n\n\n\n\n\n*** End of changes ***\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe Broadcast Group Call control procedures and state machine do not cover all possible receptions and transmissions of MONP messages; starting, stopping, and expiry of timers; and indications from the MCPTT user. This includes the fact that there are no error handling procedures defined.  There is no maximum duration specified for the originator of the Broadcast group call. There is no procedure (error handling or otherwise) for the periodic GROUP CALL BROADCAST message received while in the B3 state.  There is no procedure (error handling or otherwise) for the GROUP CALL BROADCAST END message received while in the B3 state.\n\n>>> SUMMARY OF CHANGE\nFigure 10.3.2.2.-1 Add transition from B3 to B1 to cover R:GROUP CALL BROADCAST END; and remove extraneous \u201cOR\u201d from transition from B3 to B4;Add new clause for transition B3 to B1 on receipt of GROUP CALL BROADCAST END message;Add a maximum duration timer (TFB1) for the orignating user initiating a call;Added conditions when the maximum duration (Expiry TFB1) is reached as to whether it is the originating UE or terminating UE; Added actions for originating user when releasing the call; andAdd error handling procedures (to cover Rx of GROUP CALL BROADCAST message in B3).\n\n>>> CONSEQUENCES IF NOT REVISED\nA broadcast group call can last indefinitely (i.e., no maximum duration enforcement). Since there is no call start time IE present in the GROUP CALL BROADCAST message (like in the GROUP CALL ANNOUNCEMENT message) the receiver must always (re)start its timer TFB1 because it does not know whether it is the first, nth, or last GROUP CALL BROADCAST message. Thus the time that the resources for a Broadcast Group Call will be sum of the duration of timer TFB1 + the duration of the actual call. Potentially twice TFB1 (or 600 seconds or 1200 seconds).While in state B3 the reception of a GROUP CALL BROADCAST END message will not terminate the broadcast group call so when the user does respond, there is no longer a call, thus ensuring that the user will stay in state B2 or B4 for the entire duration of TFB1 (maximum duration). While in state B3 the reception of a GROUP CALL BROADCAST message is not defined; however, it is highly likely that this will occur since TFB2\u2019s default is 3 seconds and the user is permitted to respond in 60 seconds. Thus a potential of 19 GROUP CALL BROADCAST messages being received while waiting for user to respond."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of Change\n4.2\tNaming and Addressing\nThe UE shall use a special emergency Public User Identifier in the emergency registration request. The implicit registration set of the emergency Public User Identifier shall contain an associated Tel URI. The format is defined in TS\u00a023.003\u00a0[21].\n\nNext Change\n6.1\tUE\n-\tShould be able to detect an emergency session establishment request.\n-\tUse a special emergency Public User Identifier in the IMS emergency registration request.\n-\tThe UE may perform an IMS emergency session establishment without prior emergency registration when already IMS registered and it is in home network (e.g. including IP-CANs where roaming outside the home network is not supported).\n-\tOtherwise, the UE shall perform an IMS emergency registration.\n-\tInclude an emergency service indication in the emergency session request.\n-\tInclude an equipment identifier in the request to establish an emergency session for \"anonymous user\".\nNOTE:\t\"Anonymous user\" in this context is the person who does not have sufficient credential for IMS registration. No Stage 3 work is expected as the anonymous user detection already existed today.\n-\tInclude identity information for the IP-CAN if available (e.g. MCC-MNC or an equivalent)\nNOTE:\tUE provided IP-CAN identity information will not be completely reliable and hence a mechanism based on network provision (e.g. using PCC) may be needed in a later version of this specification.\n-\tAttempt the emergency call in CS domain, if capable.\n-\tHandle a 380 (Alternative Service) response with the type set to \"emergency\" as a result of non UE detectable emergency attempt.\n-\tHandle a response with an indication, IMS emergency registration required as a result of emergency session establishment attempt.\n-\tOther general requirements of UE shall be referred to the general requirements of emergency calls in TS\u00a022.101\u00a0[8].\nThe UE initiates the emergency session establishment request, and for the purpose of processing the request properly in the network the following specific information is supplied in the request message.\n-\tEmergency session indication.\n-\tEmergency Public User Identifier if an IMS emergency registration is performed. If not, any registered Public User Identifier is used.\n-\tOptionally, type of emergency service. It could be implied in the above emergency session indication.\n-\tUE's location information, if available.\n-\tThe Tel URI associated to the emergency Public User Identifier, if available.\n\nNext Change\n7.1\tHigh Level Procedures for IMS Emergency Services\n7.1.1\tUE Detectable Emergency Session\nThe following flow contains a high level description of the emergency service procedures performed when the UE can detect the emergency session is being requested.\n\nFigure 7.1: Terminal Detected Emergency Calls\nThe following steps are performed:\n1.\tThe UE detects the request for the establishment of an emergency session. Step\u00a02 to 6 may be skipped based on the conditions specified in clause\u00a06.1.\n2.\tIn the case that the UE has insufficient resources or capabilities to establish an emergency call due to other ongoing sessions then the UE should terminate the ongoing communication and release reserved bearer resources\n3.\tIn the case that bearer registration is required and has not been performed, the UE shall perform bearer registration to the IP-CAN. If the UE is already bearer registered, then the bearer registration procedures are not required to be performed.\nNOTE 1:\tDepending on the IP-CAN, the UE may be assigned an IP address at this stage.\n4.\tIn the case that bearer resources for the transport of the IMS related signalling are required to be reserved in the IP-CAN, the UE shall reserve the resources in the IP-CAN.\nIf the IP-CAN does not provide an IP address to the UE in step 3, then the IP-CAN shall allocate an IP address to the UE during the bearer resource request procedures.\n5.\tUE performs a PCSCF discovery procedure, where the UE discovers a PCSCF in the local network suitable for use in emergency sessions.\nNOTE 2:\tThe exact means for the PCSCF discovery is dependant upon the IP-CAN.\n6.\tIf the UE has sufficient credentials to authenticate with the IMS network, it shall initiate an IMS emergency registration by providing the IP address obtained at step 3 or step 4 to the PCSCF selected at step 5. The IP address used for signalling purposes is allocated in association with step 3 or step 4. The IMS registration request shall include an Emergency Public User Identity. The implicit registration set of the emergency Public User Identifier shall contain an associated Tel URI that is used to call back the user from the PSTN.\n\tThe SCSCF may set the proposed registration expiration according to the local policy of the serving system and regulation. The subsequent registration flows are like any other registration.\n\tIf the UE does not have sufficient credentials to authenticate with the IMS network, it shall not initiate an IMS emergency registration request, but instead immediately establish an emergency session towards the PCSCF as described in step 7.\n7.\tIf IMS emergency registration is performed, the UE shall initiate the IMS emergency session establishment using the IMS session establishment procedures containing an emergency session indication and emergency Public User Identifiers. Otherwise, the UE shall initiate the IMS emergency session establishment using the IMS session establishment procedures containing an emergency session indication and any registered Public User Identifier.\nWhether the procedures are activated individually by the UE or some of them are performed automatically depends on the implementation of the terminal and on the UE's configuration. For instance, the multimedia application in the UE could start the application level registration and steps 2-4 would have to be executed in response to support the operation initiated by the application. Interaction with the UE may happen during these steps.\n\n End Changes\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the UE needs to register with an emergency public user identity (E-IMPU), but does not have an ISIM, the E-IMPU is created from a temporary public user identity.  From TS 23.203:The emergency public user identity shall be derived from a public user identity as follows: UE selects any public user identity that is a SIP URI from ISIM. If the UE does not have ISIM, UE derives a temporary public user identity from IMSI as described in clause 13.4.  UE adds \"sos.\" to the beginning of the domain part of the selected public user identity.  For example if the SIP URI for the selected public user identity is \"sip:user@domain\", the corresponding emergency public user identity is \"sip:user@sos.domain\"TS 23.228 srongly recommends temporary public user identities to be barred and if so, not to be used for public usage or any purpose other than registration (see below).  Therefore, E-IMPUs that are derived from temporary public user identies should have the same treatment.  The associated E-IMPU IRS should have public user identities that can be used publicly and for other IMS emergency call session activities.TS 23.228 section E.3.1Deriving IMS identifiers from the USIM states that the temporary public user identity:shall be derived from the USIM's IMSI, and shall be used in SIP registration proceduresIt is strongly recommended that the Temporary Public User Identity is set to barred for SIP non-registration procedures. The following applies if the Temporary Public User Identity is barred:shall not be displayed to the user and shall not be used for public usage such as displaying on a business card.shall only be used during the SIP initial registration, re-registration and mobile initiated de-registration procedures.the implicitly registered public user identities shall be used for session handling, in non-registration SIP messages and may be used at subsequent SIP registration procedures.shall only be available to the CSCF and HSS nodes.When a Temporary Public Identity has been used to register an IMS user, the implicit registration will ensure that the UE, PCSCF & SCSCF have public user Identity(s) for all IMS procedures after the initial registration has been completed.\n\n>>> SUMMARY OF CHANGE\nHandle E-IMPUs derived from a temporary public user identity per TS 23.228, allowing the E-IMPU to be barred and using other public identities in the IRS for the emergency session.\n\n>>> CONSEQUENCES IF NOT REVISED\nInteraction of E-IMPU derived from a temporary public user identity would not be clearly specified.  E-IMPUs that are derived from a temporary public user identity may be treated as any other public user identity which would be inconsistent with TS 23.228 procedures.  This may introduce security concerns by allowing the IMSI to be exposed in public domains."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n****** FIRST CHANGE ******\n7A.1.A\tDecryption for IMS Media Plane Security\nThis clause describes how the TSP can meet the national requirements in Clause 5.1.2 of TS 33.106 [7] to deliver intercepted communications decrypted when the TSP uses [25] IMS Media Plane Security options. If an ICE, in TSP IMS network using Security options [25], allows interception of Content of Communication in clear then this clause does not apply. \nIf Session Description Protocol (SDP) Security Descriptions for Media Streams (SDES) is used, the DF2 shall identify the SDES keys from the SDP offer and SDP answer messages and provide the DF3 with the necessary SDES related parameters.  In this case, the DF3 shall perform the decryption prior to delivery to the LEMF.  The interface between the DF2 and DF3 to support the transfer of session keys is outside the scope of this specification. \nWhen SDES is used in end-to-access edge mode, the P-CSCF shall intercept SDES keys from SDP messages and shall deliver them to the DF2.\nIf a Key Management Service (KMS) and Multimedia Internet KEYing ticket (MIKEY-TICKET) is used, the TSP may use the mechanism as defined in Clause 7A.7.1, which results in the DF2 receiving the sessions keys needed to decrypt the intercepted communications.  Clause 7A.7.1 defines that the DF2 delivers the keys to the LEMF as IRI in order for the LEMF to decrypt the intercepted traffic.  \nIf the network is to decrypt the content of communications prior to delivery to the LEMF via HI3, the DF2 shall provide the DF3 with the sessions keys as defined in Clause 7A.7.1 instead of to the LEMF.  In this case, the DF3 shall perform the decryption prior to delivery to the LEMF.  The interface between the DF2 and DF3 to support the transfer of session keys is outside the scope of this specification.\n\n****** END of FIRST CHANGE ******\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe TS 33.107 as written now can be interpreted to mean that encryption keys are deliverd to the LEMF even if the intercepted CC is delivered in a decrypted form. Delivering the encryption keys in such case can have bad consequences at the LEMF. A clarification to the requirement is proposed.\n\n>>> SUMMARY OF CHANGE\nA clarifying sentence is added to state that the encryption keys shall not be sent to the LEMF when the CC is delivered in a decrypted form.\n\n>>> CONSEQUENCES IF NOT REVISED\nDelivery of encryption keys when the CC is delivered in a decrypted form can lead to an incorrect handling of received CC at the LEMF."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********First change**********\n\n6\tProtocol data units, formats and parameters (tabular & ASN.1)\n6.1\tGeneral\nThe contents of each RRC message is specified in sub-clause 6.2 using ASN.1 to specify the message syntax and using tables when needed to provide further detailed information about the fields specified in the message syntax. The syntax of the information elements that are defined as stand-alone abstract types is further specified in a similar manner in sub-clause 6.3.\nThe need for fields to be present in a message or an abstract type, i.e., the ASN.1 fields that are specified as OPTIONAL in the abstract notation (ASN.1), is specified by means of comment text tags attached to the OPTIONAL statement in the abstract syntax. All comment text tags are available for use in the downlink direction only. The meaning of each tag is specified in table 6.1-1.\nTable 6.1-1: Meaning of abbreviations used to specify the need for fields to be present\nAbbreviation\tMeaning\nCond conditionTag\t(Used in downlink only)\tConditionally present\tA field for which the need is specified by means of conditions. For each conditionTag, the need is specified in a tabular form following the ASN.1 segment. In case, according to the conditions, a field is not present, the UE takes no action and where applicable shall continue to use the existing value (and/ or the associated functionality) unless explicitly stated otherwise (e.g. in the conditional presence table or in the description of the field itself).\nNeed OP\t(Used in downlink only)\tOptionally present\tA field that is optional to signal. For downlink messages, the UE is not required to take any special action on absence of the field beyond what is specified in the procedural text or the field description table following the ASN.1 segment. The UE behaviour on absence should be captured either in the procedural text or in the field description.\nNeed ON\t(Used in downlink only)\tOptionally present, No action\tA field that is optional to signal. If the message is received by the UE, and in case the field is absent, the UE takes no action and where applicable shall continue to use the existing value (and/ or the associated functionality).\nNeed OR\t(Used in downlink only)\tOptionally present, Release\tA field that is optional to signal. If the message is received by the UE, and in case the field is absent, the UE shall discontinue/ stop using/ delete any existing value (and/ or the associated functionality).\n\nAny field with Need ON in system information shall be interpreted as Need OR.\nNeed codes may not be specified for a parent extension field/ extension group, used in downlink, which includes one or more child extension fields. Upon absence of such a parent extension field/ extension group, the UE shall:\n-\tFor each individual child extension field, including extensions that are mandatory to include in the optional group, act in accordance with the need code that is defined for the extension;\n-\tApply this behaviour not only for child extension fields included directly within the optional parent extension field/ extension group, but also for extension fields defined at further nesting levels as long as for none of the fields in-between the concerned extension field and the parent extension field a need code is specified;\nNOTE 1:\tThe above applies for groups of non critical extensions using double brackets (referred to as extension groups), as well as non-critical extensions at the end of a message or at the end of a structure contained in a BIT STRING or OCTET STRING (referred to as parent extension fields).\nNeed codes, conditions and ASN.1 defaults specified for a particular (child) field only apply in case the (parent) field including the particular field is present. This rule does not apply for optional parent extension fields/ extension groups without need codes,\nNOTE 2:\tThe previous rule implies that E-UTRAN has to include such a parent extension field to release a child field that is either:\n-\tOptional with need OR, or\n-\tConditional while the UE releases the child field when absent.\nThe handling of need codes as specified in the previous is illustrated by means of an example, as shown in the following ASN.1.\n-- /example/ ASN1START\n\nRRCMessage-r8-IEs ::= \t\t\t\t\tSEQUENCE {\n\tfield1\t\t\t\t\t\t\t\t\tInformationElement1,\n\tfield2\t\t\t\t\t\t\t\t\tInformationElement2\t\t\t\tOPTIONAL,\t-- Need ON\n\tnonCriticalExtension\t\t\t\t\tRRCMessage-v8a0-IEs\t\t\t\tOPTIONAL\n}\n\nRRCMessage-v8a0-IEs ::=\t\t\t\t\tSEQUENCE {\n\tfield3\t\t\t\t\t\t\t\t\tInformationElement3\t\t\t\tOPTIONAL,\t-- Need ON\n\tnonCriticalExtension\t\t\t\t\tRRCMessage-v940-IEs\t\t\t\tOPTIONAL\n}\n\nRRCMessage-v940-IEs ::=\t\t\t\t\tSEQUENCE {\n\tfield4\t\t\t\t\t\t\t\t\tInformationElement4\t\t\t\tOPTIONAL,\t-- Need OR\n\tnonCriticalExtension\t\t\t\t\tSEQUENCE {}\t\t\t\t\t\tOPTIONAL\n}\n\nInformationElement1 ::=\t\t\tSEQUENCE {\n\tfield11\t\t\t\t\t\t\t\tInformationElement11\t\t\t\tOPTIONAL,\t-- Need ON\n\tfield12\t\t\t\t\t\t\t\tInformationElement12\t\t\t\tOPTIONAL,\t-- Need OR\n\t...,\n\t[[\tfield13\t\t\t\t\t\t\t\tInformationElement13\t\t\tOPTIONAL,\t-- Need OR\n\t\tfield14\t\t\t\t\t\t\t\tInformationElement14\t\t\tOPTIONAL\t-- Need ON\n\t]]\n}\n\nInformationElement2 ::=\t\t\tSEQUENCE {\n\tfield21\t\t\t\t\t\t\t\tInformationElement11\t\t\t\tOPTIONAL,\t-- Need OR\n\t...\n}\n\n-- ASN1STOP\n\nThe handling of need codes as specified in the previous implies that:\n-\tif field2 in RRCMessage-r8-IEs is absent, the UE does not modify field21;\n-\tif field2 in RRCMessage-r8-IEs is present but does not include field21, the UE releases field21;\n-\tif the extension group containing field13 is absent, the UE releases field13 and does not modify field14;\n-\tif nonCriticalExtension defined by IE RRCMessage-v8a0-IEs is absent, the UE does not modify field3 and releases field4;\n\n\n6.2\tRRC messages\nNOTE:\tThe messages included in this section reflect the current status of the discussions. Additional messages may be included at a later stage.\n<Omitting text>\n*********End of changes**********\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt seems RAN2 36.331 spec and RAN1 36.213 spec assume \u201cfirst bit\u201d of a bit string differently. 36.331 does not explicitly mention whether \u201cfirst bit\u201d is leftmost or rightmost in some places; whereas 36.213 explicitly defines \u201cfirst bit\u201d as LSB and rightmost bit in some places.=========In RAN2 spec 36.331, the following is an example of the text. It is unclear whether \u201cthe first bit\u201d in the R13 FD-MIMO Field Description below means MSB or LSB. But we think it refers to MSB. It appears in multiple places in 36.331.n-MaxList (in MIMO-UE-ParametersPerTM)Indicates for a particular transmission mode the maximum number of NZP CSI RS ports supported within a CSI process applicable for band combinations for which the concerned capabilities are not signalled. For k-Max values exceeding 1, the UE shall include the field and signal k-Max minus 1 bits. The first bit indicates n-Max2, with value 0 indicating 8 and value 1 indicating 16. The second bit indicates n-Max3, with value 0 indicating 8 and value 1 indicating 16. The third bit indicates n-Max4, with value 0 indicating 8 and value 1 indicating 32. The fourth bit indicates n-Max5, with value 0 indicating 16 and value 1 indicating 32. The fifth bit indicates n-Max6, with value 0 indicating 16 and value 1 indicating 32. The sixt bit indicates n-Max7, with value 0 indicating 16 and value 1 indicating 32. The seventh bit indicates n-Max8, with value 0 indicating 16 and value 1 indicating 64.=============In RAN1 spec 36.213 Section 7.2, the following is an example of the text. Here the first bit  is explicitly defined as the rightmost/LSB.The bitmap parameter codebookSubsetRestriction, codebookSubsetRestriction-1 or codebookSubsetRestriction-3 forms the bit sequence where \u00a0is the LSB and is the MSB and where a bit value of zero indicates that the PMI and RI reporting is not allowed to correspond to precoder(s) associated with the bit.\u201d\n\n>>> SUMMARY OF CHANGE\nAdding a general principle that \u201cfirst bit\u201d is leftmost bit of a bit string in ASN.1. This can avoid confustion for both current spec and future RAN2 spec versions in case future RAN2 CRs use \u201cfirst bit\u201d and not \u201cfirst/leftmost bit\u201d.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE and eNB may have different undersatanding for a bit string in ASN.1. IOT issue may happen. The following bit strings use the term \u201cfirst bit\u201d in their descriptions without defining whether it is MSB or LSB. This will impact the Release 13 features FD-MIMO and SC-PTM, as well as features in other releases.subframeConfigPatternFDDaperiodicCSI-Reportingcodebook-HARQ-ACKcommSupportedBandsPerBCinterBandTDD-CA-WithDifferentConfign-MaxList (in MIMO-UE-ParametersPerTM)tdd-FDD-CA-PCellDuplexsc-mtch-neighbourCell"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n4.4.3.3.1\tAutomatic and manual network selection modes\nIf the MS is in a VPLMN, the MS shall periodically attempt to obtain service on its HPLMN (if the EHPLMN list is not present or is empty) or one of its EHPLMNs (if the EHPLMN list is present) or a higher priority PLMN/access technology combinations listed in \"user controlled PLMN selector\" or \"operator controlled PLMN selector\" by scanning in accordance with the requirements that are applicable to i), ii) and iii) as defined in the Automatic Network Selection Mode in subclause 4.4.3.1.1. In the case that the mobile has a stored \"Equivalent PLMNs\" list the mobile shall only select a PLMN if it is of a higher priority than those of the same country as the current serving PLMN which are stored in the \"Equivalent PLMNs\" list. For this purpose, a value T minutes may be stored in the SIM, T is either in the range 6\u00a0minutes to\u00a08 hours in 6\u00a0minute steps or it indicates that no periodic attempts shall be made. If no value is stored in the SIM, a default value of 60\u00a0minutes is used for T.\nIf the MS is configured with the MinimumPeriodicSearchTimer as specified in 3GPP\u00a0TS\u00a024.368\u00a0[50] or 3GPP\u00a0TS\u00a031.102\u00a0[40], the MS shall not use a value for T that is less than the MinimumPeriodicSearchTimer. If the value stored in the SIM, or the default value for T (when no value is stored in the SIM), is less than the MinimumPeriodicSearchTimer, then T shall be set to the MinimumPeriodicSearchTimer.\nThe attempts to access the HPLMN or an EHPLMN or higher priority PLMN shall be as specified below:\na)\tThe periodic attempts shall only be performed in automatic mode when the MS is roaming, and not while the MS is attached for emergency bearer services or has a PDN connection for emergency bearer services;\nb)\tAfter switch on a period of at least 2\u00a0minutes and at most T minutes shall elapse before the first attempt is made;\nc)\tThe MS shall make the following attempts if the MS is on the VPLMN at time T after the last attempt;\nd)\tPeriodic attempts shall only be performed by the MS while in idle mode;\ne)\tIf the HPLMN (if the EHPLMN list is not present or is empty) or a EHPLMN (if the list is present) or a higher priority PLMN is not found, the MS shall remain on the VPLMN.\nf)\tIn steps i), ii) and iii) of subclause\u00a04.4.3.1.1 the MS shall limit its attempts to access higher priority PLMN/access technology combinations to PLMN/access technology combinations of the same country as the current serving VPLMN, as defined in Annex B.\ng)\tOnly the priority levels of Equivalent PLMNs of the same country as the current serving VPLMN, as defined in Annex B, shall be taken into account to compare with the priority level of a selected PLMN.\nh)\tIf the PLMN of the highest priority PLMN/access technology combination available is the current VPLMN, or one of the PLMNs in the \"Equivalent PLMNs\" list, the MS shall remain on the current PLMN/access technology combination.\n***** Next change *****\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nA problem has been observed in live networks with roaming at country borders. The problem is that some UEs at country borders accidentally roam onto another network (VPLMN A) because the signal is stronger on the other country\u2019s side of the border.\u00a0 That\u2019s quite normal, right. However, then once roaming, the UEs never find their (E)HPLMN network again though available unless they totally lose sight of the VPLMN A network (this can take long time). This results in other drawbacks since limits the functionality to only (E)HPLMN of the same country as the VPLMN, especially if say a service (e.g., VoIP) is supported in the (E)HPLMN which is in a different country, but is not supported in the roamed-to VPLMN, and coverage of the (E)HPLMN is available.The root of the problem is the text stated in TS 23.122 on \u201cin VPLMN\u201d. Particularly, the problem seems to be the bullet item f), quote of 4.4.3.3.1:4.4.3.3\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 In VPLMN4.4.3.3.1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Automatic and manual network selection modesIf the MS is in a VPLMN, the MS shall periodically attempt to obtain service on its HPLMN (if the EHPLMN list is not present or is empty) or one of its EHPLMNs (if the EHPLMN list is present) or a higher priority PLMN/access technology combinations listed in \"user controlled PLMN selector\" or \"operator controlled PLMN selector\" by scanning in accordance with the requirements that are applicable to i), ii) and iii) as defined in the Automatic Network Selection Mode in subclause 4.4.3.1.1. [..]The attempts to access the HPLMN or an EHPLMN or higher priority PLMN shall be as specified below:[..]f)\u00a0\u00a0 In steps i), ii) and iii) of subclause\u00a04.4.3.1.1 the MS shall limit its attempts to access higher priority PLMN/access technology combinations to PLMN/access technology combinations of the same country as the current serving VPLMN, as defined in Annex B.Quote of sub-clause 4.4.3.1.1:4.4.3.1.1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Automatic Network Selection Mode ProcedureThe MS selects and attempts registration on other PLMN/access technology combinations, if available and allowable, in the following order:i)\u00a0\u00a0\u00a0 either the HPLMN (if the EHPLMN list is not present or is empty) or the highest priority EHPLMN that is available (if the EHPLMN list is present) ;ii)\u00a0\u00a0 PLMN/access technology combinations contained in the \"User Controlled PLMN Selector with Access Technology\" data file in the SIM (in priority order) excluding the previously selected PLMN/access technology combination;iii)\u00a0 PLMN/access technology combinations contained in the \"Operator Controlled PLMN Selector with Access Technology\" data file in the SIM (in priority order) excluding the previously selected PLMN/access technology combination;The result of the current text in the bullet item f) \u2013since it includes the step i) of 4.4.3.1.1\u2013 is that the UE is not allowed to search for its (equivalent) home country code if it is attached to another country\u2019s network (with a different MCC. Note that the meaning of country can be more than one MCC). Hence, the step i) of 4.4.3.1.1 in the bullet item f) limits the possibility of the UE to select an available (E)HPLMN for the case of being served by a VPLMN of another country. This limitation in the bullet item f) could be seen even not aligned with general purpose of the VPLMN search procedure, quote and highlighted in green above and again quoted here:If the MS is in a VPLMN, the MS shall periodically attempt to obtain service on its HPLMN (if the EHPLMN list is not present or is empty) or one of its EHPLMNs (if the EHPLMN list is present) or a higher priority PLMN/access technology combinations listed in \"user controlled PLMN selector\" or \"operator controlled PLMN selector\" by scanning in accordance with the requirements that are applicable to i), ii) and iii) as defined in the Automatic Network Selection Mode in subclause 4.4.3.1.1.That above text indicates that if (E)HPLMN is(are) available the UE has to attempt to obtain service in the (E)HPLMN when in VPLMN.It is proposed that when in VPLMN and (E)HPLMN is found then regardless of MCC, the UE selects the (E)HPLMN. Hence, this CR proposes to remove the step i) from the bullet item f), i.e., quote:f) In steps i), ii) and iii) of subclause\u00a04.4.3.1.1 the MS shall limit its attempts to access higher priority PLMN/access technology combinations to PLMN/access technology combinations of the same country as the current serving VPLMN, as defined in Annex B.We agree that the main reason of why the UE to attempt to obtain service for higher prioritized PLMNs only if there are of the same country as the VPLMN is to avoid potential ping ponging across international boundaries (e.g., case of ePLMNs of different country). However, please note that in the case observed in the field the UE (subscriber) is actually caught by the other country\u2019s network operator though (E)HPLMN coverage is available and could not get back automatically unless either manual selection is used or the coverage of that network operator is totally lost which takes long time.\n\n>>> SUMMARY OF CHANGE\nThe step i) from the bullet item f) of the sub-clause 4.4.3.3.1 is removed.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE (subscriber) is caught by other country\u2019s network operator though (E)HPLMN coverage is available and cannot get back automatically unless either manual selection was used or the coverage of that network operator was totally lost which takes long time. Home subscriber cannot use his home network though available, so the user spends more money for services which can get considerably cheaper in the home subscriber\u2019s network. Also, no all services provided by the home subscriber\u2019s network can be provided by the roaming operator. If say a service (e.g., VoIP) is supported in the (E)HPLMN which is in a different country, but is not supported in the roamed-to VPLMN, and coverage of the (E)HPLMN is available.Loss of revenue of the home subscriber\u2019s network."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***\tBEGIN CHANGES\t***\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\tIETF RFC 4877: \" IPv6 Operation with IKEv2 and the Revised IPsec Architecture\".\n[3]\tVoid.\n[4]\tIETF RFC\u00a05778: \"Diameter  IPv6: Support for Home Agent to Diameter Server Interaction\". \n[5]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[6]\t3GPP\u00a0TS\u00a033.210: \"3G security; Network Domain Security (NDS); IP network layer security\".\n[7]\tIETF RFC 4187 (January 2006): \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)\". \n[8]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[9]\t3GPP TS 33.234: \"3G: security; Wireless Local Area Network (WLAN) interworking security\".\n[10]\tIETF RFC 4072 (August 2005): \"Diameter Extensible Authentication Protocol (EAP) Application\".\n[11] \t3GPP\u00a0TS\u00a033.102: \"3G security; Security architecture\".\n[12]\t3GPP\u00a0TS\u00a033.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[13]\t3GPP\u00a0TS\u00a023.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[14]\t3GPP TS 23.203: \"Policy and charging control architecture\".\n[15]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access (E-UTRAN); Overall description; Stage 2\".\n[16]\t3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security Architecture\".\n[17]\tIETF RFC 3344: \"IP Mobility Support for IPv4\".\n[18]\tIETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".\n[19]\tIETF RFC 5295: \"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)\".\n[20]\t3GPPP TS 24.303: \"Mobility Management based on Dual-Stack Mobile IPv6; Stage 3\".\n[21]\tIETF RFC 4433: \" IPv4 Dynamic Home Agent (HA) Assignment\".\n[22]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; Stage 3  \".\n[23]\tIETF RFC 5448: \"Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA') \".\n[24]\t3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to network application functions using Hypertext Transfer Protocol over Transport Layer Security (HTTPS)\".\n[25]\t3GPP\u00a0TS\u00a029.109: \"3rd Generation Partnership Project; Technical Specification Group Core Network and Terminals; Generic Authentication Architecture (GAA); Zh and Zn Interfaces based on the Diameter protocol; Stage\u00a03\".\n[26] - [28]\tVoid.\n[29]\t3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function\".\n[30]\tIETF RFC 5996: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".\n[31]\t3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\". \n[32]\t3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and Tunnelling protocols; Stage\u00a03\".\n[33]\tIETF RFC 4739: \"Multiple Authentication Exchanges in the Internet Key Exchange (IKEv2) Protocol\".\n[34]\t3GPP TS 33.203: \"Access security for IP-based services\".\n[35]\tIETF RFC 3948: \"UDP Encapsulation of IPsec ESP Packets\".\n[36]\tIETF RFC 2616: \"Hypertext Transfer Protocol -- HTTP/1.1\".\n\n\n\n\n***\tNEXT CHANGE\t***\n7.2.3\tTrusted WLAN Access (TWAN)\n\nA Trusted WLAN Access Network (TWAN) is interfaced with the EPC as a trusted non-3GPP access via the STa interface to the 3GPP AAA Server/Proxy and the S2a interface to the PDN\u00a0GW as described in clause 16 of TS 23.402 [5].\nAuthentication and key agreement shall be performed as described in clause 6 of the present document for trusted non-3GPP access. The authenticator shall reside in the TWAN. \nAccording to subclause 6.2 of the present document, the 3GPP AAA Server sends the key MSK to the authenticator in the TWAN. The security contexts in the TWAN are based on MSK.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n***\tNEXT CHANGE\t***\n\nAnnex A (normative):\nKey derivation functions\nA.1\tKDF interface and input parameter construction\nAll key derivations (including input parameter encoding) shall be performed using the key derivation function (KDF) specified in TS 33.220 [8]. This clause specifies how to construct the input string, S, to the KDF (which is input together with the relevant key). For each of the distinct usages of the KDF, the input parameters S are specified below.\nThe FC number space used is controlled by TS 33.220 [8], FC values allocated for this specification are in range of 0x20 \u2013 0x2F.\nA.2\tFunction  for the derivation of CK\u2019, IK\u2019 from CK, IK\nWhen deriving CK\u2019, IK\u2019 from CK, IK and the access network identity as defined in clause 6 of this specification , the following parameters shall be used to form the input S to the KDF.\n-\tFC = 0x20,\n-\tP0 = value of access network identity, as defined in 3GPP TS 24.302 [22],\n-\tL0 = length of value of access network identity (variable, depending on access network type),\n-    P1 = SQN  AK\n -   L1 = length of  (i.e. 0x00 0x06) \nIf AK is not used, AK shall be treated in accordance with TS 33.102, i.e. as 000\u20260.\nThe access network identity is defined separately for each access network type. For each access network type, the access network identity is documented in TS 24.302 [22] to ensure that UE and HSS use the same access network identities as input for key derivation.\nThe input key shall be the concatenation CK || IK of CK and IK.\nThe KDF returns a 256-bit output, where the 128 most significant bits are identified with CK' and the 128 least significant bits are identified with IK'.\n\n\n\n\n\n\n\n***\tEND OF CHANGES\t***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWLCP signalling is not protected between UE and TWAG. The security currently provided between UE and AP is not sufficient to protect WLCP signalling.\n\n>>> SUMMARY OF CHANGE\nSecurity mechanisms for WLCP is added. WLCP is protected with DTLS and WLCP key is derived from EMSK of EAP-AKA'.\n\n>>> CONSEQUENCES IF NOT REVISED\nWLCP signalling will not be protected, which will enable attackers to spoof and/or modify WLCP signalling messages, e.g. in order to tear down PDN connections."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*************** Start of Change 1 ****************\nAnnex A (normative):\nKey derivation functions\nA.1\tAEFPSK derivation function\nAEFPSK key derivation shall be performed using the key derivation function (KDF) specified in TS 33.220 [8]. This subclause specifies how to construct the input string, S, to the KDF (which is input together with the relevant key). \nThe FC number space is controlled by TS 33.220 [8].\n\tEditor's Note: Allocation of FC value is FFS.\nAEFPSK shall be derived by the API invoker and the CAPIF core function based on Service API interface information and CAPIF-1e TLS session parameters. Length and format of TLS session parameters used for key derivation are as specified in TLS 1.2 [9].\nThe following parameters shall be used to form the input S to the KDF.\nFC = 0x??\nP0 = Service API interface information\nL0 = Length of Service API interface information\nP1 = CAPIF-1e TLS session's Session ID, generated as part of TLS full Handshake.\nL1 = Length of TLS Session ID\nThe input key shall be equal to CAPIF-1e TLS session's Master Secret.\nNOTE:\tService API interface information is as specified in TS 23.222 [3].\n\n*************** End of Change 1 **************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThis contribution proposes that the below assignment of FC value should be agreed for inclusion in TS 33.122. The inclusion should happen by an update of the CR in S3-182xxx which is the baseline text of the below.\n\n>>> SUMMARY OF CHANGE\nUpdate FC value to TS 33.122\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is no FC valuse for key derivation in CAPIF security"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********************First and only change*************************\n4.5.2.9\tActions at the AS serving the terminating UE\nIf a terminating user does not subscribe to OIP service, an AS shall remove any PAssertedIdentity or Privacy header a  field included in the request. Additionally, the Application Server may as a network option anonymize the contents of the From header by setting it to a default non significant value. As a network option, if the terminating user has an override category, the AS shall send the PAssertedIdentity headers and remove the Privacy header fields.\nWhen the Privacy header field is set to \"id\", with the exception of the cases listed above, the AS should not remove this Privacy header entry.\nNOTE:\tThe priv-value \"id\" in the Privacy header will be used by the terminating UE to distinguish the request of OIR by the originating user.\nIf the request includes the Privacy header field set to \"header\" the AS shall anonymize the contents of all headers containing private information in accordance with IETF\u00a0RFC\u00a03323\u00a0[6] and IETF\u00a0RFC\u00a03325\u00a0[7].\nIf the request includes the Privacy header field set to \"user\" the AS shall remove or anonymize the contents of all \"user configurable\" headers in accordance with IETF\u00a0RFC\u00a03323\u00a0[6] and IETF\u00a0RFC\u00a03325\u00a0[7]. In the latter case, the AS may need to act as transparent backtoback user agent as described in IETF\u00a0RFC\u00a03323\u00a0[6].\n*********************End of changes*************************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the served user does not subscribe to the OIP service, no identity information should be given to the served user. This is currently not the case. Furthermore, ASes after the OIP AS may need the P-Asserted-Identity for performing its functions correctly (CAT AS is one example). Thus an option to not remove the P-Asserted-Identity is added.\n\n>>> SUMMARY OF CHANGE\nChange text to ensure that all privacy information is removed if served user does not subscribe to OIP. Add an option to not remove P-Asserted-Identity, instead add a Privacy header field \"id\".The main difference to C1-093596 is that this procedure is now based on local policy.Some concerns raised in Sevilla were:-Interaction with ACR. ACR takes place before OIP. Should a UE implement a local ACR, that would require an OIP subscription to work.-Adding \u201cid\u201d instead of removing PAI implies that the UE which does not know that the user is not subscribed to OIP cannot distinguish \u201cnot subscribed\u201d and \u201cOIR\u201d. This is true, but one possibility is to use a non-significant URI name in the From header field.\n\n>>> CONSEQUENCES IF NOT REVISED\n-Served user may receive identity information it is not allowed to.-Other entities after the OIP AS that need the P-Asserted-Identity information may not be able to perform its tasks."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** change *****\n8.2.1.1\tMessage definition\nThe AUTHENTICATION REQUEST message is sent by the AMF to the UE to initiate authentication of the UE identity. See table\u00a08.2.1.1.1.\nMessage type:\tAUTHENTICATION REQUEST\nSignificance:\t\tdual\nDirection:\t\t\tnetwork to UE\nTable\u00a08.2.1.1.1: AUTHENTICATION REQUEST message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tExtended protocol discriminator\tExtended protocol discriminator\t9.2\tM\tV\t1\n\tSecurity header type\tSecurity header type\t9.3\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.5\tM\tV\t1/2\n\tAuthentication request message identity\tMessage type\t9.7\tM\tV\t1\n\tngKSI \tNAS key set identifier\t9.11.3.29\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.5\tM\tV\t1/2\n\n21\tAuthentication parameter RAND (5G authentication challenge)\tAuthentication parameter RAND\t9.11.3.16\tO\tTV\t17\n20\tAuthentication parameter AUTN (5G authentication challenge)\tAuthentication parameter AUTN\t9.11.3.15\tO\tTLV\t18\n38\tABBA\tABBA\t9.11.3.10\tO\tTLV\t3-n\n78\tEAP message\tEAP message\t9.11.2.2\tO\tTLV-E\t7-1503\n\n***** change *****\n8.2.1.4\tABBA\nThis IE is included when a 5G AKA based primary authentication and key agreement procedure is performed.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn EAP message reliable transport procedure in 24.501 subclause 5.4.1.2.4, AUTHENTICATION REQUEST message always includes ABBA IE.However, in coding, ABBA inclusion in the AUTHENTICATION REQUEST message is allowed only for 5G-AKA based primary authentication (and not for EAP based primary authentication).Given that ABBA is included in AUTHENTICATION REQUEST messages both for the EAP based primary authentication and for the 5G-AKA based primary authentication, ABBA IE can be made mandatory in the AUTHENTICATION REQUEST message.\n\n>>> SUMMARY OF CHANGE\nABBA IE is made mandatory in the AUTHENTICATION REQUEST message.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe EAP based primary authentication cannot be used."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n==================================START OF CHANGES==================================\n6.4.1\tCommon Lower-Level IEs\n\u2013\tCarrierFreq-NB\nThe IE CarrierFreq-NB is used to provide the NB-IoT carrier frequency, as defined in TS 36.101 [21].\n-- ASN1START\n\nCarrierFreq-NB-r14 ::=\t\tSEQUENCE {\n\tcarrierFreq-r14\t\t\t\tARFCN-ValueEUTRA-r14,\n\tcarrierFreqOffset-r14\t\tCarrierFreqOffsetNB-r14\t\t\t\tOPTIONAL,\n\t...\n}\n\n-- ASN1STOP\n\nCarrierFreq-NB field descriptions\ncarrierFreq\tThis field specifies the ARFCN applicable for the NB-IoT carrier frequency as defined in TS 36.101 [21, Table 5.7.3-1].\ncarrierFreqOffset\tThis field specifies the offset of the NB-IoT channel number to EARFCN as defined in TS 36.101 [21]. \n\n=================================NEXT CHANGE=====================================\n6.5.2.1\tGNSS Assistance Data\n\u2013\tGNSS-GenericAssistData\nThe IE GNSS-GenericAssistData is used by the location server to provide assistance data for a specific GNSS (e.g., GPS, Galileo, GLONASS, BDS, etc.). The specific GNSS for which the provided assistance data are applicable is indicated by the IE GNSSID and (if applicable) by the IE SBASID. Assistance for up to 16 GNSSs can be provided.\n-- ASN1START\n\nGNSS-GenericAssistData ::= SEQUENCE (SIZE (1..16)) OF GNSS-GenericAssistDataElement\n\nGNSS-GenericAssistDataElement ::= SEQUENCE {\n\tgnss-ID\t\t\t\t\t\tGNSS-ID,\n\tsbas-ID\t\t\t\t\t\t\tSBAS-ID\t\t\t\t\t\tOPTIONAL, -- Cond GNSS-ID-SBAS\n\tgnss-TimeModels\t\t\t\t\tGNSS-TimeModelList\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-DifferentialCorrections\tGNSS-DifferentialCorrections\tOPTIONAL,\t-- Need ON\n\tgnss-NavigationModel\t\t\tGNSS-NavigationModel\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-RealTimeIntegrity\t\t\tGNSS-RealTimeIntegrity\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-DataBitAssistance\t\t\tGNSS-DataBitAssistance\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-AcquisitionAssistance\t\tGNSS-AcquisitionAssistance\t\tOPTIONAL,\t-- Need ON\n\tgnss-Almanac\t\t\t\t\tGNSS-Almanac\t\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-UTC-Model\t\t\t\t\tGNSS-UTC-Model\t\t\t\t\tOPTIONAL,\t-- Need ON\n\tgnss-AuxiliaryInformation\t\tGNSS-AuxiliaryInformation\t\tOPTIONAL,\t-- Need ON\n\t...,\n\t[[\n\t\tbds-DifferentialCorrections-r12\t\n\t\t\t\t\t\t\t\t\tBDS-DifferentialCorrections-r12\tOPTIONAL,\t-- Cond\tGNSS-ID-BDS\n\t\tbds-GridModel-r12\t\t\tBDS-GridModelParameter-r12\t\tOPTIONAL\t-- Cond\tGNSS-ID-BDS\n\t]]\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nGNSSIDSBAS\tThe field is mandatory present if the GNSSID = sbas; otherwise it is not present.\nGNSSIDBDS\n\n\n=================================NEXT CHANGE======================================\n\n6.5.2.2\tGNSS Assistance Data Elements\n\u2013\tGNSS-ReferenceTime\nThe IE GNSS-ReferenceTime is used by the location server to provide the GNSS specific system time with uncertainty and the relationship between GNSS system time and network air-interface timing of the eNodeB/NodeB/BTS transmission in the reference cell.\nIf the IE networkTime is present, the IEs gnss-SystemTime and networkTime provide a valid relationship between GNSS system time and air-interface network time, as seen at the approximate location of the target device, i.e. the propagation delay from the gNB/ng-eNB/eNodeB/NodeB/BTS to the target device shall be compensated for by the location server. Depending on implementation, the relation between GNSS system time and air-interface network time may have varying accuracy. The uncertainty of this timing relation is provided in the IE referenceTimeUnc. If the propagation delay from the eNodeB/NodeB/BTS to the target device is not accurately known, the location server shall use the best available approximation of the propagation delay and take the corresponding delay uncertainty into account in the calculation of the IE referenceTimeUnc.\nIf the IE networkTime is not present, the IE gnssSystemTime is an estimate of current GNSS system time at time of reception of the IE GNSS-ReferenceTime by the target device. The location server should achieve an accuracy of +/- 3 seconds for this estimate including allowing for the transmission delay between the location server and the target device. Note that the target device should further compensate gnss-SystemTime for the time between the reception of GNSS-ReferenceTime and the time when the gnss-SystemTime is used.\nThe location server shall provide a value for the gnss-TimeID only for GNSSs supported by the target device.\nThe IE GNSS-ReferenceTimeForOneCell can be provided multiple times (up to 16) to provide fine time assistance for several (neighbour) cells.\n-- ASN1START\n\nGNSS-ReferenceTime ::= SEQUENCE {\n\tgnss-SystemTime\t\t\t\tGNSS-SystemTime,\n\treferenceTimeUnc\t\t\t\tINTEGER (0..127)\t\t\t\t\tOPTIONAL,\t-- Cond noFTA\n\tgnss-ReferenceTimeForCells\tSEQUENCE (SIZE (1..16)) OF\n\t\t\t\t\t\t\t\t\tGNSS-ReferenceTimeForOneCell\tOPTIONAL,\t-- Need ON\n\t...\n}\n\nGNSS-ReferenceTimeForOneCell ::= SEQUENCE {\t\n\tnetworkTime\t\t\t\tNetworkTime,\n\treferenceTimeUnc\t\t\t\tINTEGER (0..127),\n\tbsAlign\t\t\t\t\t\tENUMERATED {true}\tOPTIONAL,\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nnoFTA\n\nGNSS-ReferenceTime field descriptions\ngnss-SystemTime\tThis field provides the specific GNSS system time.\nnetworkTime\tThis field specifies the cellular network time at the epoch corresponding to gnss-SystemTime.\nreferenceTimeUnc\tThis field provides the accuracy of the relation between gnssSystemTime and networkTime time if IE networkTime is provided. When IE networkTime is not provided, this field can be included to provide the accuracy of the provided gnssSystemTime.\tIf GNSS TOD is the given GNSS time, then the true GNSS time, corresponding to the provided network time as observed at the target device location, lies in the interval [GNSS TOD - referenceTimeUnc, GNSS TOD + referenceTimeUnc].\tThe uncertainty r, expressed in microseconds, is mapped to a number K, with the following formula:\t\t\t\t\t\t\t\t\t\t\t\t\t\tr = C*(((1+x)K)-1)\twith C = 0.5 and x = 0.14. To encode any higher value of uncertainty than that corresponding in the above formula to K=127, the same value, K=127, shall also be used. The uncertainty is then coded on 7 bits, as the binary encoding of K. Example values for the referenceTimeUnc Format: see table K to uncertainty relation below. \nbsAlign\tThis flag, if present, indicates that the transmission timings of all cells sharing, depending on the RAT, the same carrier frequency and Tracking Area/Location Area/Routing Area as the cell indicated, are frame aligned. This information allows the target device to derive the GNSS - cellular time relation for any of these cells based on the timing relation information provided in GNSS-ReferenceTime. The flag should be set consistently in all these cells. This flag does not guarantee SFN alignment.\n\nK to uncertainty relation\nValue of K\tValue of uncertainty\n0\t0 nanoseconds\n1\t70 nanoseconds\n2\t149.8 nanoseconds\n-\t-\n50\t349.62 microseconds\n-\t-\n127\t\u2265 8.43 seconds\n\n===================================NEXT CHANGE====================================\n\u2013\tGNSS-SystemTime\n-- ASN1START\n\nGNSS-SystemTime ::= SEQUENCE {\n\tgnss-TimeID\t\t\t\t\t\tGNSS-ID,\n\tgnss-DayNumber\t\t\t\t\tINTEGER (0..32767),\n\tgnss-TimeOfDay\t\t\t\t\tINTEGER (0..86399),\n\tgnss-TimeOfDayFrac-msec\t\t\tINTEGER (0..999)\t\tOPTIONAL,\t-- Need ON\n\tnotificationOfLeapSecond\t\t\tBIT STRING (SIZE(2))\tOPTIONAL,\t-- Cond gnss-TimeID-glonass\n\tgps-TOW-Assist\t\t\t\t\tGPS-TOW-Assist\t\t\tOPTIONAL,\t-- Cond gnss-TimeID-gps\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\ngnss-TimeID-glonass\ngnss-TimeID-gps\n\nGNSS-SystemTime field descriptions\ngnss-TimeID\tThis field specifies the GNSS for which the GNSS-SystemTime is provided.\ngnss-DayNumber\tThis field specifies the sequential number of days (with day count starting at 0) from the origin of the GNSS System Time as follows:\t\tGPS, QZSS, SBAS \u2013 Days from January 6th 1980 00:00:00 UTC (USNO);\t\tGalileo \u2013 Days from Galileo System Time (GST) start epoch, defined as 13 seconds before midnight between 21st\t\t\t\t\tAugust and 22nd August 1999; i.e., GST was equal to 13 seconds at August 22nd 1999 00:00:00 UTC;\t\tGLONASS \u2013 Days from December 31st 1995 21:00:00 UTC (SU), which is local UTC Moscow\t\t\t\t\t\tJanuary 1st 1996 00:00:00, defined as UTC(SU) + 3 hours in [9];\t\tBDS \u2013 Days from January 1st 2006 00:00:00 UTC (NTSC).\t\tNavIC \u2013 Days from NavIC System Time start epoch, defined as 13 seconds before midnight between 21st\t\tAugust and 22nd August 1999; i.e., NavIC System Time was equal to 00:00:00 at August 21st, 1999\t\t23:55:47 UTC (BIPM).\ngnss-TimeOfDay\tThis field specifies the integer number of seconds from the GNSS day change.\ngnss-TimeOfDayFrac-msec\tThis field specifies the fractional part of the gnssTimeOfDay field in 1milliseconds resolution. The total GNSS TOD is gnss-TimeOfDay + gnssTimeOfDayFrac-msec.\nnotificationOfLeapSecond\tThis field specifies the notification of forthcoming leap second correction, as defined by parameter KP in [9, Table 4.7].\ngps-TOW-Assist\tThis field contains several fields in the Telemetry (TLM) Word and Handover Word (HOW) that are currently being broadcast by the respective GPS satellites. Combining this information with GPS TOW enables the target device to know the entire 1.2-second (60-bit) pattern of TLM and HOW that is transmitted at the start of each six-second NAV subframe by the particular GPS satellite.\n\n\n================================NEXT CHANGE========================================\n\u2013\tAlmanacBDS-AlmanacSet\n-- ASN1START\n\nAlmanacBDS-AlmanacSet-r12 ::= SEQUENCE {\n\tsvID\t\t\t\t\t\tSV-ID,\n\tbdsAlmToa-r12\t\t\tINTEGER (0..255)\t\t\t\t\tOPTIONAL,\t-- Cond NotSameForAllSV\n\tbdsAlmSqrtA-r12\t\t\tINTEGER (0..16777215),\n\tbdsAlmE-r12\t\t\t\tINTEGER (0..131071),\n\tbdsAlmW-r12\t\t\t\tINTEGER (-8388608..8388607),\n\tbdsAlmM0-r12\t\t\t\tINTEGER (-8388608..8388607),\n\tbdsAlmOmega0-r12\t\t\tINTEGER (-8388608..8388607),\n\tbdsAlmOmegaDot-r12\t\tINTEGER (-65536..65535),\n\tbdsAlmDeltaI-r12\t\t\tINTEGER (-32768..32767),\n\tbdsAlmA0-r12\t\t\t\tINTEGER (-1024..1023),\n\tbdsAlmA1-r12\t\t\t\tINTEGER (-1024..1023),\n\tbdsSvHealth-r12\t\t\tBIT STRING (SIZE(9))\t\t\t\tOPTIONAL,\t-- Cond SV-ID\n\t...\n}\n\n-- ASN1STOP\n\nConditional presence\tExplanation\nNotSameForAllSV\nSV-ID\tThis field is mandatory present if SV-ID is between 0 and 63; otherwise it is not present.\n\nAlmanacBDS-AlmanacSet field descriptions\nsvID\tThis field identifies the satellite for which the GNSS Almanac Model is given.\nbdsAlmToa\tParameter toa, Almanac reference time (seconds) [23]\tScale factor 212 seconds.\nbdsAlmSqrtA\tParameter A1/2, Square root of semi-major axis (metres1/2) [23]\tScale factor 2-11 metres1/2.\nbdsAlmE\tParameter e, Eccentricity, dimensionless [23]\tScale factor 2-21.\nbdsAlmW\t\tParameter , Argument of Perigee (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmM0\tParameter M0, Mean anomaly at reference time (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmOmega0\tParameter 0, Longitude of ascending node of orbital plane computed according to reference time (semi-circles) [23]\tScale factor 2-23 semi-circles.\nbdsAlmOmegaDot\tParameter  Rate of right ascension (semi-circles/second) [23]\tScale factor 2-38 semi-circles/second.\nbdsAlmDeltaI\tParameter i, Correction of orbit reference inclination at reference time (semi-circles) [23]\tScale factor 2-19 semi-circles.\nbdsAlmA0\tParameter a0, Satellite clock bias (seconds) [23]\tScale factor 2-20 seconds.\nbdsAlmA1\tParameter a1, Satellite clock rate (sec/sec) [23]\tScale factor 2-38 seconds/seconds.\nbdsSvHealth\tThis field indicates satellites health information as defined in [23] Table 5-16. The left most bit is the MSB.\n\n\n==============================END OF CHANGES========================================\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current LPP spec, for several optional fields in the downlink message, there is no need code for these fields. Need code needs to be added to let the UE know what should be the UE\u2019s operation when the field is absent.\n\n>>> SUMMARY OF CHANGE\nCorrections are made for IEs introduced in the following releases====R14 Corrections==1/ Add need code for the folowing fields under CarrierFreq-NB, since it is used under OTDOA-ProvideAssistanceDatacarrierFreqOffset-r14====R12 Corrections==2/ Add the need code for the following fields under GNSS-GenericAssistDatabds-DifferentialCorrections-r12bds-GridModel-r123/ Add the need code for the following fields under AlmanacBDS-AlmanacSetbdsAlmToa-r12====R9 Corrections==4/ Add the need code for the following fields under GNSS-ReferenceTimereferenceTimeUncbsAlign5/ Add the need code for the following fields under GNSS-SystemTimenotificationOfLeapSecond gps-TOW-Assist\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE behavior when the field is absent is undefined, which may lead to different understanding on the UE action between the UE and network. If the network mistakenly thinks that the UE has a certain configuration and hence does not transfer this configuration to the UE, the UE may fail to perform measurements and location estimation. Impact analysisImpacted functionalityFor R14CarrierFreq-NB-r14For R12GNSS-GenericAssistData, AlmanacBDS-AlmanacSet-r12For R9GNSS-ReferenceTime, GNSS-SystemTimeInter-operability: If the UE is implemented according to this CR while the network is not, the network does not know what will be the UE behavior when the field is absent.If the network is implemented according to this CR while the UE is not, the UE does not know what should be the UE behavior when the field is absent."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of change\n5.3.2.1\tE-UTRAN Initial Attach\nA UE/user needs to register with the network to receive services that require registration. This registration is described as Network Attachment. The always-on IP connectivity for UE/users of the EPS is enabled by establishing a default EPS bearer during Network Attachment. The PCC rules applied to the default EPS bearer may be predefined in the PDN GW and activated in the attachment by the PDN GW itself. The Attach procedure may trigger one or multiple Dedicated Bearer Establishment procedures to establish dedicated EPS bearer(s) for that UE. During the attach procedure, the UE may request for an IP address allocation. Terminals utilising only IETF based mechanisms for IP address allocation are also supported.\nDuring the Initial Attach procedure the Mobile Equipment Identity may be obtained from the UE. The MME operator may check the ME Identity with an EIR. At least in roaming situations, the MME should pass the ME Identity to the HSS, and, if a PDN-GW outside of the VPLMN, should pass the ME Identity to the PDN-GW.\n\nFigure 5.3.2.1-1: Attach procedure\nNOTE\u00a01:\tFor a PMIP-based S5/S8, procedure steps (A), (B), and (C) are defined in TS\u00a023.402\u00a0[2]. Steps\u00a07, 10, 14, 15 and 16  concern GTP based S5/S8.\nNOTE\u00a02:\tThe Serving GWs and PDN GWs involved in steps\u00a07 and/or 10 may be to different to those in steps\u00a01317.\n1.\tThe UE initiates the Attach procedure by the transmission of an Attach Request (IMSI or old GUTI, last visited TAI (if available), UE Network Capability, PDN Type, Protocol Configuration Options, Ciphered Protocol Configuration Options Transfer, Attach Type, KSI, NAS sequence number, NAS-MAC) message together with an indication of the Selected Network to the eNodeB. IMSI shall be included if the UE does not have a valid GUTI available. If the UE has a valid GUTI, it shall be included. If available, the last visited TAI shall be included in order to help the MME produce a good list of TAIs for any subsequent Attach Accept message. Selected Network indicates the PLMN that is selected for network sharing purposes. UE Network Capability is described in clause \"UE capabilities\". If the UE has valid security parameters, the Attach Request message shall be integrity protected by the NAS-MAC in order to allow validation of the UE by the MME. KSI is included if the UE has valid security parameters. NAS sequence number indicates the sequential number of the NAS message. Furthermore, the UE may cipher the parts of the Attach Request message that require ciphering (it is FFS whether there are any such parts). If the UE does not have a valid NAS security association, then the Attach Request message is neither integrity protected nor ciphered. In this case the security association is established in step\u00a05a. The UE network capabilities indicate also the supported NAS and AS security algorithms. PDN type indicates the requested IP version (IPv4, IPv4/IPv6, IPv6). Protocol Configuration Options (PCO) are used to transfer parameters between the UE and the PDN GW, and are sent transparently through the MME and the Serving GW. The Protocol Configuration Options may include the Address Allocation Preference indicating that the UE prefers to obtain an IPv4 address only after the default bearer activation by means of DHCPv4. If the UE intends to send PCOs, which require ciphering (e.g., PAP/CHAP usernames and passwords), the UE shall set the Ciphered Protocol Configuration Options Transfer (Ciphered PCO Transfer) flag and shall send all PCOs only after authentication and NAS security setup have been completed (see below). Attach Type indicates \"Handover\" when the UE has already an activated PDN GW/HA due to mobility with non-3GPP accesses.\nEditor's note:\tIt's assumed that all the radio capabilities of the UE that the eNodeB has to know in order to handle radio resources for this UE are send to eNodeB upon RRC connection establishment.\n2.\tThe eNodeB derives the MME from the GUTI and from the indicated Selected Network. If that MME is not associated with the eNodeB, the eNodeB selects an MME as described in clause 4.3.8.3 on \"MME selection function\". The eNodeB forwards the Attach Request message to the new MME contained in a S1-MME control message (Initial UE message) together with the Selected Network and an indication of the E-UTRAN Area identity, a globally unique E-UTRAN ID of the cell from where it received the message to the new MME.\n3.\tIf the UE identifies itself with GUTI and the MME has changed since detach, the new MME sends an Identification Request (old GUTI, complete Attach Request message) to the old MME to request the IMSI. If the S-TMSI and old TAI identifies an SGSN, the message shall be sent to the old SGSN. The old MME responds with Identification Response (IMSI, unused EPS Authentication Vectors, KSIASME, KASME) and if request is sent to the old SGSN, then the old SGSN responds with Identification Response(IMSI, Unused Authentication Quintets, CK, IK and KSI). If the UE is not known in the old MME/SGSN or if the integrity check for the Attach Request message fails, the old MME/SGSN responds with an appropriate error cause.\nNOTE:\tA Pre-Rel8 SGSN always responds with the UMTS security parameters and the MME may cache it for later use.\n4.\tIf the UE is unknown in both the old MME/SGSN and new MME, the new MME sends an Identity Request to the UE to request the IMSI. The UE responds with Identity Response (IMSI).\n5a\tIf no UE context for the UE exists anywhere in the network, if the Attach Request (sent in step 1) was not integrity protected, or if the check of the integrity failed, then authentication and NAS security setup are mandatory. Otherwise it is optional. The authentication and NAS security setup functions are defined in clause\u00a05.3.10 on \"Security Function\".\n5b.\tThe ME Identity shall be retrieved from the UE at Initial Attach when Attach Type does not indicate handover. Otherwise it is optional. The ME identity shall be transferred encrypted. The MME may send the ME Identity Check Request (ME Identity, IMSI) to the EIR. The EIR shall respond with ME Identity Check Ack (Result). Dependent upon the Result, the MME decides whether to continue with this Attach procedure or to reject the UE.\nEditor's note:\tIt is FFS whether NAS security setup and ME identity retrieval can be combined in the case when both procedures are to be performed.\n6.\tIf the UE has set the Ciphered PCO Transfer flag in the Attach Request message, the Protocol Configuration Options shall now be retrieved from the UE.\n7.\tIf there are active bearer contexts in the new MME for this particular UE (i.e. the UE re-attaches to the same MME without having properly detached before), the new MME deletes these bearer contexts by sending Delete Bearer Request (TEIDs) messages to the GWs involved. The GWs acknowledge with Delete Bearer Response (TEIDs) message. If a PCRF is deployed, the PDN GW employs an IP-CAN Session Termination procedure to indicate that resources have been released.\n8.\tIf the MME has changed since the last detach, or if there is no valid subscription context for the UE in the MME, or if the ME identity has changed, the MMEsends an Update Location (MME Identity, IMSI, ME Identity) to the HSS.\n9.\tThe HSS sends Cancel Location (IMSI, Cancellation Type) to the old MME with Cancellation Type set to Update Procedure. The old MME acknowledges with Cancel Location Ack (IMSI) and removes the MM and bearer contexts.\n10.\tIf there are active bearer contexts in the old MME for this particular UE, the old MME deletes these bearer contexts by sending Delete Bearer Request (TEIDs) messages to the GWs involved. The GWs return Delete Bearer Response (TEIDs) message to the old MME. If a PCRF is deployed, the PDN GW employs an IPCAN Session Termination procedure as defined in TS\u00a023.203\u00a0[6] to indicate that resources have been released.\n11.\tThe HSS sends Insert Subscriber Data (IMSI, Subscription Data) message to the new MME. The Subscription Data contain one or more PDN subscription contexts. Each PDN subscription context contains an'EPS subscribed QoS profile' (see clause 4.7.3). The MME adopts the PDN subscription context that is marked as default for the default bearer activation, which is performed during this attach procedure. This results in the usage of the Default APN for this procedure. The new MME validates the UE's presence in the (new) TA. If due to regional subscription restrictions or access restrictions the UE is not allowed to attach in the TA, the new MME rejects the Attach Request with an appropriate cause, and may return an Insert Subscriber Data Ack message to the HSS. If subscription checking fails for other reasons, the new MME rejects the Attach Request with an appropriate cause and returns an Insert Subscriber Data Ack message to the HSS including an error cause. If all checks are successful then the new MME constructs a context for the UE and returns an Insert Subscriber Data Ack message to the HSS.\n12.\tThe HSS acknowledges the Update Location message by sending an Update Location Ack to the new MME. If the Update Location is rejected by the HSS, the new MME rejects the Attach Request from the UE with an appropriate cause.\n13.\tIf a subscribed PDN address is allocated for the UE for this APN, the PDN subscription context contains the UE's IPv4 address and/or the IPv6 prefix and optionally the PDN GW identity.  In case the PDN subscription context contains a subscribed IPv4 address and/or IPv6 prefix, the MME indicates it in the PDN address. If the PDN subscription context contains no PDN GW identity the new MME selects a PDN GW as described in clause\u00a04.3.8.1 on PDN GW selection function (3GPP accesses). If the PDN subscription context contains a dynamically allocated PDN GW identity and the Attach Type does not indicate \"Handover\" the MME may select a new PDN GW as described in clause PDN GW selection function, e.g. to allocate a PDN GW that allows for more efficient routing. If the PDN subscription profile contains no PDN GW address for the default PDN and the Attach Type indicates \"Handover\" the MME select a new PDN GW as described in clause PDN GW selection function. The new MME selects a Serving GW as described in clause 4.3.8.2 on Serving GW selection function and allocates an EPS Bearer Identity for the Default Bearer associated with the UE. Then it sends a Create Default Bearer Request (IMSI, MSISDN, MME TEID for control plane, PDN GW address, PDN Address, APN, RAT type, Default Bearer QoS, PDN Type, APN-AMBR, EPS Bearer Identity, Protocol Configuration Options, ME Identity, User Location Information (ECGI), Selection Mode, Charging Characteristics, Trace Reference, Trace Type, Trigger Id, OMC Identity, Maximum APN Restriction, Dual Address Bearer Flag, the Protocol Type over S5/S8) message to the selected Serving GW.\n\tThe RAT type is provided in this message for the later PCC decision. The AMBR applied to the relevant PDN access is also provided in this message. The MSISDN is included if provided in the subscription data from the HSS. Selection Mode indicates whether a subscribed APN was selected, or whether a nonsubscribed APN chosen by the MME was selected. Selection Mode is set according to Annex\u00a0A of TS\u00a023.060\u00a0[7]. The PGW may use Selection Mode when deciding whether to accept or reject the default bearer activation. For example, if an APN requires subscription, the PGW is configured to accept only the default bearer activation that requests a subscribed APN as indicated by Selection Mode. Charging Characteristics indicates which kind of charging the bearer context is liable for. The Dual Address Bearer Flag shall be set when the UE requests PDN type IPv4v6 and all SGSNs which the UE may be handed over to are Release\u00a08 or above supporting dual addressing, which is determined based on node pre-configuration by the operator. The Protocol Type over S5/S8 is provided to Serving GW which protocol should be used over S5/S8 interface.\n\tThe charging characteristics for the PS subscription and individually subscribed APNs as well as the way of handling Charging Characteristics and whether to send them or not to the PGW is defined in TS 32.251\u00a0[44]. The MME shall include Trace Reference, Trace Type, Trigger Id, and OMC Identity if SGW and/or PGW trace is activated. The MME shall copy Trace Reference, Trace Type, and OMC Identity from the trace information received from the HLR or OMC.\n\tThe Maximum APN Restriction denotes the most stringent restriction as required by any already active bearer context. If there are no already active bearer contexts, this value is set to the least restrictive type (see clause 15.4 of TS\u00a023.060\u00a0[7]). If the PGW receives the Maximum APN Restriction, then the PGW shall check if the Maximum APN Restriction value does not conflict with the APN Restriction value associated with this bearer context request. If there is no conflict the request shall be allowed, otherwise the request shall be rejected with sending an appropriate error cause to the UE.\n14.\tThe Serving GW creates a new entry in its EPS Bearer table and sends a Create Default Bearer Request (IMSI, MSISDN, APN, Serving GW Address for the user plane, Serving GW TEID of the user plane, Serving GW TEID of the control plane, RAT type, Default Bearer QoS, PDN Type, PDN Address, APN-AMBR, EPS Bearer Identity, Protocol Configuration Options, ME Identity, User Location Information (ECGI), Selection Mode, Charging Characteristics, Trace Reference, Trace Type, Trigger Id, OMC Identity, Maximum APN Restriction, Dual Address Bearer Flag) message to the PDN GW indicated by the PDN GW address received in the previous step. After this step, the Serving GW buffers any downlink packets it may receive from the PDN GW until receives the message in step 21 below. The MSISDN is included if received from the MME.\n15.\tIf dynamic PCC is deployed, the PDN GW performs an IP-CAN Session Establishment procedure as defined in TS\u00a023.203\u00a0[6], and thereby obtains the default PCC rules for the UE. This may lead to the establishment of a number of dedicated bearers following the procedures defined in clause 5.4.1 in association with the establishment of the default bearer, which is described in Annex\u00a0F.\n\tThe IMSI, UE IP address, User Location Information (ECGI), Serving Network, RAT type, APN-AMBR, Default Bearer QoS are provided to the PCRF by the PDN GW if received by the previous message. The User Location Information is used for location based charging.\nNOTE:\tWhile the PDN GW/PCEF may be configured to activate predefined PCC rules for the default bearer, the interaction with the PCRF is still required to provide e.g. the UE IP address information to the PCRF.\n\tIf dynamic PCC is not deployed, the PDN GW may apply local QoS policy.\nEditor's note: \tIt is FFS if the AMBR shall be sent to the PCRF, and if the PCRF is allowed to change the value of the AMBR.\nEditor's note:\tThe parameters used for User Location Information are FFS.\n16.\tThe PGW creates a new entry in its EPS bearer context table and generates a Charging Id. The new entry allows the PGW to route user plane PDUs between the SGW and the packet data network, and to start charging. The way the PGW handles Charging Characteristics that it may have received is defined in TS\u00a032.251\u00a0[44].\n\tThe PDN GW returns a Create Default Bearer Response (PDN GW Address for the user plane, PDN GW TEID of the user plane, PDN GW TEID of the control plane, PDN Type, PDN Address, EPS Bearer Identity, Protocol Configuration Options, UL TFT, Charging Id, Prohibit Payload Compression, APN Restriction, Cause, CGI/SAI/RAI change report required, BCM) message to the Serving GW. The PDN GW takes into account the PDN type sent by the UE , the Dual Address Bearer Flag and the policies of operator when the PDN GW selects the PDN type to be used as follows. If the UE has requested PDN type IPv4v6 and both IPv4 and IPv6 addressing is possible in the PDN but the Dual Address Bearer Flag is not set, or only single IP version addressing is possible in the PDN, the PDN GW selects a  single IP version (either IPv4 or IPv6). If the UE has requested PDN type IPv4 or IPv6, the PDN GW uses the PDN type supplied by the UE in case it is supported in the PDN, otherwise an appropriate error cause will be returned. The PDN GW allocates a PDN Address according to the selected PDN type. In case the PDN GW has selected a PDN type different from the one sent by the UE, the PDN GW indicates together with the PDN type IE a reason cause (network preference, single address bearers only) to the UE why the PDN type has been modified.  PDN Address may contain an IPv4 address for IPv4 and/or an IPv6 prefix and an Interface Identifier. If the PDN has been configured by the operator so that the PDN addresses for the requested APN shall be allocated by usage of DHCPv4 only, or if the PDN GW allows the UE to use DHCPv4 for address allocation according to the Address Allocation Preference received from the UE, the PDN Address shall be set to 0.0.0.0, indicating that the IPv4 PDN address shall be negotiated by the UE with DHCPv4 after completion of the Default Bearer Activation procedure. In case of external PDN addressing for IPv6, the PDN GW obtains the IPv6 prefix from the external PDN using either RADIUS or Diameter client function. In the PDN Address field of the Create Default Bearer Response, the PDN GW includes the Interface Identifer and IPv6 prefix. The PDN GW sends Router Advertisement to the UE after default bearer establishment with the IPv6 prefix information for all cases.\n\tIf the PDN address is contained in the Create Default Bearer Request, the PDN GW shall allocate the IPv4 addresss and/or IP6 prefix contained in the PDN address to the UE. The IP address allocation details are described in clause 5.3.1 on \"IP Address Allocation\". Protocol Configuration Options contains the BCM as well as optional PDN parameters that the PGW may transfer to the UE. BCM shall also be sent as a separate IE. These optional PDN parameters may be requested by the UE, or may be sent unsolicited by the PGW. Protocol Configuration Options are sent transparently through the MME. According to the used RAT BCM is set to \"UE/network\".\n17.\tIf the CGI/SAI/RAI change report required is received for this bearer context, then the SGW shall store this for the bearer context and the SGW shall report to that PGW whenever a CGI/SAI/RAI change occurs that meets the PGW request, as described in clause\u00a015.1.1a of TS\u00a023.060\u00a0[7].\n\tThe Serving GW returns a Create Default Bearer Response (PDN Type, PDN Address, Serving GW address for User Plane, Serving GW TEID for User Plane, Serving GW TEID for control plane, EPS Bearer Identity, PDN GW addresses and TEIDs (GTP-based S5/S8) or GRE keys (PMIP-based S5/S8) at the PDN GW(s) for uplink traffic, Protocol Configuration Options, UL TFT, DL TFT (for PMIP-based S5/S8), Charging Id, Prohibit Payload Compression, APN Restriction, Cause, CGI/SAI/RAI change report required, BCM) message to the new MME. The DL TFT for PMIP-based S5/S8 is obtained from interaction between the Serving GW and the PCRF as described in clause\u00a05.2 of TS\u00a023.402\u00a0[2], when PCC is deployed; otherwise, the DL TFT IE is wildcarded, matching any downlink traffic.\n18.\tIf an APN Restriction is received, then the MME shall store this value for the Bearer Context and the MME shall check this received value with the stored value for the Maximum APN Restriction to ensure there are no conflicts between values. If the Bearer Context is accepted, the MME shall determine a (new) value for the Maximum APN Restriction. If there is no previously stored value for Maximum APN Restriction, then the Maximum APN Restriction shall be set to the value of the received APN Restriction.\n\tIf the CGI/SAI/RAI change report required is received for this bearer context, then the MME shall store this for the bearer context and the MME shall report whenever a CGI/SAI/RAI change occurs that meets the request, as described in clause\u00a015.1.1a of TS\u00a023.060\u00a0[7].\n\tThe new MME sends an Attach Accept (APN, GUTI, PDN Type, PDN Address, TAI List, EPS Bearer Identity, Session Management Configuration IE, Protocol Configuration Options, KSI, NAS sequence number, NAS-MAC, NAS security algorithm) message to the eNodeB. GUTI is included if the new MME allocates a new GUTI. This message is contained in an S1_MME control message Initial Context Setup Request. This S1 control message also includes the AS security context information for the UE, the Handover Restriction List, the EPS Bearer QoS, the UE-AMBR, EPS Bearer Identity, as well as the TEID at the Serving GW used for user plane and the address of the Serving GW for user plane. The MME includes the UL TFT and the EPS Bearer QoS parameter QCI into the Session Management Configuration IE. Furthermore, if the UE has UTRAN or GERAN capabilities, the MME uses the EPS bearer QoS information to derive the corresponding PDP context parameters QoS Negotiated (R99 QoS profile), Radio Priority and Packet Flow Id and includes them in the Session Management Configuration. If the UE indicated in the UE Network Capability it does not support BSS packet flow procedures, then the MME shall not include the Packet Flow Id. Handover Restriction List is described in clause 4.3.5.7 \"Mobility Restrictions\".\n\tNAS security algorithm indicates the NAS algorithm selected by the MME. This information element shall not be ciphered. The MME starts using the indicated NAS security algorithm with this NAS message.\n19.\tThe eNodeB sends the RRC Connection Reconfiguration message including the EPS Radio Bearer Identity to the UE, and the Attach Accept message will be sent along to the UE. The UE shall store the QoS Negotiated, Radio Priority, Packet Flow Id, which it received in the Session Management Configuration, for use when accessing via GERAN or UTRAN. The UE shall ignore the IPv6 prefix information in PDN Address. The APN is provided to the UE to notify it of the APN for which the activated default bearer is associated. The UE uses the uplink packet filter (UL TFT) to determine the mapping of uplink packets to the radio bearer. For further details, see TS\u00a036.331\u00a0[37]. The UE may provide EPS Bearer QoS information to the application handling the service data flow. The application usage of the EPS Bearer QoS is implementation dependent. The UE shall not reject the RRC Connection Reconfiguration on the basis of the EPS Bearer QoS information contained in the Session Management Configuration IE.\n\tWhen receiving the Attach Accept message the UE sets its TIN to \"GUTI\" as no ISR is indicated. And the UE's internal update status for any stored PTMSI is set to \"update-needed\".\nNOTE:\tThe IP address allocation details are described in clause 5.3.1 on \"IP Address Allocation\".\n20.\tThe UE sends the RRC Connection Reconfiguration Complete message to the eNodeB. This message includes the Attach Complete (EPS Bearer Identity, NAS sequence number, NAS-MAC) message. For further details, see TS\u00a036.331\u00a0[37]. With the Attach Complete message the UE starts using the NAS security algorithm indicated by the MME, i.e. the Attach Complete message shall be protected by the NAS security algorithm indicated by the MME.\n21.\tThe eNodeB forwards the Attach Complete message to the new MME in an S1 control message. This S1 control message includes the TEID of the eNodeB and the address of the eNodeB used for downlink traffic on the S1_U reference point.\n\tAfter the Attach Accept message and once the UE has obtained a PDN Address, the UE can then send uplink packets towards the eNodeB which will then be tunnelled to the Serving GW and PDN GW. If the UE requested for a dual address PDN type (IPv4v6) to a given APN and was granted a single address PDN type (IPv4 or IPv6) by the network with a reason cause \"single address bearers only\" sent together with the PDN type, the UE may request for the activation of a parallel PDN connection to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated. If the UE receives no reason cause in step\u00a018 in response to an IPv4v6 PDN type and it receives an IPv6 prefix and Interface Identifier apart from the IPv4 address or 0.0.0.0 in the PDN Address field, it considers that the request for a dual address PDN was successful. It can wait for the Router Advertisement from the network with the IPv6 prefix information or it may send Router Solicitation if necessary.\n22.\tThe new MME sends an Update Bearer Request (eNodeB address, eNodeB TEID) message to the Serving GW.\n23.\tThe Serving GW acknowledges by sending Update Bearer Response (EPS Bearer Identity) message to the new MME. The Serving GW can then send its buffered downlink packets.\n24.\tAfter the MME receives Update Bearer Response (EPS Bearer Identity) message, if an EPS bearer was established and the subscription data indicates that the user is allowed to perform handover to non-3GPP accesses, and if the MME selected a PDN GW that is different from the PDN GW identity which was indicated by the HSS in the PDN subscription context, the MME shall send an Update Location Request including the APN and PDN GW identity to the HSS for mobility with non-3GPP accesses.\n25.\tThe HSS stores the APN and PDN GW identity pair and sends an Update Location Response to the MME.\n\nEnd of change\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the UE ISR function is activated before the attach procedure, the UE has two valid TMSIs, and both old SGSN and old MME are both registered in the HSS. In the Attach Request message, the UE shall provide these two TMSIs, and the new MME can get the IMSI from the old SGSN if the old MME can not provide the IMSI of the UE if the old MME has Purged this UE while the old SGSN does not Purge this UE, and the new MME does not need to send Identity Request message to ask the UE to provide IMSI. The Identify Request/Response message asking for IMSI is not securely protected, and the message can decrease the security of the EPS system, and should be used as less as possible to protect the EPS system. If two TMSIs are provided in the Attach Request, the chance of the Identify Request/Response message asking for IMSI is decreased and EPS system secrurity can be improved.\n\n>>> SUMMARY OF CHANGE\nUE provides two TMSIs if available in the Attach Request message, the new MME gets the IMSI from old SGSN and old MME .\n\n>>> CONSEQUENCES IF NOT REVISED\nThere are high security threat to the EPS system."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * Start of Changes * * * \n4.12.2.2\tRegistration procedure for untrusted non-3GPP access\nThe signalling flow in Figure 4.12.2.2-1 does not show all the details of a registration procedure via untrusted non-3GPP access. It shows primarily the steps executed between the UE and N3IWF. All the details of a registration procedure, including interactions with PCF, UDM, etc. are specified in clause\u00a04.2.2.2.2.\n\nFigure 4.12.2.2-1: Registration via untrusted non-3GPP access\n1.\tThe UE connects to an untrusted non-3GPP access network with procedures outside the scope of 3GPP and it is assigned an IP address. Any non-3GPP authentication method can be used, e.g. no authentication (in case of a free WLAN), EAP with pre-shared key, username/password, etc.When the UE decides to attach to 5GC network, the UE selects an N3IWF in a 5G PLMN, as described in TS\u00a023.501\u00a0[2] clause\u00a06.3.6.\n2.\tThe UE proceeds with the establishment of an IPsec Security Association (SA) with the selected N3IWF by initiating an IKE initial exchange according to RFC\u00a07296\u00a0[3]. After step 2, all subsequent IKE messages are encrypted and integrity protected by using the IKE SA established in this step.\n3.\tThe UE shall initiate an IKE_AUTH exchange by sending an IKE_AUTH request message. The AUTH payload is not included in the IKE_AUTH request message, which indicates that the IKE_AUTH exchange shall use EAP signalling (in this case EAP-5G signalling). If the UE supports MOBIKE, it shall include a Notify payload in the IKE_AUTH request, as specified in RFC\u00a04555\u00a0[40], indicating that MOBIKE is supported. In addition, as specified in TS\u00a033.501\u00a0[15], if the UE is provisioned with the N3IWF root certificate, it shall include the CERTREQ payload within the IKE_AUTH request message to request the N3IWF's certificate.\n4.\tThe N3IWF responds with an IKE_AUTH response message, which includes an EAP-Request/5G-Start packet. The EAP-Request/5G-Start packet informs the UE to initiate an EAP-5G session, i.e. to start sending NAS messages encapsulated within EAP-5G packets. If the N3IWF has received a CERTREQ payload from the UE, the N3IWF shall include the CERT payload in the IKE_AUTH response message conaining the N3IWF's certificate. How the UE uses the N3IWF's certificate is specified in TS\u00a033.501\u00a0[15].\n5.\tThe UE shall send an IKE_AUTH request, which includes an EAP-Response/5G-NAS packet that contains the Access Network parameters (AN parameters) and a Registration Request message. The AN parameters contain information that is used by the N3IWF for selecting an AMF in the 5G core network. This information includes e.g. the GUAMI, the Selected PLMN ID, the Requested NSSAI and the Establishment cause. The Establishment cause provides the reason for requesting a signalling connection with 5GC.\nNOTE\u00a01:\tThe N3IWF does not send an EAP-Identity request because the UE includes its identity in the first IKE_AUTH. This is in line with RFC7296, clause\u00a03.16.\n6.\tThe N3IWF shall select an AMF based on the received AN parameters and local policy, as specified in TS\u00a023.501\u00a0[2], clause\u00a06.3.5. The N3IWF shall then forward the Registration Request received from the UE to the selected AMF within an N2 message. This message contains N2 parameters that include the Selected PLMN ID and the Establishment cause.\n7.\tThe selected AMF may decide to request the SUCI by sending a NAS Identity Request message to UE. This NAS message and all subsequent NAS messages are sent to UE encapsulated within EAP/5G-NAS packets.\n8.\tThe AMF may decide to authenticate the UE by invoking an AUSF. In this case, the AMF shall select an AUSF as specified in TS\u00a023.501\u00a0[2] clause\u00a06.3.4 based on SUPI or SUCI.\n\tThe AUSF executes the authentication of the UE as specified in TS\u00a033.501\u00a0[15]. The AUSF selects a UDM as described in TS\u00a023.501\u00a0[2], clause\u00a06.3.8 and gets the authentication data from UDM. The authentication packets are encapsulated within NAS authentication messages and the NAS authentication messages are encapsulated within EAP/5G-NAS packets. After the successful authentication:\n-\tIn step 8h, the AUSF shall send the anchor key (SEAF key) to AMF which is used by AMF to derive NAS security keys and a security key for N3IWF (N3IWF key). The UE also derives the anchor key (SEAF key) and from that key it derives the NAS security keys and the security key for N3IWF (N3IWF key). The N3IWF key is used by the UE and N3IWF for establishing the IPsec Security Association (in step 11).\n-\tIn step 8h, the AUSF shall also include the SUPI, if in step 8a the AMF provided to AUSF a SUCI .\nNOTE\u00a02:\tEAP-AKA' or 5G-AKA are allowed for the authentication of UE via non-3GPP access, as specified in TS\u00a033.501\u00a0[15]. Figure 4.12.2.2-1 only shows authentication flow using EAP-AKA'.\n9a.\tThe AMF shall send a NAS Security Mode Command to UE in order to activate NAS security. If an EAP-AKA' authentication was successfully executed in step 8, the AMF shall encapsulate the EAP-Success received from AUSF within the NAS Security Mode Command message.\n9b.\tThe N3IWF shall forward the NAS Security Mode Command message to UE within an EAP/5G-NAS packet.\n9c.\tThe UE completes the EAP-AKA' authentication (if initiated in step 8), creates a NAS security context and an N3IWF key and sends the NAS Security Mode Complete message within an EAP/5G-NAS packet.\n9d.\tThe N3IWF relays the NAS Security Mode Complete message to the AMF.\n10a.\tUpon receiving NAS Security Mode Complete, the AMF shall send an NGAP Initial Context Setup Request message that includes the N3IWF key.\n10b.\tThis triggers the N3IWF to send an EAP-Success to UE, which completes the EAP-5G session. No further EAP-5G packets are exchanged.\n11.\tThe IPsec SA is established between the UE and N3IWF by using the common N3IWF key that was created in the UE in step 9c and received by the N3IWF in step\u00a010a. This IPsec SA is referred to as the \"signalling IPsec SA\". After the establishment of the signalling IPsec SA, the N3IWF notifies the AMF that the UE context (including AN security) was created by sending a NGAP Initial Context Setup Response. The signalling IPsec SA shall be configured to operate in tunnel mode and the N3IWF shall assign to UE an \"inner\" IP address. If the N3IWF has received an indication that the UE supports MOBIKE (see step\u00a03), then the N3IWF shall include a Notify payload in the IKE_AUTH response message sent in step\u00a011a, indicating that MOBIKE shall be supported, as specified in RFC\u00a04555\u00a0[40].\n\tAll subsequent NAS messages exchanged between the UE and N3IWF shall be sent via the signalling IPsec SA and shall be carried over TCP/IP. The UE shall send NAS messages within TCP/IP packets with source address the \"inner\" IP address of the UE and destination address the NAS_IP_ADDRESS that is received in step\u00a011a. The N3IWF shall send NAS messages within TCP/IP packets with source address the NAS_IP_ADDRESS and destination address the \"inner\" IP address of the UE. The TCP connection used for reliable NAS transport between the UE and N3IWF shall be initiated by the UE right after the signalling IPsec SA is established in step\u00a011a. The UE shall send the TCP connection request to the NAS_IP_ADDRESS and to the TCP port number specified in TS\u00a024.502\u00a0[41].\n12.\tThe AMF sends the NAS Registration Accept message to the N3IWF. The N2 Message includes the Allowed NSSAI for the access type for the UE.\n13.\tThe N3IWF forwards the NAS Registration Accept to UE via the established signalling IPsec SA. If the NAS Registration Request message is received by the N3IWF before the IPsec SA is established, the N3IWF shall store it and forward it to the UE only after the establishment of the signalling IPsec SA.\n\tThe AMF provides the Access Type set to \"Non-3GPP access\" to the UDM when it registers with the UDM.\n\n* * * End of Changes * * * \n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is erroneously assumed that the UE can connect to an untrusted non-3GPP access network using only a non-3GPP authentication method, e.g. no authentication (in case of a free WLAN), EAP with pre-shared key, username/password, etc. However, if the UE supports the 3GPP-based authentication procedure specified in TS 33.402 and, if the selected non-3GPP access network supports AAA-interworking (i.e. the SWa interface) with one or more EPCs, then the UE can connect to the untrusted non-3GPP access network using the 3GPP-based authentication procedure specified in TS 33.402.\n\n>>> SUMMARY OF CHANGE\nChanges are made so that the UE may connect to an untrusted non-3GPP access network by applying the 3GPP-based authentication procedure specified in TS 33.402, if the selected non-3GPP access network supports the SWa interface with one or more EPCs.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt shall not be possible to apply the 3GPP-based authentication procedure specified in TS 33.402 for connecting to an untrusted non-3GPP access network and, hence, the UE might not be able to connect to an available non-3GPP access network."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n------------------------------- FIRST CHANGE -------------------------------\n5.4.2.5\tAuthentication not accepted by the network\nIf the authentication response returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the GUTI was used; or\n-\tif the IMSI was used.\nIf the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should proceed as described below.\nIf the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE.\nUpon receipt of an AUTHENTICATION REJECT message, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed.\n\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the timers T3410, T3417 or T3430 (if running) and enter state EMM-DEREGISTERED.\n------------------------------- END OF CHANGE -------------------------------\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nInteraction with A/Gb and Iu mode for authentication not accepted by the network is not specified.\n\n>>> SUMMARY OF CHANGE\nImpacts on MM and GMM parameters added for authentication not accepted by the network.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe MM and GMM context is kept when authentication is not accepted by the network, even though the USIM is considered as invalid."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n********************Start of change (All new text)***************\n7.2.X\tRRC Connection Re-establishment for data via MME only\n7.2.X.1\tGeneral\nThe purpose of this procedure is to allow the UE only has connection for data via MME to re-establish RRC connection when RLF happens. The UE may re-establish RRC connection in the same or different eNB than where the UE last had an active RRC connection with.\n7.2.X.2\tRRC connection establishment \nWhen receiving an RRC Connection Establishment Request message from a UE, the eNB sends a S1-AP Initial UE Message to the MME. Upon reception of a S1-AP Initial UE Message from the eNB, if the MME determines to perform NAS SMC procedure, it shall check its local policy for selecting an integrity algorithm that supported by the MME, the UE, and the eNB, and then use the selected integrity algorithm in the NAS SMC procedure. The MME shall derive KeNB as defined in Annex A.3, and send it with the algorithm used for NAS integrity protection to the eNB in the S1-AP Connection Establishment Indication message or S1-AP Downlink NAS Transport message. Upon reception of the S1-AP Connection Establishment Indication message or S1-AP Downlink NAS Transport message, the eNB shall store the KeNB and the algorithm in the security information of the UE.\nAfter sending out the RRC Connection Establishment Request message, if the UE has current EPS security context, it shall derive KeNB as defined in Annex A.3. The UE shall store the KeNB and the algorithm used for NAS integrity protection in the AS security information.\n7.2.X.3\tRRC connection re-establishment to a new eNB\nWhen the UE detects that RLF happens, the UE shall derive KRRCint as defined in Annex A.7. The UE sends the RRC Connection Re-establishment Request message on SRB0 and hence it is not integrity protected. The UE shall include a ShortMAC-I in the RRC Connection Re-establishment Request message. The ShortMAC-I is a message authentication token, which shall be calculated as described in 7.4.3.\nThe target eNB extracts the source Cell-ID, source C-RNTI, and ShortMAC-I from the RRC Connection Re-establishment Request. The target eNB can obtain the source PCI from a cell configuration database by means of the source Cell-ID. The target eNB contacts the source eNB based on the information in the source Cell-ID and source C-RNTI by sending a RLF Indication message on X2 interface including the source PCI, source C-RNTI, ShortMAC-I and Cell-ID of target cell. \nThe source eNB retrieves the stored UE context including security information from its database identified by the C-RNTI. The source eNB derives KRRCint as defined in Annex A.7, and then calculates and verifies the ShortMAC-I (calculating it in the same way as described in 7.4.3). If the check of the ShortMAC-I is successful, then the source eNB shall perform KeNB* derivation as is done in case of X2-handover described in 7.2.8.4.2. The source eNB forwards the UE context including the security information to the target eNB on X2 interface. The security information includes the new derived KeNB*, the NCC associated to the KeNB*, and the integrity algorithm. The target eNB shall check if it supports the integrity algorithm. If this is not the case, the target eNB shall send an appropriate error message to the UE. If the check is successful the target eNB responds with a RRC Connection Re-establishment message including the NCC received from source eNB to the UE on SRB0 and hence it is not integrity protected.\nWhen the UE receives the RRC Connection Re-establishment message, the UE shall firstly synchronize the locally kept NH parameter as defined in Annex A.4 if the received NCC value is different from the current NCC value in the UE itself. The UE then calculates a new KeNB* from either the new NH (if a new NCC value was received) or the current KeNB, using the target cell\u2019s PCI and its frequency EARFCN-DL in the target cell. The UE shall use this KeNB* as KeNB, and send the RRC Connection Re-establishment Complete message to the target eNB on SRB1 but not integrity protected and ciphered.\nAfter a successful re-establishment the target eNB shall perform Path Switch procedure as is done in case of X2-handover. \n7.2.X.4\tRRC connection re-establishment to the same eNB\nThe target eNB may be the same as the source eNB in the description in the previous subclause. If so the single eNB performs the roles of both the source and target eNB. In particular, a new KeNB* shall be derived even if the UE is re-establishing to the same eNB.\n********************End of change***************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nMobility enhancement for NBIoT CP solution uses RRC Connection Re-establishment Request to re-establish the connection when RLF happens. The RRC Connection Re-establishment Request needs to contain a token for identifying the UE.\n\n>>> SUMMARY OF CHANGE\nNew clause 7.2.X\n\n>>> CONSEQUENCES IF NOT REVISED\nFake UE can perform Re-establishment on behave of a real UE, and makes the real UE out of service."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*** First change ***\n5.4.1.1\tGeneral\nThe purpose of the primary authentication and key agreement procedure is to enable mutual authentication between the UE and the network and to provide keying material that can be used between the UE and network in subsequent security procedures, as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nTwo methods are defined:\na)\tEAP based primary authentication and key agreement procedure.\nb)\t5G AKA based primary authentication and key agreement procedure.\nThe UE and the AMF shall support the EAP based primary authentication and key agreement procedure and the 5G AKA based primary authentication and key agreement procedure.\n\n\n\n\n\n*** End of changes ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn LS S3-210706, SA3 stated \u201cRunning of the NAS SMC procedure after primary authentication as soon as possible is essential to keep the stored KAUSF aligned between the UE and home network\u201d and asked CT1 to \u201cprovide feedback on the feasibility to perform NAS SMC procedure immediately after successful run of primary authentication\u201d.To address this, it is proposed to add a recommendation that the AMF should initiate a NAS security mode control procedure to take the new partial native 5G NAS security context into use immediately after a successful primary authentication, to avoid situations where the KAUSF at the UE and the KAUSF at the network become misaligned.\n\n>>> SUMMARY OF CHANGE\nA recommendation that the AMF should initiate a NAS security mode control procedure to take the new partial native 5G NAS security context into use immediately after a successful primary authentication, to avoid situations where the KAUSF at the UE and the KAUSF at the network become misaligned was added.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt will remain unclear in the specification that not running a NAS security mode control procedure immediately after a successful primary authentication can lead to the KAUSF at the UE and the KAUSF at the network becoming misaligned."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**** First Change ****\n13.1\tProtection at the network or transport layer\nAll network functions shall support TLS. Network functions shall support both server-side and client-side certificates for authentication between each-other. If TLS is used for service based interfaces, all network functions shall use both server-side certificates and client-side certificates for authentication.\nThe TLS profile shall follow the profile given in Annex E of TS 33.310 [5] with the restriction that it shall be compliant with the profile given by HTTP/2 [47].\nTLS shall be used within a PLMN unless network security is provided by other means.\nOn the N32 interface, TLS shall be supported between the SEPP and the next-hop IPX entity. \nIf there are no IPX entities between the SEPPs, TLS shall be used between the SEPPs. \nNOTE 1: It is strongly recommended to use TLS between the SEPP and the next-hop IPX entity.\nNOTE 2: Additional application layer security according to the requirements in clause 5.6.3 is needed for protection between the SEPPs.\n\n\n**** Next Change ****\n13.3\tAuthorization and authentication between network functions and the NRF Authentication and static authorization \n\nNRF and NF shall authenticate each other during discovery and registration. If the PLMN uses protection at the transport layer, authentication provided by the transport layer protection solution shall be used for mutual authentication of the NRF and NF.\nProcedures for transport layer protection of service base interfaces are specified in clause 13.1 of the present document.\nIf the PLMN does not use protection at the transport layer, mutual authentication of NRF and NF may be implicit by NDS or physical security.\nAfter successful authentication between NRF and NF, the NRF shall decide whether the NF is authorized to perform discovery and registration.\nEditor\u2019s Note: It is FFS how to perform authentication between NRFs in case a non-transparent proxy (SEPP) is in between them. \nFor non-roaming scenario, the NRF authorizes the Nnrf_NFDiscovery_Request based on the profile of the expected NF/NF service and the type of the NF service consumer, the NRF determines whether the NF service consumer is allowed to discover the expected NF instance(s) as described in clause 4.17.4 of TS 23.502 [8].\nFor roaming scenario, the NRF of the service producer NF Provider shall authorize the Nnrf_NFDiscovery_Request based on the profile of the expected NF/NF Service, the type of the NF service consumer and the serving network ID.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**** End of Changes ****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nS3-181486: NF to NF authentication not explicity specified.S3-181825: Authentication and authorization clairificationsS3-181642: Clause 13.3 refers to 13.1 for transport layer protection procedure, while there\u2019s no procedure in 13.1.\n\n>>> SUMMARY OF CHANGE\nS3-181486: Specify intra PLMN NF to NF mutual authentication.S3-181825: Add clauses for NF \u2013 SEPP, NRF \u2013 SEPP and SEPP \u2013 SEPP authentication and authorizationS3-181642: Remove sentence of reference to transport layer protection procedure as there\u2019s no procedure.\n\n>>> CONSEQUENCES IF NOT REVISED\nS3-181486: Not clear how NFs in the same network would authenticate. S3-181825: Authentication and authorization not clearly statedS3-181642: Confuse."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n5.5.1.3.5\tMobility and periodic registration update not accepted by the network\nIf the mobility and periodic registration update request cannot be accepted by the network, the AMF shall send a REGISTRATION REJECT message to the UE including an appropriate 5GMM cause value.\nWhen the UE performs inter-system change from S1 mode to N1 mode, if the AMF is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message included by the UE in the EPS NAS message container IE of the REGISTRATION REQUEST message has failed in the MME, the AMF should send REGISTRATION REJECT message including 5GMM cause #9 \"UE identity cannot be derived by the network\".\nThe UE shall take the following actions depending on the 5GMM cause value received in the REGISTRATION REJECT message.\n#3\t(Illegal UE); or\n#6\t(Illegal ME).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as invalid for 5GS services until switching off or the UICC containing the USIM is removed. The UE shall delete the list of equivalent PLMNs and shall move to 5GMM-DEREGISTERED state.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed. If the UE is in EMM-REGISTERED state, the UE shall move to EMM-DEREGISTERED state.\n\tIf the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#7\t(5GS services not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as invalid for 5GS services until switching off or the UICC containing the USIM is removed. The UE shall move to 5GMM-DEREGISTERED state.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value. \n\tIf the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#9\t(UE identity cannot be derived by the network).\n\tThe UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall enter the state 5GMM-DEREGISTERED.\n\tIf the rejected request was not for initiating an emergency PDU session, the UE shall subsequently, automatically initiate the initial registration procedure.\nNOTE\u00a01:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#10\t(implicitly de-registered).\n\tThe UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped 5G security context or partial native 5G security context.\n\tIf the registration rejected request was not for initiating an emergency PDU session, the UE shall perform a new registration procedure for initial registration.\nNOTE\u00a02:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#11\t(PLMN not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall store the PLMN identity in the \"forbidden PLMN list\", delete the list of equivalent PLMNs, reset the registration attempt counter and enter the state 5GMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#12\t(Tracking area not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n\tThe UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete the list of equivalent PLMNs. The UE shall reset the registration attempt counter and shall change to state 5GMM-REGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present.\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#15\t(No suitable cells in tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). The UE shall reset the registration attempt counter and shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28].\n\tThe UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list, if present.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion).\n\tIf the T3346 value IE is present in the REGISTRATION REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall abort the registration procedure for mobility and periodic registration update. If the rejected request was not for initiating an emergency PDU session, the UE shall set the 5GS update status to 5U2 NOT UPDATED and change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the REGISTRATION REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the REGISTRATION REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The registration procedure for mobility and periodic registration update is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#27\t(N1 mode not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter and shall enter the state 5GMM-NULL.\n\tThe UE shall disable the N1 mode capability for both 3GPP access and non-3GPP access (see subclause\u00a04.9).\n#72\t(Non-3GPP access to 5GCN not allowed).\n\tWhen received over non-3GPP access the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter and enter the state 5GMM-DEREGISTERED.\nNOTE:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n\tThe UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\n\tAs an implementation option, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf received over 3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.7.\n#73\t(Serving network not authorized).\n\tThe UE shall set the 5GS update status to 5U2 NOT UPDATED, reset the registration attempt counter, store the PLMN identity in the \"forbidden PLMN list\" and enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. \nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.3.7.\n\n***** End of changes *****\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe following was captured in the latest version of TS24.501:When the UE performs inter-system change from S1 mode to N1 mode, if the AMF is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message included by the UE in the EPS NAS message container IE of the REGISTRATION REQUEST message has failed in the MME, the AMF should send REGISTRATION REJECT message including 5GMM cause #9 \"UE identity cannot be derived by the network\".However the above statement has not considered whether the AMF will perform the integrity protection check or perform the AKA authentication procedure.If the AMF has successfully passed the integrity protection check or has performed the authentication procedure successfully, then the AMF can also request the MM context and the PDN connection context from the MME. This can avoid this rejection of the mobility registration procedure.\n\n>>> SUMMARY OF CHANGE\nIf the source MME verification of IP of TAU request message, then the AMF may reject the mobility registration procedure with 5GMM cause #9 \"UE identity cannot be derived by the network\".Interoperability impact analysis: The changes in this CR are backwards compatible.\n\n>>> CONSEQUENCES IF NOT REVISED\nUnnecessary rejection of mobility registration procedure even the target AMF can successfully verify the IP of the registration request message or perform the authentication procedure."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n************************ Start of change 1 *********************************\n5.1.2.1\tIdentity management functional model\nThe mission critical Identity Management functional model is shown in figure 5.1.2.1-1 and consists of the identity management server located in the MCX common services core and the identity management client located in the MCX UE. The IdM server and the IdM client in the MCX UE establish the foundation for MCX user authentication and user authorization.\nThe CSC-1 reference point, between the IdM client in the UE and the Identity Management server, provides the interface for user authentication. CSC-1 is a direct HTTP interface between the IdM client in the UE and the IdM server and shall support OpenID Connect 1.0 ([19], [20] and [21]).\nThe OpenID Connect profile for MCX shall be implemented as defined in annex B. MCX user authentication, MCX user service authorization, OpenID Connect 1.0, and the OpenID Connect profile for MCX shall form the basis of the identity management architecture.\nIn alignment with the OpenID Connect 1.0 [21] and OAuth 2.0 standards [19] and [20], CSC-1 shall consist of two identity management interfaces; the authorization endpoint and the token endpoint.  These endpoints are separate and independent from each other, requiring separate and independent IP addressing.  The authorization endpoint server and the token endpoint server may be collectively referred to as the IdM server in this document.\nThe HTTP connection between the Identity Management client and the Identity management server shall be protected using HTTPS.\n\n\nFigure 5.1.2.1-1: Functional Model for MC Identity Management\nTo support MCX user authentication, the IdM server (IdMS) shall be provisioned with the user's MC ID and MC service IDs (the MC service ID may be the same as the MC ID). A mapping between the MC ID and MC service ID(s) shall be created and maintained in the IdMS. When an MCX user wishes to authenticate with the MCX system, the MC ID and credentials are provided via the UE IdM client to the IdMS (note that the primary authentication method used to obtain the MC ID and credentials is out of scope of the present document). The IdMS receives and verifies the MC ID and credentials, and if valid returns an ID token, refresh token, and access token to the UE IdM client specific to the credentials. The IdM client learns the user's MC service ID(s) from the ID token. Table 5.1.2.1-1 shows the MCX tokens and their usage.\nTable 5.1.2.1-1: MC tokens\nToken Type\tConsumer of the Token\tDescription (See Annex B for details)\nID token\tUE client(s)\tContains the MC service ID for at least one authorised service (MCPTT ID, MCVideo ID, MCData ID).  Also may contain other info related to the user that is useful to the client.\nAccess token\tKMS, MCPTT server, etc. (Resource Server)\tShort-lived token (definable in the IdMS) that conveys the user's identity. This token contains the MC service ID for at least one authorised service (MCPTT ID, MCVideo ID, MCData ID).\nRefresh token\tIdM server (Authorization Server)\tAllows UE to obtain a new access token without forcing user to log in again.\nSecurity token\tPartner IdM server (Authorisation server)\tShort-lived token (definable in the IdMS) that conveys the user's identity to an Identity management server in a partner MC domain.  User access to services within the partner domain are based on the validation of this token.\n\nIn support of MCX user authorization, the access token(s) obtained during user authentication is used to gain MCX services for the user.  MCX user service authorisation is defined in clause 5.1.3.\nTo support the MCX identity functional model, the MC service ID(s) shall be:\n-\tProvisioned into the IdM database and mapped to MC IDs.\n-\tProvisioned into the KMS and mapped to identity associated keys.\n-\tProvisioned into the MCX user database and mapped to a user profile; and\n-\tProvisioned into the GMS(s) and mapped to Group IDs.\nFurther details of the user authorization architecture are found in clause 5.1.3.\n************************  End of change 1 *********************************\n************************ Start of change 2 *********************************\n5.6\tKey management for one-to-one (private) communications (PCK)\nThe purpose of this procedure is to allow two MCP UEs to create an end-to-end security context to protect an MCX private communication. To create the security context, the initiating MCX UE generates a Private Communication Key (PCK) and securely transfers this key, along with a key identifier (PCK-ID), to the terminating MCX UE. Prior to key distribution, both MCX UE shall be provisioned by the Key Management Server (KMS) with time-limited key material associated with the MCX user as described in clause 5.3.\nThe PCK is distributed between the MCX clients using the security mechanism described in clause 5.2.2, transported over the SIP bearer within the SDP content of a SIP INVITE (or within the SDP content of a SIP MESSAGE message when used for MCData SDS). The SAKKE-to-self extension may be included as defined in clause 5.2.5. Identity hiding may be supported as defined in clause 5.2.6.\nThe initiating entity shall be the initiating MCX user. The initiating entity URI shall be the MCX ID of the initiating user. The receiving entity shall be the terminating MCX user. The receiving entity URI shall be the MCX ID of the terminating user.  The distributed key, K, shall be the PCK and the distributed identifier K-ID shall be the PCK-ID.\nClause E.2 provides MIKEY message structure for PCK distribution. \n************************  End of change 2 *********************************\n************************ Start of change 3 *********************************\n5.7.1\tGeneral\nTo create the group's security association, a Group Master Key (GMK) and associated identifier (GMK-ID) is distributed to MCX UEs by a Group Management Server (GMS). The GMK is distributed encrypted specifically to a user and signed using an identity representing the Group Management Server. Prior to group key distribution, each MCX UE within the group shall be provisioned by the MCX Key Management Server (KMS) with time-limited key material associated with the MCX user as described in clause 5.3. The Group Management Server shall also be provisioned by the MCX KMS with key material for the GMS's identity (the GMS Server URI).\nThe GMK is distributed from the GMS to a MCX client using the security mechanism described in clause 5.2.2, transported over the SIP bearer. For GMKs, end-point diversity is required and hence the extension in clause 5.2.3 is applied. Additional parameters may be included as defined in clause 5.2.4. The SAKKE-to-self extension may be included as defined in clause 5.2.5. Identity hiding may be supported as defined in clause 5.2.6.\nGMKs may be managed individually per Group ID or the same GMK may be assigned to multiple MC Group IDs (using the MIKEY general extension payload defined in Clause E.6). This means that each specified MC Group ID in the MIKEY general extension payload shall use this GMK for group communications.  Assigned MC Group IDs may include any combination of MCPTT Group IDs, MCData Group IDs or MCVideo Group IDs.  Assigning the same GMK to multiple Group IDs does not prevent individual key management at a later time or vice versa.\nAn MC client may have multiple active GMKs associated with a Group ID. When this occurs, the MC client shall use the active GMK with the most recent Activation Time (as defined in Clause E.6.4) when encrypting group media.\nThe initiating entity shall be the initiating GMS. The initiating entity URI shall be the URI of the GMS (e.g. sip: gp.manager@mcptt.example.org). The receiving entity shall be the terminating MCX user. The receiving entity URI shall be the MCX ID of the terminating user.  The distributed key, K, shall be the GMK, the key identifier K-ID shall be the GMK-ID and the end-point-specific key identifier, UK-ID shall be the GUK-ID.\nClause E.3 provides MIKEY message structure for GMK distribution. \n************************  End of change 3 *********************************\n************************ Start of change 4 *********************************\nA.11\tPrivacy of MCX identities\n[33.180 MCX-A.11-001] The MCX service user identities of each plane shall be used within the corresponding plane and concealed to other planes.\n[33.180 MCX-A.11-002] When required by the MCX Service provider, MCX application services layer identities (such as the Mission Critical user identity, MCPTT ID, MCVideo ID, MCData ID and MCX Group IDs) and other application services sensitive information (as further described in 3GPP\u00a0TS\u00a023.179 [2], clause 8.2), shall be contained within the application plane and shall provide a means to support confidentiality and integrity of the application plane from the SIP signaling plane.\n[33.180 MCX-A.11-003] When protection of identities and other sensitive MCX application information is NOT required by the MCX Service provider, the MCX application services layer identities (such as the Mission Critical user identity, MCPTT ID, MCVideo ID, MCData ID and MCX Group IDs) and other application services sensitive information (as further described in 3GPP\u00a0TS\u00a023.179 [2], clause 8.2), shall remain contained within the application plane. While confidentiality protection is not required, integrity protection may be applied.\n************************  End of change 4 *********************************\n************************ Start of change 5 *********************************\nE.2.1\tGeneral\nIn the Common Header payload, the CSB ID field of MIKEY common header shall be the GUK-ID.\nWhere no crypto sessions are included in the payload, (CS# is 0), the default security profile defined in Annex E.2.2 shall be used, and no Secuirty Properties payload (SP) is required. The profile in Annex E.2.2 is mandatory to support.\nIdentity payloads shall be IDR payloads as defined in section 6.6 of IETF RFC 6043 [25]. The IDRi payload shall contain the MCX identifier associated with the group management server. The IDRr payload shall contain the MC Service user ID associated to the group management client. The message shall also include IDRkmsi and IDRkmsr that contains the URI of the MC KMS used by the group management server and MC user respectively.\nNOTE:\tIn some deployments MC Service user IDs (i.e. MCPTT ID, MCVideo ID, MCData ID) within these payloads may be treated as private. In this case, these identities may be hidden using the mechanism in clause E.7.\nThe SAKKE payload shall encapsulate the GMK to the UID generated from the MC Service user ID of the group management client. Only one GMK key shall be transported in the SAKKE payload. The same GMK shall be encapsulated to each member of the group.\nA SAKKE-to-SELF payload may be included. It is recommended that where the GMK is being transported beyond a single MC system, the message should include a SAKKE-to-SELF payload as described in clause E.5.\nA 'Key Properties' payload (Annex E.6) should be included to provide details of the GMK.\nThe signature shall use the UID generated from the identifier associated with the group management server.\n************************  End of change 5 *********************************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n\u201cMCX ID\u201d should be \u201cMCX service ID\u201d.  Otherwise MCX ID may be confused with the identity management credentials \u201cMC ID\u201d.\n\n>>> SUMMARY OF CHANGE\nChange \u201cMCX ID\u201d to \u201cMCX service ID\u201d\n\n>>> CONSEQUENCES IF NOT REVISED\nThe identity management credentials (MC ID) may be mistakenly used for the mission critical identity of the user (MCX ID), exposing the set of login credentials."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n4.7.2.1\tThe EPS bearer in general\nFor E-UTRAN access to the EPC the PDN connectivity service is provided by an EPS bearer for GTP-based S5/S8, and by an EPS bearer concatenated with IP connectivity between Serving GW and PDN GW for PMIP-based S5/S8.\nAn EPS bearer uniquely identifies traffic flows that receive a common QoS treatment between a UE and a PDN GW for GTP-based S5/S8, and between UE and Serving GW for PMIP-based S5/S8. The packet filters signalled in the NAS procedures are associated with a unique packet filter identifier on per-PDN connection basis.\nNOTE\u00a01:\tThe EPS Bearer Identity together with the packet filter identifier is used to reference which packet filter the UE intends to modify or delete, i.e. it is used to implement the unique packet filter identifier.\nThe EPS bearer traffic flow template (TFT) is the set of all packet filters associated with that EPS bearer.\nAn EPS bearer is the level of granularity for bearer level QoS control in the EPC/E-UTRAN. That is, all traffic mapped to the same EPS bearer receive the same bearer level packet forwarding treatment (e.g. scheduling policy, queue management policy, rate shaping policy, RLC configuration, etc.). Providing different bearer level packet forwarding treatment requires separate EPS bearers.\nNOTE\u00a02:\tIn addition but independent to bearer level QoS control, the PCC framework allows an optional enforcement of service level QoS control on the granularity of SDFs independent of the mapping of SDFs to EPS bearers.\nOne EPS bearer is established when the UE connects to a PDN, and that remains established throughout the lifetime of the PDN connection to provide the UE with always-on IP connectivity to that PDN. That bearer is referred to as the default bearer. Any additional EPS bearer that is established for the same PDN connection is referred to as a dedicated bearer.\nAn UpLink Traffic Flow Template (UL TFT) is the set of uplink packet filters in a TFT. A DownLink Traffic Flow Template (DL TFT) is the set of downlink packet filters in a TFT. Every dedicated EPS bearer is associated with a TFT. A TFT may be also assigned to the default EPS bearer. The UE uses the UL TFT for mapping traffic to an EPS bearer in the uplink direction. The PCEF (for GTP-based S5/S8) or the BBERF (for PMIP-based S5/S8) uses the DL TFT for mapping traffic to an EPS bearer in the downlink direction. The UE may use the UL TFT and DL TFT to associate EPS Bearer Activation or Modification procedures to an application and to traffic flow aggregates of the application. Therefore the PDN GW shall, in the Create Dedicated Bearer Request and the Update Bearer Request messages, provide all available traffic flow description information (e.g. source and destination IP address and port numbers and the protocol information).\nFor the UE, the evaluation precedence order of the packet filters making up the UL TFTs is signalled from the PGW to the UE as part of any appropriate TFT operations.\nNOTE\u00a03:\tThe evaluation precedence index of the packet filters associated with the default bearer, in relation to those associated with the dedicated bearers, is up to operator configuration. It is possible to \"force\" certain traffic onto the default bearer by setting the evaluation precedence index of the corresponding filters to a value that is lower than the values used for filters associated with the dedicated bearers.\nA TFT of a unidirectional EPS bearer is either associated with UL packet filter(s) or DL packet filter(s) that matches the unidirectional traffic flow(s) and a DL packet filter or a UL packet filter that effectively disallows any useful packet flows (see clause\u00a015.3.3.4 in TS\u00a023.060\u00a0[7] for an example of such packet filter).\nThe initial bearer level QoS parameter values of the default bearer are assigned by the network, based on subscription data (in E-UTRAN the MME sets those initial values based on subscription data retrieved from HSS).\nIn a non-roaming scenario, the PCEF may change the QoS parameter value received from the MME based on interaction with the PCRF or based on local configuration. When the PCEF changes those values, the MME shall use the bearer level QoS parameter values received on the S11 reference point during establishment or modification of the default bearer.\nIn a roaming scenario, based on local configuration, the MME may downgrade the ARP or APN-AMBR and/or remap QCI parameter values received from HSS to the value locally configured in MME (e.g. when the values received from HSS do not comply with services provided by the visited PLMN). The PCEF may change the QoS parameter values received from the MME based on interaction with the PCRF or based on local configuration. Alternatively, the PCEF may reject the bearer establishment.\nNOTE\u00a04:\tFor certain APNs (e.g. the IMS APN defined by the GSMA) the QCI value is strictly defined and therefore remapping of QCI is not permitted.\nNOTE\u00a05:\tIn roaming scenarios, the ARP/APN-AMBR/QCI values provided by the MME for a default bearer may deviate from the subscribed values depending on the roaming agreement. If the PCC/PCEF rejects the establishment of the default bearer, this implies that Attach via E-UTRAN will fail. Similarly, if the PCEF (based on interaction with the PCRF or based on local configuration) upgrades the ARP/APN-AMBR/QCI parameter values received from the MME, the default bearer establishment and attach may be rejected by the MME.\nNOTE\u00a06:\tSubscription data related to bearer level QoS parameter values retrieved from the HSS are not applicable for dedicated bearers.\nFor of E-UTRAN, the decision to establish or modify a dedicated bearer can only be taken by the EPC, and the bearer level QoS parameter values are always assigned by the EPC.\nThe MME shall not modify the bearer level QoS parameter values received on the S11 reference point during establishment or modification of a default or dedicated bearer. Instead, the MME shall only transparently forwards those values to the E-UTRAN. Consequently, \"QoS negotiation\" between the E-UTRAN and the EPC during default or dedicated bearer establishment / modification is not supported. The MME may, however, reject the establishment or modification of a default or dedicated bearer (e.g. if the bearer level QoS parameter values sent by the PCEF over a GTP based S8 roaming interface do not comply with a roaming agreement).\nThe distinction between default and dedicated bearers should be transparent to the access network (e.g. E-UTRAN).\nAn EPS bearer is referred to as a GBR bearer if dedicated network resources related to a Guaranteed Bit Rate (GBR) value that is associated with the EPS bearer are permanently allocated (e.g. by an admission control function in the eNodeB) at bearer establishment/modification. Otherwise, an EPS bearer is referred to as a Non-GBR bearer.\nNOTE\u00a07:\tAdmission control can be performed at establishment / modification of a Non-GBR bearer even though a Non-GBR bearer is not associated with a GBR value.\nA dedicated bearer can either be a GBR or a Non-GBR bearer. A default bearer shall be a Non-GBR bearer.\nNOTE\u00a08:\tA default bearer provides the UE with IP connectivity throughout the lifetime of the PDN connection. That motivates the restriction of a default bearer to bearer type Non-GBR.\nThe UE routes uplink packets to the different EPS bearers based on uplink packet filters in the TFTs assigned to these EPS bearers. The UE evaluates for a match, first the uplink packet filter amongst all TFTs that has the lowest evaluation precedence index and, if no match is found, proceeds with the evaluation of uplink packet filters in increasing order of their evaluation precedence index. This procedure shall be executed until a match is found or all uplink packet filters have been evaluated. If a match is found, the uplink data packet is transmitted on the EPS bearer that is associated with the TFT of the matching uplink packet filter. If no match is found, the uplink data packet shall be sent via the EPS bearer that has not been assigned any uplink packet filter. If all EPS bearers (including the default EPS bearer for that PDN) have been assigned one or more uplink packet filters, the UE shall discard the uplink data packet.\nNOTE\u00a09:\tThe above algorithm implies that there is at most one EPS bearer without any uplink packet filter. Therefore, some UEs may expect that during the lifetime of a PDN connection (where only network has provided TFT packet filters) at most one EPS bearer exists without any uplink packet filter.\nTo ensure that at most one EPS bearer exists without any uplink packet filter, the PCEF (for GTP-based S5/S8) and the BBERF (for PMIP-based S5/S8) applies the Session Management restrictions as described in clause\u00a09.2.0 of TS\u00a023.060\u00a0[7].\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSA2#94 agreed two CRs to 23.060-1698r2 (S2-124677) and CR 23.401-2446r2 (S2-124646) in order to remove inconsistencies between these stage 2 specifications (and inconsistencies with stage 3) concerning the handling of packet filters and the allowed packet filter configurations. As PDP contexts and EPS bearer contexts are mapped to each other during intersystem change from SGSN to MME or vice versa, and during this mapping the TFTs associated with the contexts remain unchanged, the allowed packet filter configurations for PDP contexts with BCM = \"MS/NW\" and for EPS bearer contexts should be the same.1) However, the following inconsistency between the specifications still exist:While TS 23.060 explicitly specifies that each TFT includes at least one uplink packet filter, TS 23.401, subclause 4.7.3.1, only specifes that \"there is at most one EPS bearer without any uplink packet filter\". The latter requirement would also be fulfilled e.g. by a PDN connection where each (default and dedicated) EPS bearer has an associated TFT, but one of these TFTs does not have any uplink packet filter.2) TS 23.401, subclause 4.7.3.1, indicates that unidirectional EPS bearers exist both for uplink and for downlink direction, and specifies that the TFT includes at least one uplink packet filter and one downlink packet filter. But for unidirectional uplink EPS bearers it does not specify which entity is responsible for ensuring that the TFT of such a bearer also includes at least one downlink packet filter. It is proposed to add that this is the responsibility of the PCEF (for GTP-based S5/S8) and the BBERF (for PMIP-based S5/S8).\n\n>>> SUMMARY OF CHANGE\nAdd the requirement that the PCEF or BBERF is responsible to ensure that at most one EPS bearer exists without any TFT and that the TFT of any EPS bearer includes at least one downlink packet filter.\n\n>>> CONSEQUENCES IF NOT REVISED\nAmbiguity with regard to the allowed TFT configurations for unidirectional uplink bearers can lead to different implementations, e.g. it could result in a unidirectional uplink EPS bearer established without any downlink packet filter. As a consequence, an MME implementing the requirement of subsclause 4.7.2.2 (\"The PDN GW routes downlink packets to the different EPS bearers based on the downlink packet filters in the TFTs assigned to the EPS bearers in the PDN connection.  \u2026\") would route some downlink packets via the wrong EPS bearer."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n6.1.3.2.2\tUnsuccessful Secondary PDP Context Activation Procedure initiated by the MS\nUpon receipt of an ACTIVATE SECONDARY PDP CONTEXT REQUEST message, the network may reject the MS initiated PDP context activation by sending an ACTIVATE SECONDARY PDP CONTEXT REJECT message to the MS. The message shall contain a cause code that typically indicates one of the following:\n# 26:\tinsufficient resources;\n# 30:\tactivation rejected by GGSN;\n# 31:\tactivation rejected, unspecified;\n# 32:\tservice option not supported;\n# 33:\trequested service option not subscribed;\n# 34:\tservice option temporarily out of order;\n# 41:\tsemantic error in the TFT operation;\n# 42:\tsyntactical error in the TFT operation;\n# 43:\tunknown PDP context;\n# 44:\tsemantic errors in packet filter(s);\n# 45:\tsyntactical errors in packet filter(s);\n# 46:\tPDP context without TFT already activated;\n# 48:\tactivation rejected, Bearer Control Mode violation\n; or\n# 95:\t111:\tprotocol errors.\nUpon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message, the MS shall stop timer T3380 and enter the state PDP-INACTIVE.\n\n\n* * * 2nd Change * * * *\n\n10.5.6.6\tSM cause\nThe purpose of the SM cause information element is to indicate the reason why a session management request is rejected.\nThe SM cause is a type 3 information element with 2 octets length.\nThe SM cause information element is coded as shown in figure\u00a010.5.139/3GPP TS 24.008 and table\u00a010.5.157/3GPP TS 24.008.\n\n8\t7\t6\t5\t4\t3\t2\t1\nSM cause IEI\toctet 1\nCause value\toctet 2\n\nFigure 10.5.139/3GPP TS 24.008: SM cause information element\nTable 10.5.157/3GPP TS 24.008: SM cause information element\n\tCause value (octet 2)\tBits\t8 7 6 5 4 3 2 1\t0 0 0 0 1 0 0 0\tOperator Determined Barring\t0 0 0 1 1 0 0 0\tMBMS bearer capabilities insufficient for the service\t0 0 0 1 1 0 0 1\tLLC or SNDCP failure(A/Gb mode only)\n0 0 0 1 1 0 1 0\tInsufficient resources\n0 0 0 1 1 0 1 1\tMissing or unknown APN\n0 0 0 1 1 1 0 0 \tUnknown PDP address or PDP type\n0 0 0 1 1 1 0 1\tUser authentication failed\n0 0 0 1 1 1 1 0 \tActivation rejected by GGSN\t0 0 0 1 1 1 1 1\tActivation rejected, unspecified\t0 0 1 0 0 0 0 0\tService option not supported\t0 0 1 0 0 0 0 1\tRequested service option not subscribed\t0 0 1 0 0 0 1 0\tService option temporarily out of order\t0 0 1 0 0 0 1 1\tNSAPI already used (not sent)\t0 0 1 0 0 1 0 0\tRegular deactivation\t0 0 1 0 0 1 0 1\tQoS not accepted\t0 0 1 0 0 1 1 0\tNetwork failure\t0 0 1 0 0 1 1 1\tReactivation required\t0 0 1 0 1 0 0 0\tFeature not supported\t0 0 1 0 1 0 0 1\tSemantic error in the TFT operation\t0 0 1 0 1 0 1 0\tSyntactical error in the TFT operation\t0 0 1 0 1 0 1 1\tUnknown PDP context\t0 0 1 0 1 1 0 0 \tSemantic errors in packet filter(s)\t0 0 1 0 1 1 0 1 \tSyntactical errors in packet filter(s)\t0 0 1 0 1 1 1 0\tPDP context without TFT already activated \t0 0 1 0 1 1 1 1\tMulticast group membership time-out \t0 0 1 1 0 0 0 0\tActivation rejected, BCM violation\t0 1 0 1 0 0 0 1\tInvalid transaction identifier value\t0 1 0 1 1 1 1 1\tSemantically incorrect message\t0 1 1 0 0 0 0 0\tInvalid mandatory information\t0 1 1 0 0 0 0 1\tMessage type non-existent or not implemented\t0 1 1 0 0 0 1 0\tMessage type not compatible with the protocol state\t0 1 1 0 0 0 1 1\tInformation element non-existent or not implemented\t0 1 1 0 0 1 0 0\tConditional IE error\t0 1 1 0 0 1 0 1\tMessage not compatible with the protocol state\t0 1 1 0 1 1 1 1\tProtocol error, unspecified\t0 1 1 1 0 0 0 0\tAPN restriction value incompatible with active PDP context\t\tAny other value received by the mobile station shall be treated as 0010 0010, \"Service option temporarily out of order\u201d. Any other value received by the network shall be treated as 0110 1111, \"Protocol error, unspecified\".\t\tNOTE:\tThe listed cause values are defined in Annex I\n\n\n* * * 3rd Change * * * *\n\nI.1\tCauses related to nature of request\nCause value = 8 Operator Determined Barring\n\tThis cause code is used by the network to indicate that the requested service was rejected by the SGSN due to Operator Determined Barring.\nCause value = 24 MBMS bearer capabilities insufficient for the service\n\tThis cause code is used by the network to indicate that an MBMS context activation request was rejected by the network, because the MBMS bearer capabilities are insufficient for the MBMS service.\nCause value = 25 LLC or SNDCP failure (A/Gb mode only)\n\tThis cause code is used by the MS indicate that a PDP context is deactivated because of a LLC or SNDCP failure (e.g. if the SM receives a SNSM-STATUS.request message with cause \"DM received \" or \" invalid XID response \", see 3GPP TS 44.065 [78])\nCause value = 26 Insufficient resources\n\tThis cause code is used by the MS or by the network to indicate that a PDP context activation request, secondary PDP context activation request, PDP context modification request, or MBMS context activation request cannot be accepted due to insufficient resources. \nCause value = 27 Unknown or missing access point name\n\tThis cause code is used by the network to indicate that the requested service was rejected by the external packet data network because the access point name was not included although required or if the access point name could not be resolved.\nCause value = 28 Unknown PDP address or PDP type\n\tThis cause code is used by the network to indicate that the requested service was rejected by the external packet data network because the PDP address or type could not be recognised.\nCause value = 29 User authentication failed\n\tThis cause code is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication.\nCause value = 30 Activation rejected by GGSN\n\tThis cause code is used by the network to indicate that the requested service was rejected by the GGSN.\nCause value = 31 Activation rejected, unspecified\n\tThis cause code is used by the network to indicate that the requested service was rejected due to unspecified reasons.\nCause value = 32 Service option not supported\n\tThis cause code is used by the network when the MS requests a service which is not supported by the PLMN.\nCause value = 33 Requested service option not subscribed\n\tSee Annex G, clause 4.\nCause value = 34 Service option temporarily out of order\n\tSee Annex G, clause 4. \nCause value = 35 NSAPI already used\n\tThis cause code may be used by a network to indicate that the NSAPI requested by the MS in the PDP context activation request is already used by another active PDP context of this MS.\nNever to be sent, but can be received from a R97/R98 network at PDP context activation\nCause value = 36 Regular deactivation\n\tThis cause code is used to indicate a regular MS or network initiated PDP context deactivation or a regular network initiated MBMS context deactivation.\nCause value = 37 QoS not accepted\n\tThis cause code is used by the MS if the new QoS cannot be accepted that were indicated by the network in the PDP Context Modification procedure.\nCause value = 38 Network failure\n\tThis cause code is used by the network to indicate that the PDP context deactivation or the MBMS context deactivation is caused by an error situation in the network. \nCause value = 39 Reactivation requested\n\tThis cause code is used by the network to request a PDP context reactivation after a GGSN restart.\nCause value = 40 Feature not supported\n\tThis cause code is used by the MS to indicate that the PDP context activation or the MBMS context activation initiated by the network is not supported by the MS.\nCause value = 41 semantic error in the TFT operation.\n\tThis cause code is used by the network or the MS to indicate that there is a semantic error in the TFT operation included in a secondary PDP context activation request or an MS-initiated PDP context modification or a network requested secondary PDP context activation.\nCause value = 42 syntactical error in the TFT operation.\n\tThis cause code is used by the network or the MS to indicate that there is a syntactical error in the TFT operation included in a secondary PDP context activation request or an MS-initiated PDP context modification or a network requested secondary PDP context activation.\nCause value = 43 unknown PDP context\n\tThis cause code is used by the network or the MS to indicate that the PDP context identified by the Linked TI IE in the secondary PDP context activation request or a network requested secondary PDP context activation is not active. \nCause value = 44 semantic errors in packet filter(s)\n\tThis cause code is used by the network or the MS to indicate that there is one or more semantic errors in packet filter(s) of the TFT included in a secondary PDP context activation request or an MS-initiated PDP context modification or a network requested secondary PDP context activation.\nCause value = 45 syntactical error in packet filter(s)\n\tThis cause code is used by the network or the MS to indicate that there is one or more syntactical errors in packet filter(s) of the TFT included in a secondary PDP context activation request or an MS-initiated PDP context modification or a network requested secondary PDP context activation.\nCause value = 46 PDP context without TFT already activated\n\tThis cause code is used by the network or the MS to indicate that it has already activated a PDP context without TFT.\nCause value = 47 Multicast group membership time-out\n\tThis cause code is used by the network to indicate that the MBMS context is deactivated because the timer supervising the IGMP group membership interval (see RFC 3376 [107], subclause 8.4) or the MLD multicast listener interval (see RFC 2710 [108], subclause 7.4) expired. \nCause value = 48 Activation rejected, B earerC ontrolMode violation\n\tThis cause code is used by the network or the MS to indicate that the requested service was rejected because of Bearer Control Mode violation.\n\n\nCause value = 112 APN restriction value incompatible with active PDP context.\n\tThis cause code is used by the network to indicate that a requested primary PDP context or an MBMS context has an APN restriction value that is not allowed in combination with a currently active PDP context. Restriction values are defined in 3GPP TS 23.060 [74], subclause 15.4.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the bearer control mode is UE/NW, both the UE and the NW may initiate/request a secondary PDP context activation procedure for the same service. As specified in 23.203, the PCRF may in this case reject a UE request that is already served by a NW-initiated procedure in progress. As is further defined in 23.203, when rejecting a UE-initiated request by sending a reject indication on Gx, the PCRF shall use an appropriate cause value which shall be delivered to the UE. Appropriate cause values have already been defined for Gx, GTPv2 as well as E-UTRAN NAS (release-8). Corresponding cause value for GERAN/UTRAN NAS is however missing. Contribution C1-092567 proposes introduction of suitable cause values in rel-8 24.008. In order to provide a consistent UE behaviour for all UEs supporting NW-initiated procedures, the same cause values should be introduced in rel-7 24.008 as well.There is no reason to introduce the cause value in earlier releases than rel-7 as NW initiated secondary PDP context activation was introduced in rel-7.\n\n>>> SUMMARY OF CHANGE\nA new cause value is defined for \u201ccollision with network initiated request\u201d\n\n>>> CONSEQUENCES IF NOT REVISED\nIf an existing 24.008 cause value (such as \u201cactivation rejected, unspecified\u201d or \u201cactivation rejected by GGSN\u201d) is used when rejecting a UE-initiated secondary PDP context, the application may terminate even though the service is already being handled by a NW-initiated request. This results in unpredictable behaviour by the UE that may result in loss of service. Furthermore, if a dedicated cause value is introduced in 24.008 rel-8 but not in rel-7, the behaviour of a rel-7 UE supporting MS/NW mode receiving this new casue value is unpredictable and may be similar as indicated above. Note that the new cause value only affects UE:s supporting NW-initiated secondary PDP context activation."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n4.6.2\tBackup and Update of S-CSCF Restoration Information during Registration Process\nThe S-CSCF shall backup the following data in the HSS during the initial registration process.\nthe list of SIP proxies in the path (normally it would be just the P-CSCF address)\nthe Contact Information (Contact Addresses and Contact Header parameters)\n\n\n\nThis is done with an additional information element in the SAR requesting user information, in addition to the basic set of information required to handle traffic, as specified in the 3GPP TS 29.228 [3]. The information is associated with the Private User Identity and the Implicit Registration Set that is affected by the SAR request. The HSS shall store this information. \nIf any of the above data is changed, the S-CSCF shall update it in the HSS using SAR request with Server-Assignment-Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE, as specified in the 3GPP TS 29.228 [3].\n* * * End of Changes * * * *\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nContact expiration time not accurate when restoration info is retrieved\n\n>>> SUMMARY OF CHANGE\nS-CSCF stores the expiration timer of each contact, but this time is relative (i.e. for how long the contact wants to be registered), not absolute. This means that, when the contact information is retrieved after a failure, the S-CSCF has no way to determine the absolute time when the contact will expire. It is assumed that the S-CSCF adds current time when retrieving the information, but that\u2019d extend the absolute expiration time to a higher value, so a contact that is no longer registered (e.g. re-registration did not occur) would still be registered. It is proposed to add a timestamp to the contact information to allow the S-CSCF retrieve the timestamp and get an accurate expiration time.\n\n>>> CONSEQUENCES IF NOT REVISED\nIMS network keeps a user as registered wrongly for a certain time. Unregistered services are not performed."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n6.3.3\tUE capability information elements\n\n<< skipped irrelevant parts>>\n\u2013\tCA-ParametersEUTRA\nThe IE CA-ParameterEUTRA contains the E-UTRA part of band combination parameters for a given MR-DC band combination.\nNOTE:\tIf an additional E-UTRA band combination parameters are defined in TS 36.331 [10], which are supported for MR-DC, they will be defined here as well.\n-- ASN1START\n-- TAG-CA-PARAMETERSEUTRA-START\n\nCA-ParametersEUTRA ::=                          SEQUENCE {\n    multipleTimingAdvance                           ENUMERATED {supported}                          OPTIONAL,\n    simultaneousRx-Tx                               ENUMERATED {supported}                          OPTIONAL,\n    supportedNAICS-2CRS-AP                          BIT STRING (SIZE (1..8))                        OPTIONAL,\n    additionalRx-Tx-PerformanceReq                  ENUMERATED {supported}                          OPTIONAL,\n    ue-CA-PowerClass-N                              ENUMERATED {class2}                             OPTIONAL,\n    supportedBandwidthCombinationSetEUTRA-v1530     BIT STRING (SIZE (1..32))                       OPTIONAL,\n    ...\n}\n\n-- TAG-CA-PARAMETERSEUTRA-STOP\n-- ASN1STOP\n\nCA-ParametersEUTRA field descriptions\nsupportedBandwidthCombinationSetEUTRA\tIndicates the set of supported bandwidth combinations for the LTE part for inter-band EN-DC. The first (left-most) bit in the bitmap corresponds to the BWCS#0 and so on. If the bit is set to 1, the UE supports the corresponding BWCS.\n\n\n<<CHANGE END>>\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThere are some open issues with the usage of supportedBandwidthCombinationSetEUTRA-v1530. - supportedBandwidthCombinationSetEUTRA is for CA and hence it should be omitted for band combination for non-CA. But it is not described. - the IE supportedBandwidthCombinationSetEUTRA-v1530 is optional, but there is no description on the interpretation if this field is omitted.- There is a discrepancy in the field usage description between TS 38.331 and TS 38.306: According to TS38.331 description, the leftmost bit in the bitmap corresponds to BWCS#0 and the next bit corresponds to BWCS#1 and so on, while the description in T38.306 incorrectly states that the leftmost bit in the bitmap corresponds to BWCS#1.   The description in TS38.306 needs to be corrected and the duplicated description in 38.331 is to be removed.\n\n>>> SUMMARY OF CHANGE\nClarify that the UE indicates the BWCS for the LTE part of the EN-DC combination using the IE supportedBandwidthCombinationSetEUTRA-v1530 as below: If the LTE part of the EN-DC combination has only one LTE carrier then the supportedBandwidthCombinationSetEUTRA-v1530 IE is not used and the UE skips reporting this.If the LTE part of EN-DC has more than one LTE carriers, but the UE supports only the BWCS set #0 for the LTE part of the EN-DC combination, then the UE skips reporting this IE, and the NW interprets that the UE supports only BWCS set #0 for the LTE part of EN-DC combination. Correct the TS38.306 field description of supportedBandwidthCombinationSetEUTRA-v1530 to align with T38.331. If the LTE part of EN-DC has more than one LTE carriers and if the UE supports more than one BWCS sets for the LTE part of the EN-DC combination, the UE reports this capability in the supportedBandwidthCombinationSetEUTRA-v1530 IE by setting leftmost bit to 1, if BWCS set \u20180\u2019 is supported, by setting the next bit to the leftmost bit to 1 if BWCS #1 is supported and so on.Remove the field description of supportedBandwidthCombinationSetEUTRA-v1530 in 38.331 as this is captured in 38.306.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE does not know which BWCS to signal if the LTE part of EN-DC has only one LTE carrier. The specification is ambiguous on what the UE should provide in the IE supportedBandwidthCombinationSetEUTRA-v1530 if the UE intends to report the support of BWCS#0. Impact Analysis:Impacted functionality:BandwidthCombinationSetcapability signalling Inter-operability:The CR identifies an aspect of the BandwidthCombinationSet capability signalling which is not clearly specified in the Dec 2018 specifications. Therefore, there can be no confidence that different implementations based on Dec 2018 standard will be implemented in the same way and that those implementations will be interoperable with each other. As a consequence it is critical that all implementations are aligned with this CR.If the network is implemented according to the CR and the UE is not; The network may incorrectly interpret the UE capability for the bandwidths on the component carriers. This may result in repeated misconfigurations by the network and RRC reconfiguration failure declared by the UE.If the UE is implemented according to the CR and the network is not; The network may incorrectly interpret the UE capability for the bandwidths on the component carriers. This may result in repeated misconfigurations by the network and RRC reconfiguration failure declared by the UE."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n================== START OF CHANGE ==================\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n [3]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n [4]\t3GPP\u00a0TS\u00a033.102: \"3G security; Security architecture\".\n [5]\t3GPP\u00a0TS\u00a033.210: \"3G security; Network Domain Security (NDS); IP network layer security\".\n [6]\t3GPP\u00a0TS\u00a033.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n [7]\tIETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\".\n[8]\t3GPP\u00a0TS\u00a033.220: \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\".\n [9]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage\u00a03\".\n [10]\tIETF RFC 2104 (1997): \"HMAC: Keyed-Hashing for Message Authentication\".\n[11]\tISO/IEC 10118-3 (2004): \"Information Technology - Security techniques - Hash-functions - \nPart 3: Dedicated hash-functions\".\n[12]\t\t3GPP\u00a0TS\u00a036.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Packet Data Convergence Protocol (PDCP) specification\"\n [13]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n\n================== END OF CHANGE ==================\n================== START OF CHANGE ==================\n\n\n\n\n\n\n\n\nTable X-1; AS messages which are allowed to be sent unprotected\nN\n\n\n\n================== END OF CHANGE ==================\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn order to ensure a good security level it is necessary that an exception list of AS messages which are allowed to be sent unprotected is documented. An LS has been sent to CT1 and RAN2 (S3-080502) to ask CT1 and RAN2 to start the work. CT1 has answered positively but an answer from RAN2 is outstanding.\n\n>>> SUMMARY OF CHANGE\nAdd an AS message protection exception list to TS 33.401.\n\n>>> CONSEQUENCES IF NOT REVISED\nLower security level of AS as the implementation freedom to send and accept many AS messages without security will increase threats to UE and eNB."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n****************** change  ******************\n5.2.10.3\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method after emergency registration\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user over the security association, TLS session, or IP association that was created during the emergency registration, as identified by the presence of the \"sos\" SIP URI parameter in the Contact header field of the 200 (OK) response, the P-CSCF shall inspect the Request-URI independent of values of possible entries in the received Route header fields for emergency service identifiers. The P-CSCF shall consider the Request URI of the initial request as an emergency service identifier, if it is an emergency number or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to; and\n-\tfor inbound roamers, the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP URI belonging to the user.\nIf the P-CSCF detects that the Request-URI of the initial request for a dialog, or a standalone transaction, or an unknown method does not match any one of the emergency service identifiers in the associated lists, the P-CSCF shall reject the request by returning a 403 (Forbidden) response to the UE.\nIf the P-CSCF detects that the Request-URI of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n1)\tinclude in the Request-URI an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69]:\n-\tif the received Request-URI matches an emergency service URN, as received from the UE in the Request-URI; and\n-\tif the received Request-URI does not match an emergency service URN, as deduced from the Request-URI received from the UE.\n1A)\tif operator policy requires that emergency service requests are forwarded to the S-CSCF and the P-CSCF determines that the network to which the originating user is attached (see the IP-CAN specific annexes for the detailed procedure) is the network the P-CSCF is in then:\na)\texecute the procedure described in subclause\u00a05.2.6.3.3, subclause\u00a05.2.6.3.7, subclause\u00a05.2.6.3.11 and subclause\u00a05.2.7.2, as appropriate except for routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, include a bottom most Route header field set to the URI associated with an E-CSCF;\nNOTE\u00a01:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\n1B)\tif the condition for 1A) is not fulfilled then:\na)\texecute the procedure described in subclause\u00a05.2.6.3.3, subclause\u00a05.2.6.3.7, subclause\u00a05.2.6.3.11 and subclause\u00a05.2.7.2, as appropriate except for verifying the preloaded route against the received Service-Route header field; and routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, remove all Route header fields and include a Route header field set to the URI associated with an E-CSCF; and\nNOTE\u00a02:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\n1C)\tif the request is from a UE that is not considered as priviledged sender and if the alternative identity of the originator of the request was not identified (see subclause\u00a05.2.6.3.1):\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP URI and if a tel URI belongs to the set of implicitly registered public user identities that contains the SIP URI, add a second P-Asserted-Identity header field that contains the first tel URI of the implicitly registered public user identities; and\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel URI, add a second P-Asserted-Identity header field that contains the first SIP URI of the implicitly registered public user identities that contains the tel URI;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE port such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-URI. The UE port used for the association is determined as follows:\n-\tif IMS AKA or SIP digest with TLS is being used as a security mechanism, the UE protected server port for the security association on which the request was received; or\n-\tif SIP digest without TLS, NASS-IMS bundled authentication or GPRS-IMS-Bundled Authentication is being used as a security mechanism, the UE unprotected port on which the request was received; and\n3)\twhere the network uses the Resource-Priority header field to control the priority of emergency calls, add a Resource-Priority header field containing a namespace of \"esnet\" as defined in draft-polk-local-emergency-rph-namespace\u00a0[197].\n\n\n\nIf the P-CSCF does not receive any response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF, the P-CSCF shall include a URI, associated with a different E-CSCF, in the topmost Route header field and forward the request.\nIf the P-CSCF does not receive any response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF, the P-CSCF shall include a URI, associated with a different E-CSCF, in the topmost Route header field of the initial request for a dialog or standalone transaction or an unknown method, and forward the request.\nWhen the P-CSCF received a subsequent request in the dialog from the UE, and the network uses the Resource-Priority header field to control the priority of emergency calls, the P-CSCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in draft-polk-local-emergency-rph-namespace\u00a0[197].\nWhen the P-CSCF receives a target refresh request for a dialog with the Request-URI containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE port associated to the GRUU contained in the Request-URI and rewrite the Request-URI with that UE IP address and UE port; and\n-\tperform the steps in subclause\u00a05.2.6.4.5 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\n\n\n\n\n\n\n\n****************** change  ******************\n5.2.10.4\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method - non-emergency registration\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user, and the request is:\na)\tunderstood from saved or included information to relate to private network traffic (see subclause\u00a05.2.6.3), and operator policy requires the P-CSCF to detect an emergency session request relating to private network traffic; or\nb)\tnot understood from saved or included information to relate to private network traffic (see subclause\u00a05.2.6.3);\nthen the P-CSCF shall inspect the Request-URI independent of values of possible entries in the received Route header fields for emergency service identifiers. The P-CSCF shall consider the Request URI of the initial request as an emergency service identifier, if it is an emergency numbers or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to;\n-\tfor inbound roamers, the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP URI belonging to the user; and\n-\tthe country of roaming partners, if the request originates from a different country then the country of the network to which the P-CSCF belongs to. Access technology specific procedures are described in each access technology specific annex to determine from which country and roaming partner the request was originated. If the country from which the request originates can not be determined all lists are associated.\nIf the P-CSCF detects that the Request-URI of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n0A)\tdetermine the geographical location of the UE. Access technology specific procedures are described in each access technology specific annex:\na)\tif the UE is roaming and the P-CSCF is in the home operator's network, or the SDP of the request describes CS media (see 3GPP\u00a0TS\u00a024.292\u00a0[8O]), then the P-CSCF:\nI)\tshall reject the request as specified in subclause\u00a05.2.10.5;\nb)\tif the UE is roaming and the P-CSCF is in the same network where the UE is roaming, or the UE is not roaming, then the P-CSCF, depending on operator policies:\nI)\tmay reject the request as specified in subclause\u00a05.2.10.5; or\nII)\tmay continue with the next steps;\nNOTE\u00a01:\tRoaming is when a UE is in a geographic area that is outside the serving geographic area of the home IM CN subsystem.\nNOTE\u00a02:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\n1)\tinclude in the Request-URI an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69], if necessary. If information on the type of emergency service is known include a sub-service type. The entry in the Request-URI that the P-CSCF includes shall be:\n-\tif the received Request-URI matches an emergency service URN, as received from the UE in the Request-URI; and\n-\tif the received Request-URI does not match an emergency service URN, as deduced from the Request-URI received from the UE;\n1A)\tif operator policy requires that emergency service requests are forwarded to the S-CSCF and the P-CSCF determines that the network to which the originating user is attached (see the IP-CAN specific annexes for the detailed procedure) is the network the P-CSCF is in then:\na)\texecute the procedure described in subclause\u00a05.2.6.3.3, subclause\u00a05.2.6.3.7, subclause\u00a05.2.6.3.11 and subclause\u00a05.2.7.2, as appropriate except for routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, include a bottom most Route header field set to the URI associated with an E-CSCF;\nNOTE\u00a03:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\n1B)\tif the condition for 1A) is not fulfilled then:\na)\texecute the procedure described in subclause\u00a05.2.6.3.3, subclause\u00a05.2.6.3.7, subclause\u00a05.2.6.3.11 and subclause\u00a05.2.7.2, as appropriate except for verifying the preloaded route against the received Service-Route header field; and routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, remove all Route header fields and include a Route header field set to the URI associated with an E-CSCF;\nNOTE\u00a04:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\n1C)\tif the request is from a UE that is not considered as priviledged sender and if the alternative identity of the originator of the request was not identified (see subclause\u00a05.2.6.3.1):\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP URI and if a tel URI belongs to the set of implicitly registered public user identities that contains the SIP URI, add a second P-Asserted-Identity header field that contains the first tel URI of the implicitly registered public user identities; and\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel URI, add a second P-Asserted-Identity header field that contains the first SIP URI of the implicitly registered public user identities that contains the tel URI;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE port such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-URI. The UE port used for the association is determined as follows:\n-\tif IMS AKA or SIP digest with TLS is being used as a security mechanism, the UE protected server port for the security association on which the request was received; or\n-\tif SIP digest without TLS is being used as a security mechanism, the UE unprotected port on which the request was received; and\n3)\twhere the network uses the Resource-Priority header field to control the priority of emergency calls, add a Resource-Priority header field containing a namespace of \"esnet\" as defined in draft-polk-local-emergency-rph-namespace\u00a0[197].\n\n\n\nIf the P-CSCF does not receive any response to the initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF, the P-CSCF shall include a URI, associated with a different E-CSCF that has not been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), in the topmost Route header field and forward the request.\nIf the P-CSCF does not receive any response to the initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF, the P-CSCF shall include a URI, associated with a different E-CSCF that has not been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), in the topmost Route header field of the initial request for a dialog or standalone transaction or an unknown method, and forward the request.\nIf the P-CSCF:\n-\tdoes not receive any response to this initial request for a dialog or standalone transaction or an unknown method (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method, and if all E-CSCFs have been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), the P-CSCF shall reject this request as specified in subclause\u00a05.2.10.5;\n-\treceives:\n1)\tany 4xx response other than a 480 (Temporarily Unavailable) response;\n2)\tany 5xx response;\n3)\tany 6xx response,\n\tand the entry in the Request-URI as received from the UE is not in accordance with RFC\u00a05031\u00a0[69], then the P-CSCF shall reject this request as specified in subclause\u00a05.2.10.5.\nIf the P-CSCF receives from the IP-CAN (e.g. via PCRF) an indication that the requested resources for the multimedia session being established cannot be granted and the entry in the Request-URI as received from the UE is not in accordance with RFC\u00a05031\u00a0[69], then the P-CSCF shall:\n-\tsend a CANCEL request to cancel the request forwarded to the selected E-CSCF; and\n-\treject this request as specified in subclause\u00a05.2.10.5.\nWhen the P-CSCF received a subsequent request in the dialog from the UE, and the network uses the Resource-Priority header field to control the priority of emergency calls, the P-CSCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in draft-polk-local-emergency-rph-namespace\u00a0[197].\nWhen the P-CSCF receives a target refresh request for a dialog with the Request-URI containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE port associated to the GRUU contained in the Request-URI and rewrite the Request-URI with that UE IP address and UE port; and\n-\tperform the steps in subclause\u00a05.2.6.4 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\n\n\n\n\n\n\n****************** change  ******************\n5.2.10.5\tAbnormal and rejection cases\nIf the IM CN subsystem to where the P-CSCF belongs to is not capable to handle emergency sessions or due to local policy does not handle emergency sessions or only handles certain type of emergency session request or does not support emergency sessions for either the geographical location of the UE is located or the IP-CAN to which the UE is attached, or the SDP of the request describes CS media (see 3GPP\u00a0TS\u00a024.292\u00a0[8O]), or for reasons described in subclause\u00a05.2.10.4, the P-CSCF shall not forward the initial request for a dialog or standalone transaction or an unknown method. The P-CSCF:\nI)\tshall reject the request by returning a 380 (Alternative Service) response;\nII)\tif:\n-\tsupport for the 3GPP IM CN subsystem XML body as described in subclause\u00a07.6 in the Accept header field is not indicated, the P-CSCF shall assume that the UE supports version 1 of the 3GPP XML Schema for the IM CN subsystem XML; or\n-\tif both the \"sv\" and \"schemaversion\" parameters are present, then the P-CSCF shall ignore the value of the \"schemaversion\" parameter;\nIII)\tshall include in the 380 (Alternative Service) response:\n-\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause\u00a07.6.1;\n-\ta P-Asserted-Identity header field set to the value of the SIP URI of the P-CSCF included in the Path header field during the registration of the user whose UE sent the request causing this response (see subclause\u00a05.2.2.1); and\n-\tif the type of emergency service can be deduced from the Request-URI received from the UE, a Contact header field with an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69], including sub-service type deduced from the Request-URI received from the UE; and\n\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service;\ni)\ta <type> child element, set to \"emergency\" (see table\u00a07.6.2) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table\u00a07.6.3) if the P-CSCF is accordingly configured by the operator.\nNOTE\u00a01:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\nNOTE\u00a02:\tSome networks only allow session requests with a Request-URI containing an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69].\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 22.101 contains the following requirement:If permitted by local regulation, it shall be possible for the user to prevent the sending of his public user identifiers and the location information to the PSAP (i.e. emergency response centre).NOTE 3:Operator policies (e.g. requirements for support of emergency communications) may over-ride the user request for suppression.In CS domain, request for privacy service is indicated by user dialling an emergency number identifying the emergency service where the privacy service is provided. The emergency number identifying the emergency service where the privacy service is provided is different from an emergency number identifying the emergency service where the privacy service is NOT provided.If the user dials the emergency number identifying the emergency service where the privacy service is provided, the privacy sensitive information are not provided to PSAP.If the user dials the emergency number identifying the emergency service where the privacy service is NOT provided, the privacy sensitive information are provided to PSAP.The same behaviour needs to be preserved when an emergency call is routed via IMS, i.e.:If the user dials the emergency number identifying the emergency service where the privacy service is provided, the privacy sensitive information are not provided to PSAP (no matter whether Privacy header field is inserted by user or not).If the user dials the emergency number identifying the emergency service where the privacy service is NOT provided, the privacy sensitive information are provided to PSAP (no matter whether Privacy header field is inserted by user or not).\n\n>>> SUMMARY OF CHANGE\nIf operator policy (e.g. determined by national regulatory requirements applicable to emergency services) allows requests for suppression of public user identifiers and location information, then the following applies:- emergency service URN identifying an emergency service where privacy service is provided differs from emergency service URNs identifying emergency services where privacy service is not provided.- when P-CSCF receives a request where Request-URI contains an emergency service URN identifying an emergency service where privacy service is provided (or a request or response sent in a UE-originating dialog where initial request for dialog was such) and Privacy header is not included, P-CSCF includes the Privacy header field.- when P-CSCF receives a request where Request-URI contains an emergency service URN identifying an emergency service where privacy service is NOT provided (or a request or response sent in a UE-originating dialog where initial request for dialog was such) and Privacy header is included, P-CSCF removes any Privacy header fields.Main changes from revision 1:- when UE requests an emergency service where privacy service is NOT provided and a Privacy header field is included, the P-CSCF removes the Privacy header field- since E-CSCF applies privacy service also on in-dialog requests and response to in-dialog requests, P-CSCF inserts/removes Privacy header field also in the in-dialog requests and responses to in-dialog requests\n\n>>> CONSEQUENCES IF NOT REVISED\nRegulatory requirements requiring privacy to be applicable to requests for emergency services cannot be realized in some casesPrivacy sensitive information are removed even in cases where the regulatory requirements expect that the privacy sensitive information are delivered to PSAP."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * * First Change * * * *\n4.1.1.6A\tSpecific requirements for the MS when receiving non-integrity proctected reject messages\nThis subclause specifies the requirements for an MS that is not configured to use timer T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[135] or 3GPP\u00a0TS\u00a031.102\u00a0[112]) and receives a LOCATION UPDATING REJECT, CM SERVICE REJECT, ABORT, ATTACH REJECT, ROUTING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific MM or GMM causes.\nNOTE\u00a01:\tAdditional MS requirements for this case, requirements for other MM or GMM causes, and requirements for the case when the MS receives a successfully integrity checked reject message are specified in subclauses\u00a04.4.4.7, 4.5.1.1, 4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4.\nThe MS may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters. The maximum number of possible entries in each list is implementation dependent.\nAdditionally, the MS may maintain one counter for \"SIM/USIM considered invalid for non-GPRS services\" events and one counter for \"SIM/USIM considered invalid for GPRS services\" events.\nThe MS may also maintain a list of \"forbidden location areas for non-GPRS services\" and a list of \"forbidden location areas for GPRS services\". If the MS is in a location area which is included in the list of \"forbidden location areas for non-GPRS services\", the MS shall not initiate any MM procedure. If the MS is in a location area which is included in the list of \"forbidden location areas for GPRS services\", the MS shall not initiate any GMM, SM, SMS or SS procedure for GPRS services.\nIf the MS receives a LOCATION UPDATING REJECT message without integrity protection with MM cause value #2, #3, #6, #11, #12, #13 or #15 before the network has activated the integrity protection for the CS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:\n1)\tif the MM cause value received is #3 or #6, and\na)\tif the MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:\ni)\tdelete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2);\n\tdelete the list of equivalent PLMNs;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events;\n\tstore the current LAI in the list of \"forbidden location areas for roaming\"; and\n\tsearch for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121]; or\nii)\tproceed as specified in subclause\u00a04.4.4.7 and;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events; and\nb)\telse the MS shall proceed as specified in subclause\u00a04.4.4.7;\n2)\tif the MM cause value received is #2, and\na)\tif the MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:\ni)\tdelete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2);\n\tdelete the list of equivalent PLMNs;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events;\n\tif the MS maintains a list of \"forbidden location areas for non-GPRS services\" and a list of \"forbidden location areas for GPRS services\", proceed as follows:\n\tif the current LAI is already included in the list of \"forbidden location areas for GPRS services\" or the MS is not operating in MS operation mode A or B, store the current LAI in the list of \"forbidden location areas for roaming\"; otherwise store the current LAI in the list of \"forbidden location areas for non-GPRS services\"; and\n\tattempt to select a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121], different from the cell where the LOCATION UPDATING REJECT was received; or\nNOTE\u00a02:\tThe cell on which the reject was received could still be a suitable cell.\nii)\tproceed as specified in subclause\u00a04.4.4.7 and;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events; and\nb)\telse the MS shall proceed as specified in subclause\u00a04.4.4.7;\n3)\tif the MM cause value received is #12, #13 or #15, the MS shall additionally proceed as specified in subclause\u00a04.4.4.7;\n4)\tif the MM cause value received is #11 and the MS is in its HPLMN or in a PLMN that is within the EHPLMN list:\n\tthe MS shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). Additionally, the MS shall store the current LAI in the list of \"forbidden location areas for roaming\"; and\n\tthe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121]; and\n5)\tif the MM cause value received is #11 and if the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list, in addition to the MS requirements specified in subclause\u00a04.4.4.7,\n-\tif the MS maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific attempt counter for the PLMN.\nIf the MS receives a CM SERVICE REJECT or ABORT message with MM cause value #6 without integrity protection before the network has activated the integrity protection for the CS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and\na)\tif the MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:\ni)\tproceed as specified in subclauses\u00a04.5.1.1 or 4.3.5.2 respectively with the exception that the MS shall not consider the SIM/USIM as invalid for non-GPRS services and;\n\tdelete the list of equivalent PLMNs;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events;\n\treset the location update attempt counter;\n\tstore the current LAI in the list of \"forbidden location areas for roaming\"; and\n\tsearch for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121]; or\nii)\tproceed as specified in subclauses\u00a04.5.1.1 or 4.3.5.2 respectively and;\n\tincrement the counter for \"SIM/USIM considered invalid for non-GPRS services\" events; and\nb)\telse the MS shall proceed as specified in subclause\u00a04.5.1.1 or 4.3.5.2 respectively.\nIf the MS receives an ATTACH REJECT or ROUTING AREA UPDATE REJECT message without integrity protection with GMM cause value #3, #6, #7, #8, #11, #12, #13, #14 or #15 before the network has activated the integrity protection for the PS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and shall take the following actions:\n6)\tif the GMM cause value received is #3, #6, or #8, and\na)\tif the MS maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:\ni)\tset the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number;\n\tdelete the list of equivalent PLMNs;\n\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events;\n\tif the MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, increment the counter for \"SIM/USIM considered invalid for non-GPRS services\" events;\n\tif a GPRS attach or routing area updating procedure was performed, reset the GPRS attach attempt counter or the routing area updating attempt counter, respectively;\n\tif S1 mode is supported by the MS, handle the EMM parameters attach attempt counter or tracking area updating attempt counter, EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when an EPS attach or tracking area update procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection;\n\tstore the current LAI in the list of \"forbidden location areas for roaming\" and enter the state GMM-DEREGISTERED.LIMITED-SERVICE; and\n\tsearch for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121]; or\nii)\tproceed as specified in subclauses\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;\n\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events; and\n\tif the MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, increment the counter for \"SIM/USIM considered invalid for non-GPRS services\" events; and\nb)\telse the MS shall proceed as specified in subclause\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;\n7)\tif the GMM cause value received is #7, and\na)\tif the MS maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:\ni)\tset the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number;\n\tdelete the list of equivalent PLMNs;\n\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events;\n-\tif a GPRS attach or routing area updating procedure was performed, reset the GPRS attach attempt counter or the routing area updating attempt counter, respectively;\n\tenter the state GMM-DEREGISTERED.LIMITED-SERVICE;\n\tif the MS maintains a list of \"forbidden location areas for non-GPRS services\" and a list of \"forbidden location areas for GPRS services\", proceed as follows:\n\tif the current LAI is already included in the list of \"forbidden location areas for non-GPRS services\" or the MS is operating in MS operation mode C, store the current LAI in the list of \"forbidden location areas for roaming\"; otherwise store the current LAI in the list of \"forbidden location areas for GPRS services\"; and\n\tattempt to select a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121], different from the cell where the ATTACH REJECT or ROUTING AREA UPDATING REJECT was received; or\nNOTE\u00a03:\tThe cell on which the reject was received could still be a suitable cell.\nii)\tproceed as specified in subclauses\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4; and\n\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events; and\nb)\telse the MS shall proceed as specified in subclause\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;\n8)\tif the GMM cause value received is #12, #13 or #15, the MS shall additionally proceed as specified in subclauses\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;\n9)\tif the GMM cause value received is #11 or #14 and the MS is in its HPLMN or in a PLMN that is within the EHPLMN list:\n-\tthe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs. Additionally, if a GPRS attach or the routing area updating procedure was performed, the MS shall reset the GPRS attach attempt counter or the routing area updating attempt counter respectively;\n-\tthe MS shall store the current LAI in the list of \"forbidden location areas for roaming\", and enter the state GMM-DEREGISTERED.LIMITED-SERVICE;\n\n\n\n-\tif S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter or tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the procedure is rejected with the EMM cause with the same value without integrity protection; and\n-\tthe MS shall search for a suitable cell in another location area or in another tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\n-\tthe MS shall search for a suitable cell in another location area or in another tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\n\n10)\tif the GMM cause value received is #11 and the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list, the MS shall additionally proceed as specified in subclauses\u00a0 4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4:\n-\tFurthermore, if the MS maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific attempt counter for the PLMN.\n11)\tif the GMM cause value received is #14 and the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list, the MS shall additionally proceed as specified in subclauses\u00a04.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, and 4.7.5.2.4:\n-\tFurthermore, if the MS maintains a list of PLMN-specific PS-attempt counters and the PLMN-specific PS-attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific PS-attempt counter for the PLMN.\nIf the MS receives a SERVICE REJECT message without integrity protection with GMM cause value #3, #6, #7, #8, #11, #12, #13 or #15 before the network has activated the integrity protection for the PS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and proceed as specified under items 6, 7, 8, 9 and 10 above.\nUpon expiry of timer T3247, the MS shall:\n-\terase the list of \"forbidden location areas for regional provision of service\" and the list of \"forbidden location areas for roaming\";\n-\tset the SIM/USIM to valid for non-GPRS services, if\n-\tthe MS does not maintain a counter for \"SIM/USIM considered invalid for non-GPRS services\" events; or\n-\tthe MS maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and this counter has a value less than an MS implementation-specific maximum value.\n-\tset the SIM/USIM to valid for GPRS services, if\n-\tthe MS does not maintain a counter for \"SIM/USIM considered invalid for GPRS services\" events; or\n-\tthe MS maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and this counter has a value less than an MS implementation-specific maximum value.\n-\terase the list of \"forbidden location areas for non-GPRS services\" and the list of \"forbidden location areas for GPRS services\", if the MS maintains these lists;\n-\tif the MS maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than an MS implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list;\n-\tif the MS maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than an MS implementation-specific maximum value, remove the respective PLMN from the \"forbidden PLMNs for GPRS service\" list. If the resulting \"forbidden PLMNs for GPRS service\" list is empty and the MS is supporting S1 mode, the MS re-enables the E-UTRA capability as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when timer T3247 expires;\n-\tif the MS is supporting S1 mode, handle the list of \"forbidden tracking areas for regional provision of service\" and the list of \"forbidden tracking areas for roaming\" as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when timer T3247 expires; and\n-\tinitiate a location updating procedure, GPRS attach procedure or routing area updating procedure, if still needed, dependent on MM state and update status, and GMM state and GPRS update status, or perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nIf the MS maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the MS is switched off, the MS shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the MS implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the SIM/USIM is removed, the MS should perform this action.\nNOTE\u00a04:\tIf the respective PLMN was stored in the extension of the \"forbidden PLMNs\" list, then according to 3GPP\u00a0TS\u00a023.122\u00a0[14] the MS will delete the contents of this extension when the SIM/USIM is removed.\n* * * * End of Change * * * *\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn CT1#101 meeting, a list of \"forbidden location areas for non-GPRS services\" and a list of \"forbidden location areas for GPRS services\" were added in TS 24.008 (by C1-165425/5426) for handling of NAS reject with MM cause #2 and GMM cause #7 without integrity protection.When looking the current UE handling of NAS reject with GMM #14 (GPRS services not allowed in this PLMN) without integrity protection, regardless of the UE mode (CS/PS mode of operation, or PS mode of operatio), it shall perform below action:\"-the MS shall store the current LAI in the list of \"forbidden location areas for roaming\", and enter the state GMM-DEREGISTERED.LIMITED-SERVICE;\"However, for a UE in CS/PS mode of operation, if it has already successfully attached for CS services and later initiated the separate request to GPRS services but gets rejected with GMM #14 without integrity protection, it will also add the current LAI into the forbidden LAI list. As a result, the current serving cell cannot be treated as a suitable cell for normal camping for the UE, which results in the UE cannot obtain the CS services from the registered CS domain.Now, considering a list of \"forbidden location areas for non-GPRS services\" and a list of \"forbidden location areas for GPRS services\" were introduced in TS 24.008, the current UE behaviour can be improved.Hence, it proposes to improve the UE\u2019s behaviour for NAS reject with GMM #14 without integrity protection to align with the handling of NAS reject with MM cause #2 and GMM cause #7 without integrity protection.\n\n>>> SUMMARY OF CHANGE\nIt proposes to improve the UE\u2019s behaviour for NAS reject with GMM #14 without integrity protection to align with the handling of NAS reject with MM cause #2 and GMM cause #7 without integrity protection.\n\n>>> CONSEQUENCES IF NOT REVISED\nFor a UE in CS/PS mode of operation, the reject with GMM #14 without integrity protection causes the UE cannot obtain the CS services from the registered CS domain.This is an FAMSO issue due to the NAS protection mechnism for DoS attack was introduced since Rel-13 and the similar improvement on UE behaviour has already done since Rel-13 as well."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*** BEGIN CHANGES ***\n*** First change, based on S3-181495 ***\nC.3 \tElliptic Curve Integrated Encryption Scheme (ECIES)\nC.3.1\tGeneral\nThe use of ECIES for concealment of the SUPI shall adhere to the SECG specifications [29] and [30]. Processing on UE side and home network side are described in high level in clauses C.3.2 and C.3.3. \nC.3.2\tProcessing on UE side\nThe ECIES scheme shall be implemented such that for computing a fresh SUCI, the UE shall use the provisioned public key of the home network and freshly generated ECC (elliptic curve cryptography) ephemeral public/private key pair according to the ECIES parameters provisioned by home network. The processing on UE side shall be done according to the encryption operation defined in [29].\n\n\nThe final output shall be the concatenation of the ECC ephemeral public key, the ciphertext value, the MAC tag value, and any other parameters, if applicable. \nOTE:\tThe reason for mentioning \"any other parameter, if applicable\" in the final output is to allow cases, e.g. to enable the sender to send additional sign indication when point compression is used.\nEditor's Note: The format and encoding of the final output needs to be finalized by CT WG1.\nThe Figure C.3.2-1 illustrates the UE's steps.\n \nFigure C.3.2-1: Encryption based on ECIES at UE\n\nC.3.3\tProcessing on home network side\nThe ECIES scheme shall be implemented such that for deconcealing a SUCI, the home network shall use the received ECC ephemeral public key of the UE and the private key of the home network. The processing on home network side shall be done according to the decryption operation defined in [29]\n\n\nNOTE:\tUnlike the UE, the home network does not need to perform a fresh ephemeral key pair generation for each decryption. How often the home network generates new public/private key pair and how the public key is provisioned to the UE are out of the scope of this clause.\nThe Figure C.3.3-1 illustrates the home network's steps.\n \nFigure C.3.3-1: Decryption based on ECIES at home network\nC.3.4\tECIES profiles\nC.3.4.0\tGeneral\nUnless otherwise stated, the ECIES profiles follow the terminology and processing specified in SECG version 2 [29] and [30]. The profiles shall use \"named curves\" over prime fields.\nProfile A shall use its own standardized processing for key generation (section 6 of RFC 7748 [46]) and shared secret calculation (section 5 of RFC 7748 [46]). The Diffie-Hellman primitive X25519 (section 5 of RFC 7748 [46]) takes two random octet strings as input, decodes them as scalar and coordinate, performs multiplication, and encodes the result as an octet string. The shared secret output octet string from X25519 shall be used as the input Z in the ECIES KDF (section 3.6.1 of [29]).\nProfile B shall use point compression to save overhead and shall use the Elliptic Curve Cofactor Diffie-Hellman Primitive (section 3.3.2 of [29]) to enable future addition of profiles with cofactor h \u2260 1. For curves with cofactor h = 1 the two primitives (section 3.3.1 and 3.3.2 of [29]) are equal.\nThe profiles shall not use backwards compatibility mode (therefore are not compatible with version 1 of SECG).\nC.3.4.1\tProfile <A>\nThe ME and SIDF shall implement this profile. The ECIES parameters for this profile shall be the following:\n-\tEC domain parameters\t\t\t\t\t\t\t: Curve25519 [46]\n-\tEC Diffie-Hellman primitive\t\t\t\t\t: X25519 [46]\n-\tpoint compression\t\t\t\t\t\t\t\t: N/A\n-\tKDF\t\t\t\t\t\t\t\t\t\t\t\t: ANSI-X9.63-KDF [29]\n-\tHash\t\t\t\t\t\t\t\t\t\t\t\t: SHA-256\n-\tSharedInfo1\t\t\t\t\t\t\t\t\t\t:  (the ephemeral public key octet string \u2013 see [29] section 5.1.3)\n-\tMAC\t\t\t\t\t\t\t\t\t\t\t\t: HMAC\u2013SHA-256\n-\tmackeylen\t\t\t\t\t\t\t\t\t\t: 256\n-\tmaclen\t\t\t\t\t\t\t\t\t\t\t: 64\n-\tSharedInfo2\t\t\t\t\t\t\t\t\t\t: the empty string\n-\tENC\t\t\t\t\t\t\t\t\t\t\t\t: AES\u2013128 in CTR mode\n-\tenckeylen\t\t\t\t\t\t\t\t\t\t\t: 128\n\n-\tbackwards compatibility mode\t\t\t\t\t: false\n\nEditor's Note: It is FFS to contact other WGs (like CT1) or wait for their progress before finalizing the identifier, and size of the null-scheme. The maximum size should cover both the IMSI and NAI formats.\nC.3.4.3\tProfile <B>\nThe ME and SIDF shall implement this profile. The ECIES parameters for this profile shall be the following:\n-\tEC domain parameters\t\t\t\t\t\t\t: secp256r1 [30]\n-\tEC Diffie-Hellman primitive\t\t\t\t\t: Elliptic Curve Cofactor Diffie-Hellman Primitive [29]\n-\tpoint compression\t\t\t\t\t\t\t\t: true\n-\tKDF\t\t\t\t\t\t\t\t\t\t\t\t: ANSI-X9.63-KDF [29]\n-\tHash\t\t\t\t\t\t\t\t\t\t\t\t: SHA-256\n-\tSharedInfo1\t\t\t\t\t\t\t\t\t\t:  (the ephemeral public key octet string \u2013 see [29] section 5.1.3)\n-\tMAC\t\t\t\t\t\t\t\t\t\t\t\t: HMAC\u2013SHA-256\n-\tmackeylen\t\t\t\t\t\t\t\t\t\t: 256\n-\tmaclen\t\t\t\t\t\t\t\t\t\t\t: 64\n-\tSharedInfo2\t\t\t\t\t\t\t\t\t\t: the empty string\n-\tENC\t\t\t\t\t\t\t\t\t\t\t\t: AES\u2013128 in CTR mode\n-\tenckeylen\t\t\t\t\t\t\t\t\t\t\t: 128\n\n-\tbackwards compatibility mode\t\t\t\t\t: false\n*** END OF CHANGES ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn SECG SEC1, the ICB for AES-CTR-mode is set to 0x0000000000000000. Given the block size of AES is 128bit, even though the ephemeral keys are only used for a single encryption, the probability of a same key appearing twice after 2^64 encryption is approximately \u00bd. As pointed out in the study on 256-bit algorithms, a fixed ICB enables an adversary to find a key-ciphertext match with higher probability when performing a known-plaintext attack. In the case of ECIES the attack enables an adversary that knows part of the plaintext to recover the full plaintext. The attack complexity (time, memory, probability) will not be practical, but lower that the expected 128-bit security level. This should be mitigated before ECIES is deployed.\n\n>>> SUMMARY OF CHANGE\nThis CR gives a method generating an ICB used in AES-CTR-mode, In this way, the probability of (enckey, ICB)-collisions is decreased significantly.\n\n>>> CONSEQUENCES IF NOT REVISED\nSUPI leakage by semi-brutal force attack in the known- and chosen plaintext attack models in some conditions.The theoretical complexity of recovering one of many SUPIs is less less than the expected 2^128."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n4.7.5.1.1\tNormal and periodic routing area updating procedure initiation\nTo initiate the normal routing area updating procedure, the MS sends the message ROUTING AREA UPDATE REQUEST to the network, starts timer T3330 and changes to state GMM-ROUTING-AREA-UPDATING-INITIATED. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.\nIf the MS supports S1 mode, the MS shall handle the P-TMSI IE as follows:\n-\tIf the TIN indicates \"GUTI\" and the MS holds a valid GUTI, the MS shall map the GUTI into a P-TMSI, PTMSI signature and RAI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[10]. The MS shall include the mapped RAI in the Old routing area identification IE and the mapped P-TMSI signature in the P-TMSI signature IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to \"mapped P-TMSI\". When the routing area updating procedure is initiated in Iu mode, the MS shall also include the mapped P-TMSI in the PTMSI IE. Additionally, in Iu mode and A/Gb mode, if the MS holds a valid P-TMSI and RAI, the MS shall indicate the P-TMSI in the Additional mobile identity IE and the RAI in the Additional old routing area identification IE.\n-\tIf the TIN indicates \"P-TMSI\" or \"RATrelated TMSI\" and the MS holds a valid P-TMSI and RAI, the MS shall indicate the RAI in the Old routing area identification IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to \"native P-TMSI\". When the routing area updating procedure is initiated in Iu mode, the MS shall also include the P-TMSI in the PTMSI IE.\nIf the MS does not support S1 mode, the MS shall include the P-TMSI type IE with P-TMSI type set to \"native P-TMSI\".\nIf the routing area updating procedure is not initiated by the MS due to an S1 mode to Iu mode or S1 mode to A/Gb mode intersystem change, or if it is initiated due to such an intersystem change and the TIN indicates \"RATrelated TMSI\", the MS shall use the existing UMTS security context for the PS domain. The ROUTING AREA UPDATE REQUEST message shall contain the P-TMSI signature when received in a previous ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message. If the MS has a valid UMTS security context, the MS shall indicate it in the GPRS ciphering key sequence number IE.\nIf the routing area updating procedure is initiated by the MS due to an S1 mode to Iu mode or S1 mode to A/Gb mode inter-system change in idle mode, or if it is initiated by the MS due to PS\u00a0 to CS domain change from S1 mode due to SRVCC or vSRVCC handover, and the TIN indicates \"GUTI\", the MS shall derive a UMTS security context for the PS domain from the current EPS security context as described in the subclause\u00a04.7.7.10. The ROUTING AREA UPDATE REQUEST message shall include a P-TMSI signature filled with a NAS token as specified in 3GPP\u00a0TS\u00a033.401\u00a0[123]. Furthermore, the MS shall indicate the eKSI value, which is associated with the derived UMTS security keys, in the CKSN field of the GPRS GSM ciphering key sequence number IE in the ROUTING AREA UPDATE REQUEST message.\nNOTE:\tWhen the MS includes a P-TMSI signature filled with a NAS token, 8 bits of the NAS token will be filled with bits from the MTMSI (see 3GPP\u00a0TS\u00a023.003\u00a0[10]).\nIf the routing area updating procedure is initiated by the MS due to the S1 mode to Iu mode or S1 mode to A/Gb mode inter-system change in connected mode, the MS shall derive a UMTS security context for the PS domain from the current EPS security context as described in the subclause\u00a04.7.7.10. Furthermore, the MS shall indicate the eKSI value, which is associated with the derived UMTS security keys, in the CKSN field of the GPRS GSM ciphering key sequence number IE in the ROUTING AREA UPDATE REQUEST message.\nIn Iu mode, if the MS wishes to prolong the established PS signalling connection after the normal routing area updating procedure (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause\u00a04.7.13).\nIn order to indicate the new DRX parameter while in GERAN or UTRAN coverage, the MS shall send the ROUTING AREA UPDATE REQUEST message containing the DRX parameter in the DRX parameter IE to the network, with the exception of the case if the MS had indicated its MS specific DRX parameter (3GPP\u00a0TS\u00a024.301\u00a0[120]) to the network while in E-UTRAN coverage. In this case, when the MS enters GERAN or UTRAN coverage and initiates a routing area updating procedure, the MS shall not include the DRX parameter in the DRX parameter IE in the ROUTING AREA UPDATE REQUEST message.\n\n\n\n\n***** Next change *****\n4.7.5.1.3\tNormal and periodic routing area updating procedure accepted by the network\n\nIf the routing area updating request has been accepted by the network, a ROUTING AREA UPDATE ACCEPT message shall be sent to the MS. The network may assign a new P-TMSI and/or a new P-TMSI signature for the MS. If a new P-TMSI and/or P-TMSI signature have been assigned to the MS, it/they shall be included in the ROUTING AREA UPDATE ACCEPT message together with the routing area identification. In a shared network, if the MS is a network sharing supporting MS, the network shall indicate the PLMN identity of the CN operator that has accepted the routing area updating request in the RAI contained in the ROUTING AREA UPDATE ACCEPT message; if the MS is a network sharing non-supporting MS, the network shall indicate the PLMN identity of the common PLMN (see 3GPP\u00a0TS\u00a023.251\u00a0[109]).\nIn a multi-operator core network (MOCN) with common GERAN, the network shall indicate in the RAI the common PLMN identity (see 3GPP\u00a0TS\u00a023.251\u00a0[109]).\n\nIf a new DRX parameter was included in the ROUTING AREA UPDATE REQUEST message, the network shall store the new DRX parameter and use it for the downlink transfer of signalling and user data.\nIf the MS has indicated in the ROUTING AREA UPDATE REQUEST message that it supports PS inter-RAT handover from GERAN to UTRAN Iu mode, the network may include in the ROUTING AREA UPDATE ACCEPT message a request to provide the Inter RAT information container.\nIf the MS has indicated in the ROUTING AREA UPDATE REQUEST message that it supports PS inter-RAT HO from GERAN to E-UTRAN, the network may include in the ROUTING AREA UPDATE ACCEPT message a request to provide the E-UTRAN inter RAT information container.\nIf the MS has included the MS network capability IE or the UE network capability IE or both in the ROUTING AREA UPDATE REQUEST message, the network shall store all octets received from the MS, up to the maximum length defined for the respective information element. In case the UE network capability IE indicated new information to the network, the MS shall set the TIN to \"P-TMSI\".\nNOTE\u00a01:\tThis information is forwarded to the new SGSN during inter-SGSN handover or to the new MME during intersystem handover to S1\u00a0mode.\nIn A/Gb mode the Cell Notification information element shall be included in the ROUTING AREA UPDATE ACCEPT message in order to indicate the ability of the network to support the Cell Notification. \nThe network shall change to state GMM-COMMON-PROCEDURE-INITIATED and shall start the supervision timer T3350 as described in subclause\u00a04.7.6.\nIf the LAI or PLMN identity contained in the ROUTING AREA UPDATE ACCEPT message is a member of any of the \"forbidden\" lists and the MS is not attached for emergency bearer services, then any such entry shall be deleted.\nIn Iu mode, the network should prolong the PS signalling connection if the mobile station has indicated a follow-on request pending in ROUTING AREA UPDATE REQUEST. The network may also prolong the PS signalling connection without any indication from the mobile terminal.\nIf the PDP context status information element is included in ROUTING AREA UPDATE REQUEST message, then the network shall deactivate all those PDP contexts locally (without peer to peer signalling between the MS and the network), which are not in SM state PDP-INACTIVE on network side but are indicated by the MS as being in state PDP-INACTIVE.\nIf the MBMS context status information element is included in the ROUTING AREA UPDATE REQUEST message, then the network shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE on the network side, but are indicated by the MS as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the network shall deactivate all MBMS contexts locally which are not in SM state PDP-INACTIVE on the network side.\nIf a ROUTING AREA UPDATE REQUEST message is received from an MS with a LIPA PDN connection, and if:\n-\ta L-GW Transport Layer Address is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the GGSN address associated with the PDP context of the LIPA PDN connection is different from the provided L-GW Transport Layer Address (see 3GPP\u00a0TS\u00a025.413\u00a0[19c]); or\n-\tno L-GW Transport Layer Address is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,\nthen the SGSN locally deactivates all PDP contexts associated with the LIPA PDN connection. If the ROUTING AREA UPDATE REQUEST request message is accepted, the SGSN informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message that PDP contexts were locally deactivated.\nIf a ROUTING AREA UPDATE REQUEST message is received from an MS with a SIPTO at the local network PDN connection, the following different cases can be distinguished:\n1)\tIf the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:\n-\ta L-GW Transport Layer Address is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the GGSN address associated with the PDP context of the SIPTO at the local network PDN connection is different from the provided L-GW Transport Layer Address (see 3GPP\u00a0TS\u00a025.413\u00a0[19c]); or\n-\tno L-GW Transport Layer Address is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,\n2)\tIf the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:\n-\ta LHN-ID value is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the LHN-ID stored in the PDP context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP\u00a0TS\u00a025.413\u00a0[19c]); or\n-\tno LHN-ID value  is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,\nthen the SGSN locally deactivates all PDP contexts associated with the SIPTO at the local network PDN connection. If the ROUTING AREA UPDATE REQUEST request message is accepted, the SGSN informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message that PDP contexts were locally deactivated.\nFor a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP\u00a0TS\u00a023.401\u00a0[122], subclause\u00a04.3.5.6.\nIf due to regional subscription restrictions or access restrictions the MS is not allowed to access the routing area, but the MS has a PDN connection for emergency bearer services established, the network may accept the ROUTING AREA UPDATE REQUEST message and deactivate all non-emergency PDP contexts by initiating an PDP context deactivation procedure when the routing area updating procedure is initiated in PMM-CONNECTED mode. When the routing area updating procedure is initiated in PMM-IDLE mode, the network locally deactivates all non-emergency PDP contexts and informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message. The network shall not deactivate the PDP contexts for emergency bearer services. The network shall consider the MS to be attached for emergency bearer services only.\nIf the network supports delivery of SMS via GPRS (see 3GPP\u00a0TS\u00a023.060\u00a0[74]) and this delivery is enabled (see 3GPP\u00a0TS\u00a029.272\u00a0[150]), then the network shall include the Additional network feature support IE in the ROUTING AREA UPDATE ACCEPT message and set the GPRS-SMS indicator.\nThe network shall indicate \"combined RA/LA updated\" or \"combined RA/LA updated and ISR activated\" in the update result IE in the ROUTING AREA UPDATE ACCEPT message, if the following conditions apply:\n-\tthe update type IE included in the ROUTING AREA UPDATE REQUEST message indicates \"periodic updating\" and the MS was previously successfully attached for GPRS and non-GPRS services; and\n-\tlocation area updating for non-GPRS services as specified in 3GPP\u00a0TS\u00a029.018\u00a0[149] is successful. \n\nUpon receipt of a ROUTING AREA UPDATE ACCEPT message, the MS stores the received routing area identification, stops timer T3330, shall reset the routing area updating attempt counter and sets the GPRS update status to GU1 UPDATED. If the message contains a P-TMSI, the MS shall use this P-TMSI as new temporary identity for GPRS services and shall store the new P-TMSI. If no P-TMSI was included by the network in the ROUTING AREA UPDATE ACCEPT message, the old P-TMSI shall be kept. Furthermore, the MS shall store the P-TMSI signature if received in the ROUTING AREA UPDATE ACCEPT message. If no P-TMSI signature was included in the message, the old P-TMSI signature, if available, shall be deleted.\nUpon receipt of a ROUTING AREA UPDATE ACCEPT message with update result IE indicating \"combined RA/LA updated\" or \"combined RA/LA updated and ISR activated\" during the periodic routing area updating procedure, the MS shall behave as follows:\n-\tif the ROUTING AREA UPDATE ACCEPT message contains an IMSI, the MS is not allocated any TMSI. The MS shall delete any old TMSI accordingly;\n-\tif the ROUTING AREA UPDATE ACCEPT message contains a TMSI, the MS shall use this TMSI as new temporary identity. The MS shall delete its old TMSI and shall store the new TMSI. In this case, a ROUTING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI; or\n-\tif neither a TMSI nor an IMSI has been included by the network in the ROUTING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.\nIf the ROUTING AREA UPDATE REQUEST message was used to update the network with a new DRX parameter IE, the MS shall start using the new DRX parameter upon receipt of the ROUTING AREA UPDATE ACCEPT message and shall set the TIN to \"P-TMSI\".\nIf the PDP context status information element is included in ROUTING AREA UPDATE ACCEPT message, then the MS shall deactivate all those PDP contexts locally (without peer to peer signalling between the MS and network), which are not in SM state PDP-INACTIVE in the MS but are indicated by the network as being in state PDP-INACTIVE. If only the PDN connection for emergency bearer services remains established, the MS shall consider itself attached for emergency bearer services only.\nIf the MBMS context status information element is included in the ROUTING AREA UPDATE ACCEPT message, then the MS shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE in the MS, but are indicated by the network as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the MS shall deactivate all those MBMS contexts locally which are not in SM state PDP-INACTIVE in the MS.\nIf the ROUTING AREA UPDATE ACCEPT message contains T3312 extended value IE, then the MS shall use the T3312 extended value IE as periodic routing area update timer (T3312). If the ROUTING AREA UPDATE ACCEPT message does not contain T3312 extended value IE, then the MS shall use value in T3312 value IE as periodic routing area update timer (T3312).\nIn A/Gb mode, if the ROUTING AREA UPDATE ACCEPT message contains the Cell Notification information element, then the MS shall start to use the LLC NULL frame to perform cell updates.\nIf the MS has initiated the routing area updating procedure due to manual CSG selection and receives a ROUTING AREA UPDATE ACCEPT message, and the MS sent the ROUTING AREA UPDATE REQUEST message in a CSG cell, the MS shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the MS shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the MS may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.\nThe network may also send a list of \"equivalent PLMNs\" in the ROUTING AREA UPDATE ACCEPT message. Each entry of the list contains a PLMN code (MCC+MNC). If the routing area updating procedure is initiated during a CS fallback procedure and the network is configured to support the return to the last registered E-UTRAN PLMN after CS fallback as specified in 3GPP\u00a0TS\u00a023.272\u00a0[133], and the PLMN identity which is provided as part of the RAI contained in the ROUTING AREA UPDATE ACCEPT message differs from the last registered E-UTRAN PLMN identity, the network shall include the last registered E-UTRAN PLMN identity in the list of \"equivalent PLMNs\" in the ROUTING AREA UPDATE ACCEPT message.\nNOTE\u00a02:\tThe network can determine a routing area updating procedure is initiated during a CS fallback procedure as specified in 3GPP\u00a0TS\u00a023.272\u00a0[133].\nNOTE\u00a03:\tThe last registered E-UTRAN PLMN identity can be derived by the network as specified in 3GPP\u00a0TS\u00a023.272\u00a0[133].\nThe mobile station shall store the list, as provided by the network, and if there is no PDN connection for emergency bearers established, the mobile station shall remove from the list of \"equivalent PLMNs\" any PLMN code that is already in the \"forbidden PLMN\" list or in the list of \"forbidden PLMNs for GPRS service\". If the MS is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the MS shall remove from the list of \"equivalent PLMNs\" any PLMN code present in the \"forbidden PLMN\" list or in the list of \"forbidden PLMNs for GPRS service\" when the PDN connection for emergency bearer services is released. In addition the mobile station shall add to the stored list the PLMN code of the registered PLMN that sent the list. All PLMNs in the stored list shall be regarded as equivalent to each other for PLMN selection, cell selection/re-selection and handover. The stored list in the mobile station shall be replaced on each occurrence of the ROUTING AREA UPDATE ACCEPT message. If no list is contained in the message, then the stored list in the mobile station shall be deleted. An MS attached for emergency bearer services only shall delete the stored list when the MS enters the state GMM-DEREGISTERED. The list shall be stored in the mobile station while switched off so that it can be used for PLMN selection after switch on.\nA ROUTING AREA UPDATE COMPLETE message shall be returned to the network if the ROUTING AREA UPDATE ACCEPT message contained any of:\n-\ta P-TMSI;\n-\tReceive NPDU Numbers (see 3GPP\u00a0TS\u00a044.065\u00a0[78] and 3GPP\u00a0TS\u00a025.322\u00a0[19b]); or\n-\ta request for the provision of Inter RAT handover information or E-UTRAN inter RAT handover information or both.\nIf Receive NPDU Numbers were included, the Receive NPDU Numbers values valid in the MS, shall be included in the ROUTING AREA UPDATE COMPLETE message.\nIf the network has requested the provision of Inter RAT handover information or E-UTRAN inter RAT handover information or both, the MS shall return a ROUTING AREA UPDATE COMPLETE message including the Inter RAT handover information IE or E-UTRAN inter RAT handover information IE or both to the network.\nNOTE\u00a04:\tIn Iu mode, after a routing area updating procedure, the mobile station can initiate Service Request procedure to request the resource reservation for the active PDP contexts if the resources have been released by the network or send upper layer message (e.g. ACTIVATE PDP CONTEXT REQUEST) to the network via the existing PS signalling connection.\nIn Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated \"follow-on request pending\" in ROUTING AREA UPDATE REQUEST message) the network shall indicate the \"follow-on proceed\" in the ROUTING AREA UPDATE ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate \"no follow-on proceed\" in the ROUTING AREA UPDATE ACCEPT message.\nAfter that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Update result information element in the ROUTING AREA UPDATE ACCEPT message (see subclause\u00a04.7.13).\nThe network may also send a list of local emergency numbers in the ROUTING AREA UPDATE ACCEPT, by including the Emergency Number List IE. The mobile equipment shall store the list, as provided by the network. The list stored in the mobile equipment shall be replaced on each receipt of the Emergency Number List IE.\nThe emergency number(s) received in the Emergency Number List IE are valid only in networks in the same country as the cell on which this IE is received. If no list is contained in the ROUTING AREA UPDATE ACCEPT message, then the stored list in the mobile equipment shall be kept, except if the mobile equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.\nThe mobile equipment shall use the stored list of emergency numbers received from the network in addition to the emergency numbers stored on the SIM/USIM or ME to detect that the number dialled is an emergency number.\nNOTE\u00a05:\tThe mobile equipment may use the emergency numbers list to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.\nThe list of emergency numbers shall be deleted at switch off and removal of the SIM/USIM. The mobile equipment shall be able to store up to ten local emergency numbers received from the network.\nIn order to indicate to the MS that the GUTI and TAI list assigned to the MS remain registered with the network and are valid in the MS, the network shall indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is activated.\nIf the MS is attached for emergency bearer services or if the network has deactivated all non-emergency PDP contexts, the network shall indicate in the update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is not activated.\nIf the ROUTING AREA UPDATE ACCEPT message contains:\ni)\tno indication that ISR is activated, an MS supporting S1 mode shall set the TIN to \"P-TMSI\"; or\nii)\tan indication that ISR is activated, then:\n-\tif the MS is required to perform tracking area updating for IMS voice termination as specified in annex\u00a0P.5, the MS shall set the TIN to \"P-TMSI\";\n-\tif the MS had initiated the routing area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the MS shall set the TIN to \"P-TMSI\"; or\n-\tthe MS shall regard the available GUTI and TAI list as valid and registered with the network. If the TIN currently indicates \"GUTI\" and the periodic tracking area update timer T3412 is running, the MS shall set the TIN to \"RAT-related TMSI\". If the TIN currently indicates \"GUTI\" and the periodic tracking area update timer T3412 has already expired, the MS shall set the TIN to \"P-TMSI\".\n\n***** Next change *****\n4.7.5.2.3\tCombined routing area updating procedure accepted by the network\nDepending on the value of the update result IE received in the ROUTING AREA UPDATE ACCEPT message, two different cases can be distinguished:\nCase 1)\tThe update result IE value indicates \"combined RA/LA\": Routing and location area \tupdating is successful;\nCase 2)\tThe update result IE value indicates \"RA only\": Routing area updating is successful, but location area updating is not successful.\nA ROUTING AREA UPDATE COMPLETE message shall be returned to the network if the ROUTING AREA UPDATE ACCEPT message containsany of:\n-\ta P-TMSI and/or a TMSI;\n-\tReceive NPDU Numbers (see 3GPP\u00a0TS\u00a044.065\u00a0[78] and 3GPP\u00a0TS\u00a025.322\u00a0[19b]); or\n-\ta request for the provision of Inter RAT handover information or E-UTRAN inter RAT handover information or both.\nIf Receive NPDU Numbers were included, the Receive NPDU Numbers that are valid in the MS shall be included in the ROUTING AREA UPDATE COMPLETE message.\nIf the network has requested the provision of Inter RAT handover information or E-UTRAN inter RAT handover information the MS shall return a ROUTING AREA UPDATE COMPLETE message including the Inter RAT handover information IE or the E-UTRAN inter RAT handover information IE or both, as applicable, to the network.\nIn Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated \"follow-on request pending\" in ROUTING AREA UPDATE REQUEST message) the network shall indicate the \"follow-on proceed\" in the ROUTING AREA UPDATE ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate \"no follow-on proceed\" in the ROUTING AREA UPDATE ACCEPT message.\nAfter that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Update result information element in the ROUTING AREA UPDATE ACCEPT message (see subclause\u00a04.7.13).\nIf the network supports CS Fallback, and the mobile station has indicated support of EMM combined procedures in MS network capability, the network shall indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is not activated.\n\n***** Next change *****\n4.7.5.2.5\tAbnormal cases in the MS\nThe MS shall proceed as follows:\n1)\tIf the combined routing area update was successful for GPRS services only and the ROUTING AREA UPDATE ACCEPT message contained a cause value not treated in subclause\u00a04.7.5.2.3.2 or the GMM Cause IE is not included in the message, the MS shall proceed as follows:\na)\tThe MS shall stop timer T3330 if still running, and shall enter state MM IDLE. The routing area updating attempt counter shall be incremented;\nb)\tIf the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GMM update status is equal to GU1 UPDATED:\n-\tthe MS shall keep the GMM update status GU1 UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. The MS shall start timer T3311. When timer T3311 expires the combined routing area update procedure indicating \"combined RA/LA updating with IMSI attach\" is triggered again; and\nc)\tIf the routing area updating attempt counter is greater than or equal to 5:\n-\tthe MS shall start timer T3302 and shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM; and\n-\ta GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II or as long as the combined GMM procedures are not successful and no new RA is entered; and\n2)\totherwise, the abnormal cases specified in subclause\u00a04.7.5.1.5 apply with the following modification.\n\nIf the GPRS routing area updating attempt counter is incremented according to subclause\u00a04.7.5.1.5 the next actions depend on the Location Area Identities (stored on SIM/USIM and the one of the current serving cell) and the value of the routing area updating attempt counter.\n-\tif the update status is U1 UPDATED, and the stored LAI is equal to the one of the current serving cell and the routing area updating attempt counter is smaller than 5, then the mobile station shall keep the update status to U1 UPDATED, the new MM state is MM IDLE substate NORMAL SERVICE;\n-\tif the routing area updating attempt counter is smaller than 5 and, additionally, the update status is different from U1 UPDATED or the stored LAI is different from the one of the current serving cell, the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The MM state remains MM LOCATION UPDATING PENDING; or\n-\tif the routing area updating attempt counter is greater or equal to 5, the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and the list of equivalent PLMNs, and shall set the update status to U2 NOT UPDATED.\nA GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. \nThe MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered. The new MM state is MM IDLE substate ATTEMPTING TO UPDATE or optionally MM IDLE substate PLMN SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\n***** Next change *****\n9.4.14.4\tTMSI status\nThis IE shall be included if the MS performs a combined routing area update and no valid TMSI is available.\n\n***** Next change *****\n10.5.5.4\tTMSI status\nThe purpose of the TMSI status information element is to indicate whether a valid TMSI is available in the MS or not.\nThe TMSI status is a type 1 information element.\nThe TMSI status information element is coded as shown in figure\u00a010.5.120/3GPP TS 24.008 and table\u00a010.5.137/3GPP\u00a0TS 24.008.\n\n8\t7\t6\t5\t4\t3\t2\t1\nTMSI status\t0\t0\t0\tTMSI\toctet 1\nIEI\tspare\tflag\n\nFigure 10.5.120/3GPP TS 24.008: TMSI status information element\nTable 10.5.137/3GPP TS 24.008: TMSI status information element\nTMSI flag (octet 1)\nBit\n1\n0\t\t\t\tno valid TMSI available\n1\t\t\t\tvalid TMSI available\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 29.018 includes an option that in certain cases when the SGSN receives a periodic routing area update request from the MS, then the SGSN can initiate a location update for non-GPRS services procedure instead of asking the MS to re-attach to non-GPRS services. I.e. effectively the SGSN can convert the update type from \"periodic\" to \"combined\" and skip the network-initiated detach with detach type \"IMSI detach\". The purpose of this option is to reduce the signalling via the radio interface by saving the exchange of 3 messages (RAU Accept, Detach Request/Detach Accept). The network conditions under which this option can be used are VLR reset, VLR long-time outage and VLR load re-distribution, i.e. the MS usually is not aware of these conditions.1) For R99 to Rel-11, the option that the SGSN can convert the update type from \"periodic\" to \"combined\" has not been described in TS 24.008, and only recently parts of the MS and network requirements have been added to the Rel-11 and Rel-12 version (see e.g. 24.008 CRs #2296r1, C1-124701, and #2384r1, C1-132525). So it is unclear whether legacy MS implementations are behaving in the expected way, e.g. whether the MS- responds with a RAU Complete message if a new TMSI has been allocated;. - starts timer T3311 or T3302 upon receipt of certain GMM causes (e.g. #16, #17, #22) in the Attach Accept message and initiates a combined RAU 'with IMSI attach' upon timer expiry;- starts timer T3311 or T3302 when certain abnormal cases occur (e.g. T3330 timeout or lower layer failure) and initiates a combined RAU 'with IMSI attach' upon timer expiry. (For more details see C1-132127, C1-133929, and C1-140170.)2) On the other hand, also the SGSN requirements need some clarification. E.g. according to stage 2, TS 23.272:\"\u2026 So an SGSN in a CSFB/SMS over SGs configuration never indicates ISR activated in combined RAU procedures for a UE that supports CSFB/SMS over SGs. An SGSN with ISR capability in a CSFB/SMS over SGs configuration shall always maintain ISR by indicating ISR Activated in Periodic RAU Accept for a UE that supports CSFB/SMS over SGs if the SGSN has the status that ISR is activated for the UE.\"but the option to convert the periodic RAU to a combined RAU is not known to stage 2 (23.060, 23.401, 23.272, 23.236), and consequently it has not been taken into consideration.3) The CRs agreed so far by CT1 are duplicating requirements from the description of the combined RAU procedure in the description of the normal and periodic RAU procedure. Thus it remains unclear whether the MS and the network should consider the procedure to be a periodic or a combined  RAU procedure. But the type of procedure has consequences e.g. for the value update type during a subsequent combined TAU ('with' or 'without IMS attach'), so it needs to be clearly specified. 4) Finally, the state of the Gs association is not a sufficient criterion for the SGSN to initiate the location update, when the MS initiates a periodic RAU. E.g. the MS can have an ongoing CS connection, or it may even have performed a detach from CS services locally or while in E-UTRAN, but the state of the Gs association is not in synch with this (for more details see C1-133929.)Especially due to the last item, we propose that in a network operating in NMO\u00a0I, when the MS initiates a periodic routing area update procedure, it explicitly indicates to the network whether an \"IMSI re-attach is allowed\" or not. The SGSN will use this information to decide whether to initiate a location update via the Gs interface (see related CR0136 to 29.018). An MS indicating \"IMSI re-attach allowed\" is also indicating that it is supporting TMSI re-allocation, receipt of a GMM cause IE, and a specific abnormal case handling following the requirements for combined RAU procedures.We also propose to specify clearly from which point in time onwards (or upon which event) the MS or the SGSN shall consider the procedure as a combined RAU procedure.(With these changes, most of the changes introduced by 24.008 CRs #2296r1, C1-124701, and #2384r1, C1-132525, can be removed again.)Two additional changes are included:i) CRs #2296r1, C1-124701, and #2384r1, C1-132525, have started to explicitly discriminate between e.g. \"combined RA/LA updated\" or \"combined RA/LA updated and ISR activated\". For consistency this should be done in all places, e.g. also in subclause 4.7.5.2.3. ii) In subclause 4.7.5.2.5 \"Abnormal cases in the MS\" (during combined routing area updating procedure), a clarification is added that not only after receipt of a GMM cause IE, but also in other abnormal cases (especially after lower layer failure and T3330 expiry) the MS shall indicate \"combined RA/LA updating with IMSI attach\" during subsequent combined RAU attempts. \u2013 This is needed, because when the location update via the Gs interface was completed successfully, the SGSN marks the Gs association as \"Gs associated\" and sets the VLR-Reliable variable to \"true\", regardless whether afterwards the transmission of the RAU ACCEPT message to the MS is successful or not. I.e. when the MS repeats the RAU request, indicating \"combined  RA/LA updating [without IMSI attach]\", the SGSN may skip the signalling towards the VLR. In that case the VLR will not be able to re-allocate the TMSI during this new combined RAU procedure.\n\n>>> SUMMARY OF CHANGE\n1) If the MS initiates a periodic RAU procedure in a network operating in NMO I, it shall indicate explicitly whether \"IMSI re-attach is allowed\" or not. An MS indicating \"IMSI re-attach is allowed\" shall also follow the abnormal case handling for  a combined RAU procedure.2) If the SGSN decides to initiate a location update towards the VLR, it shall consider the procedure to be a combined RAU procedure and follow the requirements for the combined RAU procedure. This includes e.g. the setting of the update result, the setting of the ISR activation status and the possible inclusion of a GMM cause. For a periodic RAU procedure the SGSN sets the update result to \"RA updated\".3) Upon receipt of a RAU ACCEPT message with update result \"combined RA/LA udpated\" or with a GMM cause IE included, the MS shall consider the procedure to be a combined RAU procedure and follow the requirements for the combined RAU procedure. This includes e.g. the sending of a RAU COMPLETE message, the starting of timer T3311 upon receipt of certain GMM causes, and . the setting of the update type to \"combined RAU with IMSI attach\" for subsequent re-attempts.4) Explicit discrimination between e.g. \"combined RA/LA updated\" or \"combined RA/LA updated and ISR activated\" is added in subclause 4.7.5.2.3. 5) In subclause 4.7.5.2.5 \"Abnormal cases in the MS\" (during combined routing area updating procedure), it is clarified that during subsequent combined RAU attempts the MS shall indicate \"combined RA/LA updating with IMSI attach\".\n\n>>> CONSEQUENCES IF NOT REVISED\nIncomplete specification can result in incomplete implementation both in the MS and in the SGSN. If the SGSN initiates the location update via the Gs interface without explicit permission from the MS, and the MS and the network implementation do not react properly on certain error cases, then the MS can become unreachable for paging for CS calls via the Gs interface.If the SGSN initiates the location update via the Gs interface without explicit permission from the MS, possible consequences are:- if the periodic RAU occurs during an ongoing CS connection, the MS can become unreachable for additional mobile terminating services via the CS domain as long as the CS connection is ongoing; and- the MS can become re-attached to CS services, although it performed a detach procedure from CS services before."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n5.1.1.2.1\tGeneral\nThe initial registration procedure consists of the UE sending an unprotected REGISTER request and, if challenged depending on the security mechanism supported for this UE, sending the integrity-protected REGISTER request or other appropriate response to the challenge. The UE can register a public user identity with any of its contact addresses at any time after it has acquired an IP address, discovered a P-CSCF, and established an IP-CAN bearer that can be used for SIP signalling. However, the UE shall only initiate a new registration procedure when it has received a final response from the registrar for the ongoing registration, or the previous REGISTER request has timed out.\nWhen registering any public user identity belonging to the UE, the UE shall either use an already active pair of security associations or a TLS session to protect the REGISTER requests, or register the public user identity via a new initial registration procedure.\nWhen binding any one of its public user identities to an additional contact address via a new initial registration procedure, the UE shall follow the procedures described in RFC\u00a05626\u00a0[92]. The set of security associations or a TLS session resulting from this initial registration procedure will have no impact on the existing set of security associations or TLS sessions that have been established as a result of previous initial registration procedures. However, if the UE registers any one of its public user identities with a new contact address via a new initial registration procedure and does not employ the procedures described in RFC\u00a05626\u00a0[92], then the new set of security associations or TLS session shall replace any existing set of security association or TLS session.\nIf the UE detects that the existing security associations or TLS sessions associated with a given contact address are no longer active (e.g., after receiving no response to several protected messages), the UE shall:\n-\tconsider all previously registered public user identities bound to this security associations or TLS session that are only associated with this contact address as deregistered; and\n-\tstop processing all associated ongoing dialogs and transactions that were using the security associations or TLS session associated with this contact address, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs).\nThe UE shall send the unprotected REGISTER requests to the port advertised to the UE during the P-CSCF discovery procedure. If the UE does not receive any specific port information during the P-CSCF discovery procedure, or if the UE was pre-configured with the P-CSCF's IP address or domain name and was unable to obtain specific port information, the UE shall send the unprotected REGISTER request to the SIP default port values as specified in RFC\u00a03261\u00a0[26].\nNOTE\u00a01:\tThe UE will only send further registration and subsequent SIP messages towards the same port of the P-CSCF for security mechanisms that do not require to use negotiated ports for exchanging protected messages.\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request-URI in the registration, according to the procedures described in subclause\u00a05.1.1.1A or subclause\u00a05.1.1.1B. A public user identity may be input by the end user.\nOn sending an unprotected REGISTER request, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP URI that contains:\n1)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the main URI of the UE; else\n2)\tthe public user identity to be registered;\nb)\ta To header field set to the SIP URI that contains:\n1)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the main URI of the UE; else\n2)\tthe public user identity to be registered;\nc)\ta Contact header field set to include SIP URI(s) containing the IP address or FQDN of the UE in the hostport parameter. If the UE:\n1)\tsupports GRUU (see table\u00a0A.4, item\u00a0A.4/53);\n2)\tsupports multiple registrations;\n3)\thas an IMEI available; or\n4)\thas an MEID available;\n\tthe UE shall include a \"+sip.instance\" header field parameter containing the instance ID. Only the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks.\nNOTE\u00a02:\tThe requirement placed on the UE to include an instance ID based on the IMEI or the MEID when the UE does not support GRUU and does not support multiple registrations does not imply any additional requirements on the network.\n\tIf the UE supports multiple registrations it shall include a \"reg-id\" header field parameter as described in RFC\u00a05626\u00a0[92].\n\tThe UE shall include all supported ICSI values (coded as specified in subclause\u00a07.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause\u00a07.9.2 and RFC\u00a03840\u00a0[62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause\u00a07.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause\u00a07.9.3 and RFC\u00a03840\u00a0[62].\n\tThe UE shall include the media feature tags as defined in RFC\u00a03840\u00a0[62] for all supported streaming media types.\n\tIf the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Contact URI without a user portion and containing the \"bnc\" URI parameter;\n\nd)\ta Via header field set to include the sent-by field containing the IP address or FQDN of the UE and the port number where the UE expects to receive the response to this request when UDP is used. For TCP, the response is received on the TCP connection on which the request was sent. For the UDP, the UE shall also include a \"rport\" header field parameter with no value in the Via header field. Unless the UE has been configured to not send keep-alives, and unless the UE is directly connected to an IP-CAN for which usage of NAT is not defined, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate support of sending keep-alives associated with the registration, as described in RFC\u00a06223\u00a0[143];\nNOTE\u00a03:\tWhen sending the unprotected REGISTER request using UDP, the UE transmit the request from the same IP address and port on which it expects to receive the response to this request.\ne)\ta registration expiration interval value of 600\u00a0000 seconds as the value desired for the duration of the registration;\nNOTE\u00a04:\tThe registrar (S-CSCF) might decrease the duration of the registration in accordance with network policy. Registration attempts with a registration period of less than a predefined minimum value defined in the registrar will be rejected with a 423 (Interval Too Brief) response.\nf)\ta Request-URI set to the SIP URI of the domain name of the home network used to address the REGISTER request;\ng)\tthe Supported header field containing the option-tag \"path\", and\n1)\tif GRUU is supported, the option-tag \"gruu\"; and\n2)\tif multiple registrations is supported, the option-tag \"outbound\".\nh)\tif a security association or TLS session exists, and if available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause\u00a07.2A.4);\ni)\ta Security-Client header field to announce the media plane security mechanisms the UE supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause\u00a07.2A.7;\nNOTE\u00a05:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nj)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Require header field containing the option-tag \"gin\"; and\nk)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Proxy-Require header field containing the option-tag \"gin\".\nOn receiving a 401 (Unauthorized) response to the REGISTER request, the UE shall:\na)\tif available, store the announcement of media plane security mechanisms the P-CSCF (IMS-ALG) supports labelled with the \"mediasec\" header field parameter specified in subclause\u00a07.2A.7 and received in the Security-Server header field, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, the UE may initiate that mechanism on a media level when it initiates new media in an existing session.\nNOTE\u00a06:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\na)\tstore the expiration time of the registration for the public user identities found in the To header field value and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used);\nNOTE\u00a07:\tIf the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the To header field will contain the main URI of the UE.\nb)\tstore as the default public user identity the first URI on the list of URIs present in the P-Associated-URI header field and bind it to the respective contact address of the UE and the associated set of security associations or TLS session;\nNOTE\u00a08:\tWhen using the respective contact address and associated set of security associations or TLS session, the UE can utilize additional URIs contained in the P-Associated-URI header field and bound it to the respective contact address of the UE and the associated set of security associations or TLS session, e.g. for application purposes.\nc)\ttreat the identity under registration as a barred public user identity, if it is not included in the P-Associated-URI header field;\nd)\tstore the list of service route values contained in the Service-Route header field and bind the list either to the contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or TLS session over which the REGISTER request was sent;\nNOTE\u00a09:\tWhen multiple registration mechanism is not used, there will be only one list of service route values bound to a contact address. However, when multiple registration mechanism is used, there will be different list of service route values bound to each registration flow and the associated contact address.\nNOTE\u00a010:\tThe UE will use the stored list of service route values to build a proper preloaded Route header field for new dialogs and standalone transactions (other than REGISTER method) when using either the respective contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or TLS session.\ne)\tif the UE indicated support for GRUU in the Supported header field of the REGISTER request then:\n-\tif the UE did not use the procedures specified in RFC\u00a06140\u00a0[191] for registration, find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter or a \"temp-gruu\" header field parameter or both, then store the value of those parameters as the GRUUs for the UE in association with the public user identity and the contact address that was registered; and\n-\tif the UE used the procedures specified in RFC\u00a06140\u00a0[191] for registration then find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter then store the value of the \"pub-gruu\" header field parameter for use for generating public GRUUs for registering UAs as specified in RFC\u00a06140\u00a0[191]. If this contains a \"temp-gruu-cookie\" header field parameter then store the value of the \"temp-gruu-cookie\" header field parameter for use for generating temporary GRUUs for registering UAs as specified in RFC\u00a06140\u00a0[191];\nNOTE\u00a011:\tWhen allocating public GRUUs to registering UAs the functionality within the UE that performs the role of registrar will add an \"sg\" SIP URI parameter that uniquenly identifies that UA to the public GRUU it received in the \"pub-gruu\" header field parameter. The procedures for generating a temporary GRUU using the \"temp-gruu-cookie\" header field parameter are specified in subclause\u00a07.1.2.2 of RFC\u00a06140\u00a0[191].\nf)\tif the REGISTER request contained the \"reg-id\" and \"+sip.instance\" Contact header field parameter and the \"outbound\" option tag in a Supported header field, the UE shall check whether the option-tag \"outbound\" is present in the Require header field:\n-\tif no option-tag \"outbound\" is present, the UE shall conclude that the S-CSCF does not support the registration procedure as described in RFC\u00a05626\u00a0[92], and the S-CSCF has followed the registration procedure as described in RFC\u00a05627\u00a0[93] or RFC\u00a03261\u00a0[26], i.e., if there is a previously registered contact address, the S-CSCF replaced the old contact address and associated information with the new contact address and associated information (see bullet e) above). Upon detecting that the S-CSCF does not support the registration procedure as defined in RFC\u00a05626\u00a0[92], the UE shall refrain from registering any additional IMS flows for the same private identity as described in RFC\u00a05626\u00a0[92]; or\nNOTE\u00a012:\tUpon replaces the old contact address with the new contact address, the S-CSCF performs the network initiated deregistration procedure for the previously registered public user identities and the associated old contact address as described in subclause\u00a05.4.1.5. Hence, the UE will receive a NOTIFY request informing the UE about the deregistration of the old contact address.\n-\tif an option-tag \"outbound\" is present, the UE may establish additional IMS flows for the same private identity, as defined in RFC\u00a05626\u00a0[92];\ng)\tif available, store the announcement of media plane security mechanisms the P-CSCF (IMS-ALG) supports labelled with the \"mediasec\" header field parameter specified in subclause\u00a07.2A.7 and received in the Security-Server header field, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, it may initiate that mechanism on a media level when it initiates new media in an existing session;\nNOTE\u00a013:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nh)\tif the Via header field contains a \"keep\" header field parameter with a value, unless the UE detects that it is not behind a NAT, start to send keep-alives associated with the registration towards the P-CSCF, as described in RFC\u00a06223\u00a0[143];\ni)\tif the 200 (OK) response includes a Feature-Caps header field, as specified in RFC\u00a06809\u00b0[190], with \"+g.3gpp.icsi-ref\" header field parameter, then the UE may consider the values included in the \"+g.3gpp.icsi-ref\" header field parameter of the Feature-Caps header field of 200 (OK) response as supported by the IM subsystem for the established registration or registration flow (if the multiple registration mechanism is used); and\nNOTE\u00a014:\tThe UE and related applications can use the ICSI values received in the Feature-Caps header field of 200 (OK) response to improve the user experience.\nj)\tif the 200 (OK) response includes one or more Feature-Caps header fields containing the capability indicators listed in subclause\u00a07.9A.7 that indicate the media capabilities supported by the IMS-AGW then the UE may consider this information when providing media options to the user or determining whether an application communication capability will be successful (e.g. if \"sip.video\" is not indicated then the UE might not offer the user the option to attempt to add video to the session).\nNOTE\u00a015:\tIf media capability indication is not supported, no capability indicators listed in subclause\u00a07.9A.7 are included and it can be assumed that all the media capabilities are supported.\nOn receiving a 305 (Use Proxy) response to the unprotected REGISTER request, unless otherwise specified in access specific annexes (as described in Annex B or Annex L), the UE shall:\na)\tignore the contents of the Contact header field if it is included in the received message;\nNOTE\u00a016:\tThe 305 response is not expected to contain a Contact header field.\nb)\trelease all IP-CAN bearers used for the transport of media according to the procedures in subclause\u00a09.2.2;\nc)\tinitiate either a new P-CSCF discovery procedure as described in subclause\u00a09.2.1, or select a new P-CSCF, if the UE was pre-configured with more than one P-CSCF's IP addresses or domain names;\nd)\tselect a P-CSCF address, which is different from the previously used address, from the address list; and\ne)\tperform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nOn receiving a 423 (Interval Too Brief) response to the REGISTER request, the UE shall:\n-\tsend another REGISTER request populating the registration expiration interval value with an expiration timer of at least the value received in the Min-Expires header field of the 423 (Interval Too Brief) response.\nOn receiving a 408 (Request Timeout) response or 500 (Server Internal Error) response or 504 (Server Time-Out) or 600 (Busy Everywhere) response for an initial registration, the UE may attempt to perform initial registration again.\nWhen the timer F expires at the UE, the UE may:\na)\tselect a different P-CSCF address from the list of P-CSCF addresses discovered during the procedures described in subclause\u00a09.2.1 or from its pre-configured list of P-CSCF's IP addresses or domain names;\nb)\tif no response has been received when attempting to contact all P-CSCFs known by the UE, get a new set of P-CSCF-addresses as described in subclause\u00a09.2.1 unless otherwise specified in the access specific annexes (as described in Annex B or Annex L); and\nc)\tperform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nNOTE\u00a017:\tIt is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g. based on ICMP messages.\nOn receiving a 4xx, 5xx or 6xx response to the REGISTER request, whereby the response contains a Retry-After header field, the UE shall not automatically attempt an initial registration via the same IP-CAN and the same P-CSCF for the amount of time indicated in the Retry-After header field. If the UE is power cycled, the UE can attempt an initial registration. If no initial registration occurs within the time period indicated by the Retry-After header field, the counter of unsuccessful initial registration attempts is reset.\nAfter a first unsuccessful initial registration attempt, if the Retry-After header field was not present and the initial registration was not performed as a consequence of a failed reregistration, the UE shall not wait more than 5 minutes before attempting a new registration.\nAfter a maximum of 2 consecutive unsuccessful initial registration attempts, if the Retry-After header field was not present in failure responses of those unsuccessful initial registration attempts, the UE shall implement the mechanism defined in subclause\u00a04.5 of RFC\u00a05626\u00a0[92] for new registration attemps. The UE shall use the values of the parameters max-time and base-time, of the algorithm defined in subclause\u00a04.5 of RFC\u00a05626\u00a0[92]. If no values of the parameters max-time and base-time have been provided to the UE by the network, the default values defined in subclause\u00a04.5 of RFC\u00a05626\u00a0[92] shall be used.\nThe values of max-time and base-time may be provided by the network to the UE using OMA-DM with the management objects specified in 3GPP\u00a0TS\u00a024.167\u00a0[8G]. Other mechanisms may be used as well and are outside the scope of the present specification.\n\n\n***** Next change *****\n5.1.1.4.1\tGeneral\nThe UE can perform the reregistration of a previously registered public user identity bound to any one of its contact addresses and the associated set of security associations or TLS sessions at any time after the initial registration has been completed.\nThe UE can perform the reregistration of a previously registered public user identity over any existing set of security associations or TLS session that is associated with the related contact address.\nThe UE can perform the reregistration of a previously registered public user identity via an initial registration as specified in subclause\u00a05.1.1.2, when binding the previously registered public user identity to new contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used).\nThe UE can perform registration of additional public user identities at any time after the initial registration has been completed. The UE shall perform the registration of additional public user identities either:\n-\tover the existing set of security associations or TLS sessions, if appropriate to the security mechanism in use, that is associated with the related contact address; or\n-\tvia an initial registration as specified in subclause\u00a05.1.1.2.\nThe UE can fetch bindings as defined in RFC\u00a03261\u00a0[26] at any time after the initial registration has been completed. The procedure for fetching bindings is the same as for a reregistration except that the REGISTER request does not contain a Contact header field.\nUnless either the user or the application within the UE has determined that a continued registration is not required the UE shall reregister an already registered public user identity either 600 seconds before the expiration time if the previous registration was for greater than 1200 seconds, or when half of the time has expired if the previous registration was for 1200 seconds or less, or when the UE intends to update its capabilities according to RFC\u00a03840\u00a0[62] or when the UE needs to modify the ICSI values that the UE intends to use in a g.3gpp.icsi-ref media feature tag or IARI values that the UE intends to use in the g.3gpp.iari-ref media feature tag.\nWhen sending a protected REGISTER request, the UE shall use a security association or TLS session associated either with the contact address or to the registration flow and the associated contact address used to send the request, see 3GPP\u00a0TS\u00a033.203\u00a0[19], established as a result of an earlier initial registration.\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request-URI in the registration, according to the procedures described in subclause\u00a05.1.1.1A or subclause\u00a05.1.1.1B.\nOn sending a REGISTER request that does not contain a challenge response, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP URI that contains:\n1)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the main URI of the UE; else\n2)\tthe public user identity to be registered;\nb)\ta To header field set to the SIP URI that contains:\n1)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the main URI of the UE; else\n2)\tthe public user identity to be registered;\nc)\ta Contact header field set to include SIP URI(s) that contain(s) in the hostport parameter the IP address or FQDN of the UE, and containing the instance ID of the UE in the \"+sip.instance\" header field parameter, if the UE:\n1)\tsupports GRUU (see table\u00a0A.4, item\u00a0A.4/53);\n2)\tsupports multiple registrations;\n3)\thas an IMEI available; or\n4)\thas an MEID available.\n\tOnly the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks.\nNOTE\u00a01:\tThe requirement placed on the UE to include an instance ID based on the IMEI or the MEID when the UE does not support GRUU and does not support multiple registrations does not imply any additional requirements on the network.\n\tIf the UE support multiple registrations, it shall include \"reg-id\" header field as described in RFC\u00a05626\u00a0[92]. The UE shall include all supported ICSI values (coded as specified in subclause\u00a07.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause\u00a07.9.2 and RFC\u00a03840\u00a0[62] for the IMS communication it intends to use, and IARI values (coded as specified in subclause\u00a07.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause\u00a07.9.3 and RFC\u00a03840\u00a0[62].\n\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Contact URI without a user portion and containing the \"bnc\" URI parameter;\n\nd)\ta Via header field set to include the IP address or FQDN of the UE in the sent-by field. For the TCP, the response is received on the TCP connection on which the request was sent. If the UE previously has previously negotiated sending of keep-alives associated with the registration, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate continuous support to send keep-alives, as described in RFC\u00a06223\u00a0[143];\ne)\ta registration expiration interval value, set to 600 000 seconds as the value desired for the duration of the registration;\nNOTE\u00a02:\tThe registrar (S-CSCF) might decrease the duration of the registration in accordance with network policy. Registration attempts with a registration period of less than a predefined minimum value defined in the registrar will be rejected with a 423 (Interval Too Brief) response.\nf)\ta Request-URI set to the SIP URI of the domain name of the home network used to address the REGISTER request;\ng)\tthe Supported header field containing the option-tag \"path\", and:\n1)\tif GRUU is supported, the option-tag \"gruu\"; and\n2)\tif multiple registrations is supported, the option-tag \"outbound\";\nh)\tif available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause\u00a07.2A.4);\ni)\ta Security-Client header field to announce the media plane security mechanisms the UE supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause\u00a07.2A.7;\nNOTE\u00a03:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nj)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Require header field containing the option-tag \"gin\"; and\nk)\tif the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Proxy-Require header field containing the option-tag \"gin\".\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\na)\tbind the new expiration time of the registration for this public user identity found in the To header field value either to the contact address or to the registration flow and the associated contact address used in this registration;\nNOTE\u00a04:\tIf the UE supports RFC\u00a06140\u00a0[191] and performs the functions of an external attached network, the To header field will contain the main URI of the UE.\nb)\tstore the list of service route values contained in the Service-Route header field and bind the list either to the contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used);\nNOTE\u00a05:\tThe stored list of service route values will be used to build a proper preloaded Route header field for new dialogs and standalone transactions (other than REGISTER method) when using either the respective contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used).\nNOTE\u00a06:\tIf the list of Service-Route headers saved from a previous registration and bound either to this contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or TLS session already exist, then the received list of Service-Route headers replaces the old list.\nNOTE\u00a07:\tThe UE can utilize additional URIs contained in the P-Associated-URI header field, e.g. for application purposes.\nc)\tif the UE indicated support for GRUU in the Supported header field of the REGISTER request then:\n-\tif the UE did not use the procedures specified in RFC\u00a06140\u00a0[191] for registration find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter or a \"temp-gruu\" header field parameter or both, then store the value of those parameters as the GRUUs for the UE in association with the public user identity and the contact address that was registered; and\n-\tif the UE used the procedures specified in RFC\u00a06140\u00a0[191]for registration then find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter then store the value of the \"pub-gruu\" header field parameter for use for generating public GRUUs for registering UAs as specified in RFC\u00a06140\u00a0[191]. If this contains a \"temp-gruu-cookie\" header field parameter then store the value of the \"temp-gruu-cookie\" header field parameter for use for generating temporary GRUUs for registering UAs as specified in RFC\u00a06140\u00a0[191];\nNOTE\u00a08:\tWhen allocating public GRUUs to registering UAs the functionality within the UE that performs the role of registrar will add an \"sg\" SIP URI parameter that uniquenly identifies that UA to the public GRUU it received in the \"pub-gruu\" header field parameter. The procedures for generating a temporary GRUU using the \"temp-gruu-cookie\" header field parameter are specified in subclause\u00a07.1.2.2 of RFC\u00a06140\u00a0[191].\nd)\tstore the announcement of the media plane security mechanisms the P-CSCF (IMS-ALG) supports received in the Security-Server header field and labelled with the \"mediasec\" header field parameter specified in subclause\u00a07.2A.7, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, it may initiate that mechanism on a media level when it initiates new media in an existing session;\nNOTE\u00a09:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\ne)\tif the Via header field contains a \"keep\" header field parameter with a value, continue to send keep-alives as described in RFC\u00a06223\u00a0[143], towards the P-CSCF;\nf)\tif the 200 (OK) response contains the Authentication-Info header field including a nextnonce field, store the contained nonce as a nonce for authentication associated to the same registration or registration flow (if the multiple registration mechanism is used) and shall delete any other previously stored nonce value for authentication for this registration or registration flow (if the multiple registration mechanism is used);\nNOTE\u00a010:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\ng)\tif the 200 (OK) response includes a Feature-Caps header field, as specified in RFC\u00a06809\u00b0[190], with \"+g.3gpp.icsi-ref\" header field parameter, then the UE may consider the values included in the \"+g.3gpp.icsi-ref\" header field parameter of the Feature-Caps header field of 200 (OK) response as supported for the established registration or registration flow (if the multiple registration mechanism is used) according to RFC\u00a06809\u00a0[190]; and\nNOTE\u00a011:\tThe UE and related applications can use the ICSI values received in the Feature-Caps header field to improve the user experience.\nh)\tif the 200 (OK) response includes one or more Feature-Caps header fields containing the capability indicators listed in subclause\u00a07.9A.7 that indicate the media capabilities supported by the IMS-AGW then the UE may consider this information when providing media options to the user or determining whether an application communication capability will be successful (e.g. if \"sip.video\" is not indicated then the UE might not offer the user the option to attempt to add video to the session).\nNOTE\u00a012:\tIf media capability indication is not supported, no capability indicators listed in subclause\u00a07.9A.7 are included and it can be assumed that all the media capabilities are supported.\nWhen a 401 (Unauthorized) response to a REGISTER is received the UE shall behave as described in subclause\u00a05.1.1.5.1.\nOn receiving a 423 (Interval Too Brief) response to the REGISTER request, the UE shall:\n-\tsend another REGISTER request populating the registration expiration interval value with an expiration timer of at least the value received in the Min-Expires header field of the 423 (Interval Too Brief) response.\nOn receiving a 408 (Request Timeout) response or 500 (Server Internal Error) response or 504 (Server Time-Out) response for a reregistration, the UE shall perform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nOn receiving a 305 (Use Proxy) response to the REGISTER request, unless otherwise specified in the access specific annexes (as described in Annex B or Annex L), the UE shall:\na)\tignore the contents of the Contact header field if it is included in the received message;\nNOTE\u00a013:\tThe 305 response is not expected to contain a Contact header field.\nb)\trelease all IP-CAN bearers used for the transport of media according to the procedures in subclause\u00a09.2.2;\nc)\tinitiate either a new P-CSCF discovery procedure as described in subclause\u00a09.2.1, or select a new P-CSCF, if the UE was pre-configured with more than one P-CSCF's IP addresses or domain names;\nd)\tselect a P-CSCF address, which is different from the previously used address, from the address list; and\ne)\tperform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nWhen the timer F expires at the UE:\n1)\tthe UE shall stop processing of all ongoing dialogs and transactions associated with that flow, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs); and\n2)\tafter releasing all IP-CAN bearers used for the transport of media according to the procedures in subclause\u00a09.2.2:\na)\tthe UE may select a different P-CSCF address from the list of P-CSCF addresses discovered during the procedures described in subclause\u00a09.2.1 or from its pre-configured list of P-CSCF's IP addresses or domain names;\nb)\tif no response has been received when attempting to contact all P-CSCFs known by the UE, the UE may get a new set of P-CSCF-addresses as described in subclause\u00a09.2.1 unless otherwise specified in the access specific annexes (as described in Annex B or Annex L);\nc)\tthe UE may perform the procedures for initial registration as described in subclause\u00a05.1.1.2; and\nd)\tthe UE shall perform the procedures in RFC\u00a05626\u00a0[92] to form a new flow to replace the failed one if it supports multiple registrations. If failed registration attempts occur in the process of creating a new flow, the flow recovery procedures defined in RFC\u00a05626\u00a0[92] shall apply. The UE shall use the values of the parameters max-time and base-time, of the algorithm defined in subclause\u00a04.5 of RFC\u00a05626\u00a0[92]. If no values of the parameters max-time and base-time have been provided to the UE by the network, the default values defined in subclause\u00a04.5 of RFC\u00a05626\u00a0[92] shall be used.\nNOTE\u00a014:\tIt is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g. based on ICMP messages.\n***** Next change *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe UE have heterogeneous behaviours concerning the coding of the user part of the contact address in REGISTER request: some UE do not include any user part at all, some UE include the IMSI or the MSISDN (e.g. mobile UE), other ones include the telephone number (e.g. fixed UE), etc. Such UE behaviours may reveal private information such as the device or the user identity and lead to privacy issues, in particular if there is no B2BUA in the path hiding the UE contact address. Moreover, if the UE does not include any user part, this could lead to service inconsistencies (e.g. IP address reassignment: if a user part is present, the UE could detect that he receives an incoming request that he/she was not supposed to. On the contrary, the absence of user part does not allow him/her to detect this).Therefore, it is first recommended to include a user part. Next, in order to prevent from revealing the device or the user identity and to avoid any potential privacy issues, it is proposed to follow the GSMA recommendation for RCS UE for coding the user part of the contact address: \"An RCS client shall build its SIP contact address to be unique. A recommended way to do so is to use a hashed value of the +sip.instance tag as user part of the URI of the contact address.\" (cf. RCC.07 \u00a72.8.3).\n\n>>> SUMMARY OF CHANGE\nIn the section related to initial registration (\u00a75.1.1.2.1), the UE should include in initial REGISTER request a user part in the URI of the contact address that is unique and that does not reveal any private information. If the \"+sip.instance\" header field parameter is included, the UE can build the user part by using a hashed value of the \"+sip.instance\" header field parameter.In the section related to reregistration (\u00a75.1.1.4.1), if a user part has previously been included in the contact address in an initial REGISTER, the UE shall use this same user part value in the contact address of reregistration requests.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf the UE does not include any user part in the contact address, this could lead to service inconsistencies (e.g. IP address reassignment: the absence of user part does not allow an UE to detect that he receives an incoming request that he was not supposed to).If the UE includes as user part value the IMSI, the MSISDN or the telephone number, the UE may reveal private information, especially if there is no B2BUA in the path hiding the UE contact address."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n------------------------------------------ 1st Change -----------------------------------\n5.10.1\tGeneral\n\nAs specified in 3GPP\u00a0TS\u00a023.228\u00a0[7] border control functions may be applied between two IM CN subsystems or between an IM CN subsystem and other SIP-based multimedia networks based on operator preference. The IBCF may act both as an entry point and as an exit point for a network. If it processes a SIP request received from other network it functions as an entry point (see subclause\u00a05.10.2) and it acts as an exit point whenever it processes a SIP request sent to other network (see subclause\u00a05.10.3).\nThe functionalities of the IBCF include:\n-\tnetwork configuration hiding (see subclause\u00a05.10.4);\n-\tapplication level gateway (see subclause\u00a05.10.5);\n-\ttransport plane control, i.e. QoS control (see subclause\u00a05.10.5);\n-\tscreening of SIP signalling (see subclause\u00a05.10.6);\n-\tinclusion of an IWF if appropriate; and\n-\tmedia transcoding control (see suclause\u00a05.10.7)\n.\nNOTE:\tThe functionalities performed by the IBCF are configured by the operator, and it is network specific.\nThe IBCF shall log all SIP requests and responses that contain a non-empty P-Debug-ID header field based on local policy.\n----------------------------------------    2nd Change    ----------------------------------------\n5.10.2\tIBCF as an exit point\n5.10.2.2\tInitial requests\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction, except the REGISTER method; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe IBCF shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n2)\tif the request is an INVITE request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact, CSeq and Record-Route header field values received in the request such that the IBCF is able to release the session if needed;\n2A)\tif the request is an initial request for a dialog and local policy requires the application of IBCF capabilities in subsequent requests, perform record route procedures as specified in RFC\u00a03261\u00a0[26];\n3)\tif network topology hiding is required, apply the procedures as described in subclause\u00a05.10.4;\n4)\tif screening of SIP signalling is required, apply the procedures as described in subclause\u00a05.10.6;\n5)\tvoid;\n5A)\tif the recipient of the request is understood from configured information to always send and receive private network traffic from this source, remove the P-Private-Network-Indication header field containing the domain name associated with that saved information;\n6)\tstore the values from the P-Charging-Function-Addresses header field, if present;\n7)\tremove some of the parameters from the P-Charging-Vector header field or the header field itself, depending on operator policy, if present; and \n8)\tremove the P-Charging-Function-Addresses header fields, if present, prior to forwarding the message\n.\nand forwards the request according to RFC\u00a03261\u00a0[26].\nNOTE\u00a01:\tIf IBCF processes a request without a pre-defined route (e.g. the subscription to reg event package originated by the P-CSCF), the next-hop address can be either obtained as specified in RFC\u00a03263\u00a0[27A] or be provisioned in the IBCF.\nWhen the IBCF receives an INVITE request, the IBCF may require the periodic refreshment of the session to avoid hung states in the IBCF. If the IBCF requires the session to be refreshed, the IBCF shall apply the procedures described in RFC\u00a04028\u00a0[58] clause\u00a08.\nNOTE\u00a02:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen the IBCF receives a response to the initial request and network topology hiding is required, then the IBCF shall apply the procedures as described in subclause\u00a05.10.4.\nWhen the IBCF receives a response to the initial request and screening of SIP signalling is applied, then the IBCF shall apply the procedures as described in subclause\u00a05.10.6.\n5.10.2.3\tSubsequent requests\nUpon receipt of a subsequent request, the IBCF shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n2)\tif the request is a target refresh request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed;\n3)\tif the subsequent request is other than a target refresh request (including requests relating to an existing dialog where the method is unknown) and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed;\n4)\tif network topology hiding is required, apply the procedures as described in subclause\u00a05.10.4; and\n5)\tif screening of SIP signalling is required, apply the procedures as described in subclause\u00a05.10.6;\n\nand forwards the request, based on the topmost Route header field, in accordance with the procedures of RFC\u00a03261\u00a0[26].\nWhen the IBCF receives a response to the subsequent request and network topology hiding is required, then the IBCF shall apply the procedures as described in subclause\u00a05.10.4.\nWhen the IBCF receives a response to the subsequent request and screening of SIP signalling is required, then the IBCF shall apply the procedures as described in subclause\u00a05.10.6.\n--------------------------------------  4th Change ---------------------------------------------\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------ End Change -----------------------------------\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the IBCF is sending SIP requests towards an untrusted domain the IBCF need to do the privacy service described in RFC 3323 before sending the request. (At the moment the handling of the P-Asserted-Identity field is described in subclause 4.4 but the privacy service behaviour in RFC 3323 are not considered.)\n\n>>> SUMMARY OF CHANGE\nAdded a procedure to be used by IBCF when IBCF need to perform the privacy service.Note that a simple reference to RFC 3323 can't be done since the RFC 3323 some times uses \"should\" which would make the behaviour unpredictable. Instead the should statements in the RFC 3323 is referenced and changed to shall statements.The handling of SIP responses is included as a RECOMMENDED statement in RFC 3323 but in the new procedure mandated with a \"shall\" statement.\n\n>>> CONSEQUENCES IF NOT REVISED\nIdentity related information may be revealed when communicating with an untrusted domain."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***\tBEGIN CHANGES\t***\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies.  In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TS\u00a033.210: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G Security; Network domain security; IP network layer security\".\n[2]\tIETF\u00a0RFC\u00a02986: \"PKCS#10 Certification Request Syntax Specification Version 1.7\".\n[3]\tVoid.\n[4]\tIETF RFC 4210: \"Internet X.509 Public Key Infrastructure Certificate Management Protocol\".\n[5]\tIETF\u00a0RFC\u00a02252: \"Lightweight Directory Access Protocol (v3): Attribute Syntax Definitions\".\n[6]\tIETF\u00a0RFC\u00a01981: \"Path MTU Discovery for IP version 6\".\n[7]\t\"PKI basics \u2013 A Technical Perspective\", November 2002, . \n[8]\t3GPP\u00a0TR\u00a021.905: \"Vocabulary for 3GPP Specifications\".\n[9]\t3GPP TS 33.203: \"Access security for IP-based services\".\n[10]\t3GPP TS 33.220: \"Generic Authentication Architecture: Generic Bootstrapping Architecture\".\n[11]\tVoid.\n[12]\tIETF\u00a0RFC\u00a02560 (1999): \"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP\".\n[13]\tVoid.\n[14]\tIETF RFC 5280: \"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile\".\n[15]\tIETF RFC 4945: \"The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX\".\n[16]\t\tIETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version 1.2\".\n[17]\t\tIETF RFC 4346: \"The Transport Layer Security (TLS) Protocol Version 1.1\".\n[18]\tIETF  RFC 6712: \"Internet X.509 Public Key Infrastructure -- HTTP Transfer for the Certificate Management Protocol (CMP)\".\n\n[19]\tIETF RFC\u00a04211: \"Internet X.509 Public Key Infrastructure Certificate Request Message Format (CRMF)\".\n[20]\tIETF RFC 2818: \"HTTP Over TLS\".\n[21]\tIETF RFC\u00a05922: \"Domain Certificates in the Session Initiation Protocol (SIP)\".\n [22]\tIETF RFC\u00a05924: \"Extended Key Usage (EKU) for Session Initiation Protocol (SIP) X.509 Certificates\".\n[23]\tIETF RFC 3749: \"Transport Layer Security Protocol Compression Methods\".\n[24]\tIETF\u00a0RFC\u00a02817: \"Upgrading to TLS Within HTTP/1.1\".\n[25]\tIETF\u00a0RFC\u00a01035: \"Domain Names - Implementation and Specification\".\n[26]\tIETF\u00a0RFC\u00a04366: \"Transport Layer Security (TLS) Extensions\".\n[27]\tIETF\u00a0RFC\u00a06066: \"Transport Layer Security (TLS) Extensions: Extension Definitions\".\n[28]\tIETF\u00a0RFC\u00a06101: \"The Secure Sockets Layer (SSL) Protocol Version 3.0\".\n[29]\tIETF RFC 4279: \"Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)\".\n[30]\tIETF RFC 5487: \"Pre-Shared Key Cipher Suites for TLS with SHA-256/384 and AES Galois Counter Mode\".\n[31]\t3GPP\u00a0TS\u00a023.251: \"Network sharing; Architecture and functional description\".\n[32]\t3GPP TS 32.508: \"Telecommunication management; Procedure flows for multi-vendor plug-and-play eNode B connection to the network\".\n[33]\t3GPP TS 32.509: \"Telecommunication management; Data formats for multi-vendor plug and play eNode B connection to the network\".\n[34]\tIETF RFC 6347: \"Datagram Transport Layer Security Version 1.2\".[35]\tIETF RFC 5077: \"Transport Layer Security (TLS) Session Resumption without Server-Side State\".\n[36]\tIETF RFC 5746: \"Transport Layer Security (TLS) Renegotiation Indication Extension\"\n\n\n \n\n***\tNEXT CHANGES\t***\nAnnex E (normative):\nTLS protocol profile\nNOTE\u00a01:\tThe present Annex contains the general 3GPP TLS profile. Other 3GPP specifications (e.g. TS 33.203 [9], TS 33.220 [10], etc.) point to the present Annex. Thus parts of the present Annex may also apply to devices and network nodes as specified in other specifications. New specifications using TLS should refer to this profile with as few exceptions as possible.\nNOTE 2: DTLS [34] is based on TLS. Hence all requirements defined in this profile apply to DTLS protocol as well. Differences, if any, will be specifically pointed out.\nTLS end points shall support TLS with the following restrictions and extensions:\n-\tSSL 3.0 as specified in RFC\u00a06101\u00a0[28] shall not be used as it is outdated.\n-\tAt least TLS 1.1 as specified in RFC\u00a04346\u00a0 [17] shall be supported. TLS 1.2 as specified in RFC\u00a05246\u00a0 [16] should be supported.\n-\tThe highest TLS version supported on both endpoints shall be used.\n-\tThe rules on allowed and mandatory cipher suites given in TLS 1.2 (RFC\u00a05246\u00a0 [16] ) shall be followed. In addition, the mandatory cipher suite of TLS\u00a01.1 (RFC\u00a04346\u00a0 [17] ) shall be supported. The cipher suite TLS_RSA_WITH_AES_128_CBC_SHA256 should be supported. Cipher suites with NULL integrity protection (or HASH) shall not be used. When DTLS is used, it is mandatory that cipher suites with RC4 shall not be used. For TLS, it is recommended that cipher suites with RC4 should not be used.   \n-\tFor TLS clients, \nTLS_RSA_WITH_NULL_SHA shall be supported and TLS_RSA_WITH_NULL_SHA256 should be supported. For TLS servers, if TLS cipher suites without encryption are implemented, TLS_RSA_WITH_NULL_SHA shall be supported and TLS_RSA_WITH_NULL_SHA256 should be supported.\n-\tFor TLS compression, CompressionMethod.null as specified in TLS 1.2 [16] is mandatory to support. Further compression methods as specified in RFC 3749 [23] are optional to support.\n-\tThe key exchange method shall not be anonymous. Hence the cipher suites starting with \u201cTLS_DH_anon_WITH_\u201d as defined in TLS 1.2 [16] are not allowed for protection of a connection.\n-\tIf TLS Extensions are used in conjunction with TLS, then for TLS 1.2 RFC 6066 [27] shall apply, and for TLS versions lower than TLS 1.2 RFC 4366 [26] shall apply.\n-\tIf pre-shared key (psk) cipher suites are used in TLS, then RFC 4279 [29] shall apply. The same rules as for RSA-based cipher suites shall apply, i.e. for all cipher suites \u201cTLS_RSA_WITH_\u201d is replaced by \u201cTLS_PSK_WITH_\u201d.\nNOTE\u00a02:\tThe cipher suite TLS_PSK_WITH_AES_128_CBC_SHA256 is specified in RFC\u00a05487\u00a0[30].\n-\tIf the TLS connection is used to transport HTTP over TLS as specified in RFC\u00a02818\u00a0 [20], then the client shall not establish a connection \"upgraded to TLS Within HTTP/1.1\" per RFC\u00a02817 [24], but shall only establish the tunnel over a raw TCP connection.\nNOTE\u00a03:\tFor interworking with pre-Release 10 elements, it may be necessary to allow fallback to the TLS\u00a01.0 protocol version as described in RFC\u00a05246\u00a0 [16] and RFC\u00a04346\u00a0 [17].\n-\tTLS Session Resumption based on RFC 5246 [16] or RFC 5077 [35] should be supported in TLS Client and Server.\n-\tTLS servers and TLS clients shall support RFC 5746 [36]. The server shall accept client-initiated renegotiation only if secured according to RFC 5746 [36].\n\n \n***\tNEXT CHANGES\t***\n\n\n\n\n\n\n\n\n\n\n***\tEND OF CHANGES\t***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe security profiles for TLS were updated for Rel-9 but are now outdated. Use of NULL encryption is updated. The detailed motivation is described in TDoc S3-151913.\n\n>>> SUMMARY OF CHANGE\nUse of NULL encryption is updated.\n\n>>> CONSEQUENCES IF NOT REVISED\nAttacks are possible due to insecure algorithms."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n6.1.2\tS-CSCF registration/deregistration notification\nThis procedure is used between the S-CSCF and the HSS. The procedure is invoked by the S-CSCF, corresponds to the combination of the operations Cx-Put and Cx-Pull (see 3GPP TS 23.228 [1]) and is used:\n-\tTo assign an S-CSCF to a Public Identity, or to clear the name of the S-CSCF assigned to one or more Public Identities.\n-\tTo download from HSS the relevant user information for the S-CSCF.\n-\tTo backup and retrieve the S-CSCF Restoration Information (see 3GPP TS 23.380 [19]) in the HSS.\nThis procedure is mapped to the commands Server-Assignment-Request/Answer in the Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.1.2.1 and 6.1.2.2 describe the involved information elements.\nTable 6.1.2.1: S-CSCF registration/deregistration notification request\nInformation element name\tMapping to Diameter AVP\tCat.\tDescription\nPublic User Identity / Public Service Identity\t(See 7.2 and 7.2a)\tPublic-Identity\tC\tPublic Identity or list of Public Identities.\tOne and only one Public Identity shall be present if the Server-Assignment-Type is any value other than TIMEOUT_DEREGISTRATION, USER_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA, TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME, USER_DEREGISTRATION_STORE_SERVER_NAME or ADMINISTRATIVE_DEREGISTRATION.\tIf Server-Assignment-Type indicates deregistration of some type and Private Identity is not present in the request, at least one Public Identity shall be present.\nS-CSCF Name\t(See 7.4)\tServer-Name\tM\tName of the S-CSCF.\nPrivate User Identity / Private Service Identity\t(See 7.3 and 7.3a)\tUser-Name\tC\tPrivate Identity.\tIt shall be present if it is available when the S-CSCF issues the request.\tIt may be absent during the initiation of a session to an unregistered Public Identity. In such situation, Server-Assignment-Type shall contain the value UNREGISTERED_USER.\tIn case of de-registration, Server-Assignment-Type equal to TIMEOUT_DEREGISTRATION,  ADMINISTRATIVE_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME if no Public-Identity AVPs are present then User-Name AVP shall be present. \nServer Assignment Type\t(See 7.8)\tServer-Assignment-Type\tM\tType of update that the S-CSCF requests in the HSS (e.g: de-registration). See 3GPP TS 29.229 [5] for all the possible values.\nUser Data Already Available\t(See 7.16)\tUser-Data-Already-Available\tM\tThis indicates if the user profile is already available in the S-CSCF.\tIn the case where Server-Assignment-Type is not equal to NO_ASSIGNMENT, REGISTRATION, RE_REGISTRATION or UNREGISTERED_USER, the HSS shall not use User Data Already Available when processing the request.\nRouting Information (See 7.13)\tDestination-Host \tC\tIf the S-CSCF knows the HSS name, the Destination-Host AVP shall be present in the command. \tThis information is available if the request belongs to an already existing registration, e.g. in case of the re-registration, where the HSS name is stored in the S-CSCF. The HSS name is obtained from the Origin-Host AVP, which is received from the HSS, e.g. included in the MAA command.\tThis information may not be available if the command is sent as a consequence of a session termination for an unregistered Public Identity. In this case the Destination-Host AVP is not present and the command is routed to the next Diameter node, e.g. SLF, based on the Diameter routing table in the S-CSCF. \nWildcarded Public Identity (See 7.2b)\tWildcarded-Public-Identity\tO\tIf the request refers to a Wildcarded PSI or Wildcarded Public User Identity, and the Server-Asignment-Type is set to UNREGISTERED_USER, NO_ASSIGNMENT, TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME, ADMINISTRATIVE_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or TIMEOUT_DEREGISTRATION, the S-CSCF may include the corresponding Wildcarded PSI or Wildcarded Public User Identity in this information element.\tIf this element is present, it shall be used by the HSS to identify the identity affected by the request.  The terms Public Identity or Public Service Identity in the detailed behaviour refer then to the Wildcarded Public Identity.\nS-CSCF Restoration Information (See 7.21)\tSCSCF-Restoration-Info\tC\tWhen the S-CSCF supports IMS Restoration Procedures, if Server-Assignment-Type is REGISTRATION or RE_REGISTRATION, and any of the related restoration information changed compared to the previous one, the S-CSCF shall send this information element to the HSS. This information allows a later retrieval in case of an S-CSCF service interruption.\nMultiple-Registration-Indication\t(See 7.23)\tMultiple-Registration-Indication\tC\tWhen the S-CSCF supports IMS Restoration Procedures, if Server-Assignment-Type is REGISTRATION and the registration is a multiple registration, and the Public User Identity is not stored as registered with the Private User Identity as in the request in the S-CSCF, the S-CSCF shall send this information element to the HSS.\nSession-Priority\t(See 7.24)\tSession-Priority\tO\tThis information element shall indicate the session's priority to the HSS. If it is not included, the request shall be treated as normal.\n\nTable 6.1.2.2: S-CSCF registration/deregistration notification response\nInformation element name\tMapping to Diameter AVP\tCat.\tDescription\nPrivate User Identity / Private Service Identity\t(See 7.3 and 7.3a)\tUser-Name\tC\tPrivate Identity. \tIt shall be present if it is available when the HSS sends the response.\tIt may be absent in the following error case: when the Server-Assignment-Type of the request is UNREGISTERED_USER and the received Public Identity is not known by the HSS.\nRegistration result\t(See 7.6)\tResult-Code / Experimental-Result\tM\tResult of registration.\tResult-Code AVP shall be used for errors defined in the Diameter Base Protocol.\tExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nUser Profile\t(See 7.7)\tUser-Data\tC\tRelevant user profile.\tIt shall be present when Server-Assignment-Type in the request is equal to NO_ASSIGNMENT, REGISTRATION, RE_REGISTRATION or UNREGISTERED_USER according to the rules defined in section 6.6.\tIf the S-CSCF receives more data than it is prepared to accept, it shall perform the de-registration of the Private Identity with Server-Assignment-Type set to DEREGISTRATION_TOO_MUCH_DATA and send back a SIP 3xx or 480 (Temporarily Unavailable) response, which shall trigger the selection of a new S-CSCF by the I-CSCF, as specified in 3GPP TS 24.229 [8].\nCharging Information (See 7.12)\tCharging-Information\tC\tAddresses of the charging functions.\tIt shall be present when the User-Data AVP is sent to the S-CSCF.\tWhen this parameter is included, either the Primary-Charging-Collection-Function-Name AVP or the Primary-Event-Charging-Function-Name AVP shall be included. All other elements shall be included if they are available.\nAssociated Private Identities\tAssociated-Identities\tO\tThis AVP contains all Private Identities, which belong to the same IMS subscription as the Private Identity or Public Identity received in the SAR command.\tIf the IMS subscription contains only single Private Identity this AVP shall not be present.\nLoose-Route Indication\tLoose-Route-Indication\tC\tThis AVP indicates to the S-CSCF that loose-route mechanism shall be applied to the public identities contained in the user profile received from the HSS.\tIf the loose-route mechanim is required, this AVP shall be present and set to LOOSE_ROUTE_REQUIRED. \tIf the Loose-Route mechanism is not required, this AVP may be either absent or present. If present, it shall be set to LOOSE_ROUTE_NOT_REQUIRED.\nS-CSCF Restoration Information (See 7.21)\tSCSCF-Restoration-Info\tC\tThis information shall be present if it was stored by the S-CSCF in the HSS and Server-Assignment-Type is either UNREGISTERED_USER or NO_ASSIGNMENT. \tThis information shall also be present if it was stored by the S-CSCF in the HSS and the SAR indicates it is related to a multiple registration and Server-Assignment-Type is REGISTRATION.\nAssociated Registered Private Identities\t(See 7.22)\tAssociated-Registered-Identities\tC\tThis AVP contains all Private Identities that were registered with the Public Identity received in the SAR command.\tThe HSS shall send this information element if the IMS Restoration Procedures are supported and the value of Server-Assignment-Type in the request is REGISTRATION or RE_REGISTRATION and there are other Private Identities different from the Private Identity received in the SAR command being registered with the Public Identity received in the SAR command. \tOtherwise, this AVP shall not be present.\nS-CSCF Name\t(See 7.4)\tServer-Name\tC\tName of the assigned S-CSCF. \tThis AVP shall be present, if the requesting S-CSCF name is different from the previously assigned S-CSCF name stored in the HSS.\n\n\n* * * Next Change * * * *\n6.1.2.1\tDetailed behaviour\nOn registering/deregistering a Public Identity the S-CSCF shall inform the HSS. The same procedure is used by the S-CSCF to get the user information which contains the user profile and the charging information. The relevant user profile downloaded is described in more detailed in sections 6.5.1 and 6.6. \nThe Public-Identity AVP and User-Data AVPs in this command pair shall contain only one type of identities i.e. either only Public User Identities, or only Public Service Identities. User initiated Rregistration/deregistration procedures (i.e. server-assignment-type is set to RE_REGISTRATION, USER_DEREGISTRATION, etc.)  shall only be allowed for distinct Public User Identities.\nThe HSS holds information about the state of registration of all the identities related to an IMS Subscription. The S-CSCF uses this procedure to update such states. For Shared Public User Identities, the S-CSCF shall initiate this procedure towards the HSS for each Private User Identity undergoing a Registration or Deregistration related to the Shared Public User Identity. For implicitly registered identities, the rules defined in Section 6.5.1 shall apply. \nWhen the request message was received because of a terminating session request, the HSS may prioritise the received request message according to priority level received within the Session-Priority AVP.\nThe HSS shall, in the following order (in case of an error in any of the steps the HSS shall stop processing and return the corresponding error code, see 3GPP TS 29.229 [5]):\n1.\tCheck that the Public Identity and Private Identity exist in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tThe HSS may check whether the Private and Public Identities received in the request are associated in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n3.\tIf more than one Public-Identity AVP is present and the Server-Assignment-Type is one of the values defined in Table 6.1.2.1 as applying for only one identity, then the Result Code shall be set to DIAMETER_AVP_OCCURS_TOO_MANY_TIMES and no user information shall be returned.\n4.\tThe HSS shall check the Public Identity type received in the request.\n-\tIf the identity in the request is a distinct Public User Identity, continue in step 5, otherwise the HSS shall check the server-assignment-type:\nIf it indicates REGISTRATION, RE_REGISTRATION, USER_DEREGISTRATION, USER_DEREGISTRATION_STORE_SERVER_NAME, AUTHENTICATION_FAILURE or AUTHENTICATION_TIMEOUT, Experimental-Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.\n-\tIf the identity in the request is a Public Service Identity, then check if the PSI Activation State for that identity is active.  If not, then the response shall contain Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n5.\tCheck the Server Assignment Type value received in the request:\n-\tIf it indicates REGISTRATION or RE_REGISTRATION, the HSS shall check whether the Public Identity is assigned for the S-CSCF requesting the data. \nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF, and IMS restoration procedures are not supported or the S-CSCF reassignment pending flag is not set, the HSS shall include the name of the previously assigned S-CSCF in the response message and\u00a0the Result-Code shall be set to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF and IMS restoration procedures are supported, and the S-CSCF reassignment pending flag is set, the HSS shall overwrite the S-CSCF name and shall reset the S-CSCF reassignment pending flag.\nIf there is no S-CSCF assigned to the user or the the requesting S-CSCF is the same as the previously assigned S-CSCF stored in the HSS,\u00a0the HSS shall download the relevant user information. The Result-Code shall be set to DIAMETER_SUCCESS and the HSS shall set the registration state of the Public User Identity as registered (if not already registered).If the S-CSCF Restoration Information is included in the request and the HSS implements IMS Restoration procedures, and if it is RE_REGISTRATION,  the HSS shall store this information. If the Public User Identity\u2019s authentication pending flag which is specific for the Private User Identity is set, the HSS shall clear it. If there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription. If the loose-route mechanism is required for the registered Public User Identities, the Loose-Route-Indication AVP shall be added to the answer message. If there are multiple Private User Identities being registered with the Public Identity received in the request message, and the IMS Restoration Procedures are supported in the HSS, the Associated-Registered-Identities AVP shall be added to the answer message and it shall contain all Private User Identities being registered with the Public Identity.\nIf it is REGISTRATION and the HSS implements IMS Restoration procedures, if multiple registration indication is included in the request and the Public User Identity is stored as registered in the HSS, and there is restoration information related to the Private User Identity, the HSS shall not overwrite the stored S-CSCF Restoration Information, instead, it shall send the stored S-CSCF restoration information together with the user profile in the SAA. The result code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. Otherwise, the HSS shall store the received S-CSCF restoration information. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it indicates UNREGISTERED_USER, the HSS shall check whether the Public Identity is assigned for the S-CSCF requesting the data. \nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF, and IMS restoration procedures are not supported or the S-CSCF reassignment pending flag is not set, the HSS shall include the name of the previously assigned S-CSCF in the response message and\u00a0the Result-Code shall be set to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF and IMS restoration procedures are supported, and the S-CSCF reassignment pending flag is set, the HSS shall overwrite the S-CSCF name and shall reset the S-CSCF reassignment pending flag.\n\tIf there is no S-CSCF assigned to the user or the the requesting S-CSCF is the same as the previously assigned S-CSCF stored in the HSS, the HSS shall store the S-CSCF name. \n\tIf the registration state of the Public Identity is not registered, the HSS shall set the registration state of the Public Identity as unregistered, i.e. registered as a consequence of an originating or terminating request and download the relevant user information. The Result-Code shall be set to DIAMETER_SUCCESS. If there are multiple Private User Identities associated to the Public User Identity in the HSS, the HSS shall arbitrarily select one of the Private User Identities and put it into the response message.\nIf the registration state of the Public Identity is registered and IMS restoration procedures are not supported, the HSS shall set the registration state of the Public identity as unregistered and download the relevant user information. The Result-Code shall be set to DIAMETER_SUCCESS. If there are multiple Private User Identities associated to the Public User Identity in the HSS, the HSS shall arbitrarily select one of the Private User Identities and put it into the response message.\n\tIf the registration state of the Public Identity is registered and IMS restoration procedures are supported, the HSS shall include in the response all S-CSCF Restoration Information related with the Public User Identity. If there is S-CSCF Restoration Information associated with several Private User Identities, the HSS shall include all the S-CSCF Restoration Information groups in the response. The Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. \n\tIf there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription.\nIf the S-CSCF receives a wildcarded public identity from the I-CSCF, the S-CSCF shall  use this wildcarded public identity to fetch the user profile (i.e.\u00a0by sending a Cx-SAR including Wildcarded-Public-Identity AVP if the profile is not available) and registration information locally stored. \nIf the S-CSCF does not receive a wildcarded public identity from the I-CSCF, the S-CSCF shall not use a wildcarded public identity and shall use the distinct identity received instead to fetch the user profile (e.g.\u00a0by sending a Cx-SAR without including Wildcarded-Public-Identity AVP) and registration information. \n\nNOTE:\tSince a distinct public identity falling into the range of a wildcarded public identity can have a different service profile, the S-CSCF does not perform the wildcarded public identity matching to avoid using the wrong service profile. \n\n\n-\tIf it indicates TIMEOUT_DEREGISTRATION, USER_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or ADMINISTRATIVE_DEREGISTRATION, the HSS shall check the registration state for all the Public Identities in the request.  If the request did not contain Public Identities the HSS shall check the registration state of the Public Identities associated with the Private Identity identified in the request. For each Public Identity;-\n-\tif the registration state of the Public User Identity is Registered, the HSS shall check if the Public User Identity is currently registered with one or more Private User Identities. \n-\tIf the Public User Identity is currently registered with only one Private User Identity, the HSS shall set the registration state of the Public User Identity to Not Registered and clear the S-CSCF name and any S-CSCF Restoration Information associated with the Public User Identity.\n-\tIf the Public User Identity is currently registered with more than one Private User Identity, the HSS shall keep the registration state of the Public User Identity as Registered and retain the S-CSCF name associated with the Public User Identity. The HSS shall remove any S-CSCF Restoration Information associated to the registration of this Public User Identity with this Private User Identity.\n-\tif the registration state of the Public Identity is Unregistered, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity.\nThe Result-Code shall be set to DIAMETER_SUCCESS\n-\tIf it indicates TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME or USER_DEREGISTRATION_STORE_SERVER_NAME the HSS decides whether to keep the S-CSCF name associated to the Private User Identity stored or not for all the Public User Identities that the S-CSCF indicated in the request. If no Public User Identity is present in the request, the Private User Identity shall be present. \n-\tIf the HSS decides to keep the S-CSCF name stored the HSS shall keep the S-CSCF name stored for all the Public User Identities associated to the Private User Identity. The Result-Code shall be set to DIAMETER_SUCCESS. \nThe HSS shall check if each Public User Identity in the request is currently registered with one or more Private User Identities. If the request did not contain Public User Identities the HSS shall check if each Public User Identity associated with the Private User Identity in the request is currently registered with one or more Private User Identities. For each Public User Identity;-\n-\tIf only one Private User Identity associated with the Public User Identity is currently registered with the Public User Identity, the HSS shall set the registration state of the Public User Identity to Unregistered and clear any S-CSCF Restoration Information associated with the Public User Identity\n-\tIf more than one Private User Identity that shares that Public User Identity is currently registered with the Public User Identity the HSS shall keep the registration state of the Public User Identity as Registered. The HSS shall remove any S-CSCF Restoration Information associated to the registration of this Public User Identity with the Private User Identity in the request.\n-\tIf the HSS decides not to keep the S-CSCF name the Experimental-Result-Code shall be set to DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED. \nThe HSS shall check if each Public User Identity in the request is currently registered with one or more Private User Identities. If the request did not contain Public User Identities the HSS shall check if each Public User Identity associated with the Private User Identity in the request is currently registered with one or more Private User Identities. For each Public User Identity;-\n-\tIf only one Private User Identity associated with the Public User Identity is currently registered with the Public User Identity, the HSS shall set the registration state of the Public User Identity to Not Registered and clear the S-CSCF name associated with Public User Identity.\n-\tIf more than one Private User Identity that shares that Public User Identity is currently registered with the Public User Identity the HSS shall keep the registration state of the Public User Identity as Registered.\n-\tIf it indicates NO_ASSIGNMENT, the HSS checks whether the Public Identity is assigned for the S-CSCF requesting the data. If the requesting S-CSCF is not the same as the assigned S-CSCF and the S-CSCF reassignment pending flag is not set, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY, otherwise the HSS shall download the relevant user information and the Result-Code shall be set to DIAMETER_SUCCESS. If relevant S-CSCF Restoration Information is stored in the HSS and IMS Restoration Procedures are supported, it shall be added to the answer message. If there is S-CSCF Restoration Information associated with several Private User Identities, the HSS shall include all the S-CSCF Restoration Information groups in the response. If there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription.\nNOTE:\tthe check of the S-CSCF reassignment pending flag is needed since an S-CSCF supporting restoration procedures can receive a user initiated de-registration for a Public Identity for which it does not have any registration data (see 3GPP TS 23.380 [19]). In such case, the S-CSCF indicates NO_ASSIGNMENT in Server-Assignment-Type to retrieve any possible restoration information from the HSS.\n-\tIf it indicates AUTHENTICATION_FAILURE (e.g. there is a mismatch in IP-address secure binding information) or AUTHENTICATION_TIMEOUT (e.g. no response to Digest challenge), the HSS shall keep the registration state of the Public User Identity. The HSS shall check the registration state for the Public User Identity in the request and only if the registration state of the Public User Identity is Not Registered, the HSS shall clear the S-CSCF name associated with the Public User Identity.\nIf the Public User Identity\u2019s authentication pending flag which is specific for the Private User Identity is set, the HSS shall clear it. The Result-Code shall be set to DIAMETER_SUCCESS.\nIf the HSS cannot fulfil the received request, e.g. due to database error, it shall set the Result-Code to DIAMETER_UNABLE_TO_COMPLY. The HSS shall not modify any registration state nor download any Public Identity information to the S-CSCF.\nSee chapter 8.1.2 and 8.1.3 for the description of the handling of the error situations: reception of an S-CSCF name different from the one stored in the HSS and reception of a Server-Assignment-Type value not compatible with the registration state of the Public Identity.\n\n* * * End of Change * * * *\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf the S-CSCF does not receive optional SIP header P-Profile-Key (e.g. earlier versions of P-CSCF and I-CSCF, or originating call from an AS on behalf of a user), it does not perform the wildcarded public identity matching to avoid using the wrong service profile. On the contrary, it uses the IMPU received to fetch the user profile. See text from 29.228:\u201cIf the S-CSCF does not receive a wildcarded public identity from the I-CSCF, the S-CSCF shall not use a wildcarded public identity and shall use the distinct identity received instead to fetch the user profile (e.g.\u00a0by sending a Cx-SAR without including Wildcarded-Public-Identity AVP) and registration information.\u201dThen, if the state of the Public Identity is registered in HSS, the behaviour depends on whether IMS restorations procedures are supported. See text from 29.228:\u201cIf the registration state of the Public Identity is registered and IMS restoration procedures are not supported, the HSS shall set the registration state of the Public identity as unregistered and download the relevant user information. <\u2026> \u201c\u201cIf the registration state of the Public Identity is registered and IMS restoration procedures are supported, the HSS shall include in the response all S-CSCF Restoration Information related with the Public User Identity. <\u2026> \u201cHowever, this behaviour is wrong in the case where the received IMPU (that does not exist as distinct IMPU in S-CSCF) falls into the range of a registered WIMPU in HSS. In this case, now the HSS shall perform the wildcarded matching and it overwrites the wildcarded IMPU registration status, which will result in a de-registration of the wildcarded IMPU in HSS and the S-CSCF will execute unregistered services.\n\n>>> SUMMARY OF CHANGE\nThe solution proposed is to return the wildcarded IMPU so that the S-CSCF can take the proper action, that is, either progress the SIP request if registration information exists for the wildcarded IMPU or send a Cx-SAR including the wildcarded AVP.Therefore, upon reception of Cx-SAR, the HSS shall detect this scenario if:No indication of wildcarded identity is received (wIMPU AVP) in Cx-SAR sent by S-CSCFServer-assignment-type is set to UNREGISTERED_USERPublic identity falls within the range of a wIMPU whose status is REGISTERED.In such a case, the HSS shall return a diameter error code DIAMETER_ERROR_IN_ASSIGNMENT_TYPE in Cx-Server-Assignment-Answer (Cx-SAA) to inform the S-CSCF that the IMPU matches a registered wIMPU. The HSS shall also return the wIMPU AVP. Upon reception of the error, the S-CSCF shall behave as if it has received a wildcarded public identity (SIP PPK header) in the first place, i.e. the S-CSCF checks the service profile and registration information for the wIMPU and the call is progressed.\n\n>>> CONSEQUENCES IF NOT REVISED\nIn the following case:S-CSCF does not receive optional SIP header P-Profile-Key (this may happen in requests from pre-release 10 P-CSCF, pre-release 10 I-CSCF or from originating call from an AS on behalf of a user).Received IMPU does not exist as distinct IMPU in S-CSCF.Received IMPU falls into the range of a registered WIMPU in S-CSCF.The call should proceed, but instead the behaviour is:Restoration procedures are supported:Restoration procedures are started to restore data in S-CSCF for corresponding WIMPU.Restoration procedures are not supported:WIMPU is unregistered, resulting in terminating calls not being forwarded to the contact address of the wildcarded public user identity."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * * First change * * * *\n5.4.11.4\tVerification of UE location\nIn order to ensure that the regulatory requirements are met, the network may be configured to enforce that the selected PLMN is allowed to operate in the country of the UE location by verifying the UE location during Mobility Management and Session Management procedures. In this case, when the AMF receives a NGAP message containing User Location Information for a UE using NR satellite access, the AMF may decide to verify the UE location. If the AMF determines based on the Selected PLMN ID and ULI (including Cell ID) received from the gNB that it is not allowed to operate at the present UE location the AMF should reject the request and inform the UE of the country of the UE location.\nIf the AMF, based on the ULI, is not aware of the UE location with sufficient accuracy to make a final decision, the AMF proceeds with the Mobility Management or Session Management procedure and may initiate UE location procedure, as specified in clause\u00a06.10.1 of TS\u00a023.273\u00a0[87], to determine the UE location. In case of a NAS procedure, the AMF should either reject any NAS request targeted towards a PLMN that is not allowed to operate at the known UE location and indicate a suitable Cause value and, if known in AMF, the country of the UE location, or accept the NAS procedure and later deregister the UE once the UE location is known.\nIn the case of a handover procedure, if the (target) AMF determines that it is not allowed to operate at the current UE location, the AMF either rejects the handover, or accepts the handover and later deregisters the UE.\n\n* * * * End of changes * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFor NR satellite access, the AMF may need to initiate UE location for NAS procedures to verify that the UE is located in a country in which the serving PLMN is allowed to operate. In the case of a NAS Registration Request, it is currently unclear whether the AMF can initiate UE location before the NAS Registration procedure is complete since clause 5.4.11.4 states:If the AMF, based on the ULI, is not aware of the UE location with sufficient accuracy to make a final decision, the AMF proceeds with the Mobility Management or Session Management procedure and may initiate UE location procedure, as specified in clause\u00a06.10.1 of TS\u00a023.273\u00a0[87], to determine the UE location.NAS Registration includes establishing an AS security context and may require establishing a NAS security context. Following this, it is possible to securely exchange NAS messages to support positioning between the UE and an LMF and exchange RRC messages between the NG-RAN and UE to support positioning methods which require RRC support. This could allow secure positioning of the UE to commence before a NAS Registration Accept is returned to the UE. However, the latency reduction may then be quite small and triggering such early location may be more complex and prone to error for the NAS layer. Therefore, it is proposed to state that location initiation occurs after completion of the MM or SM procedure. It can also be clarified that the allowance of PLMN operation is based on the UE being located in a country allowed for the serving PLMN. The UE location is only needed to determine the country. This is currently stated in some places but not everywhere.\n\n>>> SUMMARY OF CHANGE\nFor NR satellite access, changes are added to clarify that UE location would be initiated to verify the country for the UE location after an MM or SM procedure is complete.  Changes are added to clarify that an AMF verifies whether the serving PLMN is allowed to operate in the country for the UE location.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE location might be initiated during Registration, e.g. before NAS security and AS security contexts are established, which could result in loss of UE privacy or failure of location."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n**** FIRST CHANGE ****\n6.1.3.3.1\tOpen discovery security flows\n The message flows apply when both the UEs are roaming or when one or both are in their HPLMN.\nNote that integrity protection via this Message Integrity Check (MIC) furthermore enables the ProSe Function to verify that the announcing UE was indeed authorized to announce this ProSe App Code at that time instance. A UTC-based counter associated with the discovery slot is used to calculate the MIC and verify the MIC. To help ensure that the announcing and monitoring UEs end up with the same value of the UTC-based counter, the announcing UE includes the 4 least significant bits of its couter value in the discovery message, which the monitoring UE uses when  setting the value of the UTC-based counter that is passed to the ProSe Function.\n\n\n\nFigure: 6.1.3.3.1-1: Integrity protection of the transmitted code\n1.\tThe Announcing UE sends a Discovery Request message containing the ProSe Application ID name to the ProSe Function in its HPLMN in order to be allowed to announce a code on its serving PLMN (either VPLMN or HPLMN).\n2./3.\tThe ProSe Functions in the HPLMN and VPLMN of the announcing UEs exchange Announce Auth. messages. There are no changes to these messages for the purpose of protecting the transmitted code for open discovery.  If the Announcing UE is not roaming, these steps do not take place.\n4.\tThe ProSe Function in HPLMN of the announcing UE returns the ProSe App Code that the announcing UE can announce and a 128-bit Discovery Key associated with it. The ProSe Function stores the Discovery Key with the ProSe App Code. In addition, the ProSe Function provides the UE with a CURRENT_TIME parameter, which contains the current UTC-based time at the ProSe Function, a MAX_OFFSET parameter, and a Validity Timer (see TS 23.303 [2]). The UE sets a clock it uses for ProSe authentication (i.e. ProSe clock) to the value of CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any previous values.  The announcing UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time. The counter is set to a value of UTC time in a granularity of seconds. The UE may obtain UTC time from any sources available, e.g. the RAN via SIB16, NITZ, NTP, GPS (depending on which is available).\nNOTE:\tThe UE may use unprotected time to obtain the UTC-based counter associated with a discovery slot. This means that the discovery message could be successfully replayed if a UE is fooled into using a time different to the current time. The MAX_OFFSET parameter is used to limit the ability of an attacker to successfully replay discovery messages or obtain correctly MICed discovery message for later use. This is achieved by using MAX_OFFSET as a maximum difference between the UTC-based counter associated with the discovery slot and the ProSE clock held by the UE. \n5.\tThe UE starts announcing, if the  UTC-based counter provided by the system associated with  the discovery slot is within the MAX_OFFSET of the announcing UE's ProSe clock and if the Validity Timer has not expired (see TS 23.303 [2]).For each discovery slot it uses to announce, the announcing UE calculates a 32-bit Message Integrity Check (MIC) to include with the ProSe App Code in the discovery message. Four least significant bits of UTC-based counter are transmitted along with the discovery message. The MIC is calculated as described in sub clause A.2 using the Discovery Key and the UTC-based counter associated with the discovery slot.\n6.\tThe Monitoring UE sends a Discovery Request message containing the ProSe Application ID name to the ProSe Function in its HPLMN in order to get the Discovery Filters that it wants to listen for.\n7/8. The ProSe Functions in the HPLMN of the monitoring UE and HPLMN of the announcing UEs exchange Monitor Req./Resp. messages. There are no changes to these messages for the purpose of protecting the transmitted code for open discovery.\n9.\tThe ProSe Function returns the Discovery Filter containing either the ProSe App Code(s), the ProSe App Mask(s) or both along with the CURRENT_TIME and the MAX_OFFSET parameters. The UE sets its ProSe clock to CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any previous values. The monitoring UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time. The counter is set to a value of UTC time in a granularity of seconds. The UE may obtain UTC time from any sources available, e.g. the RAN via SIB16, NITZ, NTP, GPS (depending on which is available).\n10.\tThe Monitoring UE listens for a discovery message that satisfies its Discovery Filter, if the UTC-based counter associated with  that discovery slot is within the MAX_OFFSET of the monitoring UE's ProSe clock.\n11.\tOn hearing such a discovery message, and if required based on the procedures specified in TS 23.303 [2], the Monitoring UE sends a Match Report message to the ProSe Function in the HPLMN of the monitoring UE. The Match Report contains the UTC-based counter value with four least significant bits equal to four least significant bits received along with discovery message and nearest to the monitoring UE\u2019s UTC-based counter associated with the discovery slot where it heard the announcement, and the discovery message including the ProSe App Code and MIC.\n12. The ProSe Function in the HPLMN of the monitoring UE passes the discovery message including the ProSe App Code and MIC and associated time parameter to the ProSe Function in the HPLM of the announcing UE in the Match Report message.\n13.\tThe ProSe Function in the HPLMN of the announcing UE checks the MIC is valid. The relevant Discovery Key is found using the ProSe App Code.\n14. The ProSe Function in the HPLMN of the announcing UE acknowledges a successful check of the MIC to the ProSe Function in the HPLMN of the monitoring UE in the Match Report Ack message.\n15.\tThe ProSe Function in the HPLMN of the monitoring UE returns an acknowledgement that the integrity checked passed to the Monitoring UE. The ProSe Function returns the parameter ProSe Application ID name to the UE. \nIt also provides the CURRENT_TIME parameter, by which the UE (re)sets its ProSe clock.\n\n\n\n\n**** END OF CHANGES ****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently a monitoring UE is not allowed have the MIC of a discovered Code checked until the validity timer set by the announcing UE\u2019s HPLMN has expired.This limit means that received codes may be accepted as legitmate when they may not be.\n\n>>> SUMMARY OF CHANGE\nAdd a paramter that is sent from the ProSe Function(s) to the UE as part of the Match Report procedure that allows the UE to set a timer for Match Report/MIC checking. Once the timer has expired the UE will send a Match Report on next instance it detects that code.\n\n>>> CONSEQUENCES IF NOT REVISED\nA security threat will be left open: a ProSe Application Code that is announced without authorization may be accepted by a monitoring UE as legitimate."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n11.2.5.1\tMessage definition\nThis message is sent by the UE over the PC5 interface for open ProSe direct discovery and restricted ProSe direct discovery. See table\u00a011.2.5.1.1, table\u00a011.2.5.1.1A, table\u00a011.2.5.1.2, table\u00a011.2.5.1.3, table\u00a011.2.5.1.4, table\u00a011.2.5.1.5, table\u00a011.2.5.1.6, table\u00a011.2.5.1.7, table\u00a011.2.5.1.8, table\u00a011.2.5.1.9 and table\u00a011.2.5.1.10.\nTable\u00a011.2.5.1.1: PC5_DISCOVERY message content for open ProSe direct discovery\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nProSe Application Code\tBinary\t12.2.2.6\tM\t184\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Open discovery\" and the Content Type is not set to \"application-controlled extension enabled\".\n\nTable\u00a011.2.5.1.1A: PC5_DISCOVERY message content for open ProSe direct discovery with application-controlled extension\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE\u00a01)\tMessage Type\t12.2.2.10\tM\t8\nProSe Application Code Prefix (NOTE\u00a02)\tBinary\t12.2.2.68\tM\t32-176\nProSe Application Code Suffix (NOTE\u00a02)\tBinary\t12.2.2.69\tM\t8-152\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE\u00a01:\tThe Discovery Type is set to \"Open discovery\" and the Content Type is set to \"application-controlled extension enabled\".\tNOTE\u00a02:\tThe sum of the lengths of the ProSe Application Code Prefix and the ProSe Application Code Suffix is 184 bits.\n\nTable\u00a011.2.5.1.2: PC5_DISCOVERY message content for restricted ProSe direct discovery\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nProSe Restricted Code\tBinary\t12.2.2.34\tM\t184\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\" and the Content Type is not set to \"application-controlled extension enabled\".\n\nTable\u00a011.2.5.1.3: PC5_DISCOVERY message content for restricted ProSe direct discovery with application-controlled extension\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nProSe Restricted Code Prefix\tBinary\t12.2.2.46\tM\t64\nProSe Restricted Code Suffix \tBinary\t12.2.2.47\tM\t120\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"application-controlled extension enabled\" and the Discovery Model is set to \"Model A\".\n\nTable\u00a011.2.5.1.4: PC5_DISCOVERY message for UE-to-Network Relay Discovery Announcement\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nRelay Service Code\tBinary\t12.2.2.51\tM\t24\nAnnouncer Info\tBinary\t12.2.2.50\tM\t48\nProSe Relay UE ID\tBinary\t12.2.2.49\tM\t24\nStatus Indicator\tBinary\t12.2.2.67\tM\t8\nSpare\tBinary\t12.2.2.56\tM\t80\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"UE-to-Network Relay Discovery Announcement or UE-to-Network Relay Discovery Response\" and the Discovery Model is set to \"Model A\".\n\nTable\u00a011.2.5.1.5: PC5_DISCOVERY message for UE-to-Network Relay Discovery Solicitation\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE\u00a01)\tMessage Type\t12.2.2.10\tM\t8\nRelay Service Code\tBinary\t12.2.2.51\tM\t24\nDiscoverer Info\tBinary\t12.2.2.50\tM\t48\nURDS Composition\tBinary\t12.2.2.66\tM\t8\nProSe Relay UE ID\tBinary\t12.2.2.49\tC\t(NOTE\u00a02)\t24\nSpare\tBinary\t12.2.2.56\tM\t80 or 104\t(NOTE\u00a03)\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE\u00a01:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"UE-to-Network Relay Discovery Solicitation\" and the Discovery Model is set to \"Model B\". \tNOTE\u00a02:\tPresence of the ProSe Relay UE ID is indicated by the URDS Composition.\tNOTE\u00a03:\tIf the ProSe Relay UE ID is present, then the length of the Spare is80 bits. If ProSe Relay UE ID is not included, then the length of the Spare is 104 bits.\n\nTable\u00a011.2.5.1.6: PC5_DISCOVERY message for UE-to-Network Relay Discovery Response\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nRelay Service Code\tBinary\t12.2.2.51\tM\t24\nDiscoveree Info\tBinary\t12.2.2.50\tM\t48\nProSe Relay UE ID\tBinary\t12.2.2.49\tM\t24\nStatus Indicator\tBinary\t12.2.2.67\tM\t8\nSpare\tBinary\t12.2.2.56\tM\t80\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"UE-to-Network Relay Discovery Announcement or UE-to-Network Relay Discovery Response\" and the Discovery Model is set to \"Model B\".\n\nTable\u00a011.2.5.1.7: PC5_DISCOVERY message for Group Member Discovery Announcement\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nDiscovery Group ID\tBinary\t12.2.2.54\tM\t24\nAnnouncer Info\tBinary\t12.2.2.50\tM\t48\nProSe UE ID\tBinary\t12.2.2.48\tM\t24\nSpare\tBinary\t12.2.2.56\tM\t88\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"Group Member Discovery Announcement or Group Member Discovery Response\" and the Discovery Model is set to \"Model A\".\n\nTable\u00a011.2.5.1.8: PC5_DISCOVERY message for Group Member Discovery Solicitation\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE\u00a01)\tMessage Type\t12.2.2.10\tM\t8\nDiscovery Group ID\tBinary\t12.2.2.54\tM\t24\nDiscoverer Info\tBinary\t12.2.2.50\tM\t48\nGMDS Composition\tBinary\t12.2.2.55\tM\t8\nTarget User Info\tBinary\t12.2.2.52\tC (NOTE\u00a02)\t48\nTarget Group Info\tBinary\t12.2.2.53\tC (NOTE\u00a02)\t24\nSpare\tBinary\t12.2.2.56\tM\t(NOTE\u00a03)\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE\u00a01:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"Group Member Discovery Solicitation\" and the Discovery Model is set to \"Model B\".\tNOTE\u00a02:\tPresence of the Target User Info and of Target Group Info is indicated by the GMDS Composition.\n\nTable\u00a011.2.5.1.9: PC5_DISCOVERY message for Group Member Discovery Response\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE)\tMessage Type\t12.2.2.10\tM\t8\nDiscovery Group ID\tBinary\t12.2.2.54\tM\t24\nDiscoveree Info\tBinary\t12.2.2.50\tM\t48\nProSe UE ID\tBinary\t12.2.2.48\tM\t24\nSpare\tBinary\t12.2.2.56\tM\t88\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"Group Member Discovery Announcement or Group Member Discovery Response\" and the Discovery Model is set to \"Model B\".\n\nTable\u00a011.2.5.1.10: PC5_DISCOVERY message for Relay Discovery Additional Information\nInformation Element\tType/Reference\tPresence\tLength (bits)\nMessage Type (NOTE\u00a01)\tMessage Type\t12.2.2.10\tM\t8\nRelay Service Code\tBinary\t12.2.2.51\tM\t24\nProSe Relay UE ID\tBinary\t12.2.2.49\tM\t24\nAnnouncer Info\tBinary\t12.2.2.50\tM\t48\nRDAI Composition\tBinary\t12.2.2.57\tM\t8\nECGI\tBinary\t12.2.2.58\tC (NOTE\u00a02)\t56\nMBMS related information\tBinary\t12.2.2.59\tC (NOTE\u00a02)\t72\nSpare\tBinary\t12.2.2.56\tM\t8 or 24\t(NOTE\u00a03)\nMIC\tBinary\t12.2.2.11\tM\t32\nUTC-based Counter LSB\tBinary\t12.2.2.22\tM\t8\nNOTE\u00a01:\tThe Discovery Type is set to \"Restricted discovery\", the Content Type is set to \"Relay discovery additional information\" and the Discovery Model is set to \"Model A\".\tNOTE\u00a02:\tPresence of the ECGI and MBMS related information is indicated by the RDAI Composition.\tNOTE\u00a03:\tIf the RDAI Composition indicates inclusion of the MBMS related information, it is 8 bits. If the RDAI Composition indicates inclusion of the ECGI, it is 24 bits.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nPC5_DISCOVERY message for Group Member Discovery Solicitation with the Target User Info enables discovery of UE(s) with a particular User Info ID in their group member discovery parameters.PC5_DISCOVERY message for Group Member Discovery Solicitation with Target Group Info enables discovery of UE(s) with a particular ProSe Layer-2 Group ID in its ProSe direct communication service authorisation.Procedures in subclause 10A.2.8.2 and subclause 10A.2.9.2 also enable the discovery of UEs which satisfy both, i.e. a UE:- with a particular User Info ID in its group member discovery parameters; and- with a particular ProSe Layer-2 Group ID in its ProSe direct communication service authorisation.This will occur if both Target User Info and Target Group Info are included.This is particularly useful, if there are several UEs with the same User Info ID but different ProSe Layer-2 Group IDs.Unfortunately, the coding does not support inclusion of both Target User Info and Target Group Info.\n\n>>> SUMMARY OF CHANGE\nThe coding supports inclusion of both Target User Info and Target Group Info.\n\n>>> CONSEQUENCES IF NOT REVISED\nNot possible to perform discovery of UEs:- with a particular User Info ID in their group member discovery parameters; and- with a particular ProSe Layer-2 Group ID in its ProSe direct communication service authorisation."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nSTART OF CHANGE\n5.4.2.1\tGeneral\n\nFigure 5.4.2.1-1: Handover to E-UTRA, successful\nThe purpose of this procedure is to, under the control of the network, transfer a connection between the UE and another Radio Access Network (e.g. GERAN, UTRAN or NR) to E-UTRAN, or transfer a connection between the UE and the E-UTRAN with one type of CN to the E-UTRAN with a different type of CN.\nThe handover to E-UTRA procedure applies when SRBs, possibly in combination with DRBs, are established in another RAT or in E-UTRA connected to another type of CN. Handover from UTRAN to E-UTRAN applies only after integrity has been activated in UTRAN. Handover to E-UTRA connected to a different type of CN applies only after integrity has been activated in E-UTRAN. Handover from NR to E-UTRAN applies only after integrity has been activated in NR.\nEND OF CHANGE\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) In 36.331,on the premise of HO to E-UTRA, it is stated that:  The handover to E-UTRA procedure applies when SRBs, possibly in combination with DRBs, are established in another RAT or in E-UTRA connected to another type of CN. Handover from UTRAN to E-UTRAN applies only after integrity has been activated in UTRAN. Handover to E-UTRA connected to a different type of CN applies only after integrity has been activated in E-UTRAN. Handover from NR to E-UTRAN applies only after integrity has been activated in NR.However, the premise here is in contradictory with the initiation description of mobility from E-UTRA in 36.331, and mobility from NR in 38.331, respectively.  As in 36.331, it states that:E-UTRAN initiates the mobility from E-UTRA procedure to a UE in RRC_CONNECTED, possibly in response to a MeasurementReport message or in response to reception of CS fallback indication for the UE from MME, by sending a MobilityFromEUTRACommand message. E-UTRAN applies the procedure as follows:-the procedure is initiated only when AS-security has been activated, and SRB2 with at least one DRB are setup and not suspended;And in 38.331, it states that:The network initiates the mobility from NR procedure to a UE in RRC_CONNECTED, possibly in response to a MeasurementReport message, by sending a MobilityFromNRCommand message. The network applies the procedure as follows:-the procedure is initiated only when AS security has been activated, and SRB2 with at least one DRB are setup and not suspended.It is clear that the premise of HO to E-UTRA in 36.331 is less than the description in 36.331 and 38.331, which would lead to an inter-protocol conflict. As one example, when LTE-RRC: SecurityModeCommand or NR-RRC: SecurityModeCommand  is sent out, the integrity is activated in E-UTRA or NR, but at this time source RAT will not initiate HO to E-UTRA, as neither SRB2 nor DRB is setup.\n\n>>> SUMMARY OF CHANGE\n1) Replace the 36.331 premises of HO to E-UTRA with 36.331, and 38.331 descriptions.  Impact analysisImpacted 5G architecture options: SA  Impacted functionality: HO to E-UTRAInter-operability:1) This CR concerns only about RAN-node.2) If the NW is implemented according to this CR, no impact on UE is forseen.\n\n>>> CONSEQUENCES IF NOT REVISED\n1) There is an inter-protocol conflict between 36.331 and 36.331/38.331 on the premises of HO to NR."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nPROPOSED CHANGE\nEndorsement notice\nThe present document endorses 3GPP TS 24.229 (V7.2.0): \"3rd Generation Partnership Project; Technical Specification Group Core Network and Terminals; IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP), Stage 3 (Release 7)\" [1].\nThe present document shows the modifications, additions and deletions through the use of underlined and strikethrough text.\nFor the purpose of the present document clause 3 of [1] is replaced by the clause 3 shown in the present document.\nFor the purpose of the present document clause 4 of [1] applies, except for subclauses 4.1, 4.2, 4.3 and 4.4, which are replaced by the appropriate subclauses in clause 4 of the present document.\nFor the purpose of the present document clause 5 of [1] applies, except for subclauses 5.1.1.1A, 5.1.1.2, 5.1.1.3, 5.1.1.4, 5.1.1.5.1, 5.1.1.5.2, 5.1.1.5.A, 5.1.1.6, 5.1.1.7, 5.1.2.1, 5.1.2A.1, 5.1.2.A.2, 5.1.3.1, 5.1.6, 5.2.1, 5.2.2, 5.2.4, 5.2.5.1, 5.2.5.2, 5.2.6.2, 5.2.6.3, 5.2.6.4, 5.2.7.2, 5.2.7.3, 5.2.8.1.1, 5.2.8.1.2, 5.2.8.1.4, 5.2.8.3, 5.2.10, 5.4.1.1, 5.4.1.2, 5.4.1.2.1, 5.4.1.3, 5.4.1.4, 5.4.1.6, 5.4.1.7, 5.4.3.2, 5.4.3.3, 5.6.2, 5.10.1, 5.10.2.2, 5.10.2.3 and 5.10.3.1, which are replaced by the appropriate subclauses in clause 5 of the present document. In addition subclauses 5.1.1.1B, 5.1.1.2A, 5.1.1.4A, 5.1.1.5.1A, 5.1.1.6A, 5.2.2A, 5.4.1.2A.1, 5.4.8, 5.10.6 and 5.11 are added.\nFor the purpose of the present document clause 6 of [1] applies, except for clauses 6.1.1 and 6.2, which are replaced by the appropriate subclauses in clause 6 of the present document.\nFor the purpose of the present document clause 7 of [1] applies, except for subclauses 7.2A.4, 7.6, 7.6.1, 7.6.2 and 7.6.3 which are replaced by the appropriate subclauses in clause 7 of the present document.\nFor the purpose of the present document clause 9 of [1] applies, except for subclause 9.2.2, which is replaced by the appropriate subclauses in clause 9 of the present document.\nFor the purpose of the present document annex A of [1] applies, except for subclauses A.1.3, A.2.1.2, A.2.1.4.1, A.2.2.2 and A.2.2.4.1, and A.3.2.1 which are replaced by the appropriate subclauses in annex A of the present document.\nFor the purpose of the present document annex B of [1] applies, except for the addition of clauses B.2.2.6 and B.3.1.1 described in the appropriate subclauses in annex B of the present document.\nFor the purpose of the present document annex C of [1] applies, except for the addition of clause C.4 described in the appropriate subclauses in annex C of the present document.\nFor the purpose of the present document annex D of [1] applies, except for the addition of clauses D.2.2.6 and D.3.1.1 described in the appropriate subclauses in annex D of the present document.\nFor the purpose of the present document annex E of [1] applies, except for the addition of clauses E.2.2.6 and E.3 described in the appropriate subclauses in annex E of the present document.\nPROPOSED CHANGE\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPROPOSED CHANGE\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPROPOSED CHANGE\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nRoute header may require special treatment when hiding applied. If the request is sent out from the hiding network and will be routed back to the hiding network (according to Route header; e.g. the S-CSCF inserted an external AS and its own address into the Route header and added the THIG as first entry afterwards, thus Route header includes THIG, AS, and S-CSCF when sent to the THIG), then according to current procedures (THIG removes itself from the Route header and tokenizes the S-CSCF in the Route header) the AS cannot route the request back the request to the S-CSCF via THIG (since it receives the Route header including the AS and a tokenized item, and after removing the AS entry, only the tokenized entry left in the Route header).Current processing of the Via to perform THIG tokenisation in the IBCF subclause breaks RFC 3261.\n\n>>> SUMMARY OF CHANGE\nPrior to forwarding the request the THIG adds itself to the Route header as part of the encryption procedure to ensure proper routing back to the hiding network. Additionally the example in the second note is changed: the Route header did not show a request that is sent out from the hiding network, so it is changed into a Record-Route header. The \u201ci-cscf1_s\u201d is replaced with \u201cibcf1\u201d in the existing examples. Finally a third note with an example illustrates the procedural change proposed by this CR.Text is aligned with the RFC requirement\n\n>>> CONSEQUENCES IF NOT REVISED\nInitial requests cannot be routed back to the hiding network based on preloaded Route header.THIG tokenisation mechanism breaks RFC 3261"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n4.9.3.0\tGeneral\nThe registration on the selected SNPN and the LR are only necessary if the MS is capable of services which require registration. Otherwise, the SNPN selection procedures are performed without registration.\nThe ME is configured with a \"list of subscriber data\" containing zero or more entries. Each entry of the \"list of subscriber data\" consists of:\na)\ta subscriber identifier in the form of a SUPI containing a network-specific identifier or an IMSI except when the SNPN uses:\n1)\tthe EAP based primary authentication and key agreement procedure using the EAP-AKA'; or\n2)\tthe 5G AKA based primary authentication and key agreement procedure;\nNOTE\u00a01:\tA subscriber identifier in the form of a SUPI containing a network-specific identifier or an IMSI is available in USIM if the SNPN uses the EAP based primary authentication and key agreement procedure using the EAP-AKA' or the 5G AKA based primary authentication and key agreement procedure.\nb)\tcredentials except when the SNPN uses:\n1)\tthe EAP based primary authentication and key agreement procedure using the EAP-AKA'; or\n2)\tthe 5G AKA based primary authentication and key agreement procedure;\nNOTE\u00a02:\tCredentials are available in USIM if the SNPN uses the EAP based primary authentication and key agreement procedure using the EAP-AKA' or the 5G AKA based primary authentication and key agreement procedure.\nc)\tan SNPN identity; and\nd)\toptionally, the unified access control configuration indicating for which access identities (see 3GPP\u00a0TS\u00a024.501\u00a0[64]) the ME is configured in the SNPN.\nNOTE\u00a03:\tHow the ME is configured with the \"list of subscriber data\" is out of scope of 3GPP in this release of the specification.\nNOTE\u00a04:\tMultiple entries can include the same subscriber identifier and credentials.\nNOTE\u00a05:\tHandling of more than one entry with the same SNPN identity is left up to MS implementation.\nNOTE\u00a06:\tHandling of the case when the SNPN uses the EAP based primary authentication and key agreement procedure using the EAP-AKA' or the 5G AKA based primary authentication and key agreement procedure and the MS has multiple valid USIMs (3GPP\u00a0TS\u00a031.102\u00a0[40]) is left up to MS implementation.\nThe MS shall maintain a list of \"temporarily forbidden SNPNs\" and a list of \"permanently forbidden SNPNs\" in the ME. Each entry of those lists consists of an SNPN identity.\nThe MS shall add an SNPN to the list of \"temporarily forbidden SNPNs\" and start an MS implementation specific timer not shorter than 60 minutes, if a message with cause value #74 \"Temporarily not authorized for this SNPN\" (see 3GPP\u00a0TS\u00a024.501\u00a0[64]) is received by the MS in response to an LR request from the SNPN and:\n-\tthe message is integrity-protected; or\n-\tthe message is not integrity-protected, and the value of the SNPN-specific attempt counter for that SNPN is equal to the MS implementation specific maximum value as defined in 3GPP\u00a0TS\u00a024.501\u00a0[64].\nThe MS shall remove an SNPN from the list of \"temporarily forbidden SNPNs\", if:\na)\tthere is a successful LR after a subsequent manual selection of the SNPN;\nc)\tthe MS implementation specific timer not shorter than 60 minutes expires;\nc)\tthe MS is switched off; or\nd)\tan entry of the \"list of subscriber data\" with the SNPN identity of the SNPN is updated or the USIM is removed if: \n-\tEAP based primary authentication and key agreement procedure using EAP-AKA'; or\n-\t5G AKA based primary authentication and key agreement procedure;\n\twas performed in the selected SNPN.\nThe MS shall add an SNPN to the list of \"permanently forbidden SNPNs\", if a message with cause value #75 \"Permanently not authorized for this SNPN\" (see 3GPP\u00a0TS\u00a024.501\u00a0[64]) is received by the MS in response to an LR request from the SNPN and:\n-\tthe message is integrity-protected; or\n-\tthe message is not integrity-protected, and the value of the SNPN-specific attempt counter for that SNPN is equal to the MS implementation specific maximum value as defined in 3GPP\u00a0TS\u00a024.501\u00a0[64].\nThe MS shall remove an SNPN from the list of \"permanently forbidden SNPNs\", if:\na)\tthere is a successful LR after a subsequent manual selection of the SNPN;\nb)\tan entry of the \"list of subscriber data\" with the SNPN identity of the SNPN is updated or the USIM is removed if: \n-\tEAP based primary authentication and key agreement procedure using EAP-AKA'; or\n-\t5G AKA based primary authentication and key agreement procedure;\n\twas performed in the selected SNPN.\nWhen the MS reselects to a cell in a shared network, and the cell is a suitable cell for multiple SNPN identities received in the broadcast information as specified in 3GPP\u00a0TS\u00a036.331\u00a0[42] and 3GPP\u00a0TS\u00a038.331\u00a0[65], the AS indicates these multiple SNPN identities to the NAS according to 3GPP\u00a0TS\u00a036.304\u00a0[43] and 3GPP\u00a0TS\u00a038.304\u00a0[61]. The MS shall select one of these SNPNs. If the registered SNPN is available among these SNPNs, the MS shall not select a different SNPN.\nThe MS operating in SNPN access mode shall maintain one or more lists of \"5GS forbidden tracking areas for roaming\", each associated with an SNPN. The MS shall use the list of \"5GS forbidden tracking areas for roaming\" associated with the selected SNPN. If the MS selects a new SNPN, the MS shall keep the list of \"5GS forbidden tracking areas for roaming\" associated with the previously selected SNPN. If the number of the lists to be kept is higher than supported, the MS shall delete the oldest stored list of \"5GS forbidden tracking areas for roaming\". The MS shall delete all lists of \"5GS forbidden tracking areas for roaming\", when the MS is switched off and periodically (with period in the range 12 to 24 hours). The MS shall delete the list of \"5GS forbidden tracking areas for roaming\" associated with an SNPN, when the entry of the SNPN in the list of subscriber data\" is updated or when the USIM is removed if:\n-\tthe EAP based primary authentication and key agreement procedure using the EAP-AKA'; or\n-\tthe 5G AKA based primary authentication and key agreement procedure;\nwas performed in the selected SNPN.\nNOTE\u00a07:\tThe number of the lists of \"5GS forbidden tracking areas for roaming\" supported by the MS is MS implementation specific.\nIf a message with cause value #15 (see 3GPP\u00a0TS\u00a024.501\u00a0[64]) is received by an MS operating in SNPN access mode, the TA is added to the list of \"5GS forbidden tracking areas for roaming\" of the selected SNPN. The MS shall then search for a suitable cell in the same SNPN but belonging to a TA which is not in the \"5GS forbidden tracking areas for roaming\" list of the selected SNPN.\nThe MS should maintain a list of SNPNs for which the N1 mode capability was disabled due to receipt of a reject from the network with 5GMM cause #27 \"N1 mode not allowed\". When the MS disables its N1 mode capability due to receipt of a reject from an SNPN with 5GMM cause #27 \"N1 mode not allowed\":\n-\tthe MS should add the SNPN identity of the SNPN which sent a reject with 5GMM cause #27 \"N1 mode not allowed\" to the list of SNPNs for which the N1 mode capability was disabled and should start timer TG if timer TG is not already running. The number of SNPNs for which N1 mode was not allowed that the MS can store is implementation specific, but it shall be at least one. The value of timer TG is MS implementation specific;\n-\tin automatic SNPN selection, the MS shall not select an SNPN for which the N1 mode capability was disabled as SNPN selection candidates, unless no other SNPN is available;\n and\n-\tthe MS shall delete stored information on SNPNs for which the N1 mode capability was disabled when the MS is switched off, the USIM is removed, the entries of the \"list of subscriber data\" for the SNPNs are updated, or timer TG expires.\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n1) At CT1#122e, a list of SNPNs for which the N1 mode capability was disabled was added in TS 23.122, subclause 4.9.3.0 (CR #502r1, C1-200847). According to TS 24.501, when the UE receives a NAS reject message from an SNPN with cause #27 \"N1 mode not allowed\", the UE will start T3247 and increment an SNPN-specific attempt counter for 3GPP access. According to TS 23.122, the UE will also add the SNPN ID to the above list, but there is no handling for the list defined for the case when T3247 expires.It is proposed to specify the mandatory requirements how to handle the entries of the list in CR #2048 to TS 24.501, and to update the description of the list of SNPNs for which the N1 mode capabilities was disabled in the present specification accordingly.2) The CR #502r1 also specified a timer TG which is used to trigger an erasure of the list. The value of this timer is implementation dependent. But TG has already been used as name for the timer which triggers an erasure of the list of PLMNs for which N1 mode is not allowed. We prefer to specify a separate timer TJ for this purpose, in order to decouple the mechanisms for PLMN selection and SNPN selection as much as possible. It is also suggested that the value of that timer \"shall not exceed the maximum possible value of background scanning timer T as specified in subclause\u00a04.4.3.3.1\". (The same limit applies for timers TD, TE, TF, TG and TH.)\n\n>>> SUMMARY OF CHANGE\n1) Missing description of the handling of list entries upon expiry of T3247 is added, together with a reference to TS 24.501.2) Name of the timer changed to TJ, upper limit added.\n\n>>> CONSEQUENCES IF NOT REVISED\n1) Incomplete/inconsistent specification can result in a UE implementation which does not delete SNPN IDs from the list upon expiry of T3247. So when the reject message was sent by a rogue gNB the UE may avoid to select a certain SNPN for an unnecessary long time.2) Re-use of the timer name - and of the timer - can result in unintended cross-effects, e.g. the list of PLMNS where N1 mode is not allowed could be erased much earlier than intended, if someone is setting up a fake SNPN."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st change\n6.1.3\tMajor capabilities\nThis subclause contains the major capabilities to be supported over the II-NNI.\nThe table 6.1.3.1 specifies which capabilities are applicable for II-NNI. The profile status codes within table 6.1.3.1 are defined in table 6.1.3.2.\nFor the \"Basic SIP\" capabilities part of table 6.1.3.1, the last column \"Profile status over II-NNI\" specifies the general status of applicability of the IETF RFC 3261 [13] main mechanisms described in the 2nd column \"Capability over the Ici\". \nFor the \"Extensions to basic SIP\" capabilities part, the last column \"Profile status over II-NNI\" specifies the general status of applicability of the RFC referenced in the 2nd column \"Capability over the Ici\". \nIf necessary, the applicability of RFCs at the II-NNI level is further detailed in the present Technical Specification.\nThe columns \"Reference item in 3GPP TS 24.229 [5] for the profile status\" provide informative references for comparison purposes into the UA and Proxy role major capabilities tables in 3GPP TS 24.229 [5], where the capabilities are defined via additional references.\nTable\u00a06.1.3.1: Major capabilities over II-NNI \nItem\tCapability over the Ici\tReference item in 3GPP TS 24.229 [5] for the profile status\tProfile status over II-NNI\n\t\tUA Role (NOTE 1)\tProxy role (NOTE 2)\n\tBasic SIP (IETF RFC 3261 [13])\n1\tregistrations\t1, 2, 2A\t-\tc2\n2\tinitiating a session\t2B, 2C, 3, 4\t-\tm\n3\tterminating a session\t5\t3\tm\n4\tGeneral proxy behaviour\t-\t4, 5, 14, 15, 19F\tn/a\n5\tManaging several responses due to forking \t9,10\t6\tm\n6\tsupport of indication of TLS connections in the Record-Route header\t-\t7, 8\tn/a\n7\tSupport of authentication\t7, 8, 8A\t8A\tc2\n8\tTimestamped requests (Timestamp header field)\t6\t-\tm\n9\tPresence of date in requests and responses (Date header field)\t11\t9\tm\n10\tPresence of alerting information data (Alert-info header field)\t12\t10\to\n11\tSupport and handling of the Require header field for REGISTER and other requests or responses for methods other than REGISTER\t-\t11, 12, 13\tm \n12\tSupport and reading of the Supported and Unsupported header fields\t-\t16, 17, 18\tm\n13\tSupport of the Error-Info header field in 3xx - 6xx responses\t-\t19\to\n14\tSupport and handling of the Organization header field\t-\t19A, 19B\tm\n15\tSupport and handling of the Call-Info header field\t-\t19C, 19D\tm \n16\tSupport of the Contact header field in 3xx response\t-\t19E\tm\n\tExtensions to basic SIP\n17\tIETF RFC 6086 [39]: SIP INFO method and package framework\t13\t20\to\n17A\tIETF RFC 6086 [39]: legacy INFO usage\t13A\t20A\to\n18\tIETF RFC\u00a03262 [18]: reliability of provisional responses in SIP (PRACK method)\t14\t21\tm\n19\tIETF RFC\u00a03515 [22]: the SIP REFER method\t15\t22\to\n20\tIETF RFC 3312 [40] and RFC 4032 [41]: integration of resource management and SIP (Preconditions framework)\t16\t23\to\n21\tIETF RFC\u00a03311 [23]: the SIP UPDATE method\t17\t24\tm\n22\tIETF RFC\u00a03313 [42]: SIP extensions for media authorization (P-Media-Authorization header field)\t19\t26\tn/a\n23\tIETF RFC\u00a03265 [20]: SIP specific event notification (SUBSCRIBE/NOTIFY methods)\t20, 21, 22, 23\t27, 28\tc1\n24\tIETF RFC\u00a03327 [43]: session initiation protocol extension header field for registering non-adjacent contacts (Path header field)\t24\t29\tc2\n25\tIETF RFC\u00a03325 [44]: private extensions to the Session Initiation Protocol (SIP) for network asserted identity within trusted networks\t25\t30\tc4\n26\tIETF RFC\u00a03325 [44]: the P-Preferred-Identity header field extension\t-\t-\tn/a\n27\tIETF RFC\u00a03325 [44]: the P-Asserted-Identity header field extension\t-\t-\tc4\n28\tIETF RFC\u00a03323 [34]: a privacy mechanism for the Session Initiation Protocol (SIP) (Privacy header field)\t26, 26A, 26B, 26C, 26D, 26E, 26F, 26G, 26H\t31, 31A, 31B, 31C, 31D, 31E, 31F, 31G, 31H\tm\n29\tIETF RFC\u00a03428 [19]: a messaging mechanism for the Session Initiation Protocol (SIP) (MESSAGE method)\t27\t33\to\n30\tIETF RFC\u00a03608 [45]: session initiation protocol extension header field for service route discovery during registration (Service-Route header field)\t28\t32\tc2\n31\tIETF RFC\u00a03486 [46]: compressing the session initiation protocol\t29\t34\tn/a\n32\tIETF RFC\u00a03455 [24]: private header extensions to the session initiation protocol for the 3rd-Generation Partnership Project (3GPP) \t30\t35\to\n32A\tIETF RFC\u00a03325 [44]: act as first entity within the trust domain for asserted identity\t30A\t30A\tn/a\n32B\tIETF RFC\u00a03325 [44]: act as entity within trust network that can route outside the trust network\t30B\t30B\tn/a\n32C\tIETF RFC\u00a03325: act as entity passing on identity transparently independent of trust domain\t30C\t30C\tn/a\n33\tIETF RFC\u00a03455 [24]: the P-Associated-URI header field extension\t31\t36\tc2\n34\tIETF RFC\u00a03455 [24]: the P-Called-Party-ID header field extension\t32\t37\tc2\n35\tIETF RFC\u00a03455 [24]: the P-Visited-Network-ID header field extension\t33\t38, 39\tc2\n36\tIETF RFC\u00a03455 [24]: the P-Access-Network-Info header field extension\t34\t41, 42, 43\tc4\n37\tIETF RFC\u00a03455 [24]: the P-Charging-Function-Addresses header field extension\t35\t44, 44A\tn/a\n38\tIETF RFC\u00a03455 [24]: the P-Charging-Vector header field extension\t36\t45, 46\tc1\n39\tIETF RFC\u00a03329 [47]: security mechanism agreement for the session initiation protocol\t37\t47\tn/a\n39A\tdraft-dawes-dispatch-mediasec-parameter [134]: Capability Exchange for Media Plane Security\t37A\t47A\tn/a\n40\tIETF RFC\u00a03326 [48]: the Reason header field for the session initiation protocol\t38\t48\to\n41\tIETF RFC\u00a06432 [49]: carrying Q.850 codes in reason header fields in SIP (Session Initiation Protocol) responses\t38A\t48A\tc4\n42\tIETF RFC\u00a03581 [50]: an extension to the session initiation protocol for symmetric response routeing\t39\t49\to\n43\tIETF RFC\u00a03841 [51]: caller preferences for the session initiation protocol (Accept-Contact, Reject-Contact and Request-Disposition header fields)\t40, 40A, 40B, 40C, 40D, 40E, 40F \t50, 50A, 50B, 50C, 50D, 50E, 50F\tm\n44\tIETF RFC\u00a03903 [21]: an event state publication extension to the session initiation protocol (PUBLISH method)\t41\t51\tc1\n45\tIETF RFC\u00a04028 [52]: SIP session timer (Session-Expires and Min-SE headers)\t42\t52\tm\n46\tIETF RFC\u00a03892 [53]: the SIP Referred-By mechanism\t43\t53\tm\n47\tIETF RFC\u00a03891 [54]: the Session Initiation Protocol (SIP) \"Replaces\" header\t44\t54\to\n48\tIETF RFC\u00a03911 [55]: the Session Initiation Protocol (SIP) \"Join\" header\t45\t55\to\n49\tIETF RFC\u00a03840 [56]: the callee capabilities\t46\t56\to\n50\tIETF RFC\u00a04244 [25]: an extension to the session initiation protocol for request history information (History-Info header field)\t47\t57\to\n51\tIETF RFC\u00a05079 [57]: Rejecting anonymous requests in the session initiation protocol\t48\t58\to\n52\tIETF RFC\u00a04458 [58]: session initiation protocol URIs for applications such as voicemail and interactive voice response (NOTE 3)\t49\t59\to\n53\tIETF RFC\u00a04320 [59]: Session Initiation Protocol's (SIP) non-INVITE transactions\t50\t61\tm\n54\tIETF RFC\u00a04457 [60]: the P-User-Database private header field extension\t51\t60\tn/a\n55\tIETF RFC\u00a05031 [61]: a uniform resource name for services\t52\t62\tn/a\n56\tIETF RFC 5627 [62]: obtaining and using GRUUs in the Session Initiation Protocol (SIP)\t53\t63\tc1\n\tVoid\n58\tIETF RFC\u00a04168 [27]: the Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP)\t55\t65\to\n59\tIETF RFC\u00a05002 [64]: the SIP P-Profile-Key private header field extension\t56\t66, 66A, 66B\tc3\n60\tIETF RFC 5626 [65]: managing client initiated connections in SIP\t57\t67\tc1\n61\tIETF RFC 5768 [66]: indicating support for interactive connectivity establishment in SIP\t58\t-\tn/a\n62\tIETF RFC\u00a05365 [67]: multiple-recipient MESSAGE requests in the session initiation protocol\t59\t69\to if 29, else n/a\n63\tdraft-ietf-sipcore-location-conveyance-08 [68]: SIP location conveyance (Geolocation header)\t60\t70, 70A, 70B\tm\n64\tIETF RFC\u00a05368 [69]: referring to multiple resources in the session initiation protocol\t61\t71\to if 19, else n/a\n65\tIETF RFC\u00a05366 [70]: conference establishment using request-contained lists in the session initiation protocol\t62\t72\to \n66\tIETF RFC 5367 [71]: subscriptions to request-contained resource lists in the session initiation protocol\t63\t73\to if 23, else n/a\n67\tIETF RFC\u00a04967 [72]: dialstring parameter for the session initiation protocol uniform resource identifier\t64\t74\tc2\n68\tIETF RFC\u00a04964 [73]: the P-Answer-State header extension to the session initiation protocol for the open mobile alliance push to talk over cellular\t65\t75\to\n69\tIETF RFC\u00a05009 [74]: the SIP P-Early-Media private header field extension for authorization of early media\t66\t76\tc4\n70\tIETF RFC\u00a04694 [75]: number portability parameters for the \u2018tel\u2019 URI\t67, 67A, 67B\t77, 77A, 77B\to\n72\tIETF RFC\u00a04411 [77]: extending the session initiation protocol Reason header for preemption events\t69\t79\to\n73\tIETF RFC\u00a04412 [78]: communications resource priority for the session initiation protocol? (Resource-Priority header field)\t70, 70A, 70B\t80, 80A, 80B\to\n74\tIETF RFC\u00a05393 [79]: addressing an amplification vulnerability in session initiation protocol forking proxies\t71\t81\tm\n75\tIETF RFC\u00a05049 [80]: the remote application identification of applying signalling compression to SIP\t72\t82\tn/a\n76\tIETF RFC 5688 [81]: a session initiation protocol media feature tag for MIME application sub-types\t73\t83\tc1\n77\tIETF RFC 6050 [26]: Identification of communication services in the session initiation protocol\t74\t84, 84A\to\n78\tIETF RFC\u00a05360 [82]: a framework for consent-based communications in SIP?\t75, 75A, 75B\t85\to\n79\tdraft-johnston-sipping-cc-uui-09 [83]: transporting user to user information for call centers using SIP?\t76\t86\tc1\n80\tdraft-vanelburg-dispatch-private-network-ind-01 [84]: The SIP P-Private-Network-Indication private-header (P-Header)\t77\t87\tc1\n81\tIETF RFC\u00a05502 [85]: the SIP P-Served-User private header\t78\t88\tc2\n83\tdraft-dawes-sipping-debug-04 [87]: the P-Debug-ID header extension\t80\t90\to\n84\tIETF RFC 6228 [88]: the 199 (Early Dialog Terminated) response code\t81\t91\tm\n85\tIETF RFC 5621 [89]: message body handling in SIP\t82\t92\n86\tIETF RFC 6223 [90]: indication of support for keep-alive\t83\t93\to\n87\tIETF RFC 5552 [91]: SIP Interface to VoiceXML Media Services\t84\t94\tn/a\n88\tIETF RFC\u00a03862 [92]: common presence and instant messaging (CPIM): message format\t85\t95\to\n89\tIETF RFC 5438 [93]: instant message disposition notification\t86\t96\to\n90\tIETF RFC\u00a05373 [94]: requesting answering modes for SIP (Answer-Mode and Priv-Answer-Mode header fields)\t87\t97, 97A\to\n\tVoid\n92\tIETF RFC\u00a03959 [96]: the early session disposition type for SIP\t89\t99\to\n93\tdraft-rosenberg-sipcore-target-uri-delivery [97]: delivery of Request-URI targets to user agents\t90\t100\tn/a\n94\tdraft-kaplan-sip-session-id-02 [124]: The Session-ID header\t91\t101\to\n95\tIETF RFC\u00a06026 [125]: correct transaction handling for 200 responses to Session Initiation Protocol INVITE requests\t92\t102\tm\n96\tIETF RFC\u00a05658 [126]: addressing Record-Route issues in the Session Initiation Protocol (SIP)\t93\t103\to\n97\t IETF RFC 5954 [127]: essential correction for IPv6 ABNF and URI comparison in IETF RFC 3261 [13]\t94\t104\tm\n98\tIETF RFC\u00a04488 [132]: suppression of session initiation protocol REFER method implicit subscription\t95\t105\tc5\n99\tdraft-ietf-salud-alert-info-urns [133]: Alert-Info URNs for the Session Initiation Protocol\t96\t106\to\n100\tSubclause 3.1 of 3GPP TS 24.229: multiple registrations\t97\t107\tc2\n101\tIETF RFC 4538 [135]: request authorization through dialog Identification in the session initiation protocol (Target-Dialog header field)\t99\t109\to\nc1: m in case of roaming II-NNI, else o\tc2: m in case of roaming II-NNI, else n/a\tc3: o in case of roaming II-NNI, else n/a\tc4: m in case of trust relationship between the interconnected networks, else n/a\tc5: m in the case the REFER request is supported, else n/a \nNOTE 1: The item numbering corresponds to the one provided in table A.4 in [5]\tNOTE 2: The item numbering corresponds to the one provided in table A.162 in [5]\tNOTE 3: A common URI namespace is required to apply this feature on the II-NNI\n\nTable\u00a06.1.3.2: Key to notation codes for major capabilities\nNotation code\tNotation name\tExplanation\nm\tmandatory\tThe capability shall be supported at II-NNI.\tSIP message relating to this capability shall be sent over the II-NNI if received from the serving network, unless they also make use of other unsupported capabilities.\tSIP headers or other information elements relating to this capability shall be passed over the II-NNI if received from the sending side.\tThis does not imply that network elements inside the serving network or served network or user equipment connected to these networks shall support this capability.\no\toptional\tThe capability may or may not be supported at II-NNI. The support of the capability is provided based on bilateral agreement between the operators.\nn/a\tnot applicable\tIt is impossible to use/support the capability at the II-NNI.\nc <integer>\tconditional\tThe support of the capability (\"m\", \"o\" or \"n/a\") depends on the support of other optional or conditional items. <integer> is the identifier of the conditional expression.\n\nEnd of change\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe profile status of multipart message body over II-NNI is specified as \"m\" in TS 29.165. This means that multipart message bodies including nested body parts shall be passed through the IBCF regardless of operator policies.However, this could be against the operator policy for prevention of data communication without charge.For example, an originating user sends the INVITE request containing multipart message bodies including a SDP and a body containing a payload carrying message (such as text message used by the instant message). Then an terminating user receives the INVITE request, but the session is not established, the originating user can send the message without charge, as the operator can not charge when the session is not establised. Such a misuse may reduce a profit of operators.Therefore, it is up to operator policy whether to pass the multipart MIME bodies transparently and may take appropriate action at the IBCF by using the screening functionality to SIP message bodies defined in TS 24.229 5.10.6.2.\n\n>>> SUMMARY OF CHANGE\nThe profile status of multipart message body in table 6.1.3.1 is modified from \"m\" to \"o\".\n\n>>> CONSEQUENCES IF NOT REVISED\nMultipart message bodies could be misused if operator does not manage SIP message body and such a misuse may reduce a profit of operators."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n* * * First Change * * * *\n6.1.3.1\tDetailed behaviour\nThe HSS shall de-register the affected identities and invoke this procedure to inform the S-CSCF. The S-CSCF shall remove all the information stored in the S-CSCF for the affected identities. \nThe HSS may de-register:\n-\tOne Public Identity or a list of Public Identities. HSS may include all Public User Identities associated with the User-Name AVP to the request. This option is applicable with all reason codes.\n-\tOne or more Private Identities of the IMS Subscription with all associated Public Identities. No Public-Identity AVPs shall be present in this case. This option is applicable with reason codes PERMANENT_TERMINATION, SERVER_CHANGE, and REMOVE_S-CSCF.\n-\tAll Public Service Identities that match a Wildcarded Public Service Identity.  In this case the HSS may send one of the Public Service Identities that was received in the Server Assignment Request for that Wildcarded Public Service Identity and the associated Private Service Identity.\n-\tA Wildcarded Public User Identity.  In this case the HSS shall send a distinct Public User Identity that belongs to the same implicit registration set as the Wildcarded Public User Identity and the associated Private User Identity.\nThe HSS shall send in the Deregistration-Reason AVP the reason for the de-registration, composed by a textual message (if available) aimed for the user and a reason code that determines the action the S-CSCF has to perform. The possible reason codes are:\n-\tPERMANENT_TERMINATION: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to the Public Identity and associated implicitly registered Public Identities for the Private Identity(ies) indicated in the request (e.g. due to an IMS subscription modification or a removal of IP-address secure binding information when GIBA is used). \nThe HSS shall check the registration state of the Public Identities. If no Public Identities are involved, the HSS shall check the registration state of the Public Identities associated with the Private User Identity identified. For each Public Identity:\n-\tIf the registration state of the Public Identity is Registered, the HSS shall check if the Public User Identity is currently registered with one or more Private User Identities. \n-\tIf the Public User Identity is currently registered with only one Private User Identity, the HSS shall check whether the Public User Identity is included in the information element Identities with Emergency Registrations returned by S-CSCF in the response.\n -\tIf included, the HSS shall keep the S-CSCF name associated with the Public User Identity and set the registration state of the Public User Identity to Unregistered.\n-\tIf not included, the HSS shall clear the S-CSCF name associated with the Public User Identity, and set the registration state of the Public User Identity to Not Registered  The S-CSCF initiates the de-registration of the Public User Identity unless it is emergency registered.\n-\tIf the Public User Identity is currently registered with more than one Private User Identity, the HSS shall keep the registration state of the Public User Identity as Registered and retain the S-CSCF name associated with the Public User Identity. The S-CSCF initiates the de-registration of the Public User Identity unless it is emergency registered.\n-\tIf the registration state of the Public Identity is Unregistered, the HSS shall check whether this Public User Identity is included in the information element Identities with Emergency Registrations returned by S-CSCF in the response.\n-\tIf included, the HSS shall keep the S-CSCF name associated with the Public User Identity.\n-\tIf not included, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity.\n-\tNEW_SERVER_ASSIGNED: The HSS indicates to the S-CSCF that a new S-CSCF has been allocated to the IMS Subscription e.g. because the previous assigned S-CSCF was unavailable during a registration procedure. The S-CSCF shall remove all information for all of the Public Identities indicated in the request.\n-\tSERVER_CHANGE: The HSS indicates to the S-CSCF that the de-registration is requested to force the selection of new S-CSCF to assign to the IMS Subscription (e.g. when the S-CSCF capabilities are changed in the HSS or when the S-CSCF indicates that it has not enough memory for the updated User Profile). The HSS shall set the registration state to \"Not Registered\" and clear the S-CSCF name for all of the Public Identities affected by the request. If the S-CSCF does not indicate in the response all the Private Identities that were in the request, the HSS shall repeat this request for each of the remaining Private Identities in the IMS Subscription that are known to the S-CSCF. The S-CSCF should start the network initiated de-registration towards the user, i.e. all registrations within the IMS Subscription are de-registered and the user is asked to re-register to all existing registrations.\n-\tREMOVE_S-CSCF: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to an unregistered Public Identity(ies) (i.e registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) for a given IMS Subscription.\nThe HSS shall check if an emergency registration exists in the S-CSCF, checking for each Public Identity contained in the request whether it is present in the information element Identities with Emergency Registrations returned by S-CSCF.\n-\tIf an emergency registration does not exist in S-CSCF, for each Public Identity contained within the request, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity. The S-CSCF shall remove all information related to the Public User Identity contained within the request.\n-\tIf an emergency registration exists in S-CSCF for one or more Public User Identities contained in the request, the S-CSCF should include the corresponding Private Identity /Public User Identity pairs in the information element Identities with Emergency Registrations in the answer. The HSS, when receiving such an answer, shall not change the registration state of the Public User Identities present in the information element Identities with Emergency Registrations and shall keep unchanged the S-CSCF name associated with these Public User Identities.\nPublic Identities which are emergency registered in the S-CSCF shall not be de-registered when a Cx-Deregistration request with a -reason code of PERMANENT_TERMINATION or REMOVE_S-CSCF is received from the HSS. In this case\n-\tif all to be de-registered identities are emergency registered, a Result-Code set to DIAMETER_UNABLE_TO_COMPLY and a list of Private / Public Identity pairs which are emergency registered shall be returned to the HSS\n-\tif a proper subset of the to be de-registered identities are emergency registered, a Result-Code of DIAMETER_LIMITED_SUCCESS and a list of Private Identity / Public Identity pairs which are emergency registered shall be returned to the HSS.\nNOTE 1:\tIf the Public Identity that is emergency registered has normal registration as well, then for the normal registration the S-CSCF will perform the detailed de-registration procedures towards the UE for each reason code as described in 3GPP TS 24.229 [8].\nNOTE 2:\tIt is assumed that Public Identities which are implicitly registered along with an emergency registration are also emergency registered.\nThe detailed de-registration procedures performed by the S-CSCF are described in 3GPP TS 24.229 [8].\n\n* * * End of Changes * * * *\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs part of the procedure \"Network-initiated de-registration by the HSS\", when an IMS subscription is deleted, the HSS sends an RTR command to the S-CSCF, including the \"Reason for de-registration\" Information Element.The current text in the spec, describing the different values to be used for that \"Reason for de-registration\", can be interpreted as if the reason sent by HSS is directly related to the registration status of the subscriber.I.e., if a Public Identity is deleted, and it happens to be unregistered, the current text might suggest that the proper reason to be sent is REMOVE_SCSCF instead of PERMANENT_TERMINATION, due to the highlighted text below:- PERMANENT_TERMINATION: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to the Public Identity and associated implicitly registered Public Identities for the Private Identity(ies) indicated in the request (e.g. due to an IMS subscription modification or a removal of IP-address secure binding information when GIBA is used).- REMOVE_S-CSCF: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to an unregistered Public Identity(ies) (i.e registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) for a given IMS Subscription.The same problem may occur with scenarios other than subscription deletion (e.g., user identity barring).The general concept should be:- PERMANENT_TERMINATION -> It should refer to any reason (barring, removal, etc.) leaving the identity without being able to be assigned to an S-CSCF again, no matter the previous registration status (registered / unregistered)- REMOVE_S-CSCF -> any administrative change in the registration status from registered / unregistered to de-registered means that the user has to be removed in S-CSCF, but it is not prohibited that it can be registered / unregistered again.\n\n>>> SUMMARY OF CHANGE\nClarify the conditions for sending the PERMANENT_TERMINATION de-registration cause by HSS; in particular, clarify that the condition does not depend on the registered / unregistered status.\n\n>>> CONSEQUENCES IF NOT REVISED\nOperators cannot perform correct troubleshooting in their networks when it comes to Performance Management Counters/Statistics, e.g. if users are not authorized to register anymore in the network and there were not any RTR messages sent with PERMANENT_TERMINATION shown in counter collection, operator might (wrongly) think that there is a problem in the network (other than a manual removal of identities, for example)"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1\tScope\nThe present document specifies the radio network layer signalling procedures of the control plane between eNBs in E-UTRAN. X2AP supports the functions of X2 interface by signalling procedures defined in this document. X2AP is developed in accordance to the general principles stated in TS 36.401 [2] and TS 36.420 [3].\n\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\". \n[2]\t3GPP TS 36.401:  \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Architecture Description\". \n[3]\t3GPP TS 36.420:  \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); X2 General Aspects and Principles\". \n[4]\t3GPP TS 36.413:  \" Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[5]\tITU-T Recommendation X.691 (2002-07): \"Information technology - ASN.1 encoding rules - Specification of Packed Encoding Rules (PER) \".\n[6]\t3GPP TS 32.422:  \"Telecommunication Management; Subscriber and Equipment Trace; Trace Control and Configuration Management\".\n[7]\t3GPP TS 32.421: \"Telecommunication Management; Subscriber and Equipment Trace; Trace concepts and requirements\".\n[8]\t3GPP TS 36.424: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); X2 data transport\".\n[9]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRAN); Radio Resource Control (RRC) Protocol Specification\".\n[10]\t3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Physical Channels and Modulation\".\n[11]\t3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Physical layer procedures \".\n[12]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[13]\t3GPP TS 23.203: \"Policy and charging control architecture\".\n[14]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System; Stage 3\".\n[15]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA), Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; stage 2\".\n[16] \t3GPP TS 36.104: \"Base Station (BS) radio transmission and reception \".\n[17]\tVoid.\n[18]\t3GPP TS 33.401: \"Security architecture\".\n[19]\t3GPP TS 36.414: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 data transport\".\n[20]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC)\".\n[21]\t3GPP TS 36.422: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); X2 signaling transport\".\n[22]\t3GPP TS 36.314: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Layer 2 - Measurements\".\n[23]\tVoid.\n[24]\t3GPP TS 25.413: \"UTRAN Iu interface RANAP signalling\"\n[25]\t3GPP TS 37.320: \"Universal Terrestrial Radio Access (UTRA) and Evolved Universal Terrestrial Radio Access (E-UTRA); Radio measurement collection for Minimization of Drive Tests (MDT);Overall description; Stage 2\".\n[26]\t3GPP TS 29.281: \"General Packet Radio Service (GPRS); Tunnelling Protocol User Plane (GTPv1-U) \".\n\n\n\nSkip not affected part\n\n9.3\tMessage and Information Element Abstract Syntax (with ASN.1)\n9.3.1\tGeneral\n\nSub clause 9.3 presents the Abstract Syntax of the X2AP protocol with ASN.1. In case there is contradiction between the ASN.1 definition in this sub clause and the tabular format in sub clause 9.1 and 9.2, the ASN.1 shall take precedence, except for the definition of conditions for the presence of conditional elements, in which the tabular format shall take precedence.\nThe ASN.1 definition specifies the structure and content of X2AP messages. X2AP messages can contain any IEs specified in the object set definitions for that message without the order or number of occurrence being restricted by ASN.1. However, for this version of the standard, a sending entity shall construct a X2AP message according to the PDU definitions module and with the following additional rules (Note that in the following IE means an IE in the object set with an explicit id. If one IE needed to appear more than once in one object set, then the different occurrences have different IE ids):\n-\tIEs shall be ordered (in an IE container) in the order they appear in object set definitions.\n-\tObject set definitions specify how many times IEs may appear. An IE shall appear exactly once if the presence field in an object has value \"mandatory\". An IE may appear at most once if the presence field in an object has value \"optional\" or \"conditional\". If in a tabular format there is multiplicity specified for an IE (i.e. an IE list) then in the corresponding ASN.1 definition the list definition is separated into two parts. The first part defines an IE container list in which the list elements reside. The second part defines list elements. The IE container list appears as an IE of its own. For this version of the standard an IE container list may contain only one kind of list elements.\n\nIf a X2AP message that is not constructed as defined above is received, this shall be considered as Abstract Syntax Error, and the message shall be handled as defined for Abstract Syntax Error in clause 10.\n9.3.2\tUsage of Private Message Mechanism for Non-standard Use\nThe private message mechanism for non-standard use may be used:\n-\tfor special operator (and/or vendor) specific features considered not to be part of the basic functionality, i.e. the functionality required for a complete and high-quality specification in order to guarantee multivendor inter-operability.\n-\tby vendors for research purposes, e.g. to implement and evaluate new algorithms/features before such features are proposed for standardisation.\nThe private message mechanism shall not be used for basic functionality. Such functionality shall be standardised.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nRANAP, RNSAP, S1AP specifications specify that ASN.1 definition shall  conform to ITU-T Rec. X.691, ITU-T Rec. X.680 and ITU-T Rec. X.681.A similar sentence is missing in X2AP chpater 9.3.In addition, the same chapter 9.3 contains a note in brackets which is actually a normative part.\n\n>>> SUMMARY OF CHANGE\nX2AP ASN.1 definition conforms to ITU-T Rec. X.691, ITU-T Rec. X.680 and ITU-T Rec. X.681.The content of the Note is decribed in a normative style (no brackets and no \u201cNote\u201d)..\n\n>>> CONSEQUENCES IF NOT REVISED\nASN.1 of X2AP is not specified to conform to ITU-T Rec. X.691, ITU-T Rec. X.680 and ITU-T Rec. X.681. Therefore it may lead to IoT problem.Impact assessment towards the previous version of the specification (same release): This CR has isolated impact towards the previous version of the specification (same release).This CR does not have any impact under functional and protocol point of view. This CR has ASN.1 impacts if implementation does not conform to ITU-T Rec. X.691, ITU-T Rec. X.680 and ITU-T Rec. X.681."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * * First Change * * * *\n4.7.3\tEmergency calls generated by an AS\nIn certain circumstances an AS can identify that a request is an emergency call. This may relate to a request received from a UE (or subscription-based business trunking), or may be a call generated by an AS on behalf of a UE as far as the IM CN subsystem operation is concerned. These applications are outside the scope of this document to define.\nProcedures in support of an AS initiating emergency calls are provided in subclause\u00a05.7.1.13.\n* * * * Next Change * * * *\n5.2.6.3.4\tResponses to an initial request for a dialog\nWhen the P-CSCF receives any 1xx or 2xx response to the above request, the P-CSCF shall:\n1)\tstore the values received in the P-Charging-Function-Addresses header field;\n2)\tstore the list of Record-Route header fields from the received response;\n3)\tstore the dialog ID and associate it with the private user identity and public user identity involved in the session;\n4)\tif a security association or TLS session exists, in the response rewrite its own Record Route entry to its own SIP URI that contains the protected server port number of the security association or TLS session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or TLS session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or TLS session established from the UE to the P-CSCF;\nNOTE:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations. For details on the selection of the protected port values see 3GPP\u00a0TS\u00a033.203\u00a0[19].\n5)\tif SIP digest without TLS, NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, in the response rewrite its own Record-Route entry to its own SIP URI that contains an unprotected server port number where the P-CSCF expects subsequent requests from the UE; and\n6)\tif the response corresponds to an INVITE request, save the Contact, From, To and Record-Route header field values received in the response such that the P-CSCF is able to release the session if needed;\nbefore forwarding the response to the UE in accordance with the procedures of RFC\u00a03261\u00a0[26].\n\n\n\n\n\n\n\n\n\n\n* * * * Next Change * * * *\n\n\n\n\n\n\n\n\n\n\n\n* * * * Next Change * * * *\n7.10.3.2\tStructure and data semantics\nIn order to transport the policy for a public user identity, the S-CSCF shall \n1.\tadd an <actions> element defined in the RFC\u00a04745\u00a0[182] in the <registration> element of the public user identity in the registration information;\nNOTE:\tThe <actions> element is validated by the <xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <registration> elements.\n2.\tif the subscription of the public user identity contains the policy to the usage of the communication resource priority (see RFC\u00a04412\u00a0[116]), for each allowed usage: \na.\tinclude <rph> child element in the <actions> child element of the <registration> element;\nb.\tset the 'ns' attribute of the <rph> child element of the <actions> child element of the <registration> element to the allowed resource priority namespace as specified in RFC\u00a04412\u00a0[116] and as registered in IANA; and\nc.\tset the 'val' attribute of the <rph> child element of the <actions> child element of the <registration> element to the allowed resource priority value within the allowed resource priority namespace;\n3.\tif the subscription of the public user identity contains the policy to act as priviledged sender, include a <privSender> child element in the <actions> child element of the <registration> element;\n4.\tif the subscription of the public user identity contains the policy for special treatment of the P-Private-Network-Indication header field, include a <pni> child element in the <actions> child element of the <registration> element, and shall:\na.\tif a P-Private-Network-Indication header field shall be forwarded, if received from the attached equipment, set the \"insert\" attribute of the <pni> element to a \"fwd\" value; \nb.\tif a P-Private-Network-Indication header field shall be inserted in all requests received from the attached equipment, insert an \"insert\" attribute of the <pni> element to a \"ins\" value; and \nc.\tif the value of the \"insert\" attribute is \"ins\", insert a \"domain\" attribute with the value of the URI to be set in the P-Private-Network-Indication header field;\n\nEditor\u2019s note: There might be a need to define additional individual policy elements.\nEditor\u2019s note: It is FFS whether there is a need to provide the possibility to provide different sets of policies for a user, depending on whether the user is regarded as a priviledged user or not.\n* * * * Next Change * * * *\n7.10.3.3\tXML Schema\nTable\u00a07-11 in this subclause defines the XML Schema describing the individual policies which can be delivered to the the P-CSCF or UE using the reg event package extension for policy transport.\nEditor\u2019s note: The XML namespace needs to be registered once the work on the current release is complete.\nTable\u00a07-11: Reg event package extension for policy transport, XML Schema\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\n  targetNamespace=\"urn:3gpp:ns:extRegInfo:1.0\"\n  xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n  elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n  <xs:element name=\"rph\">\n    <xs:complexType>\n      <xs:attribute name=\"ns\" type=\"xs:string\"/>\n      <xs:attribute name=\"val\" type=\"xs:string\"/>\n    </xs:complexType>\n  </xs:element>\n  <xs:element name=\"privSender\">\n    <xs:complexType/>\n  </xs:element>\n  <xs:element name=\"pni\">\n    <xs:complexType>\n\n\n\n      <xs:attribute name=\"insert\">\n        <xs:simpleType>\n          <xs:restriction base=\"xs:string\">\n            <xs:enumeration value=\"fwd\"/>\n            <xs:enumeration value=\"ins\"/>\n          </xs:restriction>\n        </xs:simpleType>\n      </xs:attribute>\n      <xs:attribute name=\"domain\" type=\"xs:anyURI\"/>\n    </xs:complexType>\n  </xs:element>\n</xs:schema>\n\n\n* * * * No more changes * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the event a request is received by an AS supporting emergency services, the request intended for termination in the public network, then the AS can detect the request as request for an emergency call. The AS may reject the request (e.g. if a user in a burning building makes an emergency call, but emergency call are not supported as part of the private network traffic).It should be noted that the UE need not know that its traffic is private network traffic. Therefore, if the user mistakenly \u201cdials\u201d a SIP/Tel URI that can be recognized as an emergency identifier, it must be possible to redirect the request for emergency services. The handling of a request (for an emergency call intended for termination in the public network) as part of private network traffic can be considered an error case; the UE should have opted for sending the request using the path determined using an emergency registration.It is proposed that if the AS rejects the request for an emergency call as part of private network traffic, intercepts this response and originates a new response formatted such that a UE can handle the redirection of the request for public network provided emergency services.\n\n>>> SUMMARY OF CHANGE\n- introduce procedures for AS supporting emergency services (missing subclause)- introduce P-CSCF handling of request rejected by an AS supporting emergency services- complete the information provisioned in the P-CSCF as part of the special treatment of private network traffic\n\n>>> CONSEQUENCES IF NOT REVISED\nUEs originating requests for public network provided emergency services may send the request (knowingly or unknowingly) as private network traffic. Depending on whether:- operator policy requires the P-CSCF to detect an emergency session request relating to private network traffic;- the P-CSCF is able to detect the emergency session request; and- depending on whether the AS can handle the request,the request for public network provided emergency services is not correctly handled."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nBegin of change\n6.4.3\tImpact on Permanent User Identities\nUser identities (permanent or temporary) are sent with the form of a NAI, according to the EAP-SIM/AKA specifications, and the maximum length of a NAI that we can expect to be handled correctly by standard equipment is 72 octets (see [14]). Moreover, this NAI shall be transported inside the User-Name attribute of a RADIUS Access-Request, with standard length up to 63 octets (see [15]). Therefore, it can be assumed that the maximum length of a WLAN user identity should be 63 octets (i.e. 63 characters).\n\nSince the length of the temporary identity proposed in section 6.4.1 is 23 characters, the length of the realm part of any WLAN permanent user identity must always be 40 characters or less. This applies regardless of whether the length of the username part of the permanent user identity is less than 23 characters.\nNOTE:\tA WLAN temporary user identity is formed as a NAI with the pseudonym or re-athentication identity as the username part and the same realm part as the permanent user identity).\nMoreover, the WLAN permanent user identities should not begin with the character resulting of the printable encoding transformation (see section 6.4.1) of the Temporary identity Tag used for EAP-SIM and EAP-AKA pseudonyms or re-authentication identities. This is needed so that at reception of a WLAN user identity, the AAA server can determine whether it is a permanent or a temporary user identity.\nEnd of change\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe note in the sub-clause 6.4.3 does not allow using realms returned from the 3GPP AAA Server along with the fast re-authentication identity that are different from the realms used with permanent user identities:RFC 4187 (EAP-AKA) states:Fast Re-Authentication IdentityA fast re-authentication identity of the peer, including anNAI realm portion in environments where a realm is used.Used on re-authentication only.It is evident that EAP-AKA RFC specifies NAI realm portion. However, the note in question limits the NAI realm portion to \u201che same realm part as the permanent user identity\u201d\n\n>>> SUMMARY OF CHANGE\nThe note in the sub-clause 6.4.3 is being aligned with the text and the intent of the RFC 4187 (EAP-AKA)\n\n>>> CONSEQUENCES IF NOT REVISED\nImplications in deployments with multiple 3GPP AAA Servers. If the AAA Server that created the fast re-authentication identity cannot indicate exact realm pointing to it, the next authentication using fast re-authentication identity might be forwarded to a different 3GPP AAA Server. Thus the authentication would fall back to full authentication."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n5.4.1.2.1E\tInitial registration and user-initiated reregistration for GPRS-IMS-Bundled authentication\nUpon receipt of a REGISTER request without an Authorization header field, the S-CSCF shall:\n1)\tidentify the user by the public user identity as received in the To header field of the REGISTER request. The S-CSCF shall derive the private user identity from the public user identity being registered by removing URI scheme and the following parts of the URI if present: port number, URI parameters, and To header field parameters.\n2)\tcheck if the P-Visited-Network-ID header field is included in the REGISTER request, and if it is included identify the visited network by the value of this header field.\n3)\tcheck whether an IP address is stored for this UE. If no IP address (or prefix) is stored for the UE, query the HSS as described in 3GPP\u00a0TS\u00a029.228\u00a0[14] with the derived private user identity and the public user identity as input and store the received IP address (or prefix) of the UE; if the S-CSCF receives a prefix from the HSS, it will only check against prefixes otherwise it will check against the full IP address.\nNOTE\u00a01:\tAt this point the S-CSCF informs the HSS, that the user currently registering will be served by the SCSCF by passing its SIP URI to the HSS. This will be indicated by the HSS for all further incoming requests to this user, in order to direct all these requests directly to this S-CSCF.\n4)\tcheck whether a \"received\" header field parameter exists in the Via header field provided by the UE. If a \"received\" header field parameter exists, the S-CSCF shall compare the IP address recorded in the \"received\" header field parameter against the UE's IP address stored during registration. In case of IPv6 stateless autoconfiguration, the S-CSCF shall compare the prefix of the IP address recorded in the \"received\" header field parameter against the UE's IP address prefix stored during registration. If no \"received\" header field parameter exists in the Via header field provided by the UE, then the S-CSCF shall compare IP address recorded in the \"sent-by\" parameter against the stored UE IP address. In case of IPv6 stateless autoconfiguration, S-CSCF shall compare the prefix of the IP address recorded in the \"sent-by\" parameter against the UE's IP address prefix stored during registration. In any case, if the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE do not match, the SCSCF shall query the HSS as described in 3GPP TS 29.228 [14] with the derived private user identity and the public user identity as input and store the received IP address (or prefix) of the UE. If the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE still do not match the S-CSCF shall reject the registration with a 403 (Forbidden) response and skip the following steps.\n5)\tafter performing the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP\u00a0TS\u00a029.228\u00a0[14], store the following information in the local data:\na)\tthe list of public user identities, including the registered own public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities due to the received REGISTER request. Each public user identity is identified as either barred or non-barred;\nb)\tall the service profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including initial Filter Criteria (the initial Filter Criteria for the Registered and common parts is stored and the unregistered part is retained for possible use later - in the case the S-CSCF is retained if the user becomes unregistered); and\nc)\tif restoration procedures are supported, the restoration information if received as specified in 3GPP\u00a0TS\u00a029.228\u00a0[14];\nNOTE\u00a02:\tThere might be more than one set of initial Filter Criteria received because some implicitly registered public user identities that are part of the same implicit registration set belong to different service profiles.\n6)\tupdate registration bindings as follows:\n\n\n\n\na)\tbind to each non-barred registered public user identity all registered contact information including all header field parameters contained in the Contact header field and all associated URI parameters with the exception of the \"pub-gruu\" and \"temp-gruu\" header field parameters as specified in RFC\u00a05627\u00a0[93], and store information for future use; and\nb)\tfor each binding that contains a \"+sip.instance\" Contact header field parameter, assign a new temporary GRUU, as specified in subclause\u00a05.4.7A.3;\nNOTE\u00a03:\tThere might be more than one contact information available for one public user identity.\nNOTE\u00a04:\tThe barred public user identities are not bound to the contact information.\n7)\tcheck whether a Path header field was included in the REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used) and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them either to the contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used) and the contact information that was received in the REGISTER request;\nNOTE\u00a05:\tIf this registration is a reregistration or an initial registration (i.e., there are previously registered public user identities belonging to the user that have not been deregistered or expired), then a list of pre-loaded Route header fields will already exist. If multiple registration mechanism was not used, then the existing list of pre-loaded Route header fields is bound to a respective contact address of the UE. However, if multiple registration mechanism was used, then the existing list of pre-loaded Route header fields is bound to a registration flow and the associated contact address that was used to send the REGISTER request. In either case, the new list replaces the old list.\n8)\tdetermine the duration of the registration by checking the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). The S-CSCF may reduce the duration of the registration due to local policy or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration;\n9)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n10)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause\u00a05.4.1.2.2F. \nWhen a user de-registers, or is de-registered by the HSS, the S-CSCF shall delete the IP address stored for the UE.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn CT1 #82, we discussed a CR, C1-130530, to address an issue in the current 24.229 specification when GIBA is used as the authentication mechanism but an entity between the UE and the IMS core network changes the source IP address in the IP header of the packets sent by the UE.  During the meeting, we were asked to provide requirements from SA3 stating that GIBA is expected to be used in a scenario where UE\u2019s IP address can be changed.  The following sections from 33.203 indicate that GIBA is indeed expected to work in such a scenario.  Hence, we resubmit the CR as it is clear that there are stage 2 requirements to handle such a scenario.T.8.1 of TS 33.203: The P-CSCF checks the source IP address against the IP address in the Via header of the REGISTER message. If the source IP address differs from the IP address in the Via header, the P-CSCF adds the source IP address to a received parameter in the Via header. The P-CSCF then forwards the REGISTER to the I-CSCF in the home network.T.8.1 of TS 33.203: The S-CSCF contacts the HSS and indicates that GIBA is used to authenticate the UE. The HSS returns the stored IP address to the S-CSCF. The S-CSCF then checks the IP address returned by the HSS against the IP address obtained in the REGISTER message ((if present, the received by parameter shall be used).Per Sections 5.2.2.6 and  5.4.1.2E bullet 4 in 24.229 there are scenarios where an entity between the UE and PCSCF changes the IP address exposed to the external network even when GIBA is used as the authentication method .  I.e, the Source IP address of the IP packet containing the REGISTER can be different from the IP address that UE has obtained from the network even when GIBA is used as the authentication method . Per F.2.1.2.2, if the REGISTER request is sent without integrity protection, the UE shall populate the Contact header with its private IP address.  When GIBA is used as the authentication method, UE will not send a protected REGISTER message.Also, per 5.4.1.2.1E, the S-CSCF shall use the Contact header to create a binding between the UE\u2019s public user identity and the IP address in the Contact header.Hence, based on the text from F.2.1.2.2 and that in 5.4.1.2.1E quoted above, this will result in incorrect state in the S-CSCF when a entity between the UE and PCSCF changes the IP address.   That is, the S-CSCF will have the incorrect binding (public identity will be bound to private IP address of UE).\n\n>>> SUMMARY OF CHANGE\nThe procedure used by S-CSCF is updated to account for the scenario in which an entity between the UE and the PCSCF changes the exposed IP address\n\n>>> CONSEQUENCES IF NOT REVISED\nA UE with a private IP address will be unreachable if it is behind an entity between UE and PCSCF and GIBA is used as the authentication mechanism."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n===== START OF CHANGE 1 ============\n9\tSecurity interworking between E-UTRAN and UTRAN\nEditor's Note: Any impacts in this section due the feature of per user activation of UP ciphering are for ffs and dependent on an agreement on this feature which is for ffs.\n9.1\tIdle mode mobility\n9.1.1\tFrom E-UTRAN to UTRAN\nThe E-UTRAN NAS Attach Request and TAU Request messages shall include the UTRAN and GERAN security capabilities of UE. All UE capabilities are sent back to the UE in the corresponding integrity protected response messages for verification that they were not changed.\nThe MME shall transfer UE's UTRAN and GERAN security capabilities and CK' || IK' to SGSN with Context Response/SGSN Context Response message. The MME and UE derive CK' and IK' from KASME as specified in Annex A.\nSGSN shall include the allowed security algorithm and transfer to RNC with SMC message. RNC will select security algorithms and indicate to UE whenever needed.\nIn idle mode mobility from E-UTRAN to UTRAN, UE sends a RAU Request message towards SGSN and shall include a P-TMSI signature. The available P-TMSI signature field bits (at minimum 16 bits) shall be filled with a NAS-token (i.e. the x least significant bits of the KDF output) which is generated with the following function:\nNAS-token is derived as specified in Annex A. Both KASME and current NAS downlink COUNT are mandatory input parameters.\nSGSN forwards the P-TMSI signature to the old MME, which compares it with a NAS-token (truncation of most meaningful bits if needed), for the UE identified within the context request. If they match, the context request message is authenticated and authorized and MME will provide the needed information for the SGSN. Old MME responds with an appropriate error cause if it does not match the value stored in the old MME. This should initiate the security functions in the new SGSN.\nTo avoid possible race condition problems, the MME shall be able to compare the received NAS-token with NAS-tokens generated from the current NAS SN downlink value down to current NAS SN-L downlink values, i.e. [current NAS downlink SQN - L, current NAS downlink SQN].. A suitable value for the parameter L can be configured by the network operator. The default value for the parameter L is 5 and maximum value 10. MME shall not accept the same NAS-token for the same UE twice except in retransmission cases happening for the same mobility event.\n9.1.2\tFrom UTRAN to E-UTRAN\n\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nSGSN shall be informed by the UE about its EPC/E-UTRAN security capabilities. This happens via the MS Network Capability IE that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nEditor's NOTE: Pre-rel8 SGSN may not include the EPC/E-UTRAN security capabilities. In this case UE capabilities from the TAU Request are used.\nSGSN shall also transfer UE's EPC/E-UTRAN security capabilities to the new MME in the Context Response/SGSN Context Response message. MME shall select security algorithms and will indicate to UE by e.g. NAS SMC. If Active flag in the TAU request message is on (i.e. in case of UP ciphering was activated in UTRAN), MME shall derive KeNB based on K'ASME and NAS sequence number of Tracking area update Request message using the KDF as specified in Annex A. MME deliveries it to eNB by S1-AP message \n\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE 1: It is ffs, which algorithm from the mandatory supported algorithms is to be used by default for the TAU Request authentication.\nEditors NOTE 2: Adding TAU integrity protection does not implicate that NAS SMC need not be send.\nEditors NOTE 3: The ISR mechanism may have an effect on whether the TAU integrity protection solution with default algorithm is optimal or not.\nEditors NOTE 4: Need to specify how the NAS SNs are handled with default algorithm.\nUE uses the converted keys from the source system to protect the TAU Requestand include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\n\n\n\n\n\n\n\n9.2\tHandover\n9.2.1\tFrom E-UTRAN to UTRAN\nIf UP ciphering in E-UTRAN is activated, it shall remain activated after handover in UTRAN as well.\nIntegrity protection on NAS signalling is mandatory for both E-UTRAN and UTRAN\nMME shall derive a confidentiality key CK', and an integrity key IK' from KASME with the help of a one-way key derivation function KDF in the following way:\nCK||IK = KDF(KASME, S10). The KDF returns a 256-bit output, where the 128 most significant bits are identified with CK and the 128 least significant bits are identified with IK. S10 is the string where the input parameters are defined (see Annex A)\nThe E-UTRAN NAS Attach Request and TAU Request messages shall also include the UTRAN and GERAN security capabilities of UE. All UE capabilities are sent back to the UE in an integrity protected message for verification that they were not changed.\nEditor's Note: It should be studied in which messages the UE capabilities are sent back to the UE.\nMME shall transfer UE's UTRAN and GERAN security capabilities to SGSN. SGSN shall include the allowed security algorithms in the relocation request to RNC. RNC shall select the algorithms and include the corresponding identifiers in the relocation request acknowledgement. The selected algorithms shall be indicated to UE in the handover command message.\n9.2.2\tFrom UTRAN to E-UTRAN\n9.2.2.1\tProcedures\nIf UP ciphering in UTRAN is activated, then UP ciphering shall remain activated in E-UTRAN after handover as well.\nIntegrity protection on NAS is mandatory for both E-UTRAN and UTRAN\nSGSN shall transfer CK and IK to MME in the relocation request message. MME and UE shall derive K'ASME from CK and IK with the help of a one-way key derivation function as defined in Annex X.MME and UE shall derive the NAS keys and KeNB from K'ASME.\nSGSN shall be informed by the UE about its EPS security capabilities. This happens via the MS Network Capability IE, that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nSGSN transfers UE's EPC/E-UTRAN security capabilities to MME in the relocation request message. MME shall select the NAS security algorithms and include the allowed UP/RRC algorithms as well as the RRC and UP keys in the relocation request to the target eNB. eNB shall select the RRC and UP algorithms and indicate them in the relocation request acknowledgement. MME shall include the selected NAS, UP, and RRC algorithms in the relocation response sent to SGSN. SGSN shall include them in the relocation command and RNC shall indicate them to UE in the handover from UTRAN command.\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE 3: The issues raised by Editors NOTE's 1 to 4 of section 9.1.2 are also valid here. \nEditor's NOTE: In case the selected AS level algorithm on active mode handover is used to integrity protect the TAU Request creates problems in the MME (i.e. the MME does not know the selected AS algorithm), then the default algorithm solution as used in the idle mode mobility is used\nUE uses the converted keys from the source system to protect the TAU Request and include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\nIf EPS does not have the previous EPS security context for the UE indicated in the TAU Request, or if EPS does not activate the previous EPS security context indicated in the TAU Request, The newly generated keys or the previous EPS security context shall be taken into operation as soon as possible.\n9.2.2.2\tKey Derivation during Handover\nSGSN shall transfer CK and IK to MME in the relocation request message. MME and UE shall derive K'ASME from CK and IK with the help of a one-way key derivation function KDF as specified in Annex X. \nK'ASME = KDF(CK || IK) . MME and UE shall derive the NAS keys and KeNB from K'ASME.\nDuring UTRAN to E-UTRAN HO, MME sets NAS COUNT equal to zero and uses it with K'ASME (derived from CK and IK) to derive Kenb by applying the KDF defined in annex X for IDLE to CONNECTED transition. The MME distributes the KeNB to the eNB in the Handover Request message. The UE derives the KeNB in the same way the MME did.\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nEditor's Note: The following problems needs to be addressed at inter RAT handover:\n1. There must be a way to derive the K_eNB in the UE and in the MME before the handover request message is sent from the MME to the eNB. This can be solved by using setting NAS COUNT to zero in case the mapped EPS security context always provides a fresh K_ASME.\n2. When a cached EPS security context exists, and the UE moves from E-UTRAN to UTRAN, the CK/IK derived in UTRAN will always be the same as long as the K_ASME is the same (this is a problem for UTRAN). This, in turn results in that when the UE moves back into E-UTRAN the same mapped K_ASME would be used with a NAS COUNT of zero and hence the K_eNB as well as the NAS keys will be the same again (this is a problem for E-UTRAN).\n3. Key separation between different target eNBs when doing handover from UTRAN/GERAN to E-UTRAN is solved by using a cached EPS security context or by running an AKA in E-UTRAN as soon as possible after the handover and needs no further consideration.\n9.3\tRecommendations on AKA at IRAT-mobility to E-UTRAN\nAfter a handover from GERAN or UTRAN into E-UTRAN, it is strongly recommended to run an AKA and perform a key change on-the-fly of the entire key hierarchy as soon as possible after the handover if there is no cached security context in E-UTRAN.\nWhen a UE moves in IDLE mode from GERAN or UTRAN into E-UTRAN, it is strongly recommended to run an AKA if there is no cached security context in E-UTRAN, either after the TAU procedure that establishes NAS security context in the MME and UE, or when the UE transits into ECM-CONNECTED state. \n10\tSecurity interworking between E-UTRAN and GERAN\nEditor's Note: Any impacts in this section due the feature of per user activation of UP ciphering are for ffs and dependent on an agreement on this feature which is for ffs.\n10.1\tIdle mode mobility\n10.1.1\tFrom E-UTRAN to GERAN\nThe E-UTRAN NAS Attach Request and TAU Request messages shall also include the UTRAN and GERAN security capabilities of UE. All UE capabilities are sent back to the UE in the corresponding integrity protected response messages for verification that they were not changed.\nMME shall transfer UE's UTRAN and GERAN security capabilities and CK' and IK' to SGSN. SGSN shall select the encryption algorithm to use in GERAN when needed. \nIn idle mode mobility from E-UTRAN to GERAN, UE sends a RAU Request message towards SGSN and shall include a P-TMSI signature. The available P-TMSI signature field bits (at minimum 16 bits) shall be filled with a NAS-token (i.e. the x least significant bits of the KDF output). The key derivation function of NAS-token is specified in Annex A. \nSGSN forwards the P-TMSI signature to the old MME, which compares it with a NAS-token (truncation of most meaningful bits if needed), for the UE identified within the context request. If they match, the context request message is authenticated and authorized and MME will provide the needed information for the SGSN. Old MME responds with an appropriate error cause if it does not match the value stored in the old MME. This should initiate the security functions in the new SGSN.\nTo avoid possible race condition problems, the MME shall be able to compare the received NAS-token with NAS-tokens generated from the current NAS SN downlink value down to current NAS SN-L downlink values, i.e. [current NAS downlink SQN - L, current NAS downlink SQN]. A suitable value for the parameter L can be configured by the network operator. The default value for the parameter L is 5 and maximum value 10. MME shall not accept the same NAS-token for the same UE twice except in retransmission cases happening for the same mobility event.\n10.1.2\tFrom GERAN to E-UTRAN\nSGSN shall transfer CK || IK to MME in the Context Response/SGSN Context Response message. MME shall derive K'ASME from CK || IK as described in the UTRAN to E-UTRAN handover case.\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nSGSN shall be informed by the UE about its EPC/E-UTRAN security capabilities. This happens via the MS Network Capability IE, that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nEditor's NOTE: Pre-rel8 SGSN may not include the EPC/E-UTRAN security capabilities. In this case UE capabilities from the TAU Request are used.\nSGSN shall also transfer UE's EPC/E-UTRAN security capabilities to the MME in the Context Response/SGSN Context Response message. MME shall select security algorithms and will indicate to UE by e.g. NAS SMC. If Active flag in the TAU request message is on (i.e. in case of UP ciphering was activated in UTRAN), MME shall derive KeNB based on K'ASME and NAS sequence number of Tracking area update Request message using the KDF as specified in Annex A. MME delivers it to eNB by S1-AP message.\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE: The issues raised by Editors NOTE's 1 to 4 of section 9.1.2 are also valid here.\nUE uses the converted keys from the source system to protect the TAU Request and include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\n10.2\tHandover\n10.2.1\tFrom E-UTRAN to GERAN\nIf UP ciphering in E-UTRAN is activated, it shall remain activated after handover in GERAN as well. \nMME shall derive a confidentially key CK' and an integrity IK' from KASME as described for the E-UTRAN to UTRAN handover case. MME shall transfer CK' and IK' to the SGSN. SGSN shall derive Kc from CK' and IK' with the help of the key conversion function c3 of TS 33.102.\nEditor's Note: The assumption here is that an SGSN that supports E-UTRAN to GERAN handover is capable of the key conversion functions c3, c4, c5 of TS 33.102. If this assumption falls the key derivation and conversion described above may have to be adopted.\nThe E-UTRAN NAS Attach Request and TAU Request messages shall also include the UTRAN and GERAN security capabilities of UE. All UE capabilities are sent back to the UE in an integrity protected message for verification that they were not changed.\nEditor's Note: It should be studied in which messages the UE capabilities are sent back to the UE.\nMME shall transfer UE's UTRAN and GERAN security capabilities to SGSN. SGSN shall select the encryption algorithm to use in GERAN after handover. The selected algorithm shall be indicated to UE in the handover command message.\n10.2.2\tFrom GERAN to E-UTRAN\n10.2.2.1\tProcedures\nIf UP ciphering was activated in GERAN, it shall remain activated in E-UTRAN after handover from GERAN to E-UTRAN as well.\nSGSN shall be informed by the UE about its EPS security capabilities. This happens via the MS Network Capability IE, that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nSGSN transfers UE's EPC/E-UTRAN security capabilities to MME in the relocation request message. MME shall select the NAS security algorithms and include the allowed UP/RRC algorithms as well as the RRC and UP keys in the relocation request to the target eNB. eNB shall select the RRC and UP algorithms and indicate them in the relocation request acknowledgement. MME shall include the selected NAS, UP, and RRC algorithms in the relocation response sent to SGSN. SGSN shall indicate them in the appropriate message to BSS and BSS shall indicate them to UE in the handover command.\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE: The issues raised by Editors NOTE's 1 to 4 of section 9.1.2 are also valid here. \nEditor's NOTE: In case the selected AS level algorithm on active mode handover is used to integrity protect the TAU Request creates problems in the MME (i.e. the MME does not know the selected AS algorithm), then the default algorithm solution as used in the idle mode mobility is used\nUE uses the converted keys from the source system to protect the TAU Request and include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\nIf EPS does not have the previous EPS security context for the UE indicated in the TAU Request, or if EPS does not activate the previous EPS security context indicated in the TAU Request, The newly generated keys or the previous EPS security context shall be taken into operation as soon as possible.\n10.2.2.2\tKey Derivation during Handover\nSGSN shall transfer CK and IK to MME in the relocation request message. MME shall derive K'ASME from CK and IK as described in the UTRAN to E-UTRAN handover case.\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nDuring GERAN to E-UTRAN handover, the MME sets the NAS COUNT equal to zero and uses it with K'ASME (derived from CK and IK) to derive Kenb by applying the KDF defined in annex X for IDLE to CONNECTED transition. The MME distributes the KeNB to the eNB in the Handover Request message. The UE derives the KeNB in the same way the MME did.\nEditor's Note: The following problems needs to be addressed at inter RAT handover:\n1. There must be a way to derive the K_eNB in the UE and in the MME before the handover request message is sent from the MME to the eNB. This can be solved by using setting NAS COUNT to zero in case the mapped EPS security context always provides a fresh K_ASME.\n2. When a cached EPS security context exists, and the UE moves from E-UTRAN to GERAN, the CK/IK derived in GERAN will always be the same as long as the K_ASME is the same (this is a problem for GERAN). This, in turn results in that when the UE moves back into E-UTRAN the same mapped K_ASME would be used with a NAS COUNT of zero and hence the K_eNB as well as the NAS keys will be the same again (this is a problem for E-UTRAN).\n3. Key separation between different target eNBs when doing handover from UTRAN/GERAN to E-UTRAN is solved by using a cached EPS security context or by running an AKA in E-UTRAN as soon as possible after the handover and needs no further consideration.\n10.3\tRecommendations on AKA at IRAT-mobility to E-UTRAN\nSee recommendation provided by subclause 9.3\n\n====== END OF CHANGE 1 ==============\n===== START OF CHANGE 2 =============\nA.11\tKASME from and to CK, IK derivation (S10)\nThis input string is used when there is a need to derive a KASME from CK/IK and vice versa during mapping of security contexts between E-UTRAN and GERAN/UTRAN. KASME is a 256-bit entity, and so is the concatenation of CK and IK (which are 128 bits each). Therefore, the derivation function mapping 256 bits to 256 bits can be applied in both directions (using a constant in the input S to separate the directions from each other). The following input parameters shall be used.\n-\tFC = 0x11\n-\tP0 = key output type\n-\tL0 = length of key output type (i.e. 0x00 0x01)\nEditor's NOTE: It is FFS if more input parameters are required to counter the threat identified by ETSI/SAGE in the LS to SA3 received in SA3#28 (S3-030219).\nIf the KDF is used to derive a KASME from the concatenation CK || IK, then the key output type shall be 0x00. If the KDF is used to derive CK || IK from a KASME, then the key output type shall be 0x01.\n\n\n\n\n\n\n\n\n====== END OF CHANGE 2 ==============\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTo fix key freshness problem when using mapped security context during idle mode mobility towards E-UTRAN\n\n>>> SUMMARY OF CHANGE\nUse exchanged nonces to create fresh mapped K\u2019ASME\n\n>>> CONSEQUENCES IF NOT REVISED\nSecurity problem remains"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of 1st change\n7.2.3.1.2.6\tCalling party number\nThe SIP \"Privacy\" header is defined within IETF RFC 3323 [40]. The SIP \"P-Asserted-Identity\" header is defined in IETF RFC 3325 [41].\nTable 3: Mapping of SIP From/P-Asserted-Identity/Privacy headers to CLI parameters\nHas a \"P-Asserted-Identity\" header field (NOTE 2, NOTE 5, NOTE 6) been received?\tHas a \"From\" header field (NOTE 3) containing a URI that encodes an E.164 address been received (NOTE 6)?\tCalling Party Number parameter\tAddress signals\tCalling Party Number parameter \t APRI\tGeneric Number (additional calling party number) address signals\tGeneric Number parameter APRI\nNo\tNo\tNetwork option to either include a network provided E.164 number (See table 4) or omit the Address signals.\t(NOTE 4)\tNetwork option to set APRI to \"presentation restricted\" or \"presentation allowed\" \tAs a network option the APRI \"presentation restricted by network\" (NOTE 7) can be used instead of the APRI \"presentation restricted\"\tParameter not included\t\tNot applicable\nNo\tYes\tNetwork Option to either include a network provided E.164 number (See table 4) or omit the Address signals.\t(NOTE 4)\tNetwork option to set APRI to \"presentation restricted\" or \"presentation allowed\" \t(NOTE 4)\tAs a network option the APRI \"presentation restricted by network\" (NOTE 7) can be used instead of the APRI \"presentation restricted\u201d\"\tNetwork Option to either omit the parameter (if CgPN has been omitted) or derive from the \"From\" header\t(NOTE 1) \t(See table 6)\tAPRI = \"presentation restricted\" or \"presentation allowed\" depending on SIP Privacy header. \t(See table 6)\nYes\tNo\tDerive from \tP-Asserted-Identity\t(See table 5)\t\tAPRI = \"presentation restricted\" or \"presentation allowed\" depending on SIP Privacy header.\t(See table 5)\tNot included\tNot applicable\nYes\tYes\tDerived from \tP-Asserted-Identity\t(See table 5)\tAPRI = \"presentation restricted\" or \"presentation allowed\" depending on SIP Privacy header.\tNetwork Option to either omit the parameter or derive from the \"From\" header\n(NOTE 1)\t(See table 6)\tAPRI = \"presentation restricted\" or \"presentation allowed\" depending on SIP Privacy header.\t(see table 6)\nNOTE 1:\tThis mapping effectively gives the equivalent of Special Arrangement to all SIP UAC with access to the IMGCF.\tNOTE 2:\tIt is possible that the P-Asserted-Identity header field includes both a tel URI and a sip or sips URI. In this case, either the tel URI or the SIP URI with user=\u201dphone\u201d and a specific host portion, as selected by operator policy, may be used.\tNOTE 3:\tThe \"From\" header may contain an \"Anonymous User Identity\". An \"Anonymous User Identity\" includes information that does not point to the calling party. IETF RFC 3261 recommends that the display-name component contain \"Anonymous\". That the Anonymous User Identity will take the form defined in 3GPP TS 23.003 [74]. The Anonymous User Identity indicates that the calling party desired anonymity. The From header may also contain an Unavailable User Identity as defined in 3GPP TS 23.003 [74], that indicates that the calling party is unknown.\tNOTE 4: \tA national option exists to set the APRI to \"Address not available\".\tNOTE 5: \t3GPP TS 24.229 guarantees that the received number is an E.164 number formatted as an international number, with a \"+\" sign as prefix. \tNOTE 6: \tThe E.164 numbers considered within the present document are composed by a Country Code (CC), followed by a National Destination Code (NDC), followed by a Subscriber Number (SN). On the IMS side, the numbers are international public telecommunication numbers (\"CC\"+\"NDC\"+\"SN\") and are prefixed by a \"+\" sign. On the CS side, it is a network option to omit the CC.\tNOTE 7: \tThis is an ETSI specific value described within ETSI EN 300 356-1 [70].\n\nTable 4: Setting of the network-provided BICC/ISUP calling party number parameter with a CLI (network option)\nBICC/ISUP CgPN Parameter field\tValue\nScreening Indicator\t\"network provided\"\nNumber Incomplete Indicator\t\"complete\"\nNumber Plan Indicator\tISDN/Telephony (E.164)\nAddress Presentation Restricted Indicator\tPresentation allowed/restricted\tAs a network option the APRI value \"presentation restricted by network\" (NOTE) can be used instead of the APRI value \"presentation restricted\"\nNature of Address Indicator\tIf next BICC/ISUP node is located in the same country set to \"National (Significant) number\" else set to \"International number\"\nAddress signals\tIf NOA is \"national (significant) number\" no country code should be included. If NOA is \"international number\", then the country code of the network-provided number should be included. \nNOTE : \tThis is an ETSI specific value described within ETSI EN 300 356-1 [70]\n\nTable 5: Mapping of P-Asserted-Identity and privacy headers to the ISUP/BICC calling party number parameter\nSIP Component\tValue\tBICC/ISUP Parameter / field\tValue\nP-Asserted-Identity header field (NOTE 1)\t E.164 number\tCalling Party Number\n\t\tNumber incomplete indicator\t\"Complete\"\n\tNumbering Plan Indicator\t\"ISDN/Telephony (E.164)\"\n\tNature of Address Indicator\tIf CC encoded in the URI is equal to the CC of the country where MGCF is located AND the next BICC/ISUP node is located in the same country then\tset to \"national (significant) number\" \telse set to \"international number\"\n\tAddress Presentation Restricted Indicator (APRI)\tDepends on priv-value in Privacy header.\n\tScreening indicator \tNetwork Provided\nAddr-spec\t\t\"CC\" \"NDC\" \"SN\" from the URI\t\tAddress signal\tif NOA is \"national (significant) number\" then set to\t\"NDC\" + \"SN\" \tIf NOA is \"international number\" \tThen set to \"CC\"+\"NDC\"+\"SN\"\nPrivacy header field is not present\t\tAPRI\tPresentation allowed\nPrivacy header field\tpriv-value\tAPRI\t\"Address Presentation Restricted Indicator\"\npriv-value \t\t\"header\"\tAPRI \tPresentation restricted\n\t\"user\"\tAPRI\n\t\"none\" \tAPRI\tPresentation allowed\n\t\"id\" \tAPRI\tPresentation restricted\nNOTE 1:\tIt is possible that a P-Asserted \u2013Identity header field includes both a TEL URI and a SIP or SIPS URI. In this case, either the TEL URI or the SIP URI with user=\u201dphone\u201d and a specific host portion, as selected by operator policy, may be used. \n\nEnd of 1st change\n\n\n\n\n\n\n\n\n\n\nStart of 2nd change\n\n7.2.3.1.2.7\tGeneric number\nTable 6: Mapping of SIP from header field to BICC/ISUP generic number (additional calling party number) parameter (network option) \nSIP component\tValue\tBICC/ISUP parameter / field\tValue\nFrom header field\t\tname-addr or addr-spec \tGeneric Number\tNumber Qualifier Indicator\t\"Additional Calling Party number\"\n from-spec\t( name-addr / addr-spec) \n\tNature of Address Indicator\tIf CC encoded in the URI is equal to the CC of the country where MGCF is located AND the next BICC/ISUP node is located in the same country then\tSet to \"national (significant) number\" \tElse set to \"international number\"\n\tNumber incomplete indicator\t\"Complete\" \n\tNumbering Plan Indicator\t\"ISDN/Telephony (E.164)\"\n\tAPRI \n\tScreening indicator \t\"user provided not verified\"\nAddr-spec\t\t\"CC\" \"NDC\" + \"SN\" from the URI\t\tAddress signal\tif NOA is \"national (significant) number\" then set to\t\"NDC\" + \"SN\" \tIf NOA is \"international number\" \tThen set to \"CC\"+\"NDC\"+\"SN\"\n\n\n\n\n\nNOTE : \tThis an ETSI specific value described within ETSI EN 300 356-1 [70]\n\n\nEnd of 2nd change\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nA wrong usage of the Privacy header values is described in the current text. Indeed, the priv-value \u201cuser\u201d only impacts the From header (so, the Generic Number). The priv-value \u201cid\u201d and \u201cheader\u201d impact the P-Asserted-Identity header (so, the Calling Party Number) but NOT the From header according to RFC3323.The current text is not compliany with SIP standards (RFC 3323, RFC 3325)From RFC 3323:Privacy=user: If a privacy level of \u2019user\u2019 is requested, then the originating user has requested that privacy services perform the user-level privacy. User-level privacy could entail the modification of the From header, changing it from its original value to an anonymous value.From RFC 3325:Privacy=id: If this token is present, proxies MUST remove all the P-Asserted- Identity header fields before forwarding messages to elements that are not trusted.From RFC 5379 (Guidelines for Using the Privacy Mechanism for SIP)From 24.607:If only the PAssertedIdentity needs to be restricted the originating UE shall include a Privacy header field set to \"id\" in accordance with RFC\u00a03323\u00a0[6], and RFC\u00a03325\u00a0[7].[\u2026] Additionally, based on operator policy, the AS shall either modify the From header field to remove the identification information, or add a Privacy header field set to \"user\".From 24.608:If no P-AssertedIdentity header fields are present, but a Privacy header field set to \"id\" was present, then the network-provided identity information was withheld due to presentation restriction.Thus, value \u201cid\u201d is for PAI, value \u201cuser\u201d is for From and value \u201cheader\u201d impacts the PAI but not the From header.\n\n>>> SUMMARY OF CHANGE\nSection 7.2.3.1.2.6 is modified to correct the Privacy mapping for the Calling party number parameter.Section 7.2.3.1.2.7 is modified to add the Privacy mapping for the Generic Number parameter.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe Generic number presentation is restricted if privacy is requested for P-Asserted-Identity header.The Calling party number presentation is restricted if privacy is requested for From header."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n4.1.1.6\tSpecific requirements for MS configured to use timer T3245\nThe following requirement applies for an MS that is configured to use timer\u00a0T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[135] or 3GPP\u00a0TS\u00a031.102\u00a0[112]):\nWhen the MS adds a PLMN identity to the \"forbidden PLMN list\" or the \"forbidden PLMNs for GPRS service\" list or sets the SIM/USIM as invalid for non-GPRS services or GPRS services or both, and timer T3245 is not running, the MS shall start timer T3245 with a random value, uniformly drawn from the range between 24h and 48h.\nUpon expiry of the timer T3245, the MS shall erase the \"forbidden PLMN list\" and the \"forbidden PLMNs for GPRS service\" list and set the SIM/USIM to valid for non-GPRS services and GPRS services. When the lists are erased, the MS performs a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nIf the MS is switched off when the timer T3245 is running, the MS shall behave as follows when the MS is switched on and the SIM/USIM in the MS remains the same:\n-\tlet t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the MS will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1.\n\n***** Next change *****\n\n4.1.1.7\tHandling of NAS level mobility management congestion control \nThe network may detect GMM or MM signalling congestion and perform NAS level mobility management congestion control. PS domain NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control. CS domain NAS level mobility management congestion control consists of general NAS level mobility management congestion control.\nUnder NAS level mobility management congestion control the network may reject mobility management signalling requests from MSs as specified in 3GPP\u00a0TS\u00a023.060\u00a0[74]. The network should not reject requests for emergency bearer services.\nWhen subscribed APN based congestion control is active for a particular APN, the network may reject attach request from MSs with subscription to this APN.\nIn mobility management the network may detect NAS signalling congestion. The network may start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:\n-\trate of mobility management NAS messages from a group of MSs with a subscription to a particular APN exceeds or falls below certain thresholds; or\n-\tsetting in network management.\nWhen the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3246 or T3346 in the reject messages. The MS starts the mobility management back-off timer with the value received in the mobility management reject messages. To avoid that large numbers of MSs simultaneously initiate deferred requests, the network should select the value for the mobility management back-off timer for the rejected MSs so that timeouts are not synchronised.\nFor subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.\nIf the MS is switched off when the timer T3246 or T3346 is running, the MS shall behave as follows for each running timer when the MS is switched on and the SIM/USIM in the MS remains the same:\n-\tlet t1 be the time remaining until timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than\u00a0t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", then if timer T3346 is restarted at switch on, the MS configured for low priority shall handle mobility management requests as indicated in subclauses\u00a04.7.3.1.5, 4.7.5.1.5 and\u00a04.7.13.5.\nIf the MS enters a new PLMN while timer T3246 is running, and the new PLMN is not equivalent to the PLMN where the MS started timer T3246, the MS shall stop timer T3246 when initiating mobility management procedures in the new PLMN.\nIf the MS enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the MS started timer T3346, the MS shall stop timer T3346 when initiating mobility management procedures in the new PLMN.\n\nAt an inter-system change from S1\u00a0mode to A/Gb mode or from Iu mode to A/Gb mode within the same RA, if the timer T3346 is running and the TIN indicates \"RATrelated TMSI\", the MS shall set the GPRS update status to GU2 NOT UPDATED and enter state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\n***** Next change *****\n6.1.3.1.3.2\tHandling of network rejection due to SM cause #26\nIf the SM cause value is #26 \"insufficient resources\" and the Back-off timer value IE is included, the MS shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the MS is configured for dual priority, exceptions are specified in subclause\u00a06.1.3.12):\ni)\tif the timer value indicates neither zero nor deactivated, the MS shall stop timer T3396 associated with the corresponding APN, if it is running. The MS shall then start timer T3396 with the value provided in the Back-off timer value IE and:\n-\tshall not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN that was sent by the MS, until timer T3396 expires or timer T3396 is stopped; and\n-\tshall not send another ACTIVATE PDP CONTEXT REQUEST message without an APN if the APN was not included in the ACTIVATE PDP CONTEXT REQUEST message, until timer T3396 expires.\n\tThe MS shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the MS:\n-\tshall not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN that was sent by the MS, until the MS is switched off or the SIM/USIM is removed or the MS receives a REQUEST PDP CONTEXT ACTIVATION or REQUEST SECONDARY PDP CONTEXT ACTIVATION or MODIFY PDP CONTEXT REQUEST message with the same APN from the network; and\n-\tshall not send another ACTIVATE PDP CONTEXT REQUEST message without an APN if the APN was not included in the ACTIVATE PDP CONTEXT REQUEST message, until the MS is switched off or the SIM/USIM is removed.\n\tThe timer T3396 remains deactivated upon a PLMN change or inter-system change; and\niii)\tif the timer value indicates that this timer is zero, the MS may send an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN;\nIf the Back-off timer value IE is not included, then the MS may send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\nThe MS may access the network with access class 11 \u2013 15 or initiate a PDP context activation procedure for emergency bearer services even if the timer T3396 is running.\nIf the MS is switched off when the timer T3396 is running, and if the SIM/USIM in the MS remains the same when the MS is switched on, the MS shall behave as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3396 was running because an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST, MODIFY PDP CONTEXT REQUEST or ACTIVATE MBMS CONTEXT REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the MS configured for dual priority shall handle session management requests as indicated in subclause\u00a06.1.3.12.\n\n\n***** Next change *****\n6.1.3.2.2.2\tHandling of network rejection due to SM cause #26\nIf the SM cause value is #26 \"insufficient resources\" and the Back-off timer value IE is included, the MS shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the MS is configured for dual priority, exceptions are specified in subclause\u00a06.1.3.12):\ni)\tif the timer value indicates neither zero nor deactivated, the MS shall stop timer T3396 associated with the corresponding APN, if it is running. The MS shall then start timer T3396 with the value provided in the Back-off timer value IE and not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. The MS shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the MS shall not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until the MS is switched off or the SIM/USIM is removed or the MS receives a REQUEST PDP CONTEXT ACTIVATION or REQUEST SECONDARY PDP CONTEXT ACTIVATION or MODIFY PDP CONTEXT REQUEST message for the same APN from the network. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or\niii)\tif the timer value indicates that this timer is zero, the MS may send an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\nIf the Back-off timer value IE is not included, the MS may send an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\nIf the MS is switched off when the timer T3396 is running, and if the SIM/USIM in the MS remains the same when the MS is switched on, the MS behaves as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3396 was running because an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST, MODIFY PDP CONTEXT REQUEST or ACTIVATE MBMS CONTEXT REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the MS configured for dual priority shall handle session management requests as indicated in subclause\u00a06.1.3.12.\n\n***** Next change *****\n6.1.3.3.3.2\tHandling of network rejection due to SM cause #26\nIf the SM cause value is #26 and the Back-off timer value IE is included, the MS shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the MS is configured for dual priority, exceptions are specified in subclause\u00a06.1.3.12):\ni)\tif the timer value indicates neither zero nor deactivated, the MS shall stop timer T3396 associated with the corresponding APN, if it is running. The MS shall then start timer T3396 with the value provided in the Back-off timer value IE and not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. The MS shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the MS shall not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until the MS is switched off or the SIM/USIM is removed or the MS receives REQUEST PDP CONTEXT ACTIVATION or REQUEST SECONDARY PDP CONTEXT ACTIVATION or MODIFY PDP CONTEXT REQUEST message for the same APN from the network. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or\niii)\tif the timer value indicates that this timer is zero, the MS may send an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\nIf the Back-off timer value IE is not included, the MS may send an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\nIf the MS is switched off when the timer T3396 is running, and if the SIM/USIM in the MS remains the same when the MS is switched on, the MS behaves as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3396 was running because an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST, MODIFY PDP CONTEXT REQUEST or ACTIVATE MBMS CONTEXT REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the MS configured for dual priority shall handle session management requests as indicated in subclause\u00a06.1.3.12.\n\n***** Next change *****\n6.1.3.4.2\tPDP context deactivation initiated by the network\nIn order to deactivate a PDP context, the network sends a DEACTIVATE PDP CONTEXT REQUEST message to the MS and starts timer T3395. The message contains the transaction identifier in use for the PDP context to be deactivated and a cause code that typically indicates one of the following causes:\n# 8:\tOperator Determined Barring;\n# 25:\tLLC or SNDCP failure (A/Gb mode only);\n# 26:\tinsufficient resources;\n# 36:\tregular deactivation;\n# 38:\tnetwork failure; or\n# 39:\treactivation requested.\n#112:\tAPN restriction value incompatible with active PDP context.\nThe MS shall, upon receipt of this message, reply with a DEACTIVATE PDP CONTEXT ACCEPT message. Upon receipt of the DEACTIVATE PDP CONTEXT ACCEPT message, the network shall stop the timer T3395.\nIf the DEACTIVATE PDP CONTEXT REQUEST message includes the cause #39 \"reactivation requested\" and the PDP context was activated by the MS, the MS should stop timer T3396 if it is running for the APN associated with the PDP context, and re-activate the PDP context. Additionally, the MS should re-activate the PDP contexts that were originally activated by the MS and released by the network as a result of this PDP context deactivation procedure. \nNOTE:\tUser interaction is necessary in some cases when the MS cannot re-activate the PDP context(s) automatically.\nIf a detach is requested by the HLR for an MS that has PDP contexts for emergency services, the SGSN shall send a DEACTIVATE PDP CONTEXT REQUEST message to the MS for all the PDP contexts that are not PDP contexts for emergency services.\nIf the network operates in network operation mode I, ISR is activated and the MS has indicated support of EMM combined procedures in MS network capability, when the SGSN receives the request from the Serving GW for deactivating the last remaining PDP context, then the SGSN shall perform a detach procedure for non-GPRS services only as described in subclause\u00a04.7.4.2.\nIn A/Gb mode, both the MS and the network shall initiate local release of the logical link if it is not used by another PDP context.\nIn Iu mode, the network shall initiate the release of Radio Access Bearer associated with this PDP context.\nIf the SM cause value is #26 \"insufficient resources\", the network may include a value for timer T3396 in the DEACTIVATE PDP CONTEXT REQUEST message.\nIf the SM cause value is #26 \"insufficient resources\" and T3396 value IE is included:\n-\tthe MS shall take different actions depending on the timer value received for timer T3396 (if the MS is configured for dual priority, exceptions are specified in subclause\u00a06.1.3.12):\ni)\tif the timer value indicates neither zero nor deactivated, the MS shall stop the timer T3396 if it is running. The MS shall start timer T3396 with received value and not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until timer T3396 expires, the timer T3396 is stopped, the MS is switched off or the SIM/USIM is removed;\nii)\tif the timer value indicates that this timer is deactivated, the MS shall not send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN until the MS is switched off or the SIM/USIM is removed or the MS receives request PDP CONTEXT ACTIVATION message for the same APN from the network; and\niii)\tif the timer value indicates that this timer is zero, the MS may send another ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message for the same APN.\n-\tif the MS is switched off when the timer T3396 is running, the MS shall behave as follows when the MS is switched on and the SIM/USIM in the MS remains the same:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3396 was running because an ACTIVATE PDP CONTEXT REQUEST, ACTIVATE SECONDARY PDP CONTEXT REQUEST or MODIFY PDP CONTEXT REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the MS configured for dual priority shall handle session management requests as indicated in subclause\u00a06.1.3.12.\nIf the T3396 value IE is not included, the MS shall proceed with deactivation procedure and then send DEACTIVATE PDP CONTEXT ACCEPT message.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n/******************************** First Change **********************************/Mobility Management back off timer (T3246,T3346,T3245) and Session mamangement back off timer (T3396) are related an IMSI (user subscriptions).These timers are stopped if the IMSI in the device is changed e.g. user changes different UICC/SIM, IMSI is changed inEFimsi or different USIM is selected.In the subclauses the timers T3246, T3245, T3346 and T3396 are started after power off and power on, when the SIM/USIM is same. For the reason given above, it is more clear to mention that IMSI is same only then the timer is started.There can be case when the device is powered off and a user removes UICC/SIM put it in different MS and use STK application to change the EFimsi of the SIM/USIM using STK application ( Please refer subclause 6.4.7.1 of TS 31.111) and when the user put the SIM/UICC back in the MS. In this case  when the MS is powered on the timer will be started although the IMSI of SIM/USIM is changed and back off timer shouldn\u2019t be applicable to this IMSI. The user will not be able to get service for different IMSI./******************************** Second Change ******************************/Handling of back off timer T3246, T3346 and T3396 is not defined when the MS performs detach procedure while the device is powered on. When the MS performs detach procedure (local detach or explicit detach) while the MS is powered,the back off timers T3246, T3346 and T3396 should be running untill it expires.  The MS performs detach procedure while the device is powered on in following cases.UICC is removed from the MS.GPRS capability is disabled.Flight mode on (in smart phone)\n\n>>> SUMMARY OF CHANGE\n/*************************** First Change ************************************/specify in subclauses that the timers T3245, T3246, T3346 and T3396 are evalauted and started if IMSI is same in the MS./*************************** Second Change ********************************/Specify that the timers T3246, T3346 and T3396 will be running when the MS performs detach procedure (enteres GMM_DEREGISTERED state) while the device is powered on untill the timer expires or IMS is changed in the MS.\n\n>>> CONSEQUENCES IF NOT REVISED\n/**************************** First Change ***********************************/Condition to evaluate and start the timers T3246, T3346 and T3396 after a MS is powered on may not be clear and this may lead to loss of service to the user when back off timer is kept running for different IMSI./****************************** Second Change ********************************/UE behavior will not be defined which may lead to different implementation.If the back off timers are stopped, then the MS will perform attach procedure when the user starts PS service which may create signalling in the network and which will further create congestion in the network."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * Change * * * *\nAnnex C (normative):\nStorage of EMM information\nThe following EMM parameters shall be stored on the USIM if the corresponding file is present:\n-\tGUTI;\n-\tlast visited registered TAI;\n-\tEPS update status;\n-\tAllowed CSG list;\n-\tOperator CSG list; and\n-\tEPS security context parameters from a full native EPS security context (see 3GPP\u00a0TS\u00a033.401\u00a0[19]).\nThe presence and format of corresponding files on the USIM is specified in 3GPP\u00a0TS\u00a031.102\u00a0[17].\nIf the corresponding file is not present on the USIM, these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. The allowed CSG list is stored in a non-volatile memory in the ME if the UE supports CSG selection. These EMM parameters can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; else the UE shall delete the EMM parameters.\nThe following EMM parameter shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM:\n-\tTIN.\nThis EMM parameter can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the EMM parameter.\nIf the UE is attached for emergency bearer services, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is detached.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen TS 33.401 says:\u201c15.2.2Unauthenticated emergency calls15.2.2.1General[\u2026]If the ME receives a NAS SMC selecting EIA0 (NULL integrity) for integrity protection, and EEA0 (NULL ciphering) for encryption protection, then:- the ME shall mark any stored native EPS NAS security context on the USIM /non-volatile ME memory as invalid; and - the ME shall not update the USIM/non-volatile ME memory with the current EPS NAS security context. \u201d, it does not say that if when a native EPS security context is used for a UE attached for emergency bearer services (use case \u201cOnly UEs that are authenticated are allowed\u201d in TS 23.401 s4.3.12.1), this context can not be stored.Storing this context can be useful whenever the UE moves again to this tracking area and so setting up again the security can be avoided prior to establishing an emergency call in this area.\n\n>>> SUMMARY OF CHANGE\nStore the native EPS security context for UE attached for emergency bearer services when non NULL algos are used.\n\n>>> CONSEQUENCES IF NOT REVISED\nNew authentication whenever a UE attached for emergency bearer services previously authenticated, reconnects to the same network again."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TS\u00a023.122: \"Non-Access-Stratum functions related to Mobile Station (MS) in idle mode\".\n[1A]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[1B]\t3GPP\u00a0TS\u00a023.002: \"Network architecture\".\n[2]\t3GPP\u00a0TS\u00a023.234: \"3GPP system to Wireless Local Area Network (WLAN) interworking; System description\".\n[3]\t3GPP\u00a0TS\u00a029.234: \"3GPP system to Wireless Local Area Network (WLAN) interworking; Stage\u00a03\".\n[3A]\t3GPP\u00a0TS\u00a029.161: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services with Wireless Local Area Network (WLAN) Access and Packet Data Networks (PDN)\".\n[4]\tVoid\n[5]\t3GPP\u00a0TS\u00a033.234: \"3G security; Wireless Local Area Network (WLAN) interworking security\".\n[6]\tIETF\u00a0RFC\u00a03748 (June\u00a02004): \"Extensible Authentication Protocol (EAP)\".\n[7]\tIETF\u00a0RFC\u00a01035 (November\u00a01987): \"Domain names - implementation and specification\".\n[8]\tVoid\n[9]\tIETF\u00a0RFC\u00a04187 (January\u00a02006): \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP AKA)\".\n[10]\tIETF\u00a0RFC\u00a04186 (January\u00a02006): \"Extensible Authentication Protocol Method for GSM Subscriber Identity Modules (EAP-SIM)\".\n[11]\tIEEE\u00a0Std\u00a0802.11 (1999): \"Standard for Information Technology - Telecommunications and information exchange between systems - Local and Metropolitan Area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) specifications\".\n[12]\tIETF\u00a0RFC\u00a04284 (January\u00a02006): \"Identity selection hints for Extensible Authentication Protocol (EAP)\".\n[13]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the USIM application\".\n[14]\tIETF\u00a0RFC\u00a04306 (December 2005): \"Internet Key Exchange (IKEv2) Protocol\".\n[15]\tIETF\u00a0RFC\u00a04303 (December 2005): \"IP Encapsulating Security Payload (ESP)\".\n[16]\tIETF\u00a0RFC\u00a04739 (November 2006): \"Multiple Authentication Exchanges in  the Internet Key Exchange (IKEv2) Protocol\".\n[17]\tIETF\u00a0RFC\u00a03629 (November 2003): \"UTF-8, a transformation format of ISO 10646\".\n[18]\tIETF\u00a0RFC\u00a02474 (December 1998): \"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers\".\n[19]\tIETF\u00a0RFC\u00a02475 (December 1998): \"An Architecture for Differentiated Services\".\n[20]\t3GPP\u00a0TS\u00a023.107: \"Quality of Service (QoS) concept and architecture\".\n[21]\tGSMA\u00a0PRD\u00a0IR 34: \"Inter-PLMN Backbone Guidelines\".\n[22]\t3GPP\u00a0TS\u00a031.111: \"Universal Subscriber Identity Module (USIM), Application Toolkit (USAT)\". \n[23]\tIEEE\u00a0P802.11u\u2122/D11.0 (July 2010): \"Draft STANDARD for Information Technology-Telecommunications and information exchange between systems-Local and metropolitan area networks-Specific requirements Part II: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) specifications: Amendment 7: Interworking with External Networks\".\nEditor's note:\tThe above document cannot be formally referenced until it is published by IEEE\n[24]\tOMA-DDS-DM_ConnMO_WLAN-V1_0-20081024-A: \"Standardized Connectivity Management Objects WLAN Parameters\", Approved Version 1.0 \u2013 24 Oct 2008.\n[25]\t3GPP\u00a0TS\u00a024.312: \"Access Network Discovery and Selection Function (ANDSF) Management Object (MO)\".\n\n3\tDefinitions, symbols and abbreviations\n3.1\tDefinitions\nFor the purposes of the present document, the following terms and definitions apply:\nactive scanning: capability of a WLAN UE to actively solicit support for a WLAN Specific Identifier (WSID) by for probing it\nassociated WSID: WSID that the WLAN UE uses for association with a WLAN AP.\navailable WSID: WSID that the WLAN UE has found after scanning.\nEAP AKA: EAP mechanism for authentication and session key distribution using the UMTS AKA authentication mechanism using the Universal Subscriber Identity Module (USIM) (see IETF\u00a0RFC\u00a04187\u00a0[9]).\nEAP SIM: EAP mechanism for authentication and session key distribution using the GSM Subscriber Identity Module (SIM) (see IETF\u00a0RFC\u00a04186\u00a0[10]).\nExternal AAA Server: The External AAA Server is located in an external packet data network. The PDG interworks with the External AAA Server via the Wi reference point that is described in 3GPP\u00a0TS\u00a029.161\u00a0[3A].\nHome PLMN (HPLMN): the home PLMN of the user.\npassive scanning: capability of a WLAN UE to look for the support for a specific WSID by listening to the WSIDs broadcast in the beacon signal.\nPublic Land Mobile Network (PLMN) selection: procedure for the selection of a PLMN, via a WLAN, either manually or automatically.\nselected WSID: this is the WSID that has been selected according to subclause\u00a05.1, either manually or automatically.\nselected PLMN: this is the PLMN that has been selected according to subclause\u00a05.2, either manually or automatically.\nsupported PLMN: a PLMN of a roaming partner (i.e. to which the WLAN operator has a direct roaming relationship).\nswitch on: action of activating a WLAN UE client.\nswitch off: action of deactivating a WLAN UE client.\nWLAN specific identifier (WSID): identifier for the WLAN.\nFor WLANs compliant with IEEE\u00a0802.11\u00a0[11] this is the SSID.\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.002\u00a0[1B] apply:\nWLAN UE\n3GPP AAA proxy\n3GPP AAA server\nPacket Data Gateway (PDG)\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.234\u00a0[2] apply:\n3GPP - WLAN Interworking (WLAN-3GPP IW) \nInterworking WLAN\nW-APN\nWLAN Roaming\n\n\nFor the purposes of the present document, the following terms and definitions given in IETF\u00a0RFC\u00a04284\u00a0[12] apply:\nDecorated NAI\nRoot NAI\n3.2\tSymbols\nFor the purposes of the present document, the following symbols apply:\nWa\tReference point between a WLAN and a 3GPP AAA Server/Proxy (control signalling)\nWd\tReference point between a 3GPP AAA Server and 3GPP AAA Proxy (control signalling)\nWu\tReference point between a WLAN UE and a PDG\n3.3\tAbbreviations\nFor the purposes of the present document, the following abbreviations apply:\nAAA\tAuthentication, Authorization and Accounting \nAKA\tAuthentication and Key Agreement\nANDSF\tAccess Network Discovery and Selection Function\nANQP\tAccess Network Query Protocol\nAPN\tAccess Point Name\nDNS\tDomain Name System\nEAP\tExtensible Authentication Protocol\nESP\tEncapsulating Security Payload\nFQDN\tFully Qualified Domain Name\n\nHLR\tHome Location Register\nHPLMN\tHome PLMN\nHSS\tHome Subscriber Server\nI-WLAN\tInterworking \u2013 WLAN\nIKE\tInternet Key Exchange\nIPsec\tIP security\nNAI\tNetwork Access Identifier\nNI\tNetwork Identifier\nOI\tOperator Identifier\nPDG\tPacket Data Gateway\nPLMN\tPublic Land Mobile Network\nSIM\tSubscriber Identity Module\nSSID\tService Set ID\nUE\tUser Equipment\nUICC\tUniversal Integrated Circuit Card\nUSIM\tUniversal Subscriber Identity Module\nW-APN\tWLAN - APN\nWLAN\tWireless Local Area Network\nWSID\tWLAN Specific Identifier\nNEXT CHANGE\n \n7.6b\tHome I-WLAN Specific Identifier List\nThe \"Home I-WLAN Specific Identifier List\" file contains a list of WSIDs related to I-WLANs that have a direct relationship with the HPLMN.  It shall be possible to store at least ten entries on the list. The contents of this file are specified in 3GPP\u00a0TS\u00a031.102\u00a0[13]. When stored in the ME, the contents of this file may as an implementation option be specified in OMA-DDS-DM_ConnMO_WLAN-V1_0-20081024-A\u00a0[24] referenced in the AccessNetworkInformationRef leaf of the ANDSF Management Object given in 3GPP\u00a0TS\u00a024.312\u00a0[25].\n \n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt was pointed out in CT1#72 that ANDSF MO identified in section 7.6b is not clear.  In release 9 the V-ANDSF was introduced and the text does not distinguish if the UE should use the V-ANDSF information or H-ANDSF.\n\n>>> SUMMARY OF CHANGE\nAdding necessary reference and definition to support new text that clarifies that H-ANDSF information should only be used.\n\n>>> CONSEQUENCES IF NOT REVISED\nVPLMN\u2019s can fraudulenty set policy in the UE to select their preferred access network instead of the HPLMN\u2019s"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***********************Start of the first change************************\n7.2.1\tAuthentication for Untrusted non-3GPP Access\nThis clause specifies how a UE is authenticated to 5G network via an untrusted non-3GPP access network. It uses a vendor-specific EAP method called \"EAP-5G\", utilizing the \"Expanded\" EAP type and the existing 3GPP Vendor-Id, registered with IANA under the SMI Private Enterprise Code registry. The \"EAP-5G\" method is used between the UE and the N3IWF and is utilized for encapsulating NAS messages. If the UE needs to be authenticated by the 3GPP home network, any of the authentication methods as described in clause 6.1.3 can be used. The method is executed between the UE and AUSF as shown below. \nWhen possible, the UE shall be authenticated by reusing the existing UE NAS security context in AMF.\n\nFigure 7.2.1-1: Authentication for untrusted non-3GPP access\n1.\tThe UE connects to an untrusted non-3GPP access network with procedures outside the scope of 3GPP. When the UE decides to attach to 5GC network, the UE selects an N3IWF in a 5G PLMN, as described in TS 23.501 [2] clause 6.3.6.\n2.\tThe UE proceeds with the establishment of an IPsec Security Association (SA) with the selected N3IWF by initiating an IKE initial exchange according to RFC 7296 [25]. After step 2 all subsequent IKE messages are encrypted and integrity protected by using the IKE SA established in this step.\n3.\tThe UE shall initiate an IKE_AUTH exchange by sending an IKE_AUTH request message. The AUTH payload is not included in the IKE_AUTH request message, which indicates that the IKE_AUTH exchange shall use EAP signalling (in this case EAP-5G signalling). The UE shall set the UE Id field in this message equal to any random number. The UE shall not use its GUTI/SUCI/SUPI as the Id in this step. \n4.\tThe N3IWF responds with an IKE_AUTH response message which includes an EAP-Request/5G-Start packet. The EAP-Request/5G-Start packet informs the UE to initiate an EAP-5G session, i.e. to start sending NAS messages encapsulated within EAP-5G packets.\n5.\tThe UE shall validate the N3IWF certificate and shall confirm that the N3IWF identity matches the N3IWF selected by the UE. An absence of the certificate from the N3IWF or unsuccessful identity confirmation shall result in a connection failure. The UE shall send an IKE_AUTH request which includes an EAP-Response/5G-NAS packet that contains a Registration Request message containing UE security capabilities and the SUCI. The N3IWF shall refrain from sending an EAP-Identity request. The UE may ignore an EAP Identity request or respond with the SUCI it sent in the Registration Request.\nNOTE: \tThe N3IWF does not send an EAP-Identity request because the UE includes its identity in the IKE_AUTH request in message 5. This is in line with RFC 7296 [25], clause 3.16. \n6.\tThe N3IWF shall select an AMF as specified in TS 23.501 [2], clause 6.5.3. The N3IWF forwards the Registration Request received from the UE to the AMF.\n7.\tIf the AMF decides to authenticate the UE, it shall use one of the methods from clause 6.1.3. In this case, the AMF shall send a key request to the AUSF. The AUSF may initiate an authentication procedure as specified in clause 6.1.3. Between AMF and UE, the authentication packets are encapsulated within NAS authentication messages and the NAS authentication messages are encapsulated within EAP-5G/5G-NAS packets. \nIn the final authentication message from the home network, the AUSF shall send the anchor key KSEAF derived from KAUSF to the SEAF. The SEAF shall derive the KAMF from KSEAF and send it to the AMF which is used by the AMF to derive NAS security keys. If EAP-AKA' is used for authentication as described in clause 6.1.3.1, then the AUSF shall include the EAP-Success. The UE also derives the anchor key KSEAF and from that key it derives the KAMF followed by NAS security keys. \n8.\tThe AMF shall send a Security Mode Command (SMC) to the UE in order to activate NAS security. This message is first sent to N3IWF (within an N2 message) together with the N3IWF key (KN3IWF). If EAP-AKA' is used for authentication, the AMF shall encapsulate the EAP-Success received from AUSF within the SMC message. \n9.\tThe N3IWF shall forward the NAS SMC to UE within an EAP-Request/5G-NAS packet.\n10.\tThe UE completes the authentication (if initiated in step 7) and creates a NAS security context. UE shall respond to the NAS SMC it received from the AMF based on the selected algorithms and parameters as described in clause 6.7.2. The UE shall encapsulate the NAS SMC Complete in the EAP-5G Response.\n11. The N3IWF shall forward the NAS packet containg NAS SMC Complete to the AMF over the N2 interface.\n12. The AMF upon reception of the NAS SMC Complete from the UE, initiates the NGAP procedure to set up the AN context. AMF shall compute the N3IWF key, KN3IWF, for the establishment of the IPsec SA between the UE and the N3IWF and shall include it in the NGAP Initial Context Setup Request sent to the N3IWF. \n13. N3IWF sends an EAP-Success/EAP-5G to the UE upon reception of the NGAP Initial Context Setup Request containing the N3IWF key, KN3IWF. This completes the EAP-5G session and no further EAP-5G packets are exchanged. If the N3IWF does not receive the N3IWF key from AMF, the N3IWF shall respond with an EAP-Failure\n14.\tThe IPsec SA is established between the UE and N3IWF by using the common N3IWF key KN3IWF that was created in the UE and was received by N3IWF from the AMF in step 9.\n15. Upon successful establishment of the IPsec SA between the UE and the N3IWF, the N3IWF shall send the NGAP Initial Context Setup Response message to the AMF.\n16. When NGAP Initial Context Setup Response for the UE is received by the AMF, AMF shall send the NAS Registration Accept message for the UE over the N2 towards the N3IWF.\n17. Upon receiving the NAS Registration Accept message from the AMF, the N3IWF shall forward it to the UE over the established IPsec SA. All further NAS messages between the UE and the N3IWF shall be sent over the established IPsec SA. \nEditor\u2019s Note: Steps 16 and 17 above are pending discussion in SA2\n\n***********************End of the first change***************************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current authentication procedure of the untrusted non-3GPP access, KN3IWF is sent twice from AMF to N3IWF through step 8 and 12. However, the KN3IWF is used to complete the authentication and IPsec SA establishment between the UE and the N3IWF. The KN3IWF is not required to be used in the NAS SMC procedure initiated by the AMF(step 8 and 9). Therefore, it is not necessary to send the KN3IWF to the N3IWF in the step 8 of Figure 7.2.1-1, and the KN3IWF used in step 14 was actually delivered to N3IWF through step 12.\n\n>>> SUMMARY OF CHANGE\nDelete the content in step 8 about AMF deliver KN3IWF to N3IWF and correct the step of KN3IWF delivery in step 14.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe KN3IWF is sent twice in the authentication procedure."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TR\u00a021.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP\u00a0TS\u00a023.303: \"Proximity based Services; Stage 2\".\n[3]\tIETF\u00a0RFC\u00a03588: \"Diameter Base Protocol\".\n[4]\t3GPP\u00a0TS\u00a033.210: \"3G Security; Network Domain Security; IP Network Layer Security\".\n[5]\tIETF\u00a0RFC\u00a04960: \"Stream Control Transmission Protocol\".\n[6]\t3GPP\u00a0TS\u00a029.229: \"Cx and Dx interfaces based on the Diameter protocol\".\n[7]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[8]\tIETF\u00a0RFC\u00a05234: \"Augmented BNF for Syntax Specifications: ABNF\".\n[9]\t3GPP\u00a0TS\u00a029.228: \"IP multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and Message Elements\".\n[10]\t3GPP\u00a0TS\u00a029.272: \"Evolved Packet System; MME and SGSN Related Interfaces Based on Diameter Protocol\".\n[11]\t3GPP\u00a0TS\u00a023.007: \"Restoration procedures\".\n[12]\t3GPP\u00a0TS\u00a029.329: \"Sh Interface based on the Diameter protocol\".\n[13]\tvoid\n[14]\t3GPP\u00a0TS\u00a029.173: \"Location Services (LCS); Diameter-based SLh interface for Control Plane LCS\".\n[15]\tIETF\u00a0draft-ietf-dime-ovli-04: \"Diameter Overload Indication Conveyance\".\nEditor's note:\tThe above document cannot be formally referenced until it is published as an RFC.\n[16]\t3GPP\u00a0TS\u00a024.334: \"Proximity-services (ProSe) User Equipment (UE) to ProSe function protocol aspects; Stage 3\".\n[17]\t3GPP\u00a0TS\u00a024.333: \"Proximity-services (ProSe) Management Objects (MO); Stage 3\".\n\n\n\n\n* * * Next Change * * * *\n\n\n\n\n\nRequest\n\n\nAuthentication Information Answer\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n* * * Next Change * * * *\n6.2.2\tCommand-Code Values\nThis section defines Command-Code values for the PC4a interface application as allocated by IANA.\nEvery command is defined by means of the ABNF syntax IETF RFC 5234 [8], according to the rules in IETF RFC 3588 [3]. In the case, the definition and use of an AVP is not specified in this document, the guidelines in IETF RFC 3588 [3] shall apply. \nThe following Command Codes are defined in this specification:\nTable 6.2.2-1: Command-Code values for PC4a\nCommand-Name\tAbbreviation\tCode\tSection\nProSe-Subscriber-Information-Request\tPIR\t8388664\t6.2.3\nProSe-Subscriber-Information-Answer\tPIA\t8388664\t6.2.4\nUpdate-ProSe-Subscriber-Data-Request\tUPR\t8388665\t6.2.5\nUpdate-ProSe-Subscriber-Data-Answer\tUPA\t8388665\t6.2.6\nProSe-Notify-Request\tPNR\t8388666\t6.2.7\nProSe-Notify-Answer\tPNA\t8388666\t6.2.8\nReset-Request\tRSR\t322\t6.2.9\nReset-Answer\tRSA\t322\t6.2.10\nProSe-Initial-Location-Information-Request\tPSR\t8388713\t6.2.11\nProSe-Initial-Location-Information-Answer\tPSA\t8388713\t6.2.12\n\nFor these commands, the Application-ID field shall be set to 16777336 (application identifier of the PC4a interface application, allocated by IANA).\n* * * Next Change * * * *\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n* * * Next Change * * * *\n6.3.1\tGeneral\nThe following table specifies the Diameter AVPs defined for the PC4a interface protocol, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted. The Vendor-ID header of all AVPs defined in this specification shall be set to 3GPP (10415).\nTable 6.3.1-1: PC4a specific Diameter AVPs\n\tAVP Flag rules\nAttribute Name\tAVP Code\tSection defined\tValue Type\tMust\tMay\tShould not\tMust not\tMay Encr.\nProSe-Subscription-Data\t3701\t6.3.2\tGrouped\tM,V\t\t\t\tNo\nProSe-Permission\t3702\t6.3.3\tUnsigned32\tM,V\t\t\t\tNo\nProSe-Allowed-PLMN\t3703\t6.3.4\tGrouped\tM,V\t\t\t\tNo\nProSe-Direct-Allowed\t3704\t6.3.5\tUnsigned32\tM,V\t\t\t\tNo\nUPR-Flags\t3705\t6.3.6\tUnsigned32\tM,V\t\t\t\tNo\nPNR-Flags\t3706\t6.3.7\tUnsigned32\tM,V\t\t\t\tNo\nProSe-Initial-Location-Information\t3707\t6.3.9\tGrouped\tM,V\t\t\t\tNo\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 3588 [3]. \tNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\n\nThe following table specifies the Diameter AVPs re-used by the PC4a interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within PC4a. \nAny other AVPs from existing Diameter Applications, except for the AVPs from Diameter Base Protocol, do not need to be supported. The AVPs from Diameter Base Protocol are not included in table 6.3.1-2, but they may be re-used for the PC4a protocol.\nTable 6.3.1-2: PC4a re-used Diameter AVPs\nAttribute Name\tReference\tComments\tM-bit\nVisited-PLMN-Id\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nSupported-Features\t3GPP\u00a0TS\u00a029.229\u00a0[6]\nFeature-List-ID\t3GPP\u00a0TS\u00a029.229\u00a0[6]\nFeature-List\t3GPP\u00a0TS\u00a029.229\u00a0[6]\nUser-Id\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nReset-ID\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nMSISDN\t3GPP\u00a0TS\u00a029.329\u00a0[12]\nMME-Name\t3GPP\u00a0TS\u00a029.173\u00a0[14]\nE-UTRAN-Cell-Global-Identity\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nTracking-Area-Identity\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nAge-Of-Location-Information\t3GPP\u00a0TS\u00a029.272\u00a0[10]\nOC-Supported-Features\tIETF draft-ietf-dime-ovli-04 [15]\tMust set\nOC-OLR\tIETF draft-ietf-dime-ovli-04 [15]\tMust set\n\n\n\n\n\n\n\nNOTE 1:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies. \tNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\n\n* * * Next Change * * * *\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n* * * Next Change * * * *\n\n\n\n\n\n* * * End of Changes * * * *\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 33.303 defines security aspects for Prose and the Annex F.4 describes the Prose Function with the bootstrapping entity where the functionality of retrieving the authentication vector from the HSS is achieved through the PC4a interface.It is needed to describe the procedure supporting this functionality over PC4a in TS 29.344.\n\n>>> SUMMARY OF CHANGE\nAn Authentication Information Retrieval procedure is described and relies on the MAR/MAA command pair used over Zh. It allows the retrieval of one authentication vector.The authentication scheme is Digest-AKAv1-MD5 also used over Cx. So AVPs defined in TS 29.229 for this scheme, are reused in this CR.A differerence with Cx is that the Confidentiality Key information element shall be present, but the ABNF description of the corresponding AVP remains optional for compatibilty with the definition of the SIP-Auth-Data-Item AVP.The Diameter application identifier is the PC4a one (16777336).\n\n>>> CONSEQUENCES IF NOT REVISED\nSecurity aspects for Prose cannot be fulfilled by a Prose Function with the bootstrapping entity (described in TS 33.303 annex F.4)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n6\tProtocol data units, formats and parameters (ASN.1)\n6.1\tGeneral\n6.1.1\tIntroduction\nThe contents of each RRC message is specified in sub-clause 6.2 using ASN.1 to specify the message syntax and using tables when needed to provide further detailed information about the fields specified in the message syntax. The syntax of the information elements that are defined as stand-alone abstract types is further specified in a similar manner in sub-clause 6.3. \n\n6.1.2\tNeed codes and conditions for optional downlink fields\nThe need for fields to be present in a message or an abstract type, i.e., the ASN.1 fields that are specified as OPTIONAL in the abstract notation (ASN.1), is specified by means of comment text tags attached to the OPTIONAL statement in the abstract syntax. All comment text tags are available for use in the downlink direction only. The meaning of each tag is specified in table 6.1.2-1.\nIf conditions are used, a conditional presence table is provided for the message or information element specifying the need of the field for each condition case. The table also specifies whether UE maintains or releases the value in case the field is not present. The conditions clarify what the UE may expect regarding the setting of the message by the network. Violation of conditions is regarded as invalid network behaviour, which the UE is not required to cope with. Hence the general error handling defined in 10.4 does not apply in case a field is absent although it is mandatory according to the CondC or CondM condition.\nFor guidelines on the use of need codes and conditions, see Annex A.6 and A.7.\nTable 6.1.2-1: Meaning of abbreviations used to specify the need for fields to be present\nAbbreviation\tMeaning\nCond conditionTag\tConditionally present\tPresence of the field is specified in a tabular form following the ASN.1 segment.\nCondC conditionTag\tConfiguration condition\tPresence of the field is conditional to other configuration settings.\nCondM conditionTag\tMessage condition\tPresence of the field is conditional to other fields included in the message.\nNeed S\tSpecified\tUsed for (configuration) fields, whose field description or procedure specifies the UE behavior performed upon receiving a message with the field absent (and not if field description or procedure specifies the UE behavior when field is not configured).\nNeed M\tMaintain\tUsed for (configuration) fields that are stored by the UE i.e. not one-shot. Upon receiving a message with the field absent, the UE maintains the current value.\nNeed N\tNo action (one-shot configuration that is not maintained)\tUsed for (configuration) fields that are not stored and whose presence causes a one-time action by the UE. Upon receiving message with the field absent, the UE takes no action.\nNeed R\tRelease\tUsed for (configuration) fields that are stored by the UE i.e. not one-shot. Upon receiving a message with the field absent, the UE releases the current value.\nNOTE:\tIn this version of the specification, the condition tags CondC and CondM are not used.\nAny field with Need M or Need N in system information shall be interpreted as Need R.\n\n\n\n\n\nFor downlink messages, the need codes, conditions and ASN.1 defaults specified for a particular (child) field only apply in case the (parent) field including the particular field is present. Thus, if the parent is absent the UE shall not release the field unless the absence of the parent field implies that. \nFor (parent) fields without need codes in downlink messages, if the parent field is absent, UE shall follow the need codes of the child fields. Thus, if parent field is absent, the need code of each child field is followed (i.e. Need R child fields are released, Need M child fields are not modified and the actions for Need S child fields depend on the specified conditions of each field). Examples of (parent) fields in downlink messages without need codes where this rule applies are:\n-\tnonCriticalExtension fields at the end of a message using empty SEQUENCE extension mechanism,\n-\tgroups of non-critical extensions using double brackets (referred to as extension groups), and\n-\tnon-critical extensions at the end of a message or at the end of a structure, contained in a BIT STRING or OCTET STRING (referred to as parent extension fields).\nThe handling of need codes as specified in the previous is illustrated by means of an example, as shown in the following ASN.1.\n-- /example/ ASN1START\n\nRRCMessage-IEs ::=                SEQUENCE {\n    field1                            InformationElement1            OPTIONAL,  -- Need M\n    field2                            InformationElement2            OPTIONAL,  -- Need R\n    nonCriticalExtension              RRCMessage-v1570-IEs           OPTIONAL\n}\n\nRRCMessage-1570-IEs ::=           SEQUENCE {\n    field3                            InformationElement3            OPTIONAL,  -- Need M\n    nonCriticalExtension              RRCMessage-v1640-IEs           OPTIONAL\n}\n\nRRCMessage-v1640-IEs ::=          SEQUENCE {\n    field4                            InformationElement4            OPTIONAL,  -- Need R\n    nonCriticalExtension              SEQUENCE {}                    OPTIONAL\n}\n\nInformationElement1 ::=           SEQUENCE {\n    field11                           InformationElement11           OPTIONAL,  -- Need M\n    field12                           InformationElement12           OPTIONAL,  -- Need R\n    ...,\n    [[\n    field13                           InformationElement13           OPTIONAL,  -- Need R\n    field14                           InformationElement14           OPTIONAL   -- Need M\n    ]]\n}\n\nInformationElement2 ::=           SEQUENCE {\n    field21                           InformationElement11           OPTIONAL,  -- Need M\n    ...\n}\n\n-- ASN1STOP\n\nThe handling of need codes as specified in the previous implies that:\n-\tif field1 in RRCMessage-IEs is absent, UE does not modify any child fields configured within field1 (regardless of their need codes);\n-\tif field2 in RRCMessage-IEs is absent, UE releases the field2 (and also its child field field21);\n-\tif field1 or field2 in RRCMessage-IEs is present, UE retains or releases their child fields according to the child field presence conditions;\n-\tif field1 in RRCMessage-IEs is present but the extension group containing field13 and field14 is absent, the UE releases field13 but does not modify field14;\n-\tif nonCriticalExtension defined by IE RRCMessage-v1570-IEs is absent, the UE does not modify field3 but releases field4;\n6.1.3\tGeneral rules\nIn the ASN.1 of this specification, the first bit of a bit string refers to the leftmost bit, unless stated otherwise.\n6.2\tRRC messages\n6.2.1\tGeneral message structure\n\u2013\tNR-RRC-Definitions\nThis ASN.1 segment is the start of the NR RRC PDU definitions.\n-- ASN1START\n-- TAG-NR-RRC-DEFINITIONS-START\n\nNR-RRC-Definitions DEFINITIONS AUTOMATIC TAGS ::=\n\nBEGIN\n\n-- TAG-NR-RRC-DEFINITIONS-STOP\n-- ASN1STOP\n\n\u2013\tBCCH-BCH-Message\nThe BCCH-BCH-Message class is the set of RRC messages that may be sent from the network to the UE via BCH on the BCCH logical channel.\n-- ASN1START\n-- TAG-BCCH-BCH-MESSAGE-START\n\nBCCH-BCH-Message ::=            SEQUENCE {\n    message                         BCCH-BCH-MessageType\n}\n\nBCCH-BCH-MessageType ::=        CHOICE {\n    mib                             MIB,\n    messageClassExtension           SEQUENCE {}\n}\n\n-- TAG-BCCH-BCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tBCCH-DL-SCH-Message\nThe BCCH-DL-SCH-Message class is the set of RRC messages that may be sent from the network to the UE via DL-SCH on the BCCH logical channel.\n-- ASN1START\n-- TAG-BCCH-DL-SCH-MESSAGE-START\n\nBCCH-DL-SCH-Message ::=         SEQUENCE {\n    message                         BCCH-DL-SCH-MessageType\n}\n\nBCCH-DL-SCH-MessageType ::=     CHOICE {\n    c1                              CHOICE {\n        systemInformation               SystemInformation,\n        systemInformationBlockType1     SIB1\n    },\n    messageClassExtension           SEQUENCE {}\n}\n\n-- TAG-BCCH-DL-SCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tDL-CCCH-Message\nThe DL-CCCH-Message class is the set of RRC messages that may be sent from the Network to the UE on the downlink CCCH logical channel.\n-- ASN1START\n-- TAG-DL-CCCH-MESSAGE-START\n\n\nDL-CCCH-Message ::=             SEQUENCE {\n    message                         DL-CCCH-MessageType\n}\n\nDL-CCCH-MessageType ::=         CHOICE {\n    c1                              CHOICE {\n        rrcReject                       RRCReject,\n        rrcSetup                        RRCSetup,\n        spare2                          NULL,\n        spare1                          NULL\n    },\n    messageClassExtension           SEQUENCE {}\n}\n\n-- TAG-DL-CCCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tDL-DCCH-Message\nThe DL-DCCH-Message class is the set of RRC messages that may be sent from the network to the UE on the downlink DCCH logical channel.\n-- ASN1START\n-- TAG-DL-DCCH-MESSAGE-START\n\nDL-DCCH-Message ::=              SEQUENCE {\n    message                         DL-DCCH-MessageType\n}\n\nDL-DCCH-MessageType ::=         CHOICE {\n    c1                              CHOICE {\n        rrcReconfiguration              RRCReconfiguration,\n        rrcResume                       RRCResume,\n        rrcRelease                      RRCRelease,\n        rrcReestablishment              RRCReestablishment,\n        securityModeCommand             SecurityModeCommand,\n        dlInformationTransfer           DLInformationTransfer,\n        ueCapabilityEnquiry             UECapabilityEnquiry,\n        counterCheck                    CounterCheck,\n        mobilityFromNRCommand           MobilityFromNRCommand,\n        spare7 NULL,\n        spare6 NULL, spare5 NULL, spare4 NULL,\n        spare3 NULL, spare2 NULL, spare1 NULL\n    },\n    messageClassExtension   SEQUENCE {}\n}\n\n-- TAG-DL-DCCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tPCCH-Message\nThe PCCH-Message class is the set of RRC messages that may be sent from the Network to the UE on the PCCH logical channel.\n-- ASN1START\n-- TAG-PCCH-PCH-MESSAGE-START\n\nPCCH-Message ::=                SEQUENCE {\n    message                         PCCH-MessageType\n}\n\nPCCH-MessageType ::=            CHOICE {\n    c1                              CHOICE {\n        paging                          Paging,\n        spare1  NULL\n    },\n    messageClassExtension       SEQUENCE {}\n}\n\n-- TAG-PCCH-PCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tUL-CCCH-Message\nThe UL-CCCH-Message class is the set of 48-bits RRC messages that may be sent from the UE to the Network on the uplink CCCH logical channel.\n-- ASN1START\n-- TAG-UL-CCCH-MESSAGE-START\n\n\nUL-CCCH-Message ::=             SEQUENCE {\n    message                         UL-CCCH-MessageType\n}\n\nUL-CCCH-MessageType ::=         CHOICE {\n    c1                              CHOICE {\n        rrcSetupRequest                 RRCSetupRequest,\n        rrcResumeRequest                RRCResumeRequest,\n        rrcReestablishmentRequest       RRCReestablishmentRequest,\n        rrcSystemInfoRequest            RRCSystemInfoRequest\n    },\n    messageClassExtension           SEQUENCE {}\n}\n\n-- TAG-UL-CCCH-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tUL-CCCH1-Message\nThe UL-CCCH1-Message class is the set of 64-bits RRC messages that may be sent from the UE to the Network on the uplink CCCH1 logical channel.\n-- ASN1START\n-- TAG-UL-CCCH1-MESSAGE-START\n\n\nUL-CCCH1-Message ::=            SEQUENCE {\n    message                         UL-CCCH1-MessageType\n}\n\nUL-CCCH1-MessageType ::=        CHOICE {\n    c1                              CHOICE {\n        rrcResumeRequest1               RRCResumeRequest1,\n        spare3 NULL,\n        spare2 NULL,\n        spare1 NULL\n\n    },\n    messageClassExtension SEQUENCE {}\n}\n\n-- TAG-UL-CCCH1-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tUL-DCCH-Message\nThe UL-DCCH-Message class is the set of RRC messages that may be sent from the UE to the network on the uplink DCCH logical channel.\n-- ASN1START\n-- TAG-UL-DCCH-MESSAGE-START\n\nUL-DCCH-Message ::=             SEQUENCE {\n    message                         UL-DCCH-MessageType\n}\n\nUL-DCCH-MessageType ::=         CHOICE {\n    c1                              CHOICE {\n        measurementReport               MeasurementReport,\n        rrcReconfigurationComplete      RRCReconfigurationComplete,\n        rrcSetupComplete                RRCSetupComplete,\n        rrcReestablishmentComplete      RRCReestablishmentComplete,\n        rrcResumeComplete               RRCResumeComplete,\n        securityModeComplete            SecurityModeComplete,\n        securityModeFailure             SecurityModeFailure,\n        ulInformationTransfer           ULInformationTransfer,\n        locationMeasurementIndication   LocationMeasurementIndication,\n        ueCapabilityInformation         UECapabilityInformation,\n        counterCheckResponse            CounterCheckResponse,\n        ueAssistanceInformation         UEAssistanceInformation,\n        failureInformation              FailureInformation,\n        spare3 NULL,\n        spare2 NULL, spare1 NULL\n    },\n    messageClassExtension           SEQUENCE {}\n}\n\n-- TAG-UL-DCCH-MESSAGE-STOP\n-- ASN1STOP\n\n\n6.2.2\tMessage definitions\n\u2013\tCounterCheck\nThe CounterCheck message is used by the network to indicate the current COUNT MSB values associated to each DRB and to request the UE to compare these to its COUNT MSB values and to report the comparison results to the network.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nCounterCheck message\n-- ASN1START\n-- TAG-COUNTERCHECK-START\n\n\nCounterCheck ::=                SEQUENCE {\n    rrc-TransactionIdentifier       RRC-TransactionIdentifier,\n    criticalExtensions              CHOICE {\n        counterCheck                    CounterCheck-IEs,\n        criticalExtensionsFuture        SEQUENCE {}\n    }\n}\n\nCounterCheck-IEs ::=            SEQUENCE {\n    drb-CountMSB-InfoList           DRB-CountMSB-InfoList,\n    lateNonCriticalExtension        OCTET STRING                        OPTIONAL,\n    nonCriticalExtension            SEQUENCE {}                         OPTIONAL\n}\n\nDRB-CountMSB-InfoList ::=       SEQUENCE (SIZE (1..maxDRB)) OF DRB-CountMSB-Info\n\nDRB-CountMSB-Info ::=           SEQUENCE {\n    drb-Identity                    DRB-Identity,\n    countMSB-Uplink                 INTEGER(0..33554431),\n    countMSB-Downlink               INTEGER(0..33554431)\n}\n\n-- TAG-COUNTERCHECK-STOP\n-- ASN1STOP\n\nCounterCheck-IEs field descriptions\ndrb-CountMSB-InfoList\tIndicates the MSBs of the COUNT values of the DRBs.\n\nDRB-CountMSB-Info field descriptions\ncountMSB-Downlink\tIndicates the value of 25 MSBs from RX_NEXT \u2013 1 (specified in TS 38.323 [5]) associated to this DRB.\ncountMSB-Uplink\tIndicates the value of 25 MSBs from TX_NEXT \u2013 1 (specified in TS 38.323 [5]) associated to this DRB.\n\n\u2013\tCounterCheckResponse\nThe CounterCheckResponse message is used by the UE to respond to a CounterCheck message.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nCounterCheckResponse message\n-- ASN1START\n-- TAG-COUNTERCHECKRESPONSE-START\n\nCounterCheckResponse ::=        SEQUENCE {\n    rrc-TransactionIdentifier       RRC-TransactionIdentifier,\n    criticalExtensions              CHOICE {\n        counterCheckResponse            CounterCheckResponse-IEs,\n        criticalExtensionsFuture        SEQUENCE {}\n    }\n}\n\nCounterCheckResponse-IEs ::=    SEQUENCE {\n    drb-CountInfoList               DRB-CountInfoList,\n    lateNonCriticalExtension        OCTET STRING                        OPTIONAL,\n    nonCriticalExtension            SEQUENCE {}                         OPTIONAL\n\n}\n\nDRB-CountInfoList ::=           SEQUENCE (SIZE (0..maxDRB)) OF DRB-CountInfo\n\nDRB-CountInfo ::=               SEQUENCE {\n    drb-Identity                    DRB-Identity,\n    count-Uplink                    INTEGER(0..4294967295),\n    count-Downlink                  INTEGER(0..4294967295)\n}\n\n-- TAG-COUNTERCHECKRESPONSE-STOP\n-- ASN1STOP\n\nCounterCheckResponse-IEs field descriptions\ndrb-CountInfoList\tIndicates the COUNT values of the DRBs.\n\nDRB-CountInfo field descriptions\ncount-Downlink\tIndicates the value of RX_NEXT \u2013 1 (specified in TS 38.323 [5]) associated to this DRB.\ncount-Uplink\tIndicates the value of TX_NEXT \u2013 1 (specified in TS 38.323 [5]) associated to this DRB.\n\n\u2013\tDLInformationTransfer\nThe DLInformationTransfer message is used for the downlink transfer of NAS dedicated information.\nSignalling radio bearer: SRB2 or SRB1 (only if SRB2 not established yet. If SRB2 is suspended, the network does not send this message until SRB2 is resumed.)\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nDLInformationTransfer message\n-- ASN1START\n-- TAG-DLINFORMATIONTRANSFER-START\n\nDLInformationTransfer ::=           SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        dlInformationTransfer           DLInformationTransfer-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nDLInformationTransfer-IEs ::=   SEQUENCE {\n    dedicatedNAS-Message                DedicatedNAS-Message                OPTIONAL,   -- Need N\n    lateNonCriticalExtension            OCTET STRING                        OPTIONAL,\n    nonCriticalExtension                SEQUENCE {} OPTIONAL\n}\n\n-- TAG-DLINFORMATIONTRANSFER-STOP\n-- ASN1STOP\n\n\u2013\tFailureInformation\nThe FailureInformation message is used to inform the network about a failure detected by the UE.\nSignalling radio bearer: SRB1 or SRB3\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to network\nFailureInformation message\n-- ASN1START\n-- TAG-FAILUREINFORMATION-START\n\nFailureInformation ::=         SEQUENCE {\n    criticalExtensions             CHOICE {\n        failureInformation             FailureInformation-IEs,\n        criticalExtensionsFuture       SEQUENCE {}\n    }\n}\n\nFailureInformation-IEs ::=     SEQUENCE {\n    failureInfoRLC-Bearer          FailureInfoRLC-Bearer    OPTIONAL,\n    lateNonCriticalExtension       OCTET STRING             OPTIONAL,\n    nonCriticalExtension           SEQUENCE {}              OPTIONAL\n}\n\nFailureInfoRLC-Bearer ::=      SEQUENCE {\n    cellGroupId                    CellGroupId,\n    logicalChannelIdentity         LogicalChannelIdentity,\n    failureType                    ENUMERATED {duplication, spare3, spare2, spare1}\n}\n\n-- TAG-FAILUREINFORMATION-STOP\n-- ASN1STOP\n\n\u2013\tLocationMeasurementIndication\nThe LocationMeasurementIndication message is used to indicate that the UE is going to either start or stop location related measurement which requires measurement gaps.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nLocationMeasurementIndication message\n-- ASN1START\n-- TAG-LOCATIONMEASUREMENTINDICATION-START\n\nLocationMeasurementIndication ::=   SEQUENCE {\n    criticalExtensions                      CHOICE {\n        locationMeasurementIndication               LocationMeasurementIndication-IEs,\n        criticalExtensionsFuture                    SEQUENCE {}\n    }\n}\n\nLocationMeasurementIndication-IEs ::=       SEQUENCE {\n    measurementIndication       SetupRelease {LocationMeasurementInfo},\n\n    lateNonCriticalExtension                OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                    SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-LOCATIONMEASUREMENTINDICATION-STOP\n-- ASN1STOP\n\n\u2013\tMIB\nThe MIB includes the system information transmitted on BCH.\nSignalling radio bearer: N/A\nRLC-SAP: TM\nLogical channel: BCCH\nDirection: Network to UE\nMIB\n-- ASN1START\n-- TAG-MIB-START\n\nMIB ::=                             SEQUENCE {\n    systemFrameNumber                   BIT STRING (SIZE (6)),\n    subCarrierSpacingCommon             ENUMERATED {scs15or60, scs30or120},\n    ssb-SubcarrierOffset                INTEGER (0..15),\n    dmrs-TypeA-Position                 ENUMERATED {pos2, pos3},\n    pdcch-ConfigSIB1                    PDCCH-ConfigSIB1,\n    cellBarred                          ENUMERATED {barred, notBarred},\n    intraFreqReselection                ENUMERATED {allowed, notAllowed},\n    spare                               BIT STRING (SIZE (1))\n}\n\n-- TAG-MIB-STOP\n-- ASN1STOP\n\nMIB field descriptions\ncellBarred\tBarred means the cell is barred, as defined in TS 38.304 [20].\ndmrs-TypeA-Position\tPosition of (first) DM-RS for downlink (see TS 38.211 [16], clause 7.4.1.1.2) and uplink (see TS 38.211 [16], clause 6.4.1.1.3).\nintraFreqReselection\tControls cell selection/reselection to intra-frequency cells when the highest ranked cell is barred, or treated as barred by the UE, as specified in TS 38.304 [20].\npdcch-ConfigSIB1\tDetermines a common ControlResourceSet (CORESET), a common search space and necessary PDCCH parameters. If the field ssb-SubcarrierOffset indicates that SIB1 is not present, the field pdcch-ConfigSIB1 indicates the frequency positions where the UE may find SS/PBCH block with SIB1 or the frequency range where the network does not provide SS/PBCH block with SIB1 (see TS 38.213 [13], clause 13).\nssb-SubcarrierOffset\tCorresponds to kSSB (see TS 38.213 [13]), which is the frequency domain offset between SSB and the overall resource block grid in number of subcarriers. (See TS 38.211 [16], clause 7.4.3.1).\tThe value range of this field may be extended by an additional most significant bit encoded within PBCH as specified in TS 38.213 [13].\tThis field may indicate that this cell does not provide SIB1 and that there is hence no CORESET#0 configured in MIB (see TS 38.213 [13], clause 13). In this case, the field pdcch-ConfigSIB1 may indicate the frequency positions where the UE may (not) find a SS/PBCH with a control resource set and search space for SIB1 (see TS 38.213 [13], clause 13).\nsubCarrierSpacingCommon\tSubcarrier spacing for SIB1, Msg.2/4 for initial access, paging and broadcast SI-messages. If the UE acquires this MIB on a carrier frequency <6 GHz, the value scs15or60 corresponds to 15 kHz and the value scs30or120 corresponds to 30 kHz. If the UE acquires this MIB on a carrier frequency >6 GHz, the value scs15or60 corresponds to 60 kHz and the value scs30or120 corresponds to 120 kHz.\nsystemFrameNumber\tThe 6 most significant bits (MSB) of the 10-bit System Frame Number (SFN). The 4 LSB of the SFN are conveyed in the PBCH transport block as part of channel coding (i.e. outside the MIB encoding), as defined in clause 7.1 in TS 38.212 [17].\n\n\u2013\tMeasurementReport\nThe MeasurementReport message is used for the indication of measurement results.\nSignalling radio bearer: SRB1, SRB3\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nMeasurementReport message\n-- ASN1START\n-- TAG-MEASUREMENTREPORT-START\n\nMeasurementReport ::=               SEQUENCE {\n    criticalExtensions                  CHOICE {\n        measurementReport                   MeasurementReport-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nMeasurementReport-IEs ::=           SEQUENCE {\n    measResults                         MeasResults,\n\n    lateNonCriticalExtension                OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                    SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-MEASUREMENTREPORT-STOP\n-- ASN1STOP\n\n\u2013\tMobilityFromNRCommand\nThe MobilityFromNRCommand message is used to command handover from NR to E-UTRA (connected to EPC or 5GC).\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nMobilityFromNRCommand message\n-- ASN1START\n-- TAG-MOBILITYFROMNRCOMMAND-START\n\nMobilityFromNRCommand ::=       SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n            mobilityFromNRCommand               MobilityFromNRCommand-IEs,\n            criticalExtensionsFuture                SEQUENCE {}\n    }\n}\n\nMobilityFromNRCommand-IEs ::=   SEQUENCE {\n    targetRAT-Type                          ENUMERATED { eutra, spare3, spare2, spare1, ...},\n    targetRAT-MessageContainer              OCTET STRING,\n    nas-SecurityParamFromNR                 OCTET STRING                                OPTIONAL,   -- Cond HO-ToEPC\n    lateNonCriticalExtension                OCTET STRING                                OPTIONAL,\n    nonCriticalExtension                    SEQUENCE {}                                 OPTIONAL\n}\n\n-- TAG-MOBILITYFROMNRCOMMAND-STOP\n-- ASN1STOP\n\nMobilityFromNRCommand-IEs field descriptions\nnas-SecurityParamFromNR\tThis field is used to deliver the key synchronisation and Key freshness for the NR to LTE/EPC handovers and a part of the downlink NAS COUNT as specified in TS 33.501 [11].\ntargetRAT-MessageContainer\tThe field contains a message specified in another standard, as indicated by the targetRAT-Type, and carries information about the target cell identifier(s) and radio parameters relevant for the target radio access technology. NOTE 1. A complete message is included, as specified in the other standard.\ntargetRAT-Type\tIndicates the target RAT type.\n\nNOTE 1:\tThe correspondence between the value of the targetRAT-Type, the standard to apply, and the message contained within the targetRAT-MessageContainer is shown in the table below:\ntargetRAT-Type\tStandard to apply\ttargetRAT-MessageContainer\neutra\t3GPP TS 36.331 [10] (clause 5.4.2)\tRRCConnectionReconfiguration\n\nConditional Presence\tExplanation\nHO-ToEPC\tThis field is mandatory present in case of inter system handover. Otherwise it is absent. \n\n\u2013\tPaging\nThe Paging message is used for the notification of one or more UEs.\nSignalling radio bearer: N/A\nRLC-SAP: TM\nLogical channel: PCCH\nDirection: Network to UE\nPaging message\n-- ASN1START\n-- TAG-PAGING-START\n\nPaging ::=                          SEQUENCE {\n    pagingRecordList                        PagingRecordList                                                        OPTIONAL, -- Need N\n    lateNonCriticalExtension                OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                    SEQUENCE{}                                                              OPTIONAL\n}\n\nPagingRecordList ::=                SEQUENCE (SIZE(1..maxNrofPageRec)) OF PagingRecord\n\nPagingRecord ::=                    SEQUENCE {\n    ue-Identity                         PagingUE-Identity,\n    accessType                          ENUMERATED {non3GPP}    OPTIONAL,   -- Need N\n    ...\n}\n\nPagingUE-Identity ::=               CHOICE {\n    ng-5G-S-TMSI                        NG-5G-S-TMSI,\n    fullI-RNTI                          I-RNTI-Value,\n    ...\n}\n\n-- TAG-PAGING-STOP\n-- ASN1STOP\n\nPagingRecord field descriptions\naccessType\tIndicates whether the Paging message is originated due to the PDU sessions from the non-3GPP access.\n\n\u2013\tRRCReestablishment\nThe RRCReestablishment message is used to re-establish SRB1.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nRRCReestablishment message\n-- ASN1START\n-- TAG-RRCREESTABLISHMENT-START\n\nRRCReestablishment ::=              SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcReestablishment                  RRCReestablishment-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCReestablishment-IEs ::=          SEQUENCE {\n    nextHopChainingCount                NextHopChainingCount,\n    lateNonCriticalExtension            OCTET STRING                        OPTIONAL,\n    nonCriticalExtension                SEQUENCE {}                         OPTIONAL\n}\n\n-- TAG-RRCREESTABLISHMENT-STOP\n-- ASN1STOP\n\n\u2013\tRRCReestablishmentComplete\nThe RRCReestablishmentComplete message is used to confirm the successful completion of an RRC connection re-establishment.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nRRCReestablishmentComplete message\n-- ASN1START\n-- TAG-RRCREESTABLISHMENTCOMPLETE-START\n\nRRCReestablishmentComplete ::=      SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcReestablishmentComplete          RRCReestablishmentComplete-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCReestablishmentComplete-IEs ::=  SEQUENCE {\n    lateNonCriticalExtension            OCTET STRING                    OPTIONAL,\n    nonCriticalExtension                SEQUENCE {}                     OPTIONAL\n}\n\n-- TAG-RRCREESTABLISHMENTCOMPLETE-STOP\n-- ASN1STOP\n\n\u2013\tRRCReestablishmentRequest\nThe RRCReestablishmentRequest message is used to request the reestablishment of an RRC connection.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: UE to Network\nRRCReestablishmentRequest message\n-- ASN1START\n-- TAG-RRCREESTABLISHMENTREQUEST-START\n\n\nRRCReestablishmentRequest ::=       SEQUENCE {\n    rrcReestablishmentRequest           RRCReestablishmentRequest-IEs\n}\n\nRRCReestablishmentRequest-IEs ::=   SEQUENCE {\n    ue-Identity                         ReestabUE-Identity,\n    reestablishmentCause                ReestablishmentCause,\n    spare                               BIT STRING (SIZE (1))\n}\n\nReestabUE-Identity ::=              SEQUENCE {\n    c-RNTI                              RNTI-Value,\n    physCellId                          PhysCellId,\n    shortMAC-I                          ShortMAC-I\n}\n\nReestablishmentCause ::=            ENUMERATED {reconfigurationFailure, handoverFailure, otherFailure, spare1}\n\n-- TAG-RRCREESTABLISHMENTREQUEST-STOP\n-- ASN1STOP\n\nReestabUE-Identity field descriptions\nphysCellId\tThe Physical Cell Identity of the PCell the UE was connected to prior to the failure.\n\nRRCReestablishmentRequest-IEs field descriptions\nreestablishmentCause\tIndicates the failure cause that triggered the re-establishment procedure. gNB is not expected to reject a RRCReestablishmentRequest due to unknown cause value being used by the UE.\nue-Identity\tUE identity included to retrieve UE context and to facilitate contention resolution by lower layers.\n\n\u2013\tRRCReconfiguration\nThe RRCReconfiguration message is the command to modify an RRC connection. It may convey information for measurement configuration, mobility control, radio resource configuration (including RBs, MAC main configuration and physical channel configuration) and AS security configuration.\nSignalling radio bearer: SRB1 or SRB3\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nRRCReconfiguration message\n-- ASN1START\n-- TAG-RRCRECONFIGURATION-START\n\nRRCReconfiguration ::=              SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcReconfiguration                  RRCReconfiguration-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCReconfiguration-IEs ::=          SEQUENCE {\n    radioBearerConfig                       RadioBearerConfig                                                      OPTIONAL, -- Need M\n    secondaryCellGroup                      OCTET STRING (CONTAINING CellGroupConfig)                              OPTIONAL, -- Need M\n    measConfig                              MeasConfig                                                             OPTIONAL, -- Need M\n    lateNonCriticalExtension                OCTET STRING                                                           OPTIONAL,\n    nonCriticalExtension                    RRCReconfiguration-v1530-IEs                                           OPTIONAL\n}\n\nRRCReconfiguration-v1530-IEs ::=            SEQUENCE {\n    masterCellGroup                         OCTET STRING (CONTAINING CellGroupConfig)                              OPTIONAL, -- Need M\n    fullConfig                              ENUMERATED {true}                                                      OPTIONAL, -- Cond FullConfig\n    dedicatedNAS-MessageList                SEQUENCE (SIZE(1..maxDRB)) OF DedicatedNAS-Message                     OPTIONAL, -- Cond nonHO\n    masterKeyUpdate                         MasterKeyUpdate                                                        OPTIONAL, -- Cond MasterKeyChange\n    dedicatedSIB1-Delivery                  OCTET STRING (CONTAINING SIB1)                                         OPTIONAL, -- Need N\n    dedicatedSystemInformationDelivery      OCTET STRING (CONTAINING SystemInformation)                            OPTIONAL, -- Need N\n    otherConfig                             OtherConfig                                                            OPTIONAL, -- Need M\n    nonCriticalExtension                    RRCReconfiguration-v1540-IEs                                           OPTIONAL\n}\n\nRRCReconfiguration-v1540-IEs ::=        SEQUENCE {\n    otherConfig-v1540                       OtherConfig-v1540        OPTIONAL, -- Need M\n    nonCriticalExtension                    SEQUENCE {}              OPTIONAL\n}\n\nMasterKeyUpdate ::=                 SEQUENCE {\n    keySetChangeIndicator           BOOLEAN,\n    nextHopChainingCount            NextHopChainingCount,\n    nas-Container                   OCTET STRING                                                     OPTIONAL,    -- Cond securityNASC\n    ...\n}\n\n-- TAG-RRCRECONFIGURATION-STOP\n-- ASN1STOP\n\nRRCReconfiguration-IEs field descriptions\ndedicatedNAS-MessageList\tThis field is used to transfer UE specific NAS layer information between the network and the UE. The RRC layer is transparent for each PDU in the list. \ndedicatedSIB1-Delivery\tThis field is used to transfer SIB1 to the UE. The UE may assume that configuration in dedicatedSIB1-Delivery has the same values as the corresponding configuration in servingCellConfigCommon.\ndedicatedSystemInformationDelivery\tThis field is used to transfer SIB6, SIB7, SIB8 to the UE.\nfullConfig\tIndicates that the full configuration option is applicable for the RRCReconfiguration message.\nkeySetChangeIndicator\tTrue is used in an intra-cell handover when a KgNB key is derived from a KAMF key taken into use through the latest successful NAS SMC procedure, or N2 handover procedure with KAMF change, as described in TS 33.501 [11] for KgNB re-keying. False is used in an intra-NR handover when the new KgNB key is obtained from the current KgNB key or from the NH as described in TS 33.501 [11].\nmasterCellGroup\tConfiguration of master cell group.\nnas-Container\tThis field is used to transfer UE specific NAS layer information between the network and the UE. The RRC layer is transparent for this field, although it affects activation of AS  security after inter-system handover to NR. The content is defined in TS 24.501 [23].\nnextHopChainingCount\tParameter NCC: See TS 33.501 [11]\notherConfig\tContains configuration related to other configurations.\nradioBearerConfig\tConfiguration of Radio Bearers (DRBs, SRBs) including SDAP/PDCP. In EN-DC this field may only be present if the RRCReconfiguration is transmitted over SRB3.\nsecondaryCellGroup\tConfiguration of secondary cell group (EN-DC).\n\nConditional Presence\tExplanation\nnonHO\tThe field is not present in case of reconfiguration with sync within NR or to NR; otherwise it is optionally present, need N. \nsecurityNASC\tThis field is mandatory present in case of inter system handover. Otherwise the field is optionally present, need N. \nMasterKeyChange\tThis field is mandatory present in case of Handover with change of the AS security algorithms (as indicated in SecurityAlgorithmConfig in SecurityConfig, included in the received RadioBearerConfig). If ReconfigurationWithSync is included for other cases, this field is optionally present, need N. Otherwise the field is absent. \nFullConfig\tThe field is mandatory present in case of inter-system handover from E-UTRA/EPC to NR. It is optionally present, Need N, during reconfiguration with sync and also in first reconfiguration after reestablishment; or for intra-system handover from E-UTRA/5GC to NR. It is not present otherwise. \n\n\u2013\tRRCReconfigurationComplete\nThe RRCReconfigurationComplete message is used to confirm the successful completion of an RRC connection reconfiguration.\nSignalling radio bearer: SRB1 or SRB3\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nRRCReconfigurationComplete message\n-- ASN1START\n-- TAG-RRCRECONFIGURATIONCOMPLETE-START\n\nRRCReconfigurationComplete ::=              SEQUENCE {\n    rrc-TransactionIdentifier                   RRC-TransactionIdentifier,\n    criticalExtensions                          CHOICE {\n        rrcReconfigurationComplete                  RRCReconfigurationComplete-IEs,\n        criticalExtensionsFuture                    SEQUENCE {}\n    }\n}\n\nRRCReconfigurationComplete-IEs ::=          SEQUENCE {\n    lateNonCriticalExtension                    OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                        RRCReconfigurationComplete-v1530-IEs                                    OPTIONAL\n}\n\nRRCReconfigurationComplete-v1530-IEs ::=    SEQUENCE {\n    uplinkTxDirectCurrentList                   UplinkTxDirectCurrentList                                               OPTIONAL,\n    nonCriticalExtension                        SEQUENCE {}                                                             OPTIONAL\n}\n\n-- TAG-RRCRECONFIGURATIONCOMPLETE-STOP\n-- ASN1STOP\n\nRRCReconfigurationComplete-v1530-IEs field descriptions\nuplinkTxDirectCurrentList\tThe Tx Direct Current locations for the configured serving cells and BWPs if requested by the NW (see reportUplinkTxDirectCurrent in CellGroupConfig).\n\n\u2013\tRRCReject\nThe RRCReject message is used to reject an RRC connection establishment or an RRC connection resumption.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: Network to UE\nRRCReject message\n-- ASN1START\n-- TAG-RRCREJECT-START\n\nRRCReject ::=                       SEQUENCE {\n    criticalExtensions                  CHOICE {\n        rrcReject                           RRCReject-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCReject-IEs ::=                   SEQUENCE {\n    waitTime                            RejectWaitTime                                                          OPTIONAL,   -- Need N\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-RRCREJECT-STOP\n-- ASN1STOP\n\nRRCReject-IEs field descriptions\nwaitTime\tWait time value in seconds. The field is always included.\n\n\u2013\tRRCRelease\nThe RRCRelease message is used to command the release of an RRC connection or the suspension of the RRC connection.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nRRCRelease message\n-- ASN1START\n-- TAG-RRCRELEASE-START\n\nRRCRelease ::=                      SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcRelease                          RRCRelease-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCRelease-IEs ::=                  SEQUENCE {\n    redirectedCarrierInfo               RedirectedCarrierInfo                                                   OPTIONAL,   -- Need N\n    cellReselectionPriorities           CellReselectionPriorities                                               OPTIONAL,   -- Need R\n    suspendConfig                       SuspendConfig                                                           OPTIONAL,   -- Need R\n    deprioritisationReq                 SEQUENCE {\n        deprioritisationType                ENUMERATED {frequency, nr},\n        deprioritisationTimer               ENUMERATED {min5, min10, min15, min30}\n    }                                                                                                           OPTIONAL,   -- Need N\n    lateNonCriticalExtension                OCTET STRING                                                        OPTIONAL,\n    nonCriticalExtension                    RRCRelease-v1540-IEs                                                OPTIONAL\n}\n\nRRCRelease-v1540-IEs ::=            SEQUENCE {\n    waitTime                           RejectWaitTime                OPTIONAL, -- Need N\n    nonCriticalExtension               SEQUENCE {}                   OPTIONAL\n}\n\nRedirectedCarrierInfo ::=           CHOICE {\n    nr                                  CarrierInfoNR,\n    eutra                               RedirectedCarrierInfo-EUTRA,\n    ...\n}\n\nRedirectedCarrierInfo-EUTRA ::=     SEQUENCE {\n    eutraFrequency                          ARFCN-ValueEUTRA,\n    cnType                                  ENUMERATED {epc,fiveGC}                                             OPTIONAL    -- Need N\n}\n\nCarrierInfoNR ::=                   SEQUENCE {\n    carrierFreq                         ARFCN-ValueNR,\n    ssbSubcarrierSpacing                SubcarrierSpacing,\n    smtc                                SSB-MTC                                                                 OPTIONAL,      -- Need S\n    ...\n}\n\nSuspendConfig ::=                   SEQUENCE {\n    fullI-RNTI                          I-RNTI-Value,\n    shortI-RNTI                         ShortI-RNTI-Value,\n    ran-PagingCycle                     PagingCycle,\n    ran-NotificationAreaInfo            RAN-NotificationAreaInfo                                                OPTIONAL,   -- Need M\n    t380                                PeriodicRNAU-TimerValue                                                 OPTIONAL,   -- Need R\n    nextHopChainingCount                NextHopChainingCount,\n    ...\n}\n\n\nPeriodicRNAU-TimerValue ::=         ENUMERATED { min5, min10, min20, min30, min60, min120, min360, min720}\n\n\nCellReselectionPriorities ::=       SEQUENCE {\n    freqPriorityListEUTRA               FreqPriorityListEUTRA                                                   OPTIONAL,       -- Need M\n    freqPriorityListNR                  FreqPriorityListNR                                                      OPTIONAL,       -- Need M\n    t320                                ENUMERATED {min5, min10, min20, min30, min60, min120, min180, spare1}   OPTIONAL,       -- Need R\n    ...\n}\n\nPagingCycle ::=                     ENUMERATED {rf32, rf64, rf128, rf256}\n\nFreqPriorityListEUTRA ::=           SEQUENCE (SIZE (1..maxFreq)) OF FreqPriorityEUTRA\n\nFreqPriorityListNR ::=              SEQUENCE (SIZE (1..maxFreq)) OF FreqPriorityNR\n\nFreqPriorityEUTRA ::=               SEQUENCE {\n    carrierFreq                         ARFCN-ValueEUTRA,\n    cellReselectionPriority             CellReselectionPriority,\n    cellReselectionSubPriority          CellReselectionSubPriority                                              OPTIONAL        -- Need R\n}\n\nFreqPriorityNR ::=                  SEQUENCE {\n    carrierFreq                         ARFCN-ValueNR,\n    cellReselectionPriority             CellReselectionPriority,\n    cellReselectionSubPriority          CellReselectionSubPriority                                              OPTIONAL        -- Need R\n}\n\nRAN-NotificationAreaInfo ::=        CHOICE {\n    cellList                            PLMN-RAN-AreaCellList,\n    ran-AreaConfigList                  PLMN-RAN-AreaConfigList,\n    ...\n}\n\nPLMN-RAN-AreaCellList ::=           SEQUENCE (SIZE (1.. maxPLMNIdentities)) OF PLMN-RAN-AreaCell\n\nPLMN-RAN-AreaCell ::=               SEQUENCE {\n    plmn-Identity                       PLMN-Identity                                                           OPTIONAL,   -- Need S\n    ran-AreaCells                       SEQUENCE (SIZE (1..32)) OF  CellIdentity\n}\n\nPLMN-RAN-AreaConfigList ::=         SEQUENCE (SIZE (1..maxPLMNIdentities)) OF PLMN-RAN-AreaConfig\n\nPLMN-RAN-AreaConfig ::=             SEQUENCE {\n    plmn-Identity                       PLMN-Identity                                                           OPTIONAL,   -- Need S\n    ran-Area                            SEQUENCE (SIZE (1..16)) OF  RAN-AreaConfig\n}\n\nRAN-AreaConfig ::=                  SEQUENCE {\n    trackingAreaCode            TrackingAreaCode,\n    ran-AreaCodeList            SEQUENCE (SIZE (1..32)) OF  RAN-AreaCode        OPTIONAL    -- Need R\n}\n\n-- TAG-RRCRELEASE-STOP\n-- ASN1STOP\n\nRRCRelease-IEs field descriptions\ncnType\tIndicate that the UE is redirected to EPC or 5GC.\ndeprioritisationReq\tIndicates whether the current frequency or RAT is to be de-prioritised.\ndeprioritisationTimer\tIndicates the period for which either the current carrier frequency or NR is deprioritised. Value minN corresponds to N minutes.\nsuspendConfig\tIndicates configuration for the RRC_INACTIVE state.\nredirectedCarrierInfo\tIndicates a carrier frequency (downlink for FDD) and is used to redirect the UE to an NR or an inter-RAT carrier frequency, by means of cell selection at transition to RRC_IDLE or RRC_INACTIVE as specified in TS 38.304 [20]\n\nCarrierInfoNR field descriptions\ncarrierFreq\tIndicates the redirected NR frequency.\nssbSubcarrierSpacing\tSubcarrier spacing of SSB in the redirected SSB frequency. Only the values 15 kHz or 30 kHz (<6 GHz), 120 kHz or 240 kHz (>6 GHz) are applicable.\nsmtc\tThe SSB periodicity/offset/duration configuration for the redirected SSB frequency. It is based on timing reference of PCell. If the field is absent, the UE uses the SMTC configured in the measObjectNR having the same SSB frequency and subcarrier spacing.\n\nRAN-NotificationAreaInfo field descriptions\ncellList\tA list of cells configured as RAN area.\nran-AreaConfigList\tA list of RAN area codes or RA code(s) as RAN area.\n\nPLMN-RAN-AreaConfig field descriptions\nplmn-Identity\tPLMN Identity to which the cells in ran-Area belong. If the field is absent the UE uses the ID of the registered PLMN.\nran-AreaCodeList\tThe total number of RAN-AreaCodes of all PLMNs does not exceed 32.\nran-Area\tIndicates whether TA code(s) or RAN area code(s) are used for the RAN notification area. The network uses only TA code(s) or RAN area code(s) to configure a UE. The total number of TACs across all PLMNs does not exceed 16.\n\nPLMN-RAN-AreaCell field descriptions\nplmn-Identity\tPLMN Identity to which the cells in ran-AreaCells belong. If the field is absent the UE uses the ID of the registered PLMN.\nran-AreaCells\tThe total number of cells of all PLMNs does not exceed 32.\n\nSuspendConfig field descriptions\nran-NotificationAreaInfo\tNetwork ensures that the UE in RRC_INACTIVE always has a valid ran-NotificationAreaInfo.\nran-PagingCycle\tRefers to the UE specific cycle for RAN-initiated paging. Value rf32 corresponds to 32 radio frames, value rf64 corresponds to 64 radio frames and so on.\nt380\tRefers to the timer that triggers the periodic RNAU procedure in UE. Value min5 corresponds to 5 minutes, value min10 corresponds to 10 minutes and so on.\n\n\u2013\tRRCResume\nThe RRCResume message is used to resume the suspended RRC connection.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nRRCResume message\n-- ASN1START\n-- TAG-RRCRESUME-START\n\nRRCResume ::=                       SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcResume                           RRCResume-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCResume-IEs ::=                   SEQUENCE {\n    radioBearerConfig                   RadioBearerConfig                                                       OPTIONAL, -- Need M\n    masterCellGroup                     OCTET STRING (CONTAINING CellGroupConfig)                               OPTIONAL, -- Need M\n    measConfig                          MeasConfig                                                              OPTIONAL, -- Need M\n    fullConfig                          ENUMERATED {true}                                                       OPTIONAL, -- Need N\n\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n\n}\n\n-- TAG-RRCRESUME-STOP\n-- ASN1STOP\n\nRRCResume-IEs field descriptions\nmasterCellGroup\tConfiguration of the master cell group (NR Standalone):\nradioBearerConfig\tConfiguration of Radio Bearers (DRBs, SRBs) including SDAP/PDCP.\n\n\u2013\tRRCResumeComplete\nThe RRCResumeComplete message is used to confirm the successful completion of an RRC connection resumption.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nRRCResumeComplete message\n-- ASN1START\n-- TAG-RRCRESUMECOMPLETE-START\n\nRRCResumeComplete ::=                   SEQUENCE {\n    rrc-TransactionIdentifier               RRC-TransactionIdentifier,\n    criticalExtensions                      CHOICE {\n        rrcResumeComplete                       RRCResumeComplete-IEs,\n        criticalExtensionsFuture                SEQUENCE {}\n    }\n}\n\nRRCResumeComplete-IEs ::=               SEQUENCE {\n    dedicatedNAS-Message                    DedicatedNAS-Message                                                    OPTIONAL,\n    selectedPLMN-Identity                   INTEGER (1..maxPLMN)                                                    OPTIONAL,\n    uplinkTxDirectCurrentList               UplinkTxDirectCurrentList                                               OPTIONAL,\n    lateNonCriticalExtension                OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                    SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-RRCRESUMECOMPLETE-STOP\n-- ASN1STOP\n\nRRCResumeComplete-IEs field descriptions\nselectedPLMN-Identity\tIndex of the PLMN selected by the UE from the plmn-IdentityList fields included in SIB1.\nuplinkTxDirectCurrentList\tThe Tx Direct Current locations for the configured serving cells and BWPs if requested by the NW (see reportUplinkTxDirectCurrent in CellGroupConfig).\n\n\u2013\tRRCResumeRequest\nThe RRCResumeRequest is the 48 bit message used to request the resumption of a suspended RRC connection or perform an RNA update.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: UE to Network\nRRCResumeRequest message\n-- ASN1START\n-- TAG-RRCRESUMEREQUEST-START\n\nRRCResumeRequest ::=            SEQUENCE {\n        rrcResumeRequest            RRCResumeRequest-IEs\n}\n\nRRCResumeRequest-IEs ::=        SEQUENCE {\n    resumeIdentity                  ShortI-RNTI-Value,\n    resumeMAC-I                     BIT STRING (SIZE (16)),\n    resumeCause                     ResumeCause,\n    spare                           BIT STRING (SIZE (1))\n}\n\n-- TAG-RRCRESUMEREQUEST-STOP\n-- ASN1STOP\n\nRRCResumeRequest-IEs field descriptions\nresumeCause\tProvides the resume cause for the RRC connection resume request as provided by the upper layers or RRC. The network is not expected to reject an RRCResumeRequest due to unknown cause value being used by the UE.\nresumeIdentity\tUE identity to facilitate UE context retrieval at gNB.\nresumeMAC-I\tAuthentication token to facilitate UE authentication at gNB. The 16 least significant bits of the MAC-I calculated using the AS security configuration as specified in 5.3.13.3.\n\n\u2013\tRRCResumeRequest1\nThe RRCResumeRequest1 is the 64-bits message used to request the resumption of a suspended RRC connection or perform an RNA update.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH1\nDirection: UE to Network\nRRCResumeRequest1 message\n-- ASN1START\n-- TAG-RRCRESUMEREQUEST1-START\n\nRRCResumeRequest1 ::= SEQUENCE {\n       rrcResumeRequest1      RRCResumeRequest1-IEs\n}\n\nRRCResumeRequest1-IEs ::=    SEQUENCE {\n    resumeIdentity               I-RNTI-Value,\n    resumeMAC-I                  BIT STRING (SIZE (16)),\n    resumeCause                  ResumeCause,\n    spare                        BIT STRING (SIZE (1))\n}\n\n-- TAG-RRCRESUMEREQUEST1-STOP\n-- ASN1STOP\n\nRRCResumeRequest1-IEs field descriptions\nresumeCause\tProvides the resume cause for the RRCResumeRequest1 as provided by the upper layers or RRC. A gNB is not expected to reject an RRCResumeRequest1 due to unknown cause value being used by the UE.\nresumeIdentity\tUE identity to facilitate UE context retrieval at gNB.\nresumeMAC-I\tAuthentication token to facilitate UE authentication at gNB. The 16 least significant bits of the MAC-I calculated using the AS security configuration as specified in 5.3.13.3.\n\n\u2013\tRRCSetup\nThe RRCSetup message is used to establish SRB1.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: Network to UE\nRRCSetup message\n-- ASN1START\n-- TAG-RRCSETUP-START\n\nRRCSetup ::=                        SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcSetup                            RRCSetup-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCSetup-IEs ::=                    SEQUENCE {\n    radioBearerConfig                   RadioBearerConfig,\n    masterCellGroup                     OCTET STRING (CONTAINING CellGroupConfig),\n\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-RRCSETUP-STOP\n-- ASN1STOP\n\nRRCSetup-IEs field descriptions\nmasterCellGroup\tThe network configures only the RLC bearer for the SRB1, mac-CellGroupConfig, physicalCellGroupConfig and spCellConfig.\nradioBearerConfig\tOnly SRB1 can be configured in RRC setup.\n\n\u2013\tRRCSetupComplete\nThe RRCSetupComplete message is used to confirm the successful completion of an RRC connection establishment.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nRRCSetupComplete message\n-- ASN1START\n-- TAG-RRCSETUPCOMPLETE-START\n\nRRCSetupComplete ::=                SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcSetupComplete                    RRCSetupComplete-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCSetupComplete-IEs ::=            SEQUENCE {\n    selectedPLMN-Identity               INTEGER (1..maxPLMN),\n    registeredAMF                       RegisteredAMF                                   OPTIONAL,\n    guami-Type                          ENUMERATED {native, mapped}                     OPTIONAL,\n    s-NSSAI-List                        SEQUENCE (SIZE (1..maxNrofS-NSSAI)) OF S-NSSAI  OPTIONAL,\n    dedicatedNAS-Message                DedicatedNAS-Message,\n    ng-5G-S-TMSI-Value                  CHOICE {\n        ng-5G-S-TMSI                        NG-5G-S-TMSI,\n        ng-5G-S-TMSI-Part2                  BIT STRING (SIZE (9))\n    }                                                                                   OPTIONAL,\n    lateNonCriticalExtension            OCTET STRING                                    OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                      OPTIONAL\n}\n\nRegisteredAMF ::=                   SEQUENCE {\n    plmn-Identity                       PLMN-Identity                                   OPTIONAL,\n    amf-Identifier                      AMF-Identifier\n}\n\n-- TAG-RRCSETUPCOMPLETE-STOP\n-- ASN1STOP\n\nRRCSetupComplete-IEs field descriptions\nguami-Type\tThis field is used to indicate whether the GUAMI included is native (derived from native 5G-GUTI) or mapped (from EPS, derived from EPS GUTI) as specified in TS 24.501 [23].\nng-5G-S-TMSI-Part2\tThe leftmost 9 bits of 5G-S-TMSI.\nregisteredAMF\tThis field is used to transfer the GUAMI of the AMF where the UE is registered, as provided by upper layers, see TS 23.003 [21].\nselectedPLMN-Identity\tIndex of the PLMN selected by the UE from the plmn-IdentityList fields included in SIB1.\n\n\u2013\tRRCSetupRequest\nThe RRCSetupRequest message is used to request the establishment of an RRC connection.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: UE to Network\nRRCSetupRequest message\n-- ASN1START\n-- TAG-RRCSETUPREQUEST-START\n\nRRCSetupRequest ::=                 SEQUENCE {\n    rrcSetupRequest                     RRCSetupRequest-IEs\n}\n\nRRCSetupRequest-IEs ::=             SEQUENCE {\n    ue-Identity                         InitialUE-Identity,\n    establishmentCause                  EstablishmentCause,\n    spare                               BIT STRING (SIZE (1))\n}\n\nInitialUE-Identity ::=              CHOICE {\n    ng-5G-S-TMSI-Part1                  BIT STRING (SIZE (39)),\n    randomValue                         BIT STRING (SIZE (39))\n}\n\nEstablishmentCause ::=              ENUMERATED {\n                                        emergency, highPriorityAccess, mt-Access, mo-Signalling,\n                                        mo-Data, mo-VoiceCall, mo-VideoCall, mo-SMS, mps-PriorityAccess, mcs-PriorityAccess,\n                                        spare6, spare5, spare4, spare3, spare2, spare1}\n\n-- TAG-RRCSETUPREQUEST-STOP\n-- ASN1STOP\n\nRRCSetupRequest-IEs field descriptions\nestablishmentCause\tProvides the establishment cause for the RRCSetupRequest in accordance with the information received from upper layers. gNB is not expected to reject an RRCSetupRequest due to unknown cause value being used by the UE.\nue-Identity\tUE identity included to facilitate contention resolution by lower layers.\n\nInitialUE-Identity field descriptions\nng-5G-S-TMSI-Part1\tThe rightmost 39 bits of 5G-S-TMSI.\nrandomValue\tInteger value in the range 0 to 239 \u2013 1.\n\n\u2013\tRRCSystemInfoRequest\nThe RRCSystemInfoRequest message is used to request SI message(s) required by the UE as specified in section 5.2.2.3.3.\nSignalling radio bearer: SRB0\nRLC-SAP: TM\nLogical channel: CCCH\nDirection: UE to Network\nRRCSystemInfoRequest message\n-- ASN1START\n-- TAG-RRCSYSTEMINFOREQUEST-START\n\nRRCSystemInfoRequest ::=            SEQUENCE {\n    criticalExtensions                  CHOICE {\n        rrcSystemInfoRequest-r15            RRCSystemInfoRequest-r15-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCSystemInfoRequest-r15-IEs ::=    SEQUENCE {\n    requested-SI-List                   BIT STRING (SIZE (maxSI-Message)),  --32bits\n    spare                               BIT STRING (SIZE (12))\n}\n\n-- TAG-RRCSYSTEMINFOREQUEST-STOP\n-- ASN1STOP\n\nRRCSystemInfoRequest-r15-IEs field descriptions\nrequested-SI-List\tContains a list of requested SI messages. According to the order of entry in the list of SI messages configured by schedulingInfoList in si-SchedulingInfo in SIB1, first bit corresponds to first/leftmost listed SI message, second bit corresponds to second listed SI message, and so on.\n\n\u2013\tSecurityModeCommand\nThe SecurityModeCommand message is used to command the activation of AS security.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nSecurityModeCommand message\n-- ASN1START\n-- TAG-SECURITYMODECOMMAND-START\n\nSecurityModeCommand ::=             SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        securityModeCommand                 SecurityModeCommand-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nSecurityModeCommand-IEs ::=         SEQUENCE {\n    securityConfigSMC                   SecurityConfigSMC,\n\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\nSecurityConfigSMC ::=               SEQUENCE {\n    securityAlgorithmConfig             SecurityAlgorithmConfig,\n    ...\n}\n\n-- TAG-SECURITYMODECOMMAND-STOP\n-- ASN1STOP\n\n\u2013\tSecurityModeComplete\nThe SecurityModeComplete message is used to confirm the successful completion of a security mode command.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nSecurityModeComplete message\n-- ASN1START\n-- TAG-SECURITYMODECOMPLETE-START\n\nSecurityModeComplete ::=            SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        securityModeComplete                SecurityModeComplete-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nSecurityModeComplete-IEs ::=        SEQUENCE {\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-SECURITYMODECOMPLETE-STOP\n-- ASN1STOP\n\n\u2013\tSecurityModeFailure\nThe SecurityModeFailure message is used to indicate an unsuccessful completion of a security mode command.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nSecurityModeFailure message\n-- ASN1START\n-- TAG-SECURITYMODEFAILURE-START\n\nSecurityModeFailure ::=             SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        securityModeFailure                 SecurityModeFailure-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nSecurityModeFailure-IEs ::=         SEQUENCE {\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-SECURITYMODEFAILURE-STOP\n-- ASN1STOP\n\n\u2013\tSIB1\nSIB1 contains information relevant when evaluating if a UE is allowed to access a cell and defines the scheduling of other system information. It also contains radio resource configuration information that is common for all UEs and barring information applied to the unified access control.\nSignalling radio bearer: N/A\nRLC-SAP: TM\nLogical channels: BCCH\nDirection: Network to UE\nSIB1 message\n-- ASN1START\n-- TAG-SIB1-START\n\nSIB1 ::=        SEQUENCE {\n    cellSelectionInfo                   SEQUENCE {\n        q-RxLevMin                          Q-RxLevMin,\n        q-RxLevMinOffset                    INTEGER (1..8)                                              OPTIONAL,   -- Need S\n        q-RxLevMinSUL                       Q-RxLevMin                                                  OPTIONAL,   -- Need R\n        q-QualMin                           Q-QualMin                                                   OPTIONAL,   -- Need S\n        q-QualMinOffset                     INTEGER (1..8)                                              OPTIONAL    -- Need S\n    }                                                                                                   OPTIONAL,   -- Cond Standalone\n    cellAccessRelatedInfo               CellAccessRelatedInfo,\n    connEstFailureControl               ConnEstFailureControl                                           OPTIONAL,   -- Need R\n    si-SchedulingInfo                   SI-SchedulingInfo                                               OPTIONAL,   -- Need R\n    servingCellConfigCommon             ServingCellConfigCommonSIB                                      OPTIONAL,   -- Need R\n    ims-EmergencySupport                ENUMERATED {true}                                               OPTIONAL,   -- Need R\n    eCallOverIMS-Support                ENUMERATED {true}                                               OPTIONAL,   -- Cond Absent\n    ue-TimersAndConstants               UE-TimersAndConstants                                           OPTIONAL,   -- Need R\n\n    uac-BarringInfo                     SEQUENCE {\n        uac-BarringForCommon                UAC-BarringPerCatList                                       OPTIONAL,   -- Need S\n        uac-BarringPerPLMN-List             UAC-BarringPerPLMN-List                                     OPTIONAL,   -- Need S\n        uac-BarringInfoSetList              UAC-BarringInfoSetList,\n        uac-AccessCategory1-SelectionAssistanceInfo CHOICE {\n            plmnCommon                           UAC-AccessCategory1-SelectionAssistanceInfo,\n            individualPLMNList                   SEQUENCE (SIZE (2..maxPLMN)) OF UAC-AccessCategory1-SelectionAssistanceInfo\n        }                                                                                               OPTIONAL    -- Need S\n    }                                                                                                   OPTIONAL,   -- Need R\n\n    useFullResumeID                     ENUMERATED {true}                                               OPTIONAL,   -- Need N\n\n    lateNonCriticalExtension            OCTET STRING                                                    OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                      OPTIONAL\n}\n\nUAC-AccessCategory1-SelectionAssistanceInfo ::=    ENUMERATED {a, b, c}\n\n-- TAG-SIB1-STOP\n-- ASN1STOP\n\nSIB1 field descriptions\ncellSelectionInfo\tParameters for cell selection related to the serving cell.\nims-EmergencySupport\tIndicates whether the cell supports IMS emergency bearer services for UEs in limited service mode. If absent, IMS emergency call is not supported by the network in the cell for UEs in limited service mode.\nq-QualMin\tParameter \"Qqualmin\" in TS 38.304 [20], applicable for serving cell. If the field is not present, the UE applies the (default) value of negative infinity for Qqualmin.  \nq-QualMinOffset\tParameter \"Qqualminoffset\" in TS 38.304 [20]. Actual value Qqualminoffset = field value [dB]. If the field is not present, the UE applies the (default) value of 0 dB for Qqualminoffset. Affects the minimum required quality level in the cell.\nq-RxLevMin\tParameter \"Qrxlevmin\" in TS 38.304 [20], applicable for serving cell.\nq-RxLevMinOffset\tParameter \"Qrxlevminoffset\" in TS 38.304 [20]. Actual value Qrxlevminoffset = field value * 2 [dB]. If absent, the UE applies the (default) value of 0 dB for Qrxlevminoffset. Affects the minimum required Rx level in the cell.\nq-RxLevMinSUL\tParameter \"QrxlevminSUL\" in TS 38.304 [20], applicable for serving cell.\nservingCellConfigCommon\tConfiguration of the serving cell.\nuac-AccessCategory1-SelectionAssistanceInfo\tInformation used to determine whether Access Category 1 applies to the UE, as defined in TS 22.261 [25].\nuac-BarringForCommon\tCommon access control parameters for each access category. Common values are used for all PLMNs, unless overwritten by the PLMN specific configuration provided in uac-BarringPerPLMN-List. The parameters are specified by providing an index to the set of configurations (uac-BarringInfoSetList). UE behaviour upon absence of this field is specified in clause 5.3.14.2.\nue-TimersAndConstants\tTimer and constant values to be used by the UE.\nuseFullResumeID\tIndicates which resume identifier and Resume request message should be used. UE uses fullI-RNTI and RRCResumeRequest1 if the field is present, or shortI-RNTI and RRCResumeRequest if the field is absent.\n\nConditional Presence\tExplanation\nAbsent\tThe field is not used in this version of the specification, if received the UE shall ignore. \nStandalone\tThe field is mandatory present in a cell that supports standalone operation, otherwise it is not present \n\n\u2013\tSystemInformation\nThe SystemInformation message is used to convey one or more System Information Blocks. All the SIBs included are transmitted with the same periodicity.\nSignalling radio bearer: N/A\nRLC-SAP: TM\nLogical channels: BCCH\nDirection: Network to UE\nSystemInformation message\n-- ASN1START\n-- TAG-SYSTEMINFORMATION-START\n\nSystemInformation ::=               SEQUENCE {\n    criticalExtensions                  CHOICE {\n        systemInformation-r15               SystemInformation-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nSystemInformation-IEs ::=           SEQUENCE {\n    sib-TypeAndInfo                     SEQUENCE (SIZE (1..maxSIB)) OF CHOICE {\n        sib2                                SIB2,\n        sib3                                SIB3,\n        sib4                                SIB4,\n        sib5                                SIB5,\n        sib6                                SIB6,\n        sib7                                SIB7,\n        sib8                                SIB8,\n        sib9                                SIB9,\n        ...\n    },\n\n    lateNonCriticalExtension            OCTET STRING                        OPTIONAL,\n    nonCriticalExtension                SEQUENCE {}                         OPTIONAL\n}\n\n-- TAG-SYSTEMINFORMATION-STOP\n-- ASN1STOP\n\n\u2013\tUEAssistanceInformation\nThe UEAssistanceInformation message is used for the indication of UE assistance information to the network.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nUEAssistanceInformation message\n-- ASN1START\n-- TAG-UEASSISTANCEINFORMATION-START\n\nUEAssistanceInformation ::=         SEQUENCE {\n    criticalExtensions                  CHOICE {\n        ueAssistanceInformation             UEAssistanceInformation-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nUEAssistanceInformation-IEs ::=     SEQUENCE {\n    delayBudgetReport                   DelayBudgetReport                   OPTIONAL,\n    lateNonCriticalExtension            OCTET STRING                        OPTIONAL,\n    nonCriticalExtension                UEAssistanceInformation-v1540-IEs   OPTIONAL\n}\n\nDelayBudgetReport::=                CHOICE {\n    type1                               ENUMERATED {\n                                            msMinus1280, msMinus640, msMinus320, msMinus160,msMinus80, msMinus60, msMinus40,\n                                            msMinus20, ms0, ms20,ms40, ms60, ms80, ms160, ms320, ms640, ms1280},\n    ...\n}\n\nUEAssistanceInformation-v1540-IEs ::= SEQUENCE {\n    overheatingAssistance               OverheatingAssistance               OPTIONAL,\n    nonCriticalExtension                SEQUENCE {}                         OPTIONAL\n}\n\nOverheatingAssistance ::=           SEQUENCE {\n    reducedMaxCCs                       SEQUENCE {\n        reducedCCsDL                        INTEGER (0..31),\n        reducedCCsUL                        INTEGER (0..31)\n    } OPTIONAL,\n    reducedMaxBW-FR1                    SEQUENCE {\n        reducedBW-FR1-DL                    ReducedAggregatedBandwidth,\n        reducedBW-FR1-UL                    ReducedAggregatedBandwidth\n    } OPTIONAL,\n    reducedMaxBW-FR2                    SEQUENCE {\n        reducedBW-FR2-DL                    ReducedAggregatedBandwidth,\n        reducedBW-FR2-UL                    ReducedAggregatedBandwidth\n    } OPTIONAL,\n    reducedMaxMIMO-LayersFR1            SEQUENCE {\n        reducedMIMO-LayersFR1-DL            MIMO-LayersDL,\n        reducedMIMO-LayersFR1-UL            MIMO-LayersUL\n    } OPTIONAL,\n    reducedMaxMIMO-LayersFR2            SEQUENCE {\n        reducedMIMO-LayersFR2-DL            MIMO-LayersDL,\n        reducedMIMO-LayersFR2-UL            MIMO-LayersUL\n    } OPTIONAL\n}\n\nReducedAggregatedBandwidth ::= ENUMERATED {mhz0, mhz10, mhz20, mhz30, mhz40, mhz50, mhz60, mhz80, mhz100, mhz200, mhz300, mhz400}\n\n-- TAG-UEASSISTANCEINFORMATION-STOP\n-- ASN1STOP\n\nUEAssistanceInformation field descriptions\ndelayBudgetReport\tIndicates the UE-preferred adjustment to connected mode DRX.\nreducedBW-FR1-DL\tIndicates the UE's preference on reduced configuration corresponding to the maximum aggregated bandwidth across all downlink carriers of FR1 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR1.\nreducedBW-FR1-UL\tIndicates the UE's preference on reduced configuration corresponding to the maximum aggregated bandwidth across all uplink carriers of FR1 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR1.\nreducedBW-FR2-DL\tIndicates the UE's preference on reduced configuration corresponding to the maximum aggregated bandwidth across all downlink carriers of FR2 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR2. Value mhz0 is only applicable for FR2.\nreducedBW-FR2-UL\tIndicates the UE's preference on reduced configuration corresponding to the maximum aggregated bandwidth across all uplink carriers of FR2 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR2. Value mhz0 is only applicable for FR2.\nreducedCCsDL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of downlink SCells indicated by the field, to address overheating.\nreducedCCsUL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of uplink SCells indicated by the field, to address overheating.\nreducedMIMO-LayersFR1-DL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of downlink MIMO layers of each serving cell operating on FR1 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR1.\nreducedMIMO-LayersFR1-UL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of uplink MIMO layers of each serving cell operating on FR1 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR1.\nreducedMIMO-LayersFR2-DL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of downlink MIMO layers of each serving cell operating on FR2 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR2.\nreducedMIMO-LayersFR2-UL\tIndicates the UE's preference on reduced configuration corresponding to the maximum number of uplink MIMO layers of each serving cell operating on FR2 indicated by the field, to address overheating. This field is allowed to be reported only when UE is configured with serving cells operating on FR2.\ntype1\tIndicates the preferred amount of increment/decrement to the long DRX cycle length with respect to the current configuration. Value in number of milliseconds. Value ms40 corresponds to 40 milliseconds, msMinus40 corresponds to -40 milliseconds and so on.\n\n\u2013\tUECapabilityEnquiry\nThe UECapabilityEnquiry message is used to request UE radio access capabilities for NR as well as for other RATs.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nUECapabilityEnquiry information element\n-- ASN1START\n-- TAG-UECAPABILITYENQUIRY-START\n\nUECapabilityEnquiry ::=         SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        ueCapabilityEnquiry                 UECapabilityEnquiry-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nUECapabilityEnquiry-IEs ::=     SEQUENCE {\n    ue-CapabilityRAT-RequestList        UE-CapabilityRAT-RequestList,\n\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-UECAPABILITYENQUIRY-STOP\n-- ASN1STOP\n\n\u2013\tUECapabilityInformation\nThe IE UECapabilityInformation message is used to transfer UE radio access capabilities requested by the network.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to Network\nUECapabilityInformation information element\n-- ASN1START\n-- TAG-UECAPABILITYINFORMATION-START\n\nUECapabilityInformation ::=         SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        ueCapabilityInformation             UECapabilityInformation-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nUECapabilityInformation-IEs ::=     SEQUENCE {\n    ue-CapabilityRAT-ContainerList      UE-CapabilityRAT-ContainerList                                          OPTIONAL,\n\n    lateNonCriticalExtension            OCTET STRING                                                            OPTIONAL,\n    nonCriticalExtension                SEQUENCE{}                                                              OPTIONAL\n}\n\n-- TAG-UECAPABILITYINFORMATION-STOP\n-- ASN1STOP\n\n\u2013\tULInformationTransfer\nThe ULInformationTransfer message is used for the uplink transfer of NAS or non-3GPP dedicated information.\nSignalling radio bearer: SRB2 or SRB1 (only if SRB2 not established yet). If SRB2 is suspended, the UE does not send this message until SRB2 is resumed\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: UE to network\nULInformationTransfer message\n-- ASN1START\n-- TAG-ULINFORMATIONTRANSFER-START\n\nULInformationTransfer ::=           SEQUENCE {\n    criticalExtensions                  CHOICE {\n        ulInformationTransfer               ULInformationTransfer-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nULInformationTransfer-IEs ::=       SEQUENCE {\n    dedicatedNAS-Message                DedicatedNAS-Message                OPTIONAL,\n    lateNonCriticalExtension            OCTET STRING                        OPTIONAL,\n    nonCriticalExtension                SEQUENCE {}                         OPTIONAL\n}\n\n-- TAG-ULINFORMATIONTRANSFER-STOP\n-- ASN1STOP\n\n6.3\tRRC information elements\n6.3.0\tParameterized types\n\u2013\tSetupRelease\nSetupRelease allows the ElementTypeParam to be used as the referenced data type for the setup and release entries. See A.3.8 for guidelines.\n-- ASN1START\n-- TAG-SETUPRELEASE-START\n\nSetupRelease { ElementTypeParam } ::= CHOICE {\n    release         NULL,\n    setup           ElementTypeParam\n}\n\n-- TAG-SETUPRELEASE-STOP\n-- ASN1STOP\n\n6.3.1\tSystem information blocks\n\u2013\tSIB2\nSIB2 contains cell re-selection information common for intra-frequency, inter-frequency and/or inter-RAT cell re-selection (i.e. applicable for more than one type of cell re-selection but not necessarily all) as well as intra-frequency cell re-selection information other than neighbouring cell related.\nSIB2 information element\n-- ASN1START\n-- TAG-SIB2-START\n\nSIB2 ::=                            SEQUENCE {\n    cellReselectionInfoCommon           SEQUENCE {\n        nrofSS-BlocksToAverage              INTEGER (2..maxNrofSS-BlocksToAverage)          OPTIONAL,       -- Need R\n        absThreshSS-BlocksConsolidation     ThresholdNR                                     OPTIONAL,       -- Need R\n        rangeToBestCell                     RangeToBestCell                                 OPTIONAL,       -- Need R\n        q-Hyst                              ENUMERATED {\n                                                dB0, dB1, dB2, dB3, dB4, dB5, dB6, dB8, dB10,\n                                                dB12, dB14, dB16, dB18, dB20, dB22, dB24},\n        speedStateReselectionPars           SEQUENCE {\n            mobilityStateParameters             MobilityStateParameters,\n            q-HystSF                        SEQUENCE {\n                sf-Medium                       ENUMERATED {dB-6, dB-4, dB-2, dB0},\n                sf-High                         ENUMERATED {dB-6, dB-4, dB-2, dB0}\n            }\n        }                                                                                   OPTIONAL,       -- Need R\n    ...\n    },\n    cellReselectionServingFreqInfo      SEQUENCE {\n        s-NonIntraSearchP                   ReselectionThreshold                            OPTIONAL,       -- Need R\n        s-NonIntraSearchQ                   ReselectionThresholdQ                           OPTIONAL,       -- Need R\n        threshServingLowP                   ReselectionThreshold,\n        threshServingLowQ                   ReselectionThresholdQ                           OPTIONAL,       -- Need R\n        cellReselectionPriority             CellReselectionPriority,\n        cellReselectionSubPriority          CellReselectionSubPriority                      OPTIONAL,       -- Need R\n        ...\n    },\n    intraFreqCellReselectionInfo        SEQUENCE {\n        q-RxLevMin                          Q-RxLevMin,\n        q-RxLevMinSUL                       Q-RxLevMin                                      OPTIONAL,       -- Need R\n        q-QualMin                           Q-QualMin                                       OPTIONAL,       -- Need S\n        s-IntraSearchP                      ReselectionThreshold,\n        s-IntraSearchQ                      ReselectionThresholdQ                           OPTIONAL,       -- Cond RSRQ\n        t-ReselectionNR                     T-Reselection,\n        frequencyBandList                   MultiFrequencyBandListNR-SIB                    OPTIONAL,       -- Need S\n        frequencyBandListSUL                MultiFrequencyBandListNR-SIB                    OPTIONAL,       -- Need R\n        p-Max                               P-Max                                           OPTIONAL,       -- Need R\n        smtc                                SSB-MTC                                         OPTIONAL,       -- Need R\n        ss-RSSI-Measurement                 SS-RSSI-Measurement                             OPTIONAL,       -- Need R\n        ssb-ToMeasure                       SSB-ToMeasure                                   OPTIONAL,       -- Need R\n        deriveSSB-IndexFromCell             BOOLEAN,\n        ...,\n        [[\n        t-ReselectionNR-SF                  SpeedStateScaleFactors                          OPTIONAL        -- Need N\n        ]]\n    },\n    ...\n}\n\nRangeToBestCell    ::= Q-OffsetRange\n\n-- TAG-SIB2-STOP\n-- ASN1STOP\n\nSIB2 field descriptions\nabsThreshSS-BlocksConsolidation\tThreshold for consolidation of L1 measurements per RS index. If the field is absent, the UE uses the measurement quantity as specified in TS 38.304 [20].\ncellReselectionInfoCommon\tCell re-selection information common for intra-frequency, inter-frequency and/ or inter-RAT cell re-selection. The fields absThreshSS-BlocksConsolidation and nrofSS-BlocksToAverage are only applied to intra-frequency cell reselection.\ncellReselectionServingFreqInfo\tInformation common for non-intra-frequency cell re-selection i.e. cell re-selection to inter-frequency and inter-RAT cells.\nderiveSSB-IndexFromCell\tThis field indicates whether the UE can utilize serving cell timing to derive the index of SS block transmitted by neighbour cell. If this field is set to true, the UE assumes SFN and frame boundary alignment across cells on the serving frequency as specified in TS 38.133 [14].\nfrequencyBandList\tIndicates the list of frequency bands for which the NR cell reselection parameters apply. The UE behaviour in case the field is absent is described in subclause 5.2.2.4.3.\nintraFreqCellReselectionInfo\tCell re-selection information common for intra-frequency cells.\nnrofSS-BlocksToAverage\tNumber of SS blocks to average for cell measurement derivation. If the field is absent the UE uses the measurement quantity as specified in TS 38.304 [20].\np-Max\tValue in dBm applicable for the intra-frequency neighbouring NR cells. If absent the UE applies the maximum power according to TS 38.101-1 [15]. \nq-Hyst\tParameter \"Qhyst\" in TS 38.304 [20], Value in dB. Value dB1 corresponds to 1 dB, dB2 corresponds to 2 dB and so on.\nq-HystSF\tParameter \"Speed dependent ScalingFactor for Qhyst\" in TS 38.304 [20]. The sf-Medium and sf-High concern the additional hysteresis to be applied, in Medium and High Mobility state respectively, to Qhyst as defined in TS 38.304 [20]. In dB. Value dB-6 corresponds to -6dB, dB-4 corresponds to -4dB and so on.\nq-QualMin\tParameter \"Qqualmin\" in TS 38.304 [20], applicable for intra-frequency neighbour cells. If the field is not present, the UE applies the (default) value of negative infinity for Qqualmin.  \nq-RxLevMin\tParameter \"Qrxlevmin\" in TS 38.304 [20], applicable for intra-frequency neighbour cells.\nq-RxLevMinSUL\tParameter \"QrxlevminSUL\" in TS 38.304 [20], applicable for intra-frequency neighbour cells.\nrangeToBestCell\tParameter \"rangeToBestCell\" in TS 38.304 [20]. The network configures only non-negative (in dB) values.\ns-IntraSearchP\tParameter \"SIntraSearchP\" in TS 38.304 [20].\ns-IntraSearchQ\tParameter \"SIntraSearchQ2 in TS 38.304 [20]. If the field is not present, the UE applies the (default) value of 0 dB for SIntraSearchQ.\ns-NonIntraSearchP\tParameter \"SnonIntraSearchP\" in TS 38.304 [20]. If this field is not present, the UE applies the (default) value of infinity for SnonIntraSearchP.\ns-NonIntraSearchQ\tParameter \"SnonIntraSearchQ\" in TS 38.304 [20]. If the field is not present, the UE applies the (default) value of 0 dB for SnonIntraSearchQ.\nsmtc\tMeasurement timing configuration for intra-frequency measurement. If this field is absent, the UE assumes that SSB periodicity is 5 ms for the intra-frequnecy cells.\nssb-ToMeasure\tThe set of SS blocks to be measured within the SMTC measurement duration (see TS 38.215 [9]). When the field is absent the UE measures on all SS-blocks.\nt-ReselectionNR\tParameter \"TreselectionNR\" in TS 38.304 [20].\nt-ReselectionNR-SF\tParameter \"Speed dependent ScalingFactor for TreselectionNR\" in TS 38.304 [20]. If the field is not present, the UE behaviour is specified in TS 38.304 [20].\nthreshServingLowP\tParameter \"ThreshServing, LowP\" in TS 38.304 [20].\nthreshServingLowQ\tParameter \"ThreshServing, LowQ\" in TS 38.304 [20].\n\nConditional Presence\tExplanation\nRSRQ\tThe field is optionally present, Need R, if threshServingLowQ is present in SIB2; otherwise it is not present. \n\n\u2013\tSIB3\nSIB3 contains neighbouring cell related information relevant only for intra-frequency cell re-selection. The IE includes cells with specific re-selection parameters as well as blacklisted cells.\nSIB3 information element\n-- ASN1START\n-- TAG-SIB3-START\n\nSIB3 ::=                            SEQUENCE {\n    intraFreqNeighCellList              IntraFreqNeighCellList      OPTIONAL,   -- Need R\n    intraFreqBlackCellList              IntraFreqBlackCellList      OPTIONAL,   -- Need R\n    lateNonCriticalExtension            OCTET STRING                OPTIONAL,\n    ...\n}\n\nIntraFreqNeighCellList ::=          SEQUENCE (SIZE (1..maxCellIntra)) OF IntraFreqNeighCellInfo\n\nIntraFreqNeighCellInfo ::=          SEQUENCE {\n    physCellId                          PhysCellId,\n    q-OffsetCell                        Q-OffsetRange,\n    q-RxLevMinOffsetCell                INTEGER (1..8)              OPTIONAL,   -- Need R\n    q-RxLevMinOffsetCellSUL             INTEGER (1..8)              OPTIONAL,   -- Need R\n    q-QualMinOffsetCell                 INTEGER (1..8)              OPTIONAL,   -- Need R\n    ...\n}\n\nIntraFreqBlackCellList ::=          SEQUENCE (SIZE (1..maxCellBlack)) OF PCI-Range\n\n-- TAG-SIB3-STOP\n-- ASN1STOP\n\nSIB3 field descriptions\nintraFreqBlackCellList\tList of blacklisted intra-frequency neighbouring cells.\nintraFreqNeighCellList\tList of intra-frequency neighbouring cells with specific cell re-selection parameters.\nq-OffsetCell\tParameter \"Qoffsets,n\" in TS 38.304 [20].\nq-QualMinOffsetCell\tParameter \"Qqualminoffsetcell\" in TS 38.304 [20]. Actual value Qqualminoffsetcell = field value [dB].\nq-RxLevMinOffsetCell\tParameter \"Qrxlevminoffsetcell\" in TS 38.304 [20]. Actual value Qrxlevminoffsetcell = field value * 2 [dB].\nq-RxLevMinOffsetCellSUL\tParameter \"QrxlevminoffsetcellSUL\" in TS 38.304 [20]. Actual value QrxlevminoffsetcellSUL = field value * 2 [dB].\n\n\u2013\tSIB4\nSIB4 contains information relevant only for inter-frequency cell re-selection i.e. information about other NR frequencies and inter-frequency neighbouring cells relevant for cell re-selection. The IE includes cell re-selection parameters common for a frequency as well as cell specific re-selection parameters.\nSIB4 information element\n-- ASN1START\n-- TAG-SIB4-START\n\nSIB4 ::=                            SEQUENCE {\n    interFreqCarrierFreqList            InterFreqCarrierFreqList,\n    lateNonCriticalExtension            OCTET STRING                                OPTIONAL,\n    ...\n}\n\nInterFreqCarrierFreqList ::=        SEQUENCE (SIZE (1..maxFreq)) OF InterFreqCarrierFreqInfo\n\nInterFreqCarrierFreqInfo ::=        SEQUENCE {\n    dl-CarrierFreq                      ARFCN-ValueNR,\n    frequencyBandList                   MultiFrequencyBandListNR-SIB                OPTIONAL,   -- Cond Mandatory\n    frequencyBandListSUL                MultiFrequencyBandListNR-SIB                OPTIONAL,   -- Need R\n    nrofSS-BlocksToAverage              INTEGER (2..maxNrofSS-BlocksToAverage)      OPTIONAL,   -- Need R\n    absThreshSS-BlocksConsolidation     ThresholdNR                                 OPTIONAL,   -- Need R\n    smtc                                SSB-MTC                                     OPTIONAL,   -- Need R\n    ssbSubcarrierSpacing                SubcarrierSpacing,\n    ssb-ToMeasure                       SSB-ToMeasure                               OPTIONAL,   -- Need R\n    deriveSSB-IndexFromCell             BOOLEAN,\n    ss-RSSI-Measurement                 SS-RSSI-Measurement                         OPTIONAL,\n    q-RxLevMin                          Q-RxLevMin,\n    q-RxLevMinSUL                       Q-RxLevMin                                  OPTIONAL,   -- Need R\n    q-QualMin                           Q-QualMin                                   OPTIONAL,   -- Need S,\n    p-Max                               P-Max                                       OPTIONAL,   -- Need R\n    t-ReselectionNR                     T-Reselection,\n    t-ReselectionNR-SF                  SpeedStateScaleFactors                      OPTIONAL,    -- Need S\n    threshX-HighP                       ReselectionThreshold,\n    threshX-LowP                        ReselectionThreshold,\n    threshX-Q                           SEQUENCE {\n        threshX-HighQ                       ReselectionThresholdQ,\n        threshX-LowQ                        ReselectionThresholdQ\n    }                                                                               OPTIONAL,   -- Cond RSRQ\n    cellReselectionPriority             CellReselectionPriority                     OPTIONAL,   -- Need R\n    cellReselectionSubPriority          CellReselectionSubPriority                  OPTIONAL,   -- Need R\n    q-OffsetFreq                        Q-OffsetRange                               DEFAULT dB0,\n    interFreqNeighCellList              InterFreqNeighCellList                      OPTIONAL,   -- Need R\n    interFreqBlackCellList              InterFreqBlackCellList                      OPTIONAL,   -- Need R\n    ...\n}\n\nInterFreqNeighCellList ::=          SEQUENCE (SIZE (1..maxCellInter)) OF InterFreqNeighCellInfo\n\nInterFreqNeighCellInfo ::=          SEQUENCE {\n    physCellId                          PhysCellId,\n    q-OffsetCell                        Q-OffsetRange,\n    q-RxLevMinOffsetCell                INTEGER (1..8)                              OPTIONAL,   -- Need R\n    q-RxLevMinOffsetCellSUL             INTEGER (1..8)                              OPTIONAL,   -- Need R\n    q-QualMinOffsetCell                 INTEGER (1..8)                              OPTIONAL,   -- Need R\n    ...\n\n}\n\nInterFreqBlackCellList ::=          SEQUENCE (SIZE (1..maxCellBlack)) OF PCI-Range\n\n-- TAG-SIB4-STOP\n-- ASN1STOP\n\nSIB4 field descriptions\nabsThreshSS-BlocksConsolidation\tThreshold for consolidation of L1 measurements per RS index. If the field is absent, the UE uses the measurement quantity as specified in TS 38.304 [20].\nderiveSSB-IndexFromCell\tThis field indicates whether the UE may use the timing of any detected cell on that frequency to derive the SSB index of all neighbour cells on that frequency. If this field is set to true, the UE assumes SFN and frame boundary alignment across cells on the neighbor frequency as specified in TS 38.133 [14].\ndl-CarrierFreq\tThis field indicates center frequency of the SS block of the neighbour cells, where the frequency corresponds to a GSCN value as specified in TS 38.101-1 [15].\nfrequencyBandList\tIndicates the list of frequency bands for which the NR cell reselection parameters apply.\ninterFreqBlackCellList\tList of blacklisted inter-frequency neighbouring cells.\ninterFreqCarrierFreqList\tList of neighbouring carrier frequencies and frequency specific cell re-selection information. \ninterFreqNeighCellList\tList of inter-frequency neighbouring cells with specific cell re-selection parameters.\nnrofSS-BlocksToAverage\tNumber of SS blocks to average for cell measurement derivation. If the field is absent, the UE uses the measurement quantity as specified in TS 38.304 [20].\np-Max\tValue in dBm applicable for the neighbouring NR cells on this carrier frequency. If absent the UE applies the maximum power according to TS 38.101-1 [15].\nq-OffsetCell\tParameter \"Qoffsets,n\" in TS 38.304 [20].\nq-OffsetFreq\tParameter \"Qoffsetfrequency\" in TS 38.304 [20].\nq-QualMin\tParameter \"Qqualmin\" in TS 38.304 [20]. If the field is not present, the UE applies the (default) value of negative infinity for Qqualmin.\nq-QualMinOffsetCell\tParameter \"Qqualminoffsetcell\" in TS 38.304 [20]. Actual value Qqualminoffsetcell = field value [dB].\nq-RxLevMin\tParameter \"Qrxlevmin\" in TS 38.304 [20].\nq-RxLevMinOffsetCell\tParameter \"Qrxlevminoffsetcell\" in TS 38.304 [20]. Actual value Qrxlevminoffsetcell = field value * 2 [dB].\nq-RxLevMinOffsetCellSUL\tParameter \"QrxlevminoffsetcellSUL\" in TS 38.304 [20]. Actual value QrxlevminoffsetcellSUL = field value * 2 [dB].\nq-RxLevMinSUL\tParameter \"Qrxlevmin\" in TS 38.304 [20].\nsmtc\tMeasurement timing configuration for inter-frequency measurement. If this field is absent, the UE assumes that SSB periodicity is 5 ms in this frequency.\nssb-ToMeasure\tThe set of SS blocks to be measured within the SMTC measurement duration (see TS 38.215 [9]). When the field is absent the UE measures on all SS-blocks.\nssbSubcarrierSpacing\tSubcarrier spacing of SSB. Only the values 15 kHz or 30 kHz (<6GHz), 120 kHz or 240 kHz (>6GHz) are applicable.\nthreshX-HighP\tParameter \"ThreshX, HighP\" in TS 38.304 [20].\nthreshX-HighQ\tParameter \"ThreshX, HighQ\" in TS 38.304 [20].\nthreshX-LowP\tParameter \"ThreshX, LowP\" in TS 38.304 [20].\nthreshX-LowQ\tParameter \"ThreshX, LowQ\" in TS 38.304 [20].\nt-ReselectionNR\tParameter \"TreselectionNR\" in TS 38.304 [20].\nt-ReselectionNR-SF\tParameter \"Speed dependent ScalingFactor for TreselectionNR\" in TS 38.304 [20]. If the field is not present, the UE behaviour is specified in TS 38.304 [20].\n\nConditional Presence\tExplanation\nMandatory\tThe field is mandatory present in SIB4. \nRSRQ\tThe field is mandatory present if threshServingLowQ is present in SIB2; otherwise it is not present. \n\n\u2013\tSIB5\nSIB5 contains information relevant only for inter-RAT cell re-selection i.e. information about E-UTRA frequencies and E-UTRAs neighbouring cells relevant for cell re-selection. The IE includes cell re-selection parameters common for a frequency.\nSIB5 information element\n-- ASN1START\n-- TAG-SIB5-START\n\nSIB5 ::=                            SEQUENCE {\n    carrierFreqListEUTRA                CarrierFreqListEUTRA                        OPTIONAL,       -- Need R\n    t-ReselectionEUTRA                  T-Reselection,\n    t-ReselectionEUTRA-SF               SpeedStateScaleFactors                      OPTIONAL,       -- Need S\n    lateNonCriticalExtension            OCTET STRING                                OPTIONAL,\n    ...\n}\n\nCarrierFreqListEUTRA ::=            SEQUENCE (SIZE (1..maxEUTRA-Carrier)) OF CarrierFreqEUTRA\n\nCarrierFreqEUTRA ::=                SEQUENCE {\n    carrierFreq                         ARFCN-ValueEUTRA,\n    eutra-multiBandInfoList             EUTRA-MultiBandInfoList                     OPTIONAL,       -- Need R\n    eutra-FreqNeighCellList             EUTRA-FreqNeighCellList                     OPTIONAL,       -- Need R\n    eutra-BlackCellList                 EUTRA-FreqBlackCellList                     OPTIONAL,       -- Need R\n    allowedMeasBandwidth                EUTRA-AllowedMeasBandwidth,\n    presenceAntennaPort1                EUTRA-PresenceAntennaPort1,\n    cellReselectionPriority             CellReselectionPriority                     OPTIONAL,       -- Need R\n    cellReselectionSubPriority          CellReselectionSubPriority                  OPTIONAL,       -- Need R\n    threshX-High                        ReselectionThreshold,\n    threshX-Low                         ReselectionThreshold,\n    q-RxLevMin                          INTEGER (-70..-22),\n    q-QualMin                           INTEGER (-34..-3),\n    p-MaxEUTRA                          INTEGER (-30..33),\n    threshX-Q                           SEQUENCE {\n        threshX-HighQ                       ReselectionThresholdQ,\n        threshX-LowQ                        ReselectionThresholdQ\n    }                                                                               OPTIONAL        -- Cond RSRQ\n}\n\nEUTRA-FreqBlackCellList ::=         SEQUENCE (SIZE (1..maxEUTRA-CellBlack)) OF EUTRA-PhysCellIdRange\n\nEUTRA-FreqNeighCellList ::=         SEQUENCE (SIZE (1..maxCellEUTRA)) OF EUTRA-FreqNeighCellInfo\n\nEUTRA-FreqNeighCellInfo ::=         SEQUENCE {\n    physCellId                          EUTRA-PhysCellId,\n    q-OffsetCell                        EUTRA-Q-OffsetRange,\n    q-RxLevMinOffsetCell                INTEGER (1..8)                              OPTIONAL,       -- Need R\n    q-QualMinOffsetCell                 INTEGER (1..8)                              OPTIONAL        -- Need R\n}\n\n-- TAG-SIB5-STOP\n-- ASN1STOP\n\nSIB5 field descriptions\ncarrierFreqListEUTRA\tList of carrier frequencies of E-UTRA.\neutra-BlackCellList\tList of blacklisted E-UTRA neighbouring cells.\neutra-multiBandInfoList\tIndicates the list of frequency bands in addition to the band represented by carrierFreq for which cell reselection parameters are common, and a list of additionalPmax and additionalSpectrumEmission values, as defined in TS 36.101 [22], table 6.2.4-1, for the frequency bands in eutra-multiBandInfoList\np-MaxEUTRA\tThe maximum allowed transmission power in dBm on the (uplink) carrier frequency, see TS 36.304 [27]. In dBm\nq-OffsetCell\tParameter \"Qoffsets,n\" in TS 36.304 [27]. If received it shall be ignored by the UE.\nq-QualMin\tParameter \"Qqualmin\" in TS 36.304 [27]. Actual value Qqualmin = field value [dB].\nq-QualMinOffsetCell\tParameter \"Qqualminoffsetcell\" in TS 38.304 [20]. Actual value Qqualminoffsetcell = field value [dB].\nq-RxLevMin\tParameter \"Qrxlevmin\" in TS 36.304 [27]. Actual value Qrxlevmin = field value * 2 [dBm].\nq-RxLevMinOffsetCell\tParameter \"Qrxlevminoffsetcell\" in TS 38.304 [20]. Actual value Qrxlevminoffsetcell = field value * 2 [dB].\nt-ReselectionEUTRA\tParameter \"TreselectionEUTRA\" in TS 38.304 [20].\nthreshX-High\tParameter \"ThreshX, HighP\" in TS 38.304 [20].\nthreshX-HighQ\tParameter \"ThreshX, HighQ\" in TS 38.304 [20].\nthreshX-Low\tParameter \"ThreshX, LowP\" in TS 38.304 [20].\nthreshX-LowQ\tParameter \"ThreshX, LowQ\" in TS 38.304 [20].\nt-ReselectionEUTRA-SF\tParameter \"Speed dependent ScalingFactor for TreselectionEUTRA\" in TS 38.304 [20]. If the field is not present, the UE behaviour is specified in TS 38.304 [20].\n\nConditional Presence\tExplanation\nRSRQ\tThe field is mandatory present if the threshServingLowQ is present in SIB2; otherwise it is not present. \n\n\u2013\tSIB6\nSIB6 contains an ETWS primary notification.\nSIB6 information element\n-- ASN1START\n-- TAG-SIB6-START\n\nSIB6 ::=                            SEQUENCE {\n    messageIdentifier                   BIT STRING (SIZE (16)),\n    serialNumber                        BIT STRING (SIZE (16)),\n    warningType                         OCTET STRING (SIZE (2)),\n    lateNonCriticalExtension            OCTET STRING                                OPTIONAL,\n    ...\n}\n\n-- TAG-SIB6-STOP\n-- ASN1STOP\n\nSIB6 field descriptions\nmessageIdentifier\tIdentifies the source and type of ETWS notification.\nserialNumber\tIdentifies variations of an ETWS notification.\nwarningType\tIdentifies the warning type of the ETWS primary notification and provides information on emergency user alert and UE popup.\n\n\u2013\tSIB7\nSIB7 contains an ETWS secondary notification.\nSIB7 information element\n-- ASN1START\n-- TAG-SIB7-START\n\nSIB7 ::=                            SEQUENCE {\n    messageIdentifier                   BIT STRING (SIZE (16)),\n    serialNumber                        BIT STRING (SIZE (16)),\n    warningMessageSegmentType           ENUMERATED {notLastSegment, lastSegment},\n    warningMessageSegmentNumber         INTEGER (0..63),\n    warningMessageSegment               OCTET STRING,\n    dataCodingScheme                    OCTET STRING (SIZE (1))                     OPTIONAL,   -- Cond Segment1\n    lateNonCriticalExtension            OCTET STRING                                OPTIONAL,\n    ...\n}\n\n-- TAG-SIB7-STOP\n-- ASN1STOP\n\nSIB7 field descriptions\ndataCodingScheme\tIdentifies the alphabet/coding and the language applied variations of an ETWS notification.\nmessageIdentifier\tIdentifies the source and type of ETWS notification.\nserialNumber\tIdentifies variations of an ETWS notification.\nwarningMessageSegment\tCarries a segment of the Warning Message Contents IE.\nwarningMessageSegmentNumber\tSegment number of the ETWS warning message segment contained in the SIB. A segment number of zero corresponds to the first segment, A segment number of one corresponds to the second segment, and so on.\nwarningMessageSegmentType\tIndicates whether the included ETWS warning message segment is the last segment or not.\n\nConditional Presence\tExplanation\nSegment1\tThe field is mandatory present in the first segment of SIB7, otherwise it is not present. \n\n\u2013\tSIB8\nSIB8 contains a CMAS notification.\nSIB8 information element\n-- ASN1START\n-- TAG-SIB8-START\n\nSIB8 ::=                        SEQUENCE {\n    messageIdentifier               BIT STRING (SIZE (16)),\n    serialNumber                    BIT STRING (SIZE (16)),\n    warningMessageSegmentType       ENUMERATED {notLastSegment, lastSegment},\n    warningMessageSegmentNumber     INTEGER (0..63),\n    warningMessageSegment           OCTET STRING,\n    dataCodingScheme                OCTET STRING (SIZE (1))                         OPTIONAL,   -- Cond Segment1\n    warningAreaCoordinatesSegment   OCTET STRING                                    OPTIONAL,   -- Need R\n    lateNonCriticalExtension        OCTET STRING                                    OPTIONAL,\n    ...\n}\n\n-- TAG-SIB8-STOP\n-- ASN1STOP\n\nSIB8 field descriptions\ndataCodingScheme\tIdentifies the alphabet/coding and the language applied variations of a CMAS notification.\nmessageIdentifier\tIdentifies the source and type of CMAS notification.\nserialNumber\tIdentifies variations of a CMAS notification.\nwarningAreaCoordinatesSegment\tCarries a segment of the geographical area where the CMAS warning message is valid as defined in [28]. The first octet of the first warningAreaCoordinatesSegment is equivalent to the first octet of Warning Area Coordinates IE defined in and encoded according to TS 23.041 [29] and so on.\nwarningMessageSegment\tCarries a segment of the Warning Message Contents IE.\nwarningMessageSegmentNumber\tSegment number of the CMAS warning message segment contained in the SIB. A segment number of zero corresponds to the first segment, one corresponds to the second segment, and so on.\nwarningMessageSegmentType\tIndicates whether the included CMAS warning message segment is the last segment or not.\n\nConditional Presence\tExplanation\nSegment1\tThe field is mandatory present in the first segment of SIB8, otherwise it is not present. \n\n\u2013\tSIB9\nSIB9 contains information related to GPS time and Coordinated Universal Time (UTC). The UE may use the parameters provided in this system information block to obtain the UTC, the GPS and the local time.\nNOTE:\tThe UE may use the time information for numerous purposes, possibly involving upper layers e.g. to assist GPS initialisation, to synchronise the UE clock.\nSIB9 information element\n-- ASN1START\n-- TAG-SIB9-START\n\nSIB9 ::=                            SEQUENCE {\n    timeInfo                            SEQUENCE {\n        timeInfoUTC                         INTEGER (0..549755813887),\n        dayLightSavingTime                  BIT STRING (SIZE (2))                   OPTIONAL,   -- Need R\n        leapSeconds                         INTEGER (-127..128)                     OPTIONAL,   -- Need R\n        localTimeOffset                     INTEGER (-63..64)                       OPTIONAL    -- Need R\n    }                                                                               OPTIONAL,   -- Need R\n    lateNonCriticalExtension            OCTET STRING                                OPTIONAL,\n    ...\n}\n\n-- TAG-SIB9-STOP\n-- ASN1STOP\n\nSIB9 field descriptions\ndayLightSavingTime\tIndicates if and how daylight-saving time (DST) is applied to obtain the local time. The semantics are the same as the semantics of the Daylight Saving Time IE in TS 24.501 [23] and TS 24.008 [38]. The first/leftmost bit of the bit string contains the b2 of octet 3 and the second bit of the bit string contains b1 of octet 3 in the value part of the Daylight Saving Time IE in TS 24.008 [38].\nleapSeconds\tNumber of leap seconds offset between GPS Time and UTC. UTC and GPS time are related i.e. GPS time -leapSeconds = UTC time.\nlocalTimeOffset\tOffset between UTC and local time in units of 15 minutes. Actual value = field value * 15 minutes. Local time of the day is calculated as UTC time + localTimeOffset.\ntimeInfoUTC\tCoordinated Universal Time corresponding to the SFN boundary at or immediately after the ending boundary of the SI-window in which SIB9 is transmitted. The field counts the number of UTC seconds in 10 ms units since 00:00:00 on Gregorian calendar date 1 January, 1900 (midnight between Sunday, December 31, 1899 and Monday, January 1, 1900). See NOTE 1. This field is excluded when determining changes in system information, i.e. changes of timeInfoUTC should neither result in system information change notifications nor in a modification of valueTag in SIB1.\n\nNOTE 1:\tThe UE may use this field together with the leapSeconds field to obtain GPS time as follows: GPS Time (in seconds) = timeInfoUTC (in seconds) -  2,524,953,600 (seconds) + leapSeconds, where 2,524,953,600 is the number of seconds between 00:00:00 on Gregorian calendar date 1 January, 1900 and 00:00:00 on Gregorian calendar date 6 January, 1980 (start of GPS time).\n\n6.3.2\tRadio resource control information elements\n\u2013\tAdditionalSpectrumEmission\nThe IE AdditionalSpectrumEmission is used to indicate emission requirements to be fulfilled by the UE (see TS 38.101-1 [15], clause 6.2.3).\nAdditionalSpectrumEmission information element\n-- ASN1START\n-- TAG-ADDITIONALSPECTRUMEMISSION-START\n\nAdditionalSpectrumEmission ::=              INTEGER (0..7)\n\n-- TAG-ADDITIONALSPECTRUMEMISSION-STOP\n-- ASN1STOP\n\n\u2013\tAlpha\nThe IE Alpha defines possible values of a the pathloss compensation coefficient for uplink power control. Value alpha0 corresponds to the value 0, Value alpha04 corresponds to the value 0.4, Value alpha05 corresponds to the value 0.5 and so on. Value alpha1 corresponds to value 1. See also clause 7.1 of TS 38.213 [13].\n-- ASN1START\n-- TAG-ALPHA-START\n\nAlpha ::=                       ENUMERATED {alpha0, alpha04, alpha05, alpha06, alpha07, alpha08, alpha09, alpha1}\n\n-- TAG-ALPHA-STOP\n-- ASN1STOP\n\n\u2013\tAMF-Identifier\nThe IE AMF-Identifier (AMFI) comprises of an AMF Region ID, an AMF Set ID and an AMF Pointer as specified in TS 23.003 [21], clause 2.10.1.\nAMF-Identifier information element\n-- ASN1START\n-- TAG-AMF-IDENTIFIER-START\n\nAMF-Identifier ::=                      BIT STRING (SIZE (24))\n\n-- TAG-AMF-IDENTIFIER-STOP\n-- ASN1STOP\n\n\u2013\tARFCN-ValueEUTRA\nThe IE ARFCN-ValueEUTRA is used to indicate the ARFCN applicable for a downlink, uplink or bi-directional (TDD) E-UTRA carrier frequency, as defined in TS 36.101 [22].\nARFCN-ValueEUTRA information element\n-- ASN1START\n-- TAG-ARFCN-VALUEEUTRA-START\n\nARFCN-ValueEUTRA ::=                INTEGER (0..maxEARFCN)\n\n-- TAG-ARFCN-VALUEEUTRA-STOP\n-- ASN1STOP\n\n\u2013\tARFCN-ValueNR\nThe IE ARFCN-ValueNR is used to indicate the ARFCN applicable for a downlink, uplink or bi-directional (TDD) NR global frequency raster, as defined in TS 38.101-1 [15], clause 5.4.2.\n-- ASN1START\n-- TAG-ARFCN-VALUENR-START\n\nARFCN-ValueNR ::=               INTEGER (0..maxNARFCN)\n\n-- TAG-ARFCN-VALUENR-STOP\n-- ASN1STOP\n\n\u2013\tBeamFailureRecoveryConfig\nThe IE BeamFailureRecoveryConfig is used to configure the UE with RACH resources and candidate beams for beam failure recovery in case of beam failure detection. See also TS 38.321 [3], clause 5.1.1.\nBeamFailureRecoveryConfig information element\n-- ASN1START\n-- TAG-BEAMFAILURERECOVERYCONFIG-START\n\nBeamFailureRecoveryConfig ::=       SEQUENCE {\n    rootSequenceIndex-BFR               INTEGER (0..137)                                                          OPTIONAL, -- Need M\n    rach-ConfigBFR                      RACH-ConfigGeneric                                                        OPTIONAL, -- Need M\n    rsrp-ThresholdSSB                   RSRP-Range                                                                OPTIONAL, -- Need M\n    candidateBeamRSList                 SEQUENCE (SIZE(1..maxNrofCandidateBeams)) OF PRACH-ResourceDedicatedBFR   OPTIONAL, -- Need M\n    ssb-perRACH-Occasion                ENUMERATED {oneEighth, oneFourth, oneHalf, one, two,\n                                                       four, eight, sixteen}                                      OPTIONAL, -- Need M\n    ra-ssb-OccasionMaskIndex            INTEGER (0..15)                                                           OPTIONAL, -- Need M\n    recoverySearchSpaceId               SearchSpaceId                                                             OPTIONAL, -- Need R\n    ra-Prioritization                   RA-Prioritization                                                         OPTIONAL, -- Need R\n    beamFailureRecoveryTimer            ENUMERATED {ms10, ms20, ms40, ms60, ms80, ms100, ms150, ms200}            OPTIONAL, -- Need M\n    ...,\n    [[\n    msg1-SubcarrierSpacing-v1530        SubcarrierSpacing                                                         OPTIONAL  -- Need M\n    ]]\n}\n\nPRACH-ResourceDedicatedBFR ::=      CHOICE {\n    ssb                                 BFR-SSB-Resource,\n    csi-RS                              BFR-CSIRS-Resource\n}\n\nBFR-SSB-Resource ::=                SEQUENCE {\n    ssb                                 SSB-Index,\n    ra-PreambleIndex                    INTEGER (0..63),\n    ...\n}\n\nBFR-CSIRS-Resource ::=              SEQUENCE {\n    csi-RS                              NZP-CSI-RS-ResourceId,\n    ra-OccasionList                     SEQUENCE (SIZE(1..maxRA-OccasionsPerCSIRS)) OF INTEGER (0..maxRA-Occasions-1)   OPTIONAL,   -- Need R\n    ra-PreambleIndex                    INTEGER (0..63)                                                                 OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-BEAMFAILURERECOVERYCONFIG-STOP\n-- ASN1STOP\n\nBeamFailureRecoveryConfig field descriptions\nbeamFailureRecoveryTimer\tTimer for beam failure recovery timer. Upon expiration of the timer the UE does not use CFRA for BFR. Value in ms. Value ms10 corresponds to 10 ms, value ms20 corresponds to 20 ms, and so on.\ncandidateBeamRSList\tA list of reference signals (CSI-RS and/or SSB) identifying the candidate beams for recovery and the associated RA parameters. The network configures these reference signals to be within the linked DL BWP (i.e., within the DL BWP with the same bwp-Id) of the UL BWP in which the BeamFailureRecoveryConfig is provided. \nmsg1-SubcarrierSpacing\tSubcarrier spacing for contention free beam failure recovery. Only the values 15 kHz or 30 kHz (<6GHz), 60 kHz or 120 kHz (>6GHz) are applicable. See TS 38.211 [16], clause 5.3.2.\nrsrp-ThresholdSSB\tL1-RSRP threshold used for determining whether a candidate beam may be used by the UE to attempt contention free random access to recover from beam failure (see TS 38.213 [13], clause 6).\nra-prioritization\tParameters which apply for prioritized random access procedure for BFR (see TS 38.321 [3], clause 5.1.1).\nra-ssb-OccasionMaskIndex\tExplicitly signalled PRACH Mask Index for RA Resource selection in TS 38.321 [3]. The mask is valid for all SSB resources.\nrach-ConfigBFR\tConfiguration of contention free random access occasions for BFR.\nrecoverySearchSpaceId\nssb-perRACH-Occasion\tNumber of SSBs per RACH occasion for CF-BFR, see TS 38.213 [13], clause 8.1.\n\nBFR-CSIRS-Resource field descriptions\ncsi-RS\tThe ID of a NZP-CSI-RS-Resource configured in the CSI-MeasConfig of this serving cell. This reference signal determines a candidate beam for beam failure recovery (BFR).\nra-OccasionList\tRA occasions that the UE shall use when performing BFR upon selecting the candidate beam identified by this CSI-RS. The network ensures that the RA occasion indexes provided herein are also configured by prach-ConfigurationIndex and msg1-FDM. Each RACH occasion is sequentially numbered, first, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions; second, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot and Third, in increasing order of indexes for PRACH slots.\tIf the field is absent the UE uses the RA occasion associated with the SSB that is QCLed with this CSI-RS.\nra-PreambleIndex\tThe RA preamble index to use in the RA occasions associated with this CSI-RS. If the field is absent, the UE uses the preamble index associated with the SSB that is QCLed with this CSI-RS.\n\nBFR-SSB-Resource field descriptions\nra-PreambleIndex\tThe preamble index that the UE shall use when performing BFR upon selecting the candidate beams identified by this SSB.\nssb\tThe ID of an SSB transmitted by this serving cell. It determines a candidate beam for beam failure recovery (BFR).\n\n\u2013\tBSR-Config\nThe IE BSR-Config is used to configure buffer status reporting.\nBSR-Config information element\n-- ASN1START\n-- TAG-BSR-CONFIG-START\n\nBSR-Config ::=                      SEQUENCE {\n    periodicBSR-Timer                   ENUMERATED { sf1, sf5, sf10, sf16, sf20, sf32, sf40, sf64,\n                                                        sf80, sf128, sf160, sf320, sf640, sf1280, sf2560, infinity },\n    retxBSR-Timer                       ENUMERATED { sf10, sf20, sf40, sf80, sf160, sf320, sf640, sf1280, sf2560,\n                                                        sf5120, sf10240, spare5, spare4, spare3, spare2, spare1},\n    logicalChannelSR-DelayTimer         ENUMERATED { sf20, sf40, sf64, sf128, sf512, sf1024, sf2560, spare1}    OPTIONAL, -- Need R\n    ...\n}\n\n-- TAG-BSR-CONFIG-STOP\n-- ASN1STOP\n\nBSR-Config field descriptions\nlogicalChannelSR-DelayTimer\tValue in number of subframes. Value sf20 corresponds to 20 subframes, sf40 corresponds to 40 subframes, and so on.\nperiodicBSR-Timer\tValue in number of subframes. Value sf1 corresponds to 1 subframe, value sf5 corresponds to 5 subframes and so on.\nretxBSR-Timer\tValue in number of subframes. Value sf10 corresponds to 10 subframes, value sf20 corresponds to 20 subframes and so on.\n\n\u2013\tBWP\nThe IE BWP is used to configure generic parameters of a bandwidth part as defined in TS 38.211 [16], clause 4.5, and TS 38.213 [13], clause 12.\nFor each serving cell the network configures at least an initial downlink bandwidth part and one (if the serving cell is configured with an uplink) or two (if using supplementary uplink (SUL)) initial uplink bandwidth parts. Furthermore, the network may configure additional uplink and downlink bandwidth parts for a serving cell.\nThe uplink and downlink bandwidth part configurations are divided into common and dedicated parameters.\nBWP information element\n-- ASN1START\n-- TAG-BWP-START\n\nBWP ::=                             SEQUENCE {\n    locationAndBandwidth                INTEGER (0..37949),\n    subcarrierSpacing                   SubcarrierSpacing,\n    cyclicPrefix                        ENUMERATED { extended }                                                 OPTIONAL    -- Need R\n}\n\n\n-- TAG-BWP-STOP\n-- ASN1STOP\n\nBWP field descriptions\ncyclicPrefix\tIndicates whether to use the extended cyclic prefix for this bandwidth part. If not set, the UE uses the normal cyclic prefix. Normal CP is supported for all subcarrier spacings and slot formats. Extended CP is supported only for 60 kHz subcarrier spacing. (see TS 38.211 [16], clause 4.2)\nlocationAndBandwidth\tFrequency domain location and bandwidth of this bandwidth part. The value of the field shall be interpreted as resource indicator value (RIV) as defined TS 38.214 [19] with assumptions as described in TS 38.213 [13], clause 12, i.e. setting =275. The first PRB is a PRB determined by subcarrierSpacing of this BWP and offsetToCarrier (configured in SCS-SpecificCarrier contained within FrequencyInfoDL / FrequencyInfoUL / FrequencyInfoUL-SIB / FrequencyInfoDL-SIB within ServingCellConfigCommon / ServingCellConfigCommonSIB1) corresponding to this subcarrier spacing. In case of TDD, a BWP-pair (UL BWP and DL BWP with the same bwp-Id) must have the same center frequency (see TS 38.213 [13], clause 12)\nsubcarrierSpacing\tSubcarrier spacing to be used in this BWP for all channels and reference signals unless explicitly configured elsewhere. Corresponds to subcarrier spacing according to TS 38.211 [16], Table 4.2-1. The value kHz15 corresponds to \u00b5=0, value kHz30 corresponds to \u00b5=1, and so on. Only the values 15 kHz, 30 kHz, or 60 kHz (<6GHz), and 60 kHz or 120 kHz (>6GHz) are applicable. For the initial DL BWP this field has the same value as the field subCarrierSpacingCommon in MIB of the same serving cell.\n\n\u2013\tBWP-Downlink\nThe IE BWP-Downlink is used to configure an additional downlink bandwidth part (not for the initial BWP). \nBWP-Downlink information element\n-- ASN1START\n-- TAG-BWP-DOWNLINK-START\n\nBWP-Downlink ::=                    SEQUENCE {\n    bwp-Id                              BWP-Id,\n    bwp-Common                          BWP-DownlinkCommon                                         OPTIONAL,   -- Cond SetupOtherBWP\n    bwp-Dedicated                       BWP-DownlinkDedicated                                      OPTIONAL,   -- Cond SetupOtherBWP\n    ...\n}\n\n-- TAG-BWP-DOWNLINK-STOP\n-- ASN1STOP\n\nBWP-Downlink field descriptions\nbwp-Id\tAn identifier for this bandwidth part. Other parts of the RRC configuration use the BWP-Id to associate themselves with a particular bandwidth part.\tThe network configures the BWPs with consecutive IDs from 1. The Network does not include the value 0, since value 0 is reserved for the initial BWP.\n\nConditional Presence\tExplanation\nSetupOtherBWP\tThe field is mandatory present upon configuration of a new DL BWP. The field is optionally present, Need M, otherwise. \n\n\u2013\tBWP-DownlinkCommon\nThe IE BWP-DownlinkCommon is used to configure the common parameters of a downlink BWP. They are \"cell specific\" and the network ensures the necessary alignment with corresponding parameters of other UEs. The common parameters of the initial bandwidth part of the PCell are also provided via system information. For all other serving cells, the network provides the common parameters via dedicated signalling.\nBWP-DownlinkCommon information element\n-- ASN1START\n-- TAG-BWP-DOWNLINKCOMMON-START\n\nBWP-DownlinkCommon ::=              SEQUENCE {\n    genericParameters                   BWP,\n    pdcch-ConfigCommon                  SetupRelease { PDCCH-ConfigCommon }                                     OPTIONAL,   -- Need M\n    pdsch-ConfigCommon                  SetupRelease { PDSCH-ConfigCommon }                                     OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-BWP-DOWNLINKCOMMON-STOP\n-- ASN1STOP\n\nBWP-DownlinkCommon field descriptions\npdcch-ConfigCommon\tCell specific parameters for the PDCCH of this BWP.\npdsch-ConfigCommon\tCell specific parameters for the PDSCH of this BWP.\n\n\u2013\tBWP-DownlinkDedicated\nThe IE BWP-DownlinkDedicated is used to configure the dedicated (UE specific) parameters of a downlink BWP.\nBWP-DownlinkDedicated information element\n-- ASN1START\n-- TAG-BWP-DOWNLINKDEDICATED-START\n\nBWP-DownlinkDedicated ::=           SEQUENCE {\n    pdcch-Config                        SetupRelease { PDCCH-Config }                                           OPTIONAL,   -- Need M\n    pdsch-Config                        SetupRelease { PDSCH-Config }                                           OPTIONAL,   -- Need M\n    sps-Config                          SetupRelease { SPS-Config }                                             OPTIONAL,   -- Need M\n    radioLinkMonitoringConfig           SetupRelease { RadioLinkMonitoringConfig }                              OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-BWP-DOWNLINKDEDICATED-STOP\n-- ASN1STOP\n\nBWP-DownlinkDedicated field descriptions\npdcch-Config\tUE specific PDCCH configuration for one BWP.\npdsch-Config\tUE specific PDSCH configuration for one BWP.\nsps-Config\tUE specific SPS (Semi-Persistent Scheduling) configuration for one BWP. Except for reconfiguration with sync, the NW does not reconfigure sps-Config when there is an active configured downlink assignment (see TS 38.321 [3]). However, the NW may release the sps-Config at any time. \nradioLinkMonitoringConfig\tUE specific configuration of radio link monitoring for detecting cell- and beam radio link failure occasions. The maximum number of failure detection resources should be limited up to 8 for both cell and beam radio link failure detection in Rel-15.\n\n\u2013\tBWP-Id\nThe IE BWP-Id is used to refer to Bandwidth Parts (BWP). The initial BWP is referred to by BWP-Id 0. The other BWPs are referred to by BWP-Id 1 to maxNrofBWPs.\nBWP-Id information element\n-- ASN1START\n-- TAG-BWP-ID-START\n\nBWP-Id ::=                          INTEGER (0..maxNrofBWPs)\n\n-- TAG-BWP-ID-STOP\n-- ASN1STOP\n\n\u2013\tBWP-Uplink\nThe IE BWP-Uplink is used to configure an additional uplink bandwidth part (not for the initial BWP).\nBWP-Uplink information element\n-- ASN1START\n-- TAG-BWP-UPLINK-START\n\nBWP-Uplink ::=                      SEQUENCE {\n    bwp-Id                              BWP-Id,\n    bwp-Common                          BWP-UplinkCommon                                            OPTIONAL,   -- Cond SetupOtherBWP\n    bwp-Dedicated                       BWP-UplinkDedicated                                         OPTIONAL,   -- Cond SetupOtherBWP\n    ...\n}\n\n-- TAG-BWP-UPLINK-STOP\n-- ASN1STOP\n\nBWP-Uplink field descriptions\nbwp-Id\tAn identifier for this bandwidth part. Other parts of the RRC configuration use the BWP-Id to associate themselves with a particular bandwidth part.\tThe network configures the BWPs with consecutive IDs from 1. The Network does not include the value 0, since value 0 is reserved for the initial BWP.\n\nConditional Presence\tExplanation\nSetupOtherBWP\tThe field is mandatory present upon configuration of a new UL BWP. The field is optionally present, Need M, otherwise. \n\n\u2013\tBWP-UplinkCommon\nThe IE BWP-UplinkCommon is used to configure the common parameters of an uplink BWP. They are \"cell specific\" and the network ensures the necessary alignment with corresponding parameters of other UEs. The common parameters of the initial bandwidth part of the PCell are also provided via system information. For all other serving cells, the network provides the common parameters via dedicated signalling.\nBWP-UplinkCommon information element\n-- ASN1START\n-- TAG-BWP-UPLINKCOMMON-START\n\nBWP-UplinkCommon ::=                SEQUENCE {\n    genericParameters                   BWP,\n    rach-ConfigCommon                   SetupRelease { RACH-ConfigCommon }                                      OPTIONAL,   -- Need M\n    pusch-ConfigCommon                  SetupRelease { PUSCH-ConfigCommon }                                     OPTIONAL,   -- Need M\n    pucch-ConfigCommon                  SetupRelease { PUCCH-ConfigCommon }                                     OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-BWP-UPLINKCOMMON-STOP\n-- ASN1STOP\n\nBWP-UplinkCommon field descriptions\npucch-ConfigCommon\tCell specific parameters for the PUCCH of this BWP. \npusch-ConfigCommon\tCell specific parameters for the PUSCH of this BWP.\nrach-ConfigCommon\tConfiguration of cell specific random access parameters which the UE uses for contention based and contention free random access as well as for contention based beam failure recovery in this BWP. The NW configures SSB-based RA (and hence RACH-ConfigCommon) only for UL BWPs if the linked DL BWPs (same bwp-Id as UL-BWP) are the initial DL BWPs or DL BWPs containing the SSB associated to the initial DL BWP. The network configures rach-ConfigCommon, whenever it configures contention free random access (for reconfiguration with sync or for beam failure recovery). \n\n\u2013\tBWP-UplinkDedicated\nThe IE BWP-UplinkDedicated is used to configure the dedicated (UE specific) parameters of an uplink BWP.\nBWP-UplinkDedicated information element\n-- ASN1START\n-- TAG-BWP-UPLINKDEDICATED-START\n\nBWP-UplinkDedicated ::=             SEQUENCE {\n    pucch-Config                        SetupRelease { PUCCH-Config }                                   OPTIONAL,   -- Need M\n    pusch-Config                        SetupRelease { PUSCH-Config }                                   OPTIONAL,   -- Need M\n    configuredGrantConfig               SetupRelease { ConfiguredGrantConfig }                          OPTIONAL,   -- Need M\n    srs-Config                          SetupRelease { SRS-Config }                                     OPTIONAL,   -- Need M\n    beamFailureRecoveryConfig           SetupRelease { BeamFailureRecoveryConfig }                      OPTIONAL,   -- Cond SpCellOnly\n    ...\n}\n\n-- TAG-BWP-UPLINKDEDICATED-STOP\n-- ASN1STOP\n\nBWP-UplinkDedicated field descriptions\nbeamFailureRecoveryConfig\tConfiguration of beam failure recovery. If supplementaryUplink is present, the field is present only in one of the uplink carriers, either UL or SUL.\nconfiguredGrantConfig\tA Configured-Grant of type1 or type2. It may be configured for UL or SUL but in case of type1 not for both at a time. Except for reconfiguration with sync, the NW does not reconfigure configuredGrantConfig when there is an active configured uplink grant Type 2 (see TS 38.321 [3]). However, the NW may release the configuredGrantConfig at any time.\npucch-Config\tPUCCH configuration for one BWP of the normal UL or SUL of a serving cell. If the UE is configured with SUL, the network configures PUCCH only on the BWPs of one of the uplinks (normal UL or SUL). The network configures PUCCH-Config at least on non-initial BWP(s) for SpCell and PUCCH SCell. If supported by the UE, the network may configure at most one additional SCell of a cell group with PUCCH-Config (i.e. PUCCH SCell).\tIn EN-DC, The NW configures at most one serving cell per frequency range with PUCCH. And in EN-DC, if two PUCCH groups are configured, the serving cells of the NR PUCCH group in FR2 use the same numerology.\tThe NW may configure PUCCH for a BWP when setting up the BWP. The network may also add/remove the pucch-Config in an RRCReconfiguraiton with reconfigurationWithSync to move the PUCCH between the UL and SUL carrier of one serving. In other cases, only modifications of a previously configured pucch-Config are allowed.\tIf one (S)UL BWP of a serving cell is configured with PUCCH, all other (S)UL BWPs must be configured with PUCCH, too.\npusch-Config\tPUSCH configuration for one BWP of the normal UL or SUL of a serving cell. If the UE is configured with SUL and if it has a PUSCH-Config for both UL and SUL, a carrier indicator field in DCI indicates for which of the two to use an UL grant. See TS 38.213 [13], clause 10.\nsrs-Config\tUplink sounding reference signal configuration.\n\nConditional Presence\tExplanation\nSpCellOnly\tThe field is optionally present, Need M, in the BWP-UplinkDedicated of an SpCell. It is absent otherwise. \n\n\u2013\tCellAccessRelatedInfo\nThe IE CellAccessRelatedInfo indicates cell access related information for this cell.\nCellAccessRelatedInfo information element\n-- ASN1START\n-- TAG-CELLACCESSRELATEDINFO-START\n\nCellAccessRelatedInfo   ::=         SEQUENCE {\n    plmn-IdentityList                   PLMN-IdentityInfoList,\n    cellReservedForOtherUse             ENUMERATED {true}  OPTIONAL,            -- Need R\n    ...\n}\n\n-- TAG-CELLACCESSRELATEDINFO-STOP\n-- ASN1STOP\n\nCellAccessRelatedInfo field descriptions\ncellReservedForOtherUse\tIndicates whether the cell is reserved, as defined in 38.304 [20]. The field is applicable to all PLMNs.\nplmn-IdentityList\tThe PLMN-IdentityList is used to configure a set of PLMN-IdentityInfo elements. Each of those elements contains a list of one or more PLMN Identities and additional information associated with those PLMNs. The total number of PLMNs in the PLMN-IdentitynfoList does not exceed 12. The PLMN index is defined as b1+b2+\u2026+b(n-1)+i If this PLMN is included at the n-th entry of PLMN-IdentityInfoList and the i-th entry of its corresponding PLMN-IdentityInfo, where b(j) is the number of PLMN-Identity entries in each PLMN-IdentityInfo respectively.\n\n\u2013\tCellAccessRelatedInfo-EUTRA-5GC\nThe IE CellAccessRelatedInfo-EUTRA-5GC indicates cell access related information for an LTE cell connected to 5GC.\nCellAccessRelatedInfo-EUTRA-5GC information element\n-- ASN1START\n-- TAG-CELLACCESSRELATEDINFOEUTRA-5GC-START\n\nCellAccessRelatedInfo-EUTRA-5GC  ::=    SEQUENCE {\n    plmn-IdentityList-eutra-5gc             PLMN-IdentityList-EUTRA-5GC,\n    trackingAreaCode-eutra-5gc              TrackingAreaCode,\n    ranac-5gc                               RAN-AreaCode                                OPTIONAL,\n    cellIdentity-eutra-5gc                  CellIdentity-EUTRA-5GC\n}\n\nPLMN-IdentityList-EUTRA-5GC::=          SEQUENCE (SIZE (1..maxPLMN)) OF PLMN-Identity-EUTRA-5GC\n\nPLMN-Identity-EUTRA-5GC ::=             CHOICE {\n    plmn-Identity-EUTRA-5GC                 PLMN-Identity,\n    plmn-index                              INTEGER (1..maxPLMN)\n}\n\nCellIdentity-EUTRA-5GC ::=              CHOICE {\n    cellIdentity-EUTRA                      BIT STRING (SIZE (28)),\ncellId-index                            INTEGER (1..maxPLMN)\n}\n\n-- TAG-CELLACCESSRELATEDINFOEUTRA-5GC-STOP\n-- ASN1STOP\n\n\u2013\tCellAccessRelatedInfo-EUTRA-EPC\nThe IE CellAccessRelatedInfo-EUTRA-EPC indicates cell access related information for an LTE cell connected to EPC.\nCellAccessRelatedInfo-EUTRA-EPC information element\n-- ASN1START\n-- TAG-CELLACCESSRELATEDINFOEUTRA-EPC-START\n\nCellAccessRelatedInfo-EUTRA-EPC  ::=    SEQUENCE {\n    plmn-IdentityList-eutra-epc             PLMN-IdentityList-EUTRA-EPC,\n    trackingAreaCode-eutra-epc              BIT STRING (SIZE (16)),\n    cellIdentity-eutra-epc                  BIT STRING (SIZE (28))\n}\n\nPLMN-IdentityList-EUTRA-EPC::=          SEQUENCE (SIZE (1..maxPLMN)) OF PLMN-Identity\n\n-- TAG-CELLACCESSRELATEDINFOEUTRA-EPC-STOP\n-- ASN1STOP\n\n\u2013\tCellGroupConfig\nThe CellGroupConfig IE is used to configure a master cell group (MCG) or secondary cell group (SCG). A cell group comprises of one MAC entity, a set of logical channels with associated RLC entities and of a primary cell (SpCell) and one or more secondary cells (SCells).\nCellGroupConfig information element\n-- ASN1START\n-- TAG-CELLGROUPCONFIG-START\n\n-- Configuration of one Cell-Group:\nCellGroupConfig ::=                         SEQUENCE {\n    cellGroupId                                 CellGroupId,\n\n    rlc-BearerToAddModList                      SEQUENCE (SIZE(1..maxLC-ID)) OF RLC-BearerConfig            OPTIONAL,   -- Need N\n    rlc-BearerToReleaseList                     SEQUENCE (SIZE(1..maxLC-ID)) OF LogicalChannelIdentity      OPTIONAL,   -- Need N\n\n    mac-CellGroupConfig                         MAC-CellGroupConfig                                         OPTIONAL,   -- Need M\n\n    physicalCellGroupConfig                     PhysicalCellGroupConfig                                     OPTIONAL,   -- Need M\n\n    spCellConfig                                SpCellConfig                                                OPTIONAL,   -- Need M\n    sCellToAddModList                           SEQUENCE (SIZE (1..maxNrofSCells)) OF SCellConfig           OPTIONAL,   -- Need N\n    sCellToReleaseList                          SEQUENCE (SIZE (1..maxNrofSCells)) OF SCellIndex            OPTIONAL,   -- Need N\n    ...,\n    [[\n    reportUplinkTxDirectCurrent-v1530           ENUMERATED {true}                                           OPTIONAL    -- Cond BWP-Reconfig\n    ]]\n}\n\n-- Serving cell specific MAC and PHY parameters for a SpCell:\nSpCellConfig ::=                        SEQUENCE {\n    servCellIndex                       ServCellIndex                                               OPTIONAL,   -- Cond SCG\n    reconfigurationWithSync             ReconfigurationWithSync                                     OPTIONAL,   -- Cond ReconfWithSync\n    rlf-TimersAndConstants              SetupRelease { RLF-TimersAndConstants }                     OPTIONAL,   -- Need M\n    rlmInSyncOutOfSyncThreshold         ENUMERATED {n1}                                             OPTIONAL,   -- Need S\n    spCellConfigDedicated               ServingCellConfig                                           OPTIONAL,   -- Need M\n    ...\n}\n\nReconfigurationWithSync ::=         SEQUENCE {\n    spCellConfigCommon                  ServingCellConfigCommon                                         OPTIONAL,   -- Need M\n    newUE-Identity                      RNTI-Value,\n    t304                                ENUMERATED {ms50, ms100, ms150, ms200, ms500, ms1000, ms2000, ms10000},\n    rach-ConfigDedicated                CHOICE {\n        uplink                              RACH-ConfigDedicated,\n        supplementaryUplink                 RACH-ConfigDedicated\n    }                                                                                               OPTIONAL,   -- Need N\n    ...,\n    [[\n    smtc                                SSB-MTC                                                     OPTIONAL    -- Need S\n    ]]\n}\n\nSCellConfig ::=                     SEQUENCE {\n    sCellIndex                          SCellIndex,\n    sCellConfigCommon                   ServingCellConfigCommon                                     OPTIONAL,   -- Cond SCellAdd\n    sCellConfigDedicated                ServingCellConfig                                           OPTIONAL,   -- Cond SCellAddMod\n    ...,\n    [[\n    smtc                                SSB-MTC                                                     OPTIONAL    -- Need S\n    ]]\n}\n\n-- TAG-CELLGROUPCONFIG-STOP\n-- ASN1STOP\n\nCellGroupConfig field descriptions\nmac-CellGroupConfig\tMAC parameters applicable for the entire cell group.\nrlc-BearerToAddModList\tConfiguration of the MAC Logical Channel, the corresponding RLC entities and association with radio bearers.\nreportUplinkTxDirectCurrent\tEnables reporting of uplink Direct Current location information upon BWP configuration and reconfiguration. This field is only present when the BWP configuration is modified or any serving cell is added or removed. This field is not present in the IE CellGroupConfig when provided as part of RRCSetup message.\nrlmInSyncOutOfSyncThreshold\tBLER threshold pair index for IS/OOS indication generation, see TS 38.133 [14], Table 8.1.1-1. n1 corresponds to the value 1. When the field is absent, the UE applies the value 0. Whenever this is reconfigured, UE resets N310 and N311, and stops T310, if running. \nsCellToAddModList\tList of seconary serving cells (SCells) to be added or modified.\nsCellToReleaseList\tList of secondary serving cells (SCells) to be released.\nspCellConfig\tParameters for the SpCell of this cell group (PCell of MCG or PSCell of SCG). \n\nReconfigurationWithSync field descriptions\nrach-ConfigDedicated\tRandom access configuration to be used for the reconfiguration with sync (e.g. handover). The UE performs the RA according to these parameters in the firstActiveUplinkBWP (see UplinkConfig).\nsmtc\tThe SSB periodicity/offset/duration configuration of target cell for NR PSCell change and intra-NR handover. The network sets the periodicityAndOffset to indicate the same periodicity as ssb-periodicityServingCell in spCellConfigCommon. For case of intra-NR handover, the smtc is based on the timing reference of source PCell. For case of NR PSCell change, it is based on the timing reference of source PSCell. If the field is absent, the UE uses the SMTC configured in the measObjectNR having the same SSB frequency and subcarrier spacing.\n\nSCellConfig field descriptions\nsmtc\tThe SSB periodicity/offset/duration configuration of target cell for NR SCell addition. The network sets the periodicityAndOffset to indicate the same periodicity as ssb-periodicityServingCell in sCellConfigCommon. The smtc is based on the timing of the SpCell of associated cell group. In case of inter-RAT handover to NR, the timing reference is the NR PCell. In case of intra-NR PCell change (standalone NR) or NR PSCell change (EN-DC), the timing reference is the target SpCell. If the field is absent, the UE uses the SMTC configured in the measObjectNR having the same SSB frequency and subcarrier spacing.\n\nSpCellConfig field descriptions\nreconfigurationWithSync\tParameters for the synchronous reconfiguration to the target SpCell.\nrlf-TimersAndConstants\tTimers and constants for detecting and triggering cell-level radio link failure. For the SCG, rlf-TimersAndConstants can only be set to setup and is always included at SCG addition.\nservCellIndex\tServing cell ID of a PSCell. The PCell of the Master Cell Group uses ID = 0.\n\nConditional Presence\tExplanation\nBWP-Reconfig\tThe field is optionally present, Need N, if the BWPs are reconfigured or if serving cells are added or removed in the same message. Otherwise it is absent. \nReconfWithSync\tThe field is mandatory present in case of SpCell change, PSCell addition, SI update for PSCell and AS security key change; otherwise it is optionally present, need M. The field is not present in RRCResume or RRCSetup messages. \nSCellAdd\nSCellAddMod\tThe field is mandatory present upon SCell addition; otherwise it is optionally present, need M.\nSCG\tThe field is mandatory present in an SpCellConfig for the PSCell. It is absent otherwise. \n\n\u2013\tCellGroupId\nThe IE CellGroupId is used to identify a cell group. 0 identifies the master cell group. Other values identify secondary cell groups. In this version of the specification only values 0 and 1 are supported.\nCellGroupId information element\n-- ASN1START\n-- TAG-CELLGROUPID-START\n\nCellGroupId ::=                             INTEGER (0.. maxSecondaryCellGroups)\n\n-- TAG-CELLGROUPID-STOP\n-- ASN1STOP\n\n\u2013\tCellIdentity\nThe IE CellIdentity is used to unambiguously identify a cell within a PLMN.\nCellIdentity information element\n-- ASN1START\n-- TAG-CELLIDENTITY-START\n\nCellIdentity ::=                         BIT STRING (SIZE (36))\n\n-- TAG-CELLIDENTITY-STOP\n-- ASN1STOP\n\n\u2013\tCellReselectionPriority\nThe IE CellReselectionPriority concerns the absolute priority of the concerned carrier frequency, as used by the cell reselection procedure. Corresponds to parameter \"priority\" in TS 38.304 [20]. Value 0 means lowest priority. The UE behaviour for the case the field is absent, if applicable, is specified in TS 38.304 [20].\nCellReselectionPriority information element\n-- ASN1START\n-- TAG-CELLRESELECTIONPRIORITY-START\n\nCellReselectionPriority ::=             INTEGER (0..7)\n\n-- TAG-CELLRESELECTIONPRIORITY-STOP\n-- ASN1STOP\n\n\u2013\tCellReselectionSubPriority\nThe IE CellReselectionSubPriority indicates a fractional value to be added to the value of cellReselectionPriority to obtain the absolute priority of the concerned carrier frequency for E-UTRA and NR. Value oDot2 corresponds to 0.2, value oDot4 corresponds to 0.4 and so on.\nCellReselectionSubPriority information element\n-- ASN1START\n-- TAG-CELLRESELECTIONSUBPRIORITY-START\n\nCellReselectionSubPriority ::=          ENUMERATED {oDot2, oDot4, oDot6, oDot8}\n\n-- TAG-CELLRESELECTIONSUBPRIORITY-STOP\n-- ASN1STOP\n\n\u2013\tCGI-Info\nThe IE CGI-Info indicates cell access related information, which is reported by the UE as part of report CGI procedure.\n\nCGI-Info information element\n-- ASN1START\n-- TAG-CGI-INFO-START\n\nCGI-Info ::=                    SEQUENCE {\n    plmn-IdentityInfoList               PLMN-IdentityInfoList               OPTIONAL,\n    frequencyBandList                   MultiFrequencyBandListNR            OPTIONAL,\n    noSIB1                              SEQUENCE {\n        ssb-SubcarrierOffset                INTEGER (0..15),\n        pdcch-ConfigSIB1                    PDCCH-ConfigSIB1\n    }                                                                       OPTIONAL,\n    ...\n}\n\n-- TAG-CGI-INFO-STOP\n-- ASN1STOP\n\nCGI-Info field descriptions\nnoSIB1\tContains ssb-SubcarrierOffset and pdcch-ConfigSIB1 fields acquired by the UE from MIB of the cell for which report CGI procedure was requested by the network in case SIB1 was not broadcast by the cell.\n\n\u2013\tCodebookConfig\nThe IE CodebookConfig is used to configure codebooks of Type-I and Type-II (see TS 38.214 [19], clause 5.2.2.2)\nCodebookConfig information element\n-- ASN1START\n-- TAG-CODEBOOKCONFIG-START\n\nCodebookConfig ::=                                  SEQUENCE {\n    codebookType                                        CHOICE {\n        type1                                               SEQUENCE {\n            subType                                             CHOICE {\n                typeI-SinglePanel                                   SEQUENCE {\n                    nrOfAntennaPorts                                    CHOICE {\n                        two                                                 SEQUENCE {\n                            twoTX-CodebookSubsetRestriction                     BIT STRING (SIZE (6))\n                        },\n                        moreThanTwo                                         SEQUENCE {\n                            n1-n2                                               CHOICE {\n                                two-one-TypeI-SinglePanel-Restriction               BIT STRING (SIZE (8)),\n                                two-two-TypeI-SinglePanel-Restriction               BIT STRING (SIZE (64)),\n                                four-one-TypeI-SinglePanel-Restriction              BIT STRING (SIZE (16)),\n                                three-two-TypeI-SinglePanel-Restriction             BIT STRING (SIZE (96)),\n                                six-one-TypeI-SinglePanel-Restriction               BIT STRING (SIZE (24)),\n                                four-two-TypeI-SinglePanel-Restriction              BIT STRING (SIZE (128)),\n                                eight-one-TypeI-SinglePanel-Restriction             BIT STRING (SIZE (32)),\n                                four-three-TypeI-SinglePanel-Restriction            BIT STRING (SIZE (192)),\n                                six-two-TypeI-SinglePanel-Restriction               BIT STRING (SIZE (192)),\n                                twelve-one-TypeI-SinglePanel-Restriction            BIT STRING (SIZE (48)),\n                                four-four-TypeI-SinglePanel-Restriction             BIT STRING (SIZE (256)),\n                                eight-two-TypeI-SinglePanel-Restriction             BIT STRING (SIZE (256)),\n                                sixteen-one-TypeI-SinglePanel-Restriction           BIT STRING (SIZE (64))\n                            },\n                            typeI-SinglePanel-codebookSubsetRestriction-i2      BIT STRING (SIZE (16))        OPTIONAL    -- Need R\n                        }\n                    },\n                    typeI-SinglePanel-ri-Restriction                    BIT STRING (SIZE (8))\n                },\n                typeI-MultiPanel                                    SEQUENCE {\n                    ng-n1-n2                                                CHOICE {\n                        two-two-one-TypeI-MultiPanel-Restriction                BIT STRING (SIZE (8)),\n                        two-four-one-TypeI-MultiPanel-Restriction               BIT STRING (SIZE (16)),\n                        four-two-one-TypeI-MultiPanel-Restriction               BIT STRING (SIZE (8)),\n                        two-two-two-TypeI-MultiPanel-Restriction                BIT STRING (SIZE (64)),\n                        two-eight-one-TypeI-MultiPanel-Restriction              BIT STRING (SIZE (32)),\n                        four-four-one-TypeI-MultiPanel-Restriction              BIT STRING (SIZE (16)),\n                        two-four-two-TypeI-MultiPanel-Restriction               BIT STRING (SIZE (128)),\n                        four-two-two-TypeI-MultiPanel-Restriction               BIT STRING (SIZE (64))\n                    },\n                    ri-Restriction                          BIT STRING (SIZE (4))\n                }\n            },\n            codebookMode                                        INTEGER (1..2)\n\n        },\n        type2                                   SEQUENCE {\n            subType                                 CHOICE {\n                typeII                                  SEQUENCE {\n                    n1-n2-codebookSubsetRestriction         CHOICE {\n                        two-one                                 BIT STRING (SIZE (16)),\n                        two-two                                 BIT STRING (SIZE (43)),\n                        four-one                                BIT STRING (SIZE (32)),\n                        three-two                               BIT STRING (SIZE (59)),\n                        six-one                                 BIT STRING (SIZE (48)),\n                        four-two                                BIT STRING (SIZE (75)),\n                        eight-one                               BIT STRING (SIZE (64)),\n                        four-three                              BIT STRING (SIZE (107)),\n                        six-two                                 BIT STRING (SIZE (107)),\n                        twelve-one                              BIT STRING (SIZE (96)),\n                        four-four                               BIT STRING (SIZE (139)),\n                        eight-two                               BIT STRING (SIZE (139)),\n                        sixteen-one                             BIT STRING (SIZE (128))\n                    },\n                    typeII-RI-Restriction                   BIT STRING (SIZE (2))\n                },\n                typeII-PortSelection                    SEQUENCE {\n                    portSelectionSamplingSize               ENUMERATED {n1, n2, n3, n4}                   OPTIONAL,       -- Need R\n                    typeII-PortSelectionRI-Restriction      BIT STRING (SIZE (2))\n                }\n            },\n            phaseAlphabetSize                       ENUMERATED {n4, n8},\n            subbandAmplitude                        BOOLEAN,\n            numberOfBeams                           ENUMERATED {two, three, four}\n        }\n    }\n}\n\n-- TAG-CODEBOOKCONFIG-STOP\n-- ASN1STOP\n\nCodebookConfig field descriptions\ncodebookMode\tCodebookMode as specified in TS 38.214 [19], clause 5.2.2.2.2.\ncodebookType\tCodebookType including possibly sub-types and the corresponding parameters for each (see TS 38.214 [19], clause 5.2.2.2).\nn1-n2-codebookSubsetRestriction\tNumber of antenna ports in first (n1) and second (n2) dimension and codebook subset restriction (see TS 38.214 [19] clause 5.2.2.2.3).\tNumber of bits for codebook subset restriction is CEIL(log2(nchoosek(O1*O2,4)))+8*n1*n2 where nchoosek(a,b) = a!/(b!(a-b)!).\nn1-n2\tNumber of antenna ports in first (n1) and second (n2) dimension and codebook subset restriction (see TS 38.214 [19] clause 5.2.2.2.1).\nng-n1-n2\tCodebook subset restriction for Type I Multi-panel codebook (see TS 38.214 [19], clause 5.2.2.2.2).\nnumberOfBeams\tNumber of beams, L, used for linear combination.\nphaseAlphabetSize\tThe size of the PSK alphabet, QPSK or 8-PSK.\nportSelectionSamplingSize\tThe size of the port selection codebook (parameter d).\nri-Restriction\tRestriction for RI for TypeI-MultiPanel-RI-Restriction (see TS 38.214 [19], clause 5.2.2.2.2).\nsubbandAmplitude\tIf subband amplitude reporting is activated (true).\ntwoTX-CodebookSubsetRestriction\tCodebook subset restriction for 2TX codebook (see TS 38.214 [19] clause 5.2.2.2.1).\ntypeI-SinglePanel-codebookSubsetRestriction-i2\ti2 codebook subset restriction for Type I Single-panel codebook used when reportQuantity is CRI/Ri/i1/CQI (see TS 38.214 [19] clause 5.2.2.2.1).\ntypeI-SinglePanel-ri-Restriction\tRestriction for RI for TypeI-SinglePanel-RI-Restriction (see TS 38.214 [19], clause 5.2.2.2.1).\ntypeII-PortSelectionRI-Restriction\tRestriction for RI for TypeII-PortSelection-RI-Restriction (see TS 38.214 [19], clause 5.2.2.4).\ntypeII-RI-Restriction\tRestriction for RI for TypeII-RI-Restriction (see TS 38.214 [19], clause 5.2.2.2.3).\n\n\u2013\tConfiguredGrantConfig\nThe IE ConfiguredGrantConfig is used to configure uplink transmission without dynamic grant according to two possible schemes. The actual uplink grant may either be configured via RRC (type1) or provided via the PDCCH (addressed to CS-RNTI) (type2).\nConfiguredGrantConfig information element\n-- ASN1START\n-- TAG-CONFIGUREDGRANTCONFIG-START\n\nConfiguredGrantConfig ::=           SEQUENCE {\n    frequencyHopping                    ENUMERATED {intraSlot, interSlot}                                       OPTIONAL,   -- Need S,\n    cg-DMRS-Configuration               DMRS-UplinkConfig,\n    mcs-Table                           ENUMERATED {qam256, qam64LowSE}                                         OPTIONAL,   -- Need S\n    mcs-TableTransformPrecoder          ENUMERATED {qam256, qam64LowSE}                                         OPTIONAL,   -- Need S\n    uci-OnPUSCH                         SetupRelease { CG-UCI-OnPUSCH }                                         OPTIONAL,   -- Need M\n    resourceAllocation                  ENUMERATED { resourceAllocationType0, resourceAllocationType1, dynamicSwitch },\n    rbg-Size                            ENUMERATED {config2}                                                    OPTIONAL,   -- Need S\n    powerControlLoopToUse               ENUMERATED {n0, n1},\n    p0-PUSCH-Alpha                      P0-PUSCH-AlphaSetId,\n    transformPrecoder                   ENUMERATED {enabled, disabled}                                          OPTIONAL,   -- Need S\n    nrofHARQ-Processes                  INTEGER(1..16),\n    repK                                ENUMERATED {n1, n2, n4, n8},\n    repK-RV                             ENUMERATED {s1-0231, s2-0303, s3-0000}                                  OPTIONAL,   -- Need R\n    periodicity                         ENUMERATED {\n                                                sym2, sym7, sym1x14, sym2x14, sym4x14, sym5x14, sym8x14, sym10x14, sym16x14, sym20x14,\n                                                sym32x14, sym40x14, sym64x14, sym80x14, sym128x14, sym160x14, sym256x14, sym320x14, sym512x14,\n                                                sym640x14, sym1024x14, sym1280x14, sym2560x14, sym5120x14,\n                                                sym6, sym1x12, sym2x12, sym4x12, sym5x12, sym8x12, sym10x12, sym16x12, sym20x12, sym32x12,\n                                                sym40x12, sym64x12, sym80x12, sym128x12, sym160x12, sym256x12, sym320x12, sym512x12, sym640x12,\n                                                sym1280x12, sym2560x12\n    },\n    configuredGrantTimer                    INTEGER (1..64)                                                     OPTIONAL,   -- Need R\n    rrc-ConfiguredUplinkGrant               SEQUENCE {\n        timeDomainOffset                        INTEGER (0..5119),\n        timeDomainAllocation                    INTEGER  (0..15),\n        frequencyDomainAllocation               BIT STRING (SIZE(18)),\n        antennaPort                             INTEGER (0..31),\n        dmrs-SeqInitialization                  INTEGER (0..1)                                                  OPTIONAL,   -- Need R\n        precodingAndNumberOfLayers              INTEGER (0..63),\n        srs-ResourceIndicator                   INTEGER (0..15)                                                 OPTIONAL,   -- Need R\n        mcsAndTBS                               INTEGER (0..31),\n        frequencyHoppingOffset                  INTEGER (1.. maxNrofPhysicalResourceBlocks-1)                   OPTIONAL,   -- Need R\n        pathlossReferenceIndex                  INTEGER (0..maxNrofPUSCH-PathlossReferenceRSs-1),\n        ...\n    }                                                                                                           OPTIONAL,   -- Need R\n    ...\n}\n\nCG-UCI-OnPUSCH ::= CHOICE {\n    dynamic                                 SEQUENCE (SIZE (1..4)) OF BetaOffsets,\n    semiStatic                              BetaOffsets\n}\n\n-- TAG-CONFIGUREDGRANTCONFIG-STOP\n-- ASN1STOP\n\nConfiguredGrantConfig field descriptions\nantennaPort\tIndicates the antenna port(s) to be used for this configuration, and the maximum bitwidth is 5. See TS 38.214 [19], clause 6.1.2, and TS 38.212 [17], clause 7.3.1.\ncg-DMRS-Configuration\tDMRS configuration (see TS 38.214 [19], clause 6.1.2.3).\nconfiguredGrantTimer\tIndicates the initial value of the configured grant timer (see TS 38.321 [3]) in multiples of periodicity. \ndmrs-SeqInitialization\tThe network configures this field if transformPrecoder is disabled. Otherwise the field is absent.\nfrequencyDomainAllocation\tIndicates the frequency domain resource allocation, see TS 38.214 [19], clause 6.1.2, and TS 38.212 [17], clause 7.3.1).\nfrequencyHopping\tThe value intraSlot enables 'Intra-slot frequency hopping' and the value interSlot enables 'Inter-slot frequency hopping'. If the field is absent, frequency hopping is not configured.\nfrequencyHoppingOffset\tEnables intra-slot frequency hopping with the given frequency hopping offset. Frequency hopping offset used when frequency hopping is enabled (see TS 38.214 [19], clause 6.1.2).\nmcs-Table\tIndicates the MCS table the UE shall use for PUSCH without transform precoding. If the field is absent the UE applies the value qam64.\nmcs-TableTransformPrecoder\tIndicates the MCS table the UE shall use for PUSCH with transform precoding. If the field is absent the UE applies the value qam64.\nmcsAndTBS\tThe modulation order, target code rate and TB size (see TS 38.214 [19], clause 6.1.2). The NW does not configure the values 28~31 in this version of the specification.\nnrofHARQ-Processes\tThe number of HARQ processes configured. It applies for both Type 1 and Type 2. See TS 38.321 [3], clause 5.4.1.\np0-PUSCH-Alpha\tIndex of the P0-PUSCH-AlphaSet to be used for this configuration.\nperiodicity\tPeriodicity for UL transmission without UL grant for type 1 and type 2 (see TS 38.321 [3], clause 5.8.2).\tThe following periodicities are supported depending on the configured subcarrier spacing [symbols]:\t15 kHz:\t\t\t\t\t2, 7, n*14, where n={1, 2, 4, 5, 8, 10, 16, 20, 32, 40, 64, 80, 128, 160, 320, 640}\t30 kHz:\t\t\t\t\t2, 7, n*14, where n={1, 2, 4, 5, 8, 10, 16, 20, 32, 40, 64, 80, 128, 160, 256, 320, 640, 1280}\t60 kHz with normal CP:\t2, 7, n*14, where n={1, 2, 4, 5, 8, 10, 16, 20, 32, 40, 64, 80, 128, 160, 256, 320, 512, 640, 1280, 2560}\t60 kHz with ECP:\t\t2, 6, n*12, where n={1, 2, 4, 5, 8, 10, 16, 20, 32, 40, 64, 80, 128, 160, 256, 320, 512, 640, 1280, 2560}\t120 kHz:\t\t\t\t\t2, 7, n*14, where n={1, 2, 4, 5, 8, 10, 16, 20, 32, 40, 64, 80, 128, 160, 256, 320, 512, 640, 1024, 1280, 2560, 5120}\npowerControlLoopToUse\tClosed control loop to apply (see TS 38.213 [13], clause 7.1.1).\nrbg-Size\tSelection between configuration 1 and configuration 2 for RBG size for PUSCH. The UE does not apply this field if resourceAllocation is set to resourceAllocationType1. Otherwise, the UE applies the value config1 when the field is absent. Note: rbg-Size is used when the transformPrecoder parameter is disabled.\nrepK-RV\tThe redundancy version (RV) sequence to use. See TS 38.214 [19], clause 6.1.2. The network configures this field if repetitions are used, i.e., if repK is set to n2, n4 or n8. Otherwise, the field is absent.\nrepK\tThe number of repetitions of K.\nresourceAllocation\tConfiguration of resource allocation type 0 and resource allocation type 1. For Type 1 UL data transmission without grant, \"resourceAllocation\" should be resourceAllocationType0 or resourceAllocationType1.\nrrc-ConfiguredUplinkGrant\tConfiguration for \"configured grant\" transmission with fully RRC-configured UL grant (Type1). If this field is absent the UE uses UL grant configured by DCI addressed to CS-RNTI (Type2). Type 1 configured grant may be configured for UL or SUL, but not for both simultaneously.\nsrs-ResourceIndicator\tIndicates the SRS resource to be used. \ntimeDomainAllocation\tIndicates a combination of start symbol and length and PUSCH mapping type, see TS 38.214 [19], clause 6.1.2 and TS 38.212 [17], clause 7.3.1.\ntimeDomainOffset\tOffset related to SFN=0, see TS 38.321 [3], clause 5.8.2.\ntransformPrecoder\tEnables or disables transform precoding for type1 and type2. If the field is absent, the UE enables or disables transform precoding in accordance with the field msg3-transformPrecoder in RACH-ConfigCommon, see TS 38.214 [19], clause 6.1.3.\nuci-OnPUSCH\tSelection between and configuration of dynamic and semi-static beta-offset. For Type 1 UL data transmission without grant, uci-OnPUSCH should be set to semiStatic.\n\n\u2013\tConnEstFailureControl\nThe IE ConnEstFailureControl is used to configure parameters for connection establishment failure control.\nConnEstFailureControl information element\n-- ASN1START\n-- TAG-CONNESTFAILURECONTROL-START\n\nConnEstFailureControl ::=   SEQUENCE {\n    connEstFailCount                    ENUMERATED {n1, n2, n3, n4},\n    connEstFailOffsetValidity           ENUMERATED {s30, s60, s120, s240, s300, s420, s600, s900},\n    connEstFailOffset                   INTEGER (0..15)                                                         OPTIONAL    -- Need S\n}\n\n-- TAG-CONNESTFAILURECONTROL-STOP\n-- ASN1STOP\n\nConnEstFailureControl field descriptions\nconnEstFailCount\tNumber of times that the UE detects T300 expiry on the same cell before applying connEstFailOffset. \nconnEstFailOffset\tParameter \"Qoffsettemp\" in TS 38.304 [20]. If the field is not present the value of infinity shall be used for \"Qoffsettemp\".\nconnEstFailOffsetValidity\tAmount of time that the UE applies connEstFailOffset before removing the offset from evaluation of the cell. Value s30 corresponds to 30 seconds, value s60 corresponds to 60 seconds, and so on.\n\n\u2013\tControlResourceSet\nThe IE ControlResourceSet is used to configure a time/frequency control resource set (CORESET) in which to search for downlink control information (see TS 38.213 [13], clause 10.1).\nControlResourceSet information element\n-- ASN1START\n-- TAG-CONTROLRESOURCESET-START\n\nControlResourceSet ::=              SEQUENCE {\n    controlResourceSetId                ControlResourceSetId,\n\n    frequencyDomainResources            BIT STRING (SIZE (45)),\n    duration                            INTEGER (1..maxCoReSetDuration),\n    cce-REG-MappingType                 CHOICE {\n        interleaved                         SEQUENCE {\n            reg-BundleSize                      ENUMERATED {n2, n3, n6},\n            interleaverSize                     ENUMERATED {n2, n3, n6},\n            shiftIndex                          INTEGER(0..maxNrofPhysicalResourceBlocks-1)       OPTIONAL -- Need S\n        },\n        nonInterleaved                      NULL\n    },\n    precoderGranularity                 ENUMERATED {sameAsREG-bundle, allContiguousRBs},\n    tci-StatesPDCCH-ToAddList           SEQUENCE(SIZE (1..maxNrofTCI-StatesPDCCH)) OF TCI-StateId OPTIONAL, -- Cond NotSIB1-initialBWP\n    tci-StatesPDCCH-ToReleaseList       SEQUENCE(SIZE (1..maxNrofTCI-StatesPDCCH)) OF TCI-StateId OPTIONAL, -- Cond NotSIB1-initialBWP\n    tci-PresentInDCI                        ENUMERATED {enabled}                                  OPTIONAL, -- Need S\n    pdcch-DMRS-ScramblingID                 INTEGER (0..65535)                                    OPTIONAL, -- Need S\n    ...\n}\n\n-- TAG-CONTROLRESOURCESET-STOP\n-- ASN1STOP\n\nControlResourceSet field descriptions\ncce-REG-MappingType\tMapping of Control Channel Elements (CCE) to Resource Element Groups (REG) (see TS 38.211 [16], clauses 7.3.2.2 and 7.4.1.3.2).\ncontrolResourceSetId\tValue 0 identifies the common CORESET configured in MIB and in ServingCellConfigCommon (controlResourceSetZero) and is hence not used here in the ControlResourceSet IE. Values 1..maxNrofControlResourceSets-1 identify CORESETs configured by dedicated signalling or in SIB1. The controlResourceSetId is unique among the BWPs of a serving cell.\nduration\tContiguous time duration of the CORESET in number of symbols (see TS 38.211 [16], clause 7.3.2.2).\nfrequencyDomainResources\tFrequency domain resources for the CORESET. Each bit corresponds a group of 6 RBs, with grouping starting from the first RB group (see TS 38.213 [13], clause 10.1) in the BWP. The first (left-most / most significant) bit corresponds to the first RB group in the BWP, and so on. A bit that is set to 1 indicates that this RB group belongs to the frequency domain resource of this CORESET. Bits corresponding to a group of RBs not fully contained in the bandwidth part within which the CORESET is configured are set to zero (see TS 38.211 [16], clause 7.3.2.2).\ninterleaverSize\tInterleaver-size (see TS 38.211 [16], clause 7.3.2.2).\npdcch-DMRS-ScramblingID\tPDCCH DMRS scrambling initialization (see TS 38.211 [16], clause 7.4.1.3.1). When the field is absent the UE applies the value of the physCellId configured for this serving cell.\nprecoderGranularity\tPrecoder granularity in frequency domain (see TS 38.211 [16], clauses 7.3.2.2 and 7.4.1.3.2).\nreg-BundleSize\tResource Element Groups (REGs) can be bundled to create REG bundles. This parameter defines the size of such bundles (see TS 38.211 [16], clause 7.3.2.2).\nshiftIndex\tWhen the field is absent the UE applies the value of the physCellIdconfigured for this serving cell (see TS 38.211 [16], clause 7.3.2.2).\ntci-PresentInDCI\tIf at least spatial QCL is configured/indicated, this field indicates if TCI field is present or not present in DL-related DCI. When the field is absent the UE considers the TCI to be absent/disabled. In case of cross carrier scheduling, the network sets this field to enabled for the ControlResourceSet used for cross carrier scheduling in the scheduling cell (see TS 38.214 [19], clause 5.1.5).\ntci-StatesPDCCH-ToAddList\tA subset of the TCI states defined in pdsch-Config included in the BWP-DownlinkDedicated corresponding to the serving cell and to the DL BWP to which the ControlResourceSet belong to. They are used for providing QCL relationships between the DL RS(s) in one RS Set (TCI-State) and the PDCCH DMRS ports (see TS 38.213 [13], clause 6.). The network configures at most maxNrofTCI-StatesPDCCH entries.\n\nConditional Presence\tExplanation\nNotSIB1-initialBWP\tThe field is absent in SIB1 and in the PDCCH-ConfigCommon of the initial BWP in ServingCellConfigCommon, if SIB1 is broadcasted. Otherwise, it is optionally present, Need N.\n\n\u2013\tControlResourceSetId\nThe ControlResourceSetId IE concerns a short identity, used to identify a control resource set within a serving cell. The ControlResourceSetId = 0 identifies the ControlResourceSet#0 configured via PBCH (MIB) and in controlResourceSetZero (ServingCellConfigCommon). The ID space is used across the BWPs of a Serving Cell. The number of CORESETs per BWP is limited to 3 (including common and UE-specific CORESETs).\nControlResourceSetId information element\n-- ASN1START\n-- TAG-CONTROLRESOURCESETID-START\n\nControlResourceSetId ::=                INTEGER (0..maxNrofControlResourceSets-1)\n\n-- TAG-CONTROLRESOURCESETID-STOP\n-- ASN1STOP\n\n\u2013\tControlResourceSetZero\nThe IE ControlResourceSetZero is used to configure CORESET#0 of the initial BWP (see TS 38.213 [13], clause 13).\nControlResourceSetZero information element\n-- ASN1START\n-- TAG-CONTROLRESOURCESETZERO-START\n\nControlResourceSetZero ::=                  INTEGER (0..15)\n\n-- TAG-CONTROLRESOURCESETZERO-STOP\n-- ASN1STOP\n\n\u2013\tCrossCarrierSchedulingConfig\nThe IE CrossCarrierSchedulingConfig is used to specify the configuration when the cross-carrier scheduling is used in a cell.\nCrossCarrierSchedulingConfig information element\n-- ASN1START\n-- TAG-CrossCarrierSchedulingConfig-START\n\nCrossCarrierSchedulingConfig ::=        SEQUENCE {\n    schedulingCellInfo                      CHOICE {\n        own                                     SEQUENCE {                  -- No cross carrier scheduling\n            cif-Presence                            BOOLEAN\n        },\n        other                                   SEQUENCE {                  -- Cross carrier scheduling\n            schedulingCellId                        ServCellIndex,\n            cif-InSchedulingCell                    INTEGER (1..7)\n        }\n    },\n    ...\n}\n\n-- TAG-CrossCarrierSchedulingConfig-STOP\n-- ASN1STOP\n\nCrossCarrierSchedulingConfig field descriptions\ncif-Presence\tThe field is used to indicate whether carrier indicator field is present (value true) or not (value false) in PDCCH DCI formats, see TS 38.213 [13]. \ncif-InSchedulingCell\tThe field indicates the CIF value used in the scheduling cell to indicate a grant or assignment applicable for this cell, see TS 38.213 [13]. If cif-Presence is set to true, the CIF value indicating a grant or assignment for this cell is 0.\nother\tParameters for cross-carrier scheduling, i.e., a serving cell is scheduled by a PDCCH on another (scheduling) cell. The network configures this field only for SCells.\nown\tParameters for self-scheduling, i.e., a serving cell is scheduled by its own PDCCH.\nschedulingCellId\tIndicates which cell signals the downlink allocations and uplink grants, if applicable, for the concerned SCell. In case the UE is configured with DC, the scheduling cell is part of the same cell group (i.e. MCG or SCG) as the scheduled cell.\n\n\u2013\tCSI-AperiodicTriggerStateList\nThe CSI-AperiodicTriggerStateList IE is used to configure the UE with a list of aperiodic trigger states. Each codepoint of the DCI field \"CSI request\" is associated with one trigger state (see TS 38.321 [3], clause 6.1.3.13). Upon reception of the value associated with a trigger state, the UE will perform measurement of CSI-RS, CSI-IM and/or SSB (reference signals) and aperiodic reporting on L1 according to all entries in the associatedReportConfigInfoList for that trigger state.\n\nCSI-AperiodicTriggerStateList information element\n-- ASN1START\n-- TAG-CSI-APERIODICTRIGGERSTATELIST-START\n\nCSI-AperiodicTriggerStateList ::=   SEQUENCE (SIZE (1..maxNrOfCSI-AperiodicTriggers)) OF CSI-AperiodicTriggerState\n\nCSI-AperiodicTriggerState ::=       SEQUENCE {\n    associatedReportConfigInfoList      SEQUENCE (SIZE(1..maxNrofReportConfigPerAperiodicTrigger)) OF CSI-AssociatedReportConfigInfo,\n    ...\n}\n\nCSI-AssociatedReportConfigInfo ::=  SEQUENCE {\n    reportConfigId                      CSI-ReportConfigId,\n    resourcesForChannel                 CHOICE {\n        nzp-CSI-RS                          SEQUENCE {\n            resourceSet                         INTEGER (1..maxNrofNZP-CSI-RS-ResourceSetsPerConfig),\n            qcl-info                            SEQUENCE (SIZE(1..maxNrofAP-CSI-RS-ResourcesPerSet)) OF TCI-StateId\n                                                                                        OPTIONAL  -- Cond Aperiodic\n        },\n        csi-SSB-ResourceSet                 INTEGER (1..maxNrofCSI-SSB-ResourceSetsPerConfig)\n    },\n    csi-IM-ResourcesForInterference     INTEGER(1..maxNrofCSI-IM-ResourceSetsPerConfig)\n                                                                                        OPTIONAL, -- Cond CSI-IM-ForInterference\n    nzp-CSI-RS-ResourcesForInterference INTEGER (1..maxNrofNZP-CSI-RS-ResourceSetsPerConfig)\n                                                                                        OPTIONAL, -- Cond NZP-CSI-RS-ForInterference\n    ...\n}\n\n-- TAG-CSI-APERIODICTRIGGERSTATELIST-STOP\n-- ASN1STOP\n\nCSI-AssociatedReportConfigInfo field descriptions\ncsi-IM-ResourcesForInterference\tCSI-IM-ResourceSet for interference measurement. Entry number in csi-IM-ResourceSetList in the CSI-ResourceConfig indicated by csi-IM-ResourcesForInterference in the CSI-ReportConfig indicated by reportConfigId above (value 1 corresponds to the first entry, value 2 to the second entry, and so on). The indicated CSI-IM-ResourceSet should have exactly the same number of resources like the NZP-CSI-RS-ResourceSet indicated in nzp-CSI-RS-ResourcesforChannel. \ncsi-SSB-ResourceSet\tCSI-SSB-ResourceSet for channel measurements. Entry number in csi-SSB-ResourceSetList in the CSI-ResourceConfig indicated by resourcesForChannelMeasurement in the CSI-ReportConfig indicated by reportConfigId above (value 1 corresponds to the first entry, value 2 to the second entry, and so on).\nnzp-CSI-RS-ResourcesForInterference\tNZP-CSI-RS-ResourceSet for interference measurement. Entry number in nzp-CSI-RS-ResourceSetList in the CSI-ResourceConfig indicated by nzp-CSI-RS-ResourcesForInterference in the CSI-ReportConfig indicated by reportConfigId above (value 1 corresponds to the first entry, value 2 to the second entry, and so on). \nqcl-info\tList of references to TCI-States for providing the QCL source and QCL type for each NZP-CSI-RS-Resource listed in nzp-CSI-RS-Resources of the NZP-CSI-RS-ResourceSet indicated by nzp-CSI-RS-ResourcesforChannel. Each TCI-StateId refers to the TCI-State which has this value for tci-StateId and is defined in tci-StatesToAddModList in the PDSCH-Config included in the BWP-Downlink corresponding to the serving cell and to the DL BWP to which the resourcesForChannelMeasurement (in the CSI-ReportConfig indicated by reportConfigId above) belong to. First entry in qcl-info-forChannel corresponds to first entry in nzp-CSI-RS-Resources of that NZP-CSI-RS-ResourceSet, second entry in qcl-info-forChannel corresponds to second entry in nzp-CSI-RS-Resources, and so on (see TS 38.214 [19], clause 5.2.1.5.1)\nreportConfigId\tThe reportConfigId of one of the CSI-ReportConfigToAddMod configured in CSI-MeasConfig\nresourceSet\tNZP-CSI-RS-ResourceSet for channel measurements. Entry number in nzp-CSI-RS-ResourceSetList in the CSI-ResourceConfig indicated by resourcesForChannelMeasurement in the CSI-ReportConfig indicated by reportConfigId above (value 1 corresponds to the first entry, value 2 to thesecond entry, and so on).\n\nConditional Presence\tExplanation\nAperiodic\tThe field is mandatory present if the NZP-CSI-RS-Resources in the associated resourceSet have the resourceType aperiodic. The field is absent otherwise. \nCSI-IM-ForInterference\tThis field is optionally present, need M if the CSI-ReportConfig identified by reportConfigId is configured with csi-IM-ResourcesForInterference; otherwise it is absent.\nNZP-CSI-RS-ForInterference\tThis field is optionally present, need M if the CSI-ReportConfig identified by reportConfigId is configured with nzp-CSI-RS-ResourcesForInterference; otherwise it is absent. \n\n\u2013\tCSI-FrequencyOccupation\nThe IE CSI-FrequencyOccupation is used to configure the frequency domain occupation of a channel state information measurement resource (e.g. NZP-CSI-RS-Resource, CSI-IM-Resource).\nCSI-FrequencyOccupation information element\n-- ASN1START\n-- TAG-CSI-FREQUENCYOCCUPATION-START\n\nCSI-FrequencyOccupation ::=         SEQUENCE {\n    startingRB                          INTEGER (0..maxNrofPhysicalResourceBlocks-1),\n    nrofRBs                             INTEGER (24..maxNrofPhysicalResourceBlocksPlus1),\n    ...\n}\n\n-- TAG-CSI-FREQUENCYOCCUPATION-STOP\n-- ASN1STOP\n\nCSI-FrequencyOccupation field descriptions\nnrofRBs\tNumber of PRBs across which this CSI resource spans. Only multiples of 4 are allowed. The smallest configurable number is the minimum of 24 and the width of the associated BWP. If the configured value is larger than the width of the corresponding BWP, the UE shall assume that the actual CSI-RS bandwidth is equal to the width of the BWP.\nstartingRB\tPRB where this CSI resource starts in relation to common resource block #0 (CRB#0) on the common resource block grid. Only multiples of 4 are allowed (0, 4, ...)\n\n\u2013\tCSI-IM-Resource\nThe IE CSI-IM-Resource is used to configure one CSI Interference Management (IM) resource.\nCSI-IM-Resource information element\n-- ASN1START\n-- TAG-CSI-IM-RESOURCE-START\n\nCSI-IM-Resource ::=                 SEQUENCE {\n    csi-IM-ResourceId                   CSI-IM-ResourceId,\n    csi-IM-ResourceElementPattern           CHOICE {\n        pattern0                                SEQUENCE {\n            subcarrierLocation-p0                   ENUMERATED { s0, s2, s4, s6, s8, s10 },\n            symbolLocation-p0                       INTEGER (0..12)\n        },\n        pattern1                                SEQUENCE {\n            subcarrierLocation-p1                   ENUMERATED { s0, s4, s8 },\n            symbolLocation-p1                       INTEGER (0..13)\n        }\n    }                                                                                   OPTIONAL,   -- Need M\n    freqBand                            CSI-FrequencyOccupation                         OPTIONAL,   -- Need M\n    periodicityAndOffset                CSI-ResourcePeriodicityAndOffset                OPTIONAL,   -- Cond PeriodicOrSemiPersistent\n    ...\n}\n\n-- TAG-CSI-IM-RESOURCE-STOP\n-- ASN1STOP\n\nCSI-IM-Resource field descriptions\ncsi-IM-ResourceElementPattern\tThe resource element pattern (Pattern0 (2,2) or Pattern1 (4,1)) with corresponding parameters (see TS 38.214 [19], clause 5.2.2.4)\nfreqBand\tFrequency-occupancy of CSI-IM (see TS 38.214 [19], clause 5.2.2.4)\nperiodicityAndOffset\nsubcarrierLocation-p0\tOFDM subcarrier occupancy of the CSI-IM resource for Pattern0 (see TS 38.214 [19], clause 5.2.2.4)\nsubcarrierLocation-p1\tOFDM subcarrier occupancy of the CSI-IM resource for Pattern1 (see TS 38.214 [19], clause 5.2.2.4)\nsymbolLocation-p0\tOFDM symbol location of the CSI-IM resource for Pattern0 (see TS 38.214 [19], clause 5.2.2.4)\nsymbolLocation-p1\tOFDM symbol location of the CSI-IM resource for Pattern1 (see TS 38.214 [19], clause 5.2.2.4)\n\nConditional Presence\tExplanation\nPeriodicOrSemiPersistent\tThe field is optionally present, Need M, for periodic and semi-persistent CSI-IM-Resources (as indicated in CSI-ResourceConfig). The field is absent otherwise.  \n\n\u2013\tCSI-IM-ResourceId\nThe IE CSI-IM-ResourceId is used to identify one CSI-IM-Resource.\nCSI-IM-ResourceId information element\n-- ASN1START\n-- TAG-CSI-IM-RESOURCEID-START\n\nCSI-IM-ResourceId ::=               INTEGER (0..maxNrofCSI-IM-Resources-1)\n\n-- TAG-CSI-IM-RESOURCEID-STOP\n-- ASN1STOP\n\n\u2013\tCSI-IM-ResourceSet\nThe IE CSI-IM-ResourceSet is used to configure a set of one or more CSI Interference Management (IM) resources (their IDs) and set-specific parameters.\nCSI-IM-ResourceSet information element\n-- ASN1START\n-- TAG-CSI-IM-RESOURCESET-START\n\nCSI-IM-ResourceSet ::=              SEQUENCE {\n    csi-IM-ResourceSetId                CSI-IM-ResourceSetId,\n    csi-IM-Resources                    SEQUENCE (SIZE(1..maxNrofCSI-IM-ResourcesPerSet)) OF CSI-IM-ResourceId,\n    ...\n}\n-- TAG-CSI-IM-RESOURCESET-STOP\n-- ASN1STOP\n\nCSI-IM-ResourceSet field descriptions\ncsi-IM-Resources\tCSI-IM-Resources associated with this CSI-IM-ResourceSet (see TS 38.214 [19], clause 5.2).\n\n\u2013\tCSI-IM-ResourceSetId\nThe IE CSI-IM-ResourceSetId is used to identify CSI-IM-ResourceSets.\nCSI-IM-ResourceSetId information element\n-- ASN1START\n-- TAG-CSI-IM-RESOURCESETID-START\n\nCSI-IM-ResourceSetId ::=            INTEGER (0..maxNrofCSI-IM-ResourceSets-1)\n\n-- TAG-CSI-IM-RESOURCESETID-STOP\n-- ASN1STOP\n\n\u2013\tCSI-MeasConfig\nThe IE CSI-MeasConfig is used to configure CSI-RS (reference signals) belonging to the serving cell in which CSI-MeasConfig is included, channel state information reports to be transmitted on PUCCH on the serving cell in which CSI-MeasConfig is included and channel state information reports on PUSCH triggered by DCI received on the serving cell in which CSI-MeasConfig is included. See also TS 38.214 [19], clause 5.2.\nCSI-MeasConfig information element\n-- ASN1START\n-- TAG-CSI-MEASCONFIG-START\n\nCSI-MeasConfig ::=                  SEQUENCE {\n    nzp-CSI-RS-ResourceToAddModList     SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-Resources)) OF NZP-CSI-RS-Resource   OPTIONAL, -- Need N\n    nzp-CSI-RS-ResourceToReleaseList    SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-Resources)) OF NZP-CSI-RS-ResourceId OPTIONAL, -- Need N\n    nzp-CSI-RS-ResourceSetToAddModList  SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourceSets)) OF NZP-CSI-RS-ResourceSet\n                                                                                                                  OPTIONAL, -- Need N\n    nzp-CSI-RS-ResourceSetToReleaseList SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourceSets)) OF NZP-CSI-RS-ResourceSetId\n                                                                                                                  OPTIONAL, -- Need N\n    csi-IM-ResourceToAddModList         SEQUENCE (SIZE (1..maxNrofCSI-IM-Resources)) OF CSI-IM-Resource           OPTIONAL, -- Need N\n    csi-IM-ResourceToReleaseList        SEQUENCE (SIZE (1..maxNrofCSI-IM-Resources)) OF CSI-IM-ResourceId         OPTIONAL, -- Need N\n    csi-IM-ResourceSetToAddModList      SEQUENCE (SIZE (1..maxNrofCSI-IM-ResourceSets)) OF CSI-IM-ResourceSet     OPTIONAL, -- Need N\n    csi-IM-ResourceSetToReleaseList     SEQUENCE (SIZE (1..maxNrofCSI-IM-ResourceSets)) OF CSI-IM-ResourceSetId   OPTIONAL, -- Need N\n    csi-SSB-ResourceSetToAddModList     SEQUENCE (SIZE (1..maxNrofCSI-SSB-ResourceSets)) OF CSI-SSB-ResourceSet   OPTIONAL, -- Need N\n    csi-SSB-ResourceSetToAddReleaseList SEQUENCE (SIZE (1..maxNrofCSI-SSB-ResourceSets)) OF CSI-SSB-ResourceSetId OPTIONAL, -- Need N\n    csi-ResourceConfigToAddModList      SEQUENCE (SIZE (1..maxNrofCSI-ResourceConfigurations)) OF CSI-ResourceConfig\n                                                                                                                  OPTIONAL, -- Need N\n    csi-ResourceConfigToReleaseList     SEQUENCE (SIZE (1..maxNrofCSI-ResourceConfigurations)) OF CSI-ResourceConfigId\n                                                                                                                  OPTIONAL, -- Need N\n    csi-ReportConfigToAddModList        SEQUENCE (SIZE (1..maxNrofCSI-ReportConfigurations)) OF CSI-ReportConfig  OPTIONAL, -- Need N\n    csi-ReportConfigToReleaseList       SEQUENCE (SIZE (1..maxNrofCSI-ReportConfigurations)) OF CSI-ReportConfigId\n                                                                                                                  OPTIONAL, -- Need N\n    reportTriggerSize                   INTEGER (0..6)                                                            OPTIONAL, -- Need M\n    aperiodicTriggerStateList           SetupRelease { CSI-AperiodicTriggerStateList }                            OPTIONAL, -- Need M\n    semiPersistentOnPUSCH-TriggerStateList    SetupRelease { CSI-SemiPersistentOnPUSCH-TriggerStateList }         OPTIONAL, -- Need M\n    ...\n}\n\n-- TAG-CSI-MEASCONFIG-STOP\n-- ASN1STOP\n\nCSI-MeasConfig field descriptions\naperiodicTriggerStateList\tContains trigger states for dynamically selecting one or more aperiodic and semi-persistent reporting configurations and/or triggering one or more aperiodic CSI-RS resource sets for channel and/or interference measurement.\ncsi-IM-ResourceSetToAddModList\tPool of CSI-IM-ResourceSet which can be referred to from CSI-ResourceConfig or from MAC CEs.\ncsi-IM-ResourceToAddModList\tPool of CSI-IM-Resource which can be referred to from CSI-IM-ResourceSet.\ncsi-ReportConfigToAddModList\tConfigured CSI report settings as specified in TS 38.214 [19] clause 5.2.1.1.\ncsi-ResourceConfigToAddModList\tConfigured CSI resource settings as specified in TS 38.214 [19] clause 5.2.1.2.\ncsi-SSB-ResourceSetToAddModList\tPool of CSI-SSB-ResourceSet which can be referred to from CSI-ResourceConfig.\nnzp-CSI-RS-ResourceSetToAddModList\tPool of NZP-CSI-RS-ResourceSet which can be referred to from CSI-ResourceConfig or from MAC CEs.\nnzp-CSI-RS-ResourceToAddModList\tPool of NZP-CSI-RS-Resource which can be referred to from NZP-CSI-RS-ResourceSet.\nreportTriggerSize\tSize of CSI request field in DCI (bits) (see TS 38.214 [19], clause 5.2.1.5.1).\n\n\u2013\tCSI-ReportConfig\nThe IE CSI-ReportConfig is used to configure a periodic or semi-persistent report sent on PUCCH on the cell in which the CSI-ReportConfig is included, or to configure a semi-persistent or aperiodic report sent on PUSCH triggered by DCI received on the cell in which the CSI-ReportConfig is included (in this case, the cell on which the report is sent is determined by the received DCI). See TS 38.214 [19], clause 5.2.1.\nCSI-ReportConfig information element\n-- ASN1START\n-- TAG-CSI-REPORTCONFIG-START\n\nCSI-ReportConfig ::=                SEQUENCE {\n    reportConfigId                          CSI-ReportConfigId,\n    carrier                                 ServCellIndex                   OPTIONAL,   -- Need S\n    resourcesForChannelMeasurement          CSI-ResourceConfigId,\n    csi-IM-ResourcesForInterference         CSI-ResourceConfigId            OPTIONAL,   -- Need R\n    nzp-CSI-RS-ResourcesForInterference     CSI-ResourceConfigId            OPTIONAL,   -- Need R\n    reportConfigType                        CHOICE {\n        periodic                                SEQUENCE {\n            reportSlotConfig                        CSI-ReportPeriodicityAndOffset,\n            pucch-CSI-ResourceList                  SEQUENCE (SIZE (1..maxNrofBWPs)) OF PUCCH-CSI-Resource\n        },\n        semiPersistentOnPUCCH                   SEQUENCE {\n            reportSlotConfig                        CSI-ReportPeriodicityAndOffset,\n            pucch-CSI-ResourceList                  SEQUENCE (SIZE (1..maxNrofBWPs)) OF PUCCH-CSI-Resource\n        },\n        semiPersistentOnPUSCH                   SEQUENCE {\n            reportSlotConfig                        ENUMERATED {sl5, sl10, sl20, sl40, sl80, sl160, sl320},\n            reportSlotOffsetList                SEQUENCE (SIZE (1.. maxNrofUL-Allocations)) OF INTEGER(0..32),\n            p0alpha                                 P0-PUSCH-AlphaSetId\n        },\n        aperiodic                               SEQUENCE {\n            reportSlotOffsetList                SEQUENCE (SIZE (1..maxNrofUL-Allocations)) OF INTEGER(0..32)\n        }\n    },\n    reportQuantity                          CHOICE {\n        none                                    NULL,\n        cri-RI-PMI-CQI                          NULL,\n        cri-RI-i1                               NULL,\n        cri-RI-i1-CQI                           SEQUENCE {\n            pdsch-BundleSizeForCSI                  ENUMERATED {n2, n4}                                         OPTIONAL    -- Need S\n        },\n        cri-RI-CQI                              NULL,\n        cri-RSRP                                NULL,\n        ssb-Index-RSRP                          NULL,\n        cri-RI-LI-PMI-CQI                       NULL\n    },\n    reportFreqConfiguration                 SEQUENCE {\n        cqi-FormatIndicator                     ENUMERATED { widebandCQI, subbandCQI }                          OPTIONAL,   -- Need R\n        pmi-FormatIndicator                     ENUMERATED { widebandPMI, subbandPMI }                          OPTIONAL,   -- Need R\n        csi-ReportingBand                       CHOICE {\n            subbands3                               BIT STRING(SIZE(3)),\n            subbands4                               BIT STRING(SIZE(4)),\n            subbands5                               BIT STRING(SIZE(5)),\n            subbands6                               BIT STRING(SIZE(6)),\n            subbands7                               BIT STRING(SIZE(7)),\n            subbands8                               BIT STRING(SIZE(8)),\n            subbands9                               BIT STRING(SIZE(9)),\n            subbands10                              BIT STRING(SIZE(10)),\n            subbands11                              BIT STRING(SIZE(11)),\n            subbands12                              BIT STRING(SIZE(12)),\n            subbands13                              BIT STRING(SIZE(13)),\n            subbands14                              BIT STRING(SIZE(14)),\n            subbands15                              BIT STRING(SIZE(15)),\n            subbands16                              BIT STRING(SIZE(16)),\n            subbands17                              BIT STRING(SIZE(17)),\n            subbands18                              BIT STRING(SIZE(18)),\n            ...,\n            subbands19-v1530                        BIT STRING(SIZE(19))\n        }   OPTIONAL    -- Need S\n\n    }                                                                                                           OPTIONAL,   -- Need R\n    timeRestrictionForChannelMeasurements           ENUMERATED {configured, notConfigured},\n    timeRestrictionForInterferenceMeasurements      ENUMERATED {configured, notConfigured},\n    codebookConfig                                  CodebookConfig                                              OPTIONAL,   -- Need R\n    dummy                                           ENUMERATED {n1, n2}                                         OPTIONAL,   -- Need R\n    groupBasedBeamReporting                     CHOICE {\n        enabled                                     NULL,\n        disabled                                    SEQUENCE {\n            nrofReportedRS                          ENUMERATED {n1, n2, n3, n4}                                 OPTIONAL    -- Need S\n        }\n    },\n    cqi-Table                   ENUMERATED {table1, table2, table3, spare1}                                     OPTIONAL,   -- Need R\n    subbandSize                 ENUMERATED {value1, value2},\n    non-PMI-PortIndication      SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourcesPerConfig)) OF PortIndexFor8Ranks OPTIONAL,   -- Need R\n    ...,\n    [[\n    semiPersistentOnPUSCH-v1530         SEQUENCE {\n        reportSlotConfig-v1530              ENUMERATED {sl4, sl8, sl16}\n    }                                                                                                           OPTIONAL    -- Need R\n    ]]\n}\n\nCSI-ReportPeriodicityAndOffset ::=  CHOICE {\n    slots4                              INTEGER(0..3),\n    slots5                              INTEGER(0..4),\n    slots8                              INTEGER(0..7),\n    slots10                             INTEGER(0..9),\n    slots16                             INTEGER(0..15),\n    slots20                             INTEGER(0..19),\n    slots40                             INTEGER(0..39),\n    slots80                             INTEGER(0..79),\n    slots160                            INTEGER(0..159),\n    slots320                            INTEGER(0..319)\n}\n\nPUCCH-CSI-Resource ::=              SEQUENCE {\n    uplinkBandwidthPartId               BWP-Id,\n    pucch-Resource                      PUCCH-ResourceId\n}\n\nPortIndexFor8Ranks ::=              CHOICE {\n    portIndex8                          SEQUENCE{\n        rank1-8                             PortIndex8                                                      OPTIONAL,   -- Need R\n        rank2-8                             SEQUENCE(SIZE(2)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank3-8                             SEQUENCE(SIZE(3)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank4-8                             SEQUENCE(SIZE(4)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank5-8                             SEQUENCE(SIZE(5)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank6-8                             SEQUENCE(SIZE(6)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank7-8                             SEQUENCE(SIZE(7)) OF PortIndex8                                 OPTIONAL,   -- Need R\n        rank8-8                             SEQUENCE(SIZE(8)) OF PortIndex8                                 OPTIONAL    -- Need R\n    },\n    portIndex4                          SEQUENCE{\n        rank1-4                             PortIndex4                                                      OPTIONAL,   -- Need R\n        rank2-4                             SEQUENCE(SIZE(2)) OF PortIndex4                                 OPTIONAL,   -- Need R\n        rank3-4                             SEQUENCE(SIZE(3)) OF PortIndex4                                 OPTIONAL,   -- Need R\n        rank4-4                             SEQUENCE(SIZE(4)) OF PortIndex4                                 OPTIONAL    -- Need R\n    },\n    portIndex2                          SEQUENCE{\n        rank1-2                             PortIndex2                                                      OPTIONAL,   -- Need R\n        rank2-2                             SEQUENCE(SIZE(2)) OF PortIndex2                                 OPTIONAL    -- Need R\n    },\n    portIndex1                          NULL\n}\n\nPortIndex8::=                       INTEGER (0..7)\nPortIndex4::=                       INTEGER (0..3)\nPortIndex2::=                       INTEGER (0..1)\n\n-- TAG-CSI-REPORTCONFIG-STOP\n-- ASN1STOP\n\nCSI-ReportConfig field descriptions\ncarrier\tIndicates in which serving cell the CSI-ResourceConfig indicated below are to be found. If the field is absent, the resources are on the same serving cell as this report configuration.\ncodebookConfig\tCodebook configuration for Type-1 or Type-2 including codebook subset restriction.\ncqi-FormatIndicator\tIndicates whether the UE shall report a single (wideband) or multiple (subband) CQI. (see TS 38.214 [19], clause 5.2.1.4).\ncqi-Table\tWhich CQI table to use for CQI calculation (see TS 38.214 [19], clause 5.2.2.1).\ncsi-IM-ResourcesForInterference\tCSI IM resources for interference measurement. csi-ResourceConfigId of a CSI-ResourceConfig included in the configuration of the serving cell indicated with the field \"carrier\" above. The CSI-ResourceConfig indicated here contains only CSI-IM resources. The bwp-Id in that CSI-ResourceConfig is the same value as the bwp-Id in the CSI-ResourceConfig indicated by resourcesForChannelMeasurement.\ncsi-ReportingBand\tIndicates a contiguous or non-contiguous subset of subbands in the bandwidth part which CSI shall be reported for. Each bit in the bit-string represents one subband. The right-most bit in the bit string represents the lowest subband in the BWP. The choice determines the number of subbands (subbands3 for 3 subbands, subbands4 for 4 subbands, and so on) (see TS 38.214 [19], clause 5.2.1.4). This field is absent if there are less than 24 PRBs (no sub band) and present otherwise, the number of sub bands can be from 3 (24 PRBs, sub band size 8) to 18 (72 PRBs, sub band size 4).\ndummy\tThis field is not used in the specification. If received it shall be ignored by the UE.\ngroupBasedBeamReporting\tTurning on/off group beam based reporting (see TS 38.214 [19], clause 5.2.1.4).\nnon-PMI-PortIndication\tPort indication for RI/CQI calculation. For each CSI-RS resource in the linked ResourceConfig for channel measurement, a port indication for each rank R, indicating which R ports to use. Applicable only for non-PMI feedback (see TS 38.214 [19], clause 5.2.1.4.2).\tThe first entry in non-PMI-PortIndication corresponds to the NZP-CSI-RS-Resource indicated by the first entry in nzp-CSI-RS-Resources in the NZP-CSI-RS-ResourceSet indicated in the first entry of nzp-CSI-RS-ResourceSetList of the CSI-ResourceConfig whose CSI-ResourceConfigId is indicated in a CSI-MeasId together with the above CSI-ReportConfigId; the second entry in non-PMI-PortIndication corresponds to the NZP-CSI-RS-Resource indicated by the second entry in nzp-CSI-RS-Resources in the NZP-CSI-RS-ResourceSet indicated in the first entry of nzp-CSI-RS-ResourceSetList of the same CSI-ResourceConfig, and so on until the NZP-CSI-RS-Resource indicated by the last entry in nzp-CSI-RS-Resources in the in the NZP-CSI-RS-ResourceSet indicated in the first entry of nzp-CSI-RS-ResourceSetList of the same CSI-ResourceConfig. Then the next entry corresponds to the NZP-CSI-RS-Resource indicated by the first entry in nzp-CSI-RS-Resources in the NZP-CSI-RS-ResourceSet indicated in the second entry of nzp-CSI-RS-ResourceSetList of the same CSI-ResourceConfig and so on.\nnrofReportedRS\tThe number (N) of measured RS resources to be reported per report setting in a non-group-based report. N <= N_max, where N_max is either 2 or 4 depending on UE capability.\t(see TS 38.214 [19], clause 5.2.1.4) When the field is absent the UE applies the value 1.\nnzp-CSI-RS-ResourcesForInterference\tNZP CSI RS resources for interference measurement. csi-ResourceConfigId of a CSI-ResourceConfig included in the configuration of the serving cell indicated with the field \"carrier\" above. The CSI-ResourceConfig indicated here contains only NZP-CSI-RS resources. The bwp-Id in that CSI-ResourceConfig is the same value as the bwp-Id in the CSI-ResourceConfig indicated by resourcesForChannelMeasurement.\np0alpha\tIndex of the p0-alpha set determining the power control for this CSI report transmission (see TS 38.214 [19], clause 6.2.1.2).\npdsch-BundleSizeForCSI\tPRB bundling size to assume for CQI calculation when reportQuantity is CRI/RI/i1/CQI. If the field is absent, the UE assumes that no PRB bundling is applied (see TS 38.214 [19], clause 5.2.1.4.2).\npmi-FormatIndicator\tIndicates whether the UE shall report a single (wideband) or multiple (subband) PMI. (see TS 38.214 [19], clause 5.2.1.4).\npucch-CSI-ResourceList\tIndicates which PUCCH resource to use for reporting on PUCCH.\nreportConfigType\tTime domain behavior of reporting configuration.\nreportFreqConfiguration\tReporting configuration in the frequency domain. (see TS 38.214 [19], clause 5.2.1.4).\nreportQuantity\tThe CSI related quantities to report. see TS 38.214 [19], clause 5.2.1.\nreportSlotConfig\tPeriodicity and slot offset (see TS 38.214 [19], clause 5.2.1.4). If the field reportSlotConfig-v1530 is present, the UE shall ignore the value provided in reportSlotConfig (without suffix).\nreportSlotOffsetList\tTiming offset Y for semi persistent reporting using PUSCH. This field lists the allowed offset values. This list must have the same number of entries as the pusch-TimeDomainAllocationList in PUSCH-Config. A particular value is indicated in DCI. The network indicates in the DCI field of the UL grant, which of the configured report slot offsets the UE shall apply. The DCI value 0 corresponds to the first report slot offset in this list, the DCI value 1 corresponds to the second report slot offset in this list, and so on. The first report is transmitted in slot n+Y, second report in n+Y+P, where P is the configured periodicity.\tTiming offset Y for aperiodic reporting using PUSCH. This field lists the allowed offset values. This list must have the same number of entries as the pusch-TimeDomainAllocationList in PUSCH-Config. A particular value is indicated in DCI. The network indicates in the DCI field of the UL grant, which of the configured report slot offsets the UE shall apply. The DCI value 0 corresponds to the first report slot offset in this list, the DCI value 1 corresponds to the second report slot offset in this list, and so on (see TS 38.214 [19], clause 5.2.3). \nresourcesForChannelMeasurement\tResources for channel measurement. csi-ResourceConfigId of a CSI-ResourceConfig included in the configuration of the serving cell indicated with the field \"carrier\" above. The CSI-ResourceConfig indicated here contains only NZP-CSI-RS resources and/or SSB resources. This CSI-ReportConfig is associated with the DL BWP indicated by bwp-Id in that CSI-ResourceConfig.\nsubbandSize\tIndicates one out of two possible BWP-dependent values for the subband size as indicated in TS 38.214 [19], table 5.2.1.4-2 . If csi-ReportingBand is absent, the UE shall ignore this field.\ntimeRestrictionForChannelMeasurements\tTime domain measurement restriction for the channel (signal) measurements (see TS 38.214 [19], clause 5.2.1.1).\ntimeRestrictionForInterferenceMeasurements\tTime domain measurement restriction for interference measurements (see TS 38.214 [19], clause 5.2.1.1).\n\nPortIndexFor8Ranks field descriptions\nportIndex8\tPort-Index configuration for up to rank 8. If present, the network configures port indexes for at least one of the ranks.\nportIndex4\tPort-Index configuration for up to rank 4. If present, the network configures port indexes for at least one of the ranks.\nportIndex2\tPort-Index configuration for up to rank 2. If present, the network configures port indexes for at least one of the ranks.\nportIndex1\tPort-Index configuration for rank 1.\n\nPUCCH-CSI-Resource field descriptions\npucch-Resource\tPUCCH resource for the associated uplink BWP. Only PUCCH-Resource of format 2, 3 and 4 is supported. The actual PUCCH-Resource is configured in PUCCH-Config and referred to by its ID.\n\n\u2013\tCSI-ReportConfigId\nThe IE CSI-ReportConfigId is used to identify one CSI-ReportConfig.\nCSI-ReportConfigId information element\n-- ASN1START\n-- TAG-CSI-REPORTCONFIGID-START\n\nCSI-ReportConfigId ::=              INTEGER (0..maxNrofCSI-ReportConfigurations-1)\n\n-- TAG-CSI-REPORTCONFIGID-STOP\n-- ASN1STOP\n\n\u2013\tCSI-ResourceConfig\nThe IE CSI-ResourceConfig defines a group of one or more NZP-CSI-RS-ResourceSet, CSI-IM-ResourceSet and/or CSI-SSB-ResourceSet.\nCSI-ResourceConfig information element\n-- ASN1START\n-- TAG-CSI-RESOURCECONFIG-START\n\nCSI-ResourceConfig ::=      SEQUENCE {\n    csi-ResourceConfigId        CSI-ResourceConfigId,\n    csi-RS-ResourceSetList      CHOICE {\n        nzp-CSI-RS-SSB              SEQUENCE {\n            nzp-CSI-RS-ResourceSetList  SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourceSetsPerConfig)) OF NZP-CSI-RS-ResourceSetId\n                                                                                                                 OPTIONAL, -- Need R\n            csi-SSB-ResourceSetList     SEQUENCE (SIZE (1..maxNrofCSI-SSB-ResourceSetsPerConfig)) OF CSI-SSB-ResourceSetId\n                                                                                                                 OPTIONAL  -- Need R\n        },\n        csi-IM-ResourceSetList      SEQUENCE (SIZE (1..maxNrofCSI-IM-ResourceSetsPerConfig)) OF CSI-IM-ResourceSetId\n    },\n\n    bwp-Id                      BWP-Id,\n    resourceType                ENUMERATED { aperiodic, semiPersistent, periodic },\n    ...\n}\n\n-- TAG-CSI-RESOURCECONFIG-STOP\n-- ASN1STOP\n\nCSI-ResourceConfig field descriptions\nbwp-Id\tThe DL BWP which the CSI-RS associated with this CSI-ResourceConfig are located in (see TS 38.214 [19], clause 5.2.1.2.\ncsi-ResourceConfigId\tUsed in CSI-ReportConfig to refer to an instance of CSI-ResourceConfig.\ncsi-RS-ResourceSetList\tContains up to maxNrofNZP-CSI-RS-ResourceSetsPerConfig resource sets if resourceType is 'aperiodic' and 1 otherwise (see TS 38.214 [19], clause 5.2.1.2).\ncsi-SSB-ResourceSetList\tList of SSB resources used for beam measurement and reporting in a resource set (see TS 38.214 [19], section 5.2.1.2).\nresourceType\tTime domain behavior of resource configuration (see TS 38.214 [19], clause 5.2.1.2). It does not apply to resources provided in the csi-SSB-ResourceSetList.\n\n\u2013\tCSI-ResourceConfigId\nThe IE CSI-ResourceConfigId is used to identify a CSI-ResourceConfig.\nCSI-ResourceConfigId information element\n-- ASN1START\n-- TAG-CSI-RESOURCECONFIGID-START\n\nCSI-ResourceConfigId ::=            INTEGER (0..maxNrofCSI-ResourceConfigurations-1)\n\n-- TAG-CSI-RESOURCECONFIGID-STOP\n-- ASN1STOP\n\n\u2013\tCSI-ResourcePeriodicityAndOffset\nThe IE CSI-ResourcePeriodicityAndOffset is used to configure a periodicity and a corresponding offset for periodic and semi-persistent CSI resources, and for periodic and semi-persistent reporting on PUCCH. both, the periodicity and the offset are given in number of slots. The periodicity value slots4 corresponds to 4 slots, value slots5 corresponds to 5 slots, and so on.\nCSI-ResourcePeriodicityAndOffset information element\n-- ASN1START\n-- TAG-CSI-RESOURCEPERIODICITYANDOFFSET-START\n\nCSI-ResourcePeriodicityAndOffset ::=    CHOICE {\n    slots4                              INTEGER (0..3),\n    slots5                              INTEGER (0..4),\n    slots8                              INTEGER (0..7),\n    slots10                             INTEGER (0..9),\n    slots16                             INTEGER (0..15),\n    slots20                             INTEGER (0..19),\n    slots32                             INTEGER (0..31),\n    slots40                             INTEGER (0..39),\n    slots64                             INTEGER (0..63),\n    slots80                             INTEGER (0..79),\n    slots160                            INTEGER (0..159),\n    slots320                            INTEGER (0..319),\n    slots640                            INTEGER (0..639)\n}\n\n-- TAG-CSI-RESOURCEPERIODICITYANDOFFSET-STOP\n-- ASN1STOP\n\n\u2013\tCSI-RS-ResourceConfigMobility\nThe IE CSI-RS-ResourceConfigMobility is used to configure CSI-RS based RRM measurements.\nCSI-RS-ResourceConfigMobility information element\n-- ASN1START\n-- TAG-CSI-RS-RESOURCECONFIGMOBILITY-START\n\nCSI-RS-ResourceConfigMobility ::=   SEQUENCE {\n    subcarrierSpacing                   SubcarrierSpacing,\n    csi-RS-CellList-Mobility            SEQUENCE (SIZE (1..maxNrofCSI-RS-CellsRRM)) OF CSI-RS-CellMobility,\n    ... ,\n    [[\n    refServCellIndex-v1530              ServCellIndex                                                           OPTIONAL    -- Need S\n    ]]\n\n\n}\n\nCSI-RS-CellMobility ::=             SEQUENCE {\n    cellId                              PhysCellId,\n    csi-rs-MeasurementBW                SEQUENCE {\n        nrofPRBs                            ENUMERATED { size24, size48, size96, size192, size264},\n        startPRB                            INTEGER(0..2169)\n    },\n    density                             ENUMERATED {d1,d3}                                                      OPTIONAL,   -- Need R\n    csi-rs-ResourceList-Mobility        SEQUENCE (SIZE (1..maxNrofCSI-RS-ResourcesRRM)) OF CSI-RS-Resource-Mobility\n}\n\nCSI-RS-Resource-Mobility ::=        SEQUENCE {\n    csi-RS-Index                        CSI-RS-Index,\n    slotConfig                          CHOICE {\n        ms4                                 INTEGER (0..31),\n        ms5                                 INTEGER (0..39),\n        ms10                                INTEGER (0..79),\n        ms20                                INTEGER (0..159),\n        ms40                                INTEGER (0..319)\n    },\n    associatedSSB                       SEQUENCE {\n        ssb-Index                           SSB-Index,\n        isQuasiColocated                    BOOLEAN\n    }                                                                                                           OPTIONAL, -- Need R\n    frequencyDomainAllocation           CHOICE {\n        row1                                BIT STRING (SIZE (4)),\n        row2                                BIT STRING (SIZE (12))\n    },\n    firstOFDMSymbolInTimeDomain         INTEGER (0..13),\n    sequenceGenerationConfig            INTEGER (0..1023),\n    ...\n}\n\nCSI-RS-Index ::=                    INTEGER (0..maxNrofCSI-RS-ResourcesRRM-1)\n\n-- TAG-CSI-RS-RESOURCECONFIGMOBILITY-STOP\n-- ASN1STOP\n\nCSI-RS-CellMobility field descriptions\ncsi-rs-ResourceList-Mobility\tList of CSI-RS resources for mobility. The maximum number of CSI-RS resources that can be configured per frequency layer depends on the configuration of associatedSSB (see TS 38.214 [19], clause 5.1.6.1.3).\ndensity\tFrequency domain density for the 1-port CSI-RS for L3 mobility. See TS 38.211 [16], clause 7.4.1.\nnrofPRBs\tAllowed size of the measurement BW in PRBs. See TS 38.211 [16], clause 7.4.1.\nstartPRB\tStarting PRB index of the measurement bandwidth. See TS 38.211 [16], clause 7.4.1.\n\nCSI-RS-ResourceConfigMobility field descriptions\ncsi-RS-CellList-Mobility\tList of cells for CSI-RS based RRM measurements.\nrefServCellIndex\tIndicates the serving cell providing the timing reference for CSI-RS resources without associatedSSB. The field may be present only if there is at least one CSI-RS resource configured without associatedSSB. In case there is at least one CSI-RS resource configured without associatedSSB and this field is absent, the UE shall use the timing of the PCell. The CSI-RS resources and the serving cell indicated by refServCellIndex for timing reference should be located in the same band.\nsubcarrierSpacing\tSubcarrier spacing of CSI-RS. Only the values 15, 30 kHz or 60 kHz (<6GHz), 60 or 120 kHz (>6GHz) are applicable.\n\nCSI-RS-Resource-Mobility field descriptions\nassociatedSSB\tIf this field is present, the UE may base the timing of the CSI-RS resource indicated in CSI-RS-Resource-Mobility on the timing of the cell indicated by the cellId in the CSI-RS-CellMobility. In this case, the UE is not required to monitor that CSI-RS resource if the UE cannot detect the SS/PBCH block indicated by this associatedSSB and cellId. If this field is absent, the UE shall base the timing of the CSI-RS resource indicated in CSI-RS-Resource-Mobility on the timing of the serving cell indicated by refServCellIndex. In this case, the UE is required to measure the CSI-RS resource even if SS/PBCH block(s) with cellId in the CSI-RS-CellMobility are not detected.\tCSI-RS resources with and without associatedSSB may be configured in accordance with the rules in TS 38.214 [19], clause 5.1.6.1.3.\ncsi-RS-Index\tCSI-RS resource index associated to the CSI-RS resource to be measured (and used for reporting).\nfirstOFDMSymbolInTimeDomain\tTime domain allocation within a physical resource block. The field indicates the first OFDM symbol in the PRB used for CSI-RS, see TS 38.211 [16], clause 7.4.1.5.3. Value 2 is supported only when DL-DMRS-typeA-pos equals 3.\nfrequencyDomainAllocation\tFrequency domain allocation within a physical resource block in accordance with TS 38.211 [16], clause 7.4.1.5.3 including table 7.4.1.5.2-1. The number of bits that may be set to one depend on the chosen row in that table.\nisQuasiColocated\tIndicates that the CSI-RS resource is quasi co-located with the associated SS/PBCH block, see TS 38.214 [19], clause 5.1.6.1.3.\nsequenceGenerationConfig\tScrambling ID for CSI-RS (see TS 38.211 [16], clause 7.4.1.5.2).\nslotConfig\tIndicates the CSI-RS periodicity (in milliseconds) and for each periodicity the offset (in number of slots). When subcarrierSpacingCSI-RS is set to kHz15, the maximum offset values for periodicities ms4/ms5/ms10/ms20/ms40 are 3/4/9/19/39 slots. When subcarrierSpacingCSI-RS is set to kHz30, the maximum offset values for periodicities ms4/ms5/ms10/ms20/ms40 are 7/9/19/39/79 slots. When subcarrierSpacingCSI-RS is set to kHz60, the maximum offset values for periodicities ms4/ms5/ms10/ms20/ms40 are 15/19/39/79/159 slots. When subcarrierSpacingCSI-RS is set kHz120, the maximum offset values for periodicities ms4/ms5/ms10/ms20/ms40 are 31/39/79/159/319 slots.\n\n\u2013\tCSI-RS-ResourceMapping\nThe IE CSI-RS-ResourceMapping is used to configure the resource element mapping of a CSI-RS resource in time- and frequency domain.\nCSI-RS-ResourceMapping information element\n-- ASN1START\n-- TAG-CSI-RS-RESOURCEMAPPING-START\n\nCSI-RS-ResourceMapping ::=          SEQUENCE {\n    frequencyDomainAllocation           CHOICE {\n        row1                                BIT STRING (SIZE (4)),\n        row2                                BIT STRING (SIZE (12)),\n        row4                                BIT STRING (SIZE (3)),\n        other                               BIT STRING (SIZE (6))\n    },\n    nrofPorts                           ENUMERATED {p1,p2,p4,p8,p12,p16,p24,p32},\n    firstOFDMSymbolInTimeDomain         INTEGER (0..13),\n    firstOFDMSymbolInTimeDomain2        INTEGER (2..12)                                                         OPTIONAL,   -- Need R\n    cdm-Type                            ENUMERATED {noCDM, fd-CDM2, cdm4-FD2-TD2, cdm8-FD2-TD4},\n    density                             CHOICE {\n        dot5                                ENUMERATED {evenPRBs, oddPRBs},\n        one                                 NULL,\n        three                               NULL,\n        spare                               NULL\n    },\n    freqBand                            CSI-FrequencyOccupation,\n    ...\n}\n\n-- TAG-CSI-RS-RESOURCEMAPPING-STOP\n-- ASN1STOP\n\nCSI-RS-ResourceMapping field descriptions\ncdm-Type\tCDM type (see TS 38.214 [19], clause 5.2.2.3.1).\ndensity\tDensity of CSI-RS resource measured in RE/port/PRB (see TS 38.211 [16], clause 7.4.1.5.3).\tValues 0.5 (dot5), 1 (one) and 3 (three) are allowed for X=1, values 0.5 (dot5) and 1 (one) are allowed for X=2, 16, 24 and 32, value 1 (one) is allowed for X=4, 8, 12.\tFor density = 1/2, includes 1-bit indication for RB level comb offset indicating whether odd or even RBs are occupied by CSI-RS.\nfirstOFDMSymbolInTimeDomain2\tTime domain allocation within a physical resource block. See TS 38.211 [16], clause 7.4.1.5.3.\nfirstOFDMSymbolInTimeDomain\tTime domain allocation within a physical resource block. The field indicates the first OFDM symbol in the PRB used for CSI-RS. See TS 38.211 [16], clause 7.4.1.5.3. Value 2 is supported only when DL-DMRS-typeA-pos equals 3.\nfreqBand\tWideband or partial band CSI-RS, (see TS 38.214 [19], clause 5.2.2.3.1).\nfrequencyDomainAllocation\tFrequency domain allocation within a physical resource block in accordance with TS 38.211 [16], clause 7.4.1.5.3. The applicable row number in table 7.4.1.5.3-1 is determined by the frequencyDomainAllocation for rows 1, 2 and 4, and for other rows by matching the values in the column Ports, Density and CDMtype in table 7.4.1.5.3-1 with the values of nrofPorts, cdm-Type and density below and, when more than one row has the 3 values matching, by selecting the row where the column (k bar, l bar) in table 7.4.1.5.3-1 has indexes for k ranging from 0 to 2*n-1 where n is the number of bits set to 1 in frequencyDomainAllocation.\nnrofPorts\tNumber of ports (see TS 38.214 [19], clause 5.2.2.3.1).\n\n\u2013\tCSI-SemiPersistentOnPUSCH-TriggerStateList\nThe CSI-SemiPersistentOnPUSCH-TriggerStateList IE is used to configure the UE with list of trigger states for semi-persistent reporting of channel state information on L1. See also TS 38.214 [19], clause 5.2.\nCSI-SemiPersistentOnPUSCH-TriggerStateList information element\n-- ASN1START\n-- TAG-CSI-SEMIPERSISTENTONPUSCHTRIGGERSTATELIST-START\n\nCSI-SemiPersistentOnPUSCH-TriggerStateList ::=\n                                 SEQUENCE(SIZE (1..maxNrOfSemiPersistentPUSCH-Triggers)) OF CSI-SemiPersistentOnPUSCH-TriggerState\n\nCSI-SemiPersistentOnPUSCH-TriggerState ::=      SEQUENCE {\n    associatedReportConfigInfo                      CSI-ReportConfigId,\n    ...\n}\n\n-- TAG-CSI-SEMIPERSISTENTONPUSCHTRIGGERSTATELIST-STOP\n-- ASN1STOP\n\n\u2013\tCSI-SSB-ResourceSet\nThe IE CSI-SSB-ResourceSet is used to configure one SS/PBCH block resource set which refers to SS/PBCH as indicated in ServingCellConfigCommon.\nCSI-SSB-ResourceSet information element\n-- ASN1START\n-- TAG-CSI-SSB-RESOURCESET-START\n\nCSI-SSB-ResourceSet ::=             SEQUENCE {\n    csi-SSB-ResourceSetId               CSI-SSB-ResourceSetId,\n    csi-SSB-ResourceList                SEQUENCE (SIZE(1..maxNrofCSI-SSB-ResourcePerSet)) OF SSB-Index,\n    ...\n}\n\n-- TAG-CSI-SSB-RESOURCESET-STOP\n-- ASN1STOP\n\n\u2013\tCSI-SSB-ResourceSetId\nThe IE CSI-SSB-ResourceSetId is used to identify one SS/PBCH block resource set.\nCSI-SSB-ResourceId information element\n-- ASN1START\n-- TAG-CSI-SSB-RESOURCESETID-START\n\nCSI-SSB-ResourceSetId ::=           INTEGER (0..maxNrofCSI-SSB-ResourceSets-1)\n\n-- TAG-CSI-SSB-RESOURCESETID-STOP\n-- ASN1STOP\n\n\u2013\tDedicatedNAS-Message\nThe IE DedicatedNAS-Message is used to transfer UE specific NAS layer information between the 5GC CN and the UE. The RRC layer is transparent for this information.\nDedicatedNAS-Message information element\n-- ASN1START\n-- TAG-DEDICATED-NAS-MESSAGE-START\n\nDedicatedNAS-Message ::=        OCTET STRING\n\n-- TAG-DEDICATED-NAS-MESSAGE-STOP\n-- ASN1STOP\n\n\u2013\tDMRS-DownlinkConfig\nThe IE DMRS-DownlinkConfig is used to configure downlink demodulation reference signals for PDSCH.\nDMRS-DownlinkConfig information element\n-- ASN1START\n-- TAG-DMRS-DOWNLINKCONFIG-START\n\nDMRS-DownlinkConfig ::=             SEQUENCE {\n    dmrs-Type                           ENUMERATED {type2}                                                      OPTIONAL,   -- Need S\n    dmrs-AdditionalPosition             ENUMERATED {pos0, pos1, pos3}                                           OPTIONAL,   -- Need S\n    maxLength                           ENUMERATED {len2}                                                       OPTIONAL,   -- Need S\n    scramblingID0                       INTEGER (0..65535)                                                      OPTIONAL,   -- Need S\n    scramblingID1                       INTEGER (0..65535)                                                      OPTIONAL,   -- Need S\n    phaseTrackingRS                     SetupRelease { PTRS-DownlinkConfig  }                                   OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-DMRS-DOWNLINKCONFIG-STOP\n-- ASN1STOP\n\nDMRS-DownlinkConfig field descriptions\ndmrs-AdditionalPosition\tPosition for additional DM-RS in DL, see Tables 7.4.1.1.2-3 and 7.4.1.1.2-4 in TS 38.211 [16]. If the field is absent, the UE applies the value pos2. See also clause 7.4.1.1.2 for additional constraints on how the network may set this field depending on the setting of other fields.\ndmrs-Type\tSelection of the DMRS type to be used for DL (see TS 38.211 [16], clause 7.4.1.1.1). If the field is absent, the UE uses DMRS type 1.\nmaxLength\tThe maximum number of OFDM symbols for DL front loaded DMRS. len1 corresponds to value 1. len2 corresponds to value 2. If the field is absent, the UE applies value len1. If set to len2, the UE determines the actual number of DM-RS symbols by the associated DCI. (see TS 38.214 [19], clause 7.4.1.1.2).\nphaseTrackingRS\nscramblingID0\tDL DMRS scrambling initialization (see TS 38.211 [16], clause 7.4.1.1.1). When the field is absent the UE applies the value physCellId configured for this serving cell.\nscramblingID1\tDL DMRS scrambling initialization (see TS 38.211 [16], clause 7.4.1.1.1). When the field is absent the UE applies the value physCellId configured for this serving cell.\n\n\u2013\tDMRS-UplinkConfig\nThe IE DMRS-UplinkConfig is used to configure uplink demodulation reference signals for PUSCH.\nDMRS-UplinkConfig information element\n-- ASN1START\n-- TAG-DMRS-UPLINKCONFIG-START\n\nDMRS-UplinkConfig ::=               SEQUENCE {\n    dmrs-Type                           ENUMERATED {type2}                                                  OPTIONAL,   -- Need S\n    dmrs-AdditionalPosition             ENUMERATED {pos0, pos1, pos3}                                       OPTIONAL,   -- Need S\n    phaseTrackingRS                     SetupRelease { PTRS-UplinkConfig }                                  OPTIONAL,   -- Need M\n    maxLength                           ENUMERATED {len2}                                                   OPTIONAL,   -- Need S\n\n    transformPrecodingDisabled      SEQUENCE {\n        scramblingID0                   INTEGER (0..65535)                                                  OPTIONAL,   -- Need S\n        scramblingID1                   INTEGER (0..65535)                                                  OPTIONAL,   -- Need S\n        ...\n    }                                                                                                       OPTIONAL,   -- Need R\n    transformPrecodingEnabled       SEQUENCE {\n        nPUSCH-Identity                 INTEGER(0..1007)                                                    OPTIONAL,   -- Need S\n        sequenceGroupHopping            ENUMERATED {disabled}                                               OPTIONAL,   -- Need S\n        sequenceHopping                 ENUMERATED {enabled}                                                OPTIONAL,   -- Need S\n        ...\n    }                                                                                                       OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-DMRS-UPLINKCONFIG-STOP\n-- ASN1STOP\n\nDMRS-UplinkConfig field descriptions\ndmrs-AdditionalPosition\tPosition for additional DM-RS in UL (see TS 38.211 [16], clause 6.4.1.1.3). If the field is absent, the UE applies the value pos2. See also clause 6.4.1.1.3 for additional constraints on how the network may set this field depending on the setting of other fields.\ndmrs-Type\tSelection of the DMRS type to be used for UL (see TS 38.211 [16], clause 6.4.1.1.3) If the field is absent, the UE uses DMRS type 1.\nmaxLength\tThe maximum number of OFDM symbols for UL front loaded DMRS. len1 corresponds to value 1. len2 corresponds to value 2. If the field is absent, the UE applies value len1. If set to len2, the UE determines the actual number of DM-RS symbols by the associated DCI. (see TS 38.214 [19], clause 6.4.1.1.3).\nnPUSCH-Identity\tParameter: N_ID^(PUSCH) for DFT-s-OFDM DMRS. If the value is absent or released, the UE uses the value Physical cell ID (physCellId). See TS 38.211 [16].\nphaseTrackingRS\tConfigures uplink PTRS (see TS 38.211 [16]).\nscramblingID0\tUL DMRS scrambling initialization for CP-OFDM (see TS 38.211 [16], clause 6.4.1.1.1.1) When the field is absent the UE applies the value Physical cell ID (physCellId).\nscramblingID1\tUL DMRS scrambling initialization for CP-OFDM. (see TS 38.211 [16], clause 6.4.1.1.1.1) When the field is absent the UE applies the value Physical cell ID (physCellId).\nsequenceGroupHopping\tFor DMRS transmission with transform precoder the NW may configure group hopping by the cell-specific parameter groupHoppingEnabledTransformPrecoding in PUSCH-ConfigCommon. In this case, the NW may include this UE specific field to disable group hopping for PUSCH transmission except for Msg3, i.e., to override the configuration in PUSCH-ConfigCommon (see TS 38.211 [16]). If the field is absent, the UE uses the same hopping mode as for Msg3.\nsequenceHopping\tDetermines if sequence hopping is enabled for DMRS transmission with transform precoder for PUSCH transmission other than Msg3 (sequence hopping is always disabled for Msg3). If the field is absent, the UE uses the same hopping mode as for msg3. The network does not configure simultaneous group hopping and sequence hopping. See TS 38.211 [16], clause 6.4.1.1.1.2.\ntransformPrecodingDisabled\tDMRS related parameters for Cyclic Prefix OFDM.\ntransformPrecodingEnabled\tDMRS related parameters for DFT-s-OFDM (Transform Precoding).\n\n\u2013\tDownlinkConfigCommon\nThe IE DownlinkConfigCommon provides common downlink parameters of a cell.\nDownlinkConfigCommon information element\n-- ASN1START\n-- TAG-DOWNLINKCONFIGCOMMON-START\n\nDownlinkConfigCommon ::=        SEQUENCE {\n    frequencyInfoDL                 FrequencyInfoDL                                 OPTIONAL,   -- Cond InterFreqHOAndServCellAdd\n    initialDownlinkBWP              BWP-DownlinkCommon                              OPTIONAL,   -- Cond ServCellAdd\n    ...\n}\n\n-- TAG-DOWNLINKCONFIGCOMMON-STOP\n-- ASN1STOP\n\nDownlinkConfigCommon field descriptions\nfrequencyInfoDL\tBasic parameters of a downlink carrier and transmission thereon.\ninitialDownlinkBWP\tThe initial downlink BWP configuration for a SpCell (PCell of MCG or SCG) and SCell.The network configures the locationAndBandwidth so that the initial downlink BWP contains the entire CORESET#0 of this serving cell in the frequency domain.\n\nConditional Presence\tExplanation\nInterFreqHOAndServCellAdd\tThis field is mandatory present for inter-frequency handover, and upon serving cell (PSCell/SCell) addition. Otherwise, the field is optionally present, Need M.\nServCellAdd\tThis field is mandatory present upon serving cell addition (for PSCell and SCell). It is optionally present, Need M otherwise.\n\n\u2013\tDownlinkConfigCommonSIB\nThe IE DownlinkConfigCommonSIB provides common downlink parameters of a cell.\nDownlinkConfigCommonSIB information element\n-- ASN1START\n-- TAG-DOWNLINKCONFIGCOMMONSIB-START\n\nDownlinkConfigCommonSIB ::=     SEQUENCE {\n    frequencyInfoDL                 FrequencyInfoDL-SIB,\n    initialDownlinkBWP              BWP-DownlinkCommon,\n    bcch-Config                         BCCH-Config,\n    pcch-Config                         PCCH-Config,\n    ...\n}\n\n\nBCCH-Config ::=                 SEQUENCE { \n    modificationPeriodCoeff         ENUMERATED {n2, n4, n8, n16},\n    ...\n}\n\n\nPCCH-Config ::=             SEQUENCE {\n    defaultPagingCycle                  PagingCycle,\n    nAndPagingFrameOffset               CHOICE {\n        oneT                                NULL,\n        halfT                               INTEGER (0..1),\n        quarterT                            INTEGER (0..3),\n        oneEighthT                          INTEGER (0..7),\n        oneSixteenthT                       INTEGER (0..15)\n    },\n    ns                                  ENUMERATED {four, two, one},\n    firstPDCCH-MonitoringOccasionOfPO   CHOICE {\n        sCS15KHZoneT                                                            SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..139),\n        sCS30KHZoneT-SCS15KHZhalfT                                              SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..279),\n        sCS60KHZoneT-SCS30KHZhalfT-SCS15KHZquarterT                             SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..559),\n        sCS120KHZoneT-SCS60KHZhalfT-SCS30KHZquarterT-SCS15KHZoneEighthT         SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..1119),\n        sCS120KHZhalfT-SCS60KHZquarterT-SCS30KHZoneEighthT-SCS15KHZoneSixteenthT\n                                                                                SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..2239),\n        sCS120KHZquarterT-SCS60KHZoneEighthT-SCS30KHZoneSixteenthT              SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..4479),\n        sCS120KHZoneEighthT-SCS60KHZoneSixteenthT                               SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..8959),\n        sCS120KHZoneSixteenthT                                                  SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..17919)\n    }   OPTIONAL,           -- Need R\n    ...\n}\n\n-- TAG-DOWNLINKCONFIGCOMMONSIB-STOP\n-- ASN1STOP\n\nDownlinkConfigCommonSIB field descriptions\nfrequencyInfoDL-SIB\tBasic parameters of a downlink carrier and transmission thereon.\ninitialDownlinkBWP\tThe initial downlink BWP configuration for a SpCell (PCell of MCG or SCG). The network configures the locationAndBandwidth so that the initial downlink BWP contains the entire CORESET#0 of this serving cell in the frequency domain. The UE applies the locationAndBandwidth only after reception of RRCSetup/RRCResume/RRCReestablishment.\nbcch-Config\tThe modification period related configuration.\npcch-Config\tThe paging related configuration.\n\nBCCH-Config field descriptions\nmodificationPeriodCoeff\tActual modification period, expressed in number of radio frames m = modificationPeriodCoeff * defaultPagingCycle, see clause 5.2.2.2.2. n2 corresponds to value 2, n4 corresponds to value 4, and so on.\n\nPCCH-Config field descriptions\ndefaultPagingCycle\tDefault paging cycle, used to derive 'T' in TS 38.304 [20]. Value rf32 corresponds to 32 radio frames, value rf64 corresponds to 64 radio frames and so on.\nfirstPDCCH-MonitoringOccasionOfPO\tPoints out the first PDCCH monitoring occasion for paging of each PO of the PF, see TS 38.304 [20].\nnAndPagingFrameOffset\tUsed to derive the number of total paging frames in T (corresponding to parameter N in TS 38.304 [20]) and paging frame offset (corresponding to parameter PF_offset in TS 38.304 [20]). A value of oneSixteenthT corresponds to T / 16, a value of oneEighthT corresponds to T / 8, and so on.\tIf pagingSearchSpace is set to zero and if RMSI multiplexing pattern is 2 or 3 (as specified in TS 38.213 [13]):\t-\tfor ssb-periodicityServingCell of 5 or 10 ms, N can be set to one of {oneT, halfT, quarterT, oneEighthT, oneSixteenthT}\t-\tfor ssb-periodicityServingCell of 20 ms, N can be set to one of {halfT, quarterT, oneEighthT, oneSixteenthT}\t-\tfor ssb-periodicityServingCell of 40 ms, N can be set to one of {quarterT, oneEighthT, oneSixteenthT}\t-\tfor ssb-periodicityServingCell of 80 ms, N can be set to one of {oneEighthT, oneSixteenthT}\t-\tfor ssb-periodicityServingCell of 160 ms, N can be set to oneSixteenthT\tIf pagingSearchSpace is set to zero and if RMSI multiplexing pattern is 1 (as specified in TS 38.213 [13]), N can be set to one of {halfT, quarterT, oneEighthT, oneSixteenthT}\tIf pagingSearchSpace is not set to zero, N can be configured to one of {oneT, halfT, quarterT, oneEighthT, oneSixteenthT}\nns\tNumber of paging occasions per paging frame.\n\n\u2013\tDownlinkPreemption\nThe IE DownlinkPreemption is used to configure the UE to monitor PDCCH for the INT-RNTI (interruption).\nDownlinkPreemption information element\n-- ASN1START\n-- TAG-DOWNLINKPREEMPTION-START\n\nDownlinkPreemption ::=              SEQUENCE {\n    int-RNTI                            RNTI-Value,\n    timeFrequencySet                    ENUMERATED {set0, set1},\n    dci-PayloadSize                     INTEGER (0..maxINT-DCI-PayloadSize),\n    int-ConfigurationPerServingCell     SEQUENCE (SIZE (1..maxNrofServingCells)) OF INT-ConfigurationPerServingCell,\n    ...\n}\n\nINT-ConfigurationPerServingCell ::= SEQUENCE {\n    servingCellId                       ServCellIndex,\n    positionInDCI                       INTEGER (0..maxINT-DCI-PayloadSize-1)\n}\n\n-- TAG-DOWNLINKPREEMPTION-STOP\n-- ASN1STOP\n\nDownlinkPreemption field descriptions\ndci-PayloadSize\tTotal length of the DCI payload scrambled with INT-RNTI (see TS 38.213 [13], clause 11.2).\nint-ConfigurationPerServingCell\tIndicates (per serving cell) the position of the 14 bit INT values inside the DCI payload (see TS 38.213 [13], clause 11.2).\nint-RNTI\tRNTI used for indication pre-emption in DL (see TS 38.213 [13], clause 10).\ntimeFrequencySet\tSet selection for DL-preemption indication (see TS 38.213 [13], clause 11.2) The set determines how the UE interprets the DL preemption DCI payload.\n\nINT-ConfigurationPerServingCell field descriptions\npositionInDCI\tStarting position (in number of bit) of the 14 bit INT value applicable for this serving cell (servingCellId) within the DCI payload (see TS 38.213 [13], clause 11.2). Must be multiples of 14 (bit).\n\n\u2013\tDRB-Identity\nThe IE DRB-Identity is used to identify a DRB used by a UE.\nDRB-Identity information element\n-- ASN1START\n-- TAG-DRB-IDENTITY-START\n\nDRB-Identity ::=                    INTEGER (1..32)\n\n-- TAG-DRB-IDENTITY-STOP\n-- ASN1STOP\n\n\u2013\tDRX-Config\nThe IE DRX-Config is used to configure DRX related parameters.\nDRX-Config information element\n-- ASN1START\n-- TAG-DRX-CONFIG-START\n\nDRX-Config ::=                      SEQUENCE {\n    drx-onDurationTimer                 CHOICE {\n                                            subMilliSeconds INTEGER (1..31),\n                                            milliSeconds    ENUMERATED {\n                                                ms1, ms2, ms3, ms4, ms5, ms6, ms8, ms10, ms20, ms30, ms40, ms50, ms60,\n                                                ms80, ms100, ms200, ms300, ms400, ms500, ms600, ms800, ms1000, ms1200,\n                                                ms1600, spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1 }\n                                            },\n    drx-InactivityTimer                 ENUMERATED {\n                                            ms0, ms1, ms2, ms3, ms4, ms5, ms6, ms8, ms10, ms20, ms30, ms40, ms50, ms60, ms80,\n                                            ms100, ms200, ms300, ms500, ms750, ms1280, ms1920, ms2560, spare9, spare8,\n                                            spare7, spare6, spare5, spare4, spare3, spare2, spare1},\n    drx-HARQ-RTT-TimerDL                INTEGER (0..56),\n    drx-HARQ-RTT-TimerUL                INTEGER (0..56),\n    drx-RetransmissionTimerDL           ENUMERATED {\n                                            sl0, sl1, sl2, sl4, sl6, sl8, sl16, sl24, sl33, sl40, sl64, sl80, sl96, sl112, sl128,\n                                            sl160, sl320, spare15, spare14, spare13, spare12, spare11, spare10, spare9,\n                                            spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1},\n    drx-RetransmissionTimerUL           ENUMERATED {\n                                            sl0, sl1, sl2, sl4, sl6, sl8, sl16, sl24, sl33, sl40, sl64, sl80, sl96, sl112, sl128,\n                                            sl160, sl320, spare15, spare14, spare13, spare12, spare11, spare10, spare9,\n                                            spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1 },\n    drx-LongCycleStartOffset            CHOICE {\n        ms10                                INTEGER(0..9),\n        ms20                                INTEGER(0..19),\n        ms32                                INTEGER(0..31),\n        ms40                                INTEGER(0..39),\n        ms60                                INTEGER(0..59),\n        ms64                                INTEGER(0..63),\n        ms70                                INTEGER(0..69),\n        ms80                                INTEGER(0..79),\n        ms128                               INTEGER(0..127),\n        ms160                               INTEGER(0..159),\n        ms256                               INTEGER(0..255),\n        ms320                               INTEGER(0..319),\n        ms512                               INTEGER(0..511),\n        ms640                               INTEGER(0..639),\n        ms1024                              INTEGER(0..1023),\n        ms1280                              INTEGER(0..1279),\n        ms2048                              INTEGER(0..2047),\n        ms2560                              INTEGER(0..2559),\n        ms5120                              INTEGER(0..5119),\n        ms10240                             INTEGER(0..10239)\n    },\n\n    shortDRX                            SEQUENCE {\n        drx-ShortCycle                      ENUMERATED  {\n                                                ms2, ms3, ms4, ms5, ms6, ms7, ms8, ms10, ms14, ms16, ms20, ms30, ms32,\n                                                ms35, ms40, ms64, ms80, ms128, ms160, ms256, ms320, ms512, ms640, spare9,\n                                                spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1 },\n        drx-ShortCycleTimer                 INTEGER (1..16)\n    }                                                                                                           OPTIONAL,   -- Need R\n    drx-SlotOffset                      INTEGER (0..31)\n}\n\n-- TAG-DRX-CONFIG-STOP\n-- ASN1STOP\n\nDRX-Config field descriptions\ndrx-HARQ-RTT-TimerDL\tValue in number of symbols of the BWP where the transport block was received.\ndrx-HARQ-RTT-TimerUL\tValue in number of symbols of the BWP where the transport block was transmitted.\ndrx-InactivityTimer\tValue in multiple integers of 1 ms. ms0 corresponds to 0, ms1 corresponds to 1 ms, ms2 corresponds to 2 ms, and so on.\ndrx-LongCycleStartOffset\tdrx-LongCycle in ms and drx-StartOffset in multiples of 1 ms. If drx-ShortCycle is configured, the value of drx-LongCycle shall be a multiple of the drx-ShortCycle value.\ndrx-onDurationTimer\tValue in multiples of 1/32 ms (subMilliSeconds) or in ms (milliSecond). For the latter, value ms1 corresponds to 1 ms, value ms2 corresponds to 2 ms, and so on.\ndrx-RetransmissionTimerDL\tValue in number of slot lengths of the BWP where the transport block was received. value sl0 corresponds to 0 slots, sl1 corresponds to 1 slot, sl2 corresponds to 2 slots, and so on.\ndrx-RetransmissionTimerUL\tValue in number of slot lengths of the BWP where the transport block was transmitted. sl0 corresponds to 0 slots, sl1 corresponds to 1 slot, sl2 corresponds to 2 slots, and so on.\ndrx-ShortCycleTimer\tValue in multiples of drx-ShortCycle. A value of 1 corresponds to drx-ShortCycle, a value of 2 corresponds to 2 * drx-ShortCycle and so on.\ndrx-ShortCycle\tValue in ms. ms1 corresponds to 1 ms, ms2 corresponds to 2 ms, and so on.\ndrx-SlotOffset\tValue in 1/32 ms. Value 0 corresponds to 0 ms, value 1 corresponds to 1/32 ms, value 2 corresponds to 2/32 ms, and so on.\n\n\u2013\tFilterCoefficient\nThe IE FilterCoefficient specifies the measurement filtering coefficient. Value fc0 corresponds to k = 0, fc1 corresponds to k = 1, and so on.\nFilterCoefficient information element\n-- ASN1START\n-- TAG-FILTERCOEFFICIENT-START\n\nFilterCoefficient ::=       ENUMERATED { fc0, fc1, fc2, fc3, fc4, fc5, fc6, fc7, fc8, fc9, fc11, fc13, fc15, fc17, fc19, spare1, ...}\n\n-- TAG-FILTERCOEFFICIENT-STOP\n-- ASN1STOP\n\n\n\u2013\tFreqBandIndicatorNR\nThe IE FreqBandIndicatorNR is used to convey an NR frequency band number as defined in TS 38.101-1 [15].\nFreqBandIndicatorNR information element\n-- ASN1START\n-- TAG-FREQBANDINDICATORNR-START\n\nFreqBandIndicatorNR ::=             INTEGER (1..1024)\n\n-- TAG-FREQBANDINDICATORNR-STOP\n-- ASN1STOP\n\n\u2013\tFrequencyInfoDL\nThe IE FrequencyInfoDL provides basic parameters of a downlink carrier and transmission thereon.\nFrequencyInfoDL information element\n-- ASN1START\n-- TAG-FREQUENCYINFODL-START\n\nFrequencyInfoDL ::=                 SEQUENCE {\n    absoluteFrequencySSB                ARFCN-ValueNR                                                   OPTIONAL,   -- Cond SpCellAdd\n    frequencyBandList                   MultiFrequencyBandListNR,\n    absoluteFrequencyPointA             ARFCN-ValueNR,\n    scs-SpecificCarrierList             SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier,\n    ...\n}\n\n-- TAG-FREQUENCYINFODL-STOP\n-- ASN1STOP\n\nFrequencyInfoDL field descriptions\nabsoluteFrequencyPointA\tAbsolute frequency position of the reference resource block (Common RB 0). Its lowest subcarrier is also known as Point A (see TS 38.211 [16], clause 4.4.4.2). Note that the lower edge of the actual carrier is not defined by this field but rather in the scs-SpecificCarrierList.\nabsoluteFrequencySSB\tFrequency of the SSB to be used for this serving cell. SSB related parameters (e.g. SSB index) provided for a serving cell refer to this SSB frequency unless mentioned otherwise. The cell-defining SSB of the PCell is always on the sync raster. Frequencies are considered to be on the sync raster if they are also identifiable with a GSCN value (see TS 38.101-1 [15]). If the field is absent, the SSB related parameters should be absent, e.g. ssb-PositionsInBurst, ssb-periodicityServingCell and subcarrierSpacing in ServingCellConfigCommon IE. If the field is absent, the UE obtains timing reference from the SpCell. This is only supported in case the Scell is in the same frequency band as the SpCell.\nfrequencyBandList\tList containing only one frequency band to which this carrier(s) belongs. Multiple values are not supported.\nscs-SpecificCarrierList\tA set of carriers for different subcarrier spacings (numerologies). Defined in relation to Point A. The network configures a scs-SpecificCarrier at least for each numerology (SCS) that is used e.g. in a BWP (see TS 38.211 [16], clause 5.3).\n\nConditional Presence\tExplanation\nSpCellAdd\tThe field is mandatory present if this FrequencyInfoDL is for SpCell. Otherwise the field is optionally present, Need S.\n\n\u2013\tFrequencyInfoDL-SIB\nThe IE FrequencyInfoDL-SIB provides basic parameters of a downlink carrier and transmission thereon.\nFrequencyInfoDL-SIB information element\n-- ASN1START\n-- TAG-FREQUENCYINFODL-SIB-START\n\nFrequencyInfoDL-SIB ::=             SEQUENCE {\n    frequencyBandList                   MultiFrequencyBandListNR-SIB,\n    offsetToPointA                      INTEGER (0..2199),\n    scs-SpecificCarrierList             SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier\n}\n\n-- TAG-FREQUENCYINFODL-SIB-STOP\n-- ASN1STOP\n\nFrequencyInfoDL-SIB field descriptions\noffsetToPointA\tRepresents the offset to Point A as defined in TS 38.211 [16], clause 4.4.4.2.\nfrequencyBandList\tList of one or multiple frequency bands to which this carrier(s) belongs. \nscs-SpecificCarrierList\tA set of carriers for different subcarrier spacings (numerologies). Defined in relation to Point A (see TS 38.211 [16], clause 5.3). The network configures this for all SCSs that are used in DL BWPs in this serving cell.\n\n\u2013\tFrequencyInfoUL\nThe IE FrequencyInfoUL provides basic parameters of an uplink carrier and transmission thereon.\nFrequencyInfoUL information element\n-- ASN1START\n-- TAG-FREQUENCYINFOUL-START\n\nFrequencyInfoUL ::=                 SEQUENCE {\n    frequencyBandList                   MultiFrequencyBandListNR                                OPTIONAL,   -- Cond FDD-OrSUL\n    absoluteFrequencyPointA             ARFCN-ValueNR                                           OPTIONAL,   -- Cond FDD-OrSUL\n    scs-SpecificCarrierList             SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier,\n    additionalSpectrumEmission          AdditionalSpectrumEmission                              OPTIONAL,   -- Need S\n    p-Max                               P-Max                                                   OPTIONAL,   -- Need S\n    frequencyShift7p5khz                ENUMERATED {true}                                       OPTIONAL,   -- Cond FDD-OrSUL-Optional\n    ...\n}\n\n-- TAG-FREQUENCYINFOUL-STOP\n-- ASN1STOP\n\nFrequencyInfoUL field descriptions\nabsoluteFrequencyPointA\tAbsolute frequency of the reference resource block (Common RB 0). Its lowest subcarrier is also known as Point A. Note that the lower edge of the actual carrier is not defined by this field but rather in the scs-SpecificCarrierList (see TS 38.211 [16], clause 4.4.4.2).\nadditionalSpectrumEmission\tThe additional spectrum emission requirements to be applied by the UE on this uplink. If the field is absent, the UE uses value 0 for the additionalSpectrumEmission (see Table 6.2.3-1A in TS 38.101-1 [15]).\nfrequencyBandList\tList containing only one frequency band to which this carrier(s) belongs. Multiple values are not supported.\nfrequencyShift7p5khz\tEnable the NR UL transmission with a 7.5 kHz shift to the LTE raster. If the field is absent, the frequency shift is disabled.\np-Max\tMaximum transmit power allowed in this serving cell. The maximum transmit power that the UE may use on this serving cell may be additionally limited by p-NR-FR1 (configured for the cell group) and by p-UE-FR1 (configured total for all serving cells operating on FR1). If absent, the UE applies the maximum power according to TS 38.101-1 [15]. Value in dBm.\nscs-SpecificCarrierList\tA set of carriers for different subcarrier spacings (numerologies). Defined in relation to Point A. The network configures a scs-SpecificCarrier at least for each numerology (SCS) that is used e.g. in a BWP (see TS 38.211 [16], clause 5.3).\n\nConditional Presence\tExplanation\nFDD-OrSUL\tThe field is mandatory present if this FrequencyInfoUL is for the paired UL for a DL (defined in a FrequencyInfoDL) or if this FrequencyInfoUL is for a supplementary uplink (SUL). It is absent otherwise (if this FrequencyInfoUL is for an unpaired UL (TDD). \nFDD-OrSUL-Optional\tThe field is optionally present, Need R, if this FrequencyInfoUL is for the paired UL for a DL (defined in a FrequencyInfoDL) or if this FrequencyInfoUL is for a supplementary uplink (SUL). It is absent otherwise. \n\n\u2013\tFrequencyInfoUL-SIB\nThe IE FrequencyInfoUL-SIB provides basic parameters of an uplink carrier and transmission thereon.\nFrequencyInfoUL-SIB information element\n-- ASN1START\n-- TAG-FREQUENCYINFOUL-SIB-START\n\nFrequencyInfoUL-SIB ::=                 SEQUENCE {\n    frequencyBandList                   MultiFrequencyBandListNR-SIB                            OPTIONAL,   -- Cond FDD-OrSUL\n    absoluteFrequencyPointA             ARFCN-ValueNR                                           OPTIONAL,   -- Cond FDD-OrSUL\n    scs-SpecificCarrierList             SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier,\n    p-Max                               P-Max                                                   OPTIONAL,   -- Need S\n    frequencyShift7p5khz                ENUMERATED {true}                                       OPTIONAL,   -- Cond FDD-OrSUL-Optional\n    ...\n}\n\n-- TAG-FREQUENCYINFOUL-SIB-STOP\n-- ASN1STOP\n\nFrequencyInfoUL-SIB field descriptions\nabsoluteFrequencyPointA\tAbsolute frequency of the reference resource block (Common RB 0). Its lowest subcarrier is also known as Point A. Note that the lower edge of the actual carrier is not defined by this field but rather in the scs-SpecificCarrierList (see TS 38.211 [16], clause 4.4.4.2).\nfrequencyBandList\tProvides the frequency band indicator and a list of additionalPmax and additionalSpectrumEmission values as defined in TS 38.101-1 [15], table 6.2.3-1. The UE shall apply the first listed band which it supports in the frequencyBandList field. \nfrequencyShift7p5khz\tEnable the NR UL transmission with a 7.5 kHz shift to the LTE raster. If the field is absent, the frequency shift is disabled.\np-Max\tValue in dBm applicable for the cell. If absent the UE applies the maximum power according to TS 38.101-1 [15].\nscs-SpecificCarrierList\tA set of carriers for different subcarrier spacings (numerologies). Defined in relation to Point A (see TS 38.211 [16], clause 5.3). The network configures this for all SCSs that are used in UL BWPs configured in this serving cell.\n\nConditional Presence\tExplanation\nFDD-OrSUL\tThe field is mandatory present if this FrequencyInfoUL is for the paired UL for a DL (defined in a FrequencyInfoDL) or if this FrequencyInfoUL is for a supplementary uplink (SUL). It is absent otherwise (if this FrequencyInfoUL is for an unpaired UL (TDD). \nFDD-OrSUL-Optional\tThe field is optionally present, Need R, if this FrequencyInfoUL is for the paired UL for a DL (defined in a FrequencyInfoDL) or if this FrequencyInfoUL is for a supplementary uplink (SUL). It is absent otherwise. \n\n\u2013\tHysteresis\nThe IE Hysteresis is a parameter used within the entry and leave condition of an event triggered reporting condition. The actual value is field value * 0.5 dB.\nHysteresis information element\n-- ASN1START\n-- TAG-HYSTERESIS-START\n\nHysteresis ::=                      INTEGER (0..30)\n\n-- TAG-HYSTERESIS-STOP\n-- ASN1STOP\n\n\n\u2013\tI-RNTI-Value\nThe IE I-RNTI-Value is used to identify the suspended UE context of a UE in RRC_INACTIVE.\nI-RNTI-Value information element\n-- ASN1START\n-- TAG-I-RNTI-VALUE-START\n\nI-RNTI-Value ::=                        BIT STRING (SIZE(40))\n\n-- TAG-I-RNTI-VALUE-STOP\n-- ASN1STOP\n\n\u2013\tLocationMeasurementInfo\nThe IE LocationMeasurementInfo defines the information sent by the UE to the network to assist with the configuration of measurement gaps for location related measurements.\nLocationMeasurementInfo information element\n-- ASN1START\n-- TAG-LOCATIONMEASUREMENTINFO-START\n\nLocationMeasurementInfo ::=     CHOICE {\n        eutra-RSTD                  EUTRA-RSTD-InfoList,\n        ...,\n        eutra-FineTimingDetection    NULL\n\n}\n\nEUTRA-RSTD-InfoList ::= SEQUENCE (SIZE (1..maxInterRAT-RSTD-Freq)) OF EUTRA-RSTD-Info\n\nEUTRA-RSTD-Info ::= SEQUENCE {\n    carrierFreq                 ARFCN-ValueEUTRA,\n    measPRS-Offset              INTEGER (0..39),\n    ...\n}\n\n-- TAG-LOCATIONMEASUREMENTINFO-STOP\n-- ASN1STOP\n\nLocationMeasurementInfo field descriptions\ncarrierFreq\tThe EARFCN value of the carrier received from upper layers for which the UE needs to perform the inter-RAT RSTD measurements.\nmeasPRS-Offset\tIndicates the requested gap offset for performing RSTD measurements towards E-UTRA. It is the smallest subframe offset from the beginning of subframe 0 of SFN=0 of the serving cell of the requested gap for measuring PRS positioning occasions in the carrier frequency carrierFreq for which the UE needs to perform the inter-RAT RSTD measurements. The PRS positioning occasion information is received from upper layers. The value of measPRS-Offset is obtained by mapping the starting subframe of the PRS positioning occasion in the measured cell onto the corresponding subframe in the serving cell and is calculated as the serving cell's number of subframes from SFN=0 mod 40.\tThe UE shall take into account any additional time required by the UE to start PRS measurements on the other carrier when it does this mapping for determining the measPRS-Offset.\tNOTE: Figure 6.2.2-1 in TS 36.331[10] illustrates the measPRS-Offset field.\n\n\u2013\tLogicalChannelConfig\nThe IE LogicalChannelConfig is used to configure the logical channel parameters.\nLogicalChannelConfig information element\n-- ASN1START\n-- TAG-LOGICALCHANNELCONFIG-START\n\nLogicalChannelConfig ::=            SEQUENCE {\n    ul-SpecificParameters               SEQUENCE {\n        priority                            INTEGER (1..16),\n        prioritisedBitRate                  ENUMERATED {kBps0, kBps8, kBps16, kBps32, kBps64, kBps128, kBps256, kBps512,\n                                            kBps1024, kBps2048, kBps4096, kBps8192, kBps16384, kBps32768, kBps65536, infinity},\n        bucketSizeDuration                  ENUMERATED {ms5, ms10, ms20, ms50, ms100, ms150, ms300, ms500, ms1000,\n                                                            spare7, spare6, spare5, spare4, spare3,spare2, spare1},\n\n        allowedServingCells                 SEQUENCE (SIZE (1..maxNrofServingCells-1)) OF ServCellIndex\n                                                                                                    OPTIONAL,   -- PDCP-CADuplication\n        allowedSCS-List                     SEQUENCE (SIZE (1..maxSCSs)) OF SubcarrierSpacing       OPTIONAL,   -- Need R\n        maxPUSCH-Duration                   ENUMERATED {ms0p02, ms0p04, ms0p0625, ms0p125, ms0p25, ms0p5, spare2, spare1}\n                                                                                                    OPTIONAL,   -- Need R\n        configuredGrantType1Allowed         ENUMERATED {true}                                       OPTIONAL,   -- Need R\n\n        logicalChannelGroup                 INTEGER (0..maxLCG-ID)                                  OPTIONAL,   -- Need R\n        schedulingRequestID                 SchedulingRequestId                                     OPTIONAL,   -- Need R\n        logicalChannelSR-Mask               BOOLEAN,\n        logicalChannelSR-DelayTimerApplied  BOOLEAN,\n        ...,\n        bitRateQueryProhibitTimer       ENUMERATED { s0, s0dot4, s0dot8, s1dot6, s3, s6, s12,s30}   OPTIONAL    -- Need R\n    }                                                                                               OPTIONAL,   -- Cond UL\n\n    ...\n}\n\n-- TAG-LOGICALCHANNELCONFIG-STOP\n-- ASN1STOP\n\nLogicalChannelConfig field descriptions\nallowedSCS-List\tIf present, UL MAC SDUs from this logical channel can only be mapped to the indicated numerology. Otherwise, UL MAC SDUs from this logical channel can be mapped to any configured numerology. Only the values 15/30/60 kHz (for FR1) and 60/120 kHz (for FR2) are applicable. Corresponds to 'allowedSCS-List' as specified in TS 38.321 [3].\nallowedServingCells\tIf present, UL MAC SDUs from this logical channel can only be mapped to the serving cells indicated in this list. Otherwise, UL MAC SDUs from this logical channel can be mapped to any configured serving cell of this cell group. Corresponds to 'allowedServingCells' in TS 38.321 [3].\nbitRateQueryProhibitTimer\tThe timer is used for bit rate recommendation query in TS 38.321 [3], in seconds. Value s0 means 0 s, s0dot4 means 0.4 s and so on.\nbucketSizeDuration\tValue in ms. ms5 corresponds to 5 ms, value ms10 corresponds to 10 ms, and so on.\nconfiguredGrantType1Allowed\tIf present, UL MAC SDUs from this logical channel can be transmitted on a configured grant type 1. Corresponds to 'configuredGrantType1Allowed' in TS 38.321 [3].\nlogicalChannelGroup\tID of the logical channel group, as specified in TS 38.321 [3], which the logical channel belongs to.\nlogicalChannelSR-Mask\tControls SR triggering when a configured uplink grant of type1 or type2 is configured. true indicates that SR masking is configured for this logical channel as specified in TS 38.321 [3].\nlogicalChannelSR-DelayTimerApplied\tIndicates whether to apply the delay timer for SR transmission for this logical channel. Set to false if logicalChannelSR-DelayTimer is not included in BSR-Config.\nmaxPUSCH-Duration\tIf present, UL MAC SDUs from this logical channel can only be transmitted using uplink grants that result in a PUSCH duration shorter than or equal to the duration indicated by this field. Otherwise, UL MAC SDUs from this logical channel can be transmitted using an uplink grant resulting in any PUSCH duration. Corresponds to \"maxPUSCH-Duration\" in TS 38.321 [3].\npriority\tLogical channel priority, as specified in TS 38.321 [3].\nprioritisedBitRate\tValue in kiloBytes/s. Value kBps0 corresponds to 0 kiloBytes/s, value kBps8 corresponds to 8 kiloBytes/s, value kBps16 corresponds to 16 kiloBytes/s, and so on. For SRBs, the value can only be set to infinity.\nschedulingRequestId\tIf present, it indicates the scheduling request configuration applicable for this logical channel, as specified in TS 38.321 [3].\n\nConditional Presence\tExplanation\nPDCP-CADuplication\tThe field is mandatory present if the UE is configured with PDCP CA duplication in UL (see PDCP-Config -> moreThanOneRLC -> primaryPath -> logicalChannel). Otherwise the field is optionally present, need R.\nUL\tThe field is mandatory present for a logical channel with uplink if it serves DRB. It is optionally present, Need R, for a logical channel with uplink if it serves an SRB. otherwise it is not present.  \n\n\u2013\tLogicalChannelIdentity\nThe IE LogicalChannelIdentity is used to identify one logical channel (LogicalChannelConfig) and the corresponding RLC bearer (RLC-BearerConfig).\nLogicalChannelIdentity information element\n-- ASN1START\n-- TAG-LOGICALCHANNELIDENTITY-START\n\nLogicalChannelIdentity ::=          INTEGER (1..maxLC-ID)\n\n-- TAG-LOGICALCHANNELIDENTITY-STOP\n-- ASN1STOP\n\n\u2013\tMAC-CellGroupConfig\nThe IE MAC-CellGroupConfig is used to configure MAC parameters for a cell group, including DRX.\nMAC-CellGroupConfig information element\n-- ASN1START\n-- TAG-MAC-CELLGROUPCONFIG-START\n\nMAC-CellGroupConfig ::=             SEQUENCE {\n    drx-Config                          SetupRelease { DRX-Config }                                     OPTIONAL,   -- Need M\n    schedulingRequestConfig             SchedulingRequestConfig                                         OPTIONAL,   -- Need M\n    bsr-Config                          BSR-Config                                                      OPTIONAL,   -- Need M\n    tag-Config                          TAG-Config                                                      OPTIONAL,   -- Need M\n    phr-Config                          SetupRelease { PHR-Config }                                     OPTIONAL,   -- Need M\n    skipUplinkTxDynamic                 BOOLEAN,\n    ...,\n    [[\n    csi-Mask-v1530                          BOOLEAN                                                     OPTIONAL,   -- Need M\n    dataInactivityTimer-v1530               SetupRelease { DataInactivityTimer }                        OPTIONAL    -- Cond MCG-Only\n    ]]\n}\n\nDataInactivityTimer ::=         ENUMERATED {s1, s2, s3, s5, s7, s10, s15, s20, s40, s50, s60, s80, s100, s120, s150, s180}\n\n-- TAG-MAC-CELLGROUPCONFIG-STOP\n-- ASN1STOP\n\nMAC-CellGroupConfig field descriptions\ncsi-Mask-v1530\tIf set to true, the UE limits CSI reports to the on-duration period of the DRX cycle, see TS 38.321 [3].\ndataInactivityTimer-v1530\tReleases the RRC connection upon data inactivity as specified in clause 5.3.8.5 and in TS 38.321 [3]. Value s1 corresponds to 1 second, value s2 corresponds to 2 seconds, and so on.\ndrx-Config\tUsed to configure DRX as specified in TS 38.321 [3].\nskipUplinkTxDynamic\tIf set to true, the UE skips UL transmissions as described in TS 38.321 [3].\n\nConditional Presence\tExplanation\nMCG-Only\tThis field is optionally present, Need M, for the MAC-CellGroupConfig of the MCG. It is absent otherwise. \n\n\u2013\tMeasConfig\nThe IE MeasConfig specifies measurements to be performed by the UE, and covers intra-frequency, inter-frequency and inter-RAT mobility as well as configuration of measurement gaps.\nMeasConfig information element\n-- ASN1START\n-- TAG-MEASCONFIG-START\n\nMeasConfig ::=                      SEQUENCE {\n    measObjectToRemoveList              MeasObjectToRemoveList                                              OPTIONAL,   -- Need N\n    measObjectToAddModList              MeasObjectToAddModList                                              OPTIONAL,   -- Need N\n    reportConfigToRemoveList            ReportConfigToRemoveList                                            OPTIONAL,   -- Need N\n    reportConfigToAddModList            ReportConfigToAddModList                                            OPTIONAL,   -- Need N\n    measIdToRemoveList                  MeasIdToRemoveList                                                  OPTIONAL,   -- Need N\n    measIdToAddModList                  MeasIdToAddModList                                                  OPTIONAL,   -- Need N\n    s-MeasureConfig                     CHOICE {\n        ssb-RSRP                            RSRP-Range,\n        csi-RSRP                            RSRP-Range\n    }                                                                                                       OPTIONAL,   -- Need M\n    quantityConfig                      QuantityConfig                                                      OPTIONAL,   -- Need M\n    measGapConfig                       MeasGapConfig                                                       OPTIONAL,   -- Need M\n    measGapSharingConfig                MeasGapSharingConfig                                                OPTIONAL,   -- Need M\n    ...\n}\n\nMeasObjectToRemoveList ::=              SEQUENCE (SIZE (1..maxNrofObjectId)) OF MeasObjectId\n\nMeasIdToRemoveList ::=                  SEQUENCE (SIZE (1..maxNrofMeasId)) OF MeasId\n\nReportConfigToRemoveList ::=            SEQUENCE (SIZE (1..maxReportConfigId)) OF ReportConfigId\n\n-- TAG-MEASCONFIG-STOP\n-- ASN1STOP\n\nMeasConfig field descriptions\nmeasGapConfig\tUsed to setup and release measurement gaps in NR.\nmeasIdToAddModList\tList of measurement identities to add and/or modify.\nmeasIdToRemoveList\tList of measurement identities to remove.\nmeasObjectToAddModList\tList of measurement objects to add and/or modify.\nmeasObjectToRemoveList\tList of measurement objects to remove.\nreportConfigToAddModList\tList of measurement reporting configurations to add and/or modify.\nreportConfigToRemoveList\tList of measurement reporting configurations to remove.\ns-MeasureConfig\tThreshold for NR SpCell RSRP measurement controlling when the UE is required to perform measurements on non-serving cells. Choice of ssb-RSRP corresponds to cell RSRP based on SS/PBCH block and choice of csi-RSRP corresponds to cell RSRP of CSI-RS. \nmeasGapSharingConfig\tSpecifies the measurement gap sharing scheme and controls setup/ release of measurement gap sharing.\n\n\u2013\tMeasGapConfig\nThe IE MeasGapConfig specifies the measurement gap configuration and controls setup/release of measurement gaps.\nMeasGapConfig information element\n-- ASN1START\n-- TAG-MEASGAPCONFIG-START\n\nMeasGapConfig ::=                   SEQUENCE {\n    gapFR2                              SetupRelease { GapConfig }                                              OPTIONAL,   -- Need M\n    ...,\n    [[\n    gapFR1                          SetupRelease { GapConfig }                                                  OPTIONAL,   -- Need M\n    gapUE                           SetupRelease { GapConfig }                                                  OPTIONAL    -- Need M\n    ]]\n\n}\n\nGapConfig ::=                       SEQUENCE {\n    gapOffset                           INTEGER (0..159),\n    mgl                                 ENUMERATED {ms1dot5, ms3, ms3dot5, ms4, ms5dot5, ms6},\n    mgrp                                ENUMERATED {ms20, ms40, ms80, ms160},\n    mgta                                ENUMERATED {ms0, ms0dot25, ms0dot5},\n    ...\n}\n\n-- TAG-MEASGAPCONFIG-STOP\n-- ASN1STOP\n\nMeasGapConfig field descriptions\ngapFR1\tIndicates measurement gap configuration that applies to FR1 only. In EN-DC, gapFR1 cannot be set up by NR RRC (i.e. only LTE RRC can configure FR1 gap). gapFR1 can not be configured together with gapUE. The applicability of the measurement gap is according to Table 9.1.2-2 in TS 38.133 [14].\ngapFR2\tIndicates measurement gap configuration applies to FR2 only. gapFR2 cannot be configured together with gapUE. The applicability of the measurement gap is according to Table 9.1.2-1 and Table 9.1.2-2 in TS 38.133 [14].\ngapUE\tIndicates measurement gap configuration that applies to all frequencies (FR1 and FR2). In EN-DC, gapUE cannot be set up by NR RRC (i.e. only LTE RRC can configure per UE gap). If gapUE is configured, then neither gapFR1 nor gapFR2 can be configured. The applicability of the measurement gap is according to Table 9.1.2-2 in TS 38.133 [14].\ngapOffset\tValue gapOffset is the gap offset of the gap pattern with MGRP indicated in the field mgrp. The value range should be from 0 to mgrp-1.\nmgl\tValue mgl is the measurement gap length in ms of the measurement gap. The applicability of the measurement gap is according to in Table 9.1.2-1 and Table 9.1.2-2 in TS 38.133 [14]. Value ms1dot5 corresponds to 1.5 ms, ms3 corresponds to 3 ms and so on.\nmgrp\tValue mgrp is measurement gap repetition period in (ms) of the measurement gap. The applicability of the measurement gap is according to in Table 9.1.2-1 and Table 9.1.2-2 in TS 38.133 [14].\nmgta\tValue mgta is the measurement gap timing advance in ms. The applicability of the measurement gap timing advance is according to clause 9.1.2 of TS 38.133 [14]. Value ms0 corresponds to 0 ms, ms0dot25 corresponds to 0.25 ms and ms0dot5 corresponds to 0.5 ms. For FR2, the network only configures 0 ms and 0.25 ms. \n\n\u2013\tMeasGapSharingConfig\nThe IE MeasGapSharingConfig specifies the measurement gap sharing scheme and controls setup/ release of measurement gap sharing.\nMeasGapSharingConfig information element\n-- ASN1START\n-- TAG-MEASGAPSHARINGCONFIG-START\n\nMeasGapSharingConfig ::=        SEQUENCE {\n    gapSharingFR2                   SetupRelease { MeasGapSharingScheme }       OPTIONAL,   -- Need M\n    ...,\n    [[\n    gapSharingFR1                   SetupRelease { MeasGapSharingScheme }       OPTIONAL,   --Need M\n    gapSharingUE                    SetupRelease { MeasGapSharingScheme }       OPTIONAL    --Need M\n    ]]\n\n}\n\nMeasGapSharingScheme::=         ENUMERATED {scheme00, scheme01, scheme10, scheme11}\n\n-- TAG-MEASGAPSHARINGCONFIG-STOP\n-- ASN1STOP\n\nMeasGapSharingConfig field descriptions\ngapSharingFR1\tIndicates the measurement gap sharing scheme that applies to the gap set for FR1 only. In EN-DC, gapSharingFR1 cannot be set up by NR RRC (i.e. only LTE RRC can configure FR1 gap sharing). gapSharingFR1 can not be configured together with gapSharingUE. For the different gap sharing schemes, see TS 38.133 [14]. Value scheme00 corresponds to scheme \"00\", value scheme01 corresponds to scheme \"01\", and so on.\ngapSharingFR2\tIndicates the measurement gap sharing scheme that applies to the gap set for FR2 only. gapSharingFR2 cannot be configured together with gapSharingUE. For the different gap sharing schemes, see TS 38.133 [14]. Value scheme00 corresponds to scheme \"00\", value scheme01 corresponds to scheme \"01\", and so on.\ngapSharingUE\tIndicates the measurement gap sharing scheme that applies to the gap set per UE. In EN-DC, gapSharingUE cannot be set up by NR RRC (i.e. only LTE RRC can configure per UE gap sharing). If gapSharingUE is configured, then neither gapSharingFR1 nor gapSharingFR2 can be configured. For the different gap sharing schemes, see TS 38.133 [14]. Value scheme00 corresponds to scheme \"00\", value scheme01 corresponds to scheme \"01\", and so on.\n\n\u2013\tMeasId\nThe IE MeasId is used to identify a measurement configuration, i.e., linking of a measurement object and a reporting configuration.\nMeasId information element\n-- ASN1START\n-- TAG-MEASID-START\n\nMeasId ::=                          INTEGER (1..maxNrofMeasId)\n\n-- TAG-MEASID-STOP\n-- ASN1STOP\n\n\u2013\tMeasIdToAddModList\nThe IE MeasIdToAddModList concerns a list of measurement identities to add or modify, with for each entry the measId, the associated measObjectId and the associated reportConfigId.\nMeasIdToAddModList information element\n-- ASN1START\n-- TAG-MEASIDTOADDMODLIST-START\n\nMeasIdToAddModList ::=              SEQUENCE (SIZE (1..maxNrofMeasId)) OF MeasIdToAddMod\n\nMeasIdToAddMod ::=                  SEQUENCE {\n    measId                              MeasId,\n    measObjectId                        MeasObjectId,\n    reportConfigId                      ReportConfigId\n}\n\n-- TAG-MEASIDTOADDMODLIST-STOP\n-- ASN1STOP\n\n\u2013\tMeasObjectEUTRA\nThe IE MeasObjectEUTRA specifies information applicable for EUTRA cells.\nMeasObjectEUTRA information element\n-- ASN1START\n-- TAG-MEASOBJECTEUTRA-START\n\nMeasObjectEUTRA::=                          SEQUENCE {\n    carrierFreq                                 ARFCN-ValueEUTRA,\n    allowedMeasBandwidth                        EUTRA-AllowedMeasBandwidth,\n    cellsToRemoveListEUTRAN                     EUTRA-CellIndexList                                         OPTIONAL,    -- Need N\n    cellsToAddModListEUTRAN                     SEQUENCE (SIZE (1..maxCellMeasEUTRA)) OF EUTRA-Cell         OPTIONAL,    -- Need N\n    blackCellsToRemoveListEUTRAN                EUTRA-CellIndexList                                         OPTIONAL,    -- Need N\n    blackCellsToAddModListEUTRAN                SEQUENCE (SIZE (1..maxCellMeasEUTRA)) OF EUTRA-BlackCell    OPTIONAL,    -- Need N\n    eutra-PresenceAntennaPort1                  EUTRA-PresenceAntennaPort1,\n    eutra-Q-OffsetRange                         EUTRA-Q-OffsetRange                                         OPTIONAL,    -- Need R\n    widebandRSRQ-Meas                           BOOLEAN,\n    ...\n}\n\nEUTRA-CellIndexList ::=                     SEQUENCE (SIZE (1..maxCellMeasEUTRA)) OF EUTRA-CellIndex\n\nEUTRA-CellIndex ::=                         INTEGER (1..maxCellMeasEUTRA)\n\n\nEUTRA-Cell ::=                              SEQUENCE {\n    cellIndexEUTRA                              EUTRA-CellIndex,\n    physCellId                                  EUTRA-PhysCellId,\n    cellIndividualOffset                        EUTRA-Q-OffsetRange\n}\n\n\nEUTRA-BlackCell ::=                         SEQUENCE {\n    cellIndexEUTRA                              EUTRA-CellIndex,\n    physCellIdRange                         EUTRA-PhysCellIdRange\n}\n\n-- TAG-MEASOBJECTEUTRA-STOP\n-- ASN1STOP\n\nEUTRAN-BlackCell field descriptions\ncellIndexEUTRA\tEntry index in the cell list.\nphysicalCellIdRange\tPhysical cell identity or a range of physical cell identities.\n\nEUTRAN-Cell field descriptions\nphysicalCellId\tPhysical cell identity of a cell in the cell list.\ncellIndividualOffset\tCell individual offset applicable to a specific cell. Value dB-24 corresponds to -24 dB, dB-22 corresponds to -22 dB and so on.\n\nMeasObjectEUTRA field descriptions\nallowedMeasBandwidth\tThe maximum allowed measurement bandwidth on a carrier frequency as defined by the parameter Transmission Bandwidth Configuration \"NRB\" TS 36.104 [33].\nblackCellsToAddModListEUTRAN\tList of cells to add/ modify in the black list of cells.\nblackCellsToRemoveListEUTRAN\tList of cells to remove from the black list of cells.\ncarrierFreq\tIdentifies EUTRA carrier frequency for which this configuration is valid. E-UTRAN does not configure more than one measurement object for the same physical frequency regardless of the E-ARFCN used to indicate this.\ncellsToAddModListEUTRAN\tList of cells to add/ modify in the cell list.\ncellsToRemoveListEUTRAN\tList of cells to remove from the cell list.\neutra-PresenceAntennaPort1\tWhen set to true, the UE may assume that at least two cell-specific antenna ports are used in all neighbouring cells.\neutra-Q-OffsetRange\tUsed to indicate a cell, or frequency specific offset to be applied when evaluating candidates when evaluating triggering conditions for measurement reporting. The value is in dB. Value dB-24 corresponds to -24 dB, value dB-22 corresponds to -22 dB and so on.\nwidebandRSRQ-Meas\tIf set to true, the UE shall, when performing RSRQ measurements, use a wider bandwidth in accordance with TS 36.133 [40]. The network may set the field to true if the measurement bandwidth indicated by allowedMeasBandwidth is 50 resource blocks or larger; otherwise the network sets this field to false.\n\n\u2013\tMeasObjectId\nThe IE MeasObjectId used to identify a measurement object configuration.\nMeasObjectId information element\n-- ASN1START\n-- TAG-MEASOBJECTID-START\n\nMeasObjectId ::=                    INTEGER (1..maxNrofObjectId)\n\n-- TAG-MEASOBJECTID-STOP\n-- ASN1STOP\n\n\u2013\tMeasObjectNR\nThe IE MeasObjectNR specifies information applicable for SS/PBCH block(s) intra/inter-frequency measurements and/or CSI-RS intra/inter-frequency measurements.\nMeasObjectNR information element\n-- ASN1START\n-- TAG-MEASOBJECTNR-START\n\nMeasObjectNR ::=                    SEQUENCE {\n    ssbFrequency                        ARFCN-ValueNR                                           OPTIONAL,   -- Cond SSBorAssociatedSSB\n    ssbSubcarrierSpacing                SubcarrierSpacing                                       OPTIONAL,   -- Cond SSBorAssociatedSSB\n    smtc1                               SSB-MTC                                                 OPTIONAL,   -- Cond SSBorAssociatedSSB\n    smtc2                               SSB-MTC2                                                OPTIONAL,   -- Cond IntraFreqConnected\n    refFreqCSI-RS                       ARFCN-ValueNR                                           OPTIONAL,   -- Cond CSI-RS\n    referenceSignalConfig               ReferenceSignalConfig,\n    absThreshSS-BlocksConsolidation     ThresholdNR                                                     OPTIONAL,   -- Need R\n    absThreshCSI-RS-Consolidation       ThresholdNR                                                     OPTIONAL,   -- Need R\n    nrofSS-BlocksToAverage              INTEGER (2..maxNrofSS-BlocksToAverage)                          OPTIONAL,   -- Need R\n    nrofCSI-RS-ResourcesToAverage       INTEGER (2..maxNrofCSI-RS-ResourcesToAverage)                   OPTIONAL,   -- Need R\n    quantityConfigIndex                 INTEGER (1..maxNrofQuantityConfig),\n    offsetMO                            Q-OffsetRangeList,\n    cellsToRemoveList                   PCI-List                                                        OPTIONAL,   -- Need N\n    cellsToAddModList                   CellsToAddModList                                               OPTIONAL,   -- Need N\n    blackCellsToRemoveList              PCI-RangeIndexList                                              OPTIONAL,   -- Need N\n    blackCellsToAddModList              SEQUENCE (SIZE (1..maxNrofPCI-Ranges)) OF PCI-RangeElement      OPTIONAL,   -- Need N\n    whiteCellsToRemoveList              PCI-RangeIndexList                                              OPTIONAL,   -- Need N\n    whiteCellsToAddModList              SEQUENCE (SIZE (1..maxNrofPCI-Ranges)) OF PCI-RangeElement      OPTIONAL,   -- Need N\n    ... ,\n    [[\n    freqBandIndicatorNR-v1530           FreqBandIndicatorNR                                             OPTIONAL,   -- Need R\n    measCycleSCell-v1530                ENUMERATED {sf160, sf256, sf320, sf512, sf640, sf1024, sf1280}  OPTIONAL    -- Need R\n    ]]\n}\n\nReferenceSignalConfig::=            SEQUENCE {\n    ssb-ConfigMobility                  SSB-ConfigMobility                                              OPTIONAL,   -- Need M\n    csi-rs-ResourceConfigMobility       SetupRelease { CSI-RS-ResourceConfigMobility }                  OPTIONAL    -- Need M\n}\n\nSSB-ConfigMobility::=               SEQUENCE {\n\n    ssb-ToMeasure                           SetupRelease { SSB-ToMeasure }                              OPTIONAL,   -- Need M\n    deriveSSB-IndexFromCell             BOOLEAN,\n    ss-RSSI-Measurement                         SS-RSSI-Measurement                                     OPTIONAL,   -- Need M\n    ...\n}\n\n\nQ-OffsetRangeList ::=               SEQUENCE {\n    rsrpOffsetSSB                       Q-OffsetRange               DEFAULT dB0,\n    rsrqOffsetSSB                       Q-OffsetRange               DEFAULT dB0,\n    sinrOffsetSSB                       Q-OffsetRange               DEFAULT dB0,\n    rsrpOffsetCSI-RS                    Q-OffsetRange               DEFAULT dB0,\n    rsrqOffsetCSI-RS                    Q-OffsetRange               DEFAULT dB0,\n    sinrOffsetCSI-RS                    Q-OffsetRange               DEFAULT dB0\n}\n\n\nThresholdNR ::=                     SEQUENCE{\n    thresholdRSRP                       RSRP-Range                                                      OPTIONAL,   -- Need R\n    thresholdRSRQ                       RSRQ-Range                                                      OPTIONAL,   -- Need R\n    thresholdSINR                       SINR-Range                                                      OPTIONAL    -- Need R\n}\n\nCellsToAddModList ::=               SEQUENCE (SIZE (1..maxNrofCellMeas)) OF CellsToAddMod\n\nCellsToAddMod ::=                   SEQUENCE {\n    physCellId                          PhysCellId,\n    cellIndividualOffset                Q-OffsetRangeList\n}\n\n\n\n\n-- TAG-MEASOBJECTNR-STOP\n-- ASN1STOP\n\nCellsToAddMod field descriptions\ncellIndividualOffset\tCell individual offsets applicable to a specific cell.\nphysCellId\tPhysical cell identity of a cell in the cell list.\n\nMeasObjectNR field descriptions\nabsThreshCSI-RS-Consolidation\tAbsolute threshold for the consolidation of measurement results per CSI-RS resource(s) from L1 filter(s). The field is used for the derivation of cell measurement results as described in 5.5.3.3 and the reporting of beam measurement information per CSI-RS resource as described in 5.5.5.2.\nabsThreshSS-BlocksConsolidation\tAbsolute threshold for the consolidation of measurement results per SS/PBCH block(s) from L1 filter(s). The field is used for the derivation of cell measurement results as described in 5.5.3.3 and the reporting of beam measurement information per SS/PBCH block index as described in 5.5.5.2.\nblackCellsToAddModList\tList of cells to add/modify in the black list of cells. It applies only to SSB resources.\nblackCellsToRemoveList\tList of cells to remove from the black list of cells.\ncellsToAddModList\tList of cells to add/modify in the cell list.\ncellsToRemoveList\tList of cells to remove from the cell list. \nfreqBandIndicatorNR\tThe frequency band in which the SSB and/or CSI-RS indicated in this MeasObjectNR are located and according to which the UE shall perform the RRM measurements. This field is always provided when the network configures measurements with this MeasObjectNR.\nmeasCycleSCell\tThe parameter is used only when an SCell is configured on the frequency indicated by the measObjectNR and is in deactivated state, see TS 38.133 [14]. gNB configures the parameter whenever an SCell is configured on the frequency indicated by the measObjectNR, but the field may also be signalled when an SCell is not configured. Value sf160 corresponds to 160 sub-frames, value sf256 corresponds to 256 sub-frames and so on.\nnrofCSInrofCSI-RS-ResourcesToAverage\tIndicates the maximum number of measurement results per beam based on CSI-RS resources to be averaged. The same value applies for each detected cell associated with this MeasObjectNR.\nnrofSS-BlocksToAverage\tIndicates the maximum number of measurement results per beam based on SS/PBCH blocks to be averaged. The same value applies for each detected cell associated with this MeasObject.\noffsetMO\tOffset values applicable to all measured cells with reference signal(s) indicated in this MeasObjectNR.\nquantityConfigIndex\tIndicates the n-th element of quantityConfigNR-List provided in MeasConfig.\nreferenceSignalConfig\tRS configuration for SS/PBCH block and CSI-RS.\nrefFreqCSI-RS\tPoint A which is used for mapping of CSI-RS to physical resources according to TS 38.211 [16] clause 7.4.1.5.3.\nsmtc1\tPrimary measurement timing configuration. (see clause 5.5.2.10).\nsmtc2\tSecondary measurement timing configuration for SS corresponding to this MeasObjectNR with PCI listed in pci-List. For these SS, the periodicity is indicated by periodicity in smtc2 and the timing offset is equal to the offset indicated in periodicityAndOffset modulo periodicity. periodicity in smtc2 can only be set to a value strictly shorter than the periodicity indicated by periodicityAndOffset in smtc1 (e.g. if periodicityAndOffset indicates sf10, periodicity can only be set of sf5, if periodicityAndOffset indicates sf5, smtc2 cannot be configured).\nssbFrequency\nIndicates the frequency of the SS associated to this MeasObjectNR.\nssbSubcarrierSpacing\tSubcarrier spacing of SSB. Only the values 15 kHz or 30 kHz (<6GHz), 120 kHz or 240 kHz (>6GHz) are applicable.\nwhiteCellsToAddModList\tList of cells to add/modify in the white list of cells. It applies only to SSB resources.\nwhiteCellsToRemoveList\tList of cells to remove from the white list of cells.\n\nReferenceSignalConfig field descriptions\ncsi-rs-ResourceConfigMobility\tCSI-RS resources to be used for CSI-RS based RRM measurements.\nssb-ConfigMobility\tSSB configuration for mobility (nominal SSBs, timing configuration).\n\nSSB-ConfigMobility field descriptions\nderiveSSB-IndexFromCell\tIf this field is set to true, UE assumes SFN and frame boundary alignment across cells on the same frequency carrier as specified in TS 38.133 [14]. Hence, if the UE is configured with a serving cell for which (absoluteFrequencySSB, subcarrierSpacing) in ServingCellConfigCommon is equal to (ssbFrequency, ssbSubcarrierSpacing) in this MeasObjectNR, this field indicates whether the UE can utilize the timing of this serving cell to derive the index of SS block transmitted by neighbour cell. Otherwise, this field indicates whether the UE may use the timing of any detected cell on that target frequency to derive the SSB index of all neighbour cells on that frequency.\nssb-ToMeasure\tThe set of SS blocks to be measured within the SMTC measurement duration. The first/leftmost bit corresponds to SS/PBCH block index 0, the second bit corresponds to SS/PBCH block index 1, and so on. Value 0 in the bitmap indicates that the corresponding SS/PBCH block is not to be measured while value 1 indicates that the corresponding SS/PBCH block is to be measured (see TS 38.215 [9]). When the field is not configured the UE measures on all SS blocks. Regardless of the value of this field, SS/PBCH blocks outside of the applicable smtc are not to be measured. See TS 38.215 [9] clause 5.1.1.\n\nConditional Presence\tExplanation\nCSI-RS\tThis field is mandatory present if csi-rs-ResourceConfigMobility is configured, otherwise, it is absent. \nSSBorAssociatedSSB\nIntraFreqConnected\tThis field is optionally present, Need R if the UE is configured with a serving cell for which (absoluteFrequencySSB, subcarrierSpacing) in ServingCellConfigCommon is equal to (ssbFrequency, ssbSubcarrierSpacing) in this MeasObjectNR, otherwise, it is absent. \n\n\u2013\tMeasObjectToAddModList\nThe IE MeasObjectToAddModList concerns a list of measurement objects to add or modify.\nMeasObjectToAddModList information element\n-- ASN1START\n-- TAG-MEASOBJECTTOADDMODLIST-START\n\nMeasObjectToAddModList ::=                  SEQUENCE (SIZE (1..maxNrofObjectId)) OF MeasObjectToAddMod\n\nMeasObjectToAddMod ::=                      SEQUENCE {\n    measObjectId                                MeasObjectId,\n    measObject                                  CHOICE {\n        measObjectNR                                MeasObjectNR,\n        ... ,\n        measObjectEUTRA                             MeasObjectEUTRA\n    }\n}\n\n-- TAG-MEASOBJECTTOADDMODLIST-STOP\n-- ASN1STOP\n\n\u2013\tMeasResultCellListSFTD\nThe IE MeasResultCellListSFTD consists of SFN and radio frame boundary difference between the PCell and an NR cell as specified in TS 38.215 [9] and TS 38.133 [14].\nMeasResultCellListSFTD information element\n-- ASN1START\n-- TAG-MEASRESULTCELLLISTSFTD-START\n\nMeasResultCellListSFTD ::=          SEQUENCE (SIZE (1..maxCellSFTD)) OF MeasResultCellSFTD\n\nMeasResultCellSFTD ::=              SEQUENCE {\n    physCellId                          PhysCellId,\n    sfn-OffsetResult                    INTEGER (0..1023),\n    frameBoundaryOffsetResult           INTEGER (-30720..30719),\n    rsrp-Result                         RSRP-Range                      OPTIONAL\n}\n\n-- TAG-MEASRESULTCELLLISTSFTD-STOP\n-- ASN1STOP\n\nMeasResultSFTD field descriptions\nsfn-OffsetResult\tIndicates the SFN difference between the PCell and the NR cell as an integer value according to TS 38.215 [9].\nframeBoundaryOffsetResult\tIndicates the frame boundary difference between the PCell and the NR cell as an integer value according to TS 38.215 [9].\n\n\u2013\tMeasResults\nThe IE MeasResults covers measured results for intra-frequency, inter-frequency, and inter-RAT mobility.\nMeasResults information element\n-- ASN1START\n-- TAG-MEASRESULTS-START\n\nMeasResults ::=                         SEQUENCE {\n    measId                                  MeasId,\n    measResultServingMOList                 MeasResultServMOList,\n    measResultNeighCells                    CHOICE {\n        measResultListNR                        MeasResultListNR,\n        ...,\n        measResultListEUTRA                     MeasResultListEUTRA\n    }                                                                                                                   OPTIONAL,\n    ...\n}\n\nMeasResultServMOList ::=                SEQUENCE (SIZE (1..maxNrofServingCells)) OF MeasResultServMO\n\nMeasResultServMO ::=                    SEQUENCE {\n    servCellId                              ServCellIndex,\n    measResultServingCell                   MeasResultNR,\n    measResultBestNeighCell                 MeasResultNR                                                                OPTIONAL,\n    ...\n}\n\nMeasResultListNR ::=                    SEQUENCE (SIZE (1..maxCellReport)) OF MeasResultNR\n\nMeasResultNR ::=                        SEQUENCE {\n    physCellId                              PhysCellId                                                                  OPTIONAL,\n    measResult                              SEQUENCE {\n        cellResults                             SEQUENCE{\n            resultsSSB-Cell                         MeasQuantityResults                                                 OPTIONAL,\n            resultsCSI-RS-Cell                      MeasQuantityResults                                                 OPTIONAL\n        },\n        rsIndexResults                          SEQUENCE{\n            resultsSSB-Indexes                      ResultsPerSSB-IndexList                                             OPTIONAL,\n            resultsCSI-RS-Indexes                   ResultsPerCSI-RS-IndexList                                          OPTIONAL\n        }                                                                                                               OPTIONAL\n    },\n    ...,\n    [[\n    cgi-Info                                CGI-Info                                                                    OPTIONAL\n    ]]\n}\n\nMeasResultListEUTRA ::=                 SEQUENCE (SIZE (1..maxCellReport)) OF MeasResultEUTRA\n\nMeasResultEUTRA ::=                     SEQUENCE {\n    eutra-PhysCellId                        PhysCellId,\n    measResult                              MeasQuantityResultsEUTRA,\n\n    cgi-Info                                SEQUENCE {\n        cgi-info-EPC                            SEQUENCE {\n            cgi-info-EPC-legacy                     CellAccessRelatedInfo-EUTRA-EPC,\n            cgi-info-EPC-list                       SEQUENCE (SIZE (1..maxPLMN)) OF CellAccessRelatedInfo-EUTRA-EPC     OPTIONAL\n        }                                                                                                               OPTIONAL,\n\n        cgi-info-5GC                            SEQUENCE (SIZE (1..maxPLMN)) OF CellAccessRelatedInfo-EUTRA-5GC         OPTIONAL,\n        freqBandIndicator                       FreqBandIndicatorEUTRA,\n        multiBandInfoList                       MultiBandInfoListEUTRA                                                  OPTIONAL,\n        freqBandIndicatorPriority               ENUMERATED {true}                                                       OPTIONAL\n    }                                                                                                                   OPTIONAL,\n    ...\n}\n\nMultiBandInfoListEUTRA ::=              SEQUENCE (SIZE (1..maxMultiBands)) OF FreqBandIndicatorEUTRA\n\nMeasQuantityResults ::=                 SEQUENCE {\n    rsrp                                    RSRP-Range                                                                  OPTIONAL,\n    rsrq                                    RSRQ-Range                                                                  OPTIONAL,\n    sinr                                    SINR-Range                                                                  OPTIONAL\n}\n\n\nMeasQuantityResultsEUTRA ::=            SEQUENCE {\n    rsrp                                    RSRP-RangeEUTRA                                                             OPTIONAL,\n    rsrq                                    RSRQ-RangeEUTRA                                                             OPTIONAL,\n    sinr                                    SINR-RangeEUTRA                                                             OPTIONAL\n}\n\n\nResultsPerSSB-IndexList::=              SEQUENCE (SIZE (1..maxNrofIndexesToReport2)) OF ResultsPerSSB-Index\n\nResultsPerSSB-Index ::=                 SEQUENCE {\n    ssb-Index                               SSB-Index,\n    ssb-Results                             MeasQuantityResults                                                         OPTIONAL\n}\n\nResultsPerCSI-RS-IndexList::=           SEQUENCE (SIZE (1..maxNrofIndexesToReport2)) OF ResultsPerCSI-RS-Index\n\nResultsPerCSI-RS-Index ::=              SEQUENCE {\n    csi-RS-Index                            CSI-RS-Index,\n    csi-RS-Results                          MeasQuantityResults                                                         OPTIONAL\n}\n\n-- TAG-MEASRESULTS-STOP\n-- ASN1STOP\n\nMeasResultEUTRA field descriptions\ncgi-info-5GC\tThis field includes the cellAccessRelatedInfo-5GC-r15 of TS 36.331 [10].\ncgi-info-EPC-legacy\tThis field includes the cellAccessRelatedInfo of TS 36.331 [10]. \ncgi-info-EPC-list\tThis field includes the cellAccessRelatedInfoList-r14 of TS 36.331 [10].\nfreqBandIndicatorPriority\tThis field includes the freqBandIndicatorPriority-r12 of TS 36.331 [10]\neutra-PhysCellId\tIdentifies the physical cell identity of the E-UTRA cell for which the reporting is being performed. The UE reports a value in the range 0..503, other values are reserved.\n\nMeasResultNR field descriptions\ncellResults\tCell level measurement results.\nphysCellId\tThe physical cell identity of the NR cell cell for which the reporting is being performed.\nresultsSSB-Cell\tCell level measurement results based on SS/PBCH related measurements.\nresultsSSB-Indexes\tBeam level measurement results based on SS/PBCH related measurements.\nresultsCSI-RS-Cell\tCell level measurement results based on CSI-RS related measurements.\nresultsCSI-RS-Indexes\tBeam level measurement results based on CSI-RS related measurements.\nrsIndexResults\tBeam level measurement results.\n\nMeasResults field descriptions\nmeasId\tIdentifies the measurement identity for which the reporting is being performed.\nmeasResultEUTRA\tMeasured results of an E-UTRA cell.\nmeasResultListEUTRA\tList of measured results for the maximum number of reported best cells for an E-UTRA measurement identity.\nmeasResultListNR\tList of measured results for the maximum number of reported best cells for an NR measurement identity.\nmeasResultNR\tMeasured results of an NR cell.\nmeasResultServingMOList\tMeasured results of measured cells with reference signals indicated in the serving cell measurement objects including measurement results of SpCell, configured SCell(s) and best neighbouring cell within measured cells with reference signals indicated in on each serving cell measurement object.\n\n\u2013\tMeasResultSCG-Failure\nThe IE MeasResultSCG-Failure is used to provide information regarding failures detected by the UE in EN-DC.\nMeasResultSCG-Failure information element\n-- ASN1START\n-- TAG-MEASRESULTSCG-FAILURE-START\n\nMeasResultSCG-Failure ::=           SEQUENCE {\n    measResultPerMOList                 MeasResultList2NR,\n    ...\n}\n\nMeasResultList2NR ::=               SEQUENCE (SIZE (1..maxFreq)) OF MeasResult2NR\n\nMeasResult2NR ::=                   SEQUENCE {\n    ssbFrequency                        ARFCN-ValueNR                           OPTIONAL,\n    refFreqCSI-RS                       ARFCN-ValueNR                           OPTIONAL,\n    measResultServingCell               MeasResultNR                            OPTIONAL,\n    measResultNeighCellListNR           MeasResultListNR                        OPTIONAL,\n    ...\n}\n\n-- TAG-MEASRESULTSCG-FAILURE-STOP\n-- ASN1STOP\n\n\u2013\tMobilityStateParameters\nThe IE MobilityStateParameters contains parameters to determine UE mobility state.\nMobilityStateParameters information element\n-- ASN1START\n-- TAG-MOBILITYSTATEPARAMETERS-START\n\nMobilityStateParameters ::=         SEQUENCE{\n    t-Evaluation                        ENUMERATED {\n                                            s30, s60, s120, s180, s240, spare3, spare2, spare1},\n    t-HystNormal                        ENUMERATED {\n                                            s30, s60, s120, s180, s240, spare3, spare2, spare1},\n    n-CellChangeMedium                  INTEGER (1..16),\n    n-CellChangeHigh                    INTEGER (1..16)\n}\n\n-- TAG-MOBILITYSTATEPARAMETERS-STOP\n-- ASN1STOP\n\nMobilityStateParameters field descriptions\nn-CellChangeHigh\tThe number of cell changes to enter high mobility state. Corresponds to NCR_H in TS 38.304 [20].\nn-CellChangeMedium\tThe number of cell changes to enter medium mobility state. Corresponds to NCR_M in TS 38.304 [20].\nt-Evaluation\tThe duration for evaluating criteria to enter mobility states. Corresponds to TCRmax in TS 38.304 [20]. Value in seconds, s30 corresponds to 30 s and so on.\nt-HystNormal\tThe additional duration for evaluating criteria to enter normal mobility state. Corresponds to TCRmaxHyst in TS 38.304 [20]. Value in seconds, value s30 corresponds to 30 seconds and so on.\n\n\u2013\tMultiFrequencyBandListNR\nThe IE MultiFrequencyBandListNR is used to configure a list of one or multiple NR frequency bands.\nMultiFrequencyBandListNR information element\n-- ASN1START\n-- TAG-MULTIFREQUENCYBANDLISTNR-START\n\nMultiFrequencyBandListNR ::=        SEQUENCE (SIZE (1..maxNrofMultiBands)) OF FreqBandIndicatorNR\n\n-- TAG-MULTIFREQUENCYBANDLISTNR-STOP\n-- ASN1STOP\n\n\u2013\tMultiFrequencyBandListNR-SIB\nThe IE MultiFrequencyBandListNR-SIB indicates the list of frequency bands, for which cell (re-)selection parameters are common, and a list of additionalPmax and additionalSpectrumEmission.\nMultiFrequencyBandListNR-SIB information element\n-- ASN1START\n-- TAG-MULTIFREQUENCYBANDLISTNR-SIB-START\n\nMultiFrequencyBandListNR-SIB ::=            SEQUENCE (SIZE (1.. maxNrofMultiBands)) OF NR-MultiBandInfo\n\nNR-MultiBandInfo ::=                        SEQUENCE {\n            freqBandIndicatorNR                 FreqBandIndicatorNR         OPTIONAL,   -- Cond OptULNotSIB2\n            nr-NS-PmaxList                      NR-NS-PmaxList              OPTIONAL    -- Need S\n}\n\n-- TAG-MULTIFREQUENCYBANDLISTNR-SIB-STOP\n-- ASN1STOP\n\nNR-MultiBandInfo field descriptions\nfreqBandIndicatorNR\tProvides an NR frequency band number as defined in TS 38.101-1 [15], table 5.2-1.\nnr-NS-PmaxList\tProvides a list of additionalPmax and additionalSpectrumEmission values as defined in TS 38.101-1 [15], table 6.2.3-1. If the field is absent the UE uses value 0 for the additionalSpectrumEmission (see Table 6.2.3-1A in TS 38.101-1 [15]).\n\nConditional Presence\tExplanation\nOptULNotSIB2\tThe field is not present for SIB2 and is mandatory present in SIB4 and frequencyInfoDL-SIB. Otherwise, if the field is not present in frequencyInfoUL-SIB in UplinkConfigCommonSIB, the UE will use the frequency band indicated in frequencyInfoDL-SIB in DownlinkConfigCommonSIB. \n\n\u2013\tNextHopChainingCount\nThe IE NextHopChainingCount is used to update the KgNB key and corresponds to parameter NCC: See TS 33.501 [11].\nNextHopChainingCount information element\n-- ASN1START\n-- TAG-NEXTHOPCHAININGCOUNT-START\n\nNextHopChainingCount ::=                    INTEGER (0..7)\n\n-- TAG-NEXTHOPCHAININGCOUNT-STOP\n-- ASN1STOP\n\n\u2013\tNG-5G-S-TMSI\nThe IE NG-5G-S-TMSI contains a 5G S-Temporary Mobile Subscription Identifier (5G-S-TMSI), a temporary UE identity provided by the 5GC which uniquely identifies the UE within the tracking area, see TS 23.003 [21].\nNG-5G-S-TMSI information element\n-- ASN1START\n-- TAG-NG-5G-S-TMSI-START\n\nNG-5G-S-TMSI ::=                         BIT STRING (SIZE (48))\n\n-- TAG-NG-5G-S-TMSI-STOP\n-- ASN1STOP\n\n\u2013\tNR-NS-PmaxList\nThe IE NR-NS-PmaxList is used to configure a list of additionalPmax and additionalSpectrumEmission, as defined in TS 38.101-1 [15], table 6.2.3-1 for a given frequency band.\nNR-NS-PmaxList information element\n-- ASN1START\n-- TAG-NR-NS-PMAXLIST-START\n\nNR-NS-PmaxList ::=                          SEQUENCE (SIZE (1..maxNR-NS-Pmax)) OF NR-NS-PmaxValue\n\nNR-NS-PmaxValue ::=                     SEQUENCE {\n    additionalPmax                          P-Max                               OPTIONAL,   -- Need N\n    additionalSpectrumEmission              AdditionalSpectrumEmission\n}\n\n-- TAG-NR-NS-PMAXLIST-STOP\n-- ASN1STOP\n\n\u2013\tNZP-CSI-RS-Resource\nThe IE NZP-CSI-RS-Resource is used to configure Non-Zero-Power (NZP) CSI-RS transmitted in the cell where the IE is included, which the UE may be configured to measure on (see TS 38.214 [19], clause 5.2.2.3.1).\nNZP-CSI-RS-Resource information element\n-- ASN1START\n-- TAG-NZP-CSI-RS-RESOURCE-START\n\nNZP-CSI-RS-Resource ::=             SEQUENCE {\n    nzp-CSI-RS-ResourceId               NZP-CSI-RS-ResourceId,\n    resourceMapping                     CSI-RS-ResourceMapping,\n    powerControlOffset                  INTEGER (-8..15),\n    powerControlOffsetSS                ENUMERATED{db-3, db0, db3, db6}                 OPTIONAL,   -- Need R\n    scramblingID                        ScramblingId,\n    periodicityAndOffset                CSI-ResourcePeriodicityAndOffset                OPTIONAL,   -- Cond PeriodicOrSemiPersistent\n    qcl-InfoPeriodicCSI-RS              TCI-StateId                                     OPTIONAL,   -- Cond Periodic\n    ...\n}\n\n-- TAG-NZP-CSI-RS-RESOURCE-STOP\n-- ASN1STOP\n\nNZP-CSI-RS-Resource field descriptions\nperiodicityAndOffset\npowerControlOffset\tPower offset of PDSCH RE to NZP CSI-RS RE. Value in dB (see TS 38.214 [19], clauses 5.2.2.3.1 and 4.1).\npowerControlOffsetSS\tPower offset of NZP CSI-RS RE to SSS RE. Value in dB (see TS 38.214 [19], clause 5.2.2.3.1).\nqcl-InfoPeriodicCSI-RS\tFor a target periodic CSI-RS, contains a reference to one TCI-State in TCI-States for providing the QCL source and QCL type. For periodic CSI-RS, the source can be SSB or another periodic-CSI-RS. Refers to the TCI-State which has this value for tci-StateId and is defined in tci-StatesToAddModList in the PDSCH-Config included in the BWP-Downlink corresponding to the serving cell and to the DL BWP to which the resource belongs to (see TS 38.214 [19], clause 5.2.2.3.1).\nresourceMapping\tOFDM symbol location(s) in a slot and subcarrier occupancy in a PRB of the CSI-RS resource.\nscramblingID\tScrambling ID (see TS 38.214 [19], clause 5.2.2.3.1).\n\nConditional Presence\tExplanation\nPeriodic\tThe field is optionally present, Need M, for periodic NZP-CSI-RS-Resources (as indicated in CSI-ResourceConfig). The field is absent otherwise.  \nPeriodicOrSemiPersistent\tThe field is optionally present, Need M, for periodic and semi-persistent NZP-CSI-RS-Resources (as indicated in CSI-ResourceConfig). The field is absent otherwise.  \n\n\u2013\tNZP-CSI-RS-ResourceId\nThe IE NZP-CSI-RS-ResourceId is used to identify one NZP-CSI-RS-Resource.\nNZP-CSI-RS-ResourceId information element\n-- ASN1START\n-- TAG-NZP-CSI-RS-RESOURCEID-START\n\nNZP-CSI-RS-ResourceId ::=           INTEGER (0..maxNrofNZP-CSI-RS-Resources-1)\n\n-- TAG-NZP-CSI-RS-RESOURCEID-STOP\n-- ASN1STOP\n\n\u2013\tNZP-CSI-RS-ResourceSet\nThe IE NZP-CSI-RS-ResourceSet is a set of Non-Zero-Power (NZP) CSI-RS resources (their IDs) and set-specific parameters.\nNZP-CSI-RS-ResourceSet information element\n-- ASN1START\n-- TAG-NZP-CSI-RS-RESOURCESET-START\nNZP-CSI-RS-ResourceSet ::=          SEQUENCE {\n    nzp-CSI-ResourceSetId               NZP-CSI-RS-ResourceSetId,\n    nzp-CSI-RS-Resources                SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourcesPerSet)) OF NZP-CSI-RS-ResourceId,\n    repetition                          ENUMERATED { on, off }                                                  OPTIONAL,   -- Need S\n    aperiodicTriggeringOffset           INTEGER(0..6)                                                           OPTIONAL,   -- Need S\n    trs-Info                            ENUMERATED {true}                                                       OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-NZP-CSI-RS-RESOURCESET-STOP\n-- ASN1STOP\n\nNZP-CSI-RS-ResourceSet field descriptions\naperiodicTriggeringOffset\tOffset X between the slot containing the DCI that triggers a set of aperiodic NZP CSI-RS resources and the slot in which the CSI-RS resource set is transmitted. The value 0 corresponds to 0 slots, value 1 corresponds to 1 slot, value 2 corresponds to 2 slots, value 3 corresponds to 3 slots, value 4 corresponds to 4 slots, value 5 corresponds to 16 slots, value 6 corresponds to 24 slots. When the field is absent the UE applies the value 0.\nnzp-CSI-RS-Resources\tNZP-CSI-RS-Resources associated with this NZP-CSI-RS resource set (see TS 38.214 [19], clause 5.2). For CSI, there are at most 8 NZP CSI RS resources per resource set.\nrepetition\tIndicates whether repetition is on/off. If the field is set to off or if the field is absent, the UE may not assume that the NZP-CSI-RS resources within the resource set are transmitted with the same downlink spatial domain transmission filter and with same NrofPorts in every symbol (see TS 38.214 [19], clauses 5.2.2.3.1 and 5.1.6.1.2). Can only be configured for CSI-RS resource sets which are associated with CSI-ReportConfig with report of L1 RSRP or \"no report\".\ntrs-Info\tIndicates that the antenna port for all NZP-CSI-RS resources in the CSI-RS resource set is same. If the field is absent or released the UE applies the value false (see TS 38.214 [19], clause 5.2.2.3.1).\n\n\u2013\tNZP-CSI-RS-ResourceSetId\nThe IE NZP-CSI-RS-ResourceSetId is used to identify one NZP-CSI-RS-ResourceSet.\nNZP-CSI-RS-ResourceSetId information element\n-- ASN1START\n-- TAG-NZP-CSI-RS-RESOURCESETID-START\n\nNZP-CSI-RS-ResourceSetId ::=        INTEGER (0..maxNrofNZP-CSI-RS-ResourceSets-1)\n\n-- TAG-NZP-CSI-RS-RESOURCESETID-STOP\n-- ASN1STOP\n\n\u2013\tP-Max\nThe IE P-Max is used to limit the UE's uplink transmission power on a carrier frequency, in TS 38.101-1 [15] and is used to calculate the parameter Pcompensation defined in TS 38.304 [20].\nP-Max information element\n-- ASN1START\n-- TAG-P-MAX-START\n\nP-Max ::=                           INTEGER (-30..33)\n\n-- TAG-P-MAX-STOP\n-- ASN1STOP\n\n\u2013\tPCI-List\nThe IE PCI-List concerns a list of physical cell identities, which may be used for different purposes.\nPCI-List information element\n-- ASN1START\n-- TAG-PCI-LIST-START\n\nPCI-List ::=                        SEQUENCE (SIZE (1..maxNrofCellMeas)) OF PhysCellId\n\n-- TAG-PCI-LIST-STOP\n-- ASN1STOP\n\n\u2013\tPCI-Range\nThe IE PCI-Range is used to encode either a single or a range of physical cell identities. The range is encoded by using a start value and by indicating the number of consecutive physical cell identities (including start) in the range. For fields comprising multiple occurrences of PCI-Range, the Network may configure overlapping ranges of physical cell identities.\nPCI-Range information element\n-- ASN1START\n-- TAG-PCI-RANGE-START\n\nPCI-Range ::=                       SEQUENCE {\n    start                               PhysCellId,\n    range                               ENUMERATED {n4, n8, n12, n16, n24, n32, n48, n64, n84,\n                                                    n96, n128, n168, n252, n504, n1008,spare1}                  OPTIONAL    -- Need S\n}\n\n-- TAG-PCI-RANGE-STOP\n-- ASN1STOP\n\nPCI-Range field descriptions\nrange\tIndicates the number of physical cell identities in the range (including start). Value n4 corresponds with 4, value n8 corresponds with 8 and so on. The UE shall apply value 1 in case the field is absent, in which case only the physical cell identity value indicated by start applies.\nstart\tIndicates the lowest physical cell identity in the range.\n\n\u2013\tPCI-RangeElement\nThe IE PCI-RangeElement is used to define a PCI-Range as part of a list (e.g. AddMod list).\nPCI-RangeElement information element\n-- ASN1START\n-- TAG-PCI-RANGEELEMENT-START\n\nPCI-RangeElement ::=                SEQUENCE {\n    pci-RangeIndex                      PCI-RangeIndex,\n    pci-Range                           PCI-Range\n}\n\n-- TAG-PCI-RANGEELEMENT-STOP\n-- ASN1STOP\n\nPCI-RangeElement field descriptions\npci-Range\tPhysical cell identity or a range of physical cell identities.\n\n\u2013\tPCI-RangeIndex\nThe IE PCI-RangeIndex identifies a physical cell id range, which may be used for different purposes.\nPCI-RangeIndex information element\n-- ASN1START\n-- TAG-PCI-RANGEINDEX-START\n\nPCI-RangeIndex ::=                  INTEGER (1..maxNrofPCI-Ranges)\n\n-- TAG-PCI-RANGEINDEX-STOP\n-- ASN1STOP\n\n\u2013\tPCI-RangeIndexList\nThe IE PCI-RangeIndexList concerns a list of indexes of physical cell id ranges, which may be used for different purposes.\nPCI-RangeIndexList information element\n-- ASN1START\n-- TAG-PCI-RANGEINDEXLIST-START\n\nPCI-RangeIndexList ::=              SEQUENCE (SIZE (1..maxNrofPCI-Ranges)) OF PCI-RangeIndex\n\n-- TAG-PCI-RANGEINDEXLIST-STOP\n-- ASN1STOP\n\n\u2013\tPDCCH-Config\nThe IE PDCCH-Config is used to configure UE specific PDCCH parameters such as control resource sets (CORESET), search spaces and additional parameters for acquiring the PDCCH. If this IE is used for the scheduled cell in case of cross carrier scheduling, the fields other than searchSpacesToAddModList and searchSpaceToReleaseList are absent.\nPDCCH-Config information element\n-- ASN1START\n-- TAG-PDCCH-CONFIG-START\n\nPDCCH-Config ::=                    SEQUENCE {\n    controlResourceSetToAddModList      SEQUENCE(SIZE (1..3)) OF ControlResourceSet                 OPTIONAL,   -- Need N\n    controlResourceSetToReleaseList     SEQUENCE(SIZE (1..3)) OF ControlResourceSetId               OPTIONAL,   -- Need N\n    searchSpacesToAddModList            SEQUENCE(SIZE (1..10)) OF SearchSpace                       OPTIONAL,   -- Need N\n    searchSpacesToReleaseList           SEQUENCE(SIZE (1..10)) OF SearchSpaceId                     OPTIONAL,   -- Need N\n    downlinkPreemption                  SetupRelease { DownlinkPreemption }                         OPTIONAL,   -- Need M\n    tpc-PUSCH                           SetupRelease { PUSCH-TPC-CommandConfig }                    OPTIONAL,   -- Need M\n    tpc-PUCCH                           SetupRelease { PUCCH-TPC-CommandConfig }                    OPTIONAL,   -- Cond PUCCH-CellOnly\n    tpc-SRS                             SetupRelease { SRS-TPC-CommandConfig}                       OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-PDCCH-CONFIG-STOP\n-- ASN1STOP\n\nPDCCH-Config field descriptions\ncontrolResourceSetToAddModList\tList of UE specifically configured Control Resource Sets (CORESETs) to be used by the UE. The network configures at most 3 CORESETs per BWP per cell (including UE-specific and common CORESETs). In case network reconfigures control resource set with the same ControlResourceSetId as used for commonControlResourceSet configured via PDCCH-ConfigCommon, the configuration from PDCCH-Config always takes precedence and should not be updated by the UE based on servingCellConfigCommon.\ndownlinkPreemption\tConfiguration of downlink preemption indications to be monitored in this cell (see TS 38.213 [13], clause 11.2).\nsearchSpacesToAddModList\tList of UE specifically configured Search Spaces. The network configures at most 10 Search Spaces per BWP per cell (including UE-specific and common Search Spaces).\ntpc-PUCCH\ntpc-PUSCH\tEnable and configure reception of group TPC commands for PUSCH.\ntpc-SRS\tEnable and configure reception of group TPC commands for SRS.\n\nConditional Presence\tExplanation\nPUCCH-CellOnly\tThe field is optionally present, Need M, for the PDCCH-Config of an SpCell as well as for PUCCH SCells. The field is absent otherwise. \n\n\u2013\tPDCCH-ConfigCommon\nThe IE PDCCH-ConfigCommon is used to configure cell specific PDCCH parameters provided in SIB as well as in dedicated signalling.\nPDCCH-ConfigCommon information element\n-- ASN1START\n-- TAG-PDCCH-CONFIGCOMMON-START\n\nPDCCH-ConfigCommon ::=              SEQUENCE {\n    controlResourceSetZero              ControlResourceSetZero                                  OPTIONAL,   -- Cond InitialBWP-Only\n    commonControlResourceSet            ControlResourceSet                                      OPTIONAL,   -- Need R\n    searchSpaceZero                     SearchSpaceZero                                         OPTIONAL,   -- Cond InitialBWP-Only\n    commonSearchSpaceList               SEQUENCE (SIZE(1..4)) OF SearchSpace                    OPTIONAL,   -- Need R\n    searchSpaceSIB1                     SearchSpaceId                                           OPTIONAL,   -- Need S\n    searchSpaceOtherSystemInformation   SearchSpaceId                                           OPTIONAL,   -- Need S\n    pagingSearchSpace                   SearchSpaceId                                           OPTIONAL,   -- Need S\n    ra-SearchSpace                      SearchSpaceId                                           OPTIONAL,   -- Need S\n    ...,\n    [[\n    firstPDCCH-MonitoringOccasionOfPO   CHOICE {\n        sCS15KHZoneT                                                             SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..139),\n        sCS30KHZoneT-SCS15KHZhalfT                                               SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..279),\n        sCS60KHZoneT-SCS30KHZhalfT-SCS15KHZquarterT                              SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..559),\n        sCS120KHZoneT-SCS60KHZhalfT-SCS30KHZquarterT-SCS15KHZoneEighthT          SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..1119),\n        sCS120KHZhalfT-SCS60KHZquarterT-SCS30KHZoneEighthT-SCS15KHZoneSixteenthT SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..2239),\n        sCS120KHZquarterT-SCS60KHZoneEighthT-SCS30KHZoneSixteenthT               SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..4479),\n        sCS120KHZoneEighthT-SCS60KHZoneSixteenthT                                SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..8959),\n        sCS120KHZoneSixteenthT                                                   SEQUENCE (SIZE (1..maxPO-perPF)) OF INTEGER (0..17919)\n    }                                                                                                OPTIONAL       -- Cond OtherBWP\n    ]]\n}\n\n-- TAG-PDCCH-CONFIGCOMMON-STOP\n-- ASN1STOP\n\nPDCCH-ConfigCommon field descriptions\ncommonControlResourceSet\tAn additional common control resource set which may be configured and used for any common or UE-specific search space. If the network configures this field, it uses a ControlResourceSetId other than 0 for this ControlResourceSet. The network configures the commonControlResourceSet in SIB1 so that it is contained in the bandwidth of CORESET#0.\ncommonSearchSpaceList\tA list of additional common search spaces. If the network configures this field, it uses the SearchSpaceIds other than 0.\ncontrolResourceSetZero\tParameters of the common CORESET#0 which can be used in any common or UE-specific search spaces. The values are interpreted like the corresponding bits in MIB pdcch-ConfigSIB1. Even though this field is only configured in the initial BWP (BWP#0) controlResourceSetZero can be used in search spaces configured in other DL BWP(s) than the initial DL BWP if the conditions defined in TS 38.213 [13], clause 10 are satisfied.\nfirstPDCCH-MonitoringOccasionOfPO\tIndicates the first PDCCH monitoring occasion of each PO of the PF on this BWP, see TS 38.304 [20].\npagingSearchSpace\tID of the Search space for paging (see TS 38.213 [13], clause 10.1). If the field is absent, the UE does not receive paging in this BWP (see TS 38.213 [13], clause 10).\nra-SearchSpace\tID of the Search space for random access procedure (see TS 38.213 [13], clause 10.1). If the field is absent, the UE does not receive RAR in this BWP. This field is mandatory present in the DL BWP(s) if the conditions described in TS 38.321 [3], subclause 5.15 are met.\nsearchSpaceOtherSystemInformation\tID of the Search space for other system information, i.e., SIB2 and beyond (see TS 38.213 [13], clause 10.1) If the field is absent, the UE does not receive other system information in this BWP.\nsearchSpaceSIB1\tID of the search space for SIB1 message. In the initial DL BWP of the UE\u2032s PCell, the network sets this field to 0. If the field is absent, the UE does not receive SIB1 in this BWP. (see TS 38.213 [13], clause 10)\nsearchSpaceZero\tParameters of the common SearchSpace#0. The values are interpreted like the corresponding bits in MIB pdcch-ConfigSIB1. Even though this field is only configured in the initial BWP (BWP#0), searchSpaceZero can be used in search spaces configured in other DL BWP(s) than the initial DL BWP if the conditions described in TS 38.213 [13], clause 10, are satisfied.\n\nConditional Presence\tExplanation\nInitialBWP-Only\tIf SIB1 is broadcast the field is mandatory present in the PDCCH-ConfigCommon of the initial BWP (BWP#0) in ServingCellConfigCommon; it is absent in other BWPs and when sent in system information. If SIB1 is not broadcast and there is an SSB associated to the cell, the field is optionally present, Need M, in the PDCCH-ConfigCommon of the initial BWP (BWP#0) in ServingCellConfigCommon (still with the same setting for all UEs). In other cases, the field is absent. \nOtherBWP\tThis field is optionally present, Need R, if this BWP is not the initial DL BWP and pagingSearchSpace is configured in this BWP. Otherwise this field is not present.  \n\n\u2013\tPDCCH-ConfigSIB1\nThe IE PDCCH-ConfigSIB1 is used to configure CORESET#0 and search space#0.\nPDCCH-ConfigSIB1 information element\n-- ASN1START\n-- TAG-PDCCH-CONFIGSIB1-START\n\nPDCCH-ConfigSIB1 ::=                SEQUENCE {\n    controlResourceSetZero              ControlResourceSetZero,\n    searchSpaceZero                     SearchSpaceZero\n}\n\n-- TAG-PDCCH-CONFIGSIB1-STOP\n-- ASN1STOP\n\nPDCCH-ConfigSIB1 field descriptions\ncontrolResourceSetZero\tCorresponds to the 4 MSB of RMSI-PDCCH-Config in TS 38.213 [13], clause 13. Determines a common ControlResourceSet (CORESET) with ID #0.\nsearchSpaceZero\tCorresponds to the 4 LSB of RMSI-PDCCH-Config in TS 38.213 [13], clause 13. Determines a common search space with ID #0.\n\n\u2013\tPDCCH-ServingCellConfig\nThe IE PDCCH-ServingCellConfig is used to configure UE specific PDCCH parameters applicable across all bandwidth parts of a serving cell.\nPDCCH-ServingCellConfig information element\n-- ASN1START\n-- TAG-PDCCH-SERVINGCELLCONFIG-START\n\nPDCCH-ServingCellConfig ::=         SEQUENCE {\n    slotFormatIndicator                 SetupRelease { SlotFormatIndicator }                                OPTIONAL,   -- Need M\n    ...\n}\n\n-- TAG-PDCCH-SERVINGCELLCONFIG-STOP\n-- ASN1STOP\n\nPDCCH-ServingCellConfig field descriptions\nslotFormatIndicator\tConfiguration of Slot-Format-Indicators to be monitored in the correspondingly configured PDCCHs of this serving cell.\n\n\u2013\tPDCP-Config\nThe IE PDCP-Config is used to set the configurable PDCP parameters for signalling and data radio bearers.\nPDCP-Config information element\n-- ASN1START\n-- TAG-PDCP-CONFIG-START\n\nPDCP-Config ::=         SEQUENCE {\n    drb                     SEQUENCE {\n        discardTimer            ENUMERATED {ms10, ms20, ms30, ms40, ms50, ms60, ms75, ms100, ms150, ms200,\n                                            ms250, ms300, ms500, ms750, ms1500, infinity}       OPTIONAL, -- Cond Setup\n        pdcp-SN-SizeUL          ENUMERATED {len12bits, len18bits}                               OPTIONAL, -- Cond Setup2\n        pdcp-SN-SizeDL          ENUMERATED {len12bits, len18bits}                               OPTIONAL, -- Cond Setup2\n        headerCompression       CHOICE {\n            notUsed                 NULL,\n            rohc                    SEQUENCE {\n                maxCID                  INTEGER (1..16383)                                      DEFAULT 15,\n                profiles                SEQUENCE {\n                    profile0x0001           BOOLEAN,\n                    profile0x0002           BOOLEAN,\n                    profile0x0003           BOOLEAN,\n                    profile0x0004           BOOLEAN,\n                    profile0x0006           BOOLEAN,\n                    profile0x0101           BOOLEAN,\n                    profile0x0102           BOOLEAN,\n                    profile0x0103           BOOLEAN,\n                    profile0x0104           BOOLEAN\n                },\n                drb-ContinueROHC            ENUMERATED { true }                                 OPTIONAL    -- Need N\n            },\n            uplinkOnlyROHC          SEQUENCE {\n                maxCID                  INTEGER (1..16383)                                      DEFAULT 15,\n                profiles                SEQUENCE {\n                    profile0x0006           BOOLEAN\n                },\n                drb-ContinueROHC            ENUMERATED { true }                                 OPTIONAL    -- Need N\n            },\n            ...\n        },\n        integrityProtection     ENUMERATED { enabled }                                          OPTIONAL,   -- Cond ConnectedTo5GC1\n        statusReportRequired    ENUMERATED { true }                                             OPTIONAL,   -- Cond Rlc-AM\n        outOfOrderDelivery      ENUMERATED { true }                                             OPTIONAL    -- Need R\n    }                                                                                           OPTIONAL,   -- Cond DRB\n    moreThanOneRLC          SEQUENCE {\n        primaryPath             SEQUENCE {\n            cellGroup               CellGroupId                                                 OPTIONAL,   -- Need R\n            logicalChannel          LogicalChannelIdentity                                      OPTIONAL    -- Need R\n        },\n        ul-DataSplitThreshold   UL-DataSplitThreshold                                           OPTIONAL, -- Cond SplitBearer\n        pdcp-Duplication            BOOLEAN                                                     OPTIONAL    -- Need R\n    }                                                                                           OPTIONAL, -- Cond MoreThanOneRLC\n\n    t-Reordering                ENUMERATED {\n                                    ms0, ms1, ms2, ms4, ms5, ms8, ms10, ms15, ms20, ms30, ms40,\n                                    ms50, ms60, ms80, ms100, ms120, ms140, ms160, ms180, ms200, ms220,\n                                    ms240, ms260, ms280, ms300, ms500, ms750, ms1000, ms1250,\n                                    ms1500, ms1750, ms2000, ms2250, ms2500, ms2750,\n                                    ms3000, spare28, spare27, spare26, spare25, spare24,\n                                    spare23, spare22, spare21, spare20,\n                                    spare19, spare18, spare17, spare16, spare15, spare14,\n                                    spare13, spare12, spare11, spare10, spare09,\n                                    spare08, spare07, spare06, spare05, spare04, spare03,\n                                    spare02, spare01 }                                          OPTIONAL, -- Need S\n    ...,\n    [[\n    cipheringDisabled       ENUMERATED {true}                                                   OPTIONAL    -- Cond ConnectedTo5GC\n    ]]\n\n}\n\nUL-DataSplitThreshold ::= ENUMERATED {\n                                            b0, b100, b200, b400, b800, b1600, b3200, b6400, b12800, b25600, b51200, b102400, b204800,\n                                            b409600, b819200, b1228800, b1638400, b2457600, b3276800, b4096000, b4915200, b5734400,\n                                            b6553600, infinity, spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1}\n\n-- TAG-PDCP-CONFIG-STOP\n-- ASN1STOP\n\nPDCP-Config field descriptions\ncipheringDisabled\tIf included, ciphering is disabled for this DRB regardless of which ciphering algorithm is configured for the SRB/DRBs. The field may only be included if the UE is connected to 5GC. Otherwise the field is absent. The network configures all DRBs with the same PDU-session ID with same value for this field. The value for this field cannot be changed after the DRB is set up.\ndiscardTimer\tValue in ms of discardTimer specified in TS 38.323 [5]. Value ms50 corresponds to 50 ms, value ms100 corresponds to 100 ms and so on.\ndrb-ContinueROHC\tIndicates whether the PDCP entity continues or resets the ROHC header compression protocol during PDCP re-establishment, as specified in TS 38.323 [5]. This field is configured only in case of resuming an RRC connection or reconfiguration with sync, where the PDCP termination point is not changed and the fullConfig is not indicated.\nheaderCompression\tIf rohc is configured, the UE shall apply the configured ROHC profile(s) in both uplink and downlink. If uplinkOnlyROHC is configured, the UE shall apply the configured ROHC profile(s) in uplink (there is no header compression in downlink). ROHC can be configured for any bearer type. The network reconfigures headerCompression only upon reconfiguration involving PDCP re-establishment.  Network configures headerCompression to notUsed when outOfOrderDelivery is configured.\nintegrityProtection\tIndicates whether or not integrity protection is configured for this radio bearer. The network configures all DRBs with the same PDU-session ID with same value for this field. The value for this field cannot be changed after the DRB is set up.\nmaxCID\tIndicates the value of the MAX_CID parameter as specified in TS 38.323 [5].\tThe total value of MAX_CIDs across all bearers for the UE should be less than or equal to the value of maxNumberROHC-ContextSessions parameter as indicated by the UE. The network configures the same value for maxCID in both rohc and uplinkOnlyROHC.\nmoreThanOneRLC\tThis field configures UL data transmission when more than one RLC entity is associated with the PDCP entity.\noutOfOrderDelivery\tIndicates whether or not outOfOrderDelivery specified in TS 38.323 [5] is configured. This field should be either always present or always absent, since the radio bearer is established.\npdcp-Duplication\tIndicates whether or not uplink duplication status at the time of receiving this IE is configured and activated as specified in TS 38.323 [5]. The presence of this field indicates whether duplication is configured. PDCP duplication is not configured for CA packet duplication of LTE RLC bearer. The value of this field, when the field is present, indicates the initial state of the duplication. If set to true, duplication is activated. The value of this field is always true, when configured for a SRB.\npdcp-SN-SizeDL\tPDCP sequence number size for downlink, 12 or 18 bits, as specified in TS 38.323 [5]. For SRBs only the value len12bits is applicable.\npdcp-SN-SizeUL\tPDCP sequence number size for uplink, 12 or 18 bits, as specified in TS 38.323 [5]. For SRBs only the value len12bits is applicable.\nprimaryPath\tIndicates the cell group ID and LCID of the primary RLC entity as specified in TS 38.323 [5], clause 5.2.1 for UL data transmission when more than one RLC entity is associated with the PDCP entity. In this version of the specification, only cell group ID corresponding to MCG is supported for SRBs. The NW indicates cellGroup for split bearers using logical channels in different cell groups. The NW indicates logicalChannel for CA based PDCP duplication, i.e., if both logical channels terminate in the same cell group.\nstatusReportRequired\tFor AM DRBs, indicates whether the DRB is configured to send a PDCP status report in the uplink, as specified in TS 38.323 [5].\nt-Reordering\tValue in ms of t-Reordering specified in TS 38.323 [5]. Value ms0 corresponds to 0 ms, value ms20 corresponds to 20 ms, value ms40 corresponds to 40 ms, and so on.  When the field is absent the UE applies the value infinity.\nul-DataSplitThreshold\tParameter specified in TS 38.323 [5]. Value b0 corresponds to 0 bytes, value b100 corresponds to 100 bytes, value b200 corresponds to 200 bytes, and so on. The network sets this field to 'infinity' for UEs not supporting splitDRB-withUL-Both-MCG-SCG. If the field is absent when the split bearer is configured for the radio bearer first time, then the default value infinity is applied.\n\nConditional presence\tExplanation\nDRB\tThis field is mandatory present when the corresponding DRB is being set up, not present for SRBs. Otherwise this field is optionally present, need M.\nMoreThanOneRLC\tThis field is mandatory present upon RRC reconfiguration with setup of a PDCP entity for a radio bearer with more than one associated logical channel and upon RRC reconfiguration with the association of an additional logical channel to the PDCP entity.\nRlc-AM\tFor RLC AM, the field is optionally present, need R. Otherwise, the field is not present. \nSetup\tThe field is mandatory present in case of radio bearer setup. Otherwise the field is optionally present, need M.\nSplitBearer\tThe field is absent for SRBs. Otherwise, the field is optional present, need M, in case of radio bearer with more than one associated RLC mapped to different cell groups.\nConnectedTo5GC\tThe field is optionally present, need R, if the UE is connected to 5GC. Otherwise the field is absent. \nConnectedTo5GC1\tThe field is optionally present, need R, if the UE is connected to NR/5GC. Otherwise the field is absent. \nSetup2\n\n\u2013\tPDSCH-Config\nThe PDSCH-Config IE is used to configure the UE specific PDSCH parameters.\nPDSCH-Config information element\n-- ASN1START\n-- TAG-PDSCH-CONFIG-START\n\nPDSCH-Config ::=                        SEQUENCE {\n    dataScramblingIdentityPDSCH             INTEGER (0..1023)                                                   OPTIONAL,   -- Need S\n    dmrs-DownlinkForPDSCH-MappingTypeA      SetupRelease { DMRS-DownlinkConfig }                                OPTIONAL,   -- Need M\n    dmrs-DownlinkForPDSCH-MappingTypeB      SetupRelease { DMRS-DownlinkConfig }                                OPTIONAL,   -- Need M\n\n    tci-StatesToAddModList                  SEQUENCE (SIZE(1..maxNrofTCI-States)) OF TCI-State                  OPTIONAL,   -- Need N\n    tci-StatesToReleaseList                 SEQUENCE (SIZE(1..maxNrofTCI-States)) OF TCI-StateId                OPTIONAL,   -- Need N\n    vrb-ToPRB-Interleaver                   ENUMERATED {n2, n4}                                                 OPTIONAL,   -- Need S\n    resourceAllocation                      ENUMERATED { resourceAllocationType0, resourceAllocationType1, dynamicSwitch},\n    pdsch-TimeDomainAllocationList          SetupRelease { PDSCH-TimeDomainResourceAllocationList }             OPTIONAL,   -- Need M\n    pdsch-AggregationFactor                 ENUMERATED { n2, n4, n8 }                                           OPTIONAL,   -- Need S\n    rateMatchPatternToAddModList            SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPattern   OPTIONAL,   -- Need N\n    rateMatchPatternToReleaseList           SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPatternId OPTIONAL,   -- Need N\n    rateMatchPatternGroup1                  RateMatchPatternGroup                                               OPTIONAL,   -- Need R\n    rateMatchPatternGroup2                  RateMatchPatternGroup                                               OPTIONAL,   -- Need R\n\n    rbg-Size                                ENUMERATED {config1, config2},\n    mcs-Table                               ENUMERATED {qam256, qam64LowSE}                                     OPTIONAL,   -- Need S\n    maxNrofCodeWordsScheduledByDCI          ENUMERATED {n1, n2}                                                 OPTIONAL,   -- Need R\n\n    prb-BundlingType                        CHOICE {\n        staticBundling                          SEQUENCE {\n            bundleSize                              ENUMERATED { n4, wideband }                                 OPTIONAL    -- Need S\n        },\n        dynamicBundling                     SEQUENCE {\n            bundleSizeSet1                          ENUMERATED { n4, wideband, n2-wideband, n4-wideband }       OPTIONAL,   -- Need S\n            bundleSizeSet2                          ENUMERATED { n4, wideband }                                 OPTIONAL    -- Need S\n        }\n    },\n    zp-CSI-RS-ResourceToAddModList                  SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-Resources)) OF ZP-CSI-RS-Resource\n                                                                                                                OPTIONAL,   -- Need N\n    zp-CSI-RS-ResourceToReleaseList                 SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-Resources)) OF ZP-CSI-RS-ResourceId\n                                                                                                                OPTIONAL,   -- Need N\n    aperiodic-ZP-CSI-RS-ResourceSetsToAddModList    SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-ResourceSets)) OF ZP-CSI-RS-ResourceSet\n                                                                                                                OPTIONAL,   -- Need N\n    aperiodic-ZP-CSI-RS-ResourceSetsToReleaseList SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-ResourceSets)) OF ZP-CSI-RS-ResourceSetId\n                                                                                                                OPTIONAL,   -- Need N\n    sp-ZP-CSI-RS-ResourceSetsToAddModList   SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-ResourceSets)) OF ZP-CSI-RS-ResourceSet\n                                                                                                                OPTIONAL,   -- Need N\n    sp-ZP-CSI-RS-ResourceSetsToReleaseList  SEQUENCE (SIZE (1..maxNrofZP-CSI-RS-ResourceSets)) OF ZP-CSI-RS-ResourceSetId\n                                                                                                                OPTIONAL,   -- Need N\n    p-ZP-CSI-RS-ResourceSet                 SetupRelease { ZP-CSI-RS-ResourceSet }\n                                                                                                                OPTIONAL,   -- Need M\n    ...\n}\nRateMatchPatternGroup ::=               SEQUENCE (SIZE (1..maxNrofRateMatchPatternsPerGroup)) OF CHOICE {\n    cellLevel                               RateMatchPatternId,\n    bwpLevel                                RateMatchPatternId\n}\n\n-- TAG-PDSCH-CONFIG-STOP\n-- ASN1STOP\n\nPDSCH-Config field descriptions\naperiodic-ZP-CSI-RS-ResourceSetsToAddModList\tAddMod/Release lists for configuring aperiodically triggered zero-power CSI-RS resource sets. Each set contains a ZP-CSI-RS-ResourceSetId and the IDs of one or more ZP-CSI-RS-Resources (the actual resources are defined in the zp-CSI-RS-ResourceToAddModList). The network configures the UE with at most 3 aperiodic ZP-CSI-RS-ResourceSets and it uses only the ZP-CSI-RS-ResourceSetId 1 to 3. The network triggers a set by indicating its ZP-CSI-RS-ResourceSetId in the DCI payload. The DCI codepoint '01' triggers the resource set with ZP-CSI-RS-ResourceSetId 1, the DCI codepoint '10' triggers the resource set with ZP-CSI-RS-ResourceSetId 2, and the DCI codepoint '11' triggers the resource set with ZP-CSI-RS-ResourceSetId 3 (see TS 38.214 [19], clause 5.1.4.2)\ndataScramblingIdentityPDSCH\tIdentifier used to initialize data scrambling (c_init) for PDSCH. If the field is absent, the UE applies the physical cell ID. (see TS 38.211 [16], clause 7.3.1.1).\ndmrs-DownlinkForPDSCH-MappingTypeA\tDMRS configuration for PDSCH transmissions using PDSCH mapping type A (chosen dynamically via PDSCH-TimeDomainResourceAllocation). Only the fields dmrs-Type, dmrs-AdditionalPosition and maxLength may be set differently for mapping type A and B.\ndmrs-DownlinkForPDSCH-MappingTypeB\tDMRS configuration for PDSCH transmissions using PDSCH mapping type B (chosen dynamically via PDSCH-TimeDomainResourceAllocation). Only the fields dmrs-Type, dmrs-AdditionalPosition and maxLength may be set differently for mapping type A and B.\nmaxNrofCodeWordsScheduledByDCI\tMaximum number of code words that a single DCI may schedule. This changes the number of MCS/RV/NDI bits in the DCI message from 1 to 2.\nmcs-Table\tIndicates which MCS table the UE shall use for PDSCH. (see TS 38.214 [19], clause 5.1.3.1). If the field is absent the UE applies the value 64QAM.\npdsch-AggregationFactor\tNumber of repetitions for data (see TS 38.214 [19], clause 5.1.2.1). When the field is absent the UE applies the value 1.\npdsch-TimeDomainAllocationList\tList of time-domain configurations for timing of DL assignment to DL data (see table 5.1.2.1.1-1 in TS 38.214 [19]).\nprb-BundlingType\tIndicates the PRB bundle type and bundle size(s) (see TS 38.214 [19], clause 5.1.2.3). If dynamic is chosen, the actual bundleSizeSet1 or bundleSizeSet2 to use is indicated via DCI. Constraints on bundleSize(Set) setting depending on vrb-ToPRB-Interleaver and rbg-Size settings are described in TS 38.214 [19], clause 5.1.2.3. If a bundleSize(Set) value is absent, the UE applies the value n2. \np-ZP-CSI-RS-ResourceSet\tA set of periodically occurring ZP-CSI-RS-Resources (the actual resources are defined in the zp-CSI-RS-ResourceToAddModList). The network uses the ZP-CSI-RS-ResourceSetId=0 for this set.\nrateMatchPatternGroup1\tThe IDs of a first group of RateMatchPatterns defined in PDSCH-Config->rateMatchPatternToAddModList (BWP level) or in ServingCellConfig ->rateMatchPatternToAddModList (cell level). These patterns can be activated dynamically by DCI (see TS 38.214 [19], clause 5.1.4.1).\nrateMatchPatternGroup2\tThe IDs of a second group of RateMatchPatterns defined in PDSCH-Config->rateMatchPatternToAddModList (BWP level) or in ServingCellConfig ->rateMatchPatternToAddModList (cell level). These patterns can be activated dynamically by DCI (see TS 38.214 [19], clause 5.1.4.1).\nrateMatchPatternToAddModList\tResources patterns which the UE should rate match PDSCH around. The UE rate matches around the union of all resources indicated in the nested bitmaps (see TS 38.214 [19], clause 5.1.4.1). FFS: RAN1 indicates that there should be a set of patterns per cell and one per BWP => Having both seems unnecessary.\nrbg-Size\tSelection between config 1 and config 2 for RBG size for PDSCH. The UE ignores this field if resourceAllocation is set to resourceAllocationType1 (see TS 38.214 [19], clause 5.1.2.2.1).\nresourceAllocation\tConfiguration of resource allocation type 0 and resource allocation type 1 for non-fallback DCI (see TS 38.214 [19], clause 5.1.2.2).\nsp-ZP-CSI-RS-ResourceSetsToAddModList\tAddMod/Release lists for configuring semi-persistent zero-power CSI-RS resource sets. Each set contains a ZP-CSI-RS-ResourceSetId and the IDs of one or more ZP-CSI-RS-Resources (the actual resources are defined in the zp-CSI-RS-ResourceToAddModList) (see TS 38.214 [19], clause 5.1.4.2).\ntci-StatesToAddModList\tA list of Transmission Configuration Indicator (TCI) states indicating a transmission configuration which includes QCL-relationships between the DL RSs in one RS set and the PDSCH DMRS ports (see TS 38.214 [19], clause 5.1.5).\nvrb-ToPRB-Interleaver\tInterleaving unit configurable between 2 and 4 PRBs (see TS 38.211 [16], clause 7.3.1.6). When the field is absent, the UE performs non-interleaved VRB-to-PRB mapping.\nzp-CSI-RS-ResourceToAddModList\tA list of Zero-Power (ZP) CSI-RS resources used for PDSCH rate-matching. Each resource in this list may be referred to from only one type of resource set, i.e., aperiodic, semi-persistent or periodic (see TS 38.214 [19]).\n\n\u2013\tPDSCH-ConfigCommon\nThe IE PDSCH-ConfigCommon is used to configure cell specific PDSCH parameters.\nPDSCH-ConfigCommon information element\n-- ASN1START\n-- TAG-PDSCH-CONFIGCOMMON-START\n\nPDSCH-ConfigCommon ::=                  SEQUENCE {\n    pdsch-TimeDomainAllocationList                  PDSCH-TimeDomainResourceAllocationList          OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-PDSCH-CONFIGCOMMON-STOP\n-- ASN1STOP\n\nPDSCH-ConfigCommon field descriptions\npdsch-TimeDomainAllocationList\tList of time-domain configurations for timing of DL assignment to DL data (see table 5.1.2.1.1-1 in TS 38.214 [19]).\n\n\u2013\tPDSCH-ServingCellConfig\nThe IE PDSCH-ServingCellConfig is used to configure UE specific PDSCH parameters that are common across the UE's BWPs of one serving cell.\nPDSCH-ServingCellConfig information element\n-- ASN1START\n-- TAG-PDSCH-SERVINGCELLCONFIG-START\n\nPDSCH-ServingCellConfig ::=             SEQUENCE {\n    codeBlockGroupTransmission              SetupRelease { PDSCH-CodeBlockGroupTransmission }       OPTIONAL,   -- Need M\n    xOverhead                               ENUMERATED { xOh6, xOh12, xOh18 }                       OPTIONAL,   -- Need S\n    nrofHARQ-ProcessesForPDSCH              ENUMERATED {n2, n4, n6, n10, n12, n16}                  OPTIONAL,   -- Need S\n    pucch-Cell                              ServCellIndex                                           OPTIONAL,   -- Cond SCellAddOnly\n    ...,\n    [[\n    maxMIMO-Layers                          INTEGER (1..8)                                          OPTIONAL,  -- Need M\n    processingType2Enabled                  BOOLEAN                                                 OPTIONAL   -- Need M\n    ]]\n}\n\nPDSCH-CodeBlockGroupTransmission ::=    SEQUENCE {\n    maxCodeBlockGroupsPerTransportBlock     ENUMERATED {n2, n4, n6, n8},\n    codeBlockGroupFlushIndicator            BOOLEAN,\n    ...\n}\n\n-- TAG-PDSCH-SERVINGCELLCONFIG-STOP\n-- ASN1STOP\n\nPDSCH-CodeBlockGroupTransmission field descriptions\ncodeBlockGroupFlushIndicator\tIndicates whether CBGFI for CBG based (re)transmission in DL is enabled (true). (see TS 38.212 [17], clause 7.3.1.2.2).\nmaxCodeBlockGroupsPerTransportBlock\tMaximum number of code-block-groups (CBGs) per TB. In case of multiple CW, the maximum CBG is 4 (see TS 38.213 [13], clause 9.1.1).\n\nPDSCH-ServingCellConfig field descriptions\ncodeBlockGroupTransmission\tEnables and configures code-block-group (CBG) based transmission (see TS 38.213 [13], clause 9.1.1).\nmaxMIMO-Layers\tIndicates the maximum MIMO layer to be used for PDSCH in all BWPs of this serving cell. (see TS 38.212 [17], clause 5.4.2.1).\nnrofHARQ-ProcessesForPDSCH\tThe number of HARQ processes to be used on the PDSCH of a serving cell. Value n2 corresponds to 2 HARQ processes, value n4 to 4 HARQ processes, and so on. If the field is absent, the UE uses 8 HARQ processes (see TS 38.214 [19], clause 5.1).\nprocessingType2Enabled\tEnables configuration of advanced processing time capability 2 for PDSCH (see 38.214 [19], clause 5.3).\npucch-Cell\tThe ID of the serving cell (of the same cell group) to use for PUCCH. If the field is absent, the UE sends the HARQ feedback on the PUCCH of the SpCell of this cell group.\nxOverhead\tAccounts for overhead from CSI-RS, CORESET, etc. If the field is absent, the UE applies value xOh0 (see TS 38.214 [19], clause 5.1.3.2).\n\nConditional Presence\tExplanation\nSCellAddOnly\n\n\u2013\tPDSCH-TimeDomainResourceAllocationList\nThe IE PDSCH-TimeDomainResourceAllocation is used to configure a time domain relation between PDCCH and PDSCH. The PDSCH-TimeDomainResourceAllocationList contains one or more of such PDSCH-TimeDomainResourceAllocations. The network indicates in the DL assignment which of the configured time domain allocations the UE shall apply for that DL assignment. The UE determines the bit width of the DCI field based on the number of entries in the PDSCH-TimeDomainResourceAllocationList. Value 0 in the DCI field refers to the first element in this list, value 1 in the DCI field refers to the second element in this list, and so on.\nPDSCH-TimeDomainResourceAllocationList information element\n-- ASN1START\n-- TAG-PDSCH-TIMEDOMAINRESOURCEALLOCATIONLIST-START\n\n\nPDSCH-TimeDomainResourceAllocationList ::=  SEQUENCE (SIZE(1..maxNrofDL-Allocations)) OF PDSCH-TimeDomainResourceAllocation\n\nPDSCH-TimeDomainResourceAllocation ::=   SEQUENCE {\n    k0                                      INTEGER(0..32)                                                     OPTIONAL,   -- Need S\n    mappingType                             ENUMERATED {typeA, typeB},\n    startSymbolAndLength                    INTEGER (0..127)\n}\n\n-- TAG-PDSCH-TIMEDOMAINRESOURCEALLOCATIONLIST-STOP\n-- ASN1STOP\n\nPDSCH-TimeDomainResourceAllocation field descriptions\nk0\tSlot offset between DCI and its scheduled PDSCH (see TS 38.214 [19], clause 5.1.2.1) When the field is absent the UE applies the value 0.\nmappingType\tPDSCH mapping type. (see TS 38.214 [19], clause 5.3).\nstartSymbolAndLength\tAn index giving valid combinations of start symbol and length (jointly encoded) as start and length indicator (SLIV). The network configures the field so that the allocation does not cross the slot boundary (see TS 38.214 [19], clause 5.1.2.1).\n\n\u2013\tPHR-Config\nThe IE PHR-Config is used to configure parameters for power headroom reporting.\nPHR-Config information element\n-- ASN1START\n-- TAG-PHR-CONFIG-START\n\nPHR-Config ::=                      SEQUENCE {\n    phr-PeriodicTimer                   ENUMERATED {sf10, sf20, sf50, sf100, sf200,sf500, sf1000, infinity},\n    phr-ProhibitTimer                   ENUMERATED {sf0, sf10, sf20, sf50, sf100,sf200, sf500, sf1000},\n    phr-Tx-PowerFactorChange            ENUMERATED {dB1, dB3, dB6, infinity},\n    multiplePHR                         BOOLEAN,\n    dummy                               BOOLEAN,\n    phr-Type2OtherCell                  BOOLEAN,\n    phr-ModeOtherCG                     ENUMERATED {real, virtual},\n    ...\n}\n\n-- TAG-PHR-CONFIG-STOP\n-- ASN1STOP\n\nPHR-Config field descriptions\ndummy\tThis field is not used in this version of the specification and the UE ignores the received value.\nmultiplePHR\tIndicates if power headroom shall be reported using the Single Entry PHR MAC control element or Multiple Entry PHR MAC control element defined in TS 38.321 [3]. True means to use Multiple Entry PHR MAC control element and False means to use the Single Entry PHR MAC control element defined in TS 38.321 [3]. The network configures this field to true for MR-DC and UL CA for NR, and to false in all other cases.\nphr-ModeOtherCG\tIndicates the mode (i.e. real or virtual) used for the PHR of the activated cells that are part of the other Cell Group (i.e. MCG or SCG), when DC is configured. If the UE is configured with only one cell group (no DC), it ignores the field.\nphr-PeriodicTimer\tValue in number of subframes for PHR reporting as specified in TS 38.321 [3]. Value sf10 corresponds to 10 subframes, value sf20 corresponds to 20 subframes, and so on.\nphr-ProhibitTimer\tValue in number of subframes for PHR reporting as specified in TS 38.321 [3]. Value sf0 corresponds to 0 subframe, value sf10 corresponds to 10 subframes, value sf20 corresponds to 20 subframes, and so on.\nphr-Tx-PowerFactorChange\tValue in dB for PHR reporting as specified in TS 38.321 [3]. Value dB1 corresponds to 1 dB, dB3 corresponds to 3 dB and so on. The same value applies for each serving cell (although the associated functionality is performed independently for each cell).\nphr-Type2OtherCell\tIf set to true, the UE shall report a PHR type 2 for the SpCell of the other MAC entity. See TS 38.321 [3], clause 5.4.6. Network sets this field to false if the UE is not configured with an E-UTRA MAC entity.\n\n\u2013\tPhysCellId\nThe PhysCellId identifies the physical cell identity (PCI).\nPhysCellId information element\n-- ASN1START\n-- TAG-PHYSCELLID-START\n\nPhysCellId ::=                      INTEGER (0..1007)\n\n-- TAG-PHYSCELLID-STOP\n-- ASN1STOP\n\n\u2013\tPhysicalCellGroupConfig\nThe IE PhysicalCellGroupConfig is used to configure cell-group specific L1 parameters.\nPhysicalCellGroupConfig information element\n-- ASN1START\n-- TAG-PHYSICALCELLGROUPCONFIG-START\n\nPhysicalCellGroupConfig ::=         SEQUENCE {\n    harq-ACK-SpatialBundlingPUCCH       ENUMERATED {true}                                               OPTIONAL,   -- Need S\n    harq-ACK-SpatialBundlingPUSCH       ENUMERATED {true}                                               OPTIONAL,   -- Need S\n    p-NR-FR1                            P-Max                                                           OPTIONAL,   -- Need R\n    pdsch-HARQ-ACK-Codebook             ENUMERATED {semiStatic, dynamic},\n    tpc-SRS-RNTI                        RNTI-Value                                                      OPTIONAL,   -- Need R\n    tpc-PUCCH-RNTI                      RNTI-Value                                                      OPTIONAL,   -- Need R\n    tpc-PUSCH-RNTI                      RNTI-Value                                                      OPTIONAL,   -- Need R\n    sp-CSI-RNTI                         RNTI-Value                                                      OPTIONAL,   -- Need R\n    cs-RNTI                             SetupRelease { RNTI-Value }                                     OPTIONAL,   -- Need M\n    ...,\n    [[\n    mcs-C-RNTI                          RNTI-Value                                                      OPTIONAL,   -- Need R\n    p-UE-FR1                            P-Max                                                           OPTIONAL    -- Cond MCG-Only\n    ]],\n    [[\n    xScale                              ENUMERATED {dB0, dB6, spare2, spare1}                           OPTIONAL    -- Cond SCG-Only\n    ]]\n}\n\n-- TAG-PHYSICALCELLGROUPCONFIG-STOP\n-- ASN1STOP\n\nPhysicalCellGroupConfig field descriptions\ncs-RNTI\tRNTI value for downlink SPS (see SPS-Config) and uplink configured grant (see ConfiguredGrantConfig).\nharq-ACK-SpatialBundlingPUCCH\tEnables spatial bundling of HARQ ACKs. It is configured per cell group (i.e. for all the cells within the cell group) for PUCCH reporting of HARQ-ACK. It is only applicable when more than 4 layers are possible to schedule. When the field is absent, the spatial bundling is disabled (see TS 38.213 [13], clause 9.1.2.1).\nharq-ACK-SpatialBundlingPUSCH\tEnables spatial bundling of HARQ ACKs. It is configured per cell group (i.e. for all the cells within the cell group) for PUSCH reporting of HARQ-ACK. It is only applicable when more than 4 layers are possible to schedule. When the field is absent, the spatial bundling is disabled (see TS 38.213 [13], clauses 9.1.2.2 and 9.1.3.2). \nmcs-C-RNTI\tRNTI to indicate use of qam64LowSE for grant-based transmissions. When the MCS-C-RNTI is configured, RNTI scrambling of DCI CRC is used to choose the corresponding MCS table.\np-NR-FR1\tThe maximum total transmit power to be used by the UE in this NR cell group across all serving cells in frequency range 1 (FR1). The maximum transmit power that the UE may use may be additionally limited by p-Max (configured in FrequencyInfoUL) and by p-UE-FR1 (configured total for all serving cells operating on FR1).\np-UE-FR1\tThe maximum total transmit power to be used by the UE across all serving cells in frequency range 1 (FR1) across all cell groups. The maximum transmit power that the UE may use may be additionally limited by p-Max (configured in FrequencyInfoUL) and by p-NR-FR1 (configured for the cell group).\npdsch-HARQ-ACK-Codebook\tThe PDSCH HARQ-ACK codebook is either semi-static or dynamic. This is applicable to both CA and none CA operation (see TS 38.213 [13], clauses 9.1.2 and 9.1.3).\nsp-CSI-RNTI\ntpc-PUCCH-RNTI\tRNTI used for PUCCH TPC commands on DCI (see TS 38.213 [13], clause 10.1).\ntpc-PUSCH-RNTI\tRNTI used for PUSCH TPC commands on DCI (see TS 38.213 [13], clause 10.1).\ntpc-SRS-RNTI\tRNTI used for SRS TPC commands on DCI (see TS 38.213 [13], clause 10.1).\nxScale\tThe UE is allowed to drop NR only if the power scaling applied to NR results in a difference between scaled and unscaled NR UL of more than xScale dB (see TS 38.101-3 [34]). If the value is not configured for dynamic power sharing, the UE assumes default value of 6 dB.\n\nConditional Presence\tExplanation\nMCG-Only\tThis field is optionally present, Need R, in the PhysicalCellGroupConfig of the MCG. It is absent otherwise. \nSCG-Only\tThis field is optionally present, Need S, in the PhysicalCellGroupConfig of the SCG in EN-DC as defined in TS 38.101-3 [34]. It is absent otherwise. FFS for NR-NR DC and multiple NR uplinks.\n\n\u2013\tPLMN-Identity\nThe IE PLMN-Identity identifies a Public Land Mobile Network. Further information regarding how to set the IE is specified in TS 23.003 [21].\nPLMN-Identity information element\n-- ASN1START\n-- TAG-PLMN-IDENTITY-START\n\nPLMN-Identity ::=                   SEQUENCE {\n    mcc                                 MCC                 OPTIONAL,                   -- Cond MCC\n    mnc                                 MNC\n}\n\nMCC ::=                             SEQUENCE (SIZE (3)) OF MCC-MNC-Digit\n\nMNC ::=                             SEQUENCE (SIZE (2..3)) OF MCC-MNC-Digit\n\nMCC-MNC-Digit ::=                   INTEGER (0..9)\n\n\n-- TAG-PLMN-IDENTITY-STOP\n-- ASN1STOP\n\nPLMN-Identity field descriptions\nmcc\tThe first element contains the first MCC digit, the second element the second MCC digit and so on. If the field is absent, it takes the same value as the mcc of the immediately preceding IE PLMN-Identity. See TS 23.003 [21].\nmnc\tThe first element contains the first MNC digit, the second element the second MNC digit and so on. See TS 23.003 [21].\n\nConditional Presence\tExplanation\nMCC\tThis field is mandatory present when PLMN-Identity is not used in a list or if it is the first entry of PLMN-Identity in a list. Otherwise it is optionally present, Need S.\n\n\u2013\tPLMN-IdentityInfoList\nThe IE PLMN-IdentityInfoList includes a list of PLMN identity information.\nPLMN-IdentityInfoList information element\n-- ASN1START\n-- TAG-PLMN-IDENTITYINFOLIST-START\n\nPLMN-IdentityInfoList ::=               SEQUENCE (SIZE (1..maxPLMN)) OF PLMN-IdentityInfo\n\nPLMN-IdentityInfo ::=                   SEQUENCE {\n    plmn-IdentityList                           SEQUENCE (SIZE (1..maxPLMN)) OF PLMN-Identity,\n    trackingAreaCode                            TrackingAreaCode                                            OPTIONAL,       -- Need R\n    ranac                                       RAN-AreaCode                                                OPTIONAL,       -- Need R\n    cellIdentity                                CellIdentity,\n    cellReservedForOperatorUse                  ENUMERATED {reserved, notReserved},\n    ...\n}\n-- TAG-PLMN-IDENTITYINFOLIST-STOP\n-- ASN1STOP\n\nPLMN-IdentityInfo field descriptions\ncellReservedForOperatorUse\tIndicates whether the cell is reserved for operator use (per PLMN), as defined in TS 38.304 [20].\ntrackingAreaCode\tIndicates Tracking Area Code to which the cell indicated by cellIdentity field belongs. The presence of the field indicates that the cell supports at least standalone operation (per PLMN); the absence of the field indicates that the cell only supports EN-DC functionality (per PLMN).\n\n\u2013\tPRB-Id\nThe IE PRB-Id identifies a Physical Resource Block (PRB) position within a carrier.\nPRB-Id information element\n-- ASN1START\n-- TAG-PRB-ID-START\n\nPRB-Id ::=                          INTEGER (0..maxNrofPhysicalResourceBlocks-1)\n\n-- TAG-PRB-ID-STOP\n-- ASN1STOP\n\n\u2013\tPTRS-DownlinkConfig\nThe IE PTRS-DownlinkConfig is used to configure downlink phase tracking reference signals (PTRS) (see TS 38.214 [19] clause 5.1.6.3)\nPTRS-DownlinkConfig information element\n-- ASN1START\n-- TAG-PTRS-DOWNLINKCONFIG-START\n\nPTRS-DownlinkConfig ::=             SEQUENCE {\n    frequencyDensity                    SEQUENCE (SIZE (2)) OF INTEGER (1..276)                                 OPTIONAL,   -- Need S\n    timeDensity                         SEQUENCE (SIZE (3)) OF INTEGER (0..29)                                  OPTIONAL,   -- Need S\n    epre-Ratio                          INTEGER (0..3)                                                          OPTIONAL,   -- Need S\n    resourceElementOffset               ENUMERATED { offset01, offset10, offset11 }                             OPTIONAL,   -- Need S\n    ...\n}\n\n-- TAG-PTRS-DOWNLINKCONFIG-STOP\n-- ASN1STOP\n\nPTRS-DownlinkConfig field descriptions\nepre-Ratio\tEPRE ratio between PTRS and PDSCH. Value 0 corresponds to the codepoint \"00\" in table 4.1-2. Value 1 corresponds to codepoint \"01\", and so on. If the field is not provided, the UE applies value 0 (see TS 38.214 [19], clause 4.1).\nfrequencyDensity\tPresence and frequency density of DL PT-RS as a function of Scheduled BW. If the field is absent, the UE uses K_PT-RS = 2 (see TS 38.214 [19], clause 5.1.6.3, Table 5.1.6.3-2).\nresourceElementOffset\tIndicates the subcarrier offset for DL PTRS. If the field is absent, the UE applies the value offset00 (see TS 38.214 [19], clause 6.4.1.2.2.1).\ntimeDensity\tPresence and time density of DL PT-RS as a function of MCS. The value 29 is only applicable for MCS Table 5.1.3.1-1 (TS 38.214 [19]). If the field is absent, the UE uses L_PT-RS = 1 (see TS 38.214 [19], clause 5.1.6.3, Table 5.1.6.3-1).\n\n\u2013\tPTRS-UplinkConfig\nThe IE PTRS-UplinkConfig is used to configure uplink Phase-Tracking-Reference-Signals (PTRS).\nPTRS-UplinkConfig information element\n-- ASN1START\n-- TAG-PTRS-UPLINKCONFIG-START\n\nPTRS-UplinkConfig ::=                   SEQUENCE {\n    transformPrecoderDisabled               SEQUENCE {\n        frequencyDensity                    SEQUENCE (SIZE (2)) OF INTEGER (1..276)                 OPTIONAL,   -- Need S\n        timeDensity                         SEQUENCE (SIZE (3)) OF INTEGER (0..29)                  OPTIONAL,   -- Need S\n        maxNrofPorts                        ENUMERATED {n1, n2},\n        resourceElementOffset               ENUMERATED {offset01, offset10, offset11 }              OPTIONAL,   -- Need S\n        ptrs-Power                          ENUMERATED {p00, p01, p10, p11}\n    }                                                                                               OPTIONAL,   -- Need R\n    transformPrecoderEnabled                SEQUENCE {\n        sampleDensity                           SEQUENCE (SIZE (5)) OF INTEGER (1..276),\n        timeDensityTransformPrecoding           ENUMERATED {d2}                                     OPTIONAL    -- Need S\n    }                                                                                               OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-PTRS-UPLINKCONFIG-STOP\n-- ASN1STOP\n\nPTRS-UplinkConfig field descriptions\nfrequencyDensity\tPresence and frequency density of UL PT-RS for CP-OFDM waveform as a function of scheduled BW If the field is absent, the UE uses K_PT-RS = 2 (see TS 38.214 [19], clause 6.1).\nmaxNrofPorts\tThe maximum number of UL PTRS ports for CP-OFDM (see TS 38.214 [19], clause 6.2.3.1).\nptrs-Power\tUL PTRS power boosting factor per PTRS port (see TS 38.214 [19], clause 6.1, table 6.2.3.1.3).\nresourceElementOffset\tIndicates the subcarrier offset for UL PTRS for CP-OFDM. If the field is absent, the UE applies the value offset00 (see TS 38.211 [16], clause 6.4.1.2.2).\nsampleDensity\tSample density of PT-RS for DFT-s-OFDM, pre-DFT, indicating a set of thresholds T={NRBn, n=0,1,2,3,4}, that indicates dependency between presence of PT-RS and scheduled BW and the values of X and K the UE should use depending on the scheduled BW, see TS 38.214 [19], clause 6.1, table 6.2.3.2-1.\ntimeDensity\tPresence and time density of UL PT-RS for CP-OFDM waveform as a function of MCS If the field is absent, the UE uses L_PT-RS = 1 (see TS 38.214 [19], clause 6.1).\ntimeDensityTransformPrecoding\tTime density (OFDM symbol level) of PT-RS for DFT-s-OFDM. If the field is absent, the UE applies value d1 (see TS 38.214 [19], clause 6.1).\ntransformPrecoderDisabled\tConfiguration of UL PTRS without transform precoder (with CP-OFDM).\ntransformPrecoderEnabled\tConfiguration of UL PTRS with transform precoder (DFT-S-OFDM).\n\n\u2013\tPUCCH-Config\nThe IE PUCCH-Config is used to configure UE specific PUCCH parameters (per BWP).\nPUCCH-Config information element\n-- ASN1START\n-- TAG-PUCCH-CONFIG-START\n\nPUCCH-Config ::=                        SEQUENCE {\n    resourceSetToAddModList                 SEQUENCE (SIZE (1..maxNrofPUCCH-ResourceSets)) OF PUCCH-ResourceSet   OPTIONAL, -- Need N\n    resourceSetToReleaseList                SEQUENCE (SIZE (1..maxNrofPUCCH-ResourceSets)) OF PUCCH-ResourceSetId OPTIONAL, -- Need N\n    resourceToAddModList                    SEQUENCE (SIZE (1..maxNrofPUCCH-Resources)) OF PUCCH-Resource         OPTIONAL, -- Need N\n    resourceToReleaseList                   SEQUENCE (SIZE (1..maxNrofPUCCH-Resources)) OF PUCCH-ResourceId       OPTIONAL, -- Need N\n    format1                                 SetupRelease { PUCCH-FormatConfig }                                   OPTIONAL, -- Need M\n    format2                                 SetupRelease { PUCCH-FormatConfig }                                   OPTIONAL, -- Need M\n    format3                                 SetupRelease { PUCCH-FormatConfig }                                   OPTIONAL, -- Need M\n    format4                                 SetupRelease { PUCCH-FormatConfig }                                   OPTIONAL, -- Need M\n\n    schedulingRequestResourceToAddModList   SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceConfig   \n                                                                                                                  OPTIONAL, -- Need N\n    schedulingRequestResourceToReleaseList  SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceId\n                                                                                                                  OPTIONAL, -- Need N\n    multi-CSI-PUCCH-ResourceList            SEQUENCE (SIZE (1..2)) OF PUCCH-ResourceId                            OPTIONAL, -- Need M\n    dl-DataToUL-ACK                         SEQUENCE (SIZE (1..8)) OF INTEGER (0..15)                             OPTIONAL, -- Need M\n\n    spatialRelationInfoToAddModList         SEQUENCE (SIZE (1..maxNrofSpatialRelationInfos)) OF PUCCH-SpatialRelationInfo\n                                                                                                                  OPTIONAL, -- Need N\n    spatialRelationInfoToReleaseList        SEQUENCE (SIZE (1..maxNrofSpatialRelationInfos)) OF PUCCH-SpatialRelationInfoId\n                                                                                                                  OPTIONAL, -- Need N\n    pucch-PowerControl                      PUCCH-PowerControl                                                    OPTIONAL, -- Need M\n    ...\n}\n\nPUCCH-FormatConfig ::=                  SEQUENCE {\n    interslotFrequencyHopping               ENUMERATED {enabled}                                                  OPTIONAL, -- Need R\n    additionalDMRS                          ENUMERATED {true}                                                     OPTIONAL, -- Need R\n    maxCodeRate                             PUCCH-MaxCodeRate                                                     OPTIONAL, -- Need R\n    nrofSlots                               ENUMERATED {n2,n4,n8}                                                 OPTIONAL, -- Need S\n    pi2BPSK                                 ENUMERATED {enabled}                                                  OPTIONAL, -- Need R\n    simultaneousHARQ-ACK-CSI                ENUMERATED {true}                                                     OPTIONAL  -- Need R\n}\n\nPUCCH-MaxCodeRate ::=                   ENUMERATED {zeroDot08, zeroDot15, zeroDot25, zeroDot35, zeroDot45, zeroDot60, zeroDot80}\n\n-- A set with one or more PUCCH resources\nPUCCH-ResourceSet ::=                   SEQUENCE {\n    pucch-ResourceSetId                     PUCCH-ResourceSetId,\n    resourceList                    SEQUENCE (SIZE (1..maxNrofPUCCH-ResourcesPerSet)) OF PUCCH-ResourceId,\n    maxPayloadMinus1                        INTEGER (4..256)                                                      OPTIONAL  -- Need R\n}\n\nPUCCH-ResourceSetId ::=                 INTEGER (0..maxNrofPUCCH-ResourceSets-1)\n\nPUCCH-Resource ::=                      SEQUENCE {\n    pucch-ResourceId                        PUCCH-ResourceId,\n    startingPRB                             PRB-Id,\n    intraSlotFrequencyHopping               ENUMERATED { enabled }                                                OPTIONAL, -- Need R\n    secondHopPRB                            PRB-Id                                                                OPTIONAL, -- Need R\n    format                                  CHOICE {\n        format0                                 PUCCH-format0,\n        format1                                 PUCCH-format1,\n        format2                                 PUCCH-format2,\n        format3                                 PUCCH-format3,\n        format4                                 PUCCH-format4\n    }\n}\n\nPUCCH-ResourceId ::=                    INTEGER (0..maxNrofPUCCH-Resources-1)\n\n\nPUCCH-format0 ::=                               SEQUENCE {\n    initialCyclicShift                              INTEGER(0..11),\n    nrofSymbols                                     INTEGER (1..2),\n    startingSymbolIndex                             INTEGER(0..13)\n}\n\nPUCCH-format1 ::=                               SEQUENCE {\n    initialCyclicShift                              INTEGER(0..11),\n    nrofSymbols                                     INTEGER (4..14),\n    startingSymbolIndex                             INTEGER(0..10),\n    timeDomainOCC                                   INTEGER(0..6)\n}\n\nPUCCH-format2 ::=                               SEQUENCE {\n    nrofPRBs                                        INTEGER (1..16),\n    nrofSymbols                                     INTEGER (1..2),\n    startingSymbolIndex                             INTEGER(0..13)\n}\n\nPUCCH-format3 ::=                               SEQUENCE {\n    nrofPRBs                                        INTEGER (1..16),\n    nrofSymbols                                     INTEGER (4..14),\n    startingSymbolIndex                             INTEGER(0..10)\n}\n\nPUCCH-format4 ::=                               SEQUENCE {\n    nrofSymbols                                     INTEGER (4..14),\n    occ-Length                                      ENUMERATED {n2,n4},\n    occ-Index                                       ENUMERATED {n0,n1,n2,n3},\n    startingSymbolIndex                             INTEGER(0..10)\n}\n\n-- TAG-PUCCH-CONFIG-STOP\n-- ASN1STOP\n\n\nPUCCH-Config field descriptions\ndl-DataToUL-ACK\tList of timing for given PDSCH to the DL ACK (see TS 38.213 [13], clause 9.1.2).\nformat1\tParameters that are common for all PUCCH resources of format 1.\nformat2\tParameters that are common for all PUCCH resources of format 2.\nformat3\tParameters that are common for all PUCCH resources of format 3.\nformat4.\tParameters that are common for all PUCCH resources of format 4\nresourceSetToAddModList\tLists for adding and releasing PUCCH resource sets (see TS 38.213 [13], clause 9.2).\nresourceToAddModList, resourceToReleaseList\tLists for adding and releasing PUCCH resources applicable for the UL BWP and serving cell in which the PUCCH-Config is defined. The resources defined herein are referred to from other parts of the configuration to determine which resource the UE shall use for which report.\nspatialRelationInfoToAddModList\tConfiguration of the spatial relation between a reference RS and PUCCH. Reference RS can be SSB/CSI-RS/SRS. If the list has more than one element, MAC-CE selects a single element (see TS 38.321 [3], clause 5.18.8 and TS 38.213 [13], clause 9.2.2).\n\nPUCCH-format3 field descriptions\nnrofPRBs\tThe supported values are 1,2,3,4,5,6,8,9,10,12,15 and 16.\n\nPUCCH-FormatConfig field descriptions\nadditionalDMRS\tIf the field is present, the UE enables 2 DMRS symbols per hop of a PUCCH Format 3 or 4 if both hops are more than X symbols when FH is enabled (X=4). And it enables 4 DMRS symbols for a PUCCH Format 3 or 4 with more than 2X+1 symbols when FH is disabled (X=4). The field is not applicable for format 1 and 2. See TS 38.213 [13], clause 9.2.2.\ninterslotFrequencyHopping\tIf the field is present, the UE enables inter-slot frequency hopping when PUCCH Format 1, 3 or 4 is repeated over multiple slots. For long PUCCH over multiple slots, the intra and inter slot frequency hopping cannot be enabled at the same time for a UE. The field is not applicable for format 2. See TS 38.213 [13], clause 9.2.6.\nmaxCodeRate\tMax coding rate to determine how to feedback UCI on PUCCH for format 2, 3 or 4. The field is not applicable for format 1. See TS 38.213 [13], clause 9.2.5.\nnrofSlots\tNumber of slots with the same PUCCH F1, F3 or F4. When the field is absent the UE applies the value n1. The field is not applicable for format 2. See TS 38.213 [13], clause 9.2.6.\npi2BPSK\tIf the field is present, the UE uses pi/2 BPSK for UCI symbols instead of QPSK for PUCCH. The field is not applicable for format 1 and 2. See TS 38.213 [13], clause 9.2.5.\nsimultaneousHARQ-ACK-CSI\tIf the field is present, the UE uses simultaneous transmission of CSI and HARQ-ACK feedback with or without SR with PUCCH Format 2, 3 or 4. See TS 38.213 [13], clause 9.2.5. When the field is absent the UE applies the value off. The field is not applicable for format 1.\n\nPUCCH-Resource field descriptions\nformat\tSelection of the PUCCH format (format 0 \u2013 4) and format-specific parameters, see TS 38.213 [13], clause 9.2. format0 and format1 are only allowed for a resource in a first PUCCH resource set. format2, format3 and format4 are only allowed for a resource in non-first PUCCH resource set.\nintraSlotFrequencyHopping\tEnabling intra-slot frequency hopping, applicable for all types of PUCCH formats. For long PUCCH over multiple slots, the intra and inter slot frequency hopping cannot be enabled at the same time for a UE. See TS 38.213 [13], clause 9.2.1.\npucch-ResourceId\tIdentifier of the PUCCH resource.\nsecondHopPRB\tIndex of first PRB after frequency hopping (for second hop) of PUCCH. This value is applicable for intra-slot frequency hopping. See TS 38.213 [13], clause 9.2.1.\n\nPUCCH-ResourceSet field descriptions\nmaxPayloadMinus1\tMaximum number of payload bits minus 1 that the UE may transmit using this PUCCH resource set. In a PUCCH occurrence, the UE chooses the first of its PUCCH-ResourceSet which supports the number of bits that the UE wants to transmit. The field is not present in the first set (Set0) since the maximum Size of Set0 is specified to be 3 bits. The field is not present in the last configured set since the UE derives its maximum payload size as specified in TS 38.213 [13]. This field can take integer values that are multiples of 4 (see TS 38.213 [13], clause 9.2).\nresourceList\tPUCCH resources of format0 and format1 are only allowed in the first PUCCH resource set, i.e., in a PUCCH-ResourceSet with pucch-ResourceSetId = 0. This set may contain between 1 and 32 resources. PUCCH resources of format2, format3 and format4 are only allowed in a PUCCH-ResourceSet with pucch-ResourceSetId > 0. If present, these sets contain between 1 and 8 resources each. The UE chooses a PUCCH-Resource from this list as specified in TS 38.213 [13], clause 9.2.3. Note that this list contains only a list of resource IDs. The actual resources are configured in PUCCH-Config.\n\n\u2013\tPUCCH-ConfigCommon\nThe IE PUCCH-ConfigCommon is used to configure the cell specific PUCCH parameters.\nPUCCH-ConfigCommon information element\n-- ASN1START\n-- TAG-PUCCH-CONFIGCOMMON-START\n\nPUCCH-ConfigCommon ::=              SEQUENCE {\n    pucch-ResourceCommon                INTEGER (0..15)                                      OPTIONAL,   -- Cond InitialBWP-Only\n    pucch-GroupHopping                  ENUMERATED { neither, enable, disable },\n    hoppingId                           INTEGER (0..1023)                                    OPTIONAL,   -- Need R\n    p0-nominal                          INTEGER (-202..24)                                   OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-PUCCH-CONFIGCOMMON-STOP\n-- ASN1STOP\n\nPUCCH-ConfigCommon field descriptions\nhoppingId\tCell-specific scrambling ID for group hopping and sequence hopping if enabled, see TS 38.211 [16], clause 6.3.2.2.\np0-nominal\tPower control parameter P0 for PUCCH transmissions. Value in dBm. Only even values (step size 2) allowed (see TS 38.213 [13], clause 7.2).\npucch-GroupHopping\tConfiguration of group- and sequence hopping for all the PUCCH formats 0, 1, 3 and 4. Value neither implies neither group or sequence hopping is enabled. Value enable enables group hopping and disables sequence hopping. Value disable disables group hopping and enables sequence hopping (see TS 38.211 [16], clause 6.3.2.2).\npucch-ResourceCommon\tAn entry into a 16-row table where each row configures a set of cell-specific PUCCH resources/parameters. The UE uses those PUCCH resources only during initial access on the initial uplink BWP. Once the network provides a dedicated PUCCH-Config for that bandwidth part the UE applies that one instead of the one provided in this field (see TS 38.213 [13], clause 9.2).\n\nConditional Presence\tExplanation\nInitialBWP-Only\tThe field is mandatory present in the PUCCH-ConfigCommon of the initial BWP (BWP#0) in SIB1. It is absent in other BWPs. \n\n\u2013\tPUCCH-PathlossReferenceRS-Id\nThe IE PUCCH-PathlossReferenceRS-Id is an ID for a reference signal (RS) configured as PUCCH pathloss reference (see TS 38.213 [13], clause 7.2).\nPUCCH-PathlossReferenceRS-Id information element\n-- ASN1START\n-- TAG-PUCCH-PATHLOSSREFERENCERS-ID-START\n\nPUCCH-PathlossReferenceRS-Id ::=            INTEGER (0..maxNrofPUCCH-PathlossReferenceRSs-1)\n\n-- TAG-PUCCH-PATHLOSSREFERENCERS-ID-STOP\n-- ASN1STOP\n\n\u2013\tPUCCH-PowerControl\nThe IE PUCCH-PowerControl is used to configure UE-specific parameters for the power control of PUCCH.\nPUCCH-PowerControl information element\n-- ASN1START\n-- TAG-PUCCH-POWERCONTROL-START\nPUCCH-PowerControl ::=              SEQUENCE {\n    deltaF-PUCCH-f0                     INTEGER (-16..15)                                                       OPTIONAL, -- Need R\n    deltaF-PUCCH-f1                     INTEGER (-16..15)                                                       OPTIONAL, -- Need R\n    deltaF-PUCCH-f2                     INTEGER (-16..15)                                                       OPTIONAL, -- Need R\n    deltaF-PUCCH-f3                     INTEGER (-16..15)                                                       OPTIONAL, -- Need R\n    deltaF-PUCCH-f4                     INTEGER (-16..15)                                                       OPTIONAL, -- Need R\n    p0-Set                              SEQUENCE (SIZE (1..maxNrofPUCCH-P0-PerSet)) OF P0-PUCCH                 OPTIONAL, -- Need M\n    pathlossReferenceRSs                SEQUENCE (SIZE (1..maxNrofPUCCH-PathlossReferenceRSs)) OF PUCCH-PathlossReferenceRS\n                                                                                                                OPTIONAL, -- Need M\n    twoPUCCH-PC-AdjustmentStates        ENUMERATED {twoStates}                                                  OPTIONAL, -- Need S\n    ...\n}\n\nP0-PUCCH ::=                            SEQUENCE {\n    p0-PUCCH-Id                             P0-PUCCH-Id,\n    p0-PUCCH-Value                          INTEGER (-16..15)\n}\n\nP0-PUCCH-Id ::=                         INTEGER (1..8)\n\nPUCCH-PathlossReferenceRS ::=                   SEQUENCE {\n    pucch-PathlossReferenceRS-Id                PUCCH-PathlossReferenceRS-Id,\n    referenceSignal                             CHOICE {\n        ssb-Index                                   SSB-Index,\n        csi-RS-Index                                NZP-CSI-RS-ResourceId\n    }\n}\n\n-- TAG-PUCCH-POWERCONTROL-STOP\n-- ASN1STOP\n\n\nP0-PUCCH field descriptions\np0-PUCCH-Value\tP0 value for PUCCH with 1dB step size.\n\nPUCCH-PowerControl field descriptions\ndeltaF-PUCCH-f0\tdeltaF for PUCCH format 0 with 1dB step size (see TS 38.213 [13], clause 7.2).\ndeltaF-PUCCH-f1\tdeltaF for PUCCH format 1 with 1dB step size (see TS 38.213 [13], clause 7.2).\ndeltaF-PUCCH-f2\tdeltaF for PUCCH format 2 with 1dB step size (see TS 38.213 [13], clause 7.2).\ndeltaF-PUCCH-f3\tdeltaF for PUCCH format 3 with 1dB step size (see TS 38.213 [13], clause 7.2).\ndeltaF-PUCCH-f4\tdeltaF for PUCCH format 4 with 1dB step size (see TS 38.213 [13], clause 7.2).\np0-Set\tA set with dedicated P0 values for PUCCH, i.e.,  {P01, P02,... } (see TS 38.213 [13], clause 7.2).\npathlossReferenceRSs\tA set of Reference Signals (e.g. a CSI-RS config or a SS block) to be used for PUCCH pathloss estimation. Up to maxNrofPUCCH-PathlossReference-RSs may be configured. When the field is absent, the UE uses the SSB as reference signal (see TS 38.213 [13], clause 7.2).\ntwoPUCCH-PC-AdjustmentStates\tNumber of PUCCH power control adjustment states maintained by the UE (i.e., g(i)). If the field is present (n2) the UE maintains two power control states (i.e., g(i,0) and g(i,1)). If the field is absent, it maintains one power control state (i.e., g(i,0)) (see TS 38.213 [13], clause 7.2).\n\n\u2013\tPUCCH-SpatialRelationInfo\nThe IE PUCCH-SpatialRelationInfo is used to configure the spatial setting for PUCCH transmission and the parameters for PUCCH power control, see TS 38.213, [13], clause 9.2.2.\nPUCCH-SpatialRelationInfo information element\n-- ASN1START\n-- TAG-PUCCH-SPATIALRELATIONINFO-START\n\nPUCCH-SpatialRelationInfo ::=           SEQUENCE {\n    pucch-SpatialRelationInfoId         PUCCH-SpatialRelationInfoId,\n    servingCellId                           ServCellIndex                                                    OPTIONAL,   -- Need S\n    referenceSignal                         CHOICE {\n        ssb-Index                               SSB-Index,\n        csi-RS-Index                                NZP-CSI-RS-ResourceId,\n        srs                                     SEQUENCE {\n                                                    resource                            SRS-ResourceId,\n                                                    uplinkBWP                           BWP-Id\n                                                }\n    },\n    pucch-PathlossReferenceRS-Id            PUCCH-PathlossReferenceRS-Id,\n    p0-PUCCH-Id                             P0-PUCCH-Id,\n    closedLoopIndex                         ENUMERATED { i0, i1 }\n}\n\nPUCCH-SpatialRelationInfoId ::=         INTEGER (1..maxNrofSpatialRelationInfos)\n\n\n-- TAG-PUCCH-SPATIALRELATIONINFO-STOP\n-- ASN1STOP\n\nPUCCH-SpatialRelationInfo field descriptions\nservingCellId\tIf the field is absent, the UE applies the ServCellId of the serving cell in which this PUCCH-SpatialRelationInfo is configured\n\n\u2013\tPUCCH-TPC-CommandConfig\nThe IE PUCCH-TPC-CommandConfig is used to configure the UE for extracting TPC commands for PUCCH from a group-TPC messages on DCI.\nPUCCH-TPC-CommandConfig information element\n-- ASN1START\n-- TAG-PUCCH-TPC-COMMANDCONFIG-START\n\nPUCCH-TPC-CommandConfig ::=             SEQUENCE {\n    tpc-IndexPCell                          INTEGER (1..15)                         OPTIONAL,   -- Cond PDCCH-OfSpcell\n    tpc-IndexPUCCH-SCell                    INTEGER (1..15)                         OPTIONAL,   -- Cond PDCCH-ofSpCellOrPUCCH-Scell\n    ...\n}\n\n-- TAG-PUCCH-TPC-COMMANDCONFIG-STOP\n-- ASN1STOP\n\nPUCCH-TPC-CommandConfig field descriptions\ntpc-IndexPCell\tAn index determining the position of the first bit of TPC command (applicable to the SpCell) inside the DCI format 2-2 payload.\ntpc-IndexPUCCH-SCell\tAn index determining the position of the first bit of TPC command (applicable to the PUCCH SCell) inside the DCI format 2-2 payload.\n\nConditional Presence\tExplanation\nPDCCH-OfSpcell\nPDCCH-ofSpCellOrPUCCH-Scell\tThe field is mandatory present if the PUCCH-TPC-CommandConfig is provided in the PDCCH-Config for the PUCCH-SCell.\tThe field is optionally present, need R, if the UE is configured with a PUCCH SCell in this cell group and if the PUCCH-TPC-CommandConfig is provided in the PDCCH-Config for the SpCell.\n\n\u2013\tPUSCH-Config\nThe IE PUSCH-Config is used to configure the UE specific PUSCH parameters applicable to a particular BWP.\nPUSCH-Config information element\n-- ASN1START\n-- TAG-PUSCH-CONFIG-START\n\nPUSCH-Config ::=                        SEQUENCE {\n    dataScramblingIdentityPUSCH             INTEGER (0..1023)                                                   OPTIONAL,   -- Need S\n    txConfig                                ENUMERATED {codebook, nonCodebook}                                  OPTIONAL,   -- Need S\n    dmrs-UplinkForPUSCH-MappingTypeA        SetupRelease { DMRS-UplinkConfig }                                  OPTIONAL,   -- Need M\n    dmrs-UplinkForPUSCH-MappingTypeB        SetupRelease { DMRS-UplinkConfig }                                  OPTIONAL,   -- Need M\n\n    pusch-PowerControl                      PUSCH-PowerControl                                                  OPTIONAL,   -- Need M\n    frequencyHopping                        ENUMERATED {intraSlot, interSlot}                                   OPTIONAL,   -- Need S\n    frequencyHoppingOffsetLists             SEQUENCE (SIZE (1..4)) OF INTEGER (1.. maxNrofPhysicalResourceBlocks-1)\n                                                                                                                OPTIONAL,   -- Need M\n    resourceAllocation                      ENUMERATED { resourceAllocationType0, resourceAllocationType1, dynamicSwitch},\n    pusch-TimeDomainAllocationList          SetupRelease { PUSCH-TimeDomainResourceAllocationList }             OPTIONAL,   -- Need M\n    pusch-AggregationFactor                 ENUMERATED { n2, n4, n8 }                                           OPTIONAL,   -- Need S\n    mcs-Table                               ENUMERATED {qam256, qam64LowSE}                                     OPTIONAL,   -- Need S\n    mcs-TableTransformPrecoder              ENUMERATED {qam256, qam64LowSE}                                     OPTIONAL,   -- Need S\n    transformPrecoder                       ENUMERATED {enabled, disabled}                                      OPTIONAL,   -- Need S\n    codebookSubset                          ENUMERATED {fullyAndPartialAndNonCoherent, partialAndNonCoherent,nonCoherent}\n                                                                                                      OPTIONAL, -- Cond codebookBased\n    maxRank                                 INTEGER (1..4)                                            OPTIONAL, -- Cond codebookBased\n    rbg-Size                                ENUMERATED { config2}                                     OPTIONAL, -- Need S\n    uci-OnPUSCH                             SetupRelease { UCI-OnPUSCH}                               OPTIONAL, -- Need M\n    tp-pi2BPSK                              ENUMERATED {enabled}                                      OPTIONAL, -- Need S\n    ...\n}\n\nUCI-OnPUSCH ::=                         SEQUENCE {\n    betaOffsets                             CHOICE {\n            dynamic                             SEQUENCE (SIZE (4)) OF BetaOffsets,\n            semiStatic                          BetaOffsets\n    }                                                                                                             OPTIONAL, -- Need M\n    scaling                                 ENUMERATED { f0p5, f0p65, f0p8, f1 }\n}\n\n-- TAG-PUSCH-CONFIG-STOP\n-- ASN1STOP\n\nPUSCH-Config field descriptions\ncodebookSubset\tSubset of PMIs addressed by TPMI, where PMIs are those supported by UEs with maximum coherence capabilities (see TS 38.214 [19], clause 6.1.1.1).\ndataScramblingIdentityPUSCH\tIdentifier used to initalite data scrambling (c_init) for PUSCH. If the field is absent, the UE applies the physical cell ID. (see TS 38.211 [16], clause 6.3.1.1).\ndmrs-UplinkForPUSCH-MappingTypeA\tDMRS configuration for PUSCH transmissions using PUSCH mapping type A (chosen dynamically via PUSCH-TimeDomainResourceAllocation). Only the fields dmrs-Type, dmrs-AdditionalPosition and maxLength may be set differently for mapping type A and B.\ndmrs-UplinkForPUSCH-MappingTypeB\tDMRS configuration for PUSCH transmissions using PUSCH mapping type B (chosen dynamically via PUSCH-TimeDomainResourceAllocation).Only the fields dmrs-Type, dmrs-AdditionalPosition and maxLength may be set differently for mapping type A and B.\nfrequencyHopping\tThe value intraSlot enables 'Intra-slot frequency hopping' and the value interSlot enables 'Inter-slot frequency hopping'. If the field is absent, frequency hopping is not configured (see TS 38.214 [19], clause 6.3).\nfrequencyHoppingOffsetLists\tSet of frequency hopping offsets used when frequency hopping is enabled for granted transmission (not msg3) and type 2 (see TS 38.214 [19], clause 6.3).\nmaxRank\tSubset of PMIs addressed by TRIs from 1 to ULmaxRank (see TS 38.214 [19], clause 6.1.1.1).\nmcs-Table\tIndicates which MCS table the UE shall use for PUSCH without transform precoder (see TS 38.214 [19], clause 6.1.4.1). If the field is absent the UE applies the value 64QAM\nmcs-TableTransformPrecoder\tIndicates which MCS table the UE shall use for PUSCH with transform precoding (see TS 38.214 [19], clause 6.1.4.1) If the field is absent the UE applies the value 64QAM\npusch-AggregationFactor\tNumber of repetitions for data (see TS 38.214 [19], clause 6.1.2.1). If the field is absent the UE applies the value 1.\npusch-TimeDomainAllocationList\tList of time domain allocations for timing of UL assignment to UL data (see TS 38.214 [19], table 6.1.2.1.1-1).\nrbg-Size\tSelection between configuration 1 and configuration 2 for RBG size for PUSCH. The UE does not apply this field if resourceAllocation is set to resourceAllocationType1. Otherwise, the UE applies the value config1 when the field is absent (see TS 38.214 [19], clause 6.1.2.2.1).\nresourceAllocation\tConfiguration of resource allocation type 0 and resource allocation type 1 for non-fallback DCI (see TS 38.214 [19], clause 6.1.2).\ntp-pi2BPSK\tEnables pi/2-BPSK modulation with transform precoding if the field is present and disables it otherwise. \ntransformPrecoder\tThe UE specific selection of transformer precoder for PUSCH (see TS 38.214 [19], clause 6.1.3). When the field is absent the UE applies the value of the field msg3-transformPrecoder.\ntxConfig\tWhether UE uses codebook based or non-codebook based transmission (see TS 38.214 [19], clause 6.1.1). If the field is absent, the UE transmits PUSCH on one antenna port, see TS 38.214 [19], clause 6.1.1.\n\nUCI-OnPUSCH field descriptions\nbetaOffsets\nscaling\tIndicates a scaling factor to limit the number of resource elements assigned to UCI on PUSCH. Value f0p5 corresponds to 0.5, value f0p65 corresponds to 0.65, and so on. The value configured herein is applicable for PUSCH with configured grant (see TS 38.212 [17], clause 6.3).\n\nConditional Presence\tExplanation\ncodebookBased\tThe field is mandatory present if txConfig is set to codebook and absent otherwise. \n\n\u2013\tPUSCH-ConfigCommon\nThe IE PUSCH-ConfigCommon IE is used to configure the cell specific PUSCH parameters.\nPUSCH-ConfigCommon information element\n-- ASN1START\n-- TAG-PUSCH-CONFIGCOMMON-START\n\nPUSCH-ConfigCommon ::=                  SEQUENCE {\n    groupHoppingEnabledTransformPrecoding   ENUMERATED {enabled}                                                OPTIONAL,   -- Need R\n    pusch-TimeDomainAllocationList          PUSCH-TimeDomainResourceAllocationList                              OPTIONAL,   -- Need R\n    msg3-DeltaPreamble                      INTEGER (-1..6)                                                     OPTIONAL,   -- Need R\n    p0-NominalWithGrant                     INTEGER (-202..24)                                                  OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-PUSCH-CONFIGCOMMON-STOP\n-- ASN1STOP\n\nPUSCH-ConfigCommon field descriptions\ngroupHoppingEnabledTransformPrecoding\tFor DMRS transmission with transform precoder, the NW may configure group hopping by this cell-specific parameter, see TS 38.211 [16], clause 6.4.1.1.1.2.\nmsg3-DeltaPreamble\tPower offset between msg3 and RACH preamble transmission. Actual value = field value * 2 [dB] (see TS 38.213 [13], clause 7.1)\np0-NominalWithGrant\tP0 value for PUSCH with grant (except msg3). Value in dBm. Only even values (step size 2) allowed (see TS 38.213 [13], clause 7.1) This field is cell specific\npusch-TimeDomainAllocationList\tList of time domain allocations for timing of UL assignment to UL data (see TS 38.214 [19], table 6.1.2.1.1-1).\n\n\u2013\tPUSCH-PowerControl\nThe IE PUSCH-PowerControl is used to configure UE specific power control parameter for PUSCH.\nPUSCH-PowerControl information element\n-- ASN1START\n-- TAG-PUSCH-POWERCONTROL-START\n\nPUSCH-PowerControl ::=              SEQUENCE {\n    tpc-Accumulation                    ENUMERATED { disabled }                                                 OPTIONAL, -- Need S\n    msg3-Alpha                          Alpha                                                                   OPTIONAL, -- Need S\n    p0-NominalWithoutGrant              INTEGER (-202..24)                                                      OPTIONAL, -- Need M\n    p0-AlphaSets                        SEQUENCE (SIZE (1..maxNrofP0-PUSCH-AlphaSets)) OF P0-PUSCH-AlphaSet     OPTIONAL, -- Need M\n    pathlossReferenceRSToAddModList     SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS\n                                                                                                                OPTIONAL, -- Need N\n    pathlossReferenceRSToReleaseList    SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS-Id\n                                                                                                                OPTIONAL,  -- Need N\n    twoPUSCH-PC-AdjustmentStates        ENUMERATED {twoStates}                                                  OPTIONAL, -- Need S\n    deltaMCS                            ENUMERATED {enabled}                                                    OPTIONAL, -- Need S\n    sri-PUSCH-MappingToAddModList       SEQUENCE (SIZE (1..maxNrofSRI-PUSCH-Mappings)) OF SRI-PUSCH-PowerControl\n                                                                                                                OPTIONAL, -- Need N\n    sri-PUSCH-MappingToReleaseList      SEQUENCE (SIZE (1..maxNrofSRI-PUSCH-Mappings)) OF SRI-PUSCH-PowerControlId\n                                                                                                                OPTIONAL  -- Need N\n}\n\nP0-PUSCH-AlphaSet ::=               SEQUENCE {\n    p0-PUSCH-AlphaSetId                 P0-PUSCH-AlphaSetId,\n    p0                                  INTEGER (-16..15)                                                       OPTIONAL, -- Need S\n    alpha                               Alpha                                                                   OPTIONAL  -- Need S\n}\n\nP0-PUSCH-AlphaSetId ::=             INTEGER (0..maxNrofP0-PUSCH-AlphaSets-1)\n\nPUSCH-PathlossReferenceRS ::=       SEQUENCE {\n    pusch-PathlossReferenceRS-Id        PUSCH-PathlossReferenceRS-Id,\n    referenceSignal                     CHOICE {\n        ssb-Index                           SSB-Index,\n        csi-RS-Index                        NZP-CSI-RS-ResourceId\n    }\n}\n\nPUSCH-PathlossReferenceRS-Id ::=    INTEGER (0..maxNrofPUSCH-PathlossReferenceRSs-1)\n\n\nSRI-PUSCH-PowerControl ::=          SEQUENCE {\n    sri-PUSCH-PowerControlId            SRI-PUSCH-PowerControlId,\n    sri-PUSCH-PathlossReferenceRS-Id    PUSCH-PathlossReferenceRS-Id,\n    sri-P0-PUSCH-AlphaSetId             P0-PUSCH-AlphaSetId,\n    sri-PUSCH-ClosedLoopIndex           ENUMERATED { i0, i1 }\n}\n\nSRI-PUSCH-PowerControlId ::=        INTEGER (0..maxNrofSRI-PUSCH-Mappings-1)\n\nBetaOffsets ::=                     SEQUENCE {\n    betaOffsetACK-Index1                INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetACK-Index2                INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetACK-Index3                INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetCSI-Part1-Index1          INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetCSI-Part1-Index2          INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetCSI-Part2-Index1          INTEGER(0..31)                                                          OPTIONAL, -- Need S\n    betaOffsetCSI-Part2-Index2          INTEGER(0..31)                                                          OPTIONAL  -- Need S\n}\n\n-- TAG-PUSCH-POWERCONTROL-STOP\n-- ASN1STOP\n\nBetaOffsets field descriptions\nbetaOffsetACK-Index1\tUp to 2 bits HARQ-ACK (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 11\nbetaOffsetACK-Index2\tUp to 11 bits HARQ-ACK (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 11\nbetaOffsetACK-Index3\tAbove 11 bits HARQ-ACK (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 11\nbetaOffsetCSI-Part1-Index1\tUp to 11 bits of CSI part 1 bits (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 13\nbetaOffsetCSI-Part1-Index2\tAbove 11 bits of CSI part 1 bits (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 13\nbetaOffsetCSI-Part2-Index1\tUp to 11 bits of CSI part 2 bits (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 13\nbetaOffsetCSI-Part2-Index2\tAbove 11 bits of CSI part 2 bits (see TS 38.213 [13], clause 9.3) When the field is absent the UE applies the value 13\n\nP0-PUSCH-AlphaSet field descriptions\nalpha\talpha value for PUSCH with grant (except msg3) (see TS 38.213 [13], clause 7.1) When the field is absent the UE applies the value 1\np0\tP0 value for PUSCH with grant (except msg3) in steps of 1dB (see TS 38.213 [13], clause 7.1)\n\nPUSCH-PowerControl field descriptions\ndeltaMCS\tIndicates whether to apply delta MCS. When the field is absent, the UE applies Ks = 0 in delta_TFC formula for PUSCH (see TS 38.213 [13], clause 7.1)\nmsg3-Alpha\tDedicated alpha value for msg3 PUSCH (see TS 38.213 [13], clause 7.1). When the field is absent the UE applies the value 1.\np0-AlphaSets\tconfiguration {p0-pusch, alpha} sets for PUSCH (except msg3), i.e., { {p0,alpha,index1}, {p0,alpha,index2},...} (see TS 38.213 [13], clause 7.1). When no set is configured, the UE uses the P0-nominal for msg3 PUSCH, P0-UE is set to 0 and alpha is set according to msg3-Alpha configured for msg3 PUSCH.\np0-NominalWithoutGrant\tP0 value for UL grant-free/SPS based PUSCH. Value in dBm. Only even values (step size 2) allowed (see TS 38.213 [13], clause 7.1)\npathlossReferenceRSToAddModList\tA set of Reference Signals (e.g. a CSI-RS config or a SS block) to be used for PUSCH path loss estimation. Up to maxNrofPUSCH-PathlossReferenceRSs may be configured (see TS 38.213 [13], clause 7.1)\nsri-PUSCH-MappingToAddModList\tA list of SRI-PUSCH-PowerControl elements among which one is selected by the SRI field in DCI (see TS 38.213 [13], clause 7.1)\ntpc-Accumulation\tIf enabled, UE applies TPC commands via accumulation. If not enabled, UE applies the TPC command without accumulation. If the field is absent, TPC accumulation is enabled (see TS 38.213 [13], clause 7.1)\ntwoPUSCH-PC-AdjustmentStates\tNumber of PUSCH power control adjustment states maintained by the UE (i.e., fc(i)). If the field is present (n2) the UE maintains two power control states (i.e., fc(i,0) and fc(i,1)). If the field is absent, it maintains one power control state (i.e., fc(i,0)) (see TS 38.213 [13], clause 7.1)\n\nSRI-PUSCH-PowerControl field descriptions\nsri-P0-PUSCH-AlphaSetId\tThe ID of a P0-PUSCH-AlphaSet as configured in p0-AlphaSets in PUSCH-PowerControl.\nsri-PUSCH-ClosedLoopIndex\tThe index of the closed power control loop associated with this SRI-PUSCH-PowerControl.\nsri-PUSCH-PathlossReferenceRS-Id\tThe ID of PUSCH-PathlossReferenceRS as configured in the pathlossReferenceRSToAddModList in PUSCH-PowerControl.\nsri-PUSCH-PowerControlId\tThe ID of this SRI-PUSCH-PowerControl configuration. It is used as the codepoint (payload) in the SRI DCI field.\n\n\u2013\tPUSCH-ServingCellConfig\nThe IE PUSCH-ServingCellConfig is used to configure UE specific PUSCH parameters that are common across the UE's BWPs of one serving cell.\nPUSCH-ServingCellConfig information element\n-- ASN1START\n-- TAG-PUSCH-SERVINGCELLCONFIG-START\n\nPUSCH-ServingCellConfig ::=             SEQUENCE {\n    codeBlockGroupTransmission              SetupRelease { PUSCH-CodeBlockGroupTransmission }       OPTIONAL,   -- Need M\n    rateMatching                            ENUMERATED {limitedBufferRM}                            OPTIONAL,   -- Need S\n    xOverhead                               ENUMERATED {xoh6, xoh12, xoh18}                         OPTIONAL,   -- Need S\n    ...,\n    [[\n    maxMIMO-Layers                          INTEGER (1..4)                                          OPTIONAL,   -- Need M\n    processingType2Enabled                  BOOLEAN                                                 OPTIONAL    -- Need M\n    ]]\n}\n\nPUSCH-CodeBlockGroupTransmission ::=    SEQUENCE {\n    maxCodeBlockGroupsPerTransportBlock     ENUMERATED {n2, n4, n6, n8},\n    ...\n}\n\n-- TAG-PUSCH-SERVINGCELLCONFIG-STOP\n-- ASN1STOP\n\nPUSCH-CodeBlockGroupTransmission field descriptions\nmaxCodeBlockGroupsPerTransportBlock\tMaximum number of code-block-groups (CBGs) per TB (see TS 38.213 [13], section 9.1).\n\nPUSCH-ServingCellConfig field descriptions\ncodeBlockGroupTransmission\tEnables and configures code-block-group (CBG) based transmission (see TS 38.214 [19], clause 5.1.5).\nmaxMIMO-Layers\tIndicates the maximum MIMO layer to be used for PUSCH in all BWPs of this serving cell (see TS 38.212 [17], clause 5.4.2.1). If present, the network sets maxRank to the same value. \nprocessingType2Enabled\tEnables configuration of advanced processing time capability 2 for PUSCH (see 38.214 [19], clause 6.4).\nrateMatching\tEnables LBRM (Limited buffer rate-matching). When the field is absent the UE applies FBRM (Full buffer rate-matchingLBRM) (see TS 38.212 [17], clause 5.4.2).\nxOverhead\tAccounts for overhead from CSI-RS, CORESET, etc. If the field is absent, the UE applies the value 'xoh0' (see TS 38.214 [19], clause 5.1.3.2).\n\n\u2013\tPUSCH-TimeDomainResourceAllocationList\nThe IE PUSCH-TimeDomainResourceAllocation is used to configure a time domain relation between PDCCH and PUSCH. PUSCH-TimeDomainResourceAllocationList contains one or more of such PUSCH-TimeDomainResourceAllocations. The network indicates in the UL grant which of the configured time domain allocations the UE shall apply for that UL grant. The UE determines the bit width of the DCI field based on the number of entries in the PUSCH-TimeDomainResourceAllocationList. Value 0 in the DCI field refers to the first element in this list, value 1 in the DCI field refers to the second element in this list, and so on.\nPUSCH-TimeDomainResourceAllocation information element\n-- ASN1START\n-- TAG-PUSCH-TIMEDOMAINRESOURCEALLOCATIONLIST-START\n\nPUSCH-TimeDomainResourceAllocationList ::=  SEQUENCE (SIZE(1..maxNrofUL-Allocations)) OF PUSCH-TimeDomainResourceAllocation\n\nPUSCH-TimeDomainResourceAllocation ::=  SEQUENCE {\n    k2                                      INTEGER(0..32)          OPTIONAL,   -- Need S\n    mappingType                             ENUMERATED {typeA, typeB},\n    startSymbolAndLength                    INTEGER (0..127)\n}\n\n-- TAG-PUSCH-TIMEDOMAINRESOURCEALLOCATIONLIST-STOP\n-- ASN1STOP\n\nPUSCH-TimeDomainResourceAllocationList field descriptions\nk2\tCorresponds to L1 parameter 'K2' (see TS 38.214 [19], clause 6.1.2.1) When the field is absent the UE applies the value 1 when PUSCH SCS is 15/30 kHz; the value 2 when PUSCH SCS is 60 kHz, and the value 3 when PUSCH SCS is 120KHz.\nmappingType\tMapping type (see TS 38.214 [19], clause 6.1.2.1).\nstartSymbolAndLength\tAn index giving valid combinations of start symbol and length (jointly encoded) as start and length indicator (SLIV). The network configures the field so that the allocation does not cross the slot boundary. (see TS 38.214 [19], clause 6.1.2.1).\n\n\u2013\tPUSCH-TPC-CommandConfig\nThe IE PUSCH-TPC-CommandConfig is used to configure the UE for extracting TPC commands for PUSCH from a group-TPC messages on DCI.\nPUSCH-TPC-CommandConfig information element\n-- ASN1START\n-- TAG-PUSCH-TPC-COMMANDCONFIG-START\n\nPUSCH-TPC-CommandConfig ::=         SEQUENCE {\n    tpc-Index                           INTEGER (1..15)                                                 OPTIONAL,   -- Cond SUL\n    tpc-IndexSUL                        INTEGER (1..15)                                                 OPTIONAL,   -- Cond SUL-Only\n    targetCell                          ServCellIndex                                                   OPTIONAL,   -- Need S\n    ...\n}\n\n-- TAG-PUSCH-TPC-COMMANDCONFIG-STOP\n-- ASN1STOP\n\nPUSCH-TPC-CommandConfig field descriptions\ntargetCell\tThe serving cell to which the acquired power control commands are applicable. If the value is absent, the UE applies the TPC commands to the serving cell on which the command has been received.\ntpc-Index\tAn index determining the position of the first bit of TPC command inside the DCI format 2-2 payload.\ntpc-IndexSUL\tAn index determining the position of the first bit of TPC command inside the DCI format 2-2 payload.\n\nConditional Presence\tExplanation\nSUL-Only\tThe field is optionally present, Need R, if this serving cell is configured with a supplementary uplink (SUL). It is absent otherwise. \nSUL\tThe field is optionally present, Need R, if this serving cell is configured with a supplementary uplink (SUL). It is mandatory present otherwise.  \n\n\u2013\tQ-OffsetRange\nThe IE Q-OffsetRange is used to indicate a cell, beam or measurement object specific offset to be applied when evaluating candidates for cell re-selection or when evaluating triggering conditions for measurement reporting. The value is in dB. Value dB-24 corresponds to -24 dB, dB-22 corresponds to -22 dB and so on.\nQ-OffsetRange information element\n-- ASN1START\n-- TAG-Q-OFFSETRANGE-START\n\nQ-OffsetRange ::=                   ENUMERATED {\n                                                dB-24, dB-22, dB-20, dB-18, dB-16, dB-14,\n                                                dB-12, dB-10, dB-8, dB-6, dB-5, dB-4, dB-3,\n                                                dB-2, dB-1, dB0, dB1, dB2, dB3, dB4, dB5,\n                                                dB6, dB8, dB10, dB12, dB14, dB16, dB18,\n                                                dB20, dB22, dB24}\n\n-- TAG-Q-OFFSETRANGE-STOP\n-- ASN1STOP\n\n\u2013\tQ-QualMin\nThe IE Q-QualMin is used to indicate for cell selection/ re-selection the required minimum received RSRQ level in the (NR) cell. Corresponds to parameter Qqualmin in TS 38.304 [20]. Actual value Qqualmin = field value [dB].\nQ-QualMin information element\n-- ASN1START\n-- TAG-Q-QUALMIN-START\n\nQ-QualMin ::=                       INTEGER (-43..-12)\n\n-- TAG-Q-QUALMIN-STOP\n-- ASN1STOP\n\n\u2013\tQ-RxLevMin\nThe IE Q-RxLevMin is used to indicate for cell selection/ re-selection the required minimum received RSRP level in the (NR) cell. Corresponds to parameter Qrxlevmin in TS 38.304 [20]. Actual value Qrxlevmin = field value * 2 [dBm].\nQ-RxLevMin information element\n-- ASN1START\n-- TAG-Q-RXLEVMIN-START\n\nQ-RxLevMin ::=                      INTEGER (-70..-22)\n\n-- TAG-Q-RXLEVMIN-STOP\n-- ASN1STOP\n\n\u2013\tQuantityConfig\nThe IE QuantityConfig specifies the measurement quantities and layer 3 filtering coefficients for NR and inter-RAT measurements.\nQuantityConfig information element\n-- ASN1START\n-- TAG-QUANTITYCONFIG-START\n\n\nQuantityConfig ::=                  SEQUENCE {\n    quantityConfigNR-List               SEQUENCE (SIZE (1..maxNrofQuantityConfig)) OF QuantityConfigNR          OPTIONAL,   -- Need M\n    ...,\n    [[\n    quantityConfigEUTRA                 FilterConfig                                                            OPTIONAL    -- Need M\n    ]]\n}\n\nQuantityConfigNR::=                 SEQUENCE {\n    quantityConfigCell                  QuantityConfigRS,\n    quantityConfigRS-Index              QuantityConfigRS                                                        OPTIONAL    -- Need M\n}\n\nQuantityConfigRS ::=                SEQUENCE {\n    ssb-FilterConfig                    FilterConfig,\n    csi-RS-FilterConfig                 FilterConfig\n}\n\nFilterConfig ::=                    SEQUENCE {\n    filterCoefficientRSRP               FilterCoefficient                                       DEFAULT fc4,\n    filterCoefficientRSRQ               FilterCoefficient                                       DEFAULT fc4,\n    filterCoefficientRS-SINR            FilterCoefficient                                       DEFAULT fc4\n}\n\n-- TAG-QUANTITYCONFIG-STOP\n-- ASN1STOP\n\nQuantityConfigNR field descriptions\nquantityConfigCell\tSpecifies L3 filter configurations for cell measurement results for the configurable RS Types (e.g. SS/PBCH block and CSI-RS) and the configurable measurement quantities (e.g. RSRP, RSRQ and SINR).\nquantityConfigRS-Index\tSpecifies L3 filter configurations for measurement results per RS index for the configurable RS Types (e.g. SS/PBCH block and CSI-RS) and the configurable measurement quantities (e.g. RSRP, RSRQ and SINR).\n\nQuantityConfigRS field descriptions\ncsi-RS-FilterConfig\tCSI-RS based L3 filter configurations:\tSpecifies L3 filter configurations for CSI-RSRP, CSI-RSRQ and CSI-SINR measurement results from the L1 filter(s), as defined in TS 38.215 [9].\nssb-FilterConfig\tSS Block based L3 filter configurations:\tSpecifies L3 filter configurations for SS-RSRP, SS-RSRQ and SS-SINR measurement results from the L1 filter(s), as defined in TS 38.215 [9].\n\n\u2013\tRACH-ConfigCommon\nThe IE RACH-ConfigCommon is used to specify the cell specific random-access parameters.\nRACH-ConfigCommon information element\n-- ASN1START\n-- TAG-RACH-CONFIGCOMMON-START\n\nRACH-ConfigCommon ::=               SEQUENCE {\n    rach-ConfigGeneric                  RACH-ConfigGeneric,\n    totalNumberOfRA-Preambles           INTEGER (1..63)                                                     OPTIONAL,   -- Need S\n    ssb-perRACH-OccasionAndCB-PreamblesPerSSB   CHOICE {\n        oneEighth                               ENUMERATED {n4,n8,n12,n16,n20,n24,n28,n32,n36,n40,n44,n48,n52,n56,n60,n64},\n        oneFourth                               ENUMERATED {n4,n8,n12,n16,n20,n24,n28,n32,n36,n40,n44,n48,n52,n56,n60,n64},\n        oneHalf                                 ENUMERATED {n4,n8,n12,n16,n20,n24,n28,n32,n36,n40,n44,n48,n52,n56,n60,n64},\n        one                                     ENUMERATED {n4,n8,n12,n16,n20,n24,n28,n32,n36,n40,n44,n48,n52,n56,n60,n64},\n        two                                     ENUMERATED {n4,n8,n12,n16,n20,n24,n28,n32},\n        four                                    INTEGER (1..16),\n        eight                                   INTEGER (1..8),\n        sixteen                                 INTEGER (1..4)\n    }                                                                                                       OPTIONAL,   -- Need M\n\n    groupBconfigured                    SEQUENCE {\n        ra-Msg3SizeGroupA                   ENUMERATED {b56, b144, b208, b256, b282, b480, b640,\n                                                        b800, b1000, b72, spare6, spare5,spare4, spare3, spare2, spare1},\n        messagePowerOffsetGroupB            ENUMERATED { minusinfinity, dB0, dB5, dB8, dB10, dB12, dB15, dB18},\n        numberOfRA-PreamblesGroupA          INTEGER (1..64)\n    }                                                                                                       OPTIONAL,   -- Need R\n    ra-ContentionResolutionTimer            ENUMERATED { sf8, sf16, sf24, sf32, sf40, sf48, sf56, sf64},\n    rsrp-ThresholdSSB                       RSRP-Range                                                      OPTIONAL,   -- Need R\n    rsrp-ThresholdSSB-SUL                   RSRP-Range                                                      OPTIONAL,   -- Cond SUL\n    prach-RootSequenceIndex                 CHOICE {\n        l839                                    INTEGER (0..837),\n        l139                                    INTEGER (0..137)\n    },\n    msg1-SubcarrierSpacing                  SubcarrierSpacing                                               OPTIONAL,   -- Cond L139\n    restrictedSetConfig                     ENUMERATED {unrestrictedSet, restrictedSetTypeA, restrictedSetTypeB},\n    msg3-transformPrecoder                  ENUMERATED {enabled}                                            OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-RACH-CONFIGCOMMON-STOP\n-- ASN1STOP\n\nRACH-ConfigCommon field descriptions\nmessagePowerOffsetGroupB\tThreshold for preamble selection. Value is in dB. Value minusinfinity corresponds to \u2013infinity. Value dB0 corresponds to 0 dB, dB5 corresponds to 5 dB and so on. (see TS 38.321 [3], clause 5.1.2)\nmsg1-SubcarrierSpacing\tSubcarrier spacing of PRACH (see TS 38.211 [16], clause 5.3.2). Only the values 15 or 30 kHz (<6GHz), 60 or 120 kHz (>6GHz) are applicable. If absent, the UE applies the SCS as derived from the prach-ConfigurationIndex in RACH-ConfigGeneric (see tables Table 6.3.3.1-1 and Table 6.3.3.2-2, TS 38.211 [16]). The value also applies to contention free random access (RACH-ConfigDedicated), to SI-request and to contention-based beam failure recovery (CB-BFR). But it does not apply for contention free beam failure recovery (CF-BFR) (see BeamFailureRecoveryConfig).\nmsg3-transformPrecoder\tEnables the transform precoder for Msg3 transmission according to clause 6.1.3 of TS 38.214 [19]. If the field is absent, the UE disables the transformer precoder (see TS 38.213 [13], clause 8.3).\nnumberOfRA-PreamblesGroupA\tThe number of CB preambles per SSB in group A. This determines implicitly the number of CB preambles per SSB available in group B. (see TS 38.321 [3], clause 5.1.1). The setting should be consistent with the setting of ssb-perRACH-OccasionAndCB-PreamblesPerSSB.\nprach-RootSequenceIndex\tPRACH root sequence index (see TS 38.211 [16], clause 6.3.3.1). The value range depends on whether L=839 or L=139. The short/long preamble format indicated in this IE should be consistent with the one indicated in prach-ConfigurationIndex in the RACH-ConfigDedicated (if configured).\nra-ContentionResolutionTimer\tThe initial value for the contention resolution timer (see TS 38.321 [3], clause 5.1.5). Value sf8 corresponds to 8 subframes, value sf16 corresponds to 16 subframes, and so on.\nra-Msg3SizeGroupA\tTransport Blocks size threshold in bits below which the UE shall use a contention-based RA preamble of group A. (see TS 38.321 [3], clause 5.1.2).\nrach-ConfigGeneric\tRACH parameters for both regular random access and beam failure recovery.\nrestrictedSetConfig\tConfiguration of an unrestricted set or one of two types of restricted sets, see TS 38.211 [16], clause 6.3.3.1.\nrsrp-ThresholdSSB\tUE may select the SS block and corresponding PRACH resource for path-loss estimation and (re)transmission based on SS blocks that satisfy the threshold (see TS 38.213 [13]).\nrsrp-ThresholdSSB-SUL\tThe UE selects SUL carrier to perform random access based on this threshold (see TS 38.321 [3], clause 5.1.1). The value applies to all the BWPs.\nssb-perRACH-OccasionAndCB-PreamblesPerSSB\tThe meaning of this field is twofold: the CHOICE conveys the information about the number of SSBs per RACH occasion. Value oneEight corresponds to one SSB associated with 8 RACH occasions, value oneFourth corresponds to one SSB associated with 4 RACH occasions, and so on. The ENUMERATED part indicates the number of Contention Based preambles per SSB. Value n4 corresponds to 4 Contention Based preambles per SSB, value n8 corresponds to 8 Contention Based preambles per SSB, and so on. The total number of CB preambles in a RACH occasion is given by CB-preambles-per-SSB * max(1, SSB-per-rach-occasion). See TS 38.213 [13].\ntotalNumberOfRA-Preambles\tTotal number of preambles used for contention based and contention free random access in the RACH resources defined in RACH-ConfigCommon, excluding preambles used for other purposes (e.g. for SI request). If the field is absent, all 64 preambles are available for RA. The setting should be consistent with the setting of ssb-perRACH-OccasionAndCB-PreamblesPerSSB, i.e. it should be a multiple of the number of SSBs per RACH occasion.\n\nConditional Presence\tExplanation\nL139\tThe field is mandatory present if prach-RootSequenceIndex L=139, otherwise the field is absent. \nSUL\tThe field is mandatory present in initialUplinkBWP in supplementaryUplink; otherwise, the field is absent. \n\n\u2013\tRACH-ConfigDedicated\nThe IE RACH-ConfigDedicated is used to specify the dedicated random access parameters.\nRACH-ConfigDedicated information element\n-- ASN1START\n-- TAG-RACH-CONFIGDEDICATED-START\n\n\nRACH-ConfigDedicated ::=        SEQUENCE {\n    cfra                            CFRA                                                                    OPTIONAL, -- Need S\n    ra-Prioritization               RA-Prioritization                                                       OPTIONAL, -- Need N\n    ...\n}\n\nCFRA ::=                    SEQUENCE {\n    occasions                       SEQUENCE {\n        rach-ConfigGeneric              RACH-ConfigGeneric,\n        ssb-perRACH-Occasion            ENUMERATED {oneEighth, oneFourth, oneHalf, one, two, four, eight, sixteen}\n                                                                                                            OPTIONAL  -- Cond SSB-CFRA\n    }                                                                                                       OPTIONAL, -- Need S\n    resources                       CHOICE {\n        ssb                             SEQUENCE {\n            ssb-ResourceList                SEQUENCE (SIZE(1..maxRA-SSB-Resources)) OF CFRA-SSB-Resource,\n            ra-ssb-OccasionMaskIndex        INTEGER (0..15)\n        },\n        csirs                           SEQUENCE {\n            csirs-ResourceList              SEQUENCE (SIZE(1..maxRA-CSIRS-Resources)) OF CFRA-CSIRS-Resource,\n            rsrp-ThresholdCSI-RS            RSRP-Range\n        }\n    },\n    ...,\n    [[\n    totalNumberOfRA-Preambles-v1530 INTEGER (1..63)                                                         OPTIONAL -- Cond Occasions\n    ]]\n}\n\nCFRA-SSB-Resource ::=           SEQUENCE {\n    ssb                             SSB-Index,\n    ra-PreambleIndex                INTEGER (0..63),\n    ...\n}\n\nCFRA-CSIRS-Resource ::=         SEQUENCE {\n    csi-RS                          CSI-RS-Index,\n    ra-OccasionList                 SEQUENCE (SIZE(1..maxRA-OccasionsPerCSIRS)) OF INTEGER (0..maxRA-Occasions-1),\n    ra-PreambleIndex                INTEGER (0..63),\n    ...\n}\n\n-- TAG-RACH-CONFIGDEDICATED-STOP\n-- ASN1STOP\n\nCFRA-CSIRS-Resource field descriptions\ncsi-RS\tThe ID of a CSI-RS resource defined in the measurement object associated with this serving cell.\nra-OccasionList\tRA occasions that the UE shall use when performing CF-RA upon selecting the candidate beam identified by this CSI-RS. The network ensures that the RA occasion indexes provided herein are also configured by prach-ConfigurationIndex and msg1-FDM. Each RACH occasion is sequentially numbered, first, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions; second, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot and Third, in increasing order of indexes for PRACH slots.\nra-PreambleIndex\tThe RA preamble index to use in the RA occasions associated with this CSI-RS.\n\nCFRA field descriptions\noccasions\tRA occasions for contention free random access. If the field is absent, the UE uses the RA occasions configured in RACH-ConfigCommon in the first active UL BWP.\nra-ssb-OccasionMaskIndex\tExplicitly signalled PRACH Mask Index for RA Resource selection in TS 36.321. The mask is valid for all SSB resources signalled in ssb-ResourceList\nrach-ConfigGeneric\tConfiguration of contention free random access occasions for CFRA. The UE shall ignore preambleReceivedTargetPower, preambleTransMax, powerRampingStep, ra-ResponseWindow signaled within this field and use the corresponding values provided in RACH-ConfigCommon.\nssb-perRACH-Occasion\tNumber of SSBs per RACH occasion.\ntotalNumberOfRA-Preambles\tTotal number of preambles used for contention free random access in the RACH resources defined in CFRA, excluding preambles used for other purposes (e.g. for SI request). If the field is absent but the field occasions is present, the UE may assume all the 64 preambles are for RA. The setting should be consistent with the setting of ssb-perRACH-Occasion, if present, i.e. it should be a multiple of the number of SSBs per RACH occasion.\n\nCFRA-SSB-Resource field descriptions\nra-PreambleIndex\tThe preamble index that the UE shall use when performing CF-RA upon selecting the candidate beams identified by this SSB.\nssb\tThe ID of an SSB transmitted by this serving cell.\n\nRACH-ConfigDedicated field descriptions\ncfra\tParameters for contention free random access to a given target cell. If the field is absent, the UE performs contention based random access.\nra-prioritization\tParameters which apply for prioritized random access procedure to a given target cell (see TS 38.321 [3], clause 5.1.1).\n\nConditional Presence\tExplanation\nSSB-CFRA\tThe field is mandatory present if the field resources in CFRA is set to ssb; otherwise it is not present. \nOccasions\tThe field is optionally present, Need S, if the field occasions is present, otherwise it is not present. \n\n\u2013\tRACH-ConfigGeneric\nThe IE RACH-ConfigGeneric is used to specify the random-access parameters both for regular random access as well as for beam failure recovery.\nRACH-ConfigGeneric information element\n-- ASN1START\n-- TAG-RACH-CONFIGGENERIC-START\n\nRACH-ConfigGeneric ::=              SEQUENCE {\n    prach-ConfigurationIndex            INTEGER (0..255),\n    msg1-FDM                            ENUMERATED {one, two, four, eight},\n    msg1-FrequencyStart                 INTEGER (0..maxNrofPhysicalResourceBlocks-1),\n    zeroCorrelationZoneConfig           INTEGER(0..15),\n    preambleReceivedTargetPower         INTEGER (-202..-60),\n    preambleTransMax                    ENUMERATED {n3, n4, n5, n6, n7, n8, n10, n20, n50, n100, n200},\n    powerRampingStep                    ENUMERATED {dB0, dB2, dB4, dB6},\n    ra-ResponseWindow                   ENUMERATED {sl1, sl2, sl4, sl8, sl10, sl20, sl40, sl80},\n    ...\n}\n\n-- TAG-RACH-CONFIGGENERIC-STOP\n-- ASN1STOP\n\nRACH-ConfigGeneric field descriptions\nmsg1-FDM\tThe number of PRACH transmission occasions FDMed in one time instance. (see TS 38.211 [16], clause 6.3.3.2).\nmsg1-FrequencyStart\tOffset of lowest PRACH transmission occasion in frequency domain with respective to PRB 0. The value is configured so that the corresponding RACH resource is entirely within the bandwidth of the UL BWP. (see TS 38.211 [16], clause 6.3.3.2).\npowerRampingStep\tPower ramping steps for PRACH (see TS 38.321 [3],5.1.3).\nprach-ConfigurationIndex\tPRACH configuration index. For prach-ConfigurationIndex configured under beamFailureRecovery-Config, the prach-ConfigurationIndex can only correspond to the short preamble format, (see TS 38.211 [16], clause 6.3.3.2).\npreambleReceivedTargetPower\tThe target power level at the network receiver side (see TS 38.213 [13], clause 7.4, TS 38.321 [3], clauses 5.1.2, 5.1.3). Only multiples of 2 dBm may be chosen (e.g. -202, -200, -198, ...). \npreambleTransMax\tMax number of RA preamble transmission performed before declaring a failure (see TS 38.321 [3], clauses 5.1.4, 5.1.5).\nra-ResponseWindow\tMsg2 (RAR) window length in number of slots. The network configures a value lower than or equal to 10 ms (see TS 38.321 [3], clause 5.1.4). UE ignores the field if included in SCellConfig.\nzeroCorrelationZoneConfig\tN-CS configuration, see Table 6.3.3.1-5 in TS 38.211 [16].\n\n\u2013\tRA-Prioritization\nThe IE RA-Prioritization is used to configure prioritized random access.\nRA-Prioritization information element\n-- ASN1START\n-- TAG-RA-PRIORITIZATION-START\n\nRA-Prioritization ::=           SEQUENCE {\n    powerRampingStepHighPriority        ENUMERATED {dB0, dB2, dB4, dB6},\n    scalingFactorBI                 ENUMERATED {zero, dot25, dot5, dot75}                               OPTIONAL,   -- Need R\n    ...\n}\n\n-- TAG-RA-PRIORITIZATION-STOP\n-- ASN1STOP\n\nRA-Prioritization field descriptions\npowerRampingStepHighPrioritiy\tPower ramping step applied for prioritized random access procedure.\nscalingFactorBI\tScaling factor for the backoff indicator (BI) for the prioritized random access procedure. (see TS 38.321 [3], clause 5.1.4). Value zero corresponds to 0, value dot25 corresponds to 0.25 and so on.\n\n\u2013\tRadioBearerConfig\nThe IE RadioBearerConfig is used to add, modify and release signalling and/or data radio bearers. Specifically, this IE carries the parameters for PDCP and, if applicable, SDAP entities for the radio bearers.\nRadioBearerConfig information element\n-- ASN1START\n-- TAG-RADIOBEARERCONFIG-START\n\nRadioBearerConfig ::=                   SEQUENCE {\n    srb-ToAddModList                        SRB-ToAddModList                                        OPTIONAL,   -- Cond HO-Conn\n    srb3-ToRelease                          ENUMERATED{true}                                        OPTIONAL,   -- Need N\n    drb-ToAddModList                        DRB-ToAddModList                                        OPTIONAL,   -- Cond HO-toNR\n    drb-ToReleaseList                       DRB-ToReleaseList                                       OPTIONAL,   -- Need N\n    securityConfig                          SecurityConfig                                          OPTIONAL,   -- Need M\n    ...\n}\n\nSRB-ToAddModList ::=                    SEQUENCE (SIZE (1..2)) OF SRB-ToAddMod\nSRB-ToAddMod ::=                        SEQUENCE {\n    srb-Identity                            SRB-Identity,\n    reestablishPDCP                         ENUMERATED{true}                                        OPTIONAL,   -- Need N\n    discardOnPDCP                           ENUMERATED{true}                                        OPTIONAL,   -- Need N\n    pdcp-Config                             PDCP-Config                                             OPTIONAL,   -- Cond PDCP\n    ...\n}\n\nDRB-ToAddModList ::=                    SEQUENCE (SIZE (1..maxDRB)) OF DRB-ToAddMod\nDRB-ToAddMod ::=                        SEQUENCE {\n    cnAssociation                           CHOICE {\n        eps-BearerIdentity                      INTEGER (0..15),                                                -- EPS-DRB-Setup\n        sdap-Config                             SDAP-Config                                                     -- 5GC\n    }                                                                                               OPTIONAL,   -- Cond DRBSetup\n    drb-Identity                            DRB-Identity,\n    reestablishPDCP                         ENUMERATED{true}                                        OPTIONAL,   -- Need N\n    recoverPDCP                             ENUMERATED{true}                                        OPTIONAL,   -- Need N\n    pdcp-Config                             PDCP-Config                                             OPTIONAL,   -- Cond PDCP\n    ...\n}\nDRB-ToReleaseList ::=                   SEQUENCE (SIZE (1..maxDRB)) OF DRB-Identity\n\nSecurityConfig ::=                      SEQUENCE {\n    securityAlgorithmConfig                 SecurityAlgorithmConfig                                 OPTIONAL,   -- Cond RBTermChange\n    keyToUse                                ENUMERATED{master, secondary}                           OPTIONAL,   -- Cond RBTermChange\n    ...\n}\n\n\n\n-- TAG-RADIOBEARERCONFIG-STOP\n-- ASN1STOP\n\nDRB-ToAddMod field descriptions\ncnAssociation\tIndicates if the bearer is associated with the eps-bearerIdentity (when connected to EPC) or sdap-Config (when connected to 5GC).\ndrb-Identity\tIn case of DC, the DRB identity is unique within the scope of the UE, i.e. an MCG DRB cannot use the same value as a split DRB. For a split DRB the same identity is used for the MCG and SCG parts of the configuration.\neps-BearerIdentity\tThe EPS bearer ID determines the EPS bearer.\nreestablishPDCP\tIndicates that PDCP should be re-established. Network sets this to true whenever the security key used for this radio bearer changes. Key change could for example be due to termination point change for the bearer, reconfiguration with sync, resuming an RRC connection, or the first reconfiguration after reestablishment. It is also applicable for LTE procedures when NR PDCP is configured.\nrecoverPDCP\tIndicates that PDCP should perform recovery according to TS 38.323 [5].\nsdap-Config\tThe SDAP configuration determines how to map QoS flows to DRBs when NR connects to the 5GC and presence/absence of UL/DL SDAP headers.\n\nRadioBearerConfig field descriptions\nsecurityConfig\tIndicates the security algorithm and key to use for the signalling and data radio bearers configured with the list in this radioBearerConfig. When the field is not included after AS security has been activated, the UE shall continue to use the currently configured keyToUse and security algorithm for the radio bearers reconfigured with the lists in this radioBearerConfig except for mobility from NR to E-UTRA/5GC. The field is not included when configuring SRB1 before AS security is activated.\nsrb3-ToRelease\tRelease SRB3. SRB3 release can only be done over SRB1 and only at SCG release and reconfiguration with sync.\n\nSecurityConfig field descriptions\nkeyToUse\tIndicates if the bearers configured with the list in this radioBearerConfig is using the master key or the secondary key for deriving ciphering and/or integrity protection keys. For EN-DC, network should not configure SRB1 and SRB2 with secondary key and SRB3 with the master key. When the field is not included, the UE shall continue to use the currently configured keyToUse for the radio bearers reconfigured with the lists in this radioBearerConfig except for mobility from NR to E-UTRA/5GC.\nsecurityAlgorithmConfig\tIndicates the security algorithm for the signalling and data radio bearers configured with the list in this radioBearerConfig. When the field is not included, the UE shall continue to use the currently configured security algorithm for the radio bearers reconfigured with the lists in this radioBearerConfig except for mobility from NR to E-UTRA/5GC.\n\nSRB-ToAddMod field descriptions\ndiscardOnPDCP\tIndicates that PDCP should discard stored SDU and PDU according to TS 38.323 [5].\nreestablishPDCP\tIndicates that PDCP should be re-established. Network sets this to true whenever the security key used for this radio bearer changes. Key change could for example be due to reconfiguration with sync, for SRB2 when resuming an RRC connection, or at the first reconfiguration after RRC connection reestablishment in NR. For LTE SRBs using NR PDCP, it could be for handover, RRC connection reestablishment or resume.\nsrb-Identity\tValue 1 is applicable for SRB1 only. Value 2 is applicable for SRB2 only. Value 3 is applicable for SRB3 only.\n\nConditional Presence\tExplanation\nRBTermChange\tThe field is mandatory present in case of set up of signalling and data radio bearer and change of termination point for the radio bearer between MN and SN. It is optionally present otherwise, Need S.\nPDCP\tThe field is mandatory present if the corresponding DRB is being setup or corresponding RB is reconfigured with NR PDCP; otherwise the field is optionally present, need M.\nDRBSetup\tThe field is mandatory present if the corresponding DRB is being setup; otherwise the field is optionally present, need M.\nHO-Conn\tThe field is mandatory present in case of inter-system handover from E-UTRA (connected to EPC) to E-UTRA (connected to 5GC) or NR, or when the fullConfig is included in the RRCReconfiguration message, or in case of RRCSetup; otherwise the field is optionally present, need N. Upon RRCSetup, only SRB1 can be present.\nHO-toNR\tThe field is mandatory present in case of inter-system handover from E-UTRA (connected to EPC) to E-UTRA (connected to 5GC) or NR, or when the fullConfig is included in the RRCReconfiguration message. In case of RRCSetup, the field is not present; otherwise the field is optionally present, need N. \n\n\u2013\tRadioLinkMonitoringConfig\nThe IE RadioLinkMonitoringConfig is used to configure radio link monitoring for detection of beam- and/or cell radio link failure. See also TS 38.321 [3], clause 5.1.1.\nRadioLinkMonitoringConfig information element\n-- ASN1START\n-- TAG-RADIOLINKMONITORINGCONFIG-START\n\nRadioLinkMonitoringConfig ::=       SEQUENCE {\n    failureDetectionResourcesToAddModList   SEQUENCE (SIZE(1..maxNrofFailureDetectionResources)) OF RadioLinkMonitoringRS\n                                                                                                                  OPTIONAL, -- Need N\n    failureDetectionResourcesToReleaseList  SEQUENCE (SIZE(1..maxNrofFailureDetectionResources)) OF RadioLinkMonitoringRS-Id\n                                                                                                                  OPTIONAL, -- Need N\n    beamFailureInstanceMaxCount             ENUMERATED {n1, n2, n3, n4, n5, n6, n8, n10}                          OPTIONAL, -- Need R\n    beamFailureDetectionTimer               ENUMERATED {pbfd1, pbfd2, pbfd3, pbfd4, pbfd5, pbfd6, pbfd8, pbfd10}  OPTIONAL, -- Need R\n    ...\n}\n\nRadioLinkMonitoringRS ::=           SEQUENCE {\n    radioLinkMonitoringRS-Id            RadioLinkMonitoringRS-Id,\n    purpose                             ENUMERATED {beamFailure, rlf, both},\n    detectionResource                   CHOICE {\n        ssb-Index                           SSB-Index,\n        csi-RS-Index                        NZP-CSI-RS-ResourceId\n    },\n    ...\n}\n\n-- TAG-RADIOLINKMONITORINGCONFIG-STOP\n-- ASN1STOP\n\nRadioLinkMonitoringConfig field descriptions\nbeamFailureDetectionTimer\tTimer for beam failure detection (see TS 38.321 [3], clause 5.17). See also the BeamFailureRecoveryConfig IE. Value in number of \"Qout,LR reporting periods of Beam Failure Detection\" Reference Signal (see TS 38.213 [13], clause 6). Value pbfd1 corresponds to 1 Qout,LR reporting period of Beam Failure Detection Reference Signal, value pbfd2 corresponds to 2 Qout,LR reporting periods of Beam Failure Detection Reference Signal and so on. \nbeamFailureInstanceMaxCount\tThis field determines after how many beam failure events the UE triggers beam failure recovery (see TS 38.321 [3], clause 5.17). Value n1 corresponds to 1 beam failure instance, value n2 corresponds to 2 beam failure instances and so on. \nfailureDetectionResourcesToAddModList\tA list of reference signals for detecting beam failure and/or cell level radio link failure (RLF). The limits of the reference signals that the network can configure are specified in TS 38.213 [13], Table 5-1. The network configures at most two detectionResources per BWP for the purpose beamFailure or both. If no RSs are provided for the purpose of beam failure detection, the UE performs beam monitoring based on the activated TCI-State for PDCCH as described in TS 38.213 [13], clause 6. If no RSs are provided in this list for the purpose of RLF detection, the UE performs Cell-RLM based on the activated TCI-State of PDCCH as described in TS 38.213 [13], clause 5. The network ensures that the UE has a suitable set of reference signals for performing cell-RLM. \n\nRadioLinkMonitoringRS field descriptions\ndetectionResource\tA reference signal that the UE shall use for radio link monitoring or beam failure detection (depending on the indicated purpose). \npurpose\tDetermines whether the UE shall monitor the associated reference signal for the purpose of cell- and/or beam failure detection.\n\n\u2013\tRadioLinkMonitoringRS-Id\nThe IE RadioLinkMonitoringRS-Id is used to identify one RadioLinkMonitoringRS.\nRadioLinkMonitoringRS-Id information element\n-- ASN1START\n-- TAG-RADIOLINKMONITORINGRS-ID-START\n\nRadioLinkMonitoringRS-Id ::=            INTEGER (0..maxNrofFailureDetectionResources-1)\n\n-- TAG-RADIOLINKMONITORINGRS-ID-STOP\n-- ASN1STOP\n\n\u2013\tRAN-AreaCode\nThe IE RAN-AreaCode is used to identify a RAN area within the scope of a tracking area.\nRAN-AreaCode information element\n-- ASN1START\n-- TAG-RAN-AREACODE-START\n\nRAN-AreaCode ::=                INTEGER (0..255)\n\n-- TAG-RAN-AREACODE-STOP\n-- ASN1STOP\n\n\u2013\tRateMatchPattern\nThe IE RateMatchPattern is used to configure one rate matching pattern for PDSCH, see TS 38.214 [19], clause 5.1.4.1.\nRateMatchPattern information element\n-- ASN1START\n-- TAG-RATEMATCHPATTERN-START\n\nRateMatchPattern ::=                SEQUENCE {\n    rateMatchPatternId                  RateMatchPatternId,\n\n    patternType                         CHOICE {\n        bitmaps                             SEQUENCE {\n            resourceBlocks                      BIT STRING (SIZE (275)),\n            symbolsInResourceBlock              CHOICE {\n                oneSlot                             BIT STRING (SIZE (14)),\n                twoSlots                            BIT STRING (SIZE (28))\n            },\n            periodicityAndPattern               CHOICE {\n                n2                                  BIT STRING (SIZE (2)),\n                n4                                  BIT STRING (SIZE (4)),\n                n5                                  BIT STRING (SIZE (5)),\n                n8                                  BIT STRING (SIZE (8)),\n                n10                                 BIT STRING (SIZE (10)),\n                n20                                 BIT STRING (SIZE (20)),\n                n40                                 BIT STRING (SIZE (40))\n            }                                                                                           OPTIONAL,   -- Need S\n            ...\n        },\n        controlResourceSet                  ControlResourceSetId\n    },\n    subcarrierSpacing                   SubcarrierSpacing                                               OPTIONAL,   -- Cond CellLevel\n    dummy                               ENUMERATED { dynamic, semiStatic },\n    ...\n}\n\n-- TAG-RATEMATCHPATTERN-STOP\n-- ASN1STOP\n\nRateMatchPattern field descriptions\nbitmaps\tIndicates rate matching pattern by a pair of bitmaps resourceBlocks and symbolsInResourceBlock to define the rate match pattern within one or two slots, and a third bitmap periodicityAndPattern to define the repetition pattern with which the pattern defined by the above bitmap pair occurs.\ncontrolResourceSet\tThis ControlResourceSet is used as a PDSCH rate matching pattern, i.e., PDSCH reception rate matches around it. In frequency domain, the resource is determined by the frequency domain resource of the CORESET with the corresponding CORESET ID. Time domain resource is determined by the parameters of the associated search space of the CORESET.\nperiodicityAndPattern\tA time domain repetition pattern at which the pattern defined by symbolsInResourceBlock and resourceBlocks recurs. This slot pattern repeats itself continuously. Absence of this field indicates the value n1, i.e., the symbolsInResourceBlock recurs every 14 symbols (see TS 38.214 [19], clause 5.1.4.1).\nresourceBlocks\tA resource block level bitmap in the frequency domain. A bit in the bitmap set to 1 indicates that the UE shall apply rate matching in the corresponding resource block in accordance with the symbolsInResourceBlock bitmap. If used as cell-level rate matching pattern, the bitmap identifies \"common resource blocks (CRB)\". If used as BWP-level rate matching pattern, the bitmap identifies \"physical resource blocks\" inside the BWP. The first/ leftmost bit corresponds to resource block 0, and so on (see TS 38.214 [19], clause 5.1.4.1). \nsubcarrierSpacing\tThe SubcarrierSpacing for this resource pattern. If the field is absent, the UE applies the SCS of the associated BWP. The value kHz15 corresponds to \u00b5=0, the value kHz30 corresponds to \u00b5=1, and so on. Only the values 15 kHz or 30 kHz (<6GHz), 60 kHz or 120 kHz (>6GHz) are applicable (see TS 38.214 [19], clause 5.1.4.1).\nsymbolsInResourceBlock\tA symbol level bitmap in time domain. It indicates with a bit set to true that the UE shall rate match around the corresponding symbol. The first/left-most bit in the bitmap corresponds to the first symbol in the slot, and so on. This pattern recurs (in time domain) with the configured periodicityAndPattern (see TS 38.214 [19], clause 5.1.4.1).\n\nConditional Presence\tExplanation\nCellLevel\tThe field is mandatory present if the RateMatchPattern is defined on cell level. The field is absent when the RateMatchPattern is defined on BWP level. If the RateMatchPattern is defined on BWP level, the UE applies the SCS of the BWP.  \n\n\u2013\tRateMatchPatternId\nThe IE RateMatchPatternId identifies one RateMatchMattern (see TS 38.214 [19], clause 5.1.4.2).\nRateMatchPatternId information element\n-- ASN1START\n-- TAG-RATEMATCHPATTERNID-START\n\nRateMatchPatternId ::=              INTEGER (0..maxNrofRateMatchPatterns-1)\n\n-- TAG-RATEMATCHPATTERNID-STOP\n-- ASN1STOP\n\n\n\u2013\tRateMatchPatternLTE-CRS\nThe IE RateMatchPatternLTE-CRS is used to configure a pattern to rate match around LTE CRS. See TS 38.214 [19], clause 5.1.4.2.\nRateMatchPatternLTE-CRS information element\n-- ASN1START\n-- TAG-RATEMATCHPATTERNLTE-CRS-START\n\nRateMatchPatternLTE-CRS ::=         SEQUENCE {\n    carrierFreqDL                       INTEGER (0..16383),\n    carrierBandwidthDL                  ENUMERATED {n6, n15, n25, n50, n75, n100, spare2, spare1},\n    mbsfn-SubframeConfigList            EUTRA-MBSFN-SubframeConfigList                                          OPTIONAL,   -- Need M\n    nrofCRS-Ports                       ENUMERATED {n1, n2, n4},\n    v-Shift                             ENUMERATED {n0, n1, n2, n3, n4, n5}\n}\n\n-- TAG-RATEMATCHPATTERNLTE-CRS-STOP\n-- ASN1STOP\n\n\nRateMatchPatternLTE-CRS field descriptions\ncarrierBandwidthDL\tBW of the LTE carrier in number of PRBs (see TS 38.214 [19], clause 5.1.4.2).\ncarrierFreqDL\tCenter of the LTE carrier (see TS 38.214 [19], clause 5.1.4.2).\nmbsfn-SubframeConfigList\tLTE MBSFN subframe configuration (see TS 38.214 [19], clause 5.1.4.2).\nnrofCRS-Ports\tNumber of LTE CRS antenna port to rate-match around (see TS 38.214 [19], clause 5.1.4.2).\nv-Shift\tShifting value v-shift in LTE to rate match around LTE CRS (see TS 38.214 [19], clause 5.1.4.2).\n\n\u2013\tRejectWaitTime\nThe IE RejectWaitTime is used to provide the value in seconds for timer T302.\nRejectWaitTime information element\n-- ASN1START\n-- TAG-REJECTWAITTIME-START\n\nRejectWaitTime ::=                  INTEGER (1..16)\n\n-- TAG-REJECTWAITTIME-STOP\n-- ASN1STOP\n\n\u2013\tReportConfigId\nThe IE ReportConfigId is used to identify a measurement reporting configuration.\nReportConfigId information element\n-- ASN1START\n-- TAG-REPORTCONFIGID-START\n\nReportConfigId ::=                          INTEGER (1..maxReportConfigId)\n\n-- TAG-REPORTCONFIGID-STOP\n-- ASN1STOP\n\n\u2013\tReportConfigInterRAT\nThe IE ReportConfigInterRAT specifies criteria for triggering of an inter-RAT measurement reporting event. The inter-RAT measurement reporting events for E-UTRA are labelled BN with N equal to 1, 2 and so on.\nEvent B1:\tNeighbour becomes better than absolute threshold;\nEvent B2:\tPCell becomes worse than absolute threshold1 AND Neighbour becomes better than another absolute threshold2;\nReportConfigInterRAT information element\n-- ASN1START\n-- TAG-REPORTCONFIGINTERRAT-START\n\nReportConfigInterRAT ::=                    SEQUENCE {\n    reportType                                  CHOICE {\n        periodical                                  PeriodicalReportConfigInterRAT,\n        eventTriggered                              EventTriggerConfigInterRAT,\n        reportCGI                                   ReportCGI-EUTRA,\n        ...\n    }\n}\n\nReportCGI-EUTRA ::=                         SEQUENCE {\n    cellForWhichToReportCGI         EUTRA-PhysCellId,\n    ...\n}\n\nEventTriggerConfigInterRAT ::=              SEQUENCE {\n    eventId                                     CHOICE {\n        eventB1                                     SEQUENCE {\n            b1-ThresholdEUTRA                           MeasTriggerQuantityEUTRA,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            ...\n        },\n        eventB2                                     SEQUENCE {\n            b2-Threshold1                               MeasTriggerQuantity,\n            b2-Threshold2EUTRA                          MeasTriggerQuantityEUTRA,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            ...\n        },\n        ...\n    },\n    rsType                              NR-RS-Type,\n\n    reportInterval                      ReportInterval,\n    reportAmount                        ENUMERATED {r1, r2, r4, r8, r16, r32, r64, infinity},\n    reportQuantity                      MeasReportQuantity,\n    maxReportCells                      INTEGER (1..maxCellReport),\n    ...\n\n}\n\nPeriodicalReportConfigInterRAT ::=              SEQUENCE {\n    reportInterval                                  ReportInterval,\n    reportAmount                                    ENUMERATED {r1, r2, r4, r8, r16, r32, r64, infinity},\n    reportQuantity                                  MeasReportQuantity,\n    maxReportCells                                  INTEGER (1..maxCellReport),\n    ...\n}\n\nMeasTriggerQuantityEUTRA::=                         CHOICE {\n    rsrp                                        RSRP-RangeEUTRA,\n    rsrq                                        RSRQ-RangeEUTRA,\n    sinr                                        SINR-RangeEUTRA\n}\n\nRSRP-RangeEUTRA ::=                 INTEGER (0..97)\nRSRQ-RangeEUTRA ::=                 INTEGER (0..34)\nSINR-RangeEUTRA ::=                 INTEGER (0..127)\n\n-- TAG-REPORTCONFIGINTERRAT-STOP\n-- ASN1STOP\n\nReportConfigInterRAT field descriptions\nreportType\tType of the configured measurement report. In EN-DC, network does not configure report of type ReportCGI-EUTRA.\n\nEventTriggerConfigInterRAT field descriptions\nb2-Threshold1\tNR threshold to be used in inter RAT measurement report triggering condition for event B2.\nbN-ThresholdEUTRA\tE-UTRA threshold value associated with the selected trigger quantity (RSRP, RSRQ, SINR) to be used in inter RAT measurement report triggering condition for event number bN. In the same eventB2, the network configures the same CHOICE name for the MeasTriggerQuantity of the b2-Threshold1 and for the MeasTriggerQuantityEUTRA of the b2-Threshold2EUTRA.\neventId\tChoice of inter RAT event triggered reporting criteria.\nmaxReportCells\tMax number of non-serving cells to include in the measurement report.\nreportAmount\tNumber of measurement reports applicable for eventTriggered as well as for periodical report types\nreportOnLeave\tIndicates whether or not the UE shall initiate the measurement reporting procedure when the leaving condition is met for a cell in cellsTriggeredList, as specified in 5.5.4.1.\nreportQuantity\tThe cell measurement quantities to be included in the measurement report.\ntimeToTrigger\tTime during which specific criteria for the event needs to be met in order to trigger a measurement report.\n\nMeasTriggerQuantityEUTRA field descriptions\nEUTRA-RSRP\tCorresponds to RSRP-Range in TS 36.331 [10].\nEUTRA-RSRQ\tCorresponds to RSRQ-Range in TS 36.331 [10].\nEUTRA-SINR\tCorresponds to RS-SINR-Range in TS 36.331 [10].\n\nPeriodicalReportConfigInterRAT field descriptions\nmaxReportCells\tMax number of non-serving cells to include in the measurement report.\nreportAmount\tNumber of measurement reports applicable for eventTriggered as well as for periodical report types\nreportQuantityCell\tThe cell measurement quantities to be included in the measurement report.\n\n\u2013\tReportConfigNR\nThe IE ReportConfigNR specifies criteria for triggering of an NR measurement reporting event. Measurement reporting events are based on cell measurement results, which can either be derived based on SS/PBCH block or CSI-RS. These events are labelled AN with N equal to 1, 2 and so on.\nEvent A1:\tServing becomes better than absolute threshold;\nEvent A2:\tServing becomes worse than absolute threshold;\nEvent A3:\tNeighbour becomes amount of offset better than PCell/PSCell;\nEvent A4:\tNeighbour becomes better than absolute threshold;\nEvent A5:\tPCell/PSCell becomes worse than absolute threshold1 AND Neighbour/SCell becomes better than another absolute threshold2;\nEvent A6:\tNeighbour becomes amount of offset better than SCell.\nReportConfigNR information element\n-- ASN1START\n-- TAG-REPORTCONFIGNR-START\n\nReportConfigNR ::=                          SEQUENCE {\n    reportType                                  CHOICE {\n        periodical                                  PeriodicalReportConfig,\n        eventTriggered                              EventTriggerConfig,\n        ...,\n        reportCGI                                   ReportCGI\n    }\n}\n\nReportCGI ::=                     SEQUENCE {\n    cellForWhichToReportCGI          PhysCellId,\n        ...\n}\n\nEventTriggerConfig::=                       SEQUENCE {\n    eventId                                     CHOICE {\n        eventA1                                     SEQUENCE {\n            a1-Threshold                                MeasTriggerQuantity,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger\n        },\n        eventA2                                     SEQUENCE {\n            a2-Threshold                                MeasTriggerQuantity,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger\n        },\n        eventA3                                     SEQUENCE {\n            a3-Offset                                   MeasTriggerQuantityOffset,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            useWhiteCellList                            BOOLEAN\n        },\n        eventA4                                     SEQUENCE {\n            a4-Threshold                                MeasTriggerQuantity,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            useWhiteCellList                            BOOLEAN\n        },\n        eventA5                                     SEQUENCE {\n            a5-Threshold1                               MeasTriggerQuantity,\n            a5-Threshold2                               MeasTriggerQuantity,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            useWhiteCellList                            BOOLEAN\n        },\n        eventA6                                     SEQUENCE {\n            a6-Offset                                   MeasTriggerQuantityOffset,\n            reportOnLeave                               BOOLEAN,\n            hysteresis                                  Hysteresis,\n            timeToTrigger                               TimeToTrigger,\n            useWhiteCellList                            BOOLEAN\n        },\n        ...\n    },\n\n    rsType                                      NR-RS-Type,\n\n    reportInterval                              ReportInterval,\n    reportAmount                                ENUMERATED {r1, r2, r4, r8, r16, r32, r64, infinity},\n\n    reportQuantityCell                          MeasReportQuantity,\n    maxReportCells                              INTEGER (1..maxCellReport),\n\n    reportQuantityRS-Indexes                     MeasReportQuantity                                            OPTIONAL,   -- Need R\n    maxNrofRS-IndexesToReport                   INTEGER (1..maxNrofIndexesToReport)                            OPTIONAL,   -- Need R\n    includeBeamMeasurements                     BOOLEAN,\n    reportAddNeighMeas                          ENUMERATED {setup}                                             OPTIONAL,   -- Need R\n    ...\n}\n\nPeriodicalReportConfig ::=                  SEQUENCE {\n    rsType                                      NR-RS-Type,\n\n    reportInterval                              ReportInterval,\n    reportAmount                                ENUMERATED {r1, r2, r4, r8, r16, r32, r64, infinity},\n\n    reportQuantityCell                          MeasReportQuantity,\n    maxReportCells                              INTEGER (1..maxCellReport),\n\n    reportQuantityRS-Indexes                     MeasReportQuantity                                            OPTIONAL,   -- Need R\n    maxNrofRS-IndexesToReport                    INTEGER (1..maxNrofIndexesToReport)                           OPTIONAL,   -- Need R\n    includeBeamMeasurements                     BOOLEAN,\n    useWhiteCellList                            BOOLEAN,\n    ...\n}\n\nNR-RS-Type ::=                              ENUMERATED {ssb, csi-rs}\n\nMeasTriggerQuantity ::=                     CHOICE {\n    rsrp                                        RSRP-Range,\n    rsrq                                        RSRQ-Range,\n    sinr                                        SINR-Range\n}\n\nMeasTriggerQuantityOffset ::=               CHOICE {\n    rsrp                                        INTEGER (-30..30),\n    rsrq                                        INTEGER (-30..30),\n    sinr                                        INTEGER (-30..30)\n}\n\n\nMeasReportQuantity ::=                      SEQUENCE {\n    rsrp                                        BOOLEAN,\n    rsrq                                        BOOLEAN,\n    sinr                                        BOOLEAN\n}\n\n\n-- TAG-REPORTCONFIGNR-STOP\n-- ASN1STOP\n\nReportConfigNR field descriptions\nreportType\tType of the configured measurement report. In EN-DC, network does not configure report of type reportCGI using SRB3.\n\nEventTriggerConfig field descriptions\na3-Offset/a6-Offset\tOffset value(s) to be used in NR measurement report triggering condition for event a3/a6. The actual value is field value * 0.5 dB.\naN-ThresholdM\tThreshold value associated to the selected trigger quantity (e.g. RSRP, RSRQ, SINR) per RS Type (e.g. SS/PBCH block, CSI-RS) to be used in NR measurement report triggering condition for event number aN. If multiple thresholds are defined for event number aN, the thresholds are differentiated by M. The network configures aN-Threshold1 only for events A1, A2, A4, A5 and a5-Threshold2 only for event A5. In the same eventA5, the network configures the same CHOICE name for the MeasTriggerQuantity of the a5-Threshold1 and for the MeasTriggerQuantity of the a5-Threshold2.\neventId\tChoice of NR event triggered reporting criteria.\nmaxNrofRS-IndexesToReport\tMax number of RS indexes to include in the measurement report for A1-A6 events.\nmaxReportCells\tMax number of non-serving cells to include in the measurement report.\nreportAddNeighMeas\tIndicates that the UE shall include the best neighbour cells per serving frequency.\nreportAmount\tNumber of measurement reports applicable for eventTriggered as well as for periodical report types.\nreportOnLeave\tIndicates whether or not the UE shall initiate the measurement reporting procedure when the leaving condition is met for a cell in cellsTriggeredList, as specified in 5.5.4.1.\nreportQuantityCell\tThe cell measurement quantities to be included in the measurement report.\nreportQuantityRS-Indexes\tIndicates which measurement information per RS index the UE shall include in the measurement report.\ntimeToTrigger\tTime during which specific criteria for the event needs to be met in order to trigger a measurement report.\nuseWhiteCellList\tIndicates whether only the cells included in the white-list of the associated measObject are applicable as specified in 5.5.4.1.\n\nPeriodicalReportConfig field descriptions\nmaxNrofRS-IndexesToReport\tMax number of RS indexes to include in the measurement report.\nmaxReportCells\tMax number of non-serving cells to include in the measurement report.\nreportAmount\tNumber of measurement reports applicable for eventTriggered as well as for periodical report types\nreportQuantityCell\tThe cell measurement quantities to be included in the measurement report.\nreportQuantityRS-Indexes\tIndicates which measurement information per RS index the UE shall include in the measurement report.\nuseWhiteCellList\tIndicates whether only the cells included in the white-list of the associated measObject are applicable as specified in 5.5.4.1.\n\n\u2013\tReportConfigToAddModList\nThe IE ReportConfigToAddModList concerns a list of reporting configurations to add or modify.\nReportConfigToAddModList information element\n-- ASN1START\n-- TAG-REPORTCONFIGTOADDMODLIST-START\n\nReportConfigToAddModList ::=        SEQUENCE (SIZE (1..maxReportConfigId)) OF ReportConfigToAddMod\n\nReportConfigToAddMod ::=            SEQUENCE {\n    reportConfigId                      ReportConfigId,\n    reportConfig                        CHOICE {\n        reportConfigNR                      ReportConfigNR,\n        ...,\n        reportConfigInterRAT                ReportConfigInterRAT\n    }\n}\n\n-- TAG-REPORTCONFIGTOADDMODLIST-STOP\n-- ASN1STOP\n\n\u2013\tReportInterval\nThe IE ReportInterval indicates the interval between periodical reports. The ReportInterval is applicable if the UE performs periodical reporting (i.e. when reportAmount exceeds 1), for triggerTypeevent as well as for triggerTypeperiodical. Value ms120 corresponds to 120 ms, value ms240 corresponds to 240 ms and so on, while value min1 corresponds to 1 min, min6 corresponds to 6 min and so on.\nReportInterval information element\n-- ASN1START\n-- TAG-REPORTINTERVAL-START\n\nReportInterval ::=                  ENUMERATED {ms120, ms240, ms480, ms640, ms1024, ms2048, ms5120, ms10240, ms20480, ms40960,\n                                                    min1,min6, min12, min30 }\n\n-- TAG-REPORTINTERVAL-STOP\n-- ASN1STOP\n\n\u2013\tReselectionThreshold\nThe IE ReselectionThreshold is used to indicate an Rx level threshold for cell reselection. Actual value of threshold = field value * 2 [dB].\nReselectionThreshold information element\n-- ASN1START\n-- TAG-RESELECTIONTHRESHOLD-START\n\nReselectionThreshold ::=                INTEGER (0..31)\n\n-- TAG-RESELECTIONTHRESHOLD-STOP\n-- ASN1STOP\n\n\u2013\tReselectionThresholdQ\nThe IE ReselectionThresholdQ is used to indicate a quality level threshold for cell reselection. Actual value of threshold = field value [dB].\nReselectionThresholdQ information element\n-- ASN1START\n-- TAG-RESELECTIONTHRESHOLDQ-START\n\nReselectionThresholdQ ::=           INTEGER (0..31)\n\n-- TAG-RESELECTIONTHRESHOLDQ-STOP\n-- ASN1STOP\n\n\u2013\tResumeCause\nThe IE ResumeCause is used to indicate the resume cause in RRCResumeRequest and RRCResumeRequest1.\nResumeCause information element\n-- ASN1START\n-- TAG-RESUMECAUSE-START\n\nResumeCause ::=             ENUMERATED {emergency, highPriorityAccess, mt-Access, mo-Signalling,\n                                        mo-Data, mo-VoiceCall, mo-VideoCall, mo-SMS, rna-Update, mps-PriorityAccess,\n                                        mcs-PriorityAccess, spare1, spare2, spare3, spare4, spare5 }\n\n-- TAG-RESUME-CAUSE-STOP\n-- ASN1STOP\n\n\u2013\tRLC-BearerConfig\nThe IE RLC-BearerConfig is used to configure an RLC entity, a corresponding logical channel in MAC and the linking to a PDCP entity (served radio bearer).\nRLC-BearerConfig information element\n-- ASN1START\n-- TAG-RLC-BEARERCONFIG-START\n\nRLC-BearerConfig ::=                        SEQUENCE {\n    logicalChannelIdentity                      LogicalChannelIdentity,\n    servedRadioBearer                           CHOICE {\n        srb-Identity                                SRB-Identity,\n        drb-Identity                                DRB-Identity\n    }                                                                                               OPTIONAL,   -- Cond LCH-SetupOnly\n    reestablishRLC                              ENUMERATED {true}                                   OPTIONAL,   -- Need N\n    rlc-Config                                  RLC-Config                                          OPTIONAL,   -- Cond LCH-Setup\n    mac-LogicalChannelConfig                    LogicalChannelConfig                                OPTIONAL,   -- Cond LCH-Setup\n    ...\n}\n\n-- TAG-RLC-BEARERCONFIG-STOP\n-- ASN1STOP\n\nRLC-BearerConfig field descriptions\nlogicalChannelIdentity\tID used commonly for the MAC logical channel and for the RLC bearer.\nreestablishRLC\tIndicates that RLC should be re-established. Network sets this to true whenever the security key used for the radio bearer associated with this RLC entity changes. For SRB2 and DRBs, it is also set to true during the resumption of the RRC connection or the first reconfiguration after reestablishment.\nrlc-Config\tDetermines the RLC mode (UM, AM) and provides corresponding parameters. RLC mode reconfiguration can only be performed by DRB release/addition or full configuration.\nservedRadioBearer\tAssociates the RLC Bearer with an SRB or a DRB. The UE shall deliver DL RLC SDUs received via the RLC entity of this RLC bearer to the PDCP entity of the servedRadioBearer. Furthermore, the UE shall advertise and deliver uplink PDCP PDUs of the uplink PDCP entity of the servedRadioBearer to the uplink RLC entity of this RLC bearer unless the uplink scheduling restrictions ('moreThanOneRLC' in PDCP-Config and the restrictions in LogicalChannelConfig) forbid it to do so.\n\nConditional Presence\tExplanation\nLCH-Setup\tThis field is mandatory present upon creation of a new logical channel. It is optionally present, Need M, otherwise.\nLCH-SetupOnly\n\n\u2013\tRLC-Config\nThe IE RLC-Config is used to specify the RLC configuration of SRBs and DRBs.\nRLC-Config information element\n-- ASN1START\n-- TAG-RLC-CONFIG-START\n\nRLC-Config ::=                      CHOICE {\n    am                                  SEQUENCE {\n        ul-AM-RLC                           UL-AM-RLC,\n        dl-AM-RLC                           DL-AM-RLC\n    },\n    um-Bi-Directional                   SEQUENCE {\n        ul-UM-RLC                           UL-UM-RLC,\n        dl-UM-RLC                           DL-UM-RLC\n    },\n    um-Uni-Directional-UL               SEQUENCE {\n        ul-UM-RLC                           UL-UM-RLC\n    },\n    um-Uni-Directional-DL               SEQUENCE {\n        dl-UM-RLC                           DL-UM-RLC\n    },\n    ...\n}\n\nUL-AM-RLC ::=                       SEQUENCE {\n    sn-FieldLength                      SN-FieldLengthAM                                    OPTIONAL,   -- Cond Reestab\n    t-PollRetransmit                    T-PollRetransmit,\n    pollPDU                             PollPDU,\n    pollByte                            PollByte,\n    maxRetxThreshold                    ENUMERATED { t1, t2, t3, t4, t6, t8, t16, t32 }\n}\n\nDL-AM-RLC ::=                       SEQUENCE {\n    sn-FieldLength                      SN-FieldLengthAM                                    OPTIONAL,   -- Cond Reestab\n    t-Reassembly                        T-Reassembly,\n    t-StatusProhibit                    T-StatusProhibit\n}\n\nUL-UM-RLC ::=                       SEQUENCE {\n    sn-FieldLength                      SN-FieldLengthUM                                    OPTIONAL    -- Cond Reestab\n}\n\nDL-UM-RLC ::=                       SEQUENCE {\n    sn-FieldLength                      SN-FieldLengthUM                                    OPTIONAL,   -- Cond Reestab\n    t-Reassembly                        T-Reassembly\n}\n\nT-PollRetransmit ::=                ENUMERATED {\n                                        ms5, ms10, ms15, ms20, ms25, ms30, ms35,\n                                        ms40, ms45, ms50, ms55, ms60, ms65, ms70,\n                                        ms75, ms80, ms85, ms90, ms95, ms100, ms105,\n                                        ms110, ms115, ms120, ms125, ms130, ms135,\n                                        ms140, ms145, ms150, ms155, ms160, ms165,\n                                        ms170, ms175, ms180, ms185, ms190, ms195,\n                                        ms200, ms205, ms210, ms215, ms220, ms225,\n                                        ms230, ms235, ms240, ms245, ms250, ms300,\n                                        ms350, ms400, ms450, ms500, ms800, ms1000,\n                                        ms2000, ms4000, spare5, spare4, spare3,\n                                        spare2, spare1}\n\n\nPollPDU ::=                         ENUMERATED {\n                                        p4, p8, p16, p32, p64, p128, p256, p512, p1024, p2048, p4096, p6144, p8192, p12288, p16384,p20480,\n                                        p24576, p28672, p32768, p40960, p49152, p57344, p65536, infinity, spare8, spare7, spare6, spare5, spare4,\n                                        spare3, spare2, spare1}\n\nPollByte ::=                        ENUMERATED {\n                                        kB1, kB2, kB5, kB8, kB10, kB15, kB25, kB50, kB75,\n                                        kB100, kB125, kB250, kB375, kB500, kB750, kB1000,\n                                        kB1250, kB1500, kB2000, kB3000, kB4000, kB4500,\n                                        kB5000, kB5500, kB6000, kB6500, kB7000, kB7500,\n                                        mB8, mB9, mB10, mB11, mB12, mB13, mB14, mB15,\n                                        mB16, mB17, mB18, mB20, mB25, mB30, mB40, infinity,\n                                        spare20, spare19, spare18, spare17, spare16,\n                                        spare15, spare14, spare13, spare12, spare11,\n                                        spare10, spare9, spare8, spare7, spare6, spare5,\n                                        spare4, spare3, spare2, spare1}\n\nT-Reassembly ::=                    ENUMERATED {\n                                        ms0, ms5, ms10, ms15, ms20, ms25, ms30, ms35,\n                                        ms40, ms45, ms50, ms55, ms60, ms65, ms70,\n                                        ms75, ms80, ms85, ms90, ms95, ms100, ms110,\n                                        ms120, ms130, ms140, ms150, ms160, ms170,\n                                        ms180, ms190, ms200, spare1}\n\nT-StatusProhibit ::=                ENUMERATED {\n                                        ms0, ms5, ms10, ms15, ms20, ms25, ms30, ms35,\n                                        ms40, ms45, ms50, ms55, ms60, ms65, ms70,\n                                        ms75, ms80, ms85, ms90, ms95, ms100, ms105,\n                                        ms110, ms115, ms120, ms125, ms130, ms135,\n                                        ms140, ms145, ms150, ms155, ms160, ms165,\n                                        ms170, ms175, ms180, ms185, ms190, ms195,\n                                        ms200, ms205, ms210, ms215, ms220, ms225,\n                                        ms230, ms235, ms240, ms245, ms250, ms300,\n                                        ms350, ms400, ms450, ms500, ms800, ms1000,\n                                        ms1200, ms1600, ms2000, ms2400, spare2, spare1}\n\nSN-FieldLengthUM ::=                ENUMERATED {size6, size12}\nSN-FieldLengthAM ::=                ENUMERATED {size12, size18}\n\n-- TAG-RLC-CONFIG-STOP\n-- ASN1STOP\n\nRLC-Config field descriptions\nmaxRetxThreshold\tParameter for RLC AM in TS 38.322 [4]. Value t1 corresponds to 1 retransmission, value t2 corresponds to 2 retransmissions and so on.\npollByte\tParameter for RLC AM in TS 38.322 [4]. Value kB25 corresponds to 25 kBytes, value kB50 corresponds to 50 kBytes and so on. infinity corresponds to an infinite amount of kBytes.\npollPDU\tParameter for RLC AM in TS 38.322 [4]. Value p4 corresponds to 4 PDUs, value p8 corresponds to 8 PDUs and so on. infinity corresponds to an infinite number of PDUs.\nsn-FieldLength\tIndicates the RLC SN field size, see TS 38.322 [4], in bits. Value size6 means 6 bits, value size12 means 12 bits, value size18 means 18 bits. The value of sn-FieldLength for a DRB shall be changed only using reconfiguration with sync. The network configures only value size12 in SN-FieldLengthAM for SRB.\nt-PollRetransmit\tTimer for RLC AM in TS 38.322 [4], in milliseconds. Value ms5 means 5 ms, value ms10 means 10 ms and so on.\nt-Reassembly\tTimer for reassembly in TS 38.322 [4], in milliseconds. Value ms0 means 0 ms, value ms5 means 5 ms and so on. \nt-StatusProhibit\tTimer for status reporting in TS 38.322 [4], in milliseconds. Value ms0 means 0 ms, value ms5 means 5 ms and so on.\n\nConditional Presence\tExplanation\nReestab\n\n\u2013\tRLF-TimersAndConstants\nThe IE RLF-TimersAndConstants is used to configure UE specific timers and constants.\nRLF-TimersAndConstants information element\n-- ASN1START\n-- TAG-RLF-TIMERSANDCONSTANTS-START\n\nRLF-TimersAndConstants ::=          SEQUENCE {\n    t310                                ENUMERATED {ms0, ms50, ms100, ms200, ms500, ms1000, ms2000, ms4000, ms6000},\n    n310                                ENUMERATED {n1, n2, n3, n4, n6, n8, n10, n20},\n    n311                                ENUMERATED {n1, n2, n3, n4, n5, n6, n8, n10},\n    ...,\n    [[\n    t311-v1530                          ENUMERATED {ms1000, ms3000, ms5000, ms10000, ms15000, ms20000, ms30000}\n    ]]\n}\n\n-- TAG-RLF-TIMERSANDCONSTANTS-STOP\n-- ASN1STOP\n\nRLF-TimersAndConstants field descriptions\nn3xy\tConstants are described in clause 7.3. Value n1 corresponds to 1, value n2 corresponds to 2 and so on.\nt3xy\tTimers are described in clause 7.1. Value ms0 corresponds to 0 ms, value ms50 corresponds to 50 ms and so on.\n\n\u2013\tRNTI-Value\nThe IE RNTI-Value represents a Radio Network Temporary Identity.\nRNTI-Value information element\n-- ASN1START\n-- TAG-RNTI-VALUE-START\n\nRNTI-Value ::=                      INTEGER (0..65535)\n\n-- TAG-RNTI-VALUE-STOP\n-- ASN1STOP\n\n\u2013\tRSRP-Range\nThe IE RSRP-Range specifies the value range used in RSRP measurements and thresholds. For measurements, integer value for RSRP measurements is according to Table 10.1.6.1-1 in TS 38.133 [14]. For thresholds, the actual value is (IE value \u2013 156) dBm, except for the IE value 127, in which case the actual value is infinity.\nRSRP-Range information element\n-- ASN1START\n-- TAG-RSRP-RANGE-START\n\nRSRP-Range ::=                      INTEGER(0..127)\n\n-- TAG-RSRP-RANGE-STOP\n-- ASN1STOP\n\n\u2013\tRSRQ-Range\nThe IE RSRQ-Range specifies the value range used in RSRQ measurements and thresholds. For measurements, integer value for RSRQ measurements is according to Table 10.1.11.1-1 in TS 38.133 [14]. For thresholds, the actual value is (IE value \u2013 87) / 2 dB.\nRSRQ-Range information element\n-- ASN1START\n-- TAG-RSRQ-RANGE-START\n\nRSRQ-Range ::=                      INTEGER(0..127)\n\n-- TAG-RSRQ-RANGE-STOP\n-- ASN1STOP\n\n\u2013\tSCellIndex\nThe IE SCellIndex concerns a short identity, used to identify an SCell or PSCell. The value range is shared across the Cell Groups.\nSCellIndex information element\n-- ASN1START\n-- TAG-SCELLINDEX-START\n\nSCellIndex ::=                      INTEGER (1..31)\n\n-- TAG-SCELLINDEX-STOP\n-- ASN1STOP\n\n\u2013\tSchedulingRequestConfig\nThe IE SchedulingRequestConfig is used to configure the parameters, for the dedicated scheduling request (SR) resources.\nSchedulingRequestConfig information element\n-- ASN1START\n-- TAG-SCHEDULINGREQUESTCONFIG-START\n\nSchedulingRequestConfig ::=         SEQUENCE {\n    schedulingRequestToAddModList       SEQUENCE (SIZE (1..maxNrofSR-ConfigPerCellGroup)) OF SchedulingRequestToAddMod\n                                                                                                          OPTIONAL, -- Need N\n    schedulingRequestToReleaseList      SEQUENCE (SIZE (1..maxNrofSR-ConfigPerCellGroup)) OF SchedulingRequestId\n                                                                                                          OPTIONAL  -- Need N\n}\n\nSchedulingRequestToAddMod ::=       SEQUENCE {\n    schedulingRequestId     SchedulingRequestId,\n\n    sr-ProhibitTimer                    ENUMERATED {ms1, ms2, ms4, ms8, ms16, ms32, ms64, ms128}          OPTIONAL, -- Need S\n    sr-TransMax                         ENUMERATED { n4, n8, n16, n32, n64, spare3, spare2, spare1}\n}\n\n\n\n-- TAG-SCHEDULINGREQUESTCONFIG-STOP\n-- ASN1STOP\n\nSchedulingRequestConfig field descriptions\nschedulingRequestToAddModList\tList of Scheduling Request configurations to add or modify.\nschedulingRequestToReleaseList\tList of Scheduling Request configurations to release.\n\nSchedulingRequestToAddMod field descriptions\nschedulingRequestId\tUsed to modify a SR configuration and to indicate, in LogicalChannelConfig, the SR configuration to which a logical channel is mapped and to indicate, in SchedulingRequestresourceConfig, the SR configuration for which a scheduling request resource is used.\nsr-ProhibitTimer\tTimer for SR transmission on PUCCH in TS 38.321 [3]. Value is in ms. Value ms1 corresponds to 1ms, value ms2 corresponds to 2ms, and so on.  When the field is absent, the UE applies the value 0.\nsr-TransMax\tMaximum number of SR transmissions as described in TS 38.321 [3]. Value n4 corresponds to 4, value n8 corresponds to 8, and so on. \n\n\u2013\tSchedulingRequestId\nThe IE SchedulingRequestId is used to identify a Scheduling Request instance in the MAC layer.\nSchedulingRequestId information element\n-- ASN1START\n-- TAG-SCHEDULINGREQUESTID-START\n\nSchedulingRequestId ::=             INTEGER (0..7)\n\n-- TAG-SCHEDULINGREQUESTID-STOP\n-- ASN1STOP\n\n\u2013\tSchedulingRequestResourceConfig\nThe IE SchedulingRequestResourceConfig determines physical layer resources on PUCCH where the UE may send the dedicated scheduling request (D-SR) (see TS 38.213 [13], clause 9.2.4).\nSchedulingRequestResourceConfig information element\n-- ASN1START\n-- TAG-SCHEDULINGREQUESTRESOURCECONFIG-START\n\nSchedulingRequestResourceConfig ::=     SEQUENCE {\n    schedulingRequestResourceId             SchedulingRequestResourceId,\n    schedulingRequestID                     SchedulingRequestId,\n    periodicityAndOffset                    CHOICE {\n        sym2                                    NULL,\n        sym6or7                                 NULL,\n        sl1                                     NULL,                       -- Recurs in every slot\n        sl2                                     INTEGER (0..1),\n        sl4                                     INTEGER (0..3),\n        sl5                                     INTEGER (0..4),\n        sl8                                     INTEGER (0..7),\n        sl10                                    INTEGER (0..9),\n        sl16                                    INTEGER (0..15),\n        sl20                                    INTEGER (0..19),\n        sl40                                    INTEGER (0..39),\n        sl80                                    INTEGER (0..79),\n        sl160                                   INTEGER (0..159),\n        sl320                                   INTEGER (0..319),\n        sl640                                   INTEGER (0..639)\n    }                                                                                                       OPTIONAL,   -- Need M\n    resource                                PUCCH-ResourceId                                                OPTIONAL    -- Need M\n}\n\n-- TAG-SCHEDULINGREQUESTRESOURCECONFIG-STOP\n-- ASN1STOP\n\nSchedulingRequestResourceConfig field descriptions\nperiodicityAndOffset\tSR periodicity and offset in number of symbols or slots (see TS 38.213 [13], clause 9.2.4) The following periodicities may be configured depending on the chosen subcarrier spacing:\tSCS =  15 kHz: 2sym, 7sym, 1sl, 2sl, 4sl, 5sl, 8sl, 10sl, 16sl, 20sl, 40sl, 80sl\tSCS =  30 kHz: 2sym, 7sym, 1sl, 2sl, 4sl, 8sl, 10sl, 16sl, 20sl, 40sl, 80sl, 160sl\tSCS =  60 kHz: 2sym, 7sym/6sym, 1sl, 2sl, 4sl, 8sl, 16sl, 20sl, 40sl, 80sl, 160sl, 320sl\tSCS = 120 kHz: 2sym, 7sym, 1sl, 2sl, 4sl, 8sl, 16sl, 40sl, 80sl, 160sl, 320sl, 640sl\t\tsym6or7 corresponds to 6 symbols if extended cyclic prefix and a SCS of 60 kHz are configured, otherwise it corresponds to 7 symbols.\tFor periodicities 2sym, 7sym and sl1 the UE assumes an offset of 0 slots.\nresource\tID of the PUCCH resource in which the UE shall send the scheduling request. The actual PUCCH-Resource is configured in PUCCH-Config of the same UL BWP and serving cell as this SchedulingRequestResourceConfig. The network configures a PUCCH-Resource of PUCCH-format0 or PUCCH-format1 (other formats not supported) (see TS 38.213 [13], clause 9.2.4)\nschedulingRequestID\tThe ID of the SchedulingRequestConfig that uses this scheduling request resource.\n\n\u2013\tSchedulingRequestResourceId\nThe IE SchedulingRequestResourceId is used to identify scheduling request resources on PUCCH.\nSchedulingRequestResourceId information element\n-- ASN1START\n-- TAG-SCHEDULINGREQUESTRESOURCEID-START\n\nSchedulingRequestResourceId ::=     INTEGER (1..maxNrofSR-Resources)\n\n-- TAG-SCHEDULINGREQUESTRESOURCEID-STOP\n-- ASN1STOP\n\n\u2013\tScramblingId\nThe IE ScramblingID is used for scrambling channels and reference signals.\n-- ASN1START\n-- TAG-SCRAMBLINGID-START\n\nScramblingId ::=                    INTEGER(0..1023)\n\n-- TAG-SCRAMBLINGID-STOP\n-- ASN1STOP\n\n\u2013\tSCS-SpecificCarrier\nThe IE SCS-SpecificCarrier provides parameters determining the location and width of the actual carrier or the carrier bandwidth. It is defined specifically for a numerology (subcarrier spacing (SCS)) and in relation (frequency offset) to Point A.\n-- ASN1START\n-- TAG-SCS-SPECIFICCARRIER-START\n\nSCS-SpecificCarrier ::=             SEQUENCE {\n    offsetToCarrier                     INTEGER (0..2199),\n    subcarrierSpacing                   SubcarrierSpacing,\n    carrierBandwidth                    INTEGER (1..maxNrofPhysicalResourceBlocks),\n    ...,\n    [[\n    txDirectCurrentLocation-v1530   INTEGER (0..4095)                                       OPTIONAL            -- Need S\n    ]]\n}\n\n-- TAG-SCS-SPECIFICCARRIER-STOP\n-- ASN1STOP\n\nSCS-SpecificCarrier field descriptions\ncarrierBandwidth\tWidth of this carrier in number of PRBs (using the subcarrierSpacing defined for this carrier) (see TS 38.211 [16], clause 4.4.2).\noffsetToCarrier\tOffset in frequency domain between Point A (lowest subcarrier of common RB 0) and the lowest usable subcarrier on this carrier in number of PRBs (using the subcarrierSpacing defined for this carrier). The maximum value corresponds to 275*8-1. See TS 38.211 [16], clause 4.4.2.\ntxDirectCurrentLocation\tIndicates the downlink Tx Direct Current location for the carrier. A value in the range 0..3299 indicates the subcarrier index within the carrier. The values in the value range 3301..4095 are reserved and ignored by the UE. If this field is absent for downlink within ServingCellConfigCommon and ServingCellConfigCommonSIB1, the UE assumes the default value of 3300 (i.e. \"Outside the carrier\"). (see TS 38.211 [16], clause 4.4.2). Network does not configure this field via ServingCellConfig or for uplink carriers.\nsubcarrierSpacing\tSubcarrier spacing of this carrier. It is used to convert the offsetToCarrier into an actual frequency. Only the values 15 kHz or 30 kHz (<6GHz), 60 kHz or 120 kHz (>6GHz) are applicable.\n\n\u2013\tSDAP-Config\nThe IE SDAP-Config is used to set the configurable SDAP parameters for a data radio bearer. All configured instances of SDAP-Config with the same value of pdu-Session correspond to the same SDAP entity as specified in TS 37.324 [24].\nSDAP-Config information element\n-- ASN1START\n-- TAG-SDAP-CONFIG-START\n\nSDAP-Config ::=                     SEQUENCE {\n    pdu-Session                         PDU-SessionID,\n    sdap-HeaderDL                       ENUMERATED {present, absent},\n    sdap-HeaderUL                       ENUMERATED {present, absent},\n    defaultDRB                          BOOLEAN,\n    mappedQoS-FlowsToAdd                SEQUENCE (SIZE (1..maxNrofQFIs)) OF QFI                                 OPTIONAL, -- Need N\n    mappedQoS-FlowsToRelease            SEQUENCE (SIZE (1..maxNrofQFIs)) OF QFI                                 OPTIONAL, -- Need N\n    ...\n}\n\nQFI ::=                             INTEGER (0..maxQFI)\n\nPDU-SessionID ::=                   INTEGER (0..255)\n\n-- TAG-SDAP-CONFIG-STOP\n-- ASN1STOP\n\nSDAP-Config field descriptions\ndefaultDRB\tIndicates whether or not this is the default DRB for this PDU session. Among all configured instances of SDAP-Config with the same value of pdu-Session, this field shall be set to true in at most one instance of SDAP-Config and to false in all other instances.\nmappedQoS-FlowsToAdd\tIndicates the list of QFIs of UL QoS flows of the PDU session to be additionally mapped to this DRB. A QFI value can be included at most once in all configured instances of SDAP-Config with the same value of pdu-Session. For QoS flow remapping, the QFI value of the remapped QoS flow is only included in mappedQoS-FlowsToAdd in sdap-Config corresponding to the new DRB and not included in mappedQoS-FlowsToRelease in sdap-Config corresponding to the old DRB.\nmappedQoS-FlowsToRelease\tIndicates the list of QFIs of QoS flows of the PDU session to be released from existing QoS flow to DRB mapping of this DRB. \npdu-Session\tIdentity of the PDU session whose QoS flows are mapped to the DRB.\nsdap-HeaderUL\tIndicates whether or not a SDAP header is present for UL data on this DRB. The field cannot be changed after a DRB is established. The network sets this field to present if the field defaultDRB is set to true.\nsdap-HeaderDL\tIndicates whether or not a SDAP header is present for DL data on this DRB. The field cannot be changed after a DRB is established.\n\n\u2013\tSearchSpace\nThe IE SearchSpace defines how/where to search for PDCCH candidates. Each search space is associated with one ControlResourceSet. For a scheduled cell in the case of cross carrier scheduling, except for nrofCandidates, all the optional fields are absent.\nSearchSpace information element\n-- ASN1START\n-- TAG-SEARCHSPACE-START\n\nSearchSpace ::=                         SEQUENCE {\n    searchSpaceId                           SearchSpaceId,\n    controlResourceSetId                    ControlResourceSetId                                        OPTIONAL,   -- Cond SetupOnly\n    monitoringSlotPeriodicityAndOffset      CHOICE {\n        sl1                                     NULL,\n        sl2                                     INTEGER (0..1),\n        sl4                                     INTEGER (0..3),\n        sl5                                     INTEGER (0..4),\n        sl8                                     INTEGER (0..7),\n        sl10                                    INTEGER (0..9),\n        sl16                                    INTEGER (0..15),\n        sl20                                    INTEGER (0..19),\n        sl40                                    INTEGER (0..39),\n        sl80                                    INTEGER (0..79),\n        sl160                                   INTEGER (0..159),\n        sl320                                   INTEGER (0..319),\n        sl640                                   INTEGER (0..639),\n        sl1280                                  INTEGER (0..1279),\n        sl2560                                  INTEGER (0..2559)\n    }                                                                                                   OPTIONAL,   -- Cond Setup\n    duration                                INTEGER (2..2559)                                           OPTIONAL,   -- Need R\n    monitoringSymbolsWithinSlot             BIT STRING (SIZE (14))                                      OPTIONAL,   -- Cond Setup\n    nrofCandidates                          SEQUENCE {\n        aggregationLevel1                       ENUMERATED {n0, n1, n2, n3, n4, n5, n6, n8},\n        aggregationLevel2                       ENUMERATED {n0, n1, n2, n3, n4, n5, n6, n8},\n        aggregationLevel4                       ENUMERATED {n0, n1, n2, n3, n4, n5, n6, n8},\n        aggregationLevel8                       ENUMERATED {n0, n1, n2, n3, n4, n5, n6, n8},\n        aggregationLevel16                      ENUMERATED {n0, n1, n2, n3, n4, n5, n6, n8}\n    }                                                                                                   OPTIONAL,   -- Cond Setup\n    searchSpaceType                         CHOICE {\n        common                                  SEQUENCE {\n            dci-Format0-0-AndFormat1-0              SEQUENCE {\n                ...\n            }                                                                                           OPTIONAL,   -- Need R\n            dci-Format2-0                           SEQUENCE {\n                nrofCandidates-SFI                      SEQUENCE {\n                    aggregationLevel1                       ENUMERATED {n1, n2}                         OPTIONAL,   -- Need R\n                    aggregationLevel2                       ENUMERATED {n1, n2}                         OPTIONAL,   -- Need R\n                    aggregationLevel4                       ENUMERATED {n1, n2}                         OPTIONAL,   -- Need R\n                    aggregationLevel8                       ENUMERATED {n1, n2}                         OPTIONAL,   -- Need R\n                    aggregationLevel16                      ENUMERATED {n1, n2}                         OPTIONAL    -- Need R\n                },\n                ...\n            }                                                                                           OPTIONAL,   -- Need R\n            dci-Format2-1                           SEQUENCE {\n                ...\n            }                                                                                           OPTIONAL,   -- Need R\n            dci-Format2-2                           SEQUENCE {\n                ...\n            }                                                                                           OPTIONAL,   -- Need R\n            dci-Format2-3                           SEQUENCE {\n                dummy1                  ENUMERATED {sl1, sl2, sl4, sl5, sl8, sl10, sl16, sl20}          OPTIONAL,   -- Cond Setup\n                dummy2                  ENUMERATED {n1, n2},\n                ...\n            }                                                                                           OPTIONAL    -- Need R\n        },\n        ue-Specific                             SEQUENCE {\n            dci-Formats                             ENUMERATED {formats0-0-And-1-0, formats0-1-And-1-1},\n            ...\n        }\n    }                                                                                                   OPTIONAL    -- Cond Setup\n}\n\n-- TAG-SEARCHSPACE-STOP\n-- ASN1STOP\n\nSearchSpace field descriptions\ncommon\tConfigures this search space as common search space (CSS) and DCI formats to monitor.\ncontrolResourceSetId\tThe CORESET applicable for this SearchSpace. Value 0 identifies the common CORESET#0 configured in MIB and in ServingCellConfigCommon. Values 1..maxNrofControlResourceSets-1 identify CORESETs configured in System Information or by dedicated signalling. The CORESETs with non-zero controResourceSetId locate in the same BWP as this SearchSpace.\ndummy1, dummy2\tThis field is not used in the specification. If received it shall be ignored by the UE.\ndci-Format0-0-AndFormat1-0\tIf configured, the UE monitors the DCI formats 0_0 and 1_0 according to TS 38.213 [13], clause 10.1.\ndci-Format2-0\tIf configured, UE monitors the DCI format 2_0 according to TS 38.213 [13], clause 10.1, 11.1.1.\ndci-Format2-1\tIf configured, UE monitors the DCI format 2_1 according to TS 38.213 [13], clause 10.1, 11.2.\ndci-Format2-2\tIf configured, UE monitors the DCI format 2_2 according to TS 38.213 [13], clause 10.1, 11.3.\ndci-Format2-3\tIf configured, UE monitors the DCI format 2_3 according to TS 38.213 [13], clause 10.1, 11.4\ndci-Formats\tIndicates whether the UE monitors in this USS for DCI formats 0-0 and 1-0 or for formats 0-1 and 1-1.\nduration\tNumber of consecutive slots that a SearchSpace lasts in every occasion, i.e., upon every period as given in the periodicityAndOffset. If the field is absent, the UE applies the value 1 slot, except for DCI format 2_0. The UE ignores this field for DCI format 2_0. The maximum valid duration is periodicity-1 (periodicity as given in the monitoringSlotPeriodicityAndOffset).\nmonitoringSlotPeriodicityAndOffset\tSlots for PDCCH Monitoring configured as periodicity and offset. If the UE is configured to monitor DCI format 2_1, only the values 'sl1', 'sl2' or 'sl4' are applicable.  If the UE is configured to monitor DCI format 2_0, only the values \u2032sl1\u2032, \u2032sl2\u2032, \u2032sl4\u2032, \u2032sl5\u2032, \u2032sl8\u2032, \u2032sl10\u2032, \u2032sl16\u2032, and \u2032sl20\u2032 are applicable (see TS 38.213 [13], clause 10).\nmonitoringSymbolsWithinSlot\tThe first symbol(s) for PDCCH monitoring in the slots configured for PDCCH monitoring (see monitoringSlotPeriodicityAndOffset and duration). The most significant (left) bit represents the first OFDM in a slot, and the second most significant (left) bit represents the second OFDM symbol in a slot and so on. The bit(s) set to one identify the first OFDM symbol(s) of the control resource set within a slot. If the cyclic prefix of the BWP is set to extended CP, the last two bits within the bit string shall be ignored by the UE .\tFor DCI format 2_0, the first one symbol applies if the duration of CORESET (in the IE ControlResourceSet) identified by controlResourceSetId indicates 3 symbols, the first two symbols apply if the duration of CORESET identified by controlResourceSetId indicates 2 symbols, and the first three symbols apply if the duration of CORESET identified by controlResourceSetId indicates 1 symbol.\tSee TS 38.213 [13], clause 10.\nnrofCandidates-SFI\tThe number of PDCCH candidates specifically for format 2-0 for the configured aggregation level. If an aggregation level is absent, the UE does not search for any candidates with that aggregation level. The network configures only one aggregationLevel and the corresponding number of candidates (see TS 38.213 [13], clause 11.1.1).\nnrofCandidates\tNumber of PDCCH candidates per aggregation level. The number of candidates and aggregation levels configured here applies to all formats unless a particular value is specified or a format-specific value is provided (see inside searchSpaceType). If configured in the SearchSpace of a cross carrier scheduled cell, this field determines the number of candidates and aggregation levels to be used on the linked scheduling cell (see TS 38.213 [13], clause 10).\nsearchSpaceId\tIdentity of the search space. SearchSpaceId = 0 identifies the searchSpaceZero configured via PBCH (MIB) or ServingCellConfigCommon and may hence not be used in the SearchSpace IE. The searchSpaceId is unique among the BWPs of a Serving Cell. In case of cross carrier scheduling, search spaces with the same searchSpaceId in scheduled cell and scheduling cell are linked to each other. The UE applies the search space for the scheduled cell only if the DL BWPs in which the linked search spaces are configured in scheduling cell and scheduled cell are both active.\nsearchSpaceType\tIndicates whether this is a common search space (present) or a UE specific search space as well as DCI formats to monitor for.\nue-Specific\tConfigures this search space as UE specific search space (USS). The UE monitors the DCI format with CRC scrambled by C-RNTI, CS-RNTI (if configured), and SP-CSI-RNTI (if configured)\n\nConditional Presence\tExplanation\nSetup\tThis field is mandatory present upon creation of a new SearchSpace. It is optionally present, Need M, otherwise.\nSetupOnly\n\n\u2013\tSearchSpaceId\nThe IE SearchSpaceId is used to identify Search Spaces. The ID space is used across the BWPs of a Serving Cell. The search space with the SearchSpaceId = 0 identifies the search space configured via PBCH (MIB) and in ServingCellConfigCommon (searchSpaceZero). The number of Search Spaces per BWP is limited to 10 including the common and UE specific Search Spaces.\nSearchSpaceId information element\n-- ASN1START\n-- TAG-SEARCHSPACEID-START\n\nSearchSpaceId ::=                   INTEGER (0..maxNrofSearchSpaces-1)\n\n-- TAG-SEARCHSPACEID-STOP\n-- ASN1STOP\n\n\u2013\tSearchSpaceZero\nThe IE SearchSpaceZero is used to configure SearchSpace#0 of the initial BWP (see TS 38.213 [13], clause 13).\nSearchSpaceZero information element\n-- ASN1START\n-- TAG-SEARCHSPACEZERO-START\n\nSearchSpaceZero ::=                 INTEGER (0..15)\n\n-- TAG-SEARCHSPACEZERO-STOP\n-- ASN1STOP\n\n\u2013\tSecurityAlgorithmConfig\nThe IE SecurityAlgorithmConfig is used to configure AS integrity protection algorithm and AS ciphering algorithm for SRBs and DRBs.\nSecurityAlgorithmConfig information element\n-- ASN1START\n-- TAG-SECURITYALGORITHMCONFIG-START\n\nSecurityAlgorithmConfig ::=         SEQUENCE {\n    cipheringAlgorithm                  CipheringAlgorithm,\n    integrityProtAlgorithm              IntegrityProtAlgorithm          OPTIONAL,   -- Need R\n    ...\n}\n\nIntegrityProtAlgorithm ::=          ENUMERATED {\n                                        nia0, nia1, nia2, nia3, spare4, spare3,\n                                        spare2, spare1, ...}\n\nCipheringAlgorithm ::=              ENUMERATED {\n                                        nea0, nea1, nea2, nea3, spare4, spare3,\n                                        spare2, spare1, ...}\n\n-- TAG-SECURITYALGORITHMCONFIG-STOP\n-- ASN1STOP\n\nSecurityAlgorithmConfig field descriptions\ncipheringAlgorithm\tIndicates the ciphering algorithm to be used for SRBs and DRBs, as specified in TS 33.501 [11]. The algorithms nea0-nea3 are identical to the LTE algorithms eea0-3. The algorithms configured for bearers using master key shall be the same as for all bearers using master key and the algorithms configured for bearers using secondary key shall be the same as for all bearers using secondary key. If UE is connected to NR/5GC, the algorithm shall be the same for all bearers.\nintegrityProtAlgorithm\tIf UE is connected to NR/5GC, this field indicates the integrity protection algorithm to be used for SRBs and DRBs, as specified in TS 33.501 [11]. The network does not configure nia0 for SRBs except for unauthenticated emergency sessions for unauthenticated UEs in LSM (limited service mode) and DRBs. If UE is connected to NR/5GC, this field is mandatory present, and the algorithm shall be the same for all bearers.\tIf UE is connected to E-UTRA/EPC, this field indicates the integrity protection algorithm to be used for SRBs configured with NR PDCP, as specified in TS 33.501 [11]. The algorithms nia0-nia3 is identical to the LTE algorithms eia0-3. The algorithms configured for SRBs using master key shall be the same as for all SRBs using master key and the algorithms configured for bearers using secondary key shall be the same as for all bearers using secondary key. The network does not configure nia0 for SRB3.\n\n\u2013\tServCellIndex\nThe IE ServCellIndex concerns a short identity, used to identify a serving cell (i.e. the PCell, the PSCell or an SCell). Value 0 applies for the PCell, while the SCellIndex that has previously been assigned applies for SCells.\nServCellIndex information element\n-- ASN1START\n-- TAG-SERVCELLINDEX-START\n\nServCellIndex ::=                   INTEGER (0..maxNrofServingCells-1)\n\n-- TAG-SERVCELLINDEX-STOP\n-- ASN1STOP\n\n\u2013\tServingCellConfig\nThe IE ServingCellConfig is used to configure (add or modify) the UE with a serving cell, which may be the SpCell or an SCell of an MCG or SCG. The parameters herein are mostly UE specific but partly also cell specific (e.g. in additionally configured bandwidth parts).\nServingCellConfig information element\n-- ASN1START\n-- TAG-SERVINGCELLCONFIG-START\n\nServingCellConfig ::=               SEQUENCE {\n    tdd-UL-DL-ConfigurationDedicated    TDD-UL-DL-ConfigDedicated                                   OPTIONAL,   -- Cond TDD\n    initialDownlinkBWP                  BWP-DownlinkDedicated                                       OPTIONAL,   -- Need M\n    downlinkBWP-ToReleaseList           SEQUENCE (SIZE (1..maxNrofBWPs)) OF BWP-Id                  OPTIONAL,   -- Need N\n    downlinkBWP-ToAddModList            SEQUENCE (SIZE (1..maxNrofBWPs)) OF BWP-Downlink            OPTIONAL,   -- Need N\n    firstActiveDownlinkBWP-Id           BWP-Id                                                      OPTIONAL,   -- Cond SyncAndCellAdd\n    bwp-InactivityTimer                 ENUMERATED {ms2, ms3, ms4, ms5, ms6, ms8, ms10, ms20, ms30,\n                                                    ms40,ms50, ms60, ms80,ms100, ms200,ms300, ms500,\n                                                    ms750, ms1280, ms1920, ms2560, spare10, spare9, spare8,\n                                                    spare7, spare6, spare5, spare4, spare3, spare2, spare1 }    OPTIONAL,   --Need R\n    defaultDownlinkBWP-Id               BWP-Id                                                                  OPTIONAL,   -- Need S\n    uplinkConfig                        UplinkConfig                                                            OPTIONAL,   -- Need M\n    supplementaryUplink                 UplinkConfig                                                            OPTIONAL,   -- Need M\n    pdcch-ServingCellConfig             SetupRelease { PDCCH-ServingCellConfig }                                OPTIONAL,   -- Need M\n    pdsch-ServingCellConfig             SetupRelease { PDSCH-ServingCellConfig }                                OPTIONAL,   -- Need M\n    csi-MeasConfig                      SetupRelease { CSI-MeasConfig }                                         OPTIONAL,   -- Need M\n    sCellDeactivationTimer              ENUMERATED {ms20, ms40, ms80, ms160, ms200, ms240,\n                                                    ms320, ms400, ms480, ms520, ms640, ms720,\n                                                    ms840, ms1280, spare2,spare1}       OPTIONAL,   -- Cond ServingCellWithoutPUCCH\n    crossCarrierSchedulingConfig        CrossCarrierSchedulingConfig                                    OPTIONAL,   -- Need M\n    tag-Id                              TAG-Id,\n    dummy                               ENUMERATED {enabled}                                            OPTIONAL,   -- Need R\n    pathlossReferenceLinking            ENUMERATED {pCell, sCell}                                       OPTIONAL,   -- Cond SCellOnly\n    servingCellMO                       MeasObjectId                                                    OPTIONAL,   -- Cond MeasObject\n    ...,\n    [[\n    lte-CRS-ToMatchAround               SetupRelease { RateMatchPatternLTE-CRS }                                OPTIONAL,   -- Need M\n    rateMatchPatternToAddModList        SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPattern       OPTIONAL,   -- Need N\n    rateMatchPatternToReleaseList       SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPatternId     OPTIONAL,   -- Need N\n    downlinkChannelBW-PerSCS-List       SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier                     OPTIONAL    -- Need S\n    ]]\n}\n\nUplinkConfig ::=                    SEQUENCE {\n    initialUplinkBWP                    BWP-UplinkDedicated                                         OPTIONAL,   -- Need M\n    uplinkBWP-ToReleaseList             SEQUENCE (SIZE (1..maxNrofBWPs)) OF BWP-Id                  OPTIONAL,   -- Need N\n    uplinkBWP-ToAddModList              SEQUENCE (SIZE (1..maxNrofBWPs)) OF BWP-Uplink              OPTIONAL,   -- Need N\n    firstActiveUplinkBWP-Id             BWP-Id                                                      OPTIONAL,   -- Cond SyncAndCellAdd\n    pusch-ServingCellConfig             SetupRelease { PUSCH-ServingCellConfig }                    OPTIONAL,   -- Need M\n    carrierSwitching                    SetupRelease { SRS-CarrierSwitching }                       OPTIONAL,   -- Need M\n    ...,\n    [[\n    powerBoostPi2BPSK                   BOOLEAN                                                     OPTIONAL,   -- Need M\n    uplinkChannelBW-PerSCS-List         SEQUENCE (SIZE (1..maxSCSs)) OF SCS-SpecificCarrier         OPTIONAL    -- Need S\n    ]]\n}\n\n-- TAG-SERVINGCELLCONFIG-STOP\n-- ASN1STOP\n\nServingCellConfig field descriptions\nbwp-InactivityTimer\tThe duration in ms after which the UE falls back to the default Bandwidth Part. (see TS 38.321 [3], clause 5.15) The value 0.5 ms is only applicable for carriers >6 GHz. When the network releases the timer configuration, the UE stops the timer without switching to the default BWP.\ncrossCarrierSchedulingConfig\tIndicates whether this serving cell is cross-carrier scheduled by another serving cell or whether it cross-carrier schedules another serving cell.\ndefaultDownlinkBWP-Id\tThe initial bandwidth part is referred to by BWP-Id = 0. ID of the downlink bandwidth part to be used upon expiry of the BWP inactivity timer. This field is UE specific. When the field is absent the UE uses the initial BWP as default BWP. (see  TS 38.213 [13], clause 12 and TS 38.321 [3], clause 5.15).\ndownlinkBWP-ToAddModList\tList of additional downlink bandwidth parts to be added or modified. (see TS 38.213 [13], clause 12).\ndownlinkBWP-ToReleaseList\tList of additional downlink bandwidth parts to be released. (see TS 38.213 [13], clause 12).\ndownlinkChannelBW-PerSCS-List\tA set of UE specific channel bandwidth and location configurations for different subcarrier spacings (numerologies). Defined in relation to Point A. The UE uses the configuration provided in this field only for the purpose of channel bandwidth and location determination. If absent, UE uses the configuration indicated in scs-SpecificCarrierList in DownlinkConfigCommon / DownlinkConfigCommonSIB. Network only configures channel bandwidth that corresponds to the channel bandwidth values defined in TS 38.101-1 [15] and TS 38.101-2 [39].\nfirstActiveDownlinkBWP-Id\tIf configured for an SpCell, this field contains the ID of the DL BWP to be activated upon performing the RRC (re-)configuration. If the field is absent, the RRC (re-)configuration does not impose a BWP switch.\tIf configured for an SCell, this field contains the ID of the downlink bandwidth part to be used upon MAC-activation of an SCell. The initial bandwidth part is referred to by BWP-Id = 0.\tUpon reconfigurationWithSync (PCell handover, PSCelladdition/change), the network sets the firstActiveDownlinkBWP-Id and firstActiveUplinkBWP-Id to the same value.\ninitialDownlinkBWP\nlte-CRS-ToMatchAround\tParameters to determine an LTE CRS pattern that the UE shall rate match around.\npathlossReferenceLinking\tIndicates whether UE shall apply as pathloss reference either the downlink of PCell or of SCell that corresponds with this uplink (see TS 38.213 [13], clause 7).\npdsch-ServingCellConfig\tPDSCH related parameters that are not BWP-specific.\nrateMatchPatternToAddModList\tResources patterns which the UE should rate match PDSCH around. The UE rate matches around the union of all resources indicated in the nested bitmaps. Rate match patterns defined here on cell level apply only to PDSCH of the same numerology. See TS 38.214 [19], clause 5.1.2.2.3.\nsCellDeactivationTimer\tSCell deactivation timer in TS 38.321 [3]. If the field is absent, the UE applies the value infinity.\nservingCellMO\tmeasObjectId of the MeasObjectNR in MeasConfig which is associated to the serving cell. For this MeasObjectNR, the following relationship applies between this MeasObjectNR and frequencyInfoDL in ServingCellConfigCommon of the serving cell: if ssbFrequency is configured, its value is the same as the absoluteFrequencySSB and if csi-rs-ResourceConfigMobility is configured, the value of its subcarrierSpacing is present in one entry of the scs-SpecificCarrierList, csi-RS-CellListMobility includes an entry corresponding to the serving cell (with cellId equal to physCellId in ServingCellConfigCommon) and the frequency range indicated by the csi-rs-MeasurementBW of the entry in csi-RS-CellListMobility is included in the frequency range indicated by in the entry of the scs-SpecificCarrierList.   \nsupplementaryUplink\tNetwork may configure this field only when supplementaryUplinkConfig is configured in ServingCellConfigCommon or ServingCellConfigCommonSIB.\ntag-Id\tTiming Advance Group ID, as specified in TS 38.321 [3], which this cell belongs to.\nuplinkConfig\tNetwork may configure this field only when uplinkConfigCommon is configured in ServingCellConfigCommon or ServingCellConfigCommonSIB.\n\nUplinkConfig field descriptions\ncarrierSwitching\tIncludes parameters for configuration of carrier based SRS switching (see TS 38.214 [19], clause 6.2.1.3.\nfirstActiveUplinkBWP-Id\tIf configured for an SpCell, this field contains the ID of the UL BWP to be activated upon performing the RRC (re-)configuration. If the field is absent, the RRC (re-)configuration does not impose a BWP switch.\tIf configured for an SCell, this field contains the ID of the uplink bandwidth part to be used upon MAC-activation of an SCell. The initial bandwidth part is referred to by BandiwdthPartId = 0.\ninitialUplinkBWP\npowerBoostPi2BPSK\tIf this field is set to true, the UE determines the maximum output power for PUCCH/PUSCH transmissions that use pi/2 BPSK modulation according to TS 38.101-1 [15], clause 6.2.4.\npusch-ServingCellConfig\tPUSCH related parameters that are not BWP-specific.\nuplinkBWP-ToReleaseList\tThe additional bandwidth parts for uplink. In case of TDD uplink- and downlink BWP with the same bandwidthPartId are considered as a BWP pair and must have the same center frequency.\nuplinkChannelBW-PerSCS-List\tA set of UE specific channel bandwidth and location configurations for different subcarrier spacings (numerologies). Defined in relation to Point A. The UE uses the configuration provided in this field only for the purpose of channel bandwidth and location determination. If absent, UE uses the configuration indicated in scs-SpecificCarrierList in UplinkConfigCommon / UplinkConfigCommonSIB. Network only configures channel bandwidth that corresponds to the channel bandwidth values defined in TS 38.101-1 [15] and TS 38.101-2 [39].\n\nNOTE 1:\tIf the dedicated part of initial UL/DL BWP configuration is not present, the initial BWP can be used but with some limitations. For example, changing to another BWP requires RRCReconfiguration since DCI format 1_0 doesn't support DCI-based switching.\n\nConditional Presence\tExplanation\nMeasObject\tThis field is mandatory present for the SpCell if the UE has a measConfig, and it is optionally present, Need M, for SCells.\nSCellOnly\tThis field is optionally present, Need R, for SCells. It is absent otherwise. \nServingCellWithoutPUCCH\tThis field is optionally present, Need S, for SCells except PUCCH SCells. It is absent otherwise. \nSyncAndCellAdd\tThis field is mandatory present for a SpCell upon reconfigurationWithSync (PCell handover, PSCelladdition/change) and upon RRCsetup/RRCResume.\tThe field is mandatory present for an SCell upon addition.\tFor SpCell, the field is optionally present, Need N, upon reconfiguration without reconfigurationWithSync.\tIn all other cases the field is absent. \nTDD\tThis field is optionally present, Need R, for TDD cells. It is absent otherwise. \n\n\u2013\tServingCellConfigCommon\nThe IE ServingCellConfigCommon is used to configure cell specific parameters of a UE's serving cell. The IE contains parameters which a UE would typically acquire from SSB, MIB or SIBs when accessing the cell from IDLE. With this IE, the network provides this information in dedicated signalling when configuring a UE with a SCells or with an additional cell group (SCG). It also provides it for SpCells (MCG and SCG) upon reconfiguration with sync.\nServingCellConfigCommon information element\n-- ASN1START\n-- TAG-SERVINGCELLCONFIGCOMMON-START\n\nServingCellConfigCommon ::=         SEQUENCE {\n    physCellId                          PhysCellId                                              OPTIONAL,   -- Cond HOAndServCellAdd,\n    downlinkConfigCommon                DownlinkConfigCommon                                    OPTIONAL,   -- Cond HOAndServCellAdd\n\n    uplinkConfigCommon                  UplinkConfigCommon                                      OPTIONAL,   -- Need M\n    supplementaryUplinkConfig           UplinkConfigCommon                                      OPTIONAL,   -- Need S\n    n-TimingAdvanceOffset               ENUMERATED { n0, n25600, n39936 }                       OPTIONAL,   -- Need S\n    ssb-PositionsInBurst                CHOICE {\n        shortBitmap                         BIT STRING (SIZE (4)),\n        mediumBitmap                        BIT STRING (SIZE (8)),\n        longBitmap                          BIT STRING (SIZE (64))\n    }                                                                                           OPTIONAL, -- Cond AbsFreqSSB\n    ssb-periodicityServingCell          ENUMERATED { ms5, ms10, ms20, ms40, ms80, ms160, spare2, spare1 }   OPTIONAL, -- Need S\n    dmrs-TypeA-Position                 ENUMERATED {pos2, pos3},\n    lte-CRS-ToMatchAround               SetupRelease { RateMatchPatternLTE-CRS }                            OPTIONAL, -- Need M\n    rateMatchPatternToAddModList        SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPattern   OPTIONAL, -- Need N\n    rateMatchPatternToReleaseList       SEQUENCE (SIZE (1..maxNrofRateMatchPatterns)) OF RateMatchPatternId OPTIONAL, -- Need N\n    ssbSubcarrierSpacing                SubcarrierSpacing                                       OPTIONAL, -- Cond HOAndServCellAdd\n    tdd-UL-DL-ConfigurationCommon       TDD-UL-DL-ConfigCommon                                  OPTIONAL, -- Cond TDD\n    ss-PBCH-BlockPower                  INTEGER (-60..50),\n    ...\n}\n\n\n-- TAG-SERVINGCELLCONFIGCOMMON-STOP\n-- ASN1STOP\n\nServingCellConfigCommon field descriptions\ndmrs-TypeA-Position\tPosition of (first) DM-RS for downlink (see TS 38.211 [16], clause 7.4.1.1.1) and uplink (TS 38.211 [16], clause 6.4.1.1.3).\ndownlinkConfigCommon\tThe common downlink configuration of the serving cell, including the frequency information configuration and the initial downlink BWP common configuration. The parameters provided herein should match the parameters configured by MIB and SIB1 (if provided) of the serving cell, with the exception of controlResourceSetZero and searchSpaceZero which can be configured in ServingCellConfigCommon even if MIB indicates that they are not present.\nlongBitmap\tBitmap when maximum number of SS/PBCH blocks per half frame equals to 64 as defined in TS 38.213 [13], clause 4.1.\nlte-CRS-ToMatchAround\tParameters to determine an LTE CRS pattern that the UE shall rate match around.\nmediumBitmap\tBitmap when maximum number of SS/PBCH blocks per half frame equals to 8 as defined in TS 38.213 [13], clause 4.1.\nn-TimingAdvanceOffset\tThe N_TA-Offset to be applied for random access on this serving cell. If the field is absent, the UE applies the value defined for the duplex mode and frequency range of this serving cell. See TS 38.133 [14], table 7.1.2-2.\nrateMatchPatternToAddModList\tResources patterns which the UE should rate match PDSCH around. The UE rate matches around the union of all resources indicated in the nested bitmaps. Rate match patterns defined here on cell level apply only to PDSCH of the same numerology (see TS 38.214 [19], clause 5.1.4,1).\nshortBitmap\tBitmap when maximum number of SS/PBCH blocks per half frame equals to 4 as defined in TS 38.213 [13], clause 4.1.\nss-PBCH-BlockPower\tAverage EPRE of the resources elements that carry secondary synchronization signals in dBm that the NW used for SSB transmission, see TS 38.213 [13], clause 7.\nssb-periodicityServingCell\tThe SSB periodicity in ms for the rate matching purpose. If the field is absent, the UE applies the value ms5. (see TS 38.213 [13], clause 4.1)\nssb-PositionsInBurst\tIndicates the time domain positions of the transmitted SS-blocks in a half frame with SS/PBCH blocks as defined in TS 38.213 [13], clause 4.1. The first/ leftmost bit corresponds to SS/PBCH block index 0, the second bit corresponds to SS/PBCH block index 1, and so on. Value 0 in the bitmap indicates that the corresponding SS/PBCH block is not transmitted while value 1 indicates that the corresponding SS/PBCH block is transmitted. The network configures the same pattern in this field as in the corresponding field in ServingCellConfigCommonSIB.\nssbSubcarrierSpacing\tSubcarrier spacing of SSB. Only the values 15 kHz or 30 kHz (<6GHz), 120 kHz or 240 kHz (>6GHz) are applicable.\nsupplementaryUplinkConfig\tThe network configures this field only if uplinkConfigCommon is configured. If this field is absent, the UE shall release the supplementaryUplinkConfig and the supplementaryUplink configured in ServingCellConfig of this serving cell, if configured.\ntdd-UL-DL-ConfigurationCommon\tA cell-specific TDD UL/DL configuration, see TS 38.213 [13], clause 11.1.\n\nConditional Presence\tExplanation\nAbsFreqSSB\tThe field is absent when absoluteFrequencySSB in frequencyInfoDL is absent, otherwise the field is mandatory present. \nHOAndServCellAdd\tThis field is mandatory present for inter-cell handover and upon serving cell (PSCell/SCell) addition. Otherwise, the field is absent. \nTDD\tThe field is optionally present, Need R, for TDD cells; otherwise it is not present. \n\n\u2013\tServingCellConfigCommonSIB\nThe IE ServingCellConfigCommonSIB is used to configure cell specific parameters of a UE's serving cell in SIB1.\nServingCellConfigCommonSIB information element\n-- ASN1START\n-- TAG-SERVINGCELLCONFIGCOMMONSIB-START\n\nServingCellConfigCommonSIB ::=      SEQUENCE {\n    downlinkConfigCommon                DownlinkConfigCommonSIB,\n    uplinkConfigCommon                  UplinkConfigCommonSIB                                       OPTIONAL, -- Need R\n    supplementaryUplink                 UplinkConfigCommonSIB                                       OPTIONAL, -- Need R\n    n-TimingAdvanceOffset               ENUMERATED { n0, n25600, n39936 }                           OPTIONAL, -- Need S\n    ssb-PositionsInBurst                SEQUENCE {\n        inOneGroup                          BIT STRING (SIZE (8)),\n        groupPresence                       BIT STRING (SIZE (8))                                   OPTIONAL  -- Cond Above6GHzOnly\n    },\n    ssb-PeriodicityServingCell          ENUMERATED {ms5, ms10, ms20, ms40, ms80, ms160},\n\n    tdd-UL-DL-ConfigurationCommon       TDD-UL-DL-ConfigCommon                                      OPTIONAL, -- Cond TDD\n    ss-PBCH-BlockPower                  INTEGER (-60..50),\n    ...\n}\n\n-- TAG-SERVINGCELLCONFIGCOMMONSIB-STOP\n-- ASN1STOP\n\nServingCellConfigCommonSIB field descriptions\ngroupPresence\tThis field is present when maximum number of SS/PBCH blocks per half frame equals to 64 as defined in TS 38.213 [13], clause 4.1. The first/leftmost bit corresponds to the SS/PBCH index 0-7, the second bit corresponds to SS/PBCH block 8-15, and so on. Value 0 in the bitmap indicates that the SSBs according to inOneGroup are not present. Value 1 indicates that the SS/PBCH blocks are transmitted in accordance with inOneGroup.\ninOneGroup\tWhen maximum number of SS/PBCH blocks per half frame equals to 4 as defined in TS 38.213 [13], clause 4.1, only the 4 leftmost bits are valid; the UE ignores the 4 rightmost bits. When maximum number of SS/PBCH blocks per half frame equals to 8 as defined in TS 38.213 [13], clause 4.1, all 8 bits are valid. The first/ leftmost bit corresponds to SS/PBCH block index 0, the second bit corresponds to SS/PBCH block index 1, and so on. When maximum number of SS/PBCH blocks per half frame equals to 64 as defined in TS 38.213 [13], clause 4.1, all 8 bit are valid; The first/ leftmost bit corresponds to the first SS/PBCH block index in the group (i.e., to SSB index 0, 8, and so on); the second bit corresponds to the second SS/PBCH block index in the group (i.e., to SSB index 1, 9, and so on), and so on.  Value 0 in the bitmap indicates that the corresponding SS/PBCH block is not transmitted while value 1 indicates that the corresponding SS/PBCH block is transmitted.\nn-TimingAdvanceOffset\tThe N_TA-Offset to be applied for random access on this serving cell. If the field is absent, the UE applies the value defined for the duplex mode and frequency range of this serving cell. See TS 38.133 [14], table 7.1.2-2.\nssb-PositionsInBurst\tTime domain positions of the transmitted SS-blocks in an SS-burst as defined in TS  38.213 [13], clause 4.1.\nss-PBCH-BlockPower\tAverage EPRE of the resources elements that carry secondary synchronization signals in dBm that the NW used for SSB transmission, see TS 38.213 [13], clause 7.\n\nConditional Presence\tExplanation\nAbove6GHzOnly\tThis field is mandatory present when the carrier frequency is above 6GHz. It is absent otherwise and UE releases any configured value.\nTDD\tThe field is optionally present, Need R, for TDD cells; otherwise it is not present. \n\n\u2013\tShortI-RNTI-Value\nThe IE ShortI-RNTI-Value is used to identify the suspended UE context of a UE in RRC_INACTIVE using fewer bits compared to I-RNTI-Value.\nShortI-RNTI-Value information element\n-- ASN1START\n-- TAG-SHORTI-RNTI-VALUE-START\n\nShortI-RNTI-Value ::=   BIT STRING (SIZE(24))\n\n-- TAG-SHORTI-RNTI-VALUE-STOP\n-- ASN1STOP\n\n\u2013\tShortMAC-I\nThe IE ShortMAC-I is used to identify and verify the UE at RRC connection re-establishment. The 16 least significant bits of the MAC-I calculated using the AS security configuration of the source PCell, as specified in 5.3.7.4.\nShortMAC-I information element\n-- ASN1START\n-- TAG-SHORTMAC-I-START\n\nShortMAC-I ::=                      BIT STRING (SIZE (16))\n\n-- TAG-SHORTMAC-I-STOP\n-- ASN1STOP\n\n\u2013\tSINR-Range\nThe IE SINR-Range specifies the value range used in SINR measurements and thresholds. For measurements, integer value for SINR measurements is according to Table 10.1.16.1-1 in TS 38.133 [14]. For thresholds, the actual value is (IE value \u2013 46) / 2 dB.\nSINR-Range information element\n-- ASN1START\n-- TAG-SINR-RANGE-START\n\nSINR-Range ::=                      INTEGER(0..127)\n\n-- TAG-SINR-RANGE-STOP\n-- ASN1STOP\n\n\u2013\tSI-SchedulingInfo\nThe IE SI-SchedulingInfo contains information needed for acquisition of SI messages.\nSI-SchedulingInfo information element\n-- ASN1START\n-- TAG\u2013SI-SCHEDULINGINFO-START\n\nSI-SchedulingInfo ::=               SEQUENCE {\n    schedulingInfoList                  SEQUENCE (SIZE (1..maxSI-Message)) OF SchedulingInfo,\n    si-WindowLength                     ENUMERATED {s5, s10, s20, s40, s80, s160, s320, s640, s1280},\n    si-RequestConfig                    SI-RequestConfig                                                OPTIONAL,  -- Cond MSG-1\n    si-RequestConfigSUL                 SI-RequestConfig                                                OPTIONAL,  -- Cond SUL-MSG-1\n    systemInformationAreaID             BIT STRING (SIZE (24))                                          OPTIONAL,   -- Need R\n    ...\n}\n\nSchedulingInfo ::=                  SEQUENCE {\n    si-BroadcastStatus                  ENUMERATED {broadcasting, notBroadcasting},\n    si-Periodicity                      ENUMERATED {rf8, rf16, rf32, rf64, rf128, rf256, rf512},\n    sib-MappingInfo                     SIB-Mapping\n}\n\nSIB-Mapping ::=                     SEQUENCE (SIZE (1..maxSIB)) OF SIB-TypeInfo\n\nSIB-TypeInfo ::=                    SEQUENCE {\n    type                                ENUMERATED {sibType2, sibType3, sibType4, sibType5, sibType6, sibType7, sibType8, sibType9,\n                                                    spare8, spare7, spare6, spare5, spare4, spare3, spare2, spare1,... },\n    valueTag                            INTEGER (0..31)                                                  OPTIONAL, -- Cond SIB-TYPE\n    areaScope                           ENUMERATED {true}                                                OPTIONAL -- Need S\n}\n\n-- Configuration for Msg1 based SI Request\nSI-RequestConfig::=                 SEQUENCE {\n    rach-OccasionsSI                    SEQUENCE {\n        rach-ConfigSI                       RACH-ConfigGeneric,\n        ssb-perRACH-Occasion                ENUMERATED {oneEighth, oneFourth, oneHalf, one, two, four, eight, sixteen}\n    }                                                                                                       OPTIONAL,   -- Need R\n    si-RequestPeriod                    ENUMERATED {one, two, four, six, eight, ten, twelve, sixteen}       OPTIONAL,   -- Need R\n    si-RequestResources                 SEQUENCE (SIZE (1..maxSI-Message)) OF SI-RequestResources\n}\n\nSI-RequestResources ::=             SEQUENCE {\n    ra-PreambleStartIndex               INTEGER (0..63),\n    ra-AssociationPeriodIndex           INTEGER (0..15)                                                     OPTIONAL,   -- Need R\n    ra-ssb-OccasionMaskIndex            INTEGER (0..15)                                                     OPTIONAL    -- Need R\n}\n\n-- TAG-SI-SCHEDULINGINFO-STOP\n-- ASN1STOP\n\nSchedulingInfo field descriptions\nareaScope\tIndicates that a SIB is area specific. If the field is not present, the SIB is cell specific.\nsi-BroadcastStatus\tIndicates if the SI message is being broadcasted or not. Change of si-BroadcastStatus should not result in system information change notifications in Short Message transmitted with P-RNTI over DCI (see clause 6.5). The value of the indication is valid until the end of the BCCH modification period when set to broadcasting.\nsi-Periodicity\tPeriodicity of the SI-message in radio frames. Value rf8 corresponds to 8 radio frames, value rf16 corresponds to 16 radio frames, and so on.\n\nSI-RequestConfig field descriptions\nrach-OccasionsSI\tConfiguration of dedicated RACH Occassions for SI. If the field is absent, the UE uses the corresponding parameters configured in rach-ConfigCommon of the initial uplink BWP.\nsi-RequestPeriod\tPeriodicity of the SI-Request configuration in number of association periods.\nsi-RequestResources\tIf there is only one entry in the list, the configuration is used for all SI messages for which si-BroadcastStatus is set to notBroadcasting. Otherwise the 1st entry in the list corresponds to the first SI message in schedulingInfoList for which si-BroadcastStatus is set to notBroadcasting, 2nd entry in the list corresponds to the second SI message in schedulingInfoList for which si-BroadcastStatus is set to notBroadcasting and so on. Change of si-RequestResources should not result in system information change notification.\n\nSI-RequestResources field descriptions\nra-AssociationPeriodIndex\tIndex of the association period in the si-RequestPeriod in which the UE can send the SI request for SI message(s) corresponding to this SI-RequestResources, using the preambles indicated by ra-PreambleStartIndex and rach occasions indicated by ra-ssb-OccasionMaskIndex.\nra-PreambleStartIndex\tIf N SSBs are associated with a RACH occasion, where N > = 1, for the i-th SSB (i=0, \u2026, N-1) the preamble with preamble index = ra-PreambleStartIndex + i is used for SI request; For N < 1, the preamble with preamble index = ra-PreambleStartIndex is used for SI request.\n\nSI-SchedulingInfo field descriptions\nsi-RequestConfig\tConfiguration of Msg1 resources that the UE uses for requesting SI-messages for which si-BroadcastStatus is set to notBroadcasting. If the field is not present the UE uses Msg3 to request SI-messages for which si-BroadcastStatus is set to notBroadcasting (if any). \nsi-RequestConfigSUL\tConfiguration of Msg1 resources that the UE uses for requesting SI-messages for which si-BroadcastStatus is set to notBroadcasting. If the field is not present the UE uses Msg3 to request SI-messages for which si-BroadcastStatus is set to notBroadcasting (if any) on supplementary uplink.\nsi-WindowLength\tThe length of the SI scheduling window. Value s5 corresponds to 5 slots, value s10 corresponds to 10 slots and so on. The network always configures si-WindowLength to be shorter than or equal to the si-Periodicity.\nsystemInformationAreaID\tIndicates the system information area that the cell belongs to, if any. Any SIB with areaScope within the SI is considered to belong to this systemInformationAreaID. The systemInformationAreaID is unique within a PLMN.\n\nConditional presence\tExplanation\nMSG-1\tThe field is optionally present, Need R, if si-BroadcastStatus is set to notBroadcasting for any SI-message included in SchedulingInfo. It is absent otherwise. \nSIB-TYPE\tThe field is mandatory present if the SIB type is different from SIB6, SIB7 or SIB8. For SIB6, SIB7 and SIB8 it is not present.  \nSUL-MSG-1\tThe field is optionally present, Need R, if this serving cell is configured with a supplementary uplink and if si-BroadcastStatus is set to notBroadcasting for any SI-message included in SchedulingInfo. It is absent otherwise.  \n\n\u2013\tSlotFormatCombinationsPerCell\nThe IE SlotFormatCombinationsPerCell is used to configure the SlotFormatCombinations applicable for one serving cell (see TS 38.213 [13], clause 11.1.1).\nSlotFormatCombinationsPerCell information element\n-- ASN1START\n-- TAG-SLOTFORMATCOMBINATIONSPERCELL-START\n\nSlotFormatCombinationsPerCell ::=   SEQUENCE {\n    servingCellId                       ServCellIndex,\n    subcarrierSpacing                   SubcarrierSpacing,\n    subcarrierSpacing2                  SubcarrierSpacing                                                         OPTIONAL, -- Need R\n    slotFormatCombinations              SEQUENCE (SIZE (1..maxNrofSlotFormatCombinationsPerSet)) OF SlotFormatCombination\n                                                                                                                  OPTIONAL, -- Need M\n    positionInDCI                       INTEGER(0..maxSFI-DCI-PayloadSize-1)                                      OPTIONAL, -- Need M\n    ...\n}\n\nSlotFormatCombination ::=           SEQUENCE {\n    slotFormatCombinationId             SlotFormatCombinationId,\n    slotFormats                         SEQUENCE (SIZE (1..maxNrofSlotFormatsPerCombination)) OF INTEGER (0..255)\n}\n\nSlotFormatCombinationId ::=         INTEGER (0..maxNrofSlotFormatCombinationsPerSet-1)\n\n-- TAG-SLOTFORMATCOMBINATIONSPERCELL-STOP\n-- ASN1STOP\n\nSlotFormatCombination field descriptions\nslotFormatCombinationId\tThis ID is used in the DCI payload to dynamically select this SlotFormatCombination, see TS 38.213 [13], clause 11.1.1.\nslotFormats\tSlot formats that occur in consecutive slots in time domain order as listed here (see TS 38.213 [13], clause 11.1.1).\n\nSlotFormatCombinationsPerCell field descriptions\npositionInDCI\tThe (starting) position (bit) of the slotFormatCombinationId (SFI-Index) for this serving cell (servingCellId) within the DCI payload (see TS 38.213 [13], clause 11.1.1).\nservingCellId\tThe ID of the serving cell for which the slotFormatCombinations are applicable.\nslotFormatCombinations\tA list with SlotFormatCombinations. Each SlotFormatCombination comprises of one or more SlotFormats (see TS 38.211 [16], clause 4.3.2). The total number of slotFormats in the slotFormatCombinations list does not exceed 512. \nsubcarrierSpacing2\tReference subcarrier spacing for a Slot Format Combination on an FDD or SUL cell (see TS 38.213 [13], clause 11.1.1). For FDD, subcarrierSpacing (SFI-scs) is the reference SCS for DL BWP and subcarrierSpacing2 (SFI-scs2) is the reference SCS for UL BWP. For SUL, subcarrierSpacing (SFI-scs) is the reference SCS for non-SUL carrier and subcarrierSpacing2 (SFI-scs2) is the reference SCS for SUL carrier. The network configures a value that is smaller than or equal to any SCS of configured BWPs of the serving cell that the command applies to. And the network configures a value that is smaller than or equal to the SCS of the serving cell which the UE monitors for SFI indications.\nsubcarrierSpacing\tReference subcarrier spacing for this Slot Format Combination. The network configures a value that is smaller than or equal to any SCS of configured BWPs of the serving cell that the command applies to. And the network configures a value that is smaller than or equal to the SCS of the serving cell which the UE monitors for SFI indications (see TS 38.213 [13], clause 11.1.1).\n\n\u2013\tSlotFormatIndicator\nThe IE SlotFormatIndicator is used to configure monitoring a Group-Common-PDCCH for Slot-Format-Indicators (SFI).\nSlotFormatIndicator information element\n-- ASN1START\n-- TAG-SLOTFORMATINDICATOR-START\n\nSlotFormatIndicator ::=     SEQUENCE {\n    sfi-RNTI                    RNTI-Value,\n    dci-PayloadSize             INTEGER (1..maxSFI-DCI-PayloadSize),\n    slotFormatCombToAddModList  SEQUENCE (SIZE(1..maxNrofAggregatedCellsPerCellGroup)) OF SlotFormatCombinationsPerCell\n                                                                                                                OPTIONAL, -- Need N\n    slotFormatCombToReleaseList SEQUENCE (SIZE(1..maxNrofAggregatedCellsPerCellGroup)) OF ServCellIndex         OPTIONAL, -- Need N\n    ...\n}\n\n-- TAG-SLOTFORMATINDICATOR-STOP\n-- ASN1STOP\n\nSlotFormatIndicator field descriptions\ndci-PayloadSize\tTotal length of the DCI payload scrambled with SFI-RNTI (see TS 38.213 [13], clause 11.1.1).\nsfi-RNTI\tRNTI used for SFI on the given cell (see TS 38.213 [13], clause 11.1.1).\nslotFormatCombToAddModList\tA list of SlotFormatCombinations for the UE's serving cells (see TS 38.213 [13], clause 11.1.1).\n\n\u2013\tS-NSSAI\nThe IE S-NSSAI (Single Network Slice Selection Assistance Information) identifies a Network Slice end to end and comprises a slice/service type and a slice differentiator, see TS 23.003 [21].\nS-NSSAI information element\n-- ASN1START\n-- TAG-S-NSSAI-START\n\nS-NSSAI  ::=                        CHOICE{\n    sst                                 BIT STRING (SIZE (8)),\n    sst-SD                              BIT STRING (SIZE (32))\n}\n\n-- TAG-S-NSSAI-STOP\n-- ASN1STOP\n\nS-NSSAI field descriptions\nsst\tIndicates the S-NSSAI consisting of Slice/Service Type, see TS 23.003 [21].\nsst-SD\tIndicates the S-NSSAI consisting of Slice/Service Type and Slice Differentiator, see TS 23.003 [21].\n\n\u2013\tSpeedStateScaleFactors\nThe IE SpeedStateScaleFactors concerns factors, to be applied when the UE is in medium or high speed state, used for scaling a mobility control related parameter.\nSpeedStateScaleFactors information element\n-- ASN1START\n-- TAG-SPEEDSTATESCALEFACTORS-START\n\nSpeedStateScaleFactors ::=          SEQUENCE {\n    sf-Medium                           ENUMERATED {oDot25, oDot5, oDot75, lDot0},\n    sf-High                             ENUMERATED {oDot25, oDot5, oDot75, lDot0}\n}\n-- TAG-SPEEDSTATESCALEFACTORS-STOP\n-- ASN1STOP\n\nSpeedStateScaleFactors field descriptions\nsf-High\tThe concerned mobility control related parameter is multiplied with this factor if the UE is in High Mobility state as defined in TS 38.304 [20]. Value oDot25 corresponds to 0.25, value oDot5 corresponds to 0.5, oDot75 corresponds to 0.75 and so on.\nsf-Medium\tThe concerned mobility control related parameter is multiplied with this factor if the UE is in Medium Mobility state as defined in TS 38.304 [20]. Value oDot25 corresponds to 0.25, value oDot5 corresponds to 0.5, value oDot75 corresponds to 0.75, and so on.\n\n\u2013\tSS-RSSI-Measurement\nThe IE SS-RSSI-Measurement is used to configure RSSI measurements based on synchronization reference signals.\nSS-RSSI-Measurement information element\n-- ASN1START\n-- TAG-SS-RSSI-MEASUREMENT-START\n\nSS-RSSI-Measurement ::=             SEQUENCE {\n    measurementSlots                    BIT STRING (SIZE (1..80)),\n    endSymbol                           INTEGER(0..3)\n}\n\n-- TAG-SS-RSSI-MEASUREMENT-STOP\n-- ASN1STOP\n\nSS-RSSI-Measurement field descriptions\nendSymbol\tWithin a slot that is configured for RSSI measurements (see measurementSlots) the UE measures the RSSI from symbol 0 to symbol endSymbol. This field identifies the entry in Table 5.1.3-1 in TS 38.215 [9], which determines the actual end symbol.\nmeasurementSlots\tIndicates the slots in which the UE can perform RSSI measurements. The length of the BIT STRING is equal to the number of slots in the configured SMTC window (determined by the duration and by the subcarrierSpacing). The first (left-most / most significant) bit in the bitmap corresponds to the first slot in the SMTC window, the second bit in the bitmap corresponds to the second slot in the SMTC window, and so on. The UE measures in slots for which the corresponding bit in the bitmap is set to 1.\n\n\u2013\tSPS-Config\nThe IE SPS-Config is used to configure downlink semi-persistent transmission. Downlink SPS may be configured on the SpCell as well as on SCells. The network ensures SPS-Config is configured for at most one cell in a cell group.\nSPS-Config information element\n-- ASN1START\n-- TAG-SPS-CONFIG-START\n\nSPS-Config ::=                          SEQUENCE {\n    periodicity                             ENUMERATED {ms10, ms20, ms32, ms40, ms64, ms80, ms128, ms160, ms320, ms640,\n                                                        spare6, spare5, spare4, spare3, spare2, spare1},\n    nrofHARQ-Processes                      INTEGER (1..8),\n    n1PUCCH-AN                              PUCCH-ResourceId                                                    OPTIONAL,   -- Need M\n    mcs-Table                               ENUMERATED {qam64LowSE}                                             OPTIONAL,   -- Need S\n    ...\n}\n\n-- TAG-SPS-CONFIG-STOP\n-- ASN1STOP\n\nSPS-Config field descriptions\nmcs-Table\tIndicates the MCS table the UE shall use for DL SPS (see TS 38.214 [19],clause 5.1.3.1. If present, the UE shall use the MCS table of low-SE 64QAM table indicated in Table 5.1.3.1-3 of TS 38.214 [19]. If this field is absent and field mcs-table in PDSCH-Config is set to 'qam256' and the activating DCI is of format 1_1, the UE applies the 256QAM table indicated in Table 5.1.3.1-2 of TS 38.214 [19]. Otherwise, the UE applies the non-low-SE 64QAM table indicated in Table 5.1.3.1-1 of TS 38.214 [19].\nn1PUCCH-AN\tHARQ resource for PUCCH for DL SPS. The network configures the resource either as format0 or format1. The actual PUCCH-Resource is configured in PUCCH-Config and referred to by its ID. See TS 38.213 [13], clause 9.2.3.\nnrofHARQ-Processes\tNumber of configured HARQ processes for SPS DL (see TS 38.321 [3], clause 5.8.1).\nperiodicity\tPeriodicity for DL SPS (see TS 38.214 [19] and TS 38.321 [3], clause 5.8.1).\n\n\u2013\tSRB-Identity\nThe IE SRB-Identity is used to identify a Signalling Radio Bearer (SRB) used by a UE.\n-- ASN1START\n-- TAG-SRB-IDENTITY-START\n\nSRB-Identity ::=                    INTEGER (1..3)\n\n-- TAG-SRB-IDENTITY-STOP\n-- ASN1STOP\n\n\n\u2013\tSRS-CarrierSwitching\nThe IE SRS-CarrierSwitching is used to configure for SRS carrier switching when PUSCH is not configured and independent SRS power control from that of PUSCH.\nSRS-CarrierSwitching information element\n-- ASN1START\n-- TAG-SRS-CARRIERSWITCHING-START\n\nSRS-CarrierSwitching ::=            SEQUENCE {\n    srs-SwitchFromServCellIndex         INTEGER (0..31)                                                         OPTIONAL,   -- Need M\n    srs-SwitchFromCarrier               ENUMERATED {sUL, nUL},\n    srs-TPC-PDCCH-Group                 CHOICE {\n        typeA                               SEQUENCE (SIZE (1..32)) OF SRS-TPC-PDCCH-Config,\n        typeB                               SRS-TPC-PDCCH-Config\n    }                                                                                                           OPTIONAL,   -- Need M\n    monitoringCells                     SEQUENCE (SIZE (1..maxNrofServingCells)) OF ServCellIndex               OPTIONAL,   -- Need M\n    ...\n}\n\nSRS-TPC-PDCCH-Config ::=            SEQUENCE {\n    srs-CC-SetIndexlist                 SEQUENCE (SIZE(1..4)) OF SRS-CC-SetIndex                                OPTIONAL    -- Need M\n}\n\nSRS-CC-SetIndex ::=                 SEQUENCE {\n    cc-SetIndex                         INTEGER (0..3)                                                          OPTIONAL,   -- Need M\n    cc-IndexInOneCC-Set                 INTEGER (0..7)                                                          OPTIONAL    -- Need M\n}\n\n-- TAG-SRS-CARRIERSWITCHING-STOP\n-- ASN1STOP\n\nSRS-CC-SetIndex field descriptions\ncc-IndexInOneCC-Set\tIndicates the CC index in one CC set for Type A (see TS 38.212 [17], TS 38.213 [13], clause 7.3.1, 11.3).\ncc-SetIndex\tIndicates the CC set index for Type A associated (see TS 38.212 [17], TS 38.213 [13], clause 7.3.1, 11.3).\n\nSRS-CarrierSwitching field descriptions\nmonitoringCells\tA set of serving cells for monitoring PDCCH conveying SRS DCI format with CRC scrambled by TPC-SRS-RNTI (see TS 38.212 [17], TS 38.213 [13], clause 7.3.1, 11.3).\nsrs-SwitchFromServCellIndex\tIndicates the serving cell whose UL transmission may be interrupted during SRS transmission on a PUSCH-less cell. During SRS transmission on a PUSCH-less cell, the UE may temporarily suspend the UL transmission on a serving cell with PUSCH in the same CG to allow the PUSCH-less cell to transmit SRS. (see TS 38.214 [19], clause 6.2.1.3).\nsrs-TPC-PDCCH-Group\tNetwork configures the UE with either typeA-SRS-TPC-PDCCH-Group or typeB-SRS-TPC-PDCCH-Group, if any.\ntypeA\tType A trigger configuration for SRS transmission on a PUSCH-less SCell (see TS 38.213 [13], clause 11.4).\ntypeB\tType B trigger configuration for SRS transmission on a PUSCH-less SCell (see TS 38.213 [13], clause 11.4).\n\nSRS-TPC-PDCCH-Config field descriptions\nsrs-CC-SetIndexlist\tA list of pairs of [cc-SetIndex; cc-IndexInOneCC-Set] (see TS 38.212 [17], TS 38.213 [13], clause 7.3.1, 11.3).\n\n\u2013\tSRS-Config\nThe IE SRS-Config is used to configure sounding reference signal transmissions. The configuration defines a list of SRS-Resources and a list of SRS-ResourceSets. Each resource set defines a set of SRS-Resources. The network triggers the transmission of the set of SRS-Resources using a configured aperiodicSRS-ResourceTrigger (L1 DCI).\nSRS-Config information element\n-- ASN1START\n-- TAG-SRS-CONFIG-START\n\nSRS-Config ::=                          SEQUENCE {\n    srs-ResourceSetToReleaseList            SEQUENCE (SIZE(1..maxNrofSRS-ResourceSets)) OF SRS-ResourceSetId    OPTIONAL,   -- Need N\n    srs-ResourceSetToAddModList             SEQUENCE (SIZE(1..maxNrofSRS-ResourceSets)) OF SRS-ResourceSet      OPTIONAL,   -- Need N\n    srs-ResourceToReleaseList               SEQUENCE (SIZE(1..maxNrofSRS-Resources)) OF SRS-ResourceId          OPTIONAL,   -- Need N\n    srs-ResourceToAddModList                SEQUENCE (SIZE(1..maxNrofSRS-Resources)) OF SRS-Resource            OPTIONAL,   -- Need N\n    tpc-Accumulation                        ENUMERATED {disabled}                                               OPTIONAL,   -- Need S\n    ...\n}\n\nSRS-ResourceSet ::=                     SEQUENCE {\n    srs-ResourceSetId                       SRS-ResourceSetId,\n    srs-ResourceIdList                      SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF SRS-ResourceId    OPTIONAL, -- Cond Setup\n\n    resourceType                            CHOICE {\n        aperiodic                               SEQUENCE {\n            aperiodicSRS-ResourceTrigger            INTEGER (1..maxNrofSRS-TriggerStates-1),\n            csi-RS                                  NZP-CSI-RS-ResourceId                               OPTIONAL, -- Cond NonCodebook\n            slotOffset                              INTEGER (1..32)                                     OPTIONAL, -- Need S\n            ...,\n            [[\n            aperiodicSRS-ResourceTriggerList-v1530      SEQUENCE (SIZE(1..maxNrofSRS-TriggerStates-2))\n                                                            OF INTEGER (1..maxNrofSRS-TriggerStates-1)  OPTIONAL  -- Need M\n            ]]\n        },\n        semi-persistent                         SEQUENCE {\n            associatedCSI-RS                        NZP-CSI-RS-ResourceId                               OPTIONAL, -- Cond NonCodebook\n            ...\n        },\n        periodic                                SEQUENCE {\n            associatedCSI-RS                        NZP-CSI-RS-ResourceId                               OPTIONAL, -- Cond NonCodebook\n            ...\n        }\n    },\n    usage                                   ENUMERATED {beamManagement, codebook, nonCodebook, antennaSwitching},\n    alpha                                   Alpha                                                       OPTIONAL, -- Need S\n    p0                                      INTEGER (-202..24)                                          OPTIONAL, -- Cond Setup\n    pathlossReferenceRS                     CHOICE {\n        ssb-Index                               SSB-Index,\n        csi-RS-Index                            NZP-CSI-RS-ResourceId\n    }                                                                                                   OPTIONAL, -- Need M\n    srs-PowerControlAdjustmentStates        ENUMERATED { sameAsFci2, separateClosedLoop}                OPTIONAL, -- Need S\n    ...\n}\n\nSRS-ResourceSetId ::=                   INTEGER (0..maxNrofSRS-ResourceSets-1)\n\nSRS-Resource ::=                        SEQUENCE {\n    srs-ResourceId                          SRS-ResourceId,\n    nrofSRS-Ports                           ENUMERATED {port1, ports2, ports4},\n    ptrs-PortIndex                          ENUMERATED {n0, n1 }                                       OPTIONAL,   -- Need R\n    transmissionComb                        CHOICE {\n        n2                                      SEQUENCE {\n            combOffset-n2                           INTEGER (0..1),\n            cyclicShift-n2                          INTEGER (0..7)\n        },\n        n4                                      SEQUENCE {\n            combOffset-n4                           INTEGER (0..3),\n            cyclicShift-n4                          INTEGER (0..11)\n        }\n    },\n    resourceMapping                         SEQUENCE {\n        startPosition                           INTEGER (0..5),\n        nrofSymbols                             ENUMERATED {n1, n2, n4},\n        repetitionFactor                        ENUMERATED {n1, n2, n4}\n    },\n    freqDomainPosition                      INTEGER (0..67),\n    freqDomainShift                         INTEGER (0..268),\n    freqHopping                             SEQUENCE {\n        c-SRS                                   INTEGER (0..63),\n        b-SRS                                   INTEGER (0..3),\n        b-hop                                   INTEGER (0..3)\n    },\n    groupOrSequenceHopping                  ENUMERATED { neither, groupHopping, sequenceHopping },\n    resourceType                            CHOICE {\n        aperiodic                               SEQUENCE {\n            ...\n        },\n        semi-persistent                         SEQUENCE {\n            periodicityAndOffset-sp                     SRS-PeriodicityAndOffset,\n            ...\n        },\n        periodic                                SEQUENCE {\n            periodicityAndOffset-p                      SRS-PeriodicityAndOffset,\n            ...\n        }\n    },\n    sequenceId                              INTEGER (0..1023),\n    spatialRelationInfo                     SRS-SpatialRelationInfo                                 OPTIONAL,   -- Need R\n    ...\n}\n\nSRS-SpatialRelationInfo ::=     SEQUENCE {\n    servingCellId                       ServCellIndex                                               OPTIONAL,   -- Need S\n    referenceSignal                     CHOICE {\n        ssb-Index                           SSB-Index,\n        csi-RS-Index                        NZP-CSI-RS-ResourceId,\n        srs                                 SEQUENCE {\n            resourceId                          SRS-ResourceId,\n            uplinkBWP                           BWP-Id\n        }\n    }\n}\n\n\nSRS-ResourceId ::=                      INTEGER (0..maxNrofSRS-Resources-1)\n\nSRS-PeriodicityAndOffset ::=            CHOICE {\n    sl1                                     NULL,\n    sl2                                     INTEGER(0..1),\n    sl4                                     INTEGER(0..3),\n    sl5                                     INTEGER(0..4),\n    sl8                                     INTEGER(0..7),\n    sl10                                    INTEGER(0..9),\n    sl16                                    INTEGER(0..15),\n    sl20                                    INTEGER(0..19),\n    sl32                                    INTEGER(0..31),\n    sl40                                    INTEGER(0..39),\n    sl64                                    INTEGER(0..63),\n    sl80                                    INTEGER(0..79),\n    sl160                                   INTEGER(0..159),\n    sl320                                   INTEGER(0..319),\n    sl640                                   INTEGER(0..639),\n    sl1280                                  INTEGER(0..1279),\n    sl2560                                  INTEGER(0..2559)\n}\n\n-- TAG-SRS-CONFIG-STOP\n-- ASN1STOP\n\nSRS-Config field descriptions\ntpc-Accumulation\tIf the field is absent, UE applies TPC commands via accumulation. If disabled, UE applies the TPC command without accumulation (this applies to SRS when a separate closed loop is configured for SRS) (see TS 38.213 [13], clause 7.3)\n\nSRS-Resource field descriptions\ncyclicShift-n2\tCyclic shift configuration (see TS 38.214 [19], clause 6.2.1).\ncyclicShift-n4\tCyclic shift configuration (see TS 38.214 [19], clause 6.2.1).\nfreqHopping\tIncludes parameters capturing SRS frequency hopping (see TS 38.214 [19], clause 6.2.1).\ngroupOrSequenceHopping\tParameter(s) for configuring group or sequence hopping (see TS 38.211 [16], clause  6.4.1.4.2).\nperiodicityAndOffset-p\tPeriodicity and slot offset for this SRS resource. All values are in \"number of slots\". Value sl1 corresponds to a periodicity of 1 slot, value sl2 corresponds to a periodicity of 2 slots, and so on. For each periodicity the corresponding offset is given in number of slots. For periodicity sl1 the offset is 0 slots (see TS 38.214 [19], clause 6.2.1).\nperiodicityAndOffset-sp\tPeriodicity and slot offset for this SRS resource. All values are in \"number of slots\". Value sl1 corresponds to a periodicity of 1 slot, value sl2 corresponds to a periodicity of 2 slots, and so on. For each periodicity the corresponding offset is given in number of slots. For periodicity sl1 the offset is 0 slots (see TS 38.214 [19], clause 6.2.1).\nptrs-PortIndex\tThe PTRS port index for this SRS resource for non-codebook based UL MIMO. This is only applicable when the corresponding PTRS-UplinkConfig is set to CP-OFDM. The ptrs-PortIndex configured here must be smaller than the maxNrofPorts configured in the PTRS-UplinkConfig (see TS 38.214 [19], clause 6.2.3.1).\nresourceMapping\tOFDM symbol location of the SRS resource within a slot including number of OFDM symbols (N = 1, 2 or 4 per SRS resource), startPosition (SRSSymbolStartPosition = 0..5; \"0\" refers to the last symbol, \"1\" refers to the second last symbol) and RepetitionFactor (r = 1, 2 or 4) (see TS 38.214 [19], clause 6.2.1 and TS 38.211 [16], clause 6.4.1.4). The configured SRS resource does not exceed the slot boundary.\nresourceType\tPeriodicity and offset for semi-persistent and periodic SRS resource (see TS 38.214 [19], clause 6.2.1).\nsequenceId\tSequence ID used to initialize pseudo random group and sequence hopping (see TS 38.214 [19], clause 6.2.1).\nspatialRelationInfo\tConfiguration of the spatial relation between a reference RS and the target SRS. Reference RS can be SSB/CSI-RS/SRS (see TS 38.214 [19], clause 6.2.1).\ntransmissionComb\tComb value (2 or 4) and comb offset (0..combValue-1) (see TS 38.214 [19], clause 6.2.1).\n\nSRS-ResourceSet field descriptions\nalpha\talpha value for SRS power control (see TS 38.213 [13], clause 7.3). When the field is absent the UE applies the value 1.\naperiodicSRS-ResourceTriggerList\tAn additional list of DCI \"code points\" upon which the UE shall transmit SRS according to this SRS resource set configuration (see TS 38.214 [19], clause 6.1.1.2).\naperiodicSRS-ResourceTrigger\tThe DCI \"code point\" upon which the UE shall transmit SRS according to this SRS resource set configuration (see TS 38.214 [19], clause 6.1.1.2).\nassociatedCSI-RS\tID of CSI-RS resource associated with this SRS resource set in non-codebook based operation (see TS 38.214 [19], clause 6.1.1.2).\ncsi-RS\tID of CSI-RS resource associated with this SRS resource set. (see TS 38.214 [19], clause 6.1.1.2).\np0\tP0 value for SRS power control. The value is in dBm. Only even values (step size 2) are allowed (see TS 38.213 [13], clause 7.3).\npathlossReferenceRS\tA reference signal (e.g. a CSI-RS config or a SS block) to be used for SRS path loss estimation (see TS 38.213 [13], clause 7.3).\nresourceType\tTime domain behavior of SRS resource configuration, see TS 38.214 [19], clause 6.2"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nUpdate of the specifications on usage of Need codes in conditions as per agreements in R2-105bis.Usage of Need codes is currently ambigous in a number of places, especially in conditions.Error handling on missing mandatorily present fields in conditions in DCCH, CCCH messages is incorrect and not aligned with the agreement in R2-105bis.Usage of \u201cField is always configured by the network\u2026\u201d in the field description when the fields is not necessarily present in the condition (due to use of Need M) is confusing.\n\n>>> SUMMARY OF CHANGE\nUsage of text \u201cNetwork always configures the UE with a value for this field\u201d clarified with a NOTE.Rules and guidance for usage of Need node in conditions for \u201cabsent\u201d introduced.Network restrictions imposed in several cases where there was an ambiguity in UE behaviour during reconfigurations (CSI-AperiodicTriggerStateList, NZP-CSI-RS-Resource, PUCCH/PUCCHless Scell reconfiguration, codebook and non-codebook tx reconfiguration).Failure handling in UE for missing conditional mandatory fields changed to make the UE behaviour unspecified.\n\n>>> CONSEQUENCES IF NOT REVISED\nAmbigous specifications can lead to inter-operability issues.Impact analysis:Impacted architecture: EN-DC, SAImpacted functionality: CSI-AperiodicTriggerStateList, NZP-CSI-RS-Resource, tpc-PUCCH, PUCCH/PUCCHless Scell reconfiguration, codebook and non-codebook tx reconfiguration.                           If network is not implemented accordint to this CR and UE is, network may provide reconfigurations that are not supported resulting in failure of reconfiguration and possibility re-establishment.If UE is not implemented according to this CR and network is, there is no inter-operability issue."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of change\n8.1\tNumbering, Naming and Addressing for SIP message\nThe following URI formats in SIP messages may be applied at the Ici as standardized in 3GPP\u00a0TS\u00a024.229\u00a0[5]:\n-\tSIP URI defined in IETF\u00a0RFC\u00a03261\u00a0[13];\n-\ttel URI defined in IETF\u00a0RFC\u00a03966\u00a0[14];\n-\tIM URI defined in IETF\u00a0RFC\u00a03860\u00a0[15]; and\n-\tPRES URI defined in IETF\u00a0 RFC\u00a03859\u00a0[16].\nAccording to 3GPP\u00a0TS\u00a024.229\u00a0[5], the IBCF acting as an exit or entry point in the IMS network supports these URI formats. These URI formats shall be supported at the roaming II-NNI. The SIP URI format shall be supported at the non-roaming II-NNI. For the loopback traversal scenario both the SIP URI and the tel URI shall be supported. The tel URI, IM URI and PRES URI formats may be supported at the non-roaming II-NNI based on agreement between operators. For the loopback traversal scenario the IM URI and PRES URI may be supported based on agreement between operators. Other URI formats may be supported over the II-NNI depending on the operator agreements.\nA global number as defined in IETF\u00a0RFC\u00a03966\u00a0[14] shall be used in a tel URI or in the user portion of a SIP URI with the user=phone parameter when conveyed via a non-roaming II-NNI or for the loopback traversal scenario in the Request-URI and in the P-Asserted-Identity header field, except when agreement exists between the operators to also allow other kinds of numbers.\nNOTE\u00a01:\tIn a SIP URI the user portion of the Request-URI represents a telephone number only if the SIP URI includes the user=phone parameter.\nNOTE\u00a02:\tAgreements can exist between operators to allow non-global number (e.g. national service numbers. business trunking numbers, or private numbers) at a non-roaming II-NNI or for the loopback traversal scenario. A SIP URI with such a number, a user=phone parameter, and a phone-context parameter agreed between the operators can then be used.\nNOTE\u00a03:\t3GPP\u00a0TS\u00a024.229\u00a0[5] allows to restrict the number within a SIP Request-URI with user=phone parameter at a non-roaming II-NNI or for the loopback traversal scenario to be a global number (i.e. E.164 in international format) via an appropriate Application Server. Suitable configuration by the operator is needed to achieve the desired modification of the format.\nNOTE\u00a04:\tThe allowed phone number formats in the P-Asserted-Identity header field of a served user are configured by the operator. According to 3GPP\u00a0TS\u00a023.003\u00a0[35], international E.164 format is used within a P-Asserted-Identity header field.\nNOTE\u00a05:\tThe global number format usage within a SIP Request-URI with the user=phone parameter at a non-roaming II-NNI or for the loopback traversal scenario allows the terminating network to find the called subscriber, via HSS interrogation, without any further number translation and thus improves the success of the interconnection between IMS operators.\n\nThe optional \"oli\" and \"cpc\" tel URI parameters associated with a tel URI or a SIP URI with user=phone are described in 3GPP\u00a0TS\u00a024.229\u00a0[5] clause\u00a07.2A.12 and can be part of the P-Asserted-Identity header field. Depending on operator agreements, those URI parameters may be supported at the non-roaming II-NNI or for the loopback traversal scenario.\nThe \"sos\" SIP URI parameter associated with a URI in the Contact header field of a REGISTER request or a 200 (OK) response to REGISTER request is described in 3GPP\u00a0TS\u00a024.229\u00a0[5]. The \"sos\" SIP URI parameter shall be supported at the roaming II-NNI.\nThe \"sos\" SIP URI parameter associated with the Request-URI for all dialogs and standalone SIP requests described in clause\u00a05.2.10.3 of 3GPP\u00a0TS\u00a024.229\u00a0[5] and shall be supported at the roaming II-NNI.\nThe \"rn\" and \"npdi\" number portability parameters for the tel URI and the SIP URI with user=phone as described within IETF\u00a0RFC\u00a04694\u00a0[75] can be part of the Request-URI. Depending on operator agreements these parameters may be exchanged over the non-roaming II-NNI or for the loopback traversal scenario.\nNOTE\u00a06:\tThe \"rn\" and \"npdi\" parameters can be used to address the entry point of the terminating operator depending on national rules for number portability.\nThe \"isub\" tel URI parameter for the tel URI and the SIP URI with user=phone as described within IETF\u00a0RFC\u00a03966\u00a0[14] can be part of the Request-URI, To header field and P-Asserted-Identity header field. Depending on operator agreements, this URI parameter may be exchanged over the II-NNI.\nThe \"premium-rate\" tel URI parameter for the tel URI and the SIP URI with user=phone as described within 3GPP\u00a0TS\u00a024.229\u00a0[5] clause\u00a07.2A.17 can be part of the Request-URI. Depending on operator agreements, this URI parameter may be exchanged at the roaming II-NNI.\nEnd of change\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to 3GPP TS 23.002/TS 24.229, Public User Identity shall take the form of either a SIP URI or a Tel URI in the IM subsystem.However, the current TS 29.165 does not have the descriptions about this requirement.To avoid misunderstanding (e.g., use of SIPS URI format), it should be clarified that either SIP URI or tel URI is used for the public user identity at the II-NNI.\n\n>>> SUMMARY OF CHANGE\nAdded the following normal note into the subclause\u00a08.1:NOTE\u00a06:According to 3GPP\u00a0TS\u00a023.002\u00a0[35] and 3GPP\u00a0TS\u00a024.229\u00a0[5], public user identity takes the form of either SIP URI or tel URI.\n\n>>> CONSEQUENCES IF NOT REVISED\nIf an originating IMS network sends SIP request containing the Request-URI set to SIPS URI towards a terminating IMS network, then the terminating IMS network will send back 416 (Unsupported URI Scheme) as described in IETF\u00a0RFC\u00a03261. After that, a SIP functional entitiy on the originating side will retry the SIP request using SIP URI, which will cause the increase of delay for session establishment."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n* * * * Start of Change * * * *\n5.8.2.5\tControl of User Plane Forwarding\nThe SMF controls user-plane packet forwarding for traffic detected by a PDR by providing a FAR with instructions to the UPF, including:\n-\tForwarding operation information;\n-\tForwarding target information.\nThe details of the forwarding target and operation will depend on the scenario and is described below. The following forwarding functionality is required by the UPF:\n-\tApply N3 /N9 tunnel related handling, i.e. encapsulation.\n-\tForward the traffic to/from the SMF, e.g. as described in Table 5.8.2.5-1.\n-\tForward the SM PDU DN Request Container from SMF to DN-AAA server\n-\tForward the traffic according to locally configured policy for traffic steering.\nData forwarding between the SMF and UPF is transmitted on the user plane tunnel established on N4 interface, defined in TS\u00a029.244\u00a0[65].\nScenarios for data forwarding between the SMF and UPF are defined as below:\nTable 5.8.2.5-1: Scenarios for data forwarding between the SMF and UPF\n\tScenario description\tData forwarding direction\n1\tForwarding of user-plane packets between the UE and the SMF e.g. DHCP signalling.\tUPF to SMF\tSMF to UPF\n2\tForwarding of packets between the SMF and the external DN e.g. with DN-AAA server\tUPF to SMF\tSMF to UPF\n3\tForwarding of packets subject to buffering in the SMF.\tUPF to SMF\tSMF to UPF\n4\tForwarding of End Marker Packets constructed by the SMF to a downstream node.\tSMF to UPF\n5\tForwarding of user data using Control Plane CIoT 5GS Optimisation\tUPF to SMF\tSMF to UPF\n\nWhen configuring an UPF acting as PSA for an Ethernet PDU Session Type, the SMF may instruct the UPF to route the DL traffic based on the MAC address(es) used by the UE for the UL traffic.\nIn that case:\n-\tbroadcast and/or multicast DL traffic on the N6 Network Instance targets every DL PDU Session (corresponding to any N4 Session) associated with this Network Instance.\n-\tfor uplink broadcast and/or multicast traffic received by the UPF over a PDU session on a N3/N9 interface, the UPF should forward the traffic to the N6 interface and downlink to every PDU session (except the one of the incoming traffic) associated with the same N6 Network Instance.\n\n\n\nFor ARP/IPv6 Neighbour Solicitation traffic, a SMF's request to respond to ARP/IPv6 Neighbour Solicitation based on local cache information or to redirect such traffic from the UPF to the SMF overrules the traffic forwarding rules described above.\nNOTE:\tLocal policies in UPF associated with the Network Instance can prevent local traffic switching in the UPF between PDU Sessions either for unicast traffic only or for any traffic. In the case where UPF policies prevent local traffic switching for any traffic (thus for broadcast/multicast traffic) some mechanism such as responding to ARP/ND based on local cache information or local multicast group handling is needed to ensure that upper layer protocol can run on the Ethernet PDU sessions.\nIf allowed by local UPF (acting as PSA) policies, for Ethernet traffic with unknown unicast destination MAC addresses, the UPF should forward the traffic in the same manner as described above for the broadcast and/or multicast traffic handling.\nThe SMF may ask to get notified with the source MAC addresses used by the UE and provide UPF with corresponding forwarding rules related with these MAC addresses.\n\n* * * * End of Change * * * *\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFrames with source address equal to the address used in the uplink imply a loop; such frames do not exist when the network is at steady state, but may exist at network topology changes. See discussion in S2-1903367.\n\n>>> SUMMARY OF CHANGE\nThe SMF should ensure that downlink traffic that has the same source MAC address as the MAC address used by a UE for the UL traffic on the same PDU Session is dropped.\n\n>>> CONSEQUENCES IF NOT REVISED\nEthernet forwarding loops may occur at network topology changes, which risk the stability of the whole network"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** BEGIN MODIFICATION *****\n\n5.2.2.1\tGeneral\nThe P-CSCF shall be prepared to receive the unprotected REGISTER requests on the SIP default port values as specified in RFC\u00a03261\u00a0[26]. The P-CSCF shall also be prepared to receive the unprotected REGISTER requests on the port advertised to the UE during the P-CSCF discovery procedure.\nNOTE\u00a01:\tThe P-CSCF will only accept further registration and subsequent SIP messages on the same ports for security mechanisms that do not require to use negotiated ports for exchanging protected messages.\nThe P-CSCF shall distinguish between security mechanisms through the use of the Security-Client header field and Authorization header field as follows:\n1)\tif a REGISTER request from the UE contains a Security-Client header field then for an initial registration, the P-CSCF shall select the sec-mechanism and mode (as described in Annex\u00a0H of 3GPP\u00a0TS\u00a033.203\u00a0[19]) from the corresponding parameters offered in the Security-Client header field according to its priorities, as follows:\n-\tif the P-CSCF selects the sec-mechanism \"ipsec- 3gpp\" then follow the procedures as described in subclause\u00a05.2.2.2, in addition to the procedures described in this subclause;\n-\tif the P-CSCF selects the sec-mechanism \"tls\" then follow the procedures as described in subclause\u00a05.2.2.4, in addition to the procedures described in this subclause.\n2)\tif a REGISTER request from the UE does not contain a Security-Client header field, or the P-CSCF does not select any sec-mechanism from the Security-Client header field, then the P-CSCF shall behave as follows, in addition to the procedures described in the remainder of this subclause:\n-\tif the REGISTER request does not contain an Authorization header field and was received over an access network defined in 3GPP specifications then follow the GPRS-IMS-Bundled authentication  procedures as described in subclause\u00a05.2.2.6; or\n-\tif the REGISTER request does not contain an Authorization header field and was received over a TISPAN NASS then follow the NASS-IMS bundled authentication procedures described in subclause\u00a05.2.2.5. If the NASS-IMS bundled authentcation related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall not continue and shall return an error message to the UE; or\nEditor's Note:\tIt is FFS which error message is sent to the UE in the case of a failed query from the P-CSCF to the TISPAN NASS.\n-\tif the REGISTER request contains an Authorization header field and was not received over a TISPAN NASS then follow the SIP digest without TLS procedures as described in subclause\u00a05.2.2.3; or\n-\tif the REGISTER request contains an Authorization header field and was received over a TISPAN NASS, and the P-CSCF supports both SIP digest and NASS-IMS bundled authentication, then the P-CSCF shall perform the steps required for NASS-IMS bundled authentication, in subclause\u00a05.2.2.5, as well as the steps required for SIP digest without TLS, in subclause\u00a05.2.2.3, unless it is configured to behave differently. If the NASS-IMS bundled authentication related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall only continue with the SIP digest related steps.\nFor subsequent registrations, the P-CSCF shall continue to use the selected mechanism.\nNOTE\u00a02:\tThe steps required for SIP digest and for NASS-IMS bundled authentcation are not in contradiction. Rather, for NASS-IMS bundled authentication the P-CSCF needs to perform additional steps, namely an exchange with the TISPAN NASS and an inclusion of NASS location information in the REGISTER request, on top of the steps required for SIP digest.\nNOTE\u00a03:\tHow the P-CSCF knows the access network type of a specific network interface is implementation-dependent (e.g. it can know the access network type from different UE IP address ranges or by using different network interfaces for different access network types).\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall:\n1)\tinsert a Path header field in the request including an entry containing: \n-\tthe SIP URI identifying the P-CSCF;\n-\tan indication that requests routed in this direction of the path (i.e. from the S-CSCF towards the P-CSCF) are expected to be treated as for the UE-terminating case. This indication may e.g. be in a parameter in the URI, a character string in the user part of the URI, or be a port number in the URI;\n-\tan IMS flow token in the user portion of the SIP URI that the P-CSCF inserts into the Path header field, and the \"ob\" SIP URI parameter according to RFC\u00a05626\u00a0[92]. The same IMS flow token and hostport parameter shall be used by the P-CSCF in the SIP URI of the Path header field when a registration flow is initially created and later refreshed;\nNOTE\u00a04:\tBy inserting the \"ob\" SIP URI parameter in its SIP URI, the P-CSCF indicates that it supports multiple registrations as specified in RFC\u00a05626\u00a0[92]. The presence of the \"ob\" SIP URI parameter is not an indication that the P-CSCF supports the keep-alive mechanism defined in RFC\u00a05626\u00a0[92].\n\n2)\tinsert a Require header field containing the option-tag \"path\";\n3)\tinsert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP\u00a0TS\u00a032.260\u00a0[17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n4)\tinsert a P-Visited-Network-ID header field, with the value of a pre-provisioned string that identifies the visited network at the home network;\n4A)\tvoid;\n4B)\tif the REGISTER request contains an Authorization header field, remove the \"integrity-protected\" header field parameter, if present;\n5)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, forward the request to an IBCF in the visited network.\n\tIf the selected exit point:\n-\tdoes not respond to the REGISTER request and its retransmissions by the P-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\n\tthe P-CSCF shall select a new exit point and forward the original REGISTER request.\nNOTE\u00a05:\tThe list of the exit points can be either obtained as specified in RFC\u00a03263\u00a0[27A] or provisioned in the P-CSCF.\n\tIf the P-CSCF fails to forward the REGISTER request to any exit point, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC\u00a03261\u00a0[26] unless local policy allows omitting the exit point;\nNOTE\u00a06:\tIf the P-CSCF forwards the request to an IBCF in the visited network, the IBCF can determine the entry point of the home network, using the same mechanisms as described in NOTE\u00a01 above.\n6)\tif the P-CSCF is located in the visited network and local policy does not require the application of IBCF capabilities in the visited network towards the home network, determine the entry point of the home network and forward the request to that entry point.\n\tIf the selected entry point:\n-\tdoes not respond to the REGISTER request and its retransmissions by the P-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\n\tthe P-CSCF shall select a new entry point and forward the original REGISTER request. \nNOTE\u00a07:\tThe list of the entry points can be either obtained as specified in RFC\u00a03263\u00a0[27A] or provisioned in the P-CSCF.\n\tIf the P-CSCF fails to forward the REGISTER request to any entry point, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC\u00a03261\u00a0[26];\n7)\tif the P-CSCF is located in the home network, determine the I-CSCF of the home network and forward the request to that I-CSCF.\n\tIf the selected I-CSCF:\n-\tdoes not respond to the REGISTER request and its retransmissions by the P-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\n\tthe P-CSCF shall select a new I-CSCF and forward the original REGISTER request; and\nNOTE\u00a08:\tThe list of the I-CSCFs can be either obtained as specified in RFC\u00a03263\u00a0[27A] or provisioned in the P-CSCF.\n\tIf the P-CSCF fails to forward the REGISTER request to any I-CSCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC\u00a03261\u00a0[26].\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request, the P-CSCF shall check the value of the registration expiration interval value. When the registration expiration interval value is different than zero, then the P-CSCF shall:\n1)\tsave the list of service route values in the Service-Route header fields preserving the order, and bind the list to the contact address and the associated security association or TLS session over which the REGISTER request was received. The P-CSCF shall store this list during the entire registration period of the respective public user identity with this associated contact address. The P-CSCF shall use this list to validate the routeing information in the requests originated by the UE and received over the respective security association or a TLS session. If the list of Service-Route headers already exists for this contact address, the P-CSCF shall replace the already existing list of service route values with the received list of Service-Route headers;\nNOTE\u00a09:\tWhen the UE registers multiple contact addresses, then the UE and the P-CSCF will have a list of Service-Route headers for each contact address and the associated security association or TLS session. When sending a request using a given the associated security association or TLS session and associated contact address the UE will use the corresponding list of Service-Route headers, when building a list of Route headers.\n2)\tassociate the list of service route values with the registered public user identity and the associated contact address the associated security association or TLS session;\n3)\tstore the public user identities and wildcarded public user identities, found in the P-Associated-URI header field value, including any associated display names, and any parameters associated with either the user or the identities of the user, and associate them to the registered public user identity, i.e. the registered public user identity and its associated set of implicitly registered public user identities and implicitly registered wildcarded public user identities are bound to the contact address and security association or TLS session over which the REGISTER request was received;\n4)\tstore the default public user identity, including its associated display name, if provided, for use with procedures for the P-Asserted-Identity header field for requests received from the UE over the respective security association or TLS session. The default public user identity is the first on the list of URIs present in the P-Associated-URI header field;\nNOTE\u00a010:\tThere can be more than one default public user identity stored in the P-CSCF, as the result of the multiple registrations of public user identities.\nNOTE\u00a011:\tFor each contact address and the associated security association or TLS session the P-CSCF will maintain a list of registered public user identities and the associated default public user identities, that it will use when populating the P-Asserted Identity header.\n5)\tstore the values received in the P-Charging-Function-Addresses header field;\n6) \tif a \"term-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"term-ioi\" header field parameter;\nNOTE\u00a012:\tAny received \"term-ioi\" header field parameter will contain a type 1 IOI. The type 1 IOI identifies the home network of the registered user.\n7)\tif the P-CSCF included an IMS flow token and the \"ob\" SIP URI parameter in the Path header field of the REGISTER request, check for presence of  the option-tag \"outbound\" in the Require header field of the a 200 (OK) response:\n-\tif the option-tag \"outbound\" is present, it indicates that the UE has successfully registered its public user identity with a new bidirectional flow as defined in RFC\u00a05626\u00a0[92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in RFC\u00a05626\u00a0[92]; or\n-\tif the option-tag \"outbound\" is not present, it indicates that the public user identity has not been registered as specified in RFC\u00a05626\u00a0[92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in RFC\u00a03261\u00a0[26]; and\n8)\tif the P-CSCF detects that the UE is behind a NAT, and the UE's Via header field contains a \"keep\" header field parameter, the P-CSCF shall add a value to the parameter, to indicate that it is willing to receive keep-alives associated with the registration from the UE, as defined in draft-ietf-sipcore-keep\u00a0[143].\nIf the P-CSCF detects that the UE is behind a NAT, and the request was received over a TCP connection, the P-CSCF shall not close the TCP connection during the duration of the registration.\nNOTE\u00a013:\tThe P-CSCF can conclude whether the UE is behind a NAT or not by comparing the values in the \"received\" header field parameter and \"rport\" header field parameter with the corresponding values in the sent-by parameter in the topmost Via header field. If the values do not match, the P-CSCF can conclude that the UE is not behind a NAT.\n***** END MODIFICATION *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe specification currently says that, when a P-CSCF receives a REGISTER request, it shall use the same IMS flow token and hostport value in the SIP URI of its Path header field. However, the whole SIP URI (including the whole user portion and the SIP URI parameters) it shall also use the same.The same SIP URI shall also be used for registration fetches and the de-registration associated with the registration.It is currently not indicated that a P-CSCF needs to use a unique SIP URI for each registration (or registration flow).Annex K contains a note, that clarifies that the form of the IMS flow token is of local significance to the P-CSCF only. The same clarification does not exist in the main specification.\n\n>>> SUMMARY OF CHANGE\nThe next is modified, so that it is indicated that the P-CSCF uses the same SIP URI, and not only specific parts of the SIP URI, in its Path header field.A note is added, which clarifies that a different SIP URI is used for each registration (or registration flow). It is also indicated that the form of the IMS flow token is of local significance to the P-CSCF only.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe P-CSCF might not generate a correct SIP URI in its Path header fields, which could cause error S-CSCF registration procedure behavior.The P-CSCF might re-use the SIP URI for multiple registrations (or registraion flows), which could cause error S-CSCF registration procedures behavior."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n\n\u2013\tMIMO-ParametersPerBand\nThe IE MIMO-ParametersPerBand is used to convey MIMO related parameters specific for a certain band (not per feature set or band combination).\nMIMO-ParametersPerBand information element\n-- ASN1START\n-- TAG-MIMO-PARAMETERSPERBAND-START\n\nMIMO-ParametersPerBand ::=          SEQUENCE {\n    tci-StatePDSCH                      SEQUENCE {\n        maxNumberConfiguredTCIstatesPerCC   ENUMERATED {n4, n8, n16, n32, n64, n128}                                   OPTIONAL,\n        maxNumberActiveTCI-PerBWP           ENUMERATED {n1, n2, n4, n8}                                                OPTIONAL\n    }                                                                                                              OPTIONAL,\n    additionalActiveTCI-StatePDCCH              ENUMERATED {supported}                                             OPTIONAL,\n    pusch-TransCoherence                        ENUMERATED {nonCoherent, partialCoherent, fullCoherent}            OPTIONAL,\n    beamCorrespondenceWithoutUL-BeamSweeping    ENUMERATED {supported}                                             OPTIONAL,\n    periodicBeamReport                          ENUMERATED {supported}                                             OPTIONAL,\n    aperiodicBeamReport                         ENUMERATED {supported}                                             OPTIONAL,\n    sp-BeamReportPUCCH                          ENUMERATED {supported}                                             OPTIONAL,\n    sp-BeamReportPUSCH                          ENUMERATED {supported}                                             OPTIONAL,\n    dummy1                                      DummyG                                                             OPTIONAL,\n    maxNumberRxBeam                             INTEGER (2..8)                                                     OPTIONAL,\n    maxNumberRxTxBeamSwitchDL                   SEQUENCE {\n        scs-15kHz                                   ENUMERATED {n4, n7, n14}                                           OPTIONAL,\n        scs-30kHz                                   ENUMERATED {n4, n7, n14}                                           OPTIONAL,\n        scs-60kHz                                   ENUMERATED {n4, n7, n14}                                           OPTIONAL,\n        scs-120kHz                                  ENUMERATED {n4, n7, n14}                                           OPTIONAL,\n        scs-240kHz                                  ENUMERATED {n4, n7, n14}                                           OPTIONAL\n    }                                                                                                              OPTIONAL,\n    maxNumberNonGroupBeamReporting              ENUMERATED {n1, n2, n4}                                            OPTIONAL,\n    groupBeamReporting                          ENUMERATED {supported}                                             OPTIONAL,\n    uplinkBeamManagement                        SEQUENCE {\n        maxNumberSRS-ResourcePerSet-BM              ENUMERATED {n2, n4, n8, n16},\n        maxNumberSRS-ResourceSet                    INTEGER (1..8)\n    }                                                                                                              OPTIONAL,\n    maxNumberCSI-RS-BFD                 INTEGER (1..64)                                                            OPTIONAL,\n    maxNumberSSB-BFD                    INTEGER (1..64)                                                            OPTIONAL,\n    maxNumberCSI-RS-SSB-CBD             INTEGER (1..256)                                                           OPTIONAL,\n    dummy2                              ENUMERATED {supported}                                                     OPTIONAL,\n    twoPortsPTRS-UL                     ENUMERATED {supported}                                                     OPTIONAL,\n    dummy5                              SRS-Resources                                                              OPTIONAL,\n    dummy3                              INTEGER (1..4)                                                             OPTIONAL,\n    beamReportTiming                    SEQUENCE {\n        scs-15kHz                           ENUMERATED {sym2, sym4, sym8}                                              OPTIONAL,\n        scs-30kHz                           ENUMERATED {sym4, sym8, sym14, sym28}                                      OPTIONAL,\n        scs-60kHz                           ENUMERATED {sym8, sym14, sym28}                                            OPTIONAL,\n        scs-120kHz                          ENUMERATED {sym14, sym28, sym56}                                           OPTIONAL\n    }                                                                                                              OPTIONAL,\n    ptrs-DensityRecommendationSetDL     SEQUENCE {\n        scs-15kHz                           PTRS-DensityRecommendationDL                                               OPTIONAL,\n        scs-30kHz                           PTRS-DensityRecommendationDL                                               OPTIONAL,\n        scs-60kHz                           PTRS-DensityRecommendationDL                                               OPTIONAL,\n        scs-120kHz                          PTRS-DensityRecommendationDL                                               OPTIONAL\n    }                                                                                                              OPTIONAL,\n    ptrs-DensityRecommendationSetUL     SEQUENCE {\n        scs-15kHz                           PTRS-DensityRecommendationUL                                               OPTIONAL,\n        scs-30kHz                           PTRS-DensityRecommendationUL                                               OPTIONAL,\n        scs-60kHz                           PTRS-DensityRecommendationUL                                               OPTIONAL,\n        scs-120kHz                          PTRS-DensityRecommendationUL                                               OPTIONAL\n    }                                                                                                              OPTIONAL,\n    dummy4                              DummyH                                                                     OPTIONAL,\n    aperiodicTRS                        ENUMERATED {supported}                                                     OPTIONAL,\n    ...,\n    [[\n    dummy6                              ENUMERATED {true}                                                          OPTIONAL,\n    beamManagementSSB-CSI-RS            BeamManagementSSB-CSI-RS                                                   OPTIONAL,\n    beamSwitchTiming                    SEQUENCE {\n        scs-60kHz                           ENUMERATED {sym14, sym28, sym48, sym224, sym336}                           OPTIONAL,\n        scs-120kHz                          ENUMERATED {sym14, sym28, sym48, sym224, sym336}                           OPTIONAL\n    }                                                                                                              OPTIONAL,\n    codebookParameters                  CodebookParameters                                                         OPTIONAL,\n    csi-RS-IM-ReceptionForFeedback      CSI-RS-IM-ReceptionForFeedback                                             OPTIONAL,\n    csi-RS-ProcFrameworkForSRS          CSI-RS-ProcFrameworkForSRS                                                 OPTIONAL,\n    csi-ReportFramework                 CSI-ReportFramework                                                        OPTIONAL,\n    csi-RS-ForTracking                  CSI-RS-ForTracking                                                         OPTIONAL,\n    srs-AssocCSI-RS                     SEQUENCE (SIZE (1.. maxNrofCSI-RS-Resources)) OF SupportedCSI-RS-Resource  OPTIONAL,\n    spatialRelations                    SpatialRelations                                                           OPTIONAL\n    ]]\n}\n\nDummyG ::=                          SEQUENCE {\n    maxNumberSSB-CSI-RS-ResourceOneTx   ENUMERATED {n8, n16, n32, n64},\n    maxNumberSSB-CSI-RS-ResourceTwoTx   ENUMERATED {n0, n4, n8, n16, n32, n64},\n    supportedCSI-RS-Density             ENUMERATED {one, three, oneAndThree}\n}\n\nBeamManagementSSB-CSI-RS ::=        SEQUENCE {\n    maxNumberSSB-CSI-RS-ResourceOneTx   ENUMERATED {n0, n8, n16, n32, n64},\n    maxNumberCSI-RS-Resource            ENUMERATED {n0, n4, n8, n16, n32, n64},\n    maxNumberCSI-RS-ResourceTwoTx       ENUMERATED {n0, n4, n8, n16, n32, n64},\n    supportedCSI-RS-Density             ENUMERATED {one, three, oneAndThree}                                       OPTIONAL,\n    maxNumberAperiodicCSI-RS-Resource   ENUMERATED {n0, n1, n4, n8, n16, n32, n64}\n}\n\nDummyH ::=                          SEQUENCE {\n    burstLength                         INTEGER (1..2),\n    maxSimultaneousResourceSetsPerCC    INTEGER (1..8),\n    maxConfiguredResourceSetsPerCC      INTEGER (1..64),\n    maxConfiguredResourceSetsAllCC      INTEGER (1..128)\n}\n\nCSI-RS-ForTracking ::=              SEQUENCE {\n    maxBurstLength                      INTEGER (1..2),\n    maxSimultaneousResourceSetsPerCC    INTEGER (1..8),\n    maxConfiguredResourceSetsPerCC      INTEGER (1..64),\n    maxConfiguredResourceSetsAllCC      INTEGER (1..256)\n}\n\nCSI-RS-IM-ReceptionForFeedback ::=              SEQUENCE {\n    maxConfigNumberNZP-CSI-RS-PerCC                 INTEGER (1..64),\n    maxConfigNumberPortsAcrossNZP-CSI-RS-PerCC      INTEGER (2..256),\n    maxConfigNumberCSI-IM-PerCC                     ENUMERATED {n1, n2, n4, n8, n16, n32},\n    maxNumberSimultaneousNZP-CSI-RS-PerCC           INTEGER (1..64),\n    totalNumberPortsSimultaneousNZP-CSI-RS-PerCC    INTEGER (2..256)\n}\n\nCSI-RS-ProcFrameworkForSRS ::=                  SEQUENCE {\n    maxNumberPeriodicSRS-AssocCSI-RS-PerBWP         INTEGER (1..4),\n    maxNumberAperiodicSRS-AssocCSI-RS-PerBWP        INTEGER (1..4),\n    maxNumberSP-SRS-AssocCSI-RS-PerBWP              INTEGER (0..4),\n    simultaneousSRS-AssocCSI-RS-PerCC               INTEGER (1..8)\n}\n\nCSI-ReportFramework ::=                         SEQUENCE {\n    maxNumberPeriodicCSI-PerBWP-ForCSI-Report       INTEGER (1..4),\n    maxNumberAperiodicCSI-PerBWP-ForCSI-Report      INTEGER (1..4),\n    maxNumberSemiPersistentCSI-PerBWP-ForCSI-Report INTEGER (0..4),\n    maxNumberPeriodicCSI-PerBWP-ForBeamReport       INTEGER (1..4),\n    maxNumberAperiodicCSI-PerBWP-ForBeamReport      INTEGER (1..4),\n    maxNumberAperiodicCSI-triggeringStatePerCC      ENUMERATED {n3, n7, n15, n31, n63, n128},\n    maxNumberSemiPersistentCSI-PerBWP-ForBeamReport INTEGER (0..4),\n    simultaneousCSI-ReportsPerCC                    INTEGER (1..8)\n}\n\nPTRS-DensityRecommendationDL ::=    SEQUENCE {\n    frequencyDensity1                   INTEGER (1..276),\n    frequencyDensity2                   INTEGER (1..276),\n    timeDensity1                        INTEGER (0..29),\n    timeDensity2                        INTEGER (0..29),\n    timeDensity3                        INTEGER (0..29)\n}\n\nPTRS-DensityRecommendationUL ::=    SEQUENCE {\n    frequencyDensity1                   INTEGER (1..276),\n    frequencyDensity2                   INTEGER (1..276),\n    timeDensity1                        INTEGER (0..29),\n    timeDensity2                        INTEGER (0..29),\n    timeDensity3                        INTEGER (0..29),\n    sampleDensity1                      INTEGER (1..276),\n    sampleDensity2                      INTEGER (1..276),\n    sampleDensity3                      INTEGER (1..276),\n    sampleDensity4                      INTEGER (1..276),\n    sampleDensity5                      INTEGER (1..276)\n}\n\nSpatialRelations ::=                    SEQUENCE {\n    maxNumberConfiguredSpatialRelations     ENUMERATED {n4, n8, n16, n32, n64, n96},\n    maxNumberActiveSpatialRelations         ENUMERATED {n1, n2, n4, n8, n14},\n    additionalActiveSpatialRelationPUCCH    ENUMERATED {supported}                              OPTIONAL,\n    maxNumberDL-RS-QCL-TypeD                ENUMERATED {n1, n2, n4, n8, n14}\n}\n\nDummyI ::=               SEQUENCE {\n    supportedSRS-TxPortSwitch           ENUMERATED {t1r2, t1r4, t2r4, t1r4-t2r4, tr-equal},\n    txSwitchImpactToRx                  ENUMERATED {true}                                       OPTIONAL\n}\n\n-- TAG-MIMO-PARAMETERSPERBAND-STOP\n-- ASN1STOP\n\nMIMO-ParametersPerBand field description\ncsi-RS-IM-ReceptionForFeedback/ csi-RS-ProcFrameworkForSRS/ csi-ReportFramework\n\n<<< UNMOIFIED SECTIONS OMITTED >>>\n\u2013\tPhy-Parameters\nThe IE Phy-Parameters is used to convey the physical layer capabilities.\nPhy-Parameters information element\n-- ASN1START\n-- TAG-PHY-PARAMETERS-START\n\nPhy-Parameters ::=                  SEQUENCE {\n    phy-ParametersCommon                Phy-ParametersCommon                        OPTIONAL,\n    phy-ParametersXDD-Diff              Phy-ParametersXDD-Diff                      OPTIONAL,\n    phy-ParametersFRX-Diff              Phy-ParametersFRX-Diff                      OPTIONAL,\n    phy-ParametersFR1                   Phy-ParametersFR1                           OPTIONAL,\n    phy-ParametersFR2                   Phy-ParametersFR2                           OPTIONAL\n}\n\nPhy-ParametersCommon ::=            SEQUENCE {\n    csi-RS-CFRA-ForHO                   ENUMERATED {supported}                      OPTIONAL,\n    dynamicPRB-BundlingDL               ENUMERATED {supported}                      OPTIONAL,\n    sp-CSI-ReportPUCCH                  ENUMERATED {supported}                      OPTIONAL,\n    sp-CSI-ReportPUSCH                  ENUMERATED {supported}                      OPTIONAL,\n    nzp-CSI-RS-IntefMgmt                ENUMERATED {supported}                      OPTIONAL,\n    type2-SP-CSI-Feedback-LongPUCCH     ENUMERATED {supported}                      OPTIONAL,\n    precoderGranularityCORESET          ENUMERATED {supported}                      OPTIONAL,\n    dynamicHARQ-ACK-Codebook            ENUMERATED {supported}                      OPTIONAL,\n    semiStaticHARQ-ACK-Codebook         ENUMERATED {supported}                      OPTIONAL,\n    spatialBundlingHARQ-ACK             ENUMERATED {supported}                      OPTIONAL,\n    dynamicBetaOffsetInd-HARQ-ACK-CSI   ENUMERATED {supported}                      OPTIONAL,\n    pucch-Repetition-F1-3-4             ENUMERATED {supported}                      OPTIONAL,\n    ra-Type0-PUSCH                      ENUMERATED {supported}                      OPTIONAL,\n    dynamicSwitchRA-Type0-1-PDSCH       ENUMERATED {supported}                      OPTIONAL,\n    dynamicSwitchRA-Type0-1-PUSCH       ENUMERATED {supported}                      OPTIONAL,\n    pdsch-MappingTypeA                  ENUMERATED {supported}                      OPTIONAL,\n    pdsch-MappingTypeB                  ENUMERATED {supported}                      OPTIONAL,\n    interleavingVRB-ToPRB-PDSCH         ENUMERATED {supported}                      OPTIONAL,\n    interSlotFreqHopping-PUSCH          ENUMERATED {supported}                      OPTIONAL,\n    type1-PUSCH-RepetitionMultiSlots    ENUMERATED {supported}                      OPTIONAL,\n    type2-PUSCH-RepetitionMultiSlots    ENUMERATED {supported}                      OPTIONAL,\n    pusch-RepetitionMultiSlots          ENUMERATED {supported}                      OPTIONAL,\n    pdsch-RepetitionMultiSlots          ENUMERATED {supported}                      OPTIONAL,\n    downlinkSPS                         ENUMERATED {supported}                      OPTIONAL,\n    configuredUL-GrantType1             ENUMERATED {supported}                      OPTIONAL,\n    configuredUL-GrantType2             ENUMERATED {supported}                      OPTIONAL,\n    pre-EmptIndication-DL               ENUMERATED {supported}                      OPTIONAL,\n    cbg-TransIndication-DL              ENUMERATED {supported}                      OPTIONAL,\n    cbg-TransIndication-UL              ENUMERATED {supported}                      OPTIONAL,\n    cbg-FlushIndication-DL              ENUMERATED {supported}                      OPTIONAL,\n    dynamicHARQ-ACK-CodeB-CBG-Retx-DL   ENUMERATED {supported}                      OPTIONAL,\n    rateMatchingResrcSetSemi-Static     ENUMERATED {supported}                      OPTIONAL,\n    rateMatchingResrcSetDynamic         ENUMERATED {supported}                      OPTIONAL,\n    bwp-SwitchingDelay                  ENUMERATED {type1, type2}                   OPTIONAL,\n    ...,\n    [[\n    dummy                               ENUMERATED {supported}                      OPTIONAL\n    ]],\n    [[\n    maxNumberSearchSpaces               ENUMERATED {n10}                            OPTIONAL,\n    rateMatchingCtrlResrcSetDynamic     ENUMERATED {supported}                      OPTIONAL,\n    maxLayersMIMO-Indication            ENUMERATED {supported}                      OPTIONAL\n    ]]\n}\n\nPhy-ParametersXDD-Diff ::=          SEQUENCE {\n    dynamicSFI                          ENUMERATED {supported}                      OPTIONAL,\n    twoPUCCH-F0-2-ConsecSymbols         ENUMERATED {supported}                      OPTIONAL,\n    twoDifferentTPC-Loop-PUSCH          ENUMERATED {supported}                      OPTIONAL,\n    twoDifferentTPC-Loop-PUCCH          ENUMERATED {supported}                      OPTIONAL,\n    ...,\n    [[\n    dl-SchedulingOffset-PDSCH-TypeA     ENUMERATED {supported}                      OPTIONAL,\n    dl-SchedulingOffset-PDSCH-TypeB     ENUMERATED {supported}                      OPTIONAL,\n    ul-SchedulingOffset                 ENUMERATED {supported}                      OPTIONAL\n    ]]\n}\n\nPhy-ParametersFRX-Diff ::=                  SEQUENCE {\n    dynamicSFI                                  ENUMERATED {supported}                      OPTIONAL,\n    dummy1                                      BIT STRING (SIZE (2))                       OPTIONAL,\n    twoFL-DMRS                                  BIT STRING (SIZE (2))                       OPTIONAL,\n    dummy2                                      BIT STRING (SIZE (2))                       OPTIONAL,\n    dummy3                                      BIT STRING (SIZE (2))                       OPTIONAL,\n    supportedDMRS-TypeDL                        ENUMERATED {type1, type1And2}               OPTIONAL,\n    supportedDMRS-TypeUL                        ENUMERATED {type1, type1And2}               OPTIONAL,\n    semiOpenLoopCSI                             ENUMERATED {supported}                      OPTIONAL,\n    csi-ReportWithoutPMI                        ENUMERATED {supported}                      OPTIONAL,\n    csi-ReportWithoutCQI                        ENUMERATED {supported}                      OPTIONAL,\n    onePortsPTRS                                BIT STRING (SIZE (2))                       OPTIONAL,\n    twoPUCCH-F0-2-ConsecSymbols                 ENUMERATED {supported}                      OPTIONAL,\n    pucch-F2-WithFH                             ENUMERATED {supported}                      OPTIONAL,\n    pucch-F3-WithFH                             ENUMERATED {supported}                      OPTIONAL,\n    pucch-F4-WithFH                             ENUMERATED {supported}                      OPTIONAL,\n    pucch-F0-2WithoutFH                         ENUMERATED {notSupported}                   OPTIONAL,\n    pucch-F1-3-4WithoutFH                       ENUMERATED {notSupported}                   OPTIONAL,\n    mux-SR-HARQ-ACK-CSI-PUCCH-MultiPerSlot      ENUMERATED {supported}                      OPTIONAL,\n    uci-CodeBlockSegmentation                   ENUMERATED {supported}                      OPTIONAL,\n    onePUCCH-LongAndShortFormat                 ENUMERATED {supported}                      OPTIONAL,\n    twoPUCCH-AnyOthersInSlot                    ENUMERATED {supported}                      OPTIONAL,\n    intraSlotFreqHopping-PUSCH                  ENUMERATED {supported}                      OPTIONAL,\n    pusch-LBRM                                  ENUMERATED {supported}                      OPTIONAL,\n    pdcch-BlindDetectionCA                      INTEGER (4..16)                             OPTIONAL,\n    tpc-PUSCH-RNTI                              ENUMERATED {supported}                      OPTIONAL,\n    tpc-PUCCH-RNTI                              ENUMERATED {supported}                      OPTIONAL,\n    tpc-SRS-RNTI                                ENUMERATED {supported}                      OPTIONAL,\n    absoluteTPC-Command                         ENUMERATED {supported}                      OPTIONAL,\n    twoDifferentTPC-Loop-PUSCH                  ENUMERATED {supported}                      OPTIONAL,\n    twoDifferentTPC-Loop-PUCCH                  ENUMERATED {supported}                      OPTIONAL,\n    pusch-HalfPi-BPSK                           ENUMERATED {supported}                      OPTIONAL,\n    pucch-F3-4-HalfPi-BPSK                      ENUMERATED {supported}                      OPTIONAL,\n    almostContiguousCP-OFDM-UL                  ENUMERATED {supported}                      OPTIONAL,\n    sp-CSI-RS                                   ENUMERATED {supported}                      OPTIONAL,\n    sp-CSI-IM                                   ENUMERATED {supported}                      OPTIONAL,\n    tdd-MultiDL-UL-SwitchPerSlot                ENUMERATED {supported}                      OPTIONAL,\n    multipleCORESET                             ENUMERATED {supported}                      OPTIONAL,\n    ...,\n    [[\n    csi-RS-IM-ReceptionForFeedback              CSI-RS-IM-ReceptionForFeedback              OPTIONAL,\n    csi-RS-ProcFrameworkForSRS                  CSI-RS-ProcFrameworkForSRS                  OPTIONAL,\n    csi-ReportFramework                         CSI-ReportFramework                         OPTIONAL,\n    mux-SR-HARQ-ACK-CSI-PUCCH-OncePerSlot       SEQUENCE {\n        sameSymbol                                  ENUMERATED {supported}                      OPTIONAL,\n        diffSymbol                                  ENUMERATED {supported}                      OPTIONAL\n    }                                                                                       OPTIONAL,\n    mux-SR-HARQ-ACK-PUCCH                       ENUMERATED {supported}                      OPTIONAL,\n    mux-MultipleGroupCtrlCH-Overlap             ENUMERATED {supported}                      OPTIONAL,\n    dl-SchedulingOffset-PDSCH-TypeA             ENUMERATED {supported}                      OPTIONAL,\n    dl-SchedulingOffset-PDSCH-TypeB             ENUMERATED {supported}                      OPTIONAL,\n    ul-SchedulingOffset                         ENUMERATED {supported}                      OPTIONAL,\n    dl-64QAM-MCS-TableAlt                       ENUMERATED {supported}                      OPTIONAL,\n    ul-64QAM-MCS-TableAlt                       ENUMERATED {supported}                      OPTIONAL,\n    cqi-TableAlt                                ENUMERATED {supported}                      OPTIONAL,\n    oneFL-DMRS-TwoAdditionalDMRS-UL             ENUMERATED {supported}                      OPTIONAL,\n    twoFL-DMRS-TwoAdditionalDMRS-UL             ENUMERATED {supported}                      OPTIONAL,\n    oneFL-DMRS-ThreeAdditionalDMRS-UL           ENUMERATED {supported}                      OPTIONAL\n    ]],\n    [[\n    pdcch-BlindDetectionNRDC                SEQUENCE {\n        pdcch-BlindDetectionMCG-UE              INTEGER (1..15),\n        pdcch-BlindDetectionSCG-UE              INTEGER (1..15)\n    }                                                                                       OPTIONAL,\n    mux-HARQ-ACK-PUSCH-DiffSymbol               ENUMERATED {supported}                      OPTIONAL\n    ]]\n}\n\nPhy-ParametersFR1 ::=                       SEQUENCE {\n    pdcch-MonitoringSingleOccasion              ENUMERATED {supported}                      OPTIONAL,\n    scs-60kHz                                   ENUMERATED {supported}                      OPTIONAL,\n    pdsch-256QAM-FR1                            ENUMERATED {supported}                      OPTIONAL,\n    pdsch-RE-MappingFR1-PerSymbol               ENUMERATED {n10, n20}                       OPTIONAL,\n    ...,\n    [[\n    pdsch-RE-MappingFR1-PerSlot                 ENUMERATED {n16, n32, n48, n64, n80, n96, n112, n128,\n                                                n144, n160, n176, n192, n208, n224, n240, n256}         OPTIONAL\n    ]]\n}\n\nPhy-ParametersFR2 ::=                       SEQUENCE {\n    dummy                                       ENUMERATED {supported}                                  OPTIONAL,\n    pdsch-RE-MappingFR2-PerSymbol               ENUMERATED {n6, n20}                                    OPTIONAL,\n    ...,\n    [[\n    pCell-FR2                                   ENUMERATED {supported}                                  OPTIONAL,\n    pdsch-RE-MappingFR2-PerSlot                 ENUMERATED {n16, n32, n48, n64, n80, n96, n112, n128,\n                                                    n144, n160, n176, n192, n208, n224, n240, n256}     OPTIONAL\n    ]]\n}\n\n-- TAG-PHY-PARAMETERS-STOP\n-- ASN1STOP\n\nPhy-ParametersFRX-Diff field description\ncsi-RS-IM-ReceptionForFeedback/ csi-RS-ProcFrameworkForSRS/ csi-ReportFramework\n\n<<< UNMOIFIED SECTIONS OMITTED >>>\n\n\u2013\tUE-NR-Capability\nThe IE UE-NR-Capability is used to convey the NR UE Radio Access Capability Parameters, see TS 38.306 [26].\nUE-NR-Capability information element\n-- ASN1START\n-- TAG-UE-NR-CAPABILITY-START\n\nUE-NR-Capability ::=            SEQUENCE {\n    accessStratumRelease            AccessStratumRelease,\n    pdcp-Parameters                 PDCP-Parameters,\n    rlc-Parameters                  RLC-Parameters                                                              OPTIONAL,\n    mac-Parameters                  MAC-Parameters                                                              OPTIONAL,\n    phy-Parameters                  Phy-Parameters,\n    rf-Parameters                   RF-Parameters,\n    measAndMobParameters            MeasAndMobParameters                                                        OPTIONAL,\n    fdd-Add-UE-NR-Capabilities      UE-NR-CapabilityAddXDD-Mode                                                 OPTIONAL,\n    tdd-Add-UE-NR-Capabilities      UE-NR-CapabilityAddXDD-Mode                                                 OPTIONAL,\n    fr1-Add-UE-NR-Capabilities      UE-NR-CapabilityAddFRX-Mode                                                 OPTIONAL,\n    fr2-Add-UE-NR-Capabilities      UE-NR-CapabilityAddFRX-Mode                                                 OPTIONAL,\n    featureSets                     FeatureSets                                                                 OPTIONAL,\n    featureSetCombinations          SEQUENCE (SIZE (1..maxFeatureSetCombinations)) OF FeatureSetCombination     OPTIONAL,\n\n    lateNonCriticalExtension        OCTET STRING                                                                OPTIONAL,\n    nonCriticalExtension            UE-NR-Capability-v1530                                                      OPTIONAL\n}\n\nUE-NR-Capability-v1530 ::=               SEQUENCE {\n    fdd-Add-UE-NR-Capabilities-v1530         UE-NR-CapabilityAddXDD-Mode-v1530                                  OPTIONAL,\n    tdd-Add-UE-NR-Capabilities-v1530         UE-NR-CapabilityAddXDD-Mode-v1530                                  OPTIONAL,\n    dummy                                    ENUMERATED {supported}                                             OPTIONAL,\n    interRAT-Parameters                      InterRAT-Parameters                                                OPTIONAL,\n    inactiveState                            ENUMERATED {supported}                                             OPTIONAL,\n    delayBudgetReporting                     ENUMERATED {supported}                                             OPTIONAL,\n    nonCriticalExtension                     UE-NR-Capability-v1540                                             OPTIONAL\n}\n\nUE-NR-Capability-v1540 ::=              SEQUENCE {\n    sdap-Parameters                         SDAP-Parameters                                                     OPTIONAL,\n    overheatingInd                          ENUMERATED {supported}                                              OPTIONAL,\n    ims-Parameters                          IMS-Parameters                                                      OPTIONAL,\n    fr1-Add-UE-NR-Capabilities-v1540        UE-NR-CapabilityAddFRX-Mode-v1540                                   OPTIONAL,\n    fr2-Add-UE-NR-Capabilities-v1540        UE-NR-CapabilityAddFRX-Mode-v1540                                   OPTIONAL,\n    fr1-fr2-Add-UE-NR-Capabilities          UE-NR-CapabilityAddFRX-Mode                                         OPTIONAL,\n    nonCriticalExtension                    UE-NR-Capability-v1550                                              OPTIONAL\n}\n\nUE-NR-Capability-v1550 ::=               SEQUENCE {\n    reducedCP-Latency                        ENUMERATED {supported}                                             OPTIONAL,\n    nonCriticalExtension                     UE-NR-Capability-v1560                                             OPTIONAL\n}\n\nUE-NR-Capability-v1560 ::=               SEQUENCE {\n    nrdc-Parameters                         NRDC-Parameters                                                     OPTIONAL,\n    receivedFilters                         OCTET STRING (CONTAINING UECapabilityEnquiry-v1560-IEs)             OPTIONAL,\n    nonCriticalExtension                    UE-NR-Capability-v1570                                              OPTIONAL\n}\n\nUE-NR-Capability-v1570 ::=               SEQUENCE {\n    nrdc-Parameters-v1570                   NRDC-Parameters-v1570                                               OPTIONAL,\n    nonCriticalExtension                    SEQUENCE {}                                                         OPTIONAL\n}\n\nUE-NR-CapabilityAddXDD-Mode ::=         SEQUENCE {\n    phy-ParametersXDD-Diff                  Phy-ParametersXDD-Diff                                              OPTIONAL,\n    mac-ParametersXDD-Diff                  MAC-ParametersXDD-Diff                                              OPTIONAL,\n    measAndMobParametersXDD-Diff            MeasAndMobParametersXDD-Diff                                        OPTIONAL\n}\n\nUE-NR-CapabilityAddXDD-Mode-v1530 ::=    SEQUENCE {\n    eutra-ParametersXDD-Diff                 EUTRA-ParametersXDD-Diff\n}\n\nUE-NR-CapabilityAddFRX-Mode ::= SEQUENCE {\n    phy-ParametersFRX-Diff              Phy-ParametersFRX-Diff                                                  OPTIONAL,\n    measAndMobParametersFRX-Diff        MeasAndMobParametersFRX-Diff                                            OPTIONAL\n}\n\nUE-NR-CapabilityAddFRX-Mode-v1540 ::=    SEQUENCE {\n    ims-ParametersFRX-Diff                   IMS-ParametersFRX-Diff                                             OPTIONAL\n}\n\n-- TAG-UE-NR-CAPABILITY-STOP\n-- ASN1STOP\n\nUE-NR-Capability field descriptions\nfeatureSetCombinations\tA list of FeatureSetCombination:s for supportedBandCombinationList in UE-NR-Capability. The FeatureSetDownlink:s and FeatureSetUplink:s referred to from these FeatureSetCombination:s are defined in the featureSets list in UE-NR-Capability.\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is ambiguous which fields may be contained in which instance of the IE type \u201dPhy-ParametersFRX-Diff\u201d (specifically the fields csi-RS-IM-ReceptionForFeedback/ csi-RS-ProcFrameworkForSRS/ csi-ReportFramework)It is also ambiguous in which cases the network should take those three fields into account. The current text suggests that it depends on the type of band combinations, i.e., if the BC supports configuring cells on FR1 and FR2. However, the network only has to respect those three values if it actually configures cells on both FR1 and FR2. If it configures only cells on FR1 in accordance with a fallback of such BC it does not need to respect those fields.\n\n>>> SUMMARY OF CHANGE\n1) Clarify that fr1-fr2-Add-UE-NR-Capabilities does not include any other fields than csi-RS-IM-ReceptionForFeedback/ csi-RS-ProcFrameworkForSRS/ csi-ReportFramework.2) Clarify that the UE shall not include the fields csi-RS-IM-ReceptionForFeedback/ csi-RS-ProcFrameworkForSRS/ csi-ReportFramework in any other instance of the IE Phy-ParametersFRX-Diff than the one in fr1-fr2-Add-UE-NR-Capabilities.3) Clarify that the network should observe those three values if it configures the UE with serving cells on both FR1 and FR2 bands.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt is ambiguous which fields the UE may include in which instance of the Phy-ParametersFRX-Diff and which of those fields the network should assess in which configurations. These ambiguities may lead to situations where a UE attempts to advertise or restrict capabilities in a field which the network does not assess. In such cases the network may configure functionality which the UE does not support. It may also lead to situations where the network assesses a capability parameter which the UE implementation did not consider necessary to set even though it supports the associated functionality. In this case the network may be unable to use the intended functionality. Impact Analysis: If the UE is implemented according to the CR but the NW is not, the network may fail to interpret which functionality the UE supports when configured with FR1/FR2 CA/DC. If the NW is implemented according to the CR but the UE is not, the the network may fail to interpret which functionality the UE supports when configured with FR1/FR2 CA/DC.In both cases the network may configure functionality which the UE does not support which possibly results in a connection failure. In both cases the network may not configure functionality which the UE would have supporetd."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n**** START OF CHANGES ****\nF.3\tSubscriber identity and key derivation \nEAP-AKA' uses the subscriber identity (Identity) as an input to the key derivation when the key derivation function has value 1 ( i.e. MK = PRF'(IK'|CK',\"EAP-AKA'\"|Identity)). RFC 4187 [21] clause 7 describes that the Identity is taken from the EAP-Response/Identity or EAP-Response/AKA-Identity AT_IDENTITY attribute sent by the peer. This principle is not applied to the 5GS. \nIf the AT_KDF_INPUT parameter contains the prefix \"5G:\", the AT_KDF parameter has the value 1 and the authentication is not related to fast re-authentication, then the UE shall use SUPI as the Identity for key derivation. This principle applies to all full EAP-AKA' authentications, even if the UE sent SUCI in NAS protocol or if the UE sent SUCI in the respose to the EAP identity requests as described in Table F.2-1 or if no identity was sent because the network performed re-authentication. The only exception is fast re-authentication when the UE follows the key derivation as described in RFC 5448 [12] for fast re-authentication.\nNOTE 1:\tThe fast re-authentication is not supported in 5GS. \nNOTE 2: \tThe prefix \"5G:\" is part of serving network name as specified in clause 6.1.1.4.\n\n**** END OF CHANGES ****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen EAP-AKA\u2019 is used, it is unclear how SUPI is to be used as the input for the Identity in the MK key derivation using PRF\u2019 KDF\n\n>>> SUMMARY OF CHANGE\nIn alignment with how KAMF is derived in Annex A.7.0 of TS 33.501, it is clarified that SUPI Type is excluded from the Identity\n\n>>> CONSEQUENCES IF NOT REVISED\nDifferent interpretations by ME and the network implementations may lead to interoperability problems, leading to failure of EAP-AKA\u2019 authentication"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** First change *****\n5.4.3.2\tNAS security mode control initiation by the network\nThe MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure\u00a05.4.3.2.1).\nThe MME shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:\n-\tto take into use the EPS security context created after a successful execution of the EPS authentication procedure;\n-\tupon receipt of TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME wishes to create a mapped EPS security context (i.e. the type of security context flag is set to \"mapped security context\" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message).\nThe MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to \"integrity protected with new EPS security context\".\nThe MME shall create a locally generated KASME and send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to \"000\" and EIA0 and EEA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:\n-\tduring an attach procedure for emergency bearer services if no shared EPS security context is available;\n-\tduring a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;\n-\tduring a service request procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available; or\n-\tafter a failed authentication procedure for a UE that has a PDN connection for emergency bearer services or that is establishing a PDN connection for emergency bearer services, if continued usage of a shared security context is not possible.\nThe UE shall process a SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to \"000\" and EIA0 and EEA0 as the selected NAS security algorithms and, if accepted, create a locally generated KASME when the security mode control procedure is initiated:\n-\tduring an attach procedure for emergency bearer services;\n-\tduring a tracking area updating procedure when the UE has a PDN connection for emergency bearer services;\n-\tduring a service request procedure when the UE has a PDN connection for emergency bearer services; or\n-\tafter an authentication procedure when the UE has a PDN connection for emergency bearer services or is establishing a PDN connection for emergency bearer services.\nNOTE\u00a01:\tThe process for creation of the locally generated KASME by the MME and the UE is implementation dependent.\nUpon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall either:\n-\tindicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to \"mapped security context\" and the KSI value related to the security context of the source system; or\n-\tset the KSI value \"000\" in the NAS key set identifier IE if the MME sets EIA0 and EEA0 as the selected NAS security algorithms for a UE that has a PDN connection for emergency bearer services.\nWhile having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message.\nThe MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network), the replayed nonceUE when creating a mapped EPS security context and if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI).\nThe MME shall include both the nonceMME and the nonceUE when creating a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode.\nThe MME may initiate a SECURITY MODE COMMAND in order to change the NAS security algorithms for a current EPS security context already in use. The MME re-derives the NAS keys from KASME with the new NAS algorithm identities as input and provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. The MME shall set the security header type of the message to \"integrity protected with new EPS security context\".\n\n\nAdditionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.\nNOTE\u00a02:\tThe AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS, the same algorithm  is also supported for AS.\n\nFigure 5.4.3.2.1: Security mode control procedure\n5.4.3.3\tNAS security mode command accepted by the UE\nUpon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities and the received nonceUE have not been altered compared to the latest values that the UE sent to the network. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). When the UE has a PDN connection for emergency bearer services established or the UE is establishing a PDN connection for emergency bearer services, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value \"000\" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms).\nThe UE shall accept a SECURITY MODE COMMAND message indicating the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm only if the message is received for a UE that has a PDN connection for emergency bearer services established or a UE that is establishing a PDN connection for emergency bearer services.\nIf the type of security context flag included in the SECURITY MODE COMMAND message is set to \"native security context\" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:\n-\tthe SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;\n-\tthe SECURITY MODE COMMAND message received includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm, the UE shall:\n-\tif the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;\n-\totherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K'ASME if the type of security context flag is set to \"mapped security context\" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:\n-\tgenerate K'ASME from both the nonceMME and the nonceUE as indicated in 3GPP\u00a0TS\u00a033.401\u00a0[19];or\n-\tcheck whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K'ASME.\nFurthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K'ASME indicated by the eKSI. The UE shall set the security header type of the message to \"integrity protected and ciphered with new EPS security context\".\nFrom this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.\nIf the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.\n\n5.4.3.4\tNAS security mode control completion by the network\nThe MME shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3460. From this time onward the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms.\n\n***** Next change *****\n8.2.20.1\tMessage definition\nThis message is sent by the network to the UE to establish NAS signalling security. See table\u00a08.2.20.1.\nMessage type:\tSECURITY MODE COMMAND\nSignificance:\t\tdual\nDirection:\t\t\tnetwork to UE\nTable 8.2.20.1: SECURITY MODE COMMAND message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tProtocol discriminator\tProtocol discriminator\t9.2\tM\tV\t1/2\n\tSecurity header type\tSecurity header type\t9.3.1\tM\tV\t1/2\n\tSecurity mode command message identity\tMessage type\t9.8\tM\tV\t1\n\tSelected NAS security algorithms\tNAS security algorithms\t9.9.3.23\tM\tV\t1\n\tNAS key set identifier\tNAS key set identifier\t9.9.3.21\tM\tV\t1/2\n\tSpare half octet\tSpare half octet\t9.9.2.9\tM\tV\t1/2\n\tReplayed UE security capabilities\tUE security capability\t9.9.3.36\tM\tLV\t3-6\nC-\tIMEISV request\tIMEISV request\t9.9.3.18\tO\tTV\t1\n55\tReplayed nonceUE\tNonce\t9.9.3.25\tO\tTV\t5\n56\tNonceMME\tNonce\t9.9.3.25\tO\tTV\t5\n\n\n***** Next change *****\n\n\n\n\n***** Next change *****\n8.2.21.1\tMessage definition\nThis message is sent by the UE to the network in response to a SECURITY MODE COMMAND message. See table\u00a08.2.21.1.\nMessage type:\tSECURITY MODE COMPLETE\nSignificance:\t\tdual\nDirection:\t\t\tUE to network\nTable 8.2.21.1: SECURITY MODE COMPLETE message content\nIEI\tInformation Element\tType/Reference\tPresence\tFormat\tLength\n\tProtocol discriminator\tProtocol discriminator\t9.2\tM\tV\t1/2\n\tSecurity header type\tSecurity header type\t9.3.1\tM\tV\t1/2\n\tSecurity mode complete message identity\tMessage type\t9.8\tM\tV\t1\n23\tIMEISV\tMobile identity\t9.9.2.3\tO\tTLV\t11\n\n\n***** Next change *****\n\n\n\n\n\n***** Next change *****\n\n\n\n\n\n\n\n information element\n\n\n***** Next change *****\n\n\n\n\n\n\n\n\n\n\n\n\n***** End of changes *****\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAt SA3#84, SA3 agreed S3-161217 which introduced in TS 33.401 a mechanism against man-in-the middle attacks by which an attacker modifies the IEs included by the UE in Attach/TAU Requests, which results in the UE ending up attached to the network in ways the UE had not requested, e.g. for SMS only.The mechanism can be summarized as follows: If the Attach or TAU Request fails the integrity check at the MME, or integrity protection of the message cannot be checked by the MME because the message is sent without integrity protection, then the MME calculate a hash of the message it received and sends the hash to the UE in the Security Mode Command message The UE calculates a hash of the Attach or TAU Request message it had sent to the network and compares it to the hash value received in the Security Mode Command messageIf the hash calculated by the UE is different from the hash value received in the Security Mode Command message, the UE includes the Attach Request/TAU Request message into the Security Mode Complete message, and the MME uses the message in the Security Mode Complete message to complete the rest of the procedure. If the hash calculated by the UE is the same as the hash value received in the Security Mode Command message, the UE does not include the Attach Request/TAU Request message into the Security Mode Complete message, and the rest of the procedure completes as currently specified.\n\n>>> SUMMARY OF CHANGE\nThe security mode control procedure was updated as per the SA3-agreed mechanism.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt will be possible for an attacker to modifiy the Attach/TAU Request sent by the UE and cause interruption of service or disruption at the UE and MME."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** Next change *****\n4.7.5.1\tNormal and periodic routing area updating procedure\nPeriodic routing area updating is used to periodically notify the availability of the MS to the network. The value of the update type IE in the ROUTING AREA UPDATE REQUEST message shall indicate \"periodic updating\". The procedure is controlled in the MS by timer T3312. When timer T3312 expires, the periodic routing area updating procedure is started. Start and reset of timer T3312 is described in subclause\u00a04.7.2.2.\nThe normal routing area updating procedure is initiated:\n-\twhen the MS detects a change of the routing area in state GMM-REGISTERED;\n-\twhen the MS determines that GPRS resumption shall be performed;\n-\twhen the MS needs to update the network with the new MS Radio Access Capability IE;\n-\twhen the MS needs to update the network with the new DRX parameter IE;\n-\tin Iu mode, to re-synchronize the PMM mode of MS and network after RRC connection release with cause \"Directed signalling connection re-establishment\", see subclause\u00a04.7.2.5;\n-\tin Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of \"RRC connection failure\" from lower layers due to lower layer while in S1 mode;\n-\tin A/Gb mode, after intersystem change from S1 mode if the TIN indicates \"RAT-related TMSI\", but the MS is required to perform routing area updating for IMS voice termination as specified in annex P.4;\n-\twhen the MS enters GMM-REGISTERED.NORMAL-SERVICE and the TIN indicates \"GUTI\";\n-\twhen the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the Allowed CSG list;or in the Operator CSG list; \n-\twhen the MS supports SRVCC and changes the mobile station classmark 2, mobile station classmark 3 or the supported codecs;\n-\twhen the MS changes the MS network capability information;\n-\twhen the UE's usage setting or the voice domain preference for E-UTRAN change in the MS;\n-\twhen the MS activates mobility management for IMS voice termination as specified in annex\u00a0P.2 and the TIN indicates \"RAT-related TMSI\";\n-\tupon reception of a paging indication, using P-TMSI, even if the timer T3346 is running and the MS is in state GMM-REGISTERED.ATTEMPTING-TO-UPDATE;\n-\tin A/Gb mode, after intersystem change from S1 mode via cell change order procedure not due to CS fallback, if the TIN indicates \"RAT-related TMSI\"; in this case the MS shall set the TIN to \"GUTI\" before initiating the routing area updating procedure; or\n-\tin A/Gb mode, after Inter RAT handover from S1 mode or Iu mode.\nThe ROUTING AREA UPDATE REQUEST message shall always be the first data sent by the MS when a routing area border is crossed. The routing area identification is broadcast on the broadcast channel(s).\nA normal routing area updating shall abort any ongoing GMM procedure. Aborted GMM procedures may be repeated after the normal routing area updating procedure has been successfully performed. The value of the update type IE included in the message shall indicate \"RA updating\".\nIf the normal routing area updating procedure is initiated due to the reception of the paging indication while timer T3346 is running, the \"follow-on request pending\" indication shall be set to 1.\n\n\n***** Next change *****\n4.7.5.1.5\tAbnormal cases in the MS\nThe following abnormal cases can be identified:\na)\tAccess barred because of access class control\n\tThe routing area updating procedure shall not be started. The MS stays in the current serving cell and applies the normal cell reselection process. The procedure is started as soon as possible and if still necessary, i.e. when the barred state is removed or because of a cell change.\nb)\tLower layer failure without \"Extended Wait Time\" received from lower layers before the ROUTING AREA UPDATE ACCEPT or ROUTING AREA UPDATE REJECT message is received\n\tThe procedure shall be aborted and the MS shall proceed as described below, except in the following implementation option cases b.1 and b.2.\nb.1)\tRelease of PS signalling connection before the completion of the routing area updating procedure\n\tThe routing area updating procedure shall be initiated again, if the following conditions apply:\n\ti)\tThe original routing area update procedure was initiated over an existing PS signalling connection; and\n\tii)\t The routing area update procedure was not due to timer T3330 expiry; and\n\tiii)\tNo SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection were (e.g. PS authentication procedure, see subclause\u00a04.7.7) received after the ROUTING AREA UPDATE REQUEST message was transmitted.\nb.2)\tRR release in Iu mode (i.e. RRC connection release) with, for example, cause \"Normal\", or \"User inactivity\" or \"Direct signalling connection re-establishment\" (see 3GPP\u00a0TS\u00a025.331\u00a0[23c] and 3GPP\u00a0TS\u00a044.118\u00a0[111])\n\tThe routing area updating procedure shall be initiated again, if the following conditions apply:\n\ti)\tThe original routing area update procedure was initiated over an existing RRC connection; and\n\tii)\t The routing area update procedure was not due to timer T3330 expiry; and\n\tiii)\tNo SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause\u00a04.7.7) were received after the ROUTING AREA UPDATE REQUEST message was transmitted.\nNOTE\u00a01: \tThe RRC connection release cause that triggers the re-initiation of the routing area update procedure is implementation specific. \nc)\tT3330 time-out\n\tThe procedure is restarted four times, i.e. on the fifth expiry of timer T3330, the MS shall abort the procedure and, in Iu mode, release the PS signalling connection (see 3GPP\u00a0TS\u00a025.331\u00a0[23c]). The MS shall proceed as described below.\nd)\tROUTING AREA UPDATE REJECT, other causes than those treated in subclause\u00a04.7.5.1.4, and cases of GMM cause #22, if considered as abnormal cases according to subclause\u00a04.7.5.1.4\n\tIf the routing area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the cause codes # 95, # 96, # 97, # 99 and # 111 the MS should set the routing area updating attempt counter to 5.\n\tThe MS shall proceed as described below.\ne)\tIf a routing area border is crossed, when the MS is in state GMM-ROUTING-AREA-UPDATE-INITIATED, the routing area updating procedure shall be aborted and re-initiated immediately. The MS shall set the GPRS update status to GU2 NOT UPDATED.\nf)\tIn A/Gb mode, if a cell change occurs within the same RA, when the MS is in state GMM-ROUTING-AREA-UPDATE-INITIATED, the cell update procedure is performed, before completion of the routing area updating procedure.\ng)\tRouting area updating and detach procedure collision\n\tGPRS detach containing detach type \"re-attach required\" or \"re-attach not required\":\n\tIf the MS receives a DETACH REQUEST message before the routing area updating procedure has been completed, the routing area updating procedure shall be aborted and the GPRS detach procedure shall be progressed. If the DETACH REQUEST message contains detach type \"re-attach not required\" and GMM cause #2 \"IMSI unknown in HLR\", the MS will follow the procedure as described below for the detach type \"IMSI detach\".\n\tGPRS detach containing detach type \"IMSI detach\":\n\tIf the MS receives a DETACH REQUEST message before the routing area updating procedure has been completed, the routing area updating procedure shall be progressed, i.e. the DETACH REQUEST message shall be ignored.\nh)\tRouting area updating and P-TMSI reallocation procedure collision\n\tIf the MS receives a P-TMSI REALLOCATION C0MMAND message before the routing area updating procedure has been completed, the P-TMSI reallocation procedure shall be aborted and the routing area updating procedure shall be progressed.\ni)\t\"Extended wait time\" for PS domain from the lower layers\n\tIf the ROUTING AREA UPDATE REQUEST message contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", the MS shall start timer T3346 with the \"Extended wait time\" value.\n\tIn other cases the MS shall ignore the \"Extended wait time\".\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter, stay in the current serving cell, set the GPRS update status to GU2 NOT UPDATED, change the state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.\n\tThe routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\nj)\tTimer T3346 is running\n\tThe MS shall not start the routing area updating procedure unless:\n-\tthe READY timer is running (A/Gb mode);\n-\tthe  MS is an MS configured to use AC11 \u2013 15 in selected PLMN; or\n-\tthe MS is in PMM-CONNECTED mode (Iu mode);\n-\tthe MS receives a paging;\n-\tthe MS has a PDN connection for emergency bearer services established; or\n-\tthe MS is establishing a PDN connection for emergency bearer services; or\n-\tthe MS has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to a NAS request message (ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\". The MS stays in the current serving cell and applies the normal cell reselection process.\n\tThe routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\nNOTE\u00a02:\tIt is considered an abnormal case if the MS needs to initiate an routing area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.\n\tIf the stored RAI is different to the RAI of the current serving cell or the TIN indicates \"GUTI\", the MS shall set the GPRS update status to GU2 NOT UPDATED and change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall proceed as described below.\nIn cases b, c, d, e, and g with detach type \"re-attach required\" or \"re-attach not required\", the MS shall stop any ongoing transmission of user data.\nIn cases b, c, d, i and j the MS shall proceed as follows:\n\tTimer T3330 shall be stopped if still running. If the routing area updating request is not for initiating a PDN connection for emergency bearer services, the routing area updating attempt counter shall be incremented.\n\tIf the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GPRS update status is equal to GU1 UPDATED and the TIN does not indicate \"GUTI\" :\n-\tfor the cases i and j, the routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped;\n-\tfor all other cases, the MS shall keep the GPRS update status to GU1 UPDATED and changes state to GMM-REGISTERED.NORMAL-SERVICE. The MS shall start timer T3311.\n\tIf in addition the ROUTING AREA UPDATE REQUEST message indicated \"periodic updating\", \n-\tin Iu mode, the timer T3311 may be stopped when the MS enters PMM-CONNECTED mode;\n-\tin A/Gb mode, the timer T3311 may be stopped when the READY timer is started.\n\tIf timer T3311 expires the routing area updating procedure is triggered again.\n\tIf the routing area updating attempt counter is less than 5, and the stored RAI is different to the RAI of the current serving cell or the GPRS update status is different to GU1 UPDATED or the TIN indicates \"GUTI\":\n-\tIf the routing area updating request is not for initiating a PDN connection for emergency bearer services, the MS shall start timer T3311, shall set the GPRS update status to GU2 NOT UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n-\tIf S1 mode is supported by the MS, the MS shall in addition handle the EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the abnormal case when a normal or periodic tracking area updating procedure fails and the tracking area updating attempt counter is less than 5 and the EPS update status is different from EU1 UPDATED.\n\tIf the routing area updating attempt counter is greater than or equal to 5:\n-\tthe MS shall start timer T3302, and shall set the GPRS update status to GU2 NOT UPDATED. An MS which is a GPRS MS in MS operation modes C shall also delete the list of equivalent PLMNs. The MS shall also enter the state GMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally the GMM-REGISTERED.PLMN-SEARCH state (see subclause\u00a04.2.5.1.8) in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n-\t\tIf S1 mode is supported by the MS, the MS shall in addition handle the EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the abnormal case when a normal or periodic tracking area updating procedure fails and the tracking area updating attempt counter is equal to 5.\n\n***** Next change *****\n4.7.5.2.1\tCombined routing area updating procedure initiation\nThe combined routing area updating procedure is initiated only by a GPRS MS operating in MS operation modes A or B, if the MS is in state GMM-REGISTERED and MM-IDLE, and if the network operates in network operation mode I:\n-\twhen a GPRS MS that is IMSI attached for GPRS and non-GPRS services detects a change of the routing area in state GMM-REGISTERED and MM-IDLE, unless the MS is configured for \"AttachWithIMSI\" as specified in 3GPP\u00a0TS\u00a024.368\u00a0[135] or 3GPP\u00a0TS\u00a031.102\u00a0[112] and is entering a routing area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;\n-\twhen a GPRS MS that is IMSI attached for GPRS services wants to perform an IMSI attach for non-GPRS services;\n-\tafter termination of a non-GPRS service via non-GPRS channels to update the association if the MS has changed the RA during that non-GPRS service transaction;\n-\tafter termination of a non-GPRS service via non-GPRS channels to update the association if GPRS services were suspended during the non-GPRS service but no resume is received. See 3GPP\u00a0TS\u00a023.060\u00a0[74] subclause\u00a016.2.1;\n-\tafter termination of a non-GPRS service via non-GPRS channels to update the association, if the GPRS MS in MS operation mode A performed a normal GPRS attach or a normal routing area updating procedure during the circuit-switched transaction;\n-\tafter a CM SERVICE REJECT message with cause value #4 is received by the mobile station (see subclause\u00a04.5.1.1); in this case the update type IE shall be set to \"Combined RA/LA updating with IMSI attach\";\n-\twhen a GPRS MS needs to update the network with the new MS Radio Access Capability IE;\n-\twhen a GPRS MS needs to update the network with a new DRX parameter IE;\n-\tin Iu mode, to re-synchronize the PMM mode of MS and network after RRC connection release with cause \"Directed signalling connection re-establishment\", see subclause\u00a04.7.2.5;\n-\tin Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of \"RRC connection failure\" from lower layers due to lower layer failure while in S1 mode; \n-\tin A/Gb mode, after intersystem change from S1 mode if the TIN indicates \"RAT-related TMSI\", but the MS is required to perform routing area updating for IMS voice termination as specified in annex P.4;\n-\twhen the MS enters GMM-REGISTERED.NORMAL-SERVICE and the TIN indicates \"GUTI\";\n-\twhen the MS supports SRVCC and changes the mobile station classmark 2, mobile station classmark 3 or the supported codecs;\n-\twhen the MS which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell and timer T3423 has expired, or is in the GERAN or UTRAN cell when timer T3423 expires;\n-\twhen due to a manual CSG selection the GPRS MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the MS's Allowed CSG list or in the MS's Operator CSG list;\n-\twhen the MS changes the MS network capability information;\n-\twhen the UE's usage setting or the voice domain preference for E-UTRAN change in the MS;\n-\twhen the MS activates mobility management for IMS voice termination as specified in annex P.2 and the TIN indicates \"RAT-related TMSI\";\n-\tupon reception of a paging indication using P-TMSI, if the timer T3346 is running and the MS is in state GMM-REGISTERED.ATTEMPTING-TO-UPDATE;\n-\twhen the MS which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell, after intersystem change from S1 mode to Iu or A/Gb mode not due to CS fallback, and the location area of the current cell is different from the location area stored in the MS;\n-\tin A/Gb mode, after intersystem change from S1 mode via cell change order procedure not due to CS fallback, if the TIN indicates \"RAT-related TMSI\"; in this case the MS shall set the TIN to \"GUTI\" before initiating the combined routing area updating procedure; or\n-\tin A/Gb mode, after Inter RAT handover from S1 mode or Iu mode.\nIn A/Gb mode, the routing and location area identification are broadcast on the broadcast channel(s). A combined routing area updating procedure shall abort any ongoing GMM procedure. Aborted GMM procedures shall be repeated after the combined routing area updating procedure has been successfully performed. The ROUTING AREA UPDATE REQUEST message shall always be the first message sent from the MS in the new routing area after routing area change.\nIn Iu mode, the routing and location area identification are broadcast on the broadcast channel(s) or sent to the MS via the PS signalling connection. A combined routing area updating procedure shall abort any ongoing GMM procedure. Aborted GMM procedures may be repeated after the combined routing area updating procedure has been successfully performed. The ROUTING AREA UPDATE REQUEST message shall always be the first GMM message sent from the MS in the new routing area after routing area change.\nTo initiate a combined routing area updating procedure the MS sends the message ROUTING AREA UPDATE REQUEST to the network, starts timer T3330 and changes to state GMM-ROUTING-UPDATING-INITIATED and MM LOCATION UPDATING PENDING. The value of the Update type IE in the message shall indicate \"combined RA/LA updating\" unless explicitly specified otherwise. If for the last attempt to update the registration of the location area a MM specific procedure was performed, the value of the Update type IE in the ROUTING AREA UPDATE REQUEST message shall indicate \"combined RA/LA updating with IMSI attach\". Furthermore the MS shall include the TMSI status IE if no valid TMSI is available. If the MS has stored a valid LAI and the MS supports EMM combined procedures, the MS shall include it in the Old location area identification IE in the ROUTING AREA UPDATE REQUEST message. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.\nIf the MS has stored a valid TMSI, the MS shall include the TMSI based NRI container IE in the ROUTING AREA UPDATE REQUEST message.\nA GPRS MS in MS operation modes B that is in an ongoing circuit-switched transaction, shall initiate the combined routing area updating procedure after the circuit-switched transaction has been released, if the MS has changed the RA during the circuit-switched transaction and if the network operates in network operation mode I.\nA GPRS MS in MS operation mode A shall initiate the combined routing area updating procedure with IMSI attach after the circuit-switched transaction has been released, if a normal GPRS attach or a normal routing area updating procedure was performed during the circuit-switched transaction and provided that the network operates in network operation mode I.\nA GPRS MS in MS operation mode A shall perform the normal routing area update procedure during an ongoing circuit-switched transaction.\nIf the MS initiates the combined routing area updating procedure for GPRS services and \"SMS-only service\", the MS shall indicate \"SMS only\" in the Additional update type IE.\nIn Iu mode, if the MS wishes to prolong the established PS signalling connection after the normal routing area updating procedure (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause\u00a04.7.13).\nIn Iu mode, when a ROUTING AREA UPDATE REQUEST is received by the SGSN over a new PS signalling connection while there is an ongoing PS signalling connection (network is already in mode PMM-CONNECTED) for this MS, the network shall progress the routing area update procedure as normal and release the previous PS signalling connection when the routing area update procedure has been accepted by the network.\nNOTE:\tThe re-establishment of the radio bearers of active PDP contexts is done as described in subclause \"Service Request procedure\".\nIf the combined routing area updating procedure is initiated due to the reception of the paging indication while T3346 is running, the \"follow-on request pending\" indication shall be set to 1.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the MS performs a RAU procedure if the MS meets one of the following MS abnormal cases b, c, d, i and j, on the condition that the RAU attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell, and the GPRS update status is equal to GU1 UPDATED and the TIN does not indicate \"GUTI\", the MS shall keep GPRS update status as GU1 UPDATED and enter state GMM-REGISTERED.NORMAL-SERVICE.(See the subclause 4.7.5.1.5)However, depending on the RAU triggering requirements that MS behaviour could make problematic situations.e.g,1)  following RAU triggering requirements in subclause 4.7.5.11.1) when the MS determines that GPRS resumption shall be performed;1.2) in Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of \"RRC connection failure\" from lower layers due to lower layer while in S1 mode;1.3) when the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the Allowed CSG list;or in the Operator CSG list; 1.4) in A/Gb mode, after Inter RAT handover from S1 mode or Iu mode2)  following combined RAU triggering requirements in subclause 4.7.5.2.12.1) after termination of a non-GPRS service via non-GPRS channels to update the association if GPRS services were suspended during the non-GPRS service but no resume is received. See 3GPP\u00a0TS\u00a023.060\u00a0[74] subclause\u00a016.2.1;2.2) after termination of a non-GPRS service via non-GPRS channels to update the association, if the GPRS MS in MS operation mode A performed a normal GPRS attach or a normal routing area updating procedure during the circuit-switched transaction;2.3) in Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of \"RRC connection failure\" from lower layers due to lower layer failure while in S1 mode;2.4) when the MS which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell and timer T3423 has expired, or is in the GERAN or UTRAN cell when timer T3423 expires;2.5) when due to a manual CSG selection the GPRS MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the MS's Allowed CSG list or in the MS's Operator CSG list;2.6) in A/Gb mode, after Inter RAT handover from S1 mode or Iu mode.- For 1.1) and 2.1), since the purpose of RAU is for GPRS resumption, if the MS stay in NORMAL_Service state then user data or signalling would fail until successful GPRS resumption through RAU.- For 1.2) and 2.3), since the purpose is to move to 2G/3G, RAU failure implies network doesn\u2019t know UE\u2019s move yet.-For 1.3) and 2.5), if the MS enters NORMAL-Service state, user data and signalling may be delivered through another non-intended Cell.-For 1.4) and 2.6), Since the purpose is to complete inter-RAT handover, RAU failure implies network doesn\u2019t get UE context yet.-For 2.2), Since the purpose of RAU is perform a pending TAU, it should be classified depending on reason for the original RAU. i.e it could be a problematic condition.- For 2.4), Since the purpose of RAU is to get GPRS service after ISR is deactivated, the SGSN may has no MS context.\n\n>>> SUMMARY OF CHANGE\n1). For easy description, give numbering for normal/combined RAU triggering requirements.2). Some situations are excluded from applying the MS behaviour that keeps GPRS update status as GU1 UPDATED and enters state GMM-REGISTERED.NORMAL-SERVICE when RAU fails due to MS abnormal.\n\n>>> CONSEQUENCES IF NOT REVISED\nunintended side-effects may occur. For example if MS tried to contact a CSG cell manually, the MS still contact unintentionally the current entity. or the network may not recognize the MS\u2019s message.etc."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*********************start first change **********************************\n5\tSecurity Features \n5.1\tUser-to-Network security\n5.1.1\tUser identity and device confidentiality\nUser identity confidentiality is as defined by TS 33.102 [4] subclause 5.1.1\nFrom subscriber's privacy point of view, the MSIN, the IMEI, and the IMEISV should be confidentiality protected.\nThe UE shall provide its equipment identifier IMEI or IMEISV to the network, if the network asks for it in an integrity-protected request. \nThe IMEI and IMEISV shall be securely stored in the terminal.\nThe UE shall not send IMEI or IMEISV to the network on a network request before the NAS security has been activated.\n\n\nThe IMEI or IMEISV shall be sent in the NAS protocol.\nNOTE: In some cases, e.g., the very first attach procedure, MSIN has to be sent to network in cleartext. When NAS confidentiality protection is beyond an operator option, IMEI and IMEISV can not be confidentiality protected.\n**********************end first change **********************************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe UE shall not send IMEI or IMEISV to the network on a network request before the NAS security has been activated. But for an Emergency Attach, the UE shall set the Attach Type to \"Emergency\" and the IMSI shall be included if the UE does not have a valid GUTI or a valid P-TMSI available. The IMEI shall be included when the UE has no IMSI, no valid GUTI, or no valid P-TMSI.\n\n>>> SUMMARY OF CHANGE\nAdding a note to clarify that in an Emergency Attach IMEI shall be included before the NAS security has been activated when the UE has no IMSI, no valid GUTI, or no valid P-TMSI.\n\n>>> CONSEQUENCES IF NOT REVISED\nIt makes confusion that IMEI is only sent to the network with security protection on a network request."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n******************** Start of 1st change *******************\nB.7.1\tOverview\nWhen an MCX user requires user service authorisation for services owned and managed within a partner domain, the MCX client shall use the OAuth 2.0 token exchange extension grant type mechanism to obtain a security token for authentication with the partner IdM service.  The OAuth 2.0 token exchange procedure defines a method for obtaining the security token from the primary IdMS which contains information about the user that is verifiable by the partner IdMS.\nThe MCX client then provides this security token to the partner IdM service in exchange for an access token that is specific to the services in the partner domain. The MCX UE then uses the access token for user service authorisation to those services within the partner domain.\nThe security token and acess token(s) are specific to a IdMS and partner domain and therefore the OAuth 2.0 token exchange procedure shall be repeated with each additional domain to obtain user service authorisation to partner services within those domains.\n Figure B.7.1-1 shows the OAuth 2.0 token exchange procedure used to obtain a security token and acess token(s).  The messages are described in the following sub-clauses.\n\n******************** End of 1st change *******************\n\n******************** Start of 2nd change ******************\nB.7.3\tToken Exchange Response\nUpon successfully receiving and validating the token exchange request message from the MCX client, the IdM server shall return a token exchange response containing a security token specific to the partner IdMS.\nThe token exchange response standard parameters are shown in table B.7.3-1.\nTable B.7.3-1: Token exchange response standard required parameters\nParameter\tValues\naccess_token\tREQUIRED. This is the security token specific to the partner IdMS.\nissued_token_type\tREQUIRED. This field shall be \u201curn:ietf:params:oauth:token-type:jwt\u201d\ntoken_type\tREQUIRED. This field shall be \u201cbearer\u201d\nexpires_in\tRECOMMENDED.  The lifetime in seconds of the security token.  \n\n******************** End of 2nd change ******************\n\n******************** Start of 3rd change ******************\n\nB.7.4\tToken Request\nIn order to exchange the security token for an access token and (optional) refresh token, the MCX client makes a request to the partner authorization server's token endpoint by sending the following parameters using the \"application/x-www-form-urlencoded\" format, with a character encoding of UTF-8 in the HTTP request entity-body. Note that authentication of the security token is REQUIRED in order to exchange the security token for an access token. The security token shall be transported in the HTTP Authorization Header. The token request standard parameters are shown in table B.7.4-1.\nTable B.7.4-1: Token Request standard required parameters\nParameter\tValues\ngrant_type\tREQUIRED. This value shall be set to \"urn:ietf:params:oauth:grant-type:jwt-bearer\" as per rfc 7523 [46].\n\nclient_id\tREQUIRED. The identifier of the client making the API request. It shall match the value that was previously registered with the OAuth Provider during the client registration phase of deployment, or as provisioned via a development portal.\nscope\tREQUIRED. Scope values are expressed as a list of space-delimited, case-sensitive strings which indicate which MCX resource servers the client is requesting access to at the partner system (e.g. MCPTT group services, MCVideo group services, MCData group services, etc.). If authorized, the requested scope values will be bound to the access token returned to the client in the token exchange response message.  The scope shall include one or more of the following:\t\t\t-\t\"3gpp:mc:ptt_service\"\t\t-\t\"3gpp:mc:video_service\"\t\t-\t\"3gpp:mc:data_service\"\t\t-\t\"3gpp:mc:ptt_key_management_service\"\t\t-\t\"3gpp:mc:video_key_management_service\"\t\t-\t\"3gpp:mc:data_key_management_service\"\t\t-\t\"3gpp:mc:ptt_config_management_service\"\t\t-\t\"3gpp:mc:video_config_management_service\"\t\t-\t\"3gpp:mc:data_config_management_service\"\t\t-\t\"3gpp:mc:ptt_group_management_service\"\t\t-\t\"3gpp:mc:video_group_management_service\"\t\t-\t\"3gpp:mc:data_group_management_service\"\t\tOthers may be added in the future as new MCX resource servers are introduced by 3GPP.\n\nExamples of a successful token request might look like:\nEXAMPLE 1:\nPOST /as/token.oauth2 HTTP/1.1\nHost: IdM.server.com:9031\nCache-Control: no-cache\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer& \nclient_id=myNativeApp&\nscope=openid\u00a03gpp:mc:ptt_group_management_service&\n\nEXAMPLE 2:\nPOST /as/token.oauth2 HTTP/1.1\nHost: IdM.server.com:9031\nCache-Control: no-cache\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&\nclient_id=myNativeApp&\nscope=openid\u00a03gpp:mc:ptt_service,3gpp:mc:ptt_key_management_service,3gpp:mc:ptt_config_management_service,3gpp:mc:ptt_group_management_service&\n\n******************** End of 3rd change ******************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn 33.180 annex B.7.1 and B.7.3, it is stated that the security token is specific to a partner domain when in fact the same security token may be for user authentication at one or more partner domains. In addition, the token request message in annex B.7.4 is missing the \u201cassertion\u201d parameter.\n\n>>> SUMMARY OF CHANGE\nChange text in B.7.1 and B.7.3 to eliminate the above security token restriction and add the \u201cassertion\u201d parameter to the token request message in B.7.4.\n\n>>> CONSEQUENCES IF NOT REVISED\nStage 3 procedures will incorrectly restrict usage of the security token and identity management interoperability will be lost without the \u201cassertion\u201d parameter in the token request message."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n\n************ START OF CHANGES\n\n6.1.3c.3\tNF Certificate profile\nTLS certificates shall be directly signed by the CA in the operator domain that the entity belongs to.\nNOTE:\tRFC 6125 [52] describes guidelines and procedures for representing and verifying the identity of application service using X.509 PKIX certificates with TLS. It mandates use of subjectAltName entries (DNS-ID, SRV-ID, URI-ID, etc.) over use of the subject field (CN-ID) where available. Furthermore, it is stated that a client does not seek a match for a reference identifier of CN-ID if the presented identifiers include a DNS-ID, SRV-ID, URI-ID, or any application-specific identifier types supported by the client.\nIn addition to clause 6.1.1 and the provisions of RFC 5280 [14] the following table captures the certificate profile for NF:\nTable 6.1.3c.3-1: NF TLS Client and Server Certificate Profile\nNF TLS Client and Server Certificate Profile\nVersion\tv3\nSerial Number\tUnique Positive Integer in the context of the issuing Root CA and not longer than 20 octets.\nSubject DN\tC=<Country>\tO= Home Domain Name (e.g., in \"5gc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\" format) as defined in clause 28.2 of TS 23.003 [55])\tCN=<Enumerated NF Type> (from clause 6.1.6.3.3 of TS 29.510 [56])\nValidity Period\t3 years or less\nSignature \tSee clause 6.1.1 for the list of supported signature algorithms.\nSubject Public Key Info \tSee clause 6.1.1 for the list of supported public key types.\nExtensions\tOID\tMandatory\tCriticality\tValue\nkeyUsage\t{id-ce 15}\tTRUE\tTRUE\tdigitalSignature for TLS clients and servers\n\t\t\t\tkeyEncipherment for TLS 1.2 [54] servers\tNF that may be both TLS 1.2 [54] client and server shall have both flags set.\nextendedKeyUsage\t{id-ce 37}\tTRUE\tFALSE\tid-kp-clientAuth TLS clients \n\t\t\t\tid-kp-serverAuth for TLS servers  \tNF that may be both client and server shall have both OIDs set.\nauthorityKeyIdentifier\t{id-ce 35}\tTRUE\tFALSE\tThis shall be the same as subjectKeyIdentifier of the Issuer\u2019s certificate. CA shall utilitize the method (1) as defined in clause 4.2.1.2 of RFC 5280 [14] to generate the value for this extension.\nsubjectKeyIdentifier\t{id-ce 14}\tFALSE\tFALSE\tThis shall be calculated by the issuing CA utilitizing the method (1) as defined in clause 4.2.1.2 of RFC 5280 [14] to generate the value for this extension.\ncRLDistributionPoint\t{id-ce 31}\tTRUE\tFALSE\tdistributionPoint\tAc cording to RFC 5280 [14] this indicates if the CRL is available for retrieval using access protocol and location with LDAP or HTTP URI.\nsubjectAltName\t{id-ce 17}\tTRUE\tTRUE\tMultiple subjectAltName entries can be used as a sequence, see below for the detailed instructions.\nauthorityInfoAccess\t{id-pe 1}\tFALSE\tFALSE\tid-ad-caIssuers\tAccording to RFC 5280 [14] id-ad-caIssuers describes the referenced description server and the access protocol and location, for example, using one or multiple HTTP and/or LDAP URIs. \n\t\t\t\tid-ad-ocsp\tAccording to RFC 5280 [14] id-ad-ocsp defines the location of the OCSP responder using HTTP URI.\nTLS feature extension\t{id-pe 24}\tFALSE\tFALSE\tid-pe-tlsfeature\tThis can be used according to RFC 7633 [53] to prevent downgrade attacks that are not otherwise prevented by the TLS protocol; also to be used with OCSP stapling with TLS server end-entity certificates.\n\nWith (intra-domain) SBA, the following rules are applied:\n-\tsubjectAltName should (in TLS client and server certificates) contain URI for the NF Instance ID as an URN; this URI-ID shall contain the nfInstanceID of the Network Function instance using the format of the NFInstanceId as described in clause 5.3.2 of TS 29.571 [57].\n-\tsubjectAltName should (in TLS server certificates) contain HTTPS URI(s) for the apiRoot of a Network Function producer instance for the NF service API(s) that it provides; using wildcard URIs should be avoided;\n-\tsubjectAltName should (in TLS server certificates) contain HTTPS URI(s) for the apiRoot of a Network Function consumer instance for the NF service callback URI(s) that it provides; using wildcard URIs should be avoided;\n-\tsubjectAltName should (in TLS client certificates) or shall (for TLS server certificates) contain FQDN (host DNS name) for the Network Function instance, for example, using the instructions for Network Function (host DNS) names in FQDN format as used for Network Function producers in NFProfile and/or in NFService profile according to clause 6.1.6.2 in TS 29.510 [56], and in general as described in clause 28.3 of TS 23.003 [55] (regardless if DNS is available or not); for AMF, this is the AMF Name as described in clause 28.3.2.5 of TS 23.003 [55]; for NRF, this is the NRF FQDN as described in clause 28.3.2.3.2 of TS 23.003 [55]; the rules for using wildcard certificates in DNS-ID are defined in RFC 6125 [51].\nNOTE: RFC 7540 [50] mandates using the Server Name Indication (SNI) extension to TLS with HTTP/2. RFC 6066 [51], which is applicable to TLS 1.2, defines that currently only server names supported in SNI extension to TLS are DNS hostnames where \"HostName\" contains the fully qualified DNS hostname (FQDN) of the TLS server. RFC 6066 [51] also defines that literal IPv4 and IPv6 addresses are not permitted in \"HostName\". In practice, this means that at least one subjectAltName attribute with FQDN is to be included in server-side TLS end-entity certificates. \n-\tsubjectAltName shall not contain only IP address in TLS server certificates;\nEditor\u2019s Note: It is ffs whether subjectAltName contains URI for the NF Instance ID mandatory or optional in the TLS client and server certificates.\n\n\n\n************ END OF CHANGES\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFor authentication to be successful in direct communication scenarios between NFs and NRF as well as between NFs, the identity of the client and/or server must be present in the TLS certifcate being used. This can only be possible, when the NF Instance ID is made mandatory in the subjectAltName. But current specification states it as a recommendation \u201cshould\u201d. To avoid backward compatibility with Rel-15, the \u201cshould\u201d is fine. But it is proposed to add a conditional mandatory statement to address this use case.\n\n>>> SUMMARY OF CHANGE\nText modified in the clause 6.1.3c.3 according to reason for change and removal of editor\u2019s note to allow full authentication of NFs in direct communication.\n\n>>> CONSEQUENCES IF NOT REVISED\nNF consumer identity not present in the TLS certificate to facilitate authentication in the direct communication."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n4.4.2\tHandling of 5G NAS security contexts\n4.4.2.1\tGeneral\nThe security parameters for authentication, integrity protection and ciphering are tied together in a 5G NAS security context and identified by a key set identifier (ngKSI). The relationship between the security parameters is defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nBefore security can be activated, the AMF and the UE need to establish a 5G NAS security context. Usually, the 5G NAS security context is created as the result of a primary authentication and key agreement procedure between the AMF and the UE. A new 5G NAS security context may also be created during an N1 mode to N1 mode handover. Alternatively, during inter-system change from S1 mode to N1 mode, the AMF not supporting interworking without N26 and the UE operating in single-registration mode may derive a mapped 5G NAS security context from an EPS security context that has been established while the UE was in S1 mode.\nThe 5G NAS security context is taken into use by the UE and the AMF, when the AMF initiates a security mode control procedure, during an N1 mode to N1 mode handover, or during the inter-system change procedure from S1 mode to N1 mode. The 5G NAS security context which has been taken into use by the network most recently is called current 5G NAS security context. This current 5G NAS security context can be of type native or mapped, i.e. originating from a native 5G NAS security context or mapped 5G NAS security context.\nThe key set identifier ngKSI is assigned by the AMF either during the primary authentication and key agreement procedure or, for the mapped 5G NAS security context, during the inter-system change. The ngKSI consists of a value and a type of security context parameter indicating whether a 5G NAS security context is a native 5G NAS security context or a mapped 5G NAS security context. When the 5G NAS security context is a native 5G NAS security context, the ngKSI has the value of KSIAMF, and when the current 5G NAS security context is of type mapped, the ngKSI has the value of KSIASME.\nThe 5G NAS security context which is indicated by an ngKSI can be taken into use to establish the secure exchange of NAS messages when a new N1 NAS signalling connection is established without executing a new primary authentication and key agreement procedure (see subclause\u00a05.4.1) or when the AMF initiates a security mode control procedure. For this purpose, the initial NAS messages (i.e. REGISTRATION REQUEST, DEREGISTRATION REQUEST, SERVICE REQUEST and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an ngKSI in the NAS key set identifier IE indicating the current 5G NAS security context used to integrity protect the NAS message.\nIn the present document, when the UE is required to delete an ngKSI, the UE shall set the ngKSI to the value \"no key is available\" and consider also the associated keys KAMF or K'AMF, 5G NAS ciphering key and 5G NAS integrity key invalid (i.e. the 5G NAS security context associated with the ngKSI as no longer valid).\nNOTE:\tIn some specifications the term ciphering key sequence number might be used instead of the term key set identifier (KSI).\nAs described in subclause\u00a04.8 in order to interwork with E-UTRAN connected to EPC, the UE supporting both S1 mode and N1 mode can operate in either single-registration mode or dual-registration mode. A UE operating in dual-registration mode shall independently maintain and use both EPS security context (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and 5G NAS security context. When the UE operating in dual-registration mode performs an EPS attach procedure, it shall take into use an EPS security context and follow the handling of this security context as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15]. However, when the UE operating in dual-registration mode performs an initial registration procedure, it shall take into use a 5G NAS security context and follow the handling of this security context as described in the present specification.\nThe UE and the AMF need to be able to maintain two 5G NAS security contexts simultaneously, i.e. a current 5G NAS security context and a non-current 5G NAS security context, since:\na)\tafter a 5G re-authentication, the UE and the AMF can have both a current 5G NAS security context and a non-current 5G NAS security context which has not yet been taken into use (i.e. a partial native 5G NAS security context); and\nb)\tafter an inter-system change from S1 mode to N1 mode, the UE and the AMF can have both a mapped 5G NAS security context, which is the current 5G NAS security context, and a non-current native 5G NAS security context that was created during a previous access in N1 mode.\nThe number of 5G NAS security contexts that need to be maintained simultaneously by the UE and the AMF is limited by the following requirements:\na)\tafter a successful 5G (re-)authentication, which creates a new partial native 5G NAS security context, the AMF and the UE shall delete the non-current 5G NAS security context, if any;\nb)\twhen a partial native 5G NAS security context is taken into use through a security mode control procedure, the AMF and the UE shall delete the previously current 5G NAS security context;\n\n\nc)\twhen the AMF and the UE create a 5G NAS security context using \"null integrity protection algorithm\" and \"null ciphering algorithm\" during an initial registration procedure for emergency services, or a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session (see subclause\u00a05.4.2.2), the AMF and the UE shall delete the previous current 5G NAS security context;\nd)\twhen a new mapped 5G NAS security context or 5G NAS security context created using \"null integrity protection algorithm\" and \"null ciphering algorithm\" is taken into use during the inter-system change from S1 mode to N1 mode, the AMF and the UE shall not delete the previously current native 5G NAS security context, if any. Instead, the previously current native 5G NAS security context shall become a non-current native 5G NAS security context, and the AMF and the UE shall delete any partial native 5G NAS security context;\n\tIf no previously current native 5G NAS security context exists, the AMF and the UE shall not delete the partial native 5G NAS security context, if any;\ne)\twhen the AMF and the UE derive a new mapped 5G NAS security context during inter-system change from S1 mode to N1 mode, the AMF and the UE shall delete any existing current mapped 5G NAS security context;\nf)\twhen a non-current full native 5G NAS security context is taken into use by a security mode control procedure, then the AMF and the UE shall delete the previously current mapped 5G NAS security context;\ng)\twhen the UE or the AMF moves from 5GMM-REGISTERED to 5GMM-DEREGISTERED state, if the current 5G NAS security context is a mapped 5G NAS security context and a non-current full native 5G NAS security context exists, then the non-current 5G NAS security context shall become the current 5G NAS security context. Furthermore, the UE and the AMF shall delete any mapped 5G NAS security context or partial native 5G NAS security context.\nh)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from N1 mode to S1 mode:\n1)\tif the UE has a mapped 5G NAS security context and the inter-system change is performed in:\ni)\t5GMM-IDLE mode, the UE shall delete the mapped 5G NAS security context after the successful completion of the tracking area update procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]); or\nii)\t5GMM-CONNECTED mode, the UE shall delete the mapped 5G NAS security context after the completion of the inter-system change; and\ni)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has a non-current full native 5G NAS security context, then the UE shall make the non-current full native 5G NAS security context as the current native 5G NAS security context. The UE shall delete the mapped 5G NAS security context, if any.\nThe UE shall mark the 5G NAS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an initial registration procedure as described in subclause\u00a05.5.1.2 or when the UE leaves state 5GMM-DEREGISTERED for any other state except 5GMM-NULL.\nThe UE shall store the current native 5G NAS security context as specified in annex\u00a0C and mark it as valid only when the UE enters state 5GMM-DEREGISTERED from any other state except 5GMM-NULL or when the UE aborts the initial registration procedure without having left 5GMM-DEREGISTERED.\n\n***** Next change *****\n4.4.2.5\tEstablishment of secure exchange of NAS messages\nSecure exchange of NAS messages via a NAS signalling connection is usually established by the AMF during the registration procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the AMF are sent integrity protected using the current 5G security algorithms, and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered using the current 5G security algorithms.\nDuring inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, secure exchange of NAS messages is established between the AMF and the UE by:\na)\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system change in 5GMM-CONNECTED mode (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The UE uses these parameters to generate the mapped 5G NAS security context (see subclause\u00a08.6.2 of 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tafter the inter-system change in 5GMM-CONNECTED mode, the transmission of a REGISTRATION REQUEST message from the UE to the AMF. The UE shall send this message integrity protected using the mapped 5G NAS security context and further protect this message as specified in subclause\u00a04.4.6 and subclause\u00a05.5.1.3.2. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected using the mapped 5G NAS security context, and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered using the mapped 5G NAS security context.\nDuring inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE is operating in single-registration mode and:\na)\tif the UE has a valid native 5G NAS security context, the UE shall transmit a REGISTRATION REQUEST message integrity protected with the native 5G NAS security context. The UE shall include the ngKSI indicating the native 5G NAS security context value in the REGISTRATION REQUEST message.\n\tAfter receiving the REGISTRATION REQUEST message including the ngKSI indicating a native 5G NAS security context value, the AMF shall check whether the ngKSI included in the REGISTRATION REQUEST message belongs to a 5G NAS security context available in the AMF, and shall verify the MAC of the REGISTRATION REQUEST message. If the verification is successful, the AMF deletes the EPS security context received from the source MME if any, and the AMF re-establishes the secure exchange of NAS messages by either:\n1)\treplying with a REGISTRATION ACCEPT message that is integrity protected and ciphered using the native 5G NAS security context. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered; or\n2)\tinitiating a security mode control procedure. This can be used by the AMF to take a non-current 5G NAS security context into use or to modify the current 5G NAS security context by selecting new NAS security algorithms.\nb)\tif the UE has no valid native 5G NAS security context, the UE shall send the REGISTRATION REQUEST message without integrity protection and encryption.\n\tAfter receiving the REGISTRATION REQUEST message without integrity protection and encryption:\n1)\tif N26 interface is supported:\ni)\tif an EPS security context received from the source MME does not include the NAS security algorithms set to EIA0 and EEA0, the AMF shall either create a fresh mapped 5G NAS security context (see subclause\u00a08.6.2 of 3GPP\u00a0TS\u00a033.501\u00a0[24]) or trigger a primary authentication and key agreement procedure to create a fresh native 5G NAS security context; or\nii)\tif an EPS security context received from the source MME includes the NAS security algorithms set to EIA0 and EEA0, the AMF shall trigger a primary authentication and key agreement procedure to create a fresh native 5G NAS security context; or\n2)\tif N26 interface is not supported, the AMF shall trigger a primary authentication and key agreement procedure.\n\tThe newly created 5G NAS security context is taken into use by initiating a security mode control procedure and this context becomes the current 5G NAS security context in both the UE and the AMF. This re-establishes the secure exchange of NAS messages.\nDuring an N1 mode to N1 mode handover, secure exchange of NAS messages is established between the AMF and the UE by:\n-\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the target AMF to the UE triggering the N1 mode to N1 mode handover (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The UE uses these parameters to create a new 5G NAS security context.\nThe secure exchange of NAS messages shall be continued after N1 mode to N1 mode handover. It is terminated after inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode or when the NAS signalling connection is released.\nWhen a UE in 5GMM-IDLE mode establishes a new NAS signalling connection and has a valid current 5G NAS security context, the UE shall transmit the initial NAS message integrity protected with the current 5G NAS security context and further protect this message as specified in subclause\u00a04.4.6. The UE shall include the ngKSI indicating the current 5G NAS security context value in the initial NAS message. The AMF shall check whether the ngKSI included in the initial NAS message belongs to a 5G NAS security context available in the AMF, and shall verify the MAC of the NAS message. If the verification is successful, the AMF may re-establish the secure exchange of NAS messages:\na)\tby replying with a NAS message that is integrity protected and ciphered using the current 5G NAS security context. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered; or\nb)\tby initiating a security mode control procedure. This can be used by the AMF to take a non-current 5G NAS security context into use or to modify the current 5G NAS security context by selecting new NAS security algorithms.\n\n\n***** Next change *****\nStorage of 5GMM information\nC.1\tStorage of 5GMM information for UEs not operating in SNPN access operation mode\nThe following 5GMM parameters shall be stored on the USIM if the corresponding file is present:\na)\t5G-GUTI;\nb)\tlast visited registered TAI;\nc)\t5GS update status;\nd)\t5G NAS security context parameters from a full native 5G NAS security context (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\ne)\tSOR counter (see subclause\u00a09.11.3.51); and\nf) \tUE parameter update counter (see subclause\u00a09.11.3.53A).\nThe presence and format of corresponding files on the USIM is specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nIf the corresponding file is not present on the USIM, these 5GMM parameters are stored in a non-volatile memory in the ME together with the SUPI from the USIM. These 5GMM parameters can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory; else the UE shall delete the 5GMM parameters.\nThe following 5GMM parameters shall be stored in a non-volatile memory in the ME together with the SUPI from the USIM:\n-\tconfigured NSSAI(s);\n-\tNSSAI inclusion mode(s);\n-\tMPS indicator;\n-\tMCS indicator;\n-\toperator-defined access category definitions;\n-\tnetwork-assigned UE radio capability IDs; and\n-\t\"CAG information list\", if the UE supports CAG.\nEach configured NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. The UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the configured NSSAI for the current PLMN and any necessary mapped S-NSSAI(s). The configured NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the configured NSSAI(s).\nEach NSSAI inclusion mode is associated with a PLMN identity and access type. The NSSAI inclusion mode(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the NSSAI inclusion mode(s).\nThe MPS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MPS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MPS indicator.\nThe MCS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MCS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MCS indicator.\nOperator-defined access category definitions are stored together with a PLMN identity of the PLMN that provided them, and is valid in that PLMN or equivalent PLMN. The operator-defined access category definitions can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the operator-defined access category definitions. The maximum number of stored operator-defined access category definitions is UE implementation dependent.\nEach network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).\nThe allowed NSSAI(s) can be stored in a non-volatile memory in the ME together with the SUPI from the USIM. Allowed NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. If the allowed NSSAI is stored, then the UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the allowed NSSAI for the serving PLMN and any necessary mapping of the allowed NSSAI for the serving PLMN to the S-NSSAI(s) of the HPLMN. The allowed NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the allowed NSSAI(s).\nIf the UE is registered for emergency services, the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is deregistered.\nIf the UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters 5GMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.\nThe \"CAG information list\" can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the \"CAG information list\".\n\n***** End of changes *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nBased on SA3\u2019s request in LS S3-203534, CT6 agreed Rel-16 CR 0913 to TS 31.102 (C6-210183) to enable storing two 5G NAS security contexts for both accesses for two different PLMNs in the USIM: a) the first 5G NAS security context to be associated with the 5G-GUTI of the current access and b) the second 5G NAS security context to be associated with the PLMND ID of the other access; derived from the 5G-GUTI of the other access.The NAS specification needs to be updated to handle the case when the UE has two 5G NAS security contexts for the same access.\n\n>>> SUMMARY OF CHANGE\nWhen the UE activates a new 5G security context for the same PLMN/access, the UE replaces the first 5G security context of that access stored in the USIMWhen the UE activates a new 5G security context for a different PLMN/access but the security context is associated with the 5G-GUTI of the other access, the UE moves the content of the first 5G security context in the USIM to the second 5G security context in the USIM and stores the new 5G security context in the first 5G security context in the USIMWhen the UE attempts registration in a new PLMN/access, the UE can check both 5G security contexts to determine the protection of the initial NAS message (as specified in subclause 6.3.2.2 in TS 33.501)Backward compatibility analysis:This CR only has UE impact and is backward compatible.\n\n>>> CONSEQUENCES IF NOT REVISED\nWhen the UE is registered over both accesses (i.e. 3GPP access and non-3GPP access) to two different PLMNs simultaneously, it will not be possible to store both NAS COUNT pairs (one pair for 3GPP access and another pair for non-3GPP access) for each NAS security context for each PLMN with which the UE is registered. This will lead to using the wrong NAS COUNTs in certain scenarios, which will lead to integrity protection failures."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\nStart of modification\n8.7.3\tS1 Setup \n8.7.3.1\tGeneral\nThe purpose of the S1 Setup procedure is to exchange application level data needed for the eNodeB and MME to interoperate correctly on the S1 interface. This procedure shall be the first S1AP procedure triggered after the TNL association has become operational. This procedure erases any existing application level configuration data in the two nodes and replaces it by the one received. This procedure also re-initialises the E-UTRAN S1AP UE-related contexts (if any) and erases all related signalling connections in the two nodes like a Reset procedure would do.  If either side of the SCTP association has experienced loss of S1-AP UE contexts, a RESET procedure may be executed following the S1 SETUP procedure. If the eNB or Home eNB initiating the S1 Setup procedure supports a CSG cell, the procedure shall report the CSG ID(s) of the supported CSGs.\n\nEnd of modification\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nLinking of reset of SCTP with S1-AP impacts implementation-specific procedures\n\n>>> SUMMARY OF CHANGE\nModify the procedures to de-link SCTP reset with S1-AP reset\n\n>>> CONSEQUENCES IF NOT REVISED\nImpact to critical applications like VoIP on eNB"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n*** First change ***\n7.5\tGET IDENTITY\n7.5.1\tCommand description\nThe function can be used in the following contexts:\n-\ta SUCI context, to retrieve the SUCI when \"SUCI calculation is to be performed by the USIM\".\nThe function is related to a particular USIM and shall not be executable unless the USIM application has been selected and activated, and the current directory is the USIM ADF or any subdirectory under this ADF and a successful PIN verification procedure has been performed (see clause 5).\nIf GET IDENTITY command is not supported by the UICC, then the status word '6D00' (Instruction code not supported or invalid) shall be returned.\n\n7.5.1.1\tSUCI context\nSUCI context shall be supported if \"SUCI calculation is to be performed by the USIM\" (i.e. Service n\u00b0124 and Service n\u00b0125 are \"available\").\nThe command returns the SUCI which is a privacy preserving identifier containing the concealed SUPI. The function is used in 5GS in the specific cases described in 3GPP\u00a0TS\u00a033.501 [105] prior to mutual authentication between the UE and the SN.\nThe SUCI returned is calculated as described in 3GPP\u00a0TS\u00a033.501 [105].\nFor the execution of the command, the following information shall be available in the USIM:\n-\tHome network identifier (i.e. MCC and MNC when SUPI Type is IMSI or domain name when SUPI Type is Network Specific Identifier, Global Line Identifier or Global Cable Identifier) (see NOTE).\n-\tRouting indicator (configured in EFRouting_Indicator).\n-\tHome network public key (see Note).\n-\tHome network public key identifier (see Note).\n-\tProtection scheme identifier (see Note).\n-\tSUPI.\nNOTE:\tProvision and storage of the information in the USIM when \"SUCI calculation is to be performed by the USIM\" (i.e. Service n\u00b0124 and Service n\u00b0125 are \"available\") is out of the scope of the specification.\nThe SUCI is designed for one-time use, however, the freshness and randomness of SUCI returned upon each call of the command depends on the protection scheme configured. There is the special case where the protection scheme used is null-scheme, in such case SUCI contains the non concealed SUPI.\nIf the home network public key is not provisioned in the USIM, the SUCI shall be calculated using the null-scheme irrespective of the protection scheme stored in the USIM.\nThe returned SUCI consists of the concatenation of the following information as described in 3GPP\u00a0TS\u00a023.003 [25]:\n-\tSUPI Type\n-\tHome network identifier (i.e. MCC and MNC when SUPI Type is IMSI or domain name when SUPI Type is Network Specific Identifier, Global Line Identifier or Global Cable Identifier).\n-\tRouting indicator.\n-\tProtection scheme identifier.\n-\tHome network public key identifier.\n-\tScheme output, resulting from the protection scheme profile, identified by the protection scheme identifier. The protection scheme profile shall be one of those defined in Annex C of 3GPP TS 33.501 [105] or one of those specified by the Home network.\nIf SUCI context is supported and:\n-\tService n\u00b0124 is not \"available\" or:\n-\t\"SUCI calculation is to be performed by the ME\" (i.e. Service n\u00b0124 is \"available\", and Service n\u00b0125 is not \"available\")\nthe status word '6985' (Conditions of use not satisfied) shall be returned\nEditor's Note: It is FFS to specify the behavior in case other parameters (e.g. Home network public key identifier, some necessary data is not provisioned) are not correctly configured\n\n\n\n()\n\n\n*** End of changes ***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nError handling procedure when SUCI is misconfigured (or depreciated) is not currently specified. Hence the specification needs to make room to specify an error Recover or SUCI fall back procedure before an OTA procedure can be applied.\n\n>>> SUMMARY OF CHANGE\nSpecifying a mechanism to recover incase identification fails, when there are other pre-configured Protection schemes available for recovery.\n\n>>> CONSEQUENCES IF NOT REVISED\nDevices can keep failing identification over 5G network incase first priority keys have expired, even though active lower priority Protection Schemes are already pre-configured in USIM. Such devices if located in 5G only coverage can remain in limited service if it has consitently failed to receive an OTA update. This gives flexibility to self recover to lower priority keys if pre-configured before an OTA update can be successfully performed."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nFirst Change\nO.1.4\tTLS integrity protection indicator\nFor REGISTER messages protected by TLS according to this Annex, the P-CSCF shall attach an appropriate indicator to the message when forwarding it to the S-CSCF. This indicator shall enable the S-CSCF to distinguish between protection by IPsec according to the main body or Annex M and protection by TLS according to this Annex. For more details on the use of this indicator cf. clause O.2.2. When a REGISTER message is not protected by TLS the P-CSCF shall not include any indication about integrity protection by TLS in the messages.\nNext Change\n\n\n\n\n\n\n\n\n\n\n\n\n\nNext Change\nP.1\tScope of this Annex\nThis Annex is meant to ensure that the same IMS core network entities can be used to support various authentication schemes defined for Common IMS. In this context, rules are developed how an xCSCF can decide from a registration request which authentication scheme to apply. If these rules are not adhered to compatibility problems may arise.\nThe following authentication schemes are taken into account in this Annex:\n-\tIMS AKA without and with NAT traversal;\n-\tGPRS-IMS-Bundled Authentication (GIBA);\n-\tNASS-IMS-bundled authentication (NBA);\n-\tSIP Digest;\n-\tTrusted Node Authentication (TNA).\nThese authentication schemes are specified in the following places:\n-\tIMS AKA without NAT traversal is specified in the main body of this specification;\n-\tIMS AKA with NAT traversal is specified in Annex M of this specification;\n-\tSIP Digest without TLS is specified in Annex N of this specification;\n-\tSIP Digest with TLS is specified in Annexes N and O of this specification; \n-\tNASS-IMS-bundled authentication is specified in Annex R of this specification;\n-\tGPRS-IMS-Bundled Authentication is specified in Annex T of this specification;\n-\tTrusted Node Authentication is specified in Annex U of this specification.\nNext Change\nP.3\tPCSCF procedure selection \nWhen the PCSCF receives a registration request it shall proceed as follows: \nThe P CSCF first checks for the presence of an Authorization header in the REGISTER request, and, if present, checks further for the presence of an \"integrity-protected\" flag within this header. If the flag is present in the message from the UE, it shall be removed.\nThe PCSCF shall then check whether the Security-Client header exists in the received REGISTER message:\nIf the REGISTER request contains a Security-Client header then, for an initial registration, the P-CSCF shall select the sec-mechanism and mode (cf. Annex H) from the corresponding parameters offered in the Security-Client header according to its priorities.\nIf the P-CSCF selects the sec-mechanism \"ipsec-3GPP\" and the mode \"trans\" it shall perform the steps required for IMS AKA without NAT traversal.\nIf the P-CSCF selects the sec-mechanism \"ipsec-3GPP\" and the mode \"UDP-enc-tun\" it shall perform the steps required for IMS AKA with NAT traversal.\nIf the P-CSCF selects the sec-mechanism \"tls\" it shall perform the steps required for SIP Digest with TLS.\nIf the REGISTER request does not contain a Security-Client header, or the P-CSCF does not select any sec-mechanism from the Security-Client header, then the P-CSCF shall behave as follows:\n\nIf the REGISTER request does not contain an Authorization header and was received over an access networks defined in 3GPP specifications then the PCSCF shall perform the steps required for GIBA. \nIf the REGISTER request was not received over a TISPAN NASS or 3GPP network then the PCSCF shall perform the steps required for SIP Digest without TLS.\nIf the REGISTER request was received over a TISPAN NASS access, then the PCSCF shall perform the steps required for NBA as well as the steps required for SIP Digest without TLS, unless it is configured to behave differently or the P-CSCF only supports either SIP Digest without TLS or NBA. If the NBA-related query from the P-CSCF to the TISPAN NASS fails the P-CSCF shall not continue to perform the NBA-related steps.\nFor a subsequent registration, the P-CSCF shall continue to use the selected mechanism.\nNOTE 1: Note that Annex N states that SIP Digest authentication shall not apply to access networks defined in 3GPP specifications. \nNOTE 2: The use of Authorization headers in IMS REGISTER requests is defined in TS 24.229 [8].\nNOTE 3: The inclusion of an Authorization header in a REGISTER request is optional for NBA and optional for SIP Digest. Therefore, when a REGISTER request is received over a TISPAN NASS the P-CSCF cannot know whether the request relates to SIP Digest or NBA unless it is configured to select one of the schemes according to certain criteria, e.g. IP address range. The steps required for SIP Digest and for NBA are not in contradiction. Rather, for NBA the P-CSCF needs to perform additional steps, namely an exchange with the TISPAN NASS and an inclusion of NASS location information in the REGISTER request, on top of the steps required for SIP Digest. \nA P-CSCF is said to be \u201cPANI-aware\u201d if it handles P-Access-Network-Info headers as follows:\nA \u201cPANI-aware\u201d PCSCF shall insert a P-Access-Network-Info header containing the \"network-provided\" parameter and remove any such header containing the \"network-provided\" parameter sent by the UE if the REGISTER request was received over a TISPAN NASS.\nA \u201cPANI-aware\u201d PCSCF may insert a P-Access-Network-Info header containing the \"network-provided\" parameter and shall remove any such header containing the \"network-provided\" parameter sent by the UE if the REGISTER request was not received over a TISPAN NASS.\nP-Access-Network-Info headers are used by the S-CSCF to distinguish REGISTER requests relating to GIBA from REGISTER requests relating to NBA and SIP Digest, which do not necessarily use an Authorization header in the initial REGISTER request, cf. Annex P.4.2 of this specification. This motivates the following rule:\nUnder the additional conditions that the REGISTER request contains no Authorization header and was received over an access network other than TISPAN NASS or 3GPP it is even mandatory for the PCSCF to insert a P-Access-Network-Info header containing the \"network-provided\" parameter.\nNOTE 4:\tFor the purposes of NBA, the P-CSCF includes NASS location information in the P-Access-Network-Info header. But, according to TS\u00a024.229\u00a0[8], the PCSCF handles any P-Access-Network-Info header included by the UE transparently, and, hence, an SCSCF could receive a P-Access-Network-Info header with false NASS location information inserted by the UE even when the access network is not a TISPAN NASS. This would negatively impact the security of NASS-IMS-bundled authentication. Therefore, the removal of a P-Access-Network-Info header with the \"network-provided\" parameter is mandated for PANI-aware P-CSCFs even when the access network is not a TISPAN NASS. \nHow the PCSCF knows the access network type of a specific network interface is implementation-dependent (e.g. it can know the access network type from different UE IP address ranges or by using different network interfaces for different access network types).\nNOTE 5:\tThe P-CSCF is not in the path for all authentication techniques. For example, for TNA the Trusted Node communicates directly with the I-CSCF.\nEnd of Change\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nResubmission of S3-120363.  Changes since last meeting (based on comments from SA3#67): * Ensured that the changes in Clause O does not changed current numbering and referencing from other specs.  Thereby, a new sub clause was created for this case in O.2.3. * Updated Annex P has been updated to also take into account the new TLS procedures.  After an analysis, it shows that only the P-CSCF procedures need to be enhanced.  The S-CSCF procedures will be the same as for Digest with TLS after Initial registration. During the common IMS work when introducing TLS for signaling security, it was decided to use the sec-agree for negotiation of TLS.  Additionally, it also required that the first REGISTER message will be sent unprotected. This was to some extent motivated as it was considered to be sent over fixed and cable access, which still could be considered as reasonably secure. From the past years deployment and discussions in other foras such as GSMA, it can be noted that IMS access over unsecure accesses are becoming more common, e.g., over public wireless access.  This also means that the possible privacy issues in respect to sending IMPI in an unprotected Register is increasing.  It is today a general practice for services accessing through unsecure network and internet to setup the TLS session before doing the authentication and sending any credentials. As a result, it is proposed to introduce the option where the UE is configured to use TLS before sending the Initial register and not using sec-agree.\n\n>>> SUMMARY OF CHANGE\nAdding the possibility for UE to use TLS for protection of initial IMS Register.\n\n>>> CONSEQUENCES IF NOT REVISED\nIMPI (and IMSI) may be sent in open making it possible for attackers on unsecure access to intercept."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n5.4.1.2.4.2\tEAP message reliable transport procedure initiation by the network\nIn order to initiate the EAP message reliable transport procedure, the AMF shall create an AUTHENTICATION REQUEST message.\nThe AMF shall set the EAP message IE of the AUTHENTICATION REQUEST message to the EAP-request message to be sent to the UE. The AMF shall set the ngKSI IE of the AUTHENTICATION REQUEST message to the ngKSI value selected in subclause\u00a05.4.1.2.2.2 or subclause\u00a05.4.1.2.3.1. In this release of specification, the AMF shall set the ABBA IE of the AUTHENTICATION REQUEST message  with the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause\u00a09.11.3.10.\n\n\n\nThe AMF shall send the AUTHENTICATION REQUEST message to the UE, and the AMF shall start timer T3560 (see example in figure\u00a05.4.1.2.4.2.1).\n\nFigure\u00a05.4.1.2.4.2.1: EAP message reliable transport procedure\nUpon receipt of an AUTHENTICATION REQUEST message with the EAP message IE, the UE handles the EAP message received in the EAP message IE and the ABBA of the AUTHENTICATION REQUEST message.\n\n***** Next change *****\n5.4.1.3.2\tAuthentication initiation by the network\nThe network may initiate a 5G AKA based primary authentication and key agreement procedure for a UE in 5GMM-CONNECTED mode at any time. For restrictions applicable after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode, see subclause\u00a05.4.1.2.3.\nThe network initiates the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3560 (see example in figure\u00a05.4.1.3.2.1). The AUTHENTICATION REQUEST message shall contain the parameters necessary to calculate the authentication response (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). This message shall include the ngKSI that will be used by the UE and AMF to identify the KAMF and the partial native security context that is created if the authentication is successful. This message shall also include the ABBA parameter. In this release of specification, the network shall set the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause\u00a09.11.3.10.\n\n\n\n\nIf an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall include a different ngKSI value in the AUTHENTICATION REQUEST message when it initiates a 5G AKA based primary authentication and key agreement procedure.\n\nFigure\u00a05.4.1.3.2.1: 5G AKA based primary authentication and key agreement procedure\n\n***** Next change *****\n9.11.3.10\tABBA\nThe purpose of the ABBA information element is to enable the bidding down protection of security features.\nThe ABBA information element is coded as shown in figure\u00a09.11.3.10.1 and table\u00a09.11.3.10.1.\nThe ABBA is a type 4 information element with a minimum length of 4 octets.\n8\t7\t6\t5\t4\t3\t2\t1\nABBA IEI\toctet 1\nLength of ABBA contents\toctet 2\n\tABBA contents\toctet 3\t\toctet n\nFigure\u00a09.11.3.10.1: ABBA information element\nTable\u00a09.11.3.10.1: ABBA information element\nABBA contents (octet 3-n):\tindicate set of security features defined for 5GS as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. \n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCT1 sent an LS to SA3 (see C1-191686) asking about the UE behavior when an ABBA parameter with a non-zero value, or with a length that is more than 2 octets, is received in Release 15.This document aims to specify the UE behavior for this case following the LS response from SA3.\n\n>>> SUMMARY OF CHANGE\nSpecify that in case the UE receives an ABBA parameter with - a length of more than 2 octets, - a non-zero valuethe UE shall use the ABBA as received from the network.Interoperability analysis1) UE compliant with the previous specification version with an AMF that is compliant with this CRIf the UE gets an ABBA parameter with a value that is different from 0000H, the UE will send a 5GMM STATUS message. However, the AMF already handles a 5GMM STATUS message.2) UE compliant with this CR with an AMF that is compliant with the previous specification versionIf the UE gets an ABBA parameter with a value that is different from 0000H, the UE will use the ABBA parameter as it is received. If for some reason the KAMF at the UE and the network is not the same, the integrity check fails during the security mode procedure. However, handling integrity check failures already exists and is not introduced by this CR. If the KAMF at the UE and the network is the same, then no errors will occur.This CR is backwards compatible.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE uses an ABBA that is different from what the network has used leading to security failure"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n******************** Start of 1st change *******************\nB.2.1.2\tStandard claims\nThese standard claims are defined by the OpenID Connect 1.0 specification and are REQUIRED for MCX implementation. Other claims defined by OpenID Connect are optional. The standards-based claims for an MC ID token are shown in table\u00a0B.2.1.2-1.\nTable B.2.1.2-1: ID token standard claims\nParameter\tDescription\niss\tREQUIRED. The URL of the IdM server.\nSub\tREQUIRED. A case-sensitive, never reassigned string (not to exceed 255 bytes), which uniquely identifies the MCX user within the MCX server provider\u2019s domain.\nAud\nexp\tREQUIRED. Implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew (not to exceed 30 seconds)\niat\tREQUIRED. Time at which the ID Token was issued. Its value is a JSON number representing the number of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.\n\n******************** End of 1st change *******************\n******************** Start of 2nd change *******************\nB.7.2\tToken Exchange Request\nIn order to obtain a security token, the MCX client makes a request to the primary authorization server's token endpoint by sending the following parameters using the \"application/x-www-form-urlencoded\" content-type and a character encoding of UTF-8 in the HTTP request entity-body. The standard parameters shown in table B.7.2-1 are required by the MCX Connect profile.\nTable B.7.2-1: Token Exchange Request standard required parameters\nParameter\tValues\ngrant_type\tREQUIRED. The value shall be set to \u201curn:ietf:params:oauth:grant-type:token-exchange\u201d\u00a0indicating that a token exchange is being performed.\n\nsubject_token\tREQUIRED. A token that represents the identity of the party on behalf of whom the request is being made. This shall be the access token previously obtained in the token response message (clause B.4.2.5) during authorisation (clause B.4). \nsubject_token_type\tREQUIRED. An identifier that indicates the type of the security token in the\u00a0subject_token\u00a0parameter. The value shall be set to \u201curn:ietf:params:oauth:token-type:jwt\u201d indicating the access token is a JSON Web Token.\n\nAn example of a successful token exchange request might look like:\nEXAMPLE:\nPOST /as/token.oauth2 HTTP/1.1\nHost: IdM.server.com:9031\nAuthorization: Basic cnA33hpsb25nABClY3VyZS1yYW5kb20tc2VjdnV0\nContent-Type: application/x-www-form-urlencoded\ngrant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange\n\n&subject_token=baaR3jcJyb4BWCxGsndq23ScbdFMogUC5Pb233jKLTC\n&subject_token_type=\nurn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token\n******************** End of 2nd change *******************\n******************** Start of 3rd change *******************\nB.7.4\tToken Request\nIn order to exchange the security token for an access token and (optional) refresh token, the MCX client makes a request to the partner authorization server's token endpoint by sending the following parameters using the \"application/x-www-form-urlencoded\" format, with a character encoding of UTF-8 in the HTTP request entity-body. Note that authentication of the security token is REQUIRED in order to exchange the security token for an access token. The security token shall be transported in the HTTP Authorization Header. The token request standard parameters are shown in table B.7.4-1.\nTable B.7.4-1: Token Request standard required parameters\nParameter\tValues\ngrant_type\tREQUIRED. This value shall be set to \"urn:ietf:params:oauth:grant-type:jwt-bearer\" as per rfc 7523 [46].\n\nclient_id\tREQUIRED. The identifier of the client making the API request. It shall match the value that was previously registered with the OAuth Provider during the client registration phase of deployment, or as provisioned via a development portal.\nscope\tREQUIRED. Scope values are expressed as a list of space-delimited, case-sensitive strings which indicate which MCX resource servers the client is requesting access to at the partner system (e.g. MCPTT group services, MCVideo group services, MCData group services, etc.). If authorized, the requested scope values will be bound to the access token returned to the client in the token exchange response message.  The scope shall include one or more of the following:\t\t\t-\t\"3gpp:mc:ptt_service\"\t\t-\t\"3gpp:mc:video_service\"\t\t-\t\"3gpp:mc:data_service\"\t\t-\t\"3gpp:mc:ptt_key_management_service\"\t\t-\t\"3gpp:mc:video_key_management_service\"\t\t-\t\"3gpp:mc:data_key_management_service\"\t\t-\t\"3gpp:mc:ptt_config_management_service\"\t\t-\t\"3gpp:mc:video_config_management_service\"\t\t-\t\"3gpp:mc:data_config_management_service\"\t\t-\t\"3gpp:mc:ptt_group_management_service\"\t\t-\t\"3gpp:mc:video_group_management_service\"\t\t-\t\"3gpp:mc:data_group_management_service\"\t\tOthers may be added in the future as new MCX resource servers are introduced by 3GPP.\n\nExamples of a successful token request might look like:\nEXAMPLE 1:\nPOST /as/token.oauth2 HTTP/1.1\nHost: IdM.server.com:9031\nCache-Control: no-cache\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer& \nclient_id=myNativeApp&\nscope=openid\u00a03gpp:mc:ptt_group_management_service&\n\nEXAMPLE 2:\nPOST /as/token.oauth2 HTTP/1.1\nHost: IdM.server.com:9031\nCache-Control: no-cache\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&\nclient_id=myNativeApp&\nscope=openid\u00a03gpp:mc:ptt_service,3gpp:mc:ptt_key_management_service,3gpp:mc:ptt_config_management_service,3gpp:mc:ptt_group_management_service&\n\n******************** End of 3rd change ******************\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently, the token request message carries the security token in the header.  However the OAuth 2.0 token exchange procedure specifies that the security token shall be carried in an \u201cassertion\u201d parameter within the token request message.In addition, it\u2019s also currently possible that a security token received by one IdMS could be replayed by that IdMS to another IdMS in an attempt to hijack services.  To protect from this, the address of the target IdMS is added as the resource field in the token exchange request message and then included in the audience field of the returned security token, thereby tying the security token to the target IdMS.\n\n>>> SUMMARY OF CHANGE\nAdd the \u201cassertion\u201d parameter to the token request message in B.7.4.Add the \u201cresource\u201d parameter to the token exchange request message.Expand the audience parameter in the ID Token (security token).\n\n>>> CONSEQUENCES IF NOT REVISED\nInteroperability may be lost without the \u201cassertion\u201d parameter in the token request message to properly transport the security token.  Replay of the security token by a rogue IdMS could be used to impersonate a user and hijack services."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nSTART OF FIRST CHANGE\n8.3\tBearer type change\nIn MR-DC, all the possible bearer type change options are supported:\n-\tMCG bearer to/from split bearer;\n-\tMCG bearer to/from SCG bearer;\n-\tSCG bearer to/from split bearer.\nBearer termination point change is supported for all bearer types, and can be performed with or without bearer type change:\n-\tMN terminated bearer to/from SN terminated bearer.\nFor MR-DC:\n-\twhen the security key is changed for a bearer, the associated PDCP and RLC entities are re-established, while MAC behavior might depend on the solution selected by the network, e.g. MAC reset, change of LCID, etc. (see Annex A);\n-\tfor MCG bearer, split bearer and SCG bearer, during MN security key change the MCG/SCG PDCP and RLC are re-established and MCG/SCG MAC is reset;\n-\tif a bearer type change happens together with MN security key change then for MCG bearer, split bearer and SCG bearer, the MCG/SCG PDCP and RLC are re-established and MCG/SCG MAC is reset;\n-\tif a bearer type change happens through SN change procedure, then SN terminated PDCP and SCG RLC are re-established and SCG MAC is reset. MCG RLC/MAC behavior depends on the solution selected by the network, see Annex A;\n-\tone step (direct) bearer type change between MN terminated bearer types without using the handover procedure is supported;\n-\tone step (direct) bearer type change between SN terminated bearer types without using the handover or SN change procedure is supported;\n-\tone step (direct) bearer type change from/to MN terminated bearer to/from SN terminated bearer without using the handover procedure is supported;\n-\tPDCP version change for DRB (only applicable for EN-DC) or PDCP SN length change for an AM DRB or RLC mode change for DRB is performed using a release and add of the DRBs (in a single message) or full configuration;\n-\tOne step (direct) bearer type change with PDCP version change (only applicable for EN-DC) is supported.\nNOTE 1:\tIn this clause the term \"handover\" refers to an E-UTRA handover or to an NR synchronous reconfiguration not necessarily implying a P(S)Cell change with or without security key change.\nNOTE 2:\tL2 handling for bearer type change in MR-DC is also summarized in Annex A (the table does not consider the cases that PDCP SN length is changed and avoiding reuse of COUNT).\nSTART OF SECOND CHANGE\nAnnex A (informative):\nLayer 2 handling for bearer type change\nThis clause provides for information an overview on L2 handling for bearer type change in MR-DC, with and without security key change, i.e. with and without a change of the termination point.\nTable A-1: L2 handling for bearer type change with and without security key change\nBearer type change from row\nto col\tMCG\tSplit\tSCG\n\tWith key change\n(change of termination point)\twith key change\n(change of termination point)\twith key change\n(change of termination point)\nMCG\tN/A\tPDCP:\tRe-establish\tMCG RLC:\tSee Note 1\tMCG MAC:\tSee Note 1\tSCG RLC:\tNo action\tSCG MAC:\tNo action\tPDCP: Reconfigure\tMCG RLC: No action\tMCG MAC: No action\tSCG RLC: Establish\tSCG MAC: Reconfigure\tPDCP:\tRe-establish\tMCG RLC:\tSee Note 1\tMCG MAC:\tSee Note 1\tSCG RLC:\tEstablish\tSCG MAC:\tReconfigure\tPDCP:\tRecovery\tMCG RLC:\tSee Note 3\tMCG MAC:\tReconfigure\tSCG RLC:\tEstablish\tSCG MAC:\tReconfigure\tPDCP:\tRe-establish\tMCG RLC:\tSee Note 3\tMCG MAC:\tReconfigure\tSCG RLC:\tEstablish\tSCG MAC:\tReconfigure\nSplit\tPDCP:\tRecovery\tMCG RLC:\tNo action\tMCG MAC:\tNo action\tSCG RLC:\tSee Note 4\tSCG MAC:\tReconfigure\tPDCP: \nRe-establish\tMCG RLC: See Note 1\tMCG MAC: See Note 1\tSCG RLC: See Note 4\tSCG MAC: Reconfigure\tN/A\tPDCP:\tRe-establish\tMCG RLC:\tSee Note 1\tMCG MAC:\tSee Note 1\tSCG RLC: \nSee Note 1\tSCG MAC: \nSee Note 1\tPDCP: Recovery\tMCG RLC:\tSee Note 3\tMCG MAC:\tReconfigure\tSCG RLC: \nNo action\tSCG MAC:\nNo action\tPDCP:\tRe-establish\tMCG RLC:\tSee Note 3\tMCG MAC:\tReconfigure\tSCG RLC: \nSee Note 1\tSCG MAC: \nSee Note 1\nSCG\tPDCP:\tRecovery\tMCG RLC: Establish\tMCG MAC: Reconfigure\tSCG RLC: See Note 4\tSCG MAC: Reconfigure\tPDCP:\tRe-establish\tMCG RLC:\tEstablish\tMCG MAC:\tReconfigure\tSCG RLC:\tSee Note 4\tSCG MAC:\tReconfigure\tPDCP:\tReconfigure\tMCG RLC: Establish\tMCG MAC: Reconfigure\tSCG RLC: No action\tSCG MAC: No action\tPDCP:\tRe-establish\tMCG RLC:\tEstablish\tMCG MAC:\tReconfigure\tSCG RLC:\tSee Note 1\tSCG MAC: \nSee Note 1\tN/A\tPDCP:\tRe-establish\tMCG RLC:\tNo action\tMCG MAC:\tNo action\tSCG RLC:\tSee Note 1\tSCG MAC:\tSee Note 1\n\nNOTE 1:\tFor EN-DC and NGEN-DC MCG, NE-DC SCG: the MAC/RLC behaviour depends on the solution selected by the network. It can be PCell handover (for EN-DC and NGEN-DC) or PSCell change (for NE-DC), which triggers MAC reset and RLC re-establishment. Alternatively, the logical channel identity can be changed, either via RLC bearer release and add for the same DRB (including RLC re-establishment), or via reconfiguration of the RLC bearer with RLC-re-establishment.\n\tFor EN-DC and NGEN-DC SCG, NE-DC MCG, NR-DC MCG and SCG: the MAC/RLC behaviour depends on the solution selected by the network. It can be reconfiguration with sync, with MAC reset and RLC re-establishment. Alternatively, the logical channel identity can be changed via RLC bearer release and add.\nNOTE 2:\tVoid\nNOTE 3:\tFor EN-DC and NGEN-DC: Re-establishment and release. For NE-DC and NR-DC: Release.\nNOTE 4:\tFor NE-DC: Re-establishment and release. For EN-DC, NGEN-DC and NR-DC: Release.\nEND OF CHANGES\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\n\u201cSecurity key change\u201d is used in a few cases to actually mean \u201cbearer termination point change\u201d, leading to the risk of misunderstanding and possibly wrong implementations.\n\n>>> SUMMARY OF CHANGE\nWhere applicable, it is clarified that a \u201cSecurity key change\u201d is due to a \u201cbearer termination point change\u201d.Impact analysisImpacted 5G architecture options: EN-DC, NGEN-DC, NE-DC, NR-DC \u00a0Impacted functionality:Bearer type changeInteroperability issue:No interoperability issues are foreseen.\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is a risk that \u201csecurity key change\u201d is interpreted with a wider meaning (i.e. whatever type of security key change) than intended (i.e. security key change due to a bearer termination point change) leading to possibly wrong implementations."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * * First Change * * * *\n5.3.1.2\tRelease of the NAS signalling connection\nThe signalling procedure for the release of the NAS signalling connection is initiated by the network.\nIn S1 mode, when the RRC connection has been released, the UE shall enter EMM-IDLE mode and consider the NAS signalling connection released.\nIf the UE receives the \"Extended wait time\" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, the UE shall ignore the \"Extended wait time\".\nTo allow the network to release the NAS signalling connection, the UE shall start the timer T3440 in the following cases:\na)\tthe UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15 or #35;\nb)\tthe UE receives a TRACKING AREA UPDATE ACCEPT message and the UE has not set the \"active\" flag in the TRACKING AREA UPDATE REQUEST message, the tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode and the user plane radio bearers have not been set up;\nc)\tthe UE receives a DETACH ACCEPT message and the UE has set the detach type to \"IMSI detach\" in the DETACH REQUEST message and user plane radio bearers have not been set up;\nd)\tthe UE receives a TRACKING AREA UPDATE REJECT message indicating any of the EMM cause values #9, #10 or #40; or\ne)\tthe UE receives a SERVICE REJECT message indicating any of the EMM cause values #9, #10 or #40 as a response to a SERVICE REQUEST message  or an EXTENDED SERVICE REQUEST message with service type set to \"packet services via S1\".\nUpon expiry of T3440,\n-\tin cases a, b and c, the UE shall locally release the established NAS signalling connection; or\n-\tin cases d and e, the UE shall locally release the established NAS signalling connection and the UE shall initiate the attach procedure as described in subclause\u00a05.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.\nIn cases b and c,\n-\tupon an indication from the lower layers that the user plane radio bearers are set up, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, the UE shall send the uplink signalling via the existing NAS signalling connection; or\n-\tupon receipt of a DETACH REQUEST message, the UE shall stop timer T3440 and respond to the network initiated detach as specified in subclause\u00a05.5.2.3.\nIn case b,\nupon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the timer T3440 to expire or be stopped before proceeding; or\nupon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause\u00a05.6.1.\nIn cases d and e, \n-\tupon an indication from the lower layers that the RRC connection has been released, the UE shall stop timer T3440 and perform a new attach procedure as specified in subclause\u00a05.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.\nIn S101 mode, when the cdma2000\u00ae HRPD radio access connection has been released, the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released.\n\n* * * * Next Change * * * *\n10.2\tTimers of EPS mobility management\nTable 10.2.1: EPS mobility management timers \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3402\tDefault 12 min.\tNOTE\u00a01\tEMM-DEREGISTERED\tEMM-REGISTERED\tAt attach failure and the attempt counter is equal to 5.\tAt tracking area updating failure and the attempt counter is equal to 5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tInitiation of the attach procedure, if still required or TAU procedure\nT3410\t15s\tEMM-REGISTERED-INITIATED\tATTACH REQUEST sent\tATTACH ACCEPT received\tATTACH REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.1.2.6\nT3411\t10s\tEMM-DEREGISTERED. ATTEMPTING-TO-ATTACH\t\tEMM-REGISTERED. ATTEMPTING-TO-UPDATE\t\tEMM-REGISTERED. NORMAL-SERVICE\tAt attach failure due to lower layer failure, T3410 timeout or attach rejected with other EMM cause values than those treated in subclause\u00a05.5.1.2.5.\t\tAt tracking area updating failure due to lower layer failure, T3430 timeout or TAU rejected with other EMM cause values than those treated in subclause\u00a05.5.3.2.5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tEMM-CONNECTED mode entered (NOTE\u00a06)\tRetransmission of the ATTACH REQUEST, if still required as described in subclause\u00a05.5.1.2.6 or retransmission of TRACKING AREA UPDATE REQUEST\nT3412\tDefault 54 min.\tNOTE\u00a02\tNOTE\u00a05\tEMM-REGISTERED\tIn EMM-REGISTERED, when EMM-CONNECTED mode is left.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode. \tInitiation of the periodic TAU procedure if the UE is not attached for emergency bearer services.\t\tImplicit detach from network if the UE is attached for emergency bearer services.\nT3416\t30s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tRAND and RES stored as a result of an EPS authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tTRACKING AREA UPDATE ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\tEMM-DEREGISTERED, EMM-NULL or\tEMM-IDLE mode entered\tDelete the stored RAND and RES\nT3417\t5s\tEMM-SERVICE-REQUEST-INITIATED\tSERVICE REQUEST sent\tEXTENDED SERVICE REQUEST sent in case f, g, i and j in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent with service type set to \u201cpacket services via S1\u201d in case a, b, c, h and k in subclause 5.6.1.1\tBearers have been set up\tSERVICE REJECT received\tAbort the procedure\nT3417ext\t10s\tEMM-SERVICE-REQUEST-INITIATED\tEXTENDED SERVICE REQUEST sent in case d in subclause\u00a05.6.1.1\tEXTENDED SERVICE REQUEST sent in case e in subclause\u00a05.6.1.1 and the CSFB response was set to \"CS fallback accepted by the UE\"\tInter-system change from S1 mode to A/Gb mode or Iu mode is completed\tInter-system change from S1 mode to A/Gb mode or Iu mode is failed\tSERVICE REJECT received\tSelect GERAN or UTRAN if EXTENDED SERVICE REQUEST was sent due to mobile originated CS fallback. Otherwise, abort the procedure.\nT3418\t20s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (EMM cause = #20 \"MAC failure\" or #26 \"non-EPS authentication unacceptable\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3420\t15s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (cause = #21 \"synch failure\") sent\tAUTHENTICATION REQUEST received or AUTHENTICATION REJECT received\tor\tSECURITY MODE COMMAND received\t\tOn first expiry, the UE should consider the network as false and follow item f of subclause\u00a05.4.2.7, if the UE is not attached for emergency bearer services.\t\tOn first expiry, the UE will follow subclause\u00a05.4.2.7 under \"For items\u00a0c, d, and e:\", if the UE is attached for emergency bearer services.\nT3421\t15s\tEMM-DEREGISTERED-INITIATED\tEMM-\nREGISTERED.\nIMSI-DETACH-\nINITIATED\tDETACH REQUEST sent with \tthe Detach type IE not indicating \"switch off\"\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3423\tNOTE\u00a03\tEMM-REGISTERED\tT3412 expires while ISR is activated and the UE is in one of the following states:\t- EMM-REGISTERED.NO-CELL-AVAILABLE ;\t- EMM-REGISTERED.PLMN-SEARCH; \t-EMM-REGISTERED-UPDATE-NEEDED; or\t-EMM-REGISTERED.LIMITED-SERVICE.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode.\tSet TIN to \"PTMSI\".\tFor A/Gb mode or Iu mode, see 3GPP\u00a0TS\u00a024.008\u00a0[13]\nT3430\t15s\tEMM-TRACKING-AREA-UPDATING-INITIATED\tTRACKING AREA UPDATE REQUEST sent\tTRACKING AREA UPDATE ACCEPT received\tTRACKING AREA UPDATE REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.3.2.6\nT3440\t10s\tEMM-REGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tEMM-REGISTERED\tTRACKING AREA UPDATE ACCEPT received after the UE sent TRACKING AREA UPDATE REQUEST in EMM-IDLE mode with no \"active\" flag and the user-plane radio bearers have not been setup\tDETACH ACCEPT received after the UE sent DETACH REQUEST with detach type to \"IMSI detach\"\tNAS signalling connection released\tBearers have been set up or a request for PDN connection for emergency bearer services or a CS emergency call is started\tRelease the NAS signalling connection for the cases a), b) and c) as described in subclause\u00a05.3.1.2\n\t\tEMM-DEREGISTERED\tEMM-DEREGISTERED.NORMAL-SERVICE\tTRACKING AREA UPDATE REJECT, SERVICE REJECT with any of the EMM cause #9, #10 or #40\tNAS signalling connection released\t\tRelease the NAS signalling connection for the cases d) and e) as described in subclause\u00a0 5.3.1.2 and initiation of the attach procedure as specified in subclause\u00a05.5.3.2.5, 5.5.3.3.5 or 5.6.1.5 \nT3442\tNOTE\u00a04\tEMM-REGISTERED\tSERVICE REJECT received with EMM cause #39 \"CS service temporarily not available\" with a non-zero T3442 value\tTRACKING AREA UPDATE REQUEST sent\tNone\nNOTE\u00a01:\tThe cases in which the default value of this timer is used are described in subclause\u00a05.3.6.\tNOTE\u00a02:\tThe value of this timer is provided by the network operator during the attach and tracking area updating procedures.\tNOTE\u00a03:\tThe value of this timer may be provided by the network in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. The default value of this timer is identical to the value of T3412.\tNOTE\u00a04:\tThe value of this timer is provided by the network operator when a service request for CS fallback is rejected by the network with EMM cause #39 \"CS service temporarily not available\".\tNOTE\u00a05:\tThe default value of this timer is used if the network does not indicate a value in the TRACKING AREA UPDATE ACCEPT message and the UE does not have a stored value for this timer.\tNOTE\u00a06:\tThe conditions for which this applies are described in subclause\u00a05.5.3.2.6.\n\nTable 10.2.2: EPS mobility management timers \u2013 network side\nTIMER NUM.\tTIMER VALUE\tSTATE \tCAUSE OF START\tNORMAL STOP\tON THE\n1st, 2nd, 3rd, 4th EXPIRY (NOTE\u00a01)\nT3413\tNOTE\u00a02\tEMM-REGISTERED\tPaging procedure for EPS services initiated\tPaging procedure for EPS services completed\tNetwork dependent\nT3422\t6s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3450\t6s\tEMM-COMMON-PROC-INIT\tATTACH ACCEPT sent\t\tTRACKING AREA UPDATE ACCEPT sent with GUTI\t\tTRACKING AREA UPDATE ACCEPT sent with TMSI\t\tGUTI REALLOCATION COMMAND sent\tATTACH COMPLETE received\tTRACKING AREA UPDATE COMPLETE received\tGUTI REALLOCATION COMPLETE received\tRetransmission of the same message type, i.e. ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT or GUTI REALLOCATION COMMAND\nT3460\t6s\tEMM-COMMON-PROC-INIT\tAUTHENTICATION REQUEST sent\t\tSECURITY MODE COMMAND sent\tAUTHENTICATION RESPONSE received\tAUTHENTICATION FAILURE received\tSECURITY MODE COMPLETE received\tSECURITY MODE REJECT received\tRetransmission of the same message type, i.e. AUTHENTICATION REQUEST\tor SECURITY MODE COMMAND\nT3470\t6s\tEMM-COMMON-PROC-INIT\tIDENTITY REQUEST sent\tIDENTITY RESPONSE received\tRetransmission of IDENTITY REQUEST\nMobile reachable\tNOTE 4\tAll except EMM-DEREGISTERED\tEntering EMM-IDLE mode\tNAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry if the UE is not attached for emergency bearer services.\t\tImplicitly detach the UE which is attached for emergency bearer services.\nImplicit detach timer\tNOTE 3\tAll except EMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in EMM-IDLE mode \tNAS signalling connection established\tImplicitly detach the UE on 1st expiry\nNOTE\u00a01:\tTypically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding procedure description.\tNOTE\u00a02:\tThe value of this timer is network dependent.\tNOTE\u00a03:\tThe value of this timer is network dependent. If ISR is activated, the default value of this timer is 4 minutes greater than T3423.\tNOTE\u00a04:\tThe default value of this timer is 4 minutes greater than T3412. If T3346 is larger than T3412 and the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or SERVICE REJECT message, the value of the Mobile reachable timer is 4 minutes greater than T3346. If the UE is attached for emergency bearer services, the value of this timer is set equal to T3412. \n\n\n\n* * * * End of Change * * * *\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe timer T3440 allows the network to release the NAS signalling connection and also the UE to locally release the established NAS signalling connection. There are other cause values which are also good candidates for acting as trigger to initiate timer T3440.Some of these cause values are; Cause #7 \u2013 EPS services not allowedCause #8 \u2013 EPS services and non-EPS services not allowedCause #22 \u2013 Congestion and Cause #25 \u2013 Not authorized for this CSG. In case of cause value #7 (EPS services not allowed) and cause value #8 (EPS services and non-EPS services not allowed) the UE\u2019s behaviour on receipt of these cause values is similar to that for cause value #14 (EPS services not allowed in this PLMN) for which timer T3440 is already triggered. Starting timer T3440 allows the UE to release the connection in a timely manner as opposed to either releasing it immediately or waiting for release from network, which could take a very long time, thus leading to bad user experience. Note that even after receipt of cause value #7 or #8 the UE is still allowed to initiate an attach for emergency bearer services, and for this it might be necessary to select a different PLMN.In case of cause value #22 (Congestion) the network is congested and hence may be too busy to even release the NAS signalling connection. If timer T3440 is not initiated, the UE may possibly never release the RRC connection or release it after a very long time (when network gets a chance to release it) and could be be stuck in connected mode for a very long time, thus leading to bad user experience. The cause value #25 (Not authorized for this CSG) is sent to UE in a CSG cell with CSG ID where the UE either has no subscription to operate or the UE\u2019s subscription has expired. The UE enters the state EMM-REGISTERED.LIMITED-SERVICE and needs to find another cell in the same PLMN or an equivalent PLMN according to 3GPP TS 36.304. If the network does not initiate the connection release procedure, then it could take very long for the UE to perform cell selection thus leading to detrimental user experience. Since CSG cells can be set up by anybody, there is also a higher risk that the UE might be caught by a \"malicious H(e)NB\".Hence, it is proposed to add the cause values #7, #8, #22 and #25 as a trigger for starting T3440.\n\n>>> SUMMARY OF CHANGE\nTo add the cause codes #7, #8, #22 and #25 as a trigger for starting T3440.\n\n>>> CONSEQUENCES IF NOT REVISED\nUpon receipt of cause value #7 (EPS services not allowed) and cause value #8 (EPS services and non-EPS services not allowed) the UE\u2019s behaviour on receipt of these cause values is similar to that for cause value #14 (EPS services not allowed in this PLMN) for which timer T3440 is already triggered.Upon receipt of cause value #22, the UE may possibly never release the RRC connection or release it after a very long time (when network gets a chance to release it) and could be be stuck in connected mode for a very long timeUpon receipt of cause value #25, if the network does not initiate the connection release procedure, then it could take very long for the UE to perform cell selection thus leading to detrimental user experience. Since CSG cells can be set up by anybody, there is also a higher risk that the UE might be caught by a \"malicious H(e)NB\". Bad user experience."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nBegin Change\n\n\n\n5.2.6.3\tRequests initiated by the UE\nWhen the P-CSCF receives an initial request for a dialog or a request for a standalone transaction, and the request contains a P-Preferred-Identity header that matches one of the registered public user identities, the P-CSCF shall identify the initiator of the request by that public user identity.\nWhen the P-CSCF receives an initial request for a dialog or a request for a standalone transaction, and the request contains a P-Preferred-Identity header that does not match one of the registered public user identities, or  does not contain a P-Preferred-Identity header, the P-CSCF shall identify the initiator of the request by a default public user identity. If there is more than one default public user identity available, the P-CSCF shall randomly select one of them.\nNOTE\u00a01:\tThe contents of the From header do not form any part of this decision process.\nNOTE\u00a02: The display-name portion of the P-Preferred-Identity header and the registered public user identities is not included in the comparison to determine a match.End Change\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs specified in TS29.228, the definition of barred public user identity can only be used in registration and re-registration but not other IMS communication. As the description in TS 24.229 (5.2.6.3), when the P-CSCF receives an initial request for a dialog or a request for a standalone transaction, and the request contains a P-Preferred-Identity header that does not match one of the registered public user identities, the P-CSCF shall identify the initiator of the request by a default public user identity.If the UE uses a barred public user identity to initiate a request for a dialog or a standalone transaction, as the barred public user identity doesn\u2019t mach the registered public user identities , the P-CSCFshall identity the initiator of the request by a default public user identity. Then the P-CSCF shall transfer the request to the S-CSCF. Thus a barred public user identity can initiate an originationg communication, which is not consistent with the definition of barred public user identity.In this case, it can be avoided by rejecting the request by P-CSCF when the IMPU in the P-Preferred-Identity header that does not match one of the registered public user identities,.\n\n>>> SUMMARY OF CHANGE\nWhen the P-CSCF receives an initial request for a dialog or a request for a standalone transtion, and the request contains a P-Preferred-Identity header that does not match one of the registered public user identities, the P-CSCF shall reject the request, and return a 403 (Forbidden) response.\n\n>>> CONSEQUENCES IF NOT REVISED\nA barred public user identity may successfully initiate a requent for a dialog or a standalone transaction."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***\tBEGIN CHANGES\t***\n6.1.3.3.1\tOpen discovery security flows\n The message flows apply when both the UEs are roaming or when one or both are in their HPLMN.\nNote that integrity protection via this Message Integrity Check (MIC) furthermore enables the ProSe Function to verify that the announcing UE was indeed authorized to announce this ProSe App Code at that time instance. A UTC-based counter associated with the discovery slot is used to calculate the MIC and verify the MIC. To help ensure that the announcing and monitoring UEs end up with the same value of the UTC-based counter, the announcing UE includes the 4 least significant bits of its couter value in the discovery message, which the monitoring UE uses when  setting the value of the UTC-based counter that is passed to the ProSe Function. \n\n \n\n\n\nFigure: 6.1.3.3.1-1: Integrity protection of the transmitted code\n1.\tThe Announcing UE sends a Discovery Request message containing the ProSe Application ID to the ProSe Function in its HPLMN in order to be allowed to announce a code on its serving PLMN (either VPLMN or HPLMN).\n2./3. If  the announcing UE wants to send announcements while in the VPLMN, it needs to be authorised from the VPLMN ProSe Function:\tThe ProSe Function in the HPLMN requests authorization for sending announcements  from the VPLMN ProSe Function by sending Announce Auth.() message. VPLMN ProSe Function responds with an Announce Auth. Ack () message, if authorization is granted. There are no changes to these messages for the purpose of protecting the transmitted code for open discovery. If the Announcing UE is not roaming, these steps do not take place.\n4.\tThe ProSe Function in HPLMN of the announcing UE returns the ProSe App Code that the announcing UE can announce and a 128-bit Discovery Key associated with it. The ProSe Function stores the Discovery Key with the ProSe App Code. In addition, the ProSe Function provides the UE with a CURRENT_TIME parameter, which contains the current UTC-based time at the ProSe Function, a MAX_OFFSET parameter, and a Validity Timer (see TS 23.303 [2]). The UE sets a clock it uses for ProSe authentication (i.e. ProSe clock) to the value of CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any previous values.  The announcing UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time. The counter is set to a value of UTC time in a granularity of seconds. The UE may obtain UTC time from any sources available, e.g. the RAN via SIB16, NITZ, NTP, GPS, via Ub interface (in GBA) (depending on which is available).\nNOTE 1:\tThe UE may use unprotected time to obtain the UTC-based counter associated with a discovery slot. This means that the discovery message could be successfully replayed if a UE is fooled into using a time different to the current time. The MAX_OFFSET parameter is used to limit the ability of an attacker to successfully replay discovery messages or obtain correctly MICed discovery message for later use. This is achieved by using MAX_OFFSET as a maximum difference between the UTC-based counter associated with the discovery slot and the ProSE clock held by the UE. \nNOTE 2: \tA discovery slot is the time at which an announcing UE sends the announcement. \n5.\tThe UE starts announcing, if the UTC-based counter provided by the system associated with the discovery slot is within the MAX_OFFSET of the announcing UE's ProSe clock and if the Validity Timer has not expired (see TS 23.303 [2]).For each discovery slot it uses to announce, the announcing UE calculates a 32-bit Message Integrity Check (MIC) to include with the ProSe App Code in the discovery message. Four least significant bits of UTC-based counter are transmitted along with the discovery message. The MIC is calculated as described in sub clause A.2 using the Discovery Key and the UTC-based counter associated with the discovery slot.\n6.\tThe Monitoring UE sends a Discovery Request message containing the ProSe Application ID to the ProSe Function in its HPLMN in order to get the Discovery Filters that it wants to listen for.\n7/8. The ProSe Functions in the HPLMN of the monitoring UE and HPLMN of the announcing UEs exchange Monitor Req./Resp. messages. There are no changes to these messages for the purpose of protecting the transmitted code for open discovery.\n9.\tThe ProSe Function returns the Discovery Filter containing either the ProSe App Code(s), the ProSe App Mask(s) or both along with the CURRENT_TIME and the MAX_OFFSET parameters. The UE sets its ProSe clock to CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any previous values. The monitoring UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time. The counter is set to a value of UTC time in a granularity of seconds. The UE may obtain UTC time from any sources available, e.g. the RAN via SIB16, NITZ, NTP, GPS (depending on which is available).\n10.\tThe Monitoring UE listens for a discovery message that satisfies its Discovery Filter, if the UTC-based counter associated with  that discovery slot is within the MAX_OFFSET of the monitoring UE's ProSe clock.\n11.\tOn hearing such a discovery message, and if the UE has either not checked the MIC for the discovered ProSe App Code previously or has checked a MIC for the ProSe App Code and the associated Match Report refresh timer (see steps 14 and 15 for details of this timer) has expired, or as required based on the procedures specified in TS 23.303 [2], the Monitoring UE sends a Match Report message to the ProSe Function in the HPLMN of the monitoring UE. The Match Report contains the UTC-based counter value with four least significant bits equal to four least significant bits received along with discovery message and nearest to the monitoring UE\u2019s UTC-based counter associated with the discovery slot where it heard the announcement, and other discovery message parameters including the ProSe App Code and MIC.\n12. The ProSe Function in the HPLMN of the monitoring UE passes the discovery message parameters including the ProSe App Code and MIC and associated counter parameter to the ProSe Function in the HPLMN of the announcing UE in the Match Report message.\n13.\tThe ProSe Function in the HPLMN of the announcing UE shall check the MIC is valid. The relevant Discovery Key is found using the ProSe App Code.\n14. The ProSe Function in the HPLMN of the announcing UE shall acknowledge a successful check of the MIC to the ProSe Function in the HPLMN of the monitoring UE in the Match Report Ack message. The ProSe Function in the HPLMN of the announcing UE shall include a Match Report refresh timer in the Match Report Ack message. The Match Report refresh timer indicates how long the UE will wait before sending a new Match Report for the ProSe App Code. \n15.\tThe ProSe Function in the HPLMN of the monitoring UE returns an acknowledgement that the integrity checked passed to the Monitoring UE. The ProSe Function returns the parameter ProSe Application ID to the UE. \nIt also provides the CURRENT_TIME parameter, by which the UE (re)sets its ProSe clock The ProSe Function in the HPLMN of the monitoring UE may optionally modify the received Match Report refresh timer based on local policy and then shall include the Match Report refresh timer in the message to the Monitoring UE..\n***\tEND OF CHANGES\t***\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nSA3 requires more time to investigate the new key issue of tunnelling attacks, also referred to as spatial replay. In fact in the current specification, nothing guarantees for ProSe enabled UEs discovering each other that they are indeed in the vecinity of each other.\n\n>>> SUMMARY OF CHANGE\nIt is proposed to add an Editor\u2019s note in clause 6.1.3 to emphasize the need for enhancing the current replay protection.\n\n>>> CONSEQUENCES IF NOT REVISED\nAn attacker listening on the air interface can receive and tunnel discovery messages through the internet and broadcast them somewhere else thus fooling UEs out of the service range into believing that they are in proximity."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st Change\n5.4.3.2\tNAS security mode control initiation by the network\nThe MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure\u00a05.4.3.2.1).\nIf the security mode control procedure is initiated further to a successful execution of the authentication procedure, the MME shall use the reset downlink NAS COUNT to integrity protect the SECURITY MODE COMMAND message.\nThe MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to \"integrity protected with new EPS security context\".\n\nUpon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall indicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to \"mapped security context\" and the KSI value related to the security context of the source system. The MME shall use the reset downlink NAS COUNT to integrity protect the SECURITY MODE COMMAND message.\nWhile having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that matches the native EPS security context in the SECURITY MODE COMMAND message.\nThe MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS, RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if UE included them in the message to network), the replayed nonceUE if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI).\nAdditionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.\nNOTE:\tThe AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS it is also be supported for AS.\n\nFigure 5.4.3.2.1: Security mode control procedure\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAt the last SA3 meeting, SA3 agreed the CR0339 which corrected a security hole in the Rel-8 version of 3GPP specification because of the handling of the NAS COUNT counter value. The issues is that a partial native EPS security context may exist for long and its associated downlink NAS COUNT counter value is then zero.The security hole is resolved by mandating that after a SECURITY MODE COMMAND message sent by the MME in order to activate/initialize a partial native EPS security context, the downlink NAS COUNT counter value has to be increased by one for each following sent NAS message.\n\n>>> SUMMARY OF CHANGE\nThe initiation of the security mode control procedure for the case of start/initialize a partial native EPS security context is corrected, so aligned with latest SA3 agreements.\n\n>>> CONSEQUENCES IF NOT REVISED\nSecurity hole remains in the stage 3 specification with regards to the NAS counter value. Therefore, an attacker would be able to intercept the last SECURITY MODE COMMAND message for a partial native EPS security context, and apply a replay attack. Then, the attacker would make the UE and MME using different EPS security context (UE and MME do not understand each other)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------ [Change Start] -------------------------------\n5.3.5.3\tReception of an RRCReconfiguration by the UE\nThe UE shall perform the following actions upon reception of the RRCReconfiguration:\n1>\tif the RRCReconfiguration is received via other RAT (i.e., inter-RAT handover to NR):\n2>\tif the RRCReconfiguration does not include the fullConfig and the UE is connected to 5GC (i.e., delta signalling during intra 5GC handover):\n3>\tre-use the source RAT SDAP and PDCP configurations if available (i.e., current SDAP/PDCP configurations for all RBs from source E-UTRA RAT prior to the reception of the inter-RAT HO RRCReconfiguration message);\n1>\telse:\n2>\tif the RRCReconfiguration includes the fullConfig:\n3>\tperform the full configuration procedure as specified in 5.3.5.11;\n1>\tif the RRCReconfiguration includes the masterCellGroup:\n2>\tperform the cell group configuration for the received masterCellGroup according to 5.3.5.5;\n1>\tif the RRCReconfiguration includes the masterKeyUpdate:\n2>\tperform AS security key update procedure as specified in 5.3.5.7;\n1>\tif the RRCReconfiguration includes the sk-Counter:\n2>\tperform security key update procedure as specified in 5.3.5.7;\n1>\tif the RRCReconfiguration includes the secondaryCellGroup:\n2>\tperform the cell group configuration for the SCG according to 5.3.5.5; \n1>\tif the RRCReconfiguration includes the mrdc-SecondaryCellGroupConfig:\n2>\tif the mrdc-SecondaryCellGroupConfig is set to setup:\n3>\tif the mrdc-SecondaryCellGroupConfig includes mrdc-ReleaseAndAdd:\n4>\tperform MR-DC release as specified in clause 5.3.5.10;\n3>\tif the received mrdc-SecondaryCellGroup is set to nr-SCG:\n4>\tperform the RRC reconfiguration according to 5.3.5.3 for the RRCReconfiguration message included in nr-SCG;\n3>\tif the received mrdc-SecondaryCellGroup is set to eutra-SCG:\n4>\tperform the RRC connection reconfiguration as specified in TS 36.331 [10], clause 5.3.5.3 for the RRCConnectionReconfiguration message included in eutra-SCG;\n\n2>\telse (mrdc-SecondaryCellGroupConfig is set to release):\n3>\tperform MR-DC release as specified in clause 5.3.5.10;\n1>\tif the RRCReconfiguration message includes the radioBearerConfig:\n2>\tperform the radio bearer configuration according to 5.3.5.6;\n1>\tif the RRCReconfiguration message includes the radioBearerConfig2:\n2>\tperform the radio bearer configuration according to 5.3.5.6;\n1>\tif the RRCReconfiguration message includes the measConfig:\n2>\tperform the measurement configuration procedure as specified in 5.5.2;\n1>\tif the RRCReconfiguration message includes the dedicatedNAS-MessageList:\n2>\tforward each element of the dedicatedNAS-MessageList to upper layers in the same order as listed;\n1>\tif the RRCReconfiguration message includes the dedicatedSIB1-Delivery:\n2>\tperform the action upon reception of SIB1 as specified in 5.2.2.4.2;\n1>\tif the RRCReconfiguration message includes the dedicatedSystemInformationDelivery:\n2>\tperform the action upon reception of System Information as specified in 5.2.2.4;\n1>\tif the RRCReconfiguration message includes the otherConfig:\n2>\tperform the other configuration procedure as specified in 5.3.5.9;\n1>\tset the content of the RRCReconfigurationComplete message as follows:\n2>\tif the RRCReconfiguration includes the masterCellGroup containing the reportUplinkTxDirectCurrent; or\n2>\tif the RRCReconfiguration includes the secondaryCellGroup containing the reportUplinkTxDirectCurrent:\n3>\tinclude the uplinkTxDirectCurrentList for each serving cell with UL;\n3>\tif UE is configured with SUL carrier:\n4>\tinclude uplinkDirectCurrentBWP-SUL for each serving cell with SUL within the uplinkTxDirectCurrentList;\n2>\tif the RRCReconfiguration message includes the mrdc-SecondaryCellGroupConfig with mrdc-SecondaryCellGroup set to eutra-SCG:\n3>\tinclude in the eutra-SCG-Response the E-UTRA RRCConnectionReconfigurationComplete message in accordance with TS 36.331 [10] clause 5.3.5.3;\n2> if the RRCReconfiguration message includes the mrdc-SecondaryCellGroupConfig with mrdc-SecondaryCellGroup set to nr-SCG:\n3>\tinclude in the nr-SCG-Response the RRCReconfigurationComplete message;\n\n1>\tif the UE is configured with E-UTRA nr-SecondaryCellGroupConfig (MCG is E-UTRA):\n2>\tif the RRCReconfiguration message was received via SRB1:\n3>\tsubmit the RRCReconfigurationComplete via the E-UTRA MCG embedded in E-UTRA RRC message RRCConnectionReconfigurationComplete as specified in TS 36.331 [10];\n3>\tif reconfigurationWithSync was included in spCellConfig of an SCG:\n4>\tinitiate the Random Access procedure on the SpCell, as specified in TS 38.321 [3];\n3>\telse:\n4>\tthe procedure ends;\nNOTE 1:\tThe order the UE sends the RRCConnectionReconfigurationComplete message and performs the Random Access procedure towards the SCG is left to UE implementation.\n2>\telse (RRCReconfiguration was received via SRB3):\n3>\tsubmit the RRCReconfigurationComplete message via SRB3 to lower layers for transmission using the new configuration;\nNOTE 2:\tIn (NG)EN-DC and NR-DC, in the case RRCReconfiguration is received via SRB1, the random access is triggered by RRC layer itself as there is not necessarily other UL transmission. In the case RRCReconfiguration is received via SRB3, the random access is triggered by the MAC layer due to arrival of RRCReconfigurationComplete.\n1>\telse if the RRCReconfiguration message was received within the nr-SCG within mrdc-SecondaryCellGroup (NR SCG RRC Reconfiguration):\n2>\tif reconfigurationWithSync was included in spCellConfig in nr-SCG:\n3>\tinitiate the Random Access procedure on the PSCell, as specified in TS 38.321 [3];\n2>\telse\n3>\tthe procedure ends;\nNOTE 2a:\tThe order in which the UE sends the RRCReconfigurationComplete message and performs the Random Access procedure towards the SCG is left to UE implementation.\n1>\telse if the RRCReconfiguration message was received via SRB3:\n2>\tsubmit the RRCReconfigurationComplete message via SRB3 to lower layers for transmission using the new configuration;\n1>\telse (MCG RRCReconfiguration):\n2>\tsubmit the RRCReconfigurationComplete message via SRB1 to lower layers for transmission using the new configuration;\n2>\tif this is the first RRCReconfiguration message after successful completion of the RRC re-establishment procedure:\n3>\tresume SRB2 and DRBs that are suspended;\n1>\tif reconfigurationWithSync was included in spCellConfig of an MCG or SCG, and when MAC of an NR cell group successfully completes a Random Access procedure triggered above;\n2>\tstop timer T304 for that cell group;\n2>\tapply the parts of the CSI reporting configuration, the scheduling request configuration and the sounding RS configuration that do not require the UE to know the SFN of the respective target SpCell, if any;\n2>\tapply the parts of the measurement and the radio resource configuration that require the UE to know the SFN of the respective target SpCell (e.g. measurement gaps, periodic CQI reporting, scheduling request configuration, sounding RS configuration), if any, upon acquiring the SFN of that target SpCell;\n2>\tif the reconfigurationWithSync was included in spCellConfig of an MCG:\n3>\tif T390 is running:\n4>\tstop timer T390 for all access categories;\n4>\tperform the actions as specified in 5.3.14.4.\n3>\tif RRCReconfiguration does not include dedicatedSIB1-Delivery and\n3>\tif the active downlink BWP, which is indicated by the firstActiveDownlinkBWP-Id for the target SpCell of the MCG, has a common search space configured by searchSpaceSIB1:\n4>\tacquire the SIB1, which is scheduled as specified in TS 38.213 [13], of the target SpCell of the MCG;\n4>\tupon acquiring SIB1, perform the actions specified in clause 5.2.2.4.2;\n2>\tif reconfigurationWithSync was included in masterCellGroup; and\n2>\tif the UE transmitted a UEAssistanceInformation message during the last 1 second:\n3>\tinitiate transmission of a UEAssistanceInformation message with the same contents;\n2>\tthe procedure ends.\nNOTE 3:\tThe UE is only required to acquire broadcasted SIB1 if the UE can acquire it without disrupting unicast data reception, i.e. the broadcast and unicast beams are quasi co-located.\n\n----------------------------------- [Change End] --------------------------\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe \u201cRRCReconfiguration\u201d is contained in \u201cnr-SCG\u201d, which itself is one of the non-criticial extentions of \u201cRRCReconfiguration\u201d message. The \u201cRRCReconfigurationComplete\u201d is contained in \u201cnr-SCG-response\u201d, which itself is one of the non-criticial extentions of \u201cRRCReconfigurationComplete\u201d message.This will create a loop and generate a risk for endless loop decoding attack.\n\n>>> SUMMARY OF CHANGE\nNOTE X is added to clarify that the \u201cRRC(Connection)Reconfiguration\u201d contained in  \u201cnr/eutra-SCG\u201d shall not contain \u201cmrdc-SecondaryCellGroup\u201d. NOTE  Y is added to clarify that the \u201cRRC(Connection)ReconfigurationComplete\u201d contained in \u201cnr/eutra-SCG-response\u201d shall not contain \u201cscg-Response\u201d.Impact analysisImpacted 5G architecture options: NE-DC/EN-DC/NR-DC\u00a0Impacted functionality: Radio resource configuration\u00a0Inter-operability: No inter-operability issue\n\n>>> CONSEQUENCES IF NOT REVISED\nIt will create a loop and generate a risk for endless loop decoding attack."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n4.4.4.7\tLocation updating not accepted by the network\nIf the location updating cannot be accepted, the network sends a LOCATION UPDATING REJECT message to the mobile station. The mobile station receiving a LOCATION UPDATING REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3210, store the reject cause, start T3240, enter state LOCATION UPDATING REJECTED await the release of the RR connection triggered by the network, and for all causes except #12, #15, #22 and #25 deletes the list of \"equivalent PLMNs\". If the location updating is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 \"congestion\" and assign a back-off timer T3246 (see 3GPP\u00a0TS\u00a023.012\u00a0[140]).\nUpon the release of the RR connection, the mobile station shall take the following actions depending on the stored reject cause:\n# 2:\t(IMSI unknown in HLR);\n# 3:\t(Illegal MS); or\n# 6:\t(Illegal ME).\n\tThe mobile station shall set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2), and delete any TMSI, stored LAI and ciphering key sequence number and shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed.\n# 11:\t(PLMN not allowed);\n\tThe mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). The mobile station shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe MS shall perform a PLMN selection when back to the MM IDLE state according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to performing a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n# 12:\t(Location Area not allowed);\n\tThe mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). \n \tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\". \n \tThe MS shall perform a cell selection when back to the MM IDLE state according to 3GPP TS\u00a043.022 [82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a01:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n# 13:\t(Roaming not allowed in this location area).\n \tThe mobile station shall reset the attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). \n \tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\".\n \tThe mobile station shall perform a PLMN selection instead of a cell selection when back to the MM IDLE state according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to performing a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n# 15:\t(No Suitable Cells In Location Area).\n \tThe mobile station shall reset the attempt counter, set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2).\n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\".\n\tThe mobile station shall search for a suitable cell in another location area or a tracking area in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n# 22:\t(Congestion).\n\tIf the T3246 value IE is present in the LOCATION UPDATING REJECT message and the value indicates that this timer is neither zero nor deactivated, the mobile station shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.4.4.9.\n\tThe mobile station shall abort the location updating procedure, reset the attempt counter, set the MM update status to U2 NOT UPDATED and change to state MM IDLE sub-state ATTEMPTING TO UPDATE.\n\tThe MS shall stop timer T3246 if it is running.\n\tIf the LOCATION UPDATING REJECT message is integrity protected, the mobile station shall start timer T3246 with the value provided in the T3246 value IE.\n\tIf the LOCATION UPDATING REJECT message is not integrity protected, the mobile station shall start timer T3246 with a random value from the default range specified in table\u00a011.1.\n\tThe mobile station stays in the current serving cell and applies the normal cell reselection process. The MM connection establishment is started, if still necessary, when timer T3246 expires or is stopped.\n# 25:\t(Not authorized for this CSG ).\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.4.4.9.\n\tIf the LOCATION UPDATING REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else the timer T3210 is stopped.\n\tThe MS shall reset the attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2).\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP TS 23.122 [14] subclause\u00a03.1A.\n\tThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nOther values are considered as abnormal cases and the specification of the mobile station behaviour in those cases is given in subclause\u00a04.4.4.9.\n***** Next change *****\n4.7.3.1.4\tGPRS attach not accepted by the network\nIf the attach request cannot be accepted by the network, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3310 and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take one of the following actions depending upon the reject cause:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed.\n\tIf the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when attach procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a01:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) , shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection.\nA GPRS MS operating in MS operation mode A or B in network operation mode II, is still IMSI attached for CS services in the network. \nAs an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:\n-\tThe MS may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" list or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.3.1.5.\n\tThe MS shall abort the attach procedure, reset the attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG);\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.3.1.5.\n\tIf the ATTACH REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else timer T3310 is stopped.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), reset the GPRS attach attempt counter and enter the state GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list stored in the MS, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause\u00a04.7.3.1.5.\n***** Next change *****\n4.7.3.2.4\tCombined GPRS attach not accepted by the network\nIf the attach request can neither be accepted by the network for GPRS nor for non-GPRS services, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3310, and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the MM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take one of the following actions depending upon the reject cause:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME), or\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED. The new MM state is MM IDLE.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. \n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new GMM state is GMM-DEREGISTERED; the MM state is MM IDLE.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and changes to state GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \nThe MS shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a01:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\". \nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED. \nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\nIf the MS does not perform a PLMN selection then a GPRS MS operating in MS operation mode A or B which is not yet IMSI attached for CS services in the network shall then perform an IMSI attach for non-GPRS services according to the conditions for the MM IMSI attach procedure (see subclause\u00a04.4.3).\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE. \nThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall search for a suitable cell in another location area or a tracking area in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.3.1.5.\n\tThe MS shall abort the attach procedure, reset the attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.3.2.5.\n\tIf the ATTACH REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else timer T3310 is stopped.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause\u00a04.7.3.2.5. \n***** Next change *****\n4.7.5.1.4\tNormal and periodic routing area updating procedure not accepted by the network\nIf the routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS that receives a ROUTING AREA UPDATE REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3330, and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\". If a ROUTING AREA UPDATE REJECT message containing a reject cause other than MM cause value #25 is received, the MS shall stop any ongoing transmission of user data.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take different actions depending on the received reject cause value:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed.\n\tIf the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a01:\tThe possibility to configure a MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED.\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I is still IMSI attached for CS services in the network, and shall set the timer T3212 to its initial value and restart it, if it is not already running. The MS shall then proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 9\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services , the MS may subsequently , automatically initiate the GPRS attach procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tThe MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a02:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and enter the state GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a03:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS\u00a044.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection.\nIf the update type is \"periodic updating\" a GPRS MS operating in MS operation mode A or B in network operation mode I shall set the timer T3212 to its initial value and restart it, if it is not already running.\nA GPRS MS operating in MS operation mode A or B in network operation mode II, is still IMSI attached for CS services in the network.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:\n-\tThe MS may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.1.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shallchange to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.1.5.\n\tIf the ROUTING AREA UPDATE REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else timer T3330 and any ongoing transmission of user data are stopped.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.1.5.\n***** Next change *****\n4.7.5.2.4\tCombined routing area updating not accepted by the network\nIf the combined routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS that receives a ROUTING AREA UPDATE REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3330, enters state MM IDLE, and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\". If a ROUTING AREA UPDATE REJECT message containing a reject cause other than MM cause value #25 is received, the MS shall stop any ongoing transmission of user data.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nThe MS shall then take different actions depending on the received reject cause:\n# 3\t\t\t(Illegal MS);\n# 6\t\t\t(Illegal ME), or\n# 8\t\t\t(GPRS services and non GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS and non GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. If in the MS the timer T3212 is not already running, the timer shall be set to its initial value and restarted.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services, is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP TS 24.301 [120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services , the MS may subsequently, automatically initiate the GPRS attach procedure.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.\n\tThe MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE 1:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP/MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number GPRS ciphering key sequence number, and reset the routing area updating attempt counter and the location update attempt counter.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall then perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\nThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure following the PLMN selection.\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED. If in the MS the timer T3212 is not already running, the timer shall be set to its initial value and restarted.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services, is still IMSI attached for CS services in the network.\nA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall search for a suitable cell in another location area in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE 3:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.2.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the ME shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.2.5.\n\tIf the ROUTING AREA UPDATE REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else timer T3330 and any ongoing transmission of user data are stopped.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.2.5.\n***** Next change *****\n4.7.13.4\tService request procedure not accepted by the network\nIf the Service request cannot be accepted, the network returns a SERVICE REJECT message to the mobile station.\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nAn MS that receives a SERVICE REJECT message containing a reject cause other than MM cause value #25, shall stop the timer T3317. The MS shall then take different actions depending on the received reject cause value:\n# 3\t\t\t(Illegal MS); or\n# 6\t\t\t(Illegal ME);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed.\n-\tA GPRS MS operating in MS operation mode A shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. \n\tA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services is still IMSI attached for CS services in the network, and shall set the timer T3212 to its initial value and restart it, if it is not already running.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n-\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may subsequently, automatically initiate the GPRS attach procedure. \n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n-\tThe MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the the service request procedure is rejected with the EMM cause with the same value.\nNOTE\u00a01:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED.\n-\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tA GPRS MS operating in MS operation mode A shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n-\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area in the same PLMN according to 3GPP TS\u00a043.022\u00a0[82] and 3GPP TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a03:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.13.5.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall abort the service request procedure and enter state GMM-REGISTERED, and stop timer T3317 if still running.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the SERVICE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the SERVICE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n-\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.13.5.\n-\tIf the SERVICE REJECT message with cause #25 was received without integrity protection, then the MS shall discard the message. Else timer T3317 is stopped.\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\t If the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n-\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n-\tThe MS shall search for a suitable cell in the same PLMN according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n-\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 40\t(No PDP context activated)\n-\tThe MS shall deactivate locally all active PDP and MBMS contexts and the MS shall enter the state GMM-REGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS may also perform the procedures needed in order to activate any previously active multicast service(s).\nNOTE\u00a04:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.13.5.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe specification defines the handling of the T3246/T3346 value IE in the (G)MM reject messages which was introduced from Rel-10 onwards. The handling from Rel-10 is as follows (sub-clause \u00a74.7.3.1.4), quote:#22\u00a0\u00a0 (Congestion);\u00a0\u00a0\u00a0\u00a0\u00a0 If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.2.6.As one can see from the above quotation when the network does not provide a T3246/T3346 value in the reject message this is considered an abnormal case. This standardized handling results in problems when one considers the UE behaviour since then the UE will try several times (upon expiry of T3311 for GPRS) which can make the congestion even worse. Also, from the UE perspective this might result in unnecessary signalling and drain of battery. Considering that T3246/T3346 is optional for the network, then it would be better to handle this case as normal, e.g., to start T3246/T3346 with a default value.Please, note also that Rel-10 MSes need interact with legacy network equipment for many years which cannot provide T3246/T3346. Quote of TS 24.008:9.4.4.2\u00a0 T3346 valueThis IE may be included when the NAS level mobility management congestion control is active.\n\n>>> SUMMARY OF CHANGE\nUpon receipt of a reject message with #22 with no T3246/T3346 value the MS starts T3246/T3346 with a default value.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe specifiction mandates the MS to handle the case of no T3246/T3346 value IE in the reject message as an abnormal case. This results in a number of problems in the 3GPP network since the MS can try everal times which then worsen the congestion in the network. If a large number of MSes do so the stability of the network is actually compromised. Also, the MS will generate unnecessary signalling and drain of battery when this could be avoided."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n5.2.4\tPDN connectivity procedure not accepted by the TWAG\nIf connectivity with the requested PDN cannot be accepted by the network, the TWAG shall send a PDN CONNECTIVITY REJECT message to the UE (see example in figure\u00a05.2.4.1). The message shall contain the PTI and a cause value indicating the reason for rejecting the UE-requested PDN connectivity.\n\nFigure 5.2.4.1: PDN connectivity establishment procedure not accepted by TWAG\nThe cause IE typically indicates one of the following cause values:\n#8:\toperator determined barring;\n#26:\tinsufficient resources;\n#27:\tmissing or unknown APN;\n#28:\tunknown PDN type;\n\n#30:\trequest rejected by PDN GW;\n#31:\trequest rejected, unspecified;\n#32:\tservice option not supported;\n#33:\trequested service option not subscribed;\n#34:\tservice option temporarily out of order;\n#35:\tPTI already in use;\n#38:\tnetwork failure;\n#50:\tPDN type IPv4 only allowed;\n#51:\tPDN type IPv6 only allowed;\n#52:\tsingle address bearers only allowed;\n#54:\tPDN connection does not exist;\n#55:\tmultiple PDN connections for a given APN not allowed;\n#95 \u2013 111:\tprotocol errors;\nIf the cause value is #26 \"insufficient resources\", the network may include a value for timer Tw1 in the PDN CONNECTIVITY REJECT message. \nUpon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3582 and enter the state PROCEDURE TRANSACTION INACTIVE.\nIf the cause value is #26 \"insufficient resources\" and the Tw1 value IE is included, the UE shall take different actions depending on the timer value received for timer Tw1:\n-\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer Tw1 associated with the corresponding APN, if it is running. The UE shall start timer Tw1 with the value provided in the Tw1 value IE and not send another PDN CONNECTIVITY REQUEST message for the same APN until timer Tw1 expires, the timer Tw1 is stopped or the USIM is removed;\n-\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN until the UE is switched off or the USIM is removed; and\n-\tif the timer value indicates zero, the UE may send another PDN CONNECTIVITY REQUEST message for the same APN;\n-\tif the UE is switched off when the timer Tw1 is running and if the USIM in the UE remains the same when the MS is switched on, the UE shall behave as follows when the UE is switched on:\n-\tlet t1 be the time remaining for Tw1 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the cause value is #26 \"insufficient resources\" and the Tw1 IE is not included, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN. \n\n***** Next change *****\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to the LS (C4-152321) from CT4, whether the user authentication failed indication is needed for WLCP is FFS. In the TS 24.301subclause B.1, there is the following definition about the user authentication failed:Cause #29 \u2013 User authentication failedThis ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication.The access rejection by the external PDN can be happened due to the UE providing the wrong/invalid PAP/CHAP user credentials (e.g. user-name or user-password) in the PCO IE when initiating the initial access to the network. As the same condition can also happen in WLAN side, it is proposed to add Cause#29 user authentication failed to the WLCP.\n\n>>> SUMMARY OF CHANGE\nDefine the cause#29 user authentication failed in WLCP.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe network cannot notify the UE that the service is rejected because of the user authentication failed. Although the user\u2019s retry by using the correct credential may solve this problem, without this indication, the user cannot know the failure reason and cannot retry. It will result in the access failed which will impact the user experience seriously."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n1st Change\n4.7.7.10\tHandling of keys at intersystem change from S1 mode to Iu mode or A/Gb mode\nAt an inter-system change from S1 mode to Iu mode, ciphering and integrity may be started (see 3GPP\u00a0TS\u00a025.331\u00a0[23c]) without any new authentication and ciphering procedure. At an inter-system change from S1\u00a0mode to A/Gb mode, ciphering may be started (see 3GPP\u00a0TS\u00a044.064\u00a0[78a]) without any new authentication and ciphering procedure. Deduction of the appropriate security keys for ciphering and integrity check in Iu mode or for ciphering in A/Gb mode, depends on the UMTS security context for the PS domain stored in the MS and the network.\nThe ME shall handle the GPRS UMTS ciphering key, the GPRS UMTS integrity key and GPRS GSM ciphering key according to table\u00a04.7.7.10.1, table\u00a04.7.7.10.2 and table\u00a04.7.7.10.3.\nTable\u00a04.7.7.10.1/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in connected mode.\nSecurity context established in MS and network\t\tAt inter-system change to Iu mode or A/Gb mode in connected mode\nEPS security context\n\nNOTE:\tFor the case in table\u00a04.7.7.10.1, because of deriving a new UMTS security context for the PS domain, a new GPRS GSM ciphering key needs to be derived from the new derived UMTS security keys (i.e. CK' and IK'). Note that the new GPRS GSM ciphering key is also part of the new UMTS security context for the PS domain, and therefore any old GPRS GSM ciphering key stored in the USIM and in the ME belongs to an old UMTS security context for the PS domain and can no longer be taken into use.\nTable\u00a04.7.7.10.2/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in idle mode when the TIN indicates \"GUTI\".\nSecurity context established in MS and network\t\tAt inter-system change to Iu mode or A/Gb mode in idle mode when the TIN indicates \"GUTI\"\nEPS security context\t\tAn ME shall derive the UMTS security keys GPRS UMTS integrity key (CK') and GPRS UMTS ciphering key (IK') from KASME and the NAS uplink COUNT value as specified in 3GPP\u00a0TS\u00a033.401\u00a0[119]. The ME shall use the derived UMTS security keys to derive the GPRS GSM ciphering key using the \"c3\" conversion function as specified in 3GPP\u00a0TS\u00a033.102\u00a0[5a]. \n\nNOTE:\tFor the case in table\u00a04.7.7.10.2, because of deriving a new UMTS security context for the PS domain, a new GPRS GSM ciphering key needs to be derived from the new derived UMTS security keys (i.e. CK' and IK'). The new GPRS GSM ciphering key is also part of the new UMTS security context for the PS domain, and therefore any old GPRS GSM ciphering key stored in the USIM and in the ME belongs to an old UMTS security context for the PS domain and can no longer be taken into use.\nTable\u00a04.7.7.10.3/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in idle mode when the TIN indicates \"RATrelated TMSI\"\nSecurity context established in MS and network\t\tAt inter-system change to Iu mode or A/Gb mode in idle mode when the TIN indicates \"RATrelated TMSI\"\nUMTS security context\t\tAt inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 64-bit long ciphering key, then an ME shall apply the GPRS GSM ciphering key that was received from the GSM security context created in the SIM/USIM during the latest successful authentication procedure.\tAt inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 128-bit long ciphering key, then an ME shall apply the stored GPRS GSM Kc128 that was derived by the ME from the GPRS UMTS ciphering key and the GPRS UMTS integrity key (see 3GPP\u00a0TS\u00a033.102\u00a0[5a]) during the lastest successful authentication procedure.\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe present text in table 4.7.7.10.3 states that at inter-system change from S1 mode to Iu mode, the ME shall apply the GPRS GSM ciphering key. However, this is clearly not true being in Iu mode. One can see in the Rel-8 version of the TS 24.008 (v8.9.0) the table 4.7.7.10.3 is correct, and therefore there is no need for a CR to the Rel-8 version because of this.Finally, the current text in the tables 4.7.7.10.1 and 4.7.7.10.2 which states, quote: \"The ME shall apply the newly derived security keys\" is not clear enough. Note that in Iu mode, the ME should only apply the GPRS UMTS security keys (CK & IK), but not the GPRS GSM ciphering key (Kc). In similar way, in A/Gb mode, the ME should only apply the GPRS GSM ciphering key.\n\n>>> SUMMARY OF CHANGE\nCorrecting the requirement for the ME to apply appropriate security key(s).Note numbering corrected.Wrong reference to TS 33.401 fixed.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe terminal is mandated to apply the GPRS GSM ciphering key in Iu mode for the case of inter-system change from S1 to Iu mode in idle mode with TIM equals to \u201cRAT-related TMSI\u201d. This is against the security principles of use and handling of security keys in Iu mode, and leads to undesirable effects such implementation fails the inter-system change procedure and in providing service to the end-user."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n5.7.1.1\tNotification about registration status\nThe AS may support the REGISTER method in order to discover the registration status of the user. If a REGISTER request arrives and the AS supports the REGISTER method, the AS shall store the registration expiration interval value from the request and generate a 200 (OK) response or an appropriate failure response. For the success case, the 200 (OK) response shall contain a registration expiration interval value equal to the value received in the REGISTER request. The AS shall store the values received in P-Charging-Function-Addresses header field. Also, the AS shall store the values of the \"icid-value\" header field parameter and \"orig-ioi\" header field parameter if present in the P-Charging-Vector header field from the REGISTER request. The AS shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the REGISTER request and a type 3 \"term-ioi\" header field parameter in the response to REGISTER. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent and the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter.\nUpon receipt of a third-party REGISTER request, with the Content-Type header field or with a MIME body part's Content-Type header field set according to subclause\u00a07.6 (i.e. \"application/3gpp-ims+xml\"), independent of the value or presence of the Content-Disposition header field or a MIME body part's Content-Type header field, independent of the value or presence of Content-Disposition parameters or MIME body part's Content-Disposition parameters, then this default content disposition, identified as \"3gpp-service-info\", is applied as follows: \n-\tif the third-party REGISTER request includes an IM CN subsystem XML body with the <service-info> element or a MIME body part containing a <service-info> XML element as described in subclause\u00a07.6, then the AS may retrieve the service information within the <service-info> XML element.\nUpon receipt of a third-party REGISTER request, with the Content-Type header field or with a body part's Content-Type header field set to \"message/sip\" and including a \"message/sip\" MIME body of the incoming REGISTER request, or the 200 (OK) response to the incoming REGISTER request then the AS may retrieve information from the \"message/sip\" MIME body or body part.\nUpon receipt of a third-party REGISTER request, the AS may subscribe to the reg event package for the public user identity registered at the user's registrar (S-CSCF) as described in RFC\u00a03680\u00a0[43].\nOn sending a SUBSCRIBE request, the AS shall populate the header fields as follows:\na)\ta Request-URI set to the resource to which the AS wants to be subscribed to, i.e. to a SIP URI that contains the public user identity of the user that was received in the To header field of the third-party REGISTER request;\nb)\ta From header field set to the AS's SIP URI;\nc)\ta To header field, set to a SIP URI that contains the public user identity of the user that was received in the To header field of the third-party REGISTER request;\nd)\tan Event header field set to the \"reg\" event package;\ne)\ta P-Asserted-Identity header field set to the SIP URI of the AS; and\nNOTE\u00a01:\tThe S-CSCF expects the SIP URI used in the P-Asserted-Identity header field to correspond to the SIP URI, which identified this AS in the initial filter criteria of the user to whose registration state the AS subscribes to.\nf)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP\u00a0TS\u00a032.260\u00a0[17] and a type 3 \"orig-ioi\" header field parameter. The type 3 \"orig-ioi\" header field parameter identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nUpon receipt of a 2xx response to the SUBSCRIBE request, the AS shall store the information for the so established dialog and the expiration time as indicated in the Expires header field of the received response.\nUpon receipt of any response, the AS shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field if present. \nNOTE\u00a02:\tAny received \"term-ioi\" header field parameters will be any type IOI but includes the adjacent network IOI in first position. The first \"term-ioi\" header field parameter identifies the network operator from which the response was originated for a release 5 S-CSCF and the network operator from which the request was sent otherwise. \nNOTE\u00a03:\tUpon receipt of a NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities are deregistered) and the Subscription-State header field set to \"terminated\", the AS considers the subscription to the reg event package terminated, i.e. as if the AS had sent a SUBSCRIBE request with an Expires header field containing a value of zero.\nUpon receipt of a NOTIFY request, the AS shall store the value of the \"orig-ioi\" header field parameters if present in the P-Charging-Vector header field. The AS shall insert a P-Charging-Vector header field in the response to the NOTIFY rquest containing the \"orig-ioi\" header field parameter, if received in the NOTIFY request and a type 3 \"term-ioi\" header field. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent and the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter. \n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIf AS subscribe to the reg event package for the public user identity by the To header field of the third-party REGISTER request, it will make for the lose of the subscribe to the reg event when HSS remove the public User Identity from the implicitly registered.If AS subscribe to the reg event package for the public user identity by the default public user identity, it will avoid the lose of the subscribe to the reg event.The HSS shall not delete the default Public User Identity of the implicitly registered Public User Identity set that is in a state Registered. In that case the HSS shall use the RTR command to de-register the Public User Identity set\n\n>>> SUMMARY OF CHANGE\nA  To header field in subscribe request, set to a SIP URI that contains the public user identity of the user that was received in the To header field of the third-party REGISTER request;or set to a SIP URI that contains the default public user identity of the user;\n\n>>> CONSEQUENCES IF NOT REVISED\nIt will make for the lose of the subscribe to the reg event when HSS remove the public User Identity from the implicitly registered."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*** Start of changes ***\n\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 31.101: \"UICC-terminal interface; Physical and logical characteristics\".\n[3]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\".\n[4]\t3GPP TS 22.259: \"Service requirements for Personal Network Management (PNM); Stage 1\".\n[5]\tIETF\u00a0RFC\u00a02246 (1999): \"The TLS Protocol Version 1\".\n[6]\tIETF\u00a0RFC\u00a03546 (2003): \"Transport Layer Security (TLS) Extensions\".\n[7]\t3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to network application functions using Hypertext Transfer Protocol over Transport Layer Security (HTTPS)\".\n[8]\tETSI TS\u00a0102 484: \"Smart Cards; Secure Channel between a UICC and an end-point Terminal\".\n\n\n\n\n\n\n\n\nNote:\tReference [8] is not yet published.  Publication is anticipated first quarter 2007.\n3\tDefinitions, symbols and abbreviations\n3.1\tDefinitions\nFor the purposes of the present document, the terms and definitions given in TR\u00a021.905\u00a0[1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR\u00a021.905\u00a0[1].\nNAF Key Center:\tDedicated NAF in charge of performing the key establishment between a UICC and a Terminal.\nUICC Hosting Device: The entity, which is physically connected to the UICC. The UICC Hosting Device may be the MT or the ME.\nTerminal:\tFor the purposes of the present document, the term Terminal denotes a trusted device that can establish a shared key with a UICC. The Terminal is a generic term aiming to address either the scenario where it is part of the UICC Hosting Device or the scenario where it is a physically separated component (e.g. PNE as defined in TS 22.259 [4]).\nRemote Terminal: A Terminal that is physically separated from the UICC Hosting Device.\nNOTE:\tThe definition of trusted devices is out of the scope of the specification. It is assumed that the home network can decide whether a terminal is trusted or not. \nEditor\u2019s note: \tSome examples of trusted devices may be included.\nICCID:\tICCID is the identifier of the smart card. ICCID is defined in ITU standard. \nTerminal_appli_ID:\tIt identifies an application in a Terminal. Terminal_appli_ID is an octet string.\nTerminal_ID:\tIt identifies uniquely the Terminal. The Terminal_ID of a ME is the IMEI.\nNOTE:\tIn case that the Terminal is not a ME the definition of the type of Terminal_IDs is out of the scope of the specification.\nUICC_appli_ID:\tIt uniquely identifies an application in the UICC. The UICC_appli_ID is an octet string. \n3.2\tSymbols\nFor the purposes of the present document, the following symbols apply:\n\nEditor\u2019s note: \tIt is for further studies, if special symbols are needed.\n3.3\tAbbreviations\nFor the purposes of the present document, the abbreviations given in TR\u00a021.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR\u00a021.905\u00a0[1].\n\nB-TID\tBootstrapping Transaction Identifier\nBSF\tBootstrapping Server Function\nGBA\tGeneric Bootstrapping Architecture\nGBA_ME\tME-based GBA\nGBA_U\tGBA with UICC-based enhancements\nICCID\tIntegrated Circuit Card Identification\nKDF\tKey Derivation Function\nKs_ext_NAF\tDerived key in GBA_U\nKs_int_NAF\tDerived key in GBA_U, which remains on UICC\nKs_local\tDerived key, which is shared between a Terminal and a UICC\nNAF\tNetwork Application Function\n\nPNE\tPersonal Network Element\nSLF\tSubscriber Locator Function \nUSS\tUser Security Setting\n\n*** Next change ***\n4.4\tGeneral requirements and principles for key establishment between a UICC and a Terminal\n4.4.1\tGeneral requirements\nThe following requirements and principles are applicable to the procedure for key establishment between a UICC and a Terminal: \nThe Terminal and the UICC shall be able to establish a shared key;\nThe Terminal shall be trusted;\nNOTE:\tThe definition of trusted terminal is out of scope of the specification. The terminal may be compliant to requirements defined in TCG specifications or 3GPP SA3 Technical Report on Trust Requirements for Open platforms in 3GPP.\n\nThe shared key to establish between the UICC and the Terminal (i.e. Ks_local) shall not be exchanged unencrypted on the interface between the UICC and the Terminal;\nThe Terminal and the network shall be able to authenticate each other;\nThe server implementing the key establishment function (i.e. the NAF Key Center) needs to be trusted by the home operator to handle the authentication parameters and the shared key;\nThe home network shall be able to control whether this Terminal is authorized to establish a shared key with the UICC for asymmetric protocols;\nThe procedure for the key establishment between a UICC and a Terminal shall be access independent;\nTo the extent possible, existing protocols and infrastructure should be reused;\n4.4.2\tRequirements on the terminal\nThe Terminal shall support certificate-based mutual authentication as defined in TS 33.222 [7]. Furthermore, the Terminal shall be equipped with a valid Client Certificate.\n4.4.3\tRequirements on the UICC hosting device\nThe UICC Hosting Device shall implement GBA_U as defined in TS 33.220 [3].\n4.4.4\tRequirements on the UICC\nThe UICC shall implement GBA_U as defined in TS 33.220 [3].\nThe UICC shall be capable of deriving Ks_local from Ks_int_NAF.\nThe NAF_ID of the NAF Key Center shall be stored on the UICC.\nNOTE:\tThe home operator can update the NAF_ID of the NAF Key Center by means of OTA commands.\nIt shall be possible that the UICC implements local policies to restrict the key establishment based on targeted UICC and Terminal applications (i.e. based on Terminal_appli_ID / UICC_appli_ID pair value), or based on Terminal_ID, or based on both targeted applications and Terminal_ID.\n4.4.5\tRequirements on the NAF Key Center\nThe NAF Key Center shall support certificate-based mutual authentication as defined in IETF\u00a0RFC\u00a02246\u00a0[5] and IETF\u00a0RFC\u00a03546\u00a0[6].\nEditor\u2019s note: \tIn addition to certificate-based authentication, another option might be defined\nThe NAF Key Center shall be capable of determining whether a Terminal is trusted or not.\nThe NAF Key Center shall implement GBA_U as defined in TS 33.220 [3].\nThe NAF Key Center dedicated to the Key Establishment Mechanism shall be located in the operator\u2019s Home Network.\nThe NAF Key Center shall be capable of deriving Ks_local from Ks_int_NAF.It shall be possible to configure the NAF Key Center to restrict the key establishment based on the targeted UICC and Terminal applications (i.e. based on Terminal_appli_ID / UICC_appli_ID pair value), or based on Terminal_ID and/or ICCID, or based on both targeted applications and device identifiers (Terminal_ID and/or ICCID). \n4.4.6\tRequirements on Ks_local key and associated parameters handling\nThe established key Ks_local may be either a key shared between the UICC and the Terminal as monolithic devices or between a specific application on the UICC and a corresponding specific application on the Terminal. Ks_local \"per platform\" refers to Ks_local shared between the UICC and the Terminal as monolithic devices, whereas Ks_local \"per application\" refers to Ks_local shared between a specific application on the UICC and a specific application on the Terminal.\nA Ks_local counter is associated to each key Ks_local established. After the derivation of Ks_local in the UICC, the UICC associates a dedicated counter \"Ks_local counter\" set to a default value. Each time that the UICC Ks_local-based application on the UICC invokes an algorithm using Ks_local, the UICC shall decrease by one the associated Ks_local counter\nKs_local is invalidated when Ks_local counter reaches null value.\nEditor\u2019s note: \tThe means to update counter value has to be further studied\nThe home operator may update Ks_local counter value by means of OTA commands. The description of the OTA mechanism is out of the scope of this TS.\nThe Terminal shall delete Ks_local and the corresponding parameters (e.g.ICCID, Terminal_appli_ID, UICC_appli_ID) when at least one of the conditions below is met:\n1-\tThe key lifetime of Ks_local expires;\n\n2-\tThe Terminal detects that another UICC has been inserted. In order to make this condition possible, the Terminal needs to store in non-volatile memory the last inserted UICC-identity to be able to compare that with the used UICC-identity during the initialisation procedures;\nKs_local may be deleted from the Terminal when the Terminal is powered down. If the Terminal does not delete Ks_local at power down then Ks_local together with the associated parameters (e.g. key lifetime and B-TID) shall be stored in trusted non-volatile memory.\nEditor\u2019s note: \tOne way to have trusted non-volatile memory may be achieved by tamper-resistant hardware.\n4.5\tProcedures\n4.5.1\tInitiation of key establishment between a UICC and a Terminal\nBefore Ks_local-based application can start, the UICC and the Terminal first have to share the same key Ks_local associated to the selected application. The Terminal shall check if it stores the key Ks_local associated to targeted application and if this key Ks_local is also available on the UICC.\n1- The Terminal checks if it already stores a valid key Ks_local required for the application communicating with the UICC. If a valid key Ks_local is not available on the Terminal then the Terminal initiates a Key Establishment procedure, else step 2 applies. \n2- The Terminal sends a request to the UICC to check that the required key Ks_local is available on the UICC. The UICC reply indicates the Terminal if the required key Ks_local is available on the UICC. If the required key Ks_local is not available on the UICC, the Terminal initiates a key establishment procedure, else a valid Ks_local key is shared between the UICC and the Terminal.\n4.5.2\tKey establishment procedure\nIf a key establishment procedure is needed, it has to be performed as follows:\n1-\tThe Terminal checks whether there is a valid Ks key in the UICC, by fetching the current B-TID and its corresponding lifetime from the UICC. If no valid key Ks is available in the UICC, the Terminal requests a GBA bootstrapping procedure run to derive a new Ks key in the UICC and the BSF. \n2-\tIn order to check whether there is a valid Ks_int_NAF, the Terminal sends a request to the UICC to retrieve B-TID value associated to the NAF_ID of the NAF Key Center. In case that the Terminal does not know the NAF_ID of the NAF Key Center, the Terminal sends a request to the UICC to retrieve the NAF_ID of the NAF Key Center.\n3-\tThe UICC returns the NAF_ID and associated B-TID to the Terminal. If there is no Ks_int_NAF available in the UICC, a GBA_U NAF Derivation procedure associated to the NAF Key Center is performed and then the UICC returns the NAF_ID and associated B-TID to the Terminal.\n4-\tThe Terminal sends a command to perform Ks_local derivation on the UICC. The Terminal sends the NAF_ID corresponding to the NAF Key Center, the Terminal_ID, the Terminal_appli_ID and the UICC_appli_ID and a variational value RANDx. Terminal_appli_ID and UICC_appli_ID correspond to identifiers of applications that aim sharing a key Ks_local.\nNOTE 1: The variational value can be a random value or timestamp produced by the Terminal.\nIn case that Ks_local has to be established per platform, the UICC_appli_ID and the Terminal_appli_ID octet strings equal to static ASCII-encoded string \"platform\".\n5-\tThe UICC retrieves the Ks_int_NAF and B-TID associated to the received NAF_ID and then derives Ks_local. The UICC stores Ks_local and associated parameters Terminal_ID, Terminal_appli_ID, UICC_appli_ID and Ks_local counter. Ks_local counter is set to COUNT_MAX default value if Ks_local corresponds to a new key value.\nKs_local is computed in the UICC as Ks_local = KDF (Ks_int_NAF, B-TID, Terminal_ID, ICCID, Terminal_appli_ID, UICC_appli_ID, RANDx), where KDF is the key derivation function as specified in Annex A.\nThe UICC may store a local policy to determine the associations between a Terminal_appli_ID and a UICC_appli_ID wich are authorized. If the Terminal requested a Terminal_appli_ID/UICC_appli_ID association not authorized by the UICC policy then the UICC stops the key establishment procedure and returns a \"not authorized\" error message. The local policy may also not authorize the key establishment procedure based on Terminal_ID value.\n6-\tThe Terminal and the NAF Key Center establish a HTTPS tunnel with certificate based mutual authentication between the Terminal and the application server. Confer TS 33.222 [7].\nNOTE 2:\tOne potential way to reach a trusted state is if the Terminal is compliant with the requirements defined in TCG (Trusted Computing Group) MPWG (Mobile Phone Working Group) specifications. HTTPS tunnel establishment can be bound to the trust status of the Terminal, through the attestations of relevant trusted engine of the Terminal. Thus, HTTPS tunnel establishment will be possible only if the Terminal is in a trusted state\nEditor\u2019s note: \tIn addition to certificate-based authentication, another option might be defined\n7-\tIn order to retrieve Ks_local from the NAF Key Center, the Terminal sends a \"service request\" message to the NAF Key Center node in the mobile operator network. The message is sent within HTTPS tunnel.\nThe request may contain the following payload: the identity (B-TID), the Terminal identifier (Terminal_ID), the smart card identifier (ICCID), the application identifier of UICC application (UICC_appli_ID) and the application identifier of the Terminal application (Terminal_appli_ID) requiring the establishment of key Ks_local, and RANDx.\n\nIn case that Ks_local has to be established per platform, the UICC_appli_ID and the Terminal_appli_ID octet strings equal to static ASCII-encoded string \"platform\".\n8-\tThe NAF Key Center shall behave as follows:\na)\tIf the key establishment procedure is not allowed for the targeted applications or for the Terminal_ID/ICCID (e.g. if the Terminal ID is blocked (blacklisted)), according to the local administration then the NAF Key Center shall respond with appropriate error code and terminate the TLS connection with the Terminal.b) The NAF Key Center contacts the BSF and sends the identity (B-TID) and its own NAF_ID in a credential request.\n9-\tThe BSF derives Ks_int_NAF, Ks_ext_NAF and supplies to the NAF Key Center the requested keys Ks_int/ext_NAF keys, as well as the bootstrapping time and the key lifetime of Ks_int/ext_NAF keys. \nThe BSF may also send requested USSs to NAF Key Center according to the BSF\u2019s policy\n10-\tThe NAF Key Center shall behave as follows\na)\tIf the NAF Key Center has requested a USS, and the USS indicates to the NAF Key Center that the key establishment procedure is not allowed for the user, then the NAF Key Center shall respond with appropriate error code and terminate the TLS connection with the Terminal.\nb)\tThe NAF Key Center derives Ks_local from Ks_int_NAF. The NAF Key Center associates a key lifetime to the derived key Ks_local. \nc)\tKs_local is computed as Ks_local = KDF (Ks_int_NAF, B-TID, Terminal_ID, ICCID, Terminal_appli_ID, UICC_appli_ID, RANDx), where KDF is the key derivation function as specified in Annex A.\nEditor\u2019s note: \tIf two applications on the UICC or on the Terminal have the same application identifier then Ks_local will be the same for the two applications. It is FFS whether this is possible.\n11-\tThe NAF Key Center sends within HTTPS tunnel a response message to the Terminal with the following payload: B-TID, Ks_local, Key Lifetime\n12-\tThe Terminal stores Ks_local and associated parameters Key Lifetime, ICCID, Terminal_appli_ID, UICC_appli_ID\n\n\n\n\n\n\n\n\n\nFigure 4-3: Key establishment procedure\n\nAnnex A (normative):\nKey Derivation Function definition\nA.1\t\tKs_local key derivation in key establishment\nThe description of key derivation function KDF can be found in TS\u00a033.220 [3]. The generic key derivation function and input parameter encoding in this document shall be implemented as defined in TS\u00a033.220\u00a0[3]. \nA.2\t\tInput parameters for Ks_local key derivation \nIn the key establishment between a UICC and a terminal, the input parameters for the key derivation function shall be the following:\nFC = 0x01,\nP0 = B-TID,\nL0 = length of B-TID is variable (not greater that 65535),\nP1 = Terminal_ID,\nL1 = length of Terminal ID is variable (not greater that 65535),\n-\tP2 = ICCID,\n-\tL2 = length of ICCID is variable (not greater that 65535),\n-\tP3 = Terminal_appli_ID,\n-\tL3 = length of Terminal_appli_ID is variable (not greater that 65535),\n-\tP4 = UICC_appli_ID,\n-\tL4 = length of UICC_appli_ID is variable (not greater that 65535),\n-    P5 = RANDx,\n-    L5 = length of RANDx is variable (not greater that 65535).\n\n\nIn case that derived key Ks_local has to be established per platform, the UICC_appli_ID and the Terminal_appli_ID octet strings equal to static ASCII-encoded string \"platform\".\n\n\n*** End of changes ***\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe current key establishment protocol does not provide key confirmation. There is also no mechanism for the home network to set or update the Ks_local Counter value in the UICC. In addition, there are many parameters with undefined lengths\u00a0which creates problems, especially for parameters that passed via APDUs to the UICC. It is also specified that the Ks_local may be deleted from the Terminal at power down or when the UICC is changed which is undesirable.\n\n>>> SUMMARY OF CHANGE\nMutual key confirmation is added to the protocol. Also, the Ks_local Counter value is generated in the NAF Key Center and passed to the UICC during each run of the key establishment protocol. To accommodate these two changes the order of the message flow is changed so that delivery of Counter Limit to the UICC can be combined with key confirmation for better efficiency. In addition, the new message flow means that the UICC does not derive Ks_local until the terminal has successfully obtained Ks_local from the NAF Key Center. Parameter lengths for Terminal_ID, ICCID, and application IDs are also defined. It is also specified that Ks_local should not be deleted from the Terminal when the Terminal is powered down or when the UICC is changed. Some editorial changes are also made. In particular, the Counter name is changed to \"Counter Limit\".\n\n>>> CONSEQUENCES IF NOT REVISED\nIf key confirmation is not added, this increases the complexity of the SCP secure channel specification and leads to inefficiencies in secure channel setup since key mismatches would only be detected at a later stage. If the NAF key Center does not generate the Counter Limit, then the UICC has to be preset with a default value and the network cannot easily control this value for each Ks_local. The only alternative way for the network to update this Counter value would be using OTA methods. If the order of the protocol is not changed but the above two changes are accepted then this leads to additional messages in the protocol flow which could otherwise be avoided. If parameter lengths are not restricted then APDU commands need to be able to handle overly large values, wasting space in these constrained data units. If Ks_local is deleted from the Terminal at power down or when the UICC is changed, then this unnecessarily restricts the use cases of the key establishment mechanism."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n5.3.3.2\tEncryption for topology hiding\nUpon receiving an outgoing request/response from the hiding network the I-CSCF(THIG) shall perform the encryption for topology hiding purposes, i.e. the I-CSCF(THIG) shall:\n1)\tuse the whole header values which were added by one or more specific entity of the hiding network as input to encryption, besides the UE entry;\n2)\tnot change the order of the headers subject to encryption when performing encryption;\n3)\tuse for one encrypted string all received consecutive header entries subject to encryption, regardless if they appear in separate consecutive headers or if they are consecutive entries in a comma separated list in one header;\n4)\tconstruct an NAI in the form of 'username@realm',where the username part is the encrypted string, and the realm is the name of the encrypting network;\n5)\tappend a \"tokenized-by=\" tag and set it to the value of the encrypting network's name, after the constructed NAI;\n6)\tform one valid entry for the specific header out of the resulting NAI, e.g. prepend \"SIP/2.0/UDP\" for Via headers or \"sip:\" for Route and Record-Route headers; and\n7)\tif the I-CSCF(THIG) encrypted an entry in the Route header, then it also inserts its own URI before the topmost encrypted entry.\n\nNOTE\u00a01:\tEven if consecutive entries of the same network in a specific header are encrypted, they will result in only one encrypted header entry. For example:\nVia: SIP/2.0/UDP icscf1_s.home1.net;lr, \n\t SIP/2.0/UDP Token(\tSIP/2.0/UDP scscf1.home1.net;lr, \n\t\t\t\t\t\t\tSIP/2.0/UDP pcscf1.home1.net;lr)@home1.net;\n\t\t\t\t\t\t\t\t\t\ttokenized-by=home1.net, \n\t SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]\n\nNOTE\u00a02:\tIf multiple entries of the same network are within the same type of headers, but they are not consecutive, then these entries will be tokenized to different strings. For example:\nRecord-Route:\tsip:icscf1_s.home1.net;lr, \n\t\t\t\tsip:Token(sip:scscf1.home1.net;lr)@home1.net;tokenized-by=home1.net,\n\t\t\t\tsip:as1.foreign.net;lr, \n\t\t\t\tsip:Token(sip:scscf1.home1.net;lr, \n\t\t\t\t\t\t  sip:pcscf1.home1.net;lr)@home1.net;tokenized-by=home1.net\n\nNOTE\u00a03:\tIf request will return to the hiding network (e.g. after visiting an AS), then I-CSCF(THIG) URI is inserted. For example:\nRoute: sip:as1.foreign.net;lr,\n\t\t\t\tsip:icscf1_s.home1.net;lr,\n\t\t\t\tsip:Token(sip:scscf1.home1.net;lr)@home1.net;tokenized-by=home1.net\n\n***************** NEXT MODIFIED SECTION *************************\n5.3.3.3\tDecryption for Topology Hiding\nUpon receiving and incoming requests/response to the hiding network the I-CSCF(THIG) shall perform the decryption for topology hiding purposes, i.e. the I-CSCF shall:\n1)\tidentify NAIs encrypted by the network this I-CSCF belongs to within all headers of the incoming message;\n2)\tuse the user part of those NAIs that carry the identification of the hiding network within the value of the tokenized-by tag as input to decryption;\n3)\tuse as encrypted string the user part of the NAI which follows the sent-protocol (for Via Headers, e.g. \"SIP/2.0/UDP\") or the URI scheme (for Route and Record-Route Headers, e.g. \"sip:\");\n4)\treplace all content of the received header which carries encrypted information with the entries resulting from decryption.\nEXAMPLE:\tAn encrypted entry to a Via header that looks like:\nVia:\t\tSIP/2.0/UDP Token(SIP/2.0/UDP scscf1.home1.net;lr, \nSIP/2.0/UDP pcscf1.home1.net;lr)@home1.net;tokenized-by=home1.net\n\nwill be replaced with the following entries:\nVia: SIP/2.0/UDP scscf1.home1.net;lr, SIP/2.0/UDP pcscf1.home1.net;lr\n\nNOTE:\tMotivations for these decryption procedures are e.g. to allow the correct routeing of a response through the hiding network, to enable loop avoidance within the hiding network, or to allow the entities of the hiding network to change their entries within e.g. the Record-Route header.\n***************** NEXT MODIFIED SECTION *************************\n7.2A.3.2\tSyntax\nThe syntax for the tokenized-by parameter is specified in table\u00a07.6:\nTable\u00a07.6: Syntax of tokenized-by-param\n\n\n\n\n\nuri-parameter =  transport-param / user-param / method-param\n/ ttl-param / maddr-param / lr-param / tokenized-by-param / other-param\ntokenized-by-param = \"tokenized-by\" EQUAL hostname\n\n\nThe BNF for uri-parameter is taken from IETF RFC\u00a03261\u00a0[26] and modified accordingly.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrent processing of the Via to perform THIG tokenisation in the IBCF subclause breaks RFC 3261.\n\n>>> SUMMARY OF CHANGE\nText is aligned with the RFC requirement\n\n>>> CONSEQUENCES IF NOT REVISED\nTHIG tokenisation mechanism breaks RFC 3261"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n********************* Start of 1st change *************************\n3.3\tAbbreviations\nFor the purposes of the present document, the abbreviations given in 3GPP TR\u00a021.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR\u00a021.905\u00a0[1].\nAEF\tAPI Exposing Function\nAPI\tApplication Programming Interface\nCAPIF\tCommon API Framework\n\nJSON\tJavaScript Object Notation\nJWT\tJSON Web Token\nKDF\tKey Derivation Function\nPKI\tPublic Key Infrastructure\nPSK\tPre-Shared Key\nTLS\tTransport Layer Security\n********************* Start of 2nd change *************************\n6.5.2.3\tMethod 3 \u2013 TLS with OAuth token \nThis method details establishment of secure channel over CAPIF-1e, CAPIF-2e reference points, and uses the OAuth 2.0 [4] token based mechanism to authorize and honour API invoker's northbound API invocations to the API exposing function. Figure 6.5.2.3-1 details security information flows between the API invoker, the CAPIF core function and the API exposing function. It is assumed that the API invoker, the CAPIF core function and the AEF are pre-provisioned with the appropriate credentials and related information to establish a secure session.\nAs per OAuth 2.0 [4], the CAPIF core function shall perform the functionalities of the Authorization and token protocol endpoints, the API invoker shall perform the functions of the resource owner, client and redirection endpoints functionalities, while the API exposing function shall perform the resource server functions. The API invoker client (Client endpoint) shall be registered as a confidential client type with an authorization grant type of \u2018client credentials'. The access token shall be a bearer type (IETF RFC 6750 [5]) encoded as a JSON Web Token as specified in IETF RFC\u00a07519 [6], shall be protected by the JSON signature profile as specified in IETF RFC 7515 [7] and shall be validated per OAuth 2.0 [4], IETF RFC 7519 [6] and IETF RFC 7515 [7]. \nEditor's Note: The access token profile for method 3 is FFS.\n\nFigure 6.5.2.3-1: CAPIF-2e interface authentication and protection using Access Tokens\n1. CAPIF-1e authentication and secure session establishment is performed as specified in subclause 6.3.1. \n2. After successful establishment of TLS session over CAPIF-1e, as described in subclause 6.3.1 of the present document, the API invoker shall send an Access Token Request message to the CAPIF core function as per the OAuth 2.0 [4] specification. \n3. The CAPIF core function shall verify the Access Token Request message asper OAuth 2.0 [4] specification.\n4. If the CAPIF core function successfully verifies the Access Token Request message, the CAPIF core function shall generate an access token specific to the API invoker and return it in an Access Token Response message. \nNOTE 1:\tThe API invoker may include the CAPIF core function assigned API invoker ID and the Onboard_Secret in the OAuth access token request message for the CAPIF core function to validate the access token request.\nNOTE 2: Steps 1 to 4 of this procedure are not required if the API invoker is already in possession of a valid OAuth access token. In this case, the API invoker begins the procedure at step 5.\n5. On CAPIF-2e, the API invoker authenticates to the AEF by establishing a TLS session with the API exposing function based on the authentication and authorization method (i.e. Server (AEF) side certificate authentication or certificate-based mutual authentication) as indicated by CAPIF core function. The following procedure shall be performed prior to establishment of TLS session. \nThe API invoker shall send Authentication Initiation Request to the AEF, including API invoker ID.\n\tThe AEF shall request for security information from the CAPIF Core Function to perform authentication and secure interface establishment with the API invoker. The CAPIF Core Function provides the security information related to the chosen security method (TLS with OAuth token) to the AEF over CAPIF-3 reference point. The CAPIF core function may return API invoker's root CA certificate for the AEF to validate the API invoker's certificate.\n \tAfter fetching the relevant security information for the authentication, the AEF shall send Authentication Initiation Response message to API invoker to initiate the TLS session establishment procedure.\n6. With successful authentication to the AEF on CAPIF-2e, the API invoker shall initiate invocation of a 3GPP northbound API with the AEF. The access token received from the CAPIF core shall be sent along with the northbound API invocation request as per OAuth 2.0 [4].\n7. The API exposing function shall validate the access token. If validation of the access token is successful, the AEF shall verify the API invoker's Northbound API invocation request against the authorization claims in access token, ensuring that the API Invoker has access permission for the requested service API.\n8. After successful verification of the access token and authorization claims of the API invoker, the requested northbound API shall be invoked and the appropriate response shall be returned to the API invoker.\n********************* Start of 3rd change *************************\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n-1: Access token standard claims\n\n\n\n\n\n\n\n\n\n\n\nequest required parameters\n\n\n\n\n\nesponse parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nEditor\u2019s note in clause 6.5.2.3 indicates the format of the access token for CAPIF-2/2e authentication and authorisation is undefined.\n\n>>> SUMMARY OF CHANGE\nAdd an annex to TS 33.122 which defines the access token.Address publisher\u2019s comment in Note 2 of clause 6.5.2.3.Add CCF (CAPIF Core Function) abbreviation.\n\n>>> CONSEQUENCES IF NOT REVISED\nCAPIF authentication and authorisation on the CAPIF-2/2e interface risks interoperability issues without a common access token format."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n************ Start of change **********\n4.5.4.4\tUE ePDG Selection Procedure\nThe UE shall perform ePDG selection by executing the steps below. Unless otherwise specified, when the UE attempts to select an ePDG, the UE shall construct an FQDN for this ePDG as specified in clause\u00a04.5.4.2 and shall use the DNS server function to obtain the IP address(es) of this ePDG.:\n1)\tThe UE shall determine the country it is located in. This is determined by implementation-specific methods not defined in this specification.\n2)\tIf the UE determines to be located in its home country, then:\na)\tThe UE shall select an ePDG in the HPLMN. If the ePDG selection information contains the HPLMN, the UE shall construct an FQDN as specified in clause\u00a04.5.4.2. If the ePDG selection information does not contain the HPLMN and the UE is configured with the ePDG identifier defined in bullet 1) of clause\u00a04.5.4.3, then the UE shall either use the configured FQDN and use the DNS server function to obtain the IP address(es) of the ePDG(s) in the HPLMN, or the UE shall use the configured IP address. Otherwise, the UE shall construct an Operator Identifier FQDN and shall use the DNS server function to obtain the IP address(es) of the ePDG(s) in the HPLMN.\nb)\tIf the UE cannot select an ePDG in the HPLMN, then the UE shall stop the ePDG selection.\n3)\tIf the UE determines to be located in a country other than its home country (called the visited country), then:\na)\tIf the UE is registered via 3GPP access to a PLMN and this PLMN matches an entry in the ePDG selection information, then the UE shall select an ePDG in this PLMN.\nb)\t\nIn all other cases, (e.g. when the UE is not configured with the ePDG selection information, or the UE is registered via 3GPP access to a PLMN but this PLMN does not match an entry in the ePDG selection information, or the UE is not registered via 3GPP access to any PLMN), the UE shall select an ePDG by performing the DNS procedure specified in clause\u00a04.5.4.5.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nDNS procedures are to be used to determine if a country has a ePDG(s) to be used. However there are circumstances when DNS procedures might fail but there is still a valid ePDG to be used.  In cases where:- the DNS server isn\u2019t upgraded to indicate the ePDG selection policy;- the DNS server is located in a different country;- the DNS server\u2019s operator doesn\u2019t answer to the country\u2019s regulator;- the DNS server is incorrectly configured;the UE may not get service, however the UE may have performed access authentication over WLAN (as specified in e.g. 4.8.2b, 3GPP-based access authentication) with a PLMN A in the same country it is in, preferably selects an ePDG of that PLMN A.\n\n>>> SUMMARY OF CHANGE\nAllow a UE to select an ePDG with which it has authenticated, if the PLMN\u2019s MCC matches the country the UE is in and if the PLMN matches an entry in the ePDG selection information.\n\n>>> CONSEQUENCES IF NOT REVISED\nA UE configured to select PLMN A when using WLAN, may not select an ePDG at that PLMN. In cases where:- the DNS server isn\u2019t upgraded to indicate the ePDG selection policy;- the DNS server is located in a different country;- the DNS server\u2019s operator doesn\u2019t answer to the country\u2019s regulator;- the DNS server is incorrectly configured;the UE may not get service."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nIntroduction\nTS 33.179 currently describes the KMS as part of the Common Services Core (CSC) where the KMS is connected to KM clients via the MCPTT proxy.  However using the proxy for key management is optional and in some deployments the KMS might not even be located within the CSC.\nIn addition, if the proxy is used then a security vulnerability is possible.  Although both HTTP connections (KM Server to the proxy and KM client to the proxy) are protected with HTTPS, the key material when transitioning through the proxy, may be in the clear.  If the proxy were breached, all individual key material (and therefore individual, group and signalling keys) could be captured.  While 33.179 defines a Transport Key (TrK) to protect key material during this transfer, the use of the TrK is currently optional.\nThis CR is meant to address the key management architecture when the proxy is not used, and is also meant to address the possible security vulnerability in the proxy.\nTherefore the primary 33.179 changes proposed are:\nIf the proxy is used, then the use of the TrK is mandatory.\nIf the KMS does not use the proxy, then the HTTP connection is a direct connection between the KMS and the KM client, and is secured with HTTPS.  Use of the TrK is optional in this deployment.\n\n************* Start of change 1 ********************************************\n7.2.2\tFunctional model for Key Management\n7.2.2.0\t\tGeneral\nWithin the MCPTT architecture, the MCPTT Key Management Server (KMS) provisions key material associated with a specific MCPTT identity. The MCPTT KMS sits within the Common Services Core (CSC) has interfaces with the key management clients. A key management client is responsible for making requests for identity-specific key material. Key provisioning clients are located in the MCPTT UE, in the MCPTT Server and in the group management server.\nThe reference points for the MCPTT KMS are shown in Figure 7.2.2.0-1.\n\nFigure 7.2.2.0-1: Reference Points for MCPTT Key Management Server\nFigure 7.2.2.0-1 shows the CSC-8, CSC-9 and CSC-10 reference points for the MCPTT Key Management Server within the MCPTT system. \n\n\n\n7.2.2.1\tReference point CSC-8 (between key management server and the key management client within the MCPTT UE)\nThe CSC-8 reference point, between the key management client in the MCPTT UE and the MCPTT KMS, provides identity-specific key material to the MCPTT UE.\n \nCSC-8 shall use the HTTP-1 and HTTP-3 reference point.\n7.2.2.2\tReference point CSC-9 (between the key management server and the key management client within the MCPTT Server)\nThe CSC-9 reference point, which exists between the MCPTT key management server and the MCPTT Server, is used, where necessary, to provide the MCPTT Server with identity-specific key material to allow the MCPTT Server to be involved in end-to-end secure communications. \n\nCSC-9 shall use the HTTP-2 and HTTP-3 reference point for the transport of key material.\n7.2.2.3\tReference point CSC-10 (between the key management server and the key management client within a group management server)\nThe CSC-10 reference point, which exists between the MCPTT key management server and a group management server, is used to provide the group management server with identity-specific key material to allow the group management server to distribute key material to support group communications. \n\nCSC-10 shall use the HTTP-2, HTTP-3 and HTTP-4 signalling reference points for the transport of key material.\n7.2.3\tSecurity procedures for key management\nThe procedure for the provision of identity-specific key material is described in Figure 7.2.3-1. The procedure is the same whether the key management client in the MCPTT UE, MCPTT Server or group management server is making the request.\n\n\nFigure 7.2.3-1: Provisioning of key material\nThe procedure in Figure 7.2.3-1 is now described step-by-step. \n0.\tThe key management client establishes a connection to the MCPTT KMS. As with other elements in the Common Services Core, the connection routed via, and secured by, the HTTP Proxy. The message flow below is within this secure connection.\nNOTE: Additionally, the connection between the MCPTT KMS and the HTTP Proxy is secured according to Clause 8.\n1.\tThe key management client makes a request for user key material from the MCPTT KMS. The request contains details of the identity requested for key management, and the time at which the key material is required.\n2.\tThe KMS provides a response containing key material. The response includes the type of key material, the period of use for the material and any domain-specific parameters required for its use. Optionally, the key material itself may also be wrapped using a transport key (TrK), distributed via an out-of-band mechanism from KMS to the key management client.\n\n\n\n\n\n\n\nAs a result of this procedure, the key management client has securely obtained key material for use within the MCPTT system.\n************* End of change 1 *********************************************\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe transfer of keys from the KM server to the KM client could be exposed in the proxy.\n\n>>> SUMMARY OF CHANGE\nClose this security vulnerability by clarifying the KMS to KM client security structure.\n\n>>> CONSEQUENCES IF NOT REVISED\nSecurity of individual calls, group calls and signaling plane could be compromised."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n12.3.0\tGeneral\nIn the Single Radio access transfer procedures the SCC AS shall only consider sessions that have the necessary media components that meet the criteria for performing Single Radio access transfer as defined in subclause\u00a04.2.2.\n\n\n\n***** Next change *****\n12.3.1\tSCC AS procedures for PS to CS access transfer, PS to CS SRVCC\nWhen the SCC AS receives a SIP INVITE request due to STN-SR on the Target Access Leg the SCC AS shall associate the SIP INVITE request with a session:\n-\twithin the transferable session set;\n-\twith active speech media component that was most recently made active; and\n-\tthe related dialog is in confirmed state.\nIf no confirmed dialogs supporting a session with active speech media component exists in the transferable session set the SCC AS shall:\n1)\tsend a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request due to STN-SR;\n2)\tif the transferable session set contains dialogs supporting sessions with speech media component (inactive speech media component or in an early dialog state):\na)\tif the speech media component is the only media component in the dialog then release the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]; and\nb)\tif the speech media component is not the only media component in the dialog then modify the remote leg and remove the speech media component as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2].\nIf confirmed dialogs supporting a session with active speech media component exist in the transferable session set the SCC AS shall:\n1)\tsend a SIP re-INVITE request towards the remote UE and in a new SDP offer, include the media characteristics as received in the SIP INVITE request due to STN-SR, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2]; or\n2)\tsend a SIP re-INVITE request towards the remote UE according to the conditions depicted in subclause 12.3.5 and in a new SDP offer, include the media characteristics as received in the SIP INVITE request due to ATU-STI for PS to CS SRVCC, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2].\nUpon receiving the SIP 2xx response to the SIP re-INVITE request the SCC AS shall send the SIP 200 (OK) response to the SIP INVITE request due to STN-SR on the target access leg by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP 200 (OK) response to the SIP INVITE request due to STN-SR as follows:\n1)\tinclude SDP answer containing the relevant media parameter of the SDP answer in the received response;\n2)\tif the SCC AS supports the PS to CS SRVCC of calls in alerting phase, include the g.3gpp.srvcc-alerting feature-capability indicator as described in annex\u00a0C in the Feature-Caps header field according to IETF\u00a0RFC\u00a06809\u00a0[60]; and\n3)\tinclude the signalling elements described in subclause\u00a06A.4.3A.\nIf the SCC AS supports the PS to CS SRVCC for calls in alerting phase and if the conditions specified in subclause\u00a012.3.4.1 for a session in the transferable session set are fulfilled, the SCC AS shall follow the procedures in the subclause\u00a012.3.4.4 and then continue with the procedures in this subclause.\n\nThe SCC AS shall remove non-transferred audio components and superfluous session as specified in subclause\u00a012.3.8.\n\n***** Next change *****\n12.3.2.2\tTransfer of the first session\nWhen the SCC AS applies the MSC Server assisted mid-call feature for transfer of the first session the SCC AS shall select the first session to transfer as follows.\nThe first session to transfer is a session in the transferable session set such that:\n1.\tif one or more confirmed dialog supporting a session with active speech media component exists in the transferable session set then:\n-\tselect the confirmed dialog supporting a session with the active speech media component which became active most recently; and\n2.\tif no confirmed dialog supporting a session with active speech media component exists in the transferable set but one or more confirmed dialogs supporting a session with inactive speech media component exists for the user then:\n-\tselect the confirmed dialog supporting a session with inactive speech media component that became inactive most recently.\nIf the speech media component of the SDP offer in the SIP INVITE request due to ATU-STI is the same as the speech media component of the SDP negotiated by the ATCF in the first session to transfer, the SCC AS shall send a SIP 200 (OK) response to the SIP INVITE request. The SCC AS shall populate the SIP 200 (OK) response to the SIP INVITE request as follows:\n1)\tinclude SDP answer containing the speech media component of the SDP negotiated by SCC AS towards ATCF in the first session to transfer;\n2)\tinclude:\n-\tthe g.3gpp.mid-call feature-capability indicator as described in annex\u00a0C; and\n-\tif the SCC AS supports the PS to CS SRVCC of calls in alerting phase, the g.3gpp.srvcc-alerting feature-capability indicator as described in annex\u00a0C;\n\tin the Feature-Caps header field according to IETF\u00a0RFC\u00a06809\u00a0[60]; and\n3)\tinclude the signalling elements described in subclause\u00a06A.4.3A.\nIf the speech media component of the SDP offer in the SIP INVITE request due to ATU-STI is different from the speech media component of the SDP negotiated by the ATCF in the first session to transfer or if the SIP INVITE request due to STN-SR was received, the SCC AS shall send a SIP re-INVITE request towards the remote UE with a new SDP offer, such that: \n1)\tif a session with the confirmed dialog supporting a session with active speech media component was selected, include the media characteristics as received in the SIP INVITE request due to STN-SR, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2]; and\n2)\tif a session with the confirmed dialog supporting a session with inactive speech media component was selected then include an SDP offer describing the audio media streams as negotiated in the session with the remote UE and:\n-\tif directionality used by SC UE is \"sendrecv\" or \"sendonly\", with the \"sendonly\" directionality; and\n-\tif directionality used by SC UE is \"recvonly\" or \"inactive\", with the \"inactive\" directionality.\nUpon receiving the SIP 2xx response to the SIP re-INVITE request the SCC AS shall:\n1)\tsend the SIP 200 (OK) response to the SIP INVITE request due to STN-SR on the target access leg populated as follows:\na)\tin the SDP answer, use the relevant media parameter of the SDP answer in the received response;\nb)\tinclude:\n-\tthe g.3gpp.mid-call feature-capability indicator as described in annex\u00a0C; and\n-\tif the SCC AS supports the PS to CS SRVCC of calls in alerting phase, the g.3gpp.srvcc-alerting feature-capability indicator as described in annex\u00a0C;\n\tin the Feature-Caps header field according to IETF\u00a0RFC\u00a06809\u00a0[60]; and\nc)\tinclude the signalling elements described in subclause\u00a06A.4.3A.\n\nUpon receiving the SIP ACK request related to the SIP 200 (OK) response to the SIP INVITE request and if:\n1)\tthe session associated with the SIP INVITE request due to STN-SR is related to a subscription as described in subclause\u00a07.3.3; and\n2)\ta SIP 2xx response was received to the last SIP NOTIFY request with conference information sent to the UE within the related subscription;\nthen the SCC AS shall send a SIP INFO request towards the MSC Server as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] and IETF\u00a0RFC\u00a06086\u00a0[54] in the dialog created by the SIP INVITE request due to STN-SR. The SCC AS shall populate the SIP INFO request as follows:\n1)\tinclude the Info-Package header field as specified in IETF\u00a0RFC\u00a06086\u00a0[54] with g.3gpp.mid-call package name; and\n2)\tinclude application/vnd.3gpp.mid-call+xml XML body associated with the info package according to IETF\u00a0RFC\u00a06086\u00a0[54] and containing the participants extracted as specified in the subclause\u00a09.1A of the subscription related to the session associated with the SIP INVITE request due to STN-SR as described in subclause\u00a07.3.3.\nUpon receiving the SIP 2xx response to the SIP INFO request or receiving the ACK related to the SIP 200 (OK) response to the SIP INVITE request when the SIP INFO request was not sent, the SCC AS shall:\n-\tif one more confirmed SIP dialogs supporting a session with speech media component exist in the transferable session set transfer the additional second confirmed SIP dialog as described in subclause\u00a012.3.2.3 and then continue with the procedures in this subclause; and\n-\tif no more confirmed SIP dialog supporting a session with speech media component exist in the transferable session set but SCC AS support the PS to CS SRVCC for calls in alerting phase and the conditions in the subclause\u00a012.3.4.1 are fulfilled, perform the actions in subclause\u00a012.3.4.4 and then continue with the procedures in this subclause.\nThe SCC AS shall remove non-transferred audio components and superfluous session as specified in subclause\u00a012.3.8.\n***** Next change *****\n12.3.2.3\tTransfer of an additional session\nWhen the SCC AS applies the MSC Server assisted mid-call feature for transfer of the additional session the SCC AS shall select the additional session to transfer as a session in the transferable session set such that:\n1.\tif more than one confirmed dialog supporting a session exists in the transferable session set, and exactly one confirmed dialog supporting a session with active speech media component exists and there is at least one remaining confirmed dialog supporting a session with inactive speech media component then:\n-\tselect the confirmed dialog supporting a session with inactive speech media component that became inactive most recently; and\n2.\tif more than one confirmed dialog supporting a session with active speech media component exists in the transferable session set then:\n-\tselect the confirmed dialog supporting a session with the active speech media component which became active second most recently.\nWhen the SCC AS transfers the selected additional session the SCC AS shall: \nA)\tsend a SIP REFER request towards the MSC Server in accordance with the procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[2], IETF\u00a0RFC\u00a04488\u00a0[20] and IETF\u00a0RFC\u00a03515\u00a0[13] as updated by IETF\u00a0RFC\u00a06665\u00a0[81] and draft-ietf-sipcore-refer-clarifications\u00a0[90] in the dialog created by the SIP INVITE request due to STN-SR. ; or send a SIP REFER request towards the ATCF in accordance with the procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[2], IETF\u00a0RFC\u00a04488\u00a0[20] and IETF\u00a0RFC\u00a03515\u00a0[13] as updated by IETF\u00a0RFC\u00a06665\u00a0[81] and draft-ietf-sipcore-refer-clarifications\u00a0[90] in the dialog created by the SIP INVITE request due to ATU-STI for PS to CS SRVCC. The SCC AS shall populate the SIP REFER request as follows:\n1.\tthe Refer-Sub header field with value \"false\" as specified in IETF\u00a0RFC\u00a04488\u00a0[20];\n2.\tthe Supported header field with value \"norefersub\" as specified in IETF\u00a0RFC\u00a04488\u00a0[20];\n3.\tthe Refer-To header field containing the additional transferred session SCC AS URI for PS to CS SRVCC and the following URI header fields containing information related to the additional transferred session:\na.\tthe Target-Dialog URI header field populated as specified in IETF\u00a0RFC\u00a04538\u00a0[11], containing the dialog identifier of the session with the SC UE;\nb.\tthe Require URI header field populated with the option tag value \"tdialog\";\nc.\tthe To URI header field populated as specified in IETF\u00a0RFC\u00a03261\u00a0[19], containing the P-Asserted-Identity provided by the remote UE during the session establishment;\nd.\tthe From URI header field populated as specified in IETF\u00a0RFC\u00a03261\u00a0[19], containing the public user identity of the SC UE provided during the session establishment;\ne.\tthe Content-Type header field with \"application/sdp\"; and\nf.\tthe \"body\" URI header field populated with an SDP body describing the media streams as negotiated in the session with the remote UE and:\n-\tif directionality used by SC UE is \"sendrecv\" or \"sendonly\", with the \"sendonly\" directionality; and\n-\tif directionality used by SC UE is \"recvonly\" or \"inactive\", with the \"inactive\" directionality;\n4.\tthe Content-Type header field with the value set to MIME type as specified in the subclause\u00a0D.1.3;\n5.\ta XML body compliant to the XML schema specified in the subclause\u00a0D.1.2;\n6.\tif:\na.\tthe session associated with the SIP INVITE request due to STN-SR, is not related to any subscription as described in subclause\u00a07.3.3;\nb.\tthe additional transferred session is related to a subscription as described in subclause\u00a07.3.3; and\nc.\ta SIP 2xx response was received to the last SIP NOTIFY request with conference information sent to the SC UE within the related subscription;\n\tthen SCC AS shall populate the XML body with the participants extracted as specified in the subclause\u00a09.1A of the subscription related to the additional transferred session as specified in subclause\u00a07.3.3; and\n7.\tif:\na.\tSCC AS supports CS to PS SRVCC;\nb.\tthe SIP INVITE request due to STN-SR contains Accept header field with application/vnd.3gpp.srvcc-ext+xml MIME type;\nc.\ta private user identity of a UE (i.e. other than those according to 3GPP\u00a0TS\u00a023.003\u00a0[12], subclause 20.3.3) is associated with the C-MSISDN in the P-Asserted-Identity header field of the SIP INVITE request due to STN-SR;\nd.\ta binding of a contact address exists for the private user identity of the UE:\ni)\twhere the g.3gpp.cs2ps-srvcc media feature tag is associated with the contact address of the UE; and\nii)\tsuch that SIP REGISTER request which registered the binding contained a Feature-Caps header field with the g.3gpp.atcf feature-capability indicator and with g.3gpp.cs2ps-srvcc feature-capability indicator;\ne.\tthe CS to PS SRVCC capability indication is indicated for the private user identity of the UE; and\nf.\tthe private user identity of the UE has the CS to PS SRVCC allowed indication in the subscription data;\n\tthen:\na.\ta MIME body of application/vnd.3gpp.srvcc-ext+xml MIME type:\ni)\tcontaining ATU management URI of the ATCF serving the SC UE;\nNOTE\u00a01:\tThe ATCF management URI of the ATCF is the URI contained in the g.3gpp.atcf-mgmt-uri feature-capability indicator included in a Feature-Caps header field of the SIP REGISTER request, which registered the binding for the private user identity of the UE. \nii)\tcontaining C-MSISDN; and.\niii)\tnot indicating that information relate to a registration of MSC server with IMS.\nWhen the SCC AS receives the SIP INVITE request transferring additional session for PS to CS SRVCC, the SCC AS shall:\n1)\tassociate the SIP INVITE request transferring additional session for PS to CS SRVCC with a previously established SIP dialog i.e. identify the source access leg;\nNOTE\u00a02:\tThe SIP dialog on the source access leg is identified by matching the dialog present in the Target-Dialog header field (see IETF\u00a0RFC\u00a04538\u00a0[11]) of the SIP INVITE request transferring additional session for PS to CS SRVCC with the previously established SIP dialog.\nNOTE\u00a03:\tBy a previously established SIP dialog, it is meant a dialog for which a SIP 2xx response to the initial SIP INVITE request has been sent or received.\n2)\tif the SCC AS is unable to associate the SIP INVITE with a unique previously established SIP dialog, send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request relating to the access transfer and not processes the remaining steps;\n3)\tif the number of media lines in the target access leg is less than the number of media lines in the source access leg or the media type for the corresponding media lines is not the same as in the original session, send a SIP 404 (Not Found) response to reject the SIP INVITE request relating to the access transfer and not process the remaining steps; and\n4)\tsend a SIP re-INVITE request towards the remote UE using the existing established dialog. The SCC AS shall populate the SIP re-INVITE request with a new SDP offer, following the rules specified in 3GPP\u00a0TS\u00a024.229\u00a0[2], containing the following media information:\nA)\tthe media characteristics as received in the SIP INVITE request transferring additional session for PS to CS SRVCC for media streams whose port is not set to zero; and\nB)\tfor the media streams in the SIP INVITE request transferring additional session for PS to CS SRVCC whose port is set to zero, include the corresponding media characteristics of those streams from the source access leg.\nUpon receiving the SIP 2xx response to the SIP re-INVITE request the SCC AS shall send the SIP 200 (OK) response to the SIP INVITE request transferring additional session for PS to CS SRVCC on the target access leg populated as follows:\n1)\tuse the relevant media parameter of the SDP answer in the received response;\n2)\tinclude the g.3gpp.mid-call feature-capability indicator as described in annex\u00a0C in the Feature-Caps header field; and\n3)\tinclude the signalling elements described in subclause\u00a06A.4.3A.\n\n\n***** Next change *****\n12.3.3.1\tPS to CS SRVCC cancelled by MME/SGSN or failure by UE to transition to CS domain for ongoing session\nWhen the SCC AS receives a SIP re-INVITE request containing Reason header field containing protocol \"SIP\" and reason parameter \"cause\" with value \"487\" on\n-\tthe original source access leg; or \n-\tthe original source access leg of the additional transferred session if the SCC AS applies the MSC Server assisted mid-call feature;\nafter:\na)\thaving initiated an access transfer that was triggered by a SIP INVITE request due to STN-SR and the SIP INVITE request due to STN-SR transaction is not yet completed; or\nb)\thaving initiated an access transfer that was triggered by a SIP INVITE request due to ATU-STI for PS to CS SRVCC and the SIP INVITE request due to ATU-STI for PS to CS SRVCC transaction is not yet completed;\nthen the SCC AS shall wait until this transaction has completed and then continue with the steps 1) and 2) described below.\nWhen the SCC AS receives a SIP re-INVITE request(s) containing protocol \"SIP\" and reason parameter \"cause\" with value \"487\" after:\na)\thaving performed an access transfer that was triggered by a SIP INVITE request due to STN-SR; or\nb)\thaving performed an access transfer that was triggered by a SIP INVITE request due to ATU-STI for PS to CS SRVCC;\nthen the SCC AS shall:\n1)\tnot release the original source access leg once the expiration of the timer described in subclause\u00a012.3.8; and\n2)\ttreat the SIP re-INVITE request(s) as per procedures for removing and adding media as described in subclause\u00a013.3.1.\nNOTE: \tThe SCC AS assigns an operator specific timer to delay the release of the Source Access Leg for PS to CS SRVCC access transfer.\nWhen the SCC AS receives a SIP response to the SIP re-INVITE request indicating success in removing all media components from a dialog that was created:\na)\tdue to the SIP INVITE request due to STN-SR; or\nb)\tdue to the SIP INVITE request due to ATU-STI for PS to CS SRVCC; \nthen the SCC AS shall send a SIP BYE request on this dialog, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2].\n***** Next change *****\n12.3.3.1A\tPS to CS SRVCC cancelled by MME/SGSN or failure by UE to transition to CS domain for session in early dialog state\nIf the SCC AS applies the procedures for the PS to CS SRVCC for calls in alerting phase or the PS to CS SRVCC for originating calls in pre-alerting phase (as specified in subclause\u00a012.3.4), then when the SCC AS receives a SIP UPDATE request containing Reason header field containing protocol \"SIP\" and reason parameter \"cause\" with value \"487\" on:\n-\tthe original source access leg; or\n-\tthe original source access leg of the additional transferred session if the SCC AS applies the MSC Server assisted mid-call feature;\nafter having initiated an access transfer that was triggered by:\na)\ta SIP INVITE request due to STN-SR; or\nb)\ta SIP INVITE request due to ATU-STI for PS to CS SRVCC;\nfor a session which is still in early dialog state the SCC AS shall:\n1)\tnot release the original access leg after the expiration of the timer described in subclause\u00a012.3.8; and\n2)\ttreat the SIP UPDATE request(s) as per procedures for removing and adding media as described in subclause\u00a013.3.1.\n\nWhen the SCC AS receives a SIP 200 (OK) response to the SIP UPDATE request, then the SCC AS shall:\n1)\tif the SCC AS has already sent a SIP 200 (OK) response to a SIP INVITE request due to STN-SR or SIP INVITE request due to ATU-STI for PS to CS SRVCC then send a SIP BYE request on this dialog, and \na)\tif the SCC AS performs access transfer for an originating session which is in early dialog state , send a SIP 200 (OK) response to the SIP INVITE on the original source access leg; and\nb)\tif the SCC AS performs access transfer for an additional transferred originating session which is still in early dialog state, send a SIP 200 (OK) response to the INVITE on the original source access leg of the additional transferred session; and\n2)\tif the SCC AS has not sent a SIP 200 (OK) response to a SIP INVITE request due to STN-SR or SIP INVITE request due to ATU-STI for PS to CS SRVCC then send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request due to STN-SR or the SIP INVITE request due to ATU-STI for PS to CS SRVCC.\nIf the SCC AS has received a SIP 200 (OK) response from the SC UE prior to receiving the SIP UPDATE request from the SC UE, then on receipt of the SIP 200 (OK) response to the SIP UPDATE request sent to the remote UE, the SCC AS shall send a SIP 200 (OK) response to the remote UE. Upon receiving the SIP ACK request from the remote UE, the SCC AS shall send a SIP ACK request to the SC UE.\n\n***** Next change *****\n12.3.3.4\tPS to CS SRVCC cancelled by MME/SGSN or release of the target access leg for an ongoing session\nThis subclause describes the procedures for cancelling calls after the SCC AS have initiated an PS to CS SRVCC access transfer that was triggered by a SIP INVITE request due to STN-SR, a SIP INVITE request due to ATU-STI or a SIP INVITE request transferring additional session for PS to CS SRVCC for a session where the dialog is in confirmed state with active or inactive speech media component.\nIf the SCC AS receives a SIP BYE request containing a Reason header field containing the protocol value \"Q.850\" and the \"cause\" header field parameter with the value of \"31\" (normal unspecified) on:\n-\tthe target access leg where the dialog is in confirmed state with active speech media component;\n-\tthe target access leg where the dialog is in confirmed state with inactive speech media component, if the SCC AS applies the MSC server assisted mid-call feature;or\n-\tthe target access leg of an additional transferred session where the dialog is in confirmed state with an inactive speech media component, if the SCC AS applies the MSC server assisted mid-call feature,\nafter having initiated an access transfer and when the operator specific timer is still running, the SCC AS shall:\n1)\tsend the SIP 200 (OK) response to the SIP BYE request;\n2)\twait until the operator specific timer expires or until a SIP re-INVITE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received; and\n3)\tif the operator specific timer expires and no SIP re-INVITE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received, release the call according to procedures in 3GPP\u00a0TS\u00a024.229\u00a0[2].\nNOTE\u00a01:\tAll protocol values in the Reason header field other than \"Q.850\" and all values of the \"cause\" header field parameter other than \"31\" (normal unspecified) will result in an immediate release of the source access leg and the remote UE leg.\nNOTE\u00a02: \tThe SCC AS assigns an operator specific timer to delay the release of the source access leg for PS to CS SRVCC access transfers.\nWhen the SCC AS receives SIP re-INVITE request(s) from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" after having performed an access transfer that was triggered by a SIP INVITE request due to STN-SR and after receiving a SIP BYE request containing the Reason header field containing the protocol value \"Q.850\" and the \"cause\" header field parameter with the value \"31\" (normal unspecified) on the target access leg, then the SCC AS shall: \n1)\tnot release the original source access leg on expiry of the timer described in subclause\u00a012.3.8; and\n2)\ttreat the SIP re-INVITE request(s) as per procedures for removing and adding media as described in subclause\u00a013.3.1.\n\n***** Next change *****\n12.3.3.5.1\tSCC AS serving an originating user\nThis subclause describes the procedures for cancelling calls after the SCC AS have initiated an PS to CS SRVCC access transfer that was triggered by a SIP INVITE request due to STN-SR, a SIP INVITE request due to ATU-STI or a SIP INVITE request transferring additional session for PS to CS SRVCC for a session in an early dialog phase as specified in subclause\u00a012.3.4.3 and subclause\u00a012.3.4.4 where the SCC AS is serving a originating user.\nIf the SCC AS applies the procedures for PS to CS SRVCC access transfer for calls in alerting phase when serving a originating user or if the SCC AS applies the procedures for PS to CS SRVCC access transfer for calls in pre-alerting phase, then if the SCC AS receives a SIP BYE request or a SIP CANCEL request containing a Reason header field containing the protocol value \"Q.850\" and the \"cause\" header field parameter with the value \"31\" (normal unspecified) on:\n-\tthe target access leg of a session in the originating pre-alerting phase, if the SCC AS applies PS to CS SRVCC access transfer for calls in pre-alerting phase;\n-\tthe target access leg of a session in the alerting phase, if the SCC AS applies PS to CS SRVCC access transfer for calls in alerting phase; and\n-\tthe target access leg of an additional transferred session in the pre-alerting phase or in the alerting phase, if the SCC AS applies the MSC server assisted mid-call feature; or-\ttarget of an additional transferred session if the SCC AS applies PS to CS SRVCC for calls in the pre-alerting phase or in alerting phase,\nafter having initiated an access transfer for a session which is still in early dialog state when the operator specific timer is still running, the SCC AS shall:\n1)\tif a SIP BYE was received, send the SIP 200 (OK) response to the SIP BYE request;\n1A)\tif a SIP CANCEL request was received, send the SIP 200 (OK) response to the SIP CANCEL request;\n2)\twait until the operator specific timer expires or until a SIP UPDATE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received; and\n3)\tif the operator specific timer expires and no SIP UPDATE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received, cancel the call according to procedures in 3GPP\u00a0TS\u00a024.229\u00a0[2].\nNOTE\u00a01:\tAll protocol values in the Reason header field other than \"Q.850\" and all other values of the \"cause\" header field parameter other than \"31\" (normal unspecified) will result in an immediate release of all dialogs associated with the source access leg and cancelling of all dialogs associated with the remote UE leg.\nNOTE\u00a02: \tThe SCC AS assigns an operator specific timer to delay the release of the source access leg for PS to CS SRVCC access transfers.\nWhen the SCC AS receives a SIP UPDATE request(s) containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" from the SC UE after having performed an access transfer that was triggered by a SIP INVITE request due to STN-SR and after receiving a SIP BYE request or a SIP CANCEL request containing the Reason header field containing the protocol value \"Q.850\" and the \"cause\" header field parameter with the value \"31\" (normal unspecified) on the target access leg, then the SCC AS shall: \n1)\tnot release the original source access leg once the expiration of the timer described in subclause\u00a012.3.8; and\n2)\ttreat the SIP UPDATE request(s) as per procedures for removing and adding media as described in subclause\u00a013.3.1.\n\nIf the SCC AS has received a SIP 200 (OK) response from the SC UE prior to receiving the SIP UPDATE request from the SC UE, then on receipt of the SIP 200 (OK) response to the SIP UPDATE request sent to the remote UE, the SCC AS shall send a SIP 200 (OK) response to the remote UE. Upon receiving the SIP ACK request from the remote UE, the SCC AS shall send a SIP ACK request to the SC UE.\n***** Next change *****\n12.3.3.5.2\tSCC AS serving a terminating user\nThis subclause describes the procedures for cancelling calls after the SCC AS have initiated an PS to CS SRVCC access transfer that was triggered by a SIP INVITE request due to STN-SR, a SIP INVITE request due to ATU-STI or a SIP INVITE request transferring additional session for PS to CS SRVCC for a session in an alerting phase as specified in subclause\u00a012.3.4.2 and subclause\u00a012.3.4.4 where the SCC AS is serving a terminating user.\nIf the SCC AS applies the procedures for PS to CS SRVCC access transfer for calls in alerting phase and when serving a terminating user, then if the SCC AS receives a SIP BYE request or a SIP CANCEL request containing the protocol value \"Q.850\" and the \"cause\" header field parameter with a value different then value \"31\" (normal unspecified) cancelling SIP INVITE request due to STN-SR on:\n-\tthe target access leg of a session in the alerting phase, if the SCC AS applies PS to CS SRVCC for calls in alerting phase;\n-\tthe target access leg of an additional transferred session in the alerting phase, if the SCC AS applies the MSC server assisted mid-call feature; or\n-\ttarget of an additional transferred session in the alerting phase, if the SCC AS applies PS to CS SRVCC for calls in alerting phase,\nafter having initiated an access transfer for a session which is still in the alerting phase when the operator specific timer is still running, then the SCC AS shall:\n1)\tif a SIP BYE was received, send the SIP 200 (OK) to the BYE request;\n1A)\tif a SIP CANCEL request was received, send a SIP 200 (OK) response to the SIP CANCEL request;\n2)\twait until the operator specific timer expires or until a SIP UPDATE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received; and\n3)\tif the operator specific timer expires and no SIP UPDATE request from the SC UE containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" is received then:\na)\tsend a SIP 486 (Busy) response to the SIP INVITE request due to to terminating filter criteria from the SC UE towards the remote UE as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]; and\nb)\tif a SIP CANCEL request was received, send a SIP 487 (Request Terminated) response to the SIP INVITE request due to STN-SR, the SIP INVITE request due to ATU-STI or the SIP INVITE request transferring additional session for PS to CS SRVCC as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2].\nNOTE\u00a01:\tAll protocol values in the Reason header field other than \"Q.850\" and all other values of the \"cause\" header field parameter other than \"31\" (normal unspecified) will result in an immediate release of the source access leg associated with the SC UE and the associated leg towards remote UE. Any other dialogs associated with the same user will remain in the early dialog phase.\nNOTE\u00a02: \tThe SCC AS assigns an operator specific timer to delay the release of the source access leg for PS to CS SRVCC access transfers.\nWhen the SCC AS receives a SIP UPDATE request(s) containing the protocol value \"SIP\" and the \"cause\" header field parameter with the value \"487\" from the SC UE after having performed an access transfer and after receiving a SIP BYE request or a SIP CANCEL request containing the Reason header field containing the protocol value \"Q.850\" and the \"cause\" header field parameter with the value \"31\" (normal unspecified) on the target access leg, then the SCC AS shall:\n1)\tnot release the original source access leg once the expiration of the timer as described in subclause\u00a012.3.8; and\n2)\ttreat the SIP UPDATE request(s) as per procedures for removing and adding media as described in subclause\u00a013.3.1\n.\nIf the SCC AS has received a SIP 200 (OK) response to the SIP INVITE requests due to terminating filter criteria from the SC UE prior to receiving the SIP UPDATE request from the SC UE, then on receipt of the SIP 200 (OK) response to the SIP UPDATE request sent to the remote UE, the SCC AS shall send a SIP 200 (OK) response to the remote UE. Upon receiving the SIP ACK request from the remote UE, the SCC AS shall send a SIP ACK request to the SC UE.\n\n***** Next change *****\n12.3.4.2\tSCC AS procedures for PS to CS access transfer for terminating call in alerting phase using PS to CS SRVCC procedure\nWhen the session in the transferable session set is a terminating call in alerting phase the SCC AS shall associate the SIP INVITE request with the early dialog related to the terminating session in the transferable session set.\nIf the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is the same as the speech media component of the SDP received in the source access leg of the session being transferred, the SCC AS shall send a SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR containing:\na)\tthe SDP sent by the SCC AS in the source access leg of the session being transferred; and\nb)\tthe signalling elements described in subclause\u00a06A.4.3A.\nIf the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is different with the speech media component of the SDP received in the source access leg of the session being transferred, the SCC AS shall update the remote leg by sending a SIP UPDATE request towards the remote UE using the existing established dialog according as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP UPDATE request with the SDP offer received in the SIP INVITE request due to STN-SR.\nUpon receiving the SIP 200 (OK) response to the SIP UPDATE request from the remote UE, the SCC AS shall send a SIP 183 (Session Progress) response in response to the SIP INVITE request due to STN-SR towards the MSC server. The SCC AS shall populate the SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR with:\na)\tthe SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request; and\nb)\tthe signalling elements described in subclause\u00a06A.4.3A.\nUpon receiving the SIP PRACK request from the target access leg, the SCC AS shall  send a SIP INFO request towards the MSC server as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] and IETF\u00a0RFC\u00a06086\u00a0[54] in the dialog created by the SIP INVITE request due to STN-SR. The SCC AS shall populate the SIP INFO request as follows:\n1.\tinclude the Info-Package header field as specified in IETF\u00a0RFC\u00a06086\u00a0[54] with 3gpp.state-and-event info package name; and\n2.\tinclude an application/vnd. 3gpp.state-and-event-info +xml XML body associated with the info package according to IETF\u00a0RFC\u00a06086\u00a0[54] and compliant to the XML schema specified in the clause\u00a0D.2 with the state-info XML element containing \"early\" and the direction XML element containing \"receiver\".\n\nUpon receiving the SIP INFO request which includes an Info-Package header field containing 3gpp.state-and-event info package name and an application/vnd. 3gpp.state-and-event-info +xml XML body associated with the info package according to IETF\u00a0RFC\u00a06086\u00a0[54] and compliant to the XML schema specified in the clause\u00a0D.2 from the MSC Server with the event XML element containing \"call-accepted\", the SCC AS shall send as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]:\n1)\ta SIP 200 (OK) response to the SIP INVITE request received earlier from the remote UE indicating that the called party has answered the call; and\n2)\ta SIP 200 (OK) response to the SIP INVITE request due to STN-SR towards the MSC server to indicate the successful access transfer populated with the signalling elements described in subclause\u00a06A.4.3A.\nThe SCC AS shall remove non-transferred audio and video media components and superfluous session as specified in subclause\u00a012.3.8.\n***** Next change *****\n12.3.4.3\tSCC AS procedures for PS to CS access transfer for originating call in alerting phase or pre-alerting phase using PS to CS SRVCC procedure\nWhen the session in the transferable session set is an originating call not accepted yet the SCC AS shall associate the SIP INVITE request due to STN-SR with an early dialog or early dialogs related to the originating call.\nIf there is only one early dialog related to the originating call not accepted yet available for the served user and if the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is the same as the speech media component of the SDP received in the source access leg of the session being transferred, the SCC AS shall send a SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR containing:\n-\tthe SDP sent by the SCC AS in the source access leg of the session being transferred;\n-\tif the SIP INVITE request due to STN-SR contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the original SIP INVITE request sent to the remote leg, include a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the original SIP INVITE request sent to the remote leg; and\n-\tthe signalling elements described in subclause\u00a06A.4.3A.\nIf there is only one early dialog related to the originating call not accepted yet available for the served user and the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is different with the speech media component of the SDP received in the source access leg of the session being transferred, the SCC AS shall update the remote leg by sending a SIP UPDATE request towards the remote UE using the existing early dialog as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP UPDATE request with the SDP offer received in the SIP INVITE request due to STN-SR.\nThe SCC AS shall discard any SIP 1xx provisional responses or the SIP 200 (OK) response to the initial SIP INVITE request received from the remote UE to the MSC server until the SIP 200 (OK) response to the INFO request is received from the MSC server (see later steps in this subclause).\nNOTE:\tSIP 1xx responses sent reliably and the SIP 200 (OK) response to the initial SIP INVITE request will be retransmitted by the remote UE if the responses are dropped by the SCC AS.\nUpon receiving the SIP 200 (OK) response to the SIP UPDATE request from the remote UE, the SCC AS shall send a SIP 183 (Session Progress) response in response to the SIP INVITE request due to STN-SR towards the MSC server. The SCC AS shall populate the SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR with:\n-\tthe SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request;\n-\tif the SIP INVITE request due to STN-SR contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the SIP UPDATE request, include a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the SIP UPDATE request; and\n-\tthe signalling elements described in subclause\u00a06A.4.3A.\nIf there are more than one early dialogs related to the originating call not accepted yet available for the served user due to forking as described in 3GPP\u00a0TS\u00a024.229\u00a0[2], the SCC AS shall update the remote legs by sending SIP UPDATE requests simultaneously towards every remote UE using the existing early dialogs as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate each SIP UPDATE request with the SDP offer received in the SIP INVITE request due to STN-SR. Upon receiving each SIP 200 (OK) response to the SIP UPDATE request from the remote UE, the SCC AS shall create a new early dialog by sending a SIP 183 (Session Progress) response in response to the SIP INVITE request due to STN-SR towards the MSC server. The SCC AS shall populate the SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR with:\n-\tthe SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request;\n-\tIf the SIP INVITE request due to STN-SR contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the SIP UPDATE request, include a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the SIP UPDATE request; and\n-\tthe signalling elements described in subclause\u00a06A.4.3A.\nIf the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase and if there are no early dialogs related to the originating call not accepted yet available for the served user and there is a SIP INVITE request from the served user for which a final SIP response has not been received yet, the SCC AS shall send SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR. The SCC AS shall populate the SIP 183 (Session Progress) response with:\n1.\tan SDP answer:\nA)\twith c-line set to the unspecified address (0.0.0.0) if IPv4 or to a domain name within the \".invalid\" DNS top-level domain in case of IPv6 as described in IETF\u00a0RFC\u00a06157\u00a0[74]; and\nB)\tincluding media of media types received in SDP offer of the SIP INVITE request due to STN-SR, which are also offered in the SIP INVITE request from the served user; and\n2.\tthe signalling elements described in subclause\u00a06A.4.3A.\nUpon receiving the first SIP PRACK request from the target access leg, the SCC AS shall send a SIP INFO request towards the MSC server as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] and IETF\u00a0RFC\u00a06086\u00a0[54] in the dialog created by the SIP INVITE request due to STN-SR. The SCC AS shall populate the SIP INFO request as follows:\n1.\tinclude the Info-Package header field as specified in IETF\u00a0RFC\u00a06086\u00a0[54] with 3gpp.state-and-event info package name; and\n2.\tinclude application/vnd.3gpp.state-and-event-info+xml XML body associated with the info package according to IETF\u00a0RFC\u00a06086\u00a0[54] and containing a XML body compliant to the XML schema specified in the annex\u00a0D.2:\nA)\tif a SIP 180 (Ringing) response to the SIP INVITE request has already been received in any of the existing early dialogs associated with the originating call not accepted yet, with the state-info XML element containing \"early\" the direction XML element containing \"initiator\"; and\nB)\tif the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase and if a SIP 180 (Ringing) response to the SIP INVITE request has not been received yet in any of the existing early dialogs associated with the originating call not accepted yet, with the state-info XML element containing \"pre-alerting\" and the direction XML element containing \"initiator\".\n\nIf the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase and if a SIP 1xx response or SIP 2xx response establishing a new dialog is received on the remote leg where the SIP response is to the SIP INVITE request from the served user, the SCC AS shall:\n1)\tif the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is the same as the speech media component of the SDP received in the source access leg of the session being transferred, forward the SIP response on the target access leg as a SIP response to the SIP INVITE request due to STN-SR; and\n2)\tif the speech media component of the SDP offer in the SIP INVITE request due to STN-SR is different to the speech media component of the SDP received in the source access leg of the session being transferred:\nA)\tif the SIP 1xx response is received, send a SIP PRACK request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP PRACK request with the SDP offer received in the SIP INVITE request due to STN-SR as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. Upon receiving the SIP 200 (OK) response to the SIP PRACK request, the SCC AS shall send a SIP 183 (Session Progress) response to the SIP INVITE request due to STN-SR as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP 183 (Session Progress) response with:\na)\tthe SDP answer received in the SIP 200 (OK) response to the SIP PRACK request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2];\nb)\tif the SIP INVITE request due to STN-SR contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the SIP PRACK request, a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the SIP PRACK request; and\nc)\tthe signalling elements described in subclause\u00a06A.4.3A.\nB)\tif the SIP 2xx response is received, send a SIP ACK request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] and send a SIP UPDATE request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP UPDATE request with the SDP offer received in the SIP INVITE request due to STN-SR as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. Upon receiving the SIP 200 (OK) response to the SIP UPDATE request, the SCC AS shall send a SIP 200 (OK) response to the SIP INVITE request due to STN-SR as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP 200 (OK) response with:\na)\tthe SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]; and\nb)\tthe signalling elements described in subclause\u00a06A.4.3A.\nThe SCC AS shall remove non-transferred audio and video media components and superfluous sessions as specified in subclause\u00a012.3.8.\n***** Next change *****\n12.3.4.4\tSCC AS procedures for PS to CS access transfer of additional call\nThis section contains procedures related to transfer of additional transferred session which is not accepted yet.\nIn order to transfer the additional transferred session, the SCC AS shall send a SIP REFER request according to 3GPP\u00a0TS\u00a024.229\u00a0[2], IETF\u00a0RFC\u00a04488\u00a0[20] and IETF\u00a0RFC\u00a03515\u00a0[13] as updated by IETF\u00a0RFC\u00a06665\u00a0[81] and draft-ietf-sipcore-refer-clarifications\u00a0[90] in the dialog created by the SIP INVITE request due to STN-SR; or the SCC AS shall send a SIP REFER request according to 3GPP\u00a0TS\u00a024.229\u00a0[2], IETF\u00a0RFC\u00a03515\u00a0[13] as updated by IETF\u00a0RFC\u00a06665\u00a0[81] and draft-ietf-sipcore-refer-clarifications\u00a0[90] in the dialog created by the SIP INVITE request due to ATU-STI for PS to CS SRVCC. The SCC AS shall populate the SIP REFER request as follows:\n1.\tthe Refer-Sub header field with value \"false\" as specified in IETF\u00a0RFC\u00a04488\u00a0[20];\n2.\tthe Supported header field with value \"norefersub\" as specified in IETF\u00a0RFC\u00a04488\u00a0[20];\nNOTE\u00a00:\tIETF\u00a0RFC\u00a03261\u00a0[19] recommends user agent client to include a Supported header field in any SIP request, listing option tags for extensions to SIP supported by the user agent client, that can be applied by the user agent server to the SIP response. In the step above, the SCC AS is mandated to include at least \"norefersub\" option tag in the Supported header field.\n3.\tthe Refer-To header field containing the additional transferred session SCC AS URI for PS to CS SRVCC, where the URI also includes the following header fields containing the information related to the additional transferred session:\nA.\tif an early dialog supporting the additional transferred session exists, the Target-Dialog header field populated as specified in IETF\u00a0RFC\u00a04538\u00a0[11], containing the dialog identifier of an early dialog supporting session of the SC UE;\nB.\tif the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase, if no early dialog supporting the additional transferred session exists, there is a SIP INVITE request from the served user for which a final SIP response has not been received yet and if an early dialog supporting the additional transferred session existed and was terminated, the Target-Dialog header field populated as specified in IETF\u00a0RFC\u00a04538\u00a0[11], containing the dialog identifier on the source access leg of the early dialog supporting the additional transferred session which existed and was terminated;\nNOTE\u00a01:\tEarly dialog can be terminated by SIP 199 (Early Dialog Terminated) response.\nC.\tthe Require header field populated with the option tag value \"tdialog\";\nD.\tif an early dialog supporting the additional transferred session exists, the To header field populated as specified in IETF\u00a0RFC\u00a03261\u00a0[19], containing the value of the P-Asserted-Identity provided by the remote UE during the session establishment;\nE.\tthe From header field populated as specified in IETF\u00a0RFC\u00a03261\u00a0[19], containing the value of the P-Asserted-Identity provided by the SC UE during the session establishment;\nF.\tthe Content-Type header field with \"application/sdp\";\nG.\tif an early dialog supporting the additional transferred session exists, the header field with hname \"body\" populated with an SDP body describing the media streams as negotiated in the session with the remote UE; and\nH.\tif the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase, no early dialog supporting the additional transferred session exists, there is a SIP INVITE request from the served user for which a final SIP response has not been received yet, the header field with hname \"body\" populated with the SDP offer received in the SIP INVITE request from the served user;\n4.\tif a SIP 180 (Ringing) response to the SIP INVITE request from the served user has already been received in any of the existing early dialogs associated with the additional transferred session, application/vnd.3gpp.state-and-event-info+xml MIME body with the state-info XML element containing \"early\" and the direction XML element containing:\nA.\tif terminating call, the \"receiver\"; and\nB.\tif originating call, the \"initiator\";\n5.\tif the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase, the additional transferred session was originated by the SC UE and if a SIP 180 (Ringing) response to the SIP INVITE request from the served user has not been received yet in any of the existing early dialogs associated with the additional transferred session, application/vnd.3gpp.state-and-event-info+xml MIME body with the state-info XML element containing \"pre-alerting\" and the direction XML element containing the \"initiator\"; and\n6.\tif:\nA.\tSCC AS supports CS to PS SRVCC;\nB.\tthe SIP INVITE request due to STN-SR contains Accept header field with application/vnd.3gpp.srvcc-ext+xml MIME type;\nC.\ta private user identity of a UE (i.e. other than those according to 3GPP\u00a0TS\u00a023.003\u00a0[12], subclause\u00a020.3.3) is associated with the C-MSISDN in the P-Asserted-Identity header field of the SIP INVITE request due to STN-SR;\nD.\ta binding of a contact address exists for the private user identity of the UE:\na)\twhere the g.3gpp.cs2ps-srvcc media feature tag as described in annex\u00a0C is associated with the contact address of the UE; and\nb)\tsuch that SIP REGISTER request which registered the binding contained a Feature-Caps header field with the g.3gpp.atcf feature-capability indicator as described in annex\u00a0C and with g.3gpp.cs2ps-srvcc feature-capability indicator as described in annex\u00a0C;\nE.\tthe CS to PS SRVCC capability indication is indicated for the private user identity of the UE; and\nF.\tthe private user identity of the UE has the CS to PS SRVCC allowed indication in the subscription data;\n\tthen:\nA.\ta MIME body of application/vnd.3gpp.srvcc-ext+xml MIME type:\na)\tcontaining ATU management URI of the ATCF serving the SC UE;\nNOTE\u00a02:\tThe ATCF management URI of the ATCF is the URI contained in the g.3gpp.atcf-mgmt-uri feature-capability indicator included in a Feature-Caps header field of the SIP REGISTER request, which registered the binding for the private user identity of the UE.\nb)\tcontaining C-MSISDN; and\nc)\tnot indicating that information relate to a registration of MSC server with IMS.\nWhen the SCC AS receives the SIP INVITE request transferring additional session for PS to CS SRVCC, the SCC AS shall:\n-\tif the Target-Dialog header field of the SIP INVITE request transferring additional session for PS to CS SRVCC identifies an existing early dialog, associate the SIP INVITE request transferring additional session for PS to CS SRVCC with the SIP early dialog i.e. identify the Source Access Leg;\nNOTE\u00a03:\tThe SIP dialog on the Source Access Leg is identified by matching the dialog ID present in Target-Dialog header field (see IETF\u00a0RFC\u00a04538\u00a0[11]) of the SIP INVITE with a dialog in early state.\nNOTE\u00a04:\tBy a SIP dialog in early state, it is meant an early SIP dialog which has been created by a provisional response to the initial SIP INVITE request, but for which the SIP 2xx response has not yet been sent or received;\n-\tif the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase, if the Target-Dialog header field of the SIP INVITE request transferring additional session for PS to CS SRVCC identifies an early dialog which has already been terminated, associate the SIP INVITE request transferring additional session for PS to CS SRVCC with the early dialog i.e. identify the Source Access Leg;\n-\tif the SCC AS is unable to associate the SIP INVITE with a unique dialog in early state, send a SIP 480 (Temporarily Unavailable) response to reject the SIP INVITE request relating to the access transfer and not processes the remaining steps;\n-\tif the number of media lines in the Target Access Leg is less than the number of media lines in the Source Access Leg or the media type for the corresponding media lines is not the same as in the original session, send a SIP 4xx response to reject the SIP INVITE request relating to the access transfer and not process the remaining steps;\n-\tif an early dialog exists on the remote leg of the additional transferred session, send a SIP UPDATE request(s) towards the remote UE(s) using the existing early dialog(s) which were created by the same SIP INVITE request as the Source Access Leg. The SCC AS shall populate the SIP UPDATE request(s) with a new SDP offer, following the rules specified in 3GPP\u00a0TS\u00a024.229\u00a0[2], containing the following media information:\na)\tthe media characteristics as received in the SIP INVITE request transferring additional session for PS to CS SRVCC received on the Target Access Leg for media streams whose port is not set to zero; and\nb)\tfor the media streams in the SIP INVITE request transferring additional session for PS to CS SRVCC whose port is set to zero, include the corresponding media characteristics of those streams from the Source Access Leg.\nIf an early dialog exists on the remote leg then when receiving SIP 2xx response to the SIP UPDATE request, the SCC AS shall create a new early dialog by sending SIP 183 (Session Progress) response to the SIP INVITE request transferring additional session for PS to CS SRVCC. The SCC AS shall populate the SIP response as follows:\n1.\tif the Remote Leg is an early dialog originated by the remote UE, include a Recv-Info header field containing the g.3gpp.state-and-event package name;\n2.\tinclude the SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request;\n3.\tif the SIP INVITE request transferring additional session for PS to CS SRVCC contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the SIP UPDATE request, include a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the SIP UPDATE request; and\n4.\tthe signalling elements described in subclause\u00a06A.4.3A.\n\nIf the SCC AS supports the PS to CS SRVCC for originating calls in pre-alerting phase and if a SIP 1xx response or SIP 2xx response establishing a new dialog is received on the remote leg of the additional transferred session where the SIP response is to the SIP INVITE request from the served user, the SCC AS shall:\n1)\tif the SIP 1xx response is received, send a SIP PRACK request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP PRACK request with the SDP offer received in the SIP INVITE request transferring additional session for PS to CS SRVCC as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. Upon receiving the SIP 200 (OK) response to the SIP PRACK request, the SCC AS shall send a SIP 183 (Session Progress) response to the SIP INVITE request transferring additional session for PS to CS SRVCC as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP 183 (Session Progress) response as follows:\n-\tinclude the SDP answer received in the SIP 200 (OK) response to the SIP PRACK request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2];\n-\tif the SIP INVITE request transferring additional session for PS to CS SRVCC contains a P-Early-Media header field with the \"supported\" parameter and if the SCC AS has received a P-Early-Media header field in a SIP message in the dialog of the SIP PRACK request, include a P-Early-Media header field containing the value of the last P-Early-Media header field received in a SIP message in the dialog of the SIP PRACK request; and\n-\tthe signalling elements described in subclause\u00a06A.4.3A; and\n2)\tif the SIP 2xx response is received, send a SIP ACK request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2] and send a SIP UPDATE request on the remote leg as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS populate the SIP UPDATE request with the SDP offer received in the SIP INVITE request transferring additional session for PS to CS SRVCC as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. Upon receiving the SIP 200 (OK) response to the SIP UPDATE request, the SCC AS shall send a SIP 200 (OK) response to the SIP INVITE request transferring additional session for PS to CS SRVCC as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]. The SCC AS shall populate the SIP 200 (OK) response with:\n-\tthe SDP answer received in the SIP 200 (OK) response to the SIP UPDATE request as specified in 3GPP\u00a0TS\u00a024.229\u00a0[2]; and\n-\tthe signalling elements described in subclause\u00a06A.4.3A.\nIf the Remote Leg is an early dialog originated by the remote UE then when receiving the SIP INFO request inside the Target Access Leg containing:\n1.\tan Info-Package header field as specified in IETF RFC 6086\u00a0[54] with 3gpp.state-and-event info package name; and\n2.\tapplication/vnd.3gpp.state-and-event-info+xml XML body associated with the info package according to IETF\u00a0RFC\u00a06086\u00a0[54] and with the event XML element containing \"call-accepted\" to indicate that the called party has answered the call;\nthen the SCC AS shall:\n1.\tsend SIP 200 (OK) response to the SIP INVITE request to the remote UE; and\n2.\tsend SIP 200 (OK) response to the SIP INVITE request over the Target Access Leg.\n12.3.5\tSCC AS procedures for PS to CS access transfer: PS to CS SRVCC enhancement using ATCF\nUpon receiving a SIP INVITE request due to ATU-STI for PS to CS SRVCC, the SCC AS shall:\n1)\tif there is a Target-Dialog header field in the SIP INVITE request:\nA)\tdetermine the transferable session set which are all the sessions of the SC UE whose private user identity is associated with Correlation MSISDN that is contained in the P-Asserted-Identity header field of the SIP INVITE request;\nB)\tdetermine the session that is to be transferred which is a session:\na)\tin the transferable session set;\nb)\tis in the confirmed dialog state; and\nc)\twith active speech media component which has been made active most recently; and\nC)\tif the session that is to be transferred is for the same dialog as the dialog identifier in the Target-Dialog header field in the SIP INVITE request, then perform the procedures described for SIP INVITE request due to STN-SR in subclause\u00a012.3.0B with one of the following options dependent on operator policy:\na)\tif:\n-\tthe SDP offer in the SIP INVITE request contains speech media component only and the speech media component of the SDP offer in the SIP INVITE request is the same as the speech media component of the SDP negotiated by the ATCF in the session being transferred; or\n-\tthe SDP offer in the SIP INVITE request contains speech media component and video media component and the speech media component and the video media component of the SDP offer in the SIP INVITE request is the same as the speech media component and the video media component of the SDP negotiated by the ATCF in the session being transferred;\n\tthen the SCC AS shall:\ni)\tnot send a SIP re-INVITE request towards remote UE; and\nii)\tsend a SIP 200 (OK) response to the SIP INVITE request containing:\n-\tthe SDP negotiated by SCC AS towards ATCF in the session being transferred;and\n-\tthe signalling elements described in subclause\u00a06A.4.3A; \nor\nb)\tif confirmed dialogs supporting a session with active speech media component exist in the transferable session set the SCC AS shall send a SIP re-INVITE request towards the remote UE and in a new SDP offer, include the media characteristics as received in the SIP INVITE request due to ATU-STI, by following the rules of 3GPP\u00a0TS\u00a024.229\u00a0[2];\nNOTE:\thandling when it is determined that there is no session to be transferred or when the dialog identifier in the Target-Dialog header field in the SIP INVITE request identifies a dialog other than the session being transferred is out of scope of this release of this document.\nD)\tif the session identified by the dialog identifier in the Target-Dialog header field is a session of the SC UE whose private user identity is associated with C-MSISDN that is contained in the P-Asserted-Identity header field of the SIP INVITE request and:\n1)\tis in an early dialog state; or\n2)\tis in a confirmed dialog state and contains inactive speech media component;\n\tthen\n1)\tif the session is in an early dialog state, perform the procedures described for SIP INVITE requests due to STN-SR in subclause\u00a012.3; and\n2)\tif the session is in a confirmed dialog state and contains inactive speech media component, perform the procedures described for SIP INVITE requests due to STN-SR in subclause\u00a012.3.2;\n2)\tif there is no Target-Dialog header field in the SIP INVITE request:\na)\tperform the procedures described for SIP INVITE requests due to STN-SR in subclause\u00a012.3.0B.\n***** Next change *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAt the moment it is not clear what the SCC AS shall do if a SIP message related to the call ( i.e. not related to the access transfer) is received from a remote UE when an access transfer is ongoing.(There is one exception: in subclause 12.3.4.3 the procedures for PS to CS access transfer for calls in an early phase on the originating side there exist some description on when to stop SIP 1xx and 2xx responses from the remote UE and when to start forwarding them again.)To avoid undefined actions in the SCC AS and the MSC server we need to clarify the exact moment when SIP messages shall be discarded and the exact moment when SIP message shall be acted on (i.e. forwarded).Further, it is not clear what to do with SIP messages related to the call ( i.e. not related to the access transfer) received from the SC UE or the MSC server.We need to clarify what to do with SIP messages related to the call received from the SC UE and the MSC server.\n\n>>> SUMMARY OF CHANGE\n- Added in the General subclause 12.3.0 the requirements to stop all SIP message (requests and responses) from remote UE when the access transfer is initiated e.g. on receipt on the INVITE due to STN-SR or the SIP INVITE due to ATU-STI. - Added in the general subclause 12.3.0 the requirements to always forward SIP messages related to the call received from the SC UE and the MSC server.- Added in each subclause to 12.3 (successful access transfer cases) an explicit statement when the forwarding of SIP messages shall be started towards the MSC server.Note that the it is not possible to start the forwarding of SIP messages in a general manner, so each transferred dialog will be started on an individual bases.- Added in the 12.3.3 (unsuccessful access transfer cases) the start of forwarding SIP message towards the SC UE.- In subclause 12.3.4.3 the existing paragraph and NOTE is removed. The paragrah explains when to start and stop forwarding 1xx and 2xx SIP responses but since the new text in the general paragraph replaces the \"stop\" and the \"start\" is more explicitly stated (on per dialog bases) further below in the subclause this paragraph can be removed. The NOTE is generalized to SIP message instead of only 1xx and 2xx responses and moved to the subclause 12.3.0 (General).\n\n>>> CONSEQUENCES IF NOT REVISED\nDifferent implementations may handle SIP messages from the remote UE differently e.g.:- If messages towards the SC UE are forwarded, the forwarding can cause inconsistent call states in SCC AS and the SC UE if the SC UE already moved to CS.- If SIP message are sent too late towards the MSC server, this behaviour can cause unnecessary loss of calls."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n6.7.2.2\tIMS-ALG in P-CSCF for media plane security\nWhen the P-CSCF acts as an IMS-ALG, it acts as a B2BUA and modifies the SDP as described as described in 3GPP\u00a0TS\u00a023.334\u00a0[7F].\nIf the P-CSCF indicated support for end-to-access-edge media security using SDES during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected RTP based media, i.e. a RTP media stream:\n-\ttransported using the SRTP transport protocol as defined in RFC\u00a03711\u00a0[169];\n-\twith an SDP crypto attribute as defined in RFC\u00a04568\u00a0[168]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\n\tthe P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and SRTP is concerned, and shall\n\n\n strip the SDP \"a=3ge2ae:requested\" attribute and the SDP crypto attribute from the end-to-access-edge protected RTP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected RTP based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and SRTP is concerned and shall:\n-\tindicate the SRTP transport protocol according to RFC\u00a03711\u00a0[169] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude a SDP crypto attribute according to RFC\u00a04568\u00a0[168] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C].\nIf the served UE indicated support for end-to-access-edge media security using SDES, during registration, and the P-CSCF indicated support for end-to-access-edge 2ae-media security using SDES during registration:\n1)\tupon receiving an SDP offer from remote user with an RTP based media, for each end-to-access-edge protected RTP based media, i.e. a RTP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end media security mechanism, the P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and RTP is concerned, and shall:\n-\tremove any SDP crypto attribute;\n\n\n\n\n\n-\toffer SRTP transport protocol according to RFC\u00a03711\u00a0[169] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n-\tinclude a SDP crypto attribute according to RFC\u00a04568\u00a0[168] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude a SDP \"a=3ge2ae:applied\" attribute; and:\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected RTP based media, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and RTP is concerned, and shall remove the SDP crypto attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for MSRP using TLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected MSRP based media, i.e. an MSRP based media:\n-\ttransported using the MSRP over TLS transport protocol as defined in RFC\u00a04975\u00a0[178] and RFC\u00a06714\u00a0[214];\n-\twith the SDP fingerprint attribute as defined in draft-ietf-mmusic-4572-update\u00a0[241]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\n\tthe P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and MSRP is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute from the end-to-access-edge protected MSRP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected MSRP based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and MSRP is concerned and shall:\n-\tindicate the MSRP over TLS transport protocol according to RFC\u00a04975\u00a0[178], RFC\u00a06714\u00a0[214] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C].\nIf the served UE indicated support for the end-to-access-edge media security for MSRP using TLS and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for MSRP using TLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote user with an MSRP based media, for each end-to-access-edge protected MSRP based media, i.e. an MSRP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and MSRP is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\toffer MSRP over TLS transport protocol according to RFC\u00a04975\u00a0[178], RFC\u00a06714\u00a0[214] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected MSRP based media, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and MSRP is concerned, and shall remove the SDP fingerprint attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for BFCP using TLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected BFCP based media, i.e. a BFCP based media: \n-\ttransported using the BFCP over TLS transport protocol as defined in RFC\u00a04583\u00a0[108];\n-\twith the SDP fingerprint attribute as defined in draft-ietf-mmusic-4572-update\u00a0[241]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\n\tthe P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and BFCP is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute from the BFCP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected BFCP based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and BFCP is concerned and shall:\n-\tindicate the BFCP over TLS transport protocol according to RFC\u00a04583\u00a0[108] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C].\nIf the served UE indicated support for the end-to-access-edge media security for BFCP using TLS and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for BFCP using TLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote UE with an BFCP based media, for each end-to-access-edge protected BFCP based media, i.e. a BFCP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and BFCP is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\toffer BFCP over TLS transport protocol according to RFC\u00a04583\u00a0[108] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected BFCP based media, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and BFCP is concerned, and shall remove the SDP fingerprint attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for UDPTL over DTLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected UDPTL based media, i.e. a UDPTL based media: \n-\ttransported using the UDPTL over DTLS transport protocol as defined in RFC\u00a07345\u00a0[217] and draft-ietf-mmusic-dtls-sdp\u00a0[240];\n-\twith the SDP fingerprint attribute as defined in draft-ietf-mmusic-4572-update\u00a0[241];\n-\twith the SDP \"a=3ge2ae:requested\" attribute; and\n-\twith the SDP dtls-id attribute as defined in draft-ietf-mmusic-dtls-sdp\u00a0[240];\n\tthe P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and UDPTL is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute and the SDP dtls-id attribute from the UDPTL based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected UDPTL based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and UDPTL is concerned and shall:\n-\tindicate the UDPTL over DTLS transport protocol according to RFC\u00a07345\u00a0[217], draft-ietf-mmusic-dtls-sdp\u00a0[240] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C]; and\n-\tinclude the SDP dtls-id attribute as defined in draft-ietf-mmusic-dtls-sdp\u00a0[240].\nIf the served UE indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote UE with an UDPTL based media, for each end-to-access-edge protected UDPTL based media, i.e. a UDPTL based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and UDPTL is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\tremove any SDP dtls-id attribute;\n-\toffer UDPTL over DTLS transport protocol according to RFC\u00a07345\u00a0[217], draft-ietf-mmusic-dtls-sdp\u00a0[240] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n\n-\tinclude the SDP fingerprint attribute according to draft-ietf-mmusic-4572-update\u00a0[241] and the profile defined in 3GPP\u00a0TS\u00a033.328\u00a0[19C];\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n-\tinclude the SDP dtls-id attribute as defined in draft-ietf-mmusic-dtls-sdp\u00a0[240]; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected UDPTL based media, the P-CSCF will act as defined in 3GPP\u00a0TS\u00a023.334\u00a0[7F] as far as SDP and UDPTL is concerned, and shall remove the SDP fingerprint attribute and SDP dtls-id attribute.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to the SDP profile tables, an IMS-ALG in the P-CSCF supports the SDP capability negotiation according to RFC\u00a05939. The IMS-ALG also supports end-to-access-edge media security. However, interactions of end-to-access-edge media security with likely use cases of SDP capneg were not considered. This leads to some problems:A. According to TS 26.114 and GSMA IR.94, for video media AVPF is suggested to be offered via SDP Capneg as preferred configuration in addition to AVP, as in the following simplified SDP example:m=video 3456 RTP/AVP 97 96a=tcap:1 RTP/AVPFa=pcfg:1 t=1If an originating MTSI terminal desires e2ae security, it is likely to offer SAVPF and SAVP using SDP Capneg in a similar manner, i.e. with an SDP offer similar to the following simplified example:m=video 3456 RTP/SAVP 97 96a=3ge2ae:requesteda=crypto:\u2026a=tcap:1 RTP/SAVPFa=pcfg:1 t=1According to the existing procedures in subclause 6.7.2.2 for an UE originating call with e2ae security, the IMS-ALG removes the crypto attribute, the 3ge2ae indicator and it changes the transport in the m line from SAVP to AVP. However, as no handling of the capneg information including the a=tcap:1 RTP/SAVPF SDP attribute is specified, this will likely be passed to the remote peer, like in the following simplified SDP example:m=video 3456 RTP/AVP 97 96a=tcap:1 RTP/SAVPFa=pcfg:1 t=1This could lead to maloperation and potential call failure if the remote peer supports SDP capneg due to the following problems:1. Should the peer try to select SAVPF, it will notice that it did not receive the required a=crypto attribute and could regard this as fatal error.2. Should the remote peer instead answer in line with SDP capneg procedures using m=video 3456 RTP/SAVPF 97 96, this would not be expected by the IMS-ALG and could again lead to a call failure.3. Should the remote peer select to use RTP/AVP due to issue 1, this would impact the performance of the video call as RTCP feedback would be missing.B. If a terminating IMS-ALG receives on offer for video media where AVPF is offered via SDP Capneg as preferred configuration in addition to AVP, according to the existing procedures in subclause 6.7.2.2 for an UE terminating call with e2ae security, the IMS-ALG adds a crypto attribute, the 3ge2ae indicator and it changes the transport in the m line from AVP to SAVP. However, as no handling of the capneg information including the a=tcap:1 RTP/SAVPF SDP attribute is specified, this will likely be passed to the served UE, like in the following simplified SDP example:m=video 3456 RTP/SAVP 97 96a=3ge2ae:applieda=crypto:\u2026a=tcap:1 RTP/AVPFa=pcfg:1 t=1This could lead to maloperation and potential call failure if the terminating served UE supports SDP capneg due to the following problems:1. Should the served UE try to select AVPF, it will notice that this conflicts with the a=3ge2ae:applied attribute and could regard this as fatal error.2. Should the served UE instead answer in line with SDP capneg procedures using m=audio 3456 RTP/AVPF 97 96, this would not be expected by the IMS-ALG and could again lead to a call failure.3. Should the remote peer select to use RTP/SAVP due to issue 1, this would impact the performance of the video call as RTCP feedback would be missing.C. If a terminating IMS-ALG receives on SDP offer from a non-3GPP peer desiring to offer end-to-end media security via SDP Capneg by including SAVP as preferred configuration in addition to AVP, as in the following simplified SDP example:m=audio 3456 RTP/AVP 97 96a=tcap:1 RTP/SAVPa=acap:1 crypto:aa=pcfg:1 t=1 a=1the terminating IMS-ALG adds a crypto attribute, the 3ge2ae indicator and it changes the transport in the m line from AVP to SAVP. However, as no handling of the capneg information including the a=tcap:1 RTP/SAVPF SDP attribute is specified, this will likely be passed to the served UE, like in the following simplified SDP example:m=audio 3456 RTP/SAVP 97 96a=3ge2ae:applieda=crypto:ba=tcap:1 RTP/SAVPa=acap:1 crypto:aa=pcfg:1 t=1 a=1This could lead to maloperation and potential call failure if the terminating served UE supports SDP capneg due to the following problem:Should the served UE try to select SAVP from the potential configuration, it will use a:crypto with key a from the remote peer rather than with key b supplied by the IMS-ALG, meaning that the UE cannot decrypt the received media and will likely terminate the call.D. The terminating IMS-ALG receives on SDP offer from a non-3GPP peer offering a potential configuration with delete-attribute parameter(s) (e.g. \"a=pcfg:1 a=-sm:1\"), as in the following simplified SDP example:m=audio 3456 RTP/AVPF 97 96a=rtcp-fb:0 nacka=tcap:1 RTP/AVPa=pcfg:1 t=1 a=-m:1The terminating IMS-ALG adds a crypto attribute, the 3ge2ae indicator and it changes the transport in the m line from AVP to SAVP. Assuming that change B. (see below) is already applied, for the above example, the IMS-ALG produces the following example SDPP:m=audio 3456 RTP/SAVPF 97 96a=rtcp-fb:0 nacka=3ge2ae:applieda=crypto:ba=tcap:1 RTP/SAVPa=pcfg:1 t=1 a=-m:1This could lead to maloperation and potential call failure if the terminating served UE supports SDP capneg due to the following problem:Should the served UE try to select SAVP from the potential configuration, due to the delete-attribute parameter in the corresponding potential configuration, it will remove the \"a:crypto\" and \"a=3ge2ae:applied\" SDP attributes and thus lack the required cryptographic key, meaning that the UE will likely terminate the call.\n\n>>> SUMMARY OF CHANGE\nProcedures how to handle SDP capneg related SDP attributes when end-to-access-edge media security is applied are being added:A. For the mobile originating offer, if the SDP offer contains a Transport Protocol Capability Attribute SDP attribute offering \"RTP/SAVPF\" or \"RTP/SAVP\" transport, e.g. \"a=tcap:x RTP/SAVPF\", the IMS-ALG shall replace this transport within that attribute with \"RTP/AVPF\" or \"RTP/AVP\", respectively.B. For the mobile terminating offer, if the SDP offer contains a Transport Protocol Capability Attribute SDP attribute offering \"RTP/AVPF\" or \"RTP/AVP\" transport, e.g. \"a=tcap:x RTP/AVPF\", the IMS-ALG shall replace this transport within that attribute with \"RTP/SAVPF\" or \"RTP/SAVP\", respectively.C. For the mobile terminating offer, if the SDP offer contains any potential configuration(s) using \"RTP/SAVPF\" transport or \"RTP/SAVP\" transport (e.g. \"a=tcap:x RTP/AVPF  a=pcfg:y t=x\")\", the IMS-ALG shall remove those potential configuration(s).D. For the mobile terminating offer, if the SDP offer contains contains any potential configurations with the delete-attribute parameter (see RFC\u00a05939\u00a0[137], e.g. \"a=pcfg:1 a=-sm:1\"), the IMS-ALG shall remove those potential configurations;\n\n>>> CONSEQUENCES IF NOT REVISED\nA. and B. Risk of call failures or degraded user experience for video calls where AVPF is offered as preferred SDP capneg configuration in addition to AVP, in line with TS 26.114 and IR.94, and e2ae media security is applied.C. Risk of call failure of terminating calls where SAVP or SAVPF is offered using SDP capneg and e2ae media security is applied.D. Risk of call failure of terminating calls where SDP capneg potential configurations with delete-attribute parameter(s) are offered and e2ae media security is applied."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n5.3.2\tPermanent identifiers\nA globally unique permanent identity, the 5G subscription permanent identifier (SUPI), is allocated to each subscriber for 5GS-based services. The IMSI and network specific identifier are valid SUPI types. When the SUPI contains a network specific identifier, it shall take the form of a network access identifier (NAI). The structure of the SUPI and its derivatives are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nThe UE provides the SUPI to the network in concealed form. The SUCI is a privacy preserving identifier containing the concealed SUPI. When the SUPI contains a network specific identifier, the SUCI shall take the form of an NAI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nA UE supporting N1 mode includes a SUCI:\na)\tin the REGISTRATION REQUEST message when the UE is attempting initial registration procedure and a valid 5G-GUTI is not available; or \nb)\tin the IDENTITY RESPONSE message, if the SUCI is requested by the network during the identification procedure\n.\nNOTE:\tIf the home network has not provisioned the public key needed to generate a SUCI, the UE uses \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI which equals to the SUPI.\nThe UE shall use the \"null-scheme\" as specified in 3GPP TS 33.501 [24] to generate the SUCI, if the following applies:\na)\tthe UE performs a registration procedure for emergency services or initiates a de-registration procedure before the registration procedure for emergency services was completed successfully; and\nb)\tthe UE does not have a valid 5G-GUTI for the selected PLMN or it receives an identity request for SUCI during any of the procedures of item a).\nEach UE supporting NG-RAN contains a permanent equipment identifier (PEI) for accessing 5GS-based services. In this release of the specification, the IMEI and the IMEISV are the only PEI formats supported by 5GS. The structure of the PEI and its formats are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nA UE supporting NG-RAN includes a PEI:\na)\twhen neither SUPI nor valid 5G-GUTI is available to use for emergency services in the REGISTRATION REQUEST message with 5GS registration type IE set to \"emergency registration\"; and\nb)\twhen the network requests the PEI by using the identification procedure, in the IDENTITY RESPONSE message.\nThe AMF can request the PEI at any time by using the identification procedure.\n\n*** Next change ***\n\n10.2\tTimers of 5GS mobility management\nTimers of 5GS mobility management are shown in table\u00a010.2.1 and table\u00a010.2.2\nNOTE:\tTimer T3346 is defined in 3GPP\u00a0TS\u00a024.008\u00a0[12]. Timers T3444 and T3445 are defined in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nTable\u00a010.2.1: Timers of 5GS mobility management \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3510\t15s\t5GMM-REGISTERED-INITIATED\tTransmission of REGISTRATION REQUEST message\tREGISTRATION ACCEPT message received or REGISTRATION REJECT message received\tStart T3511 or T3502 as specified in subclause\u00a05.5.1.2.7 if T3510 expired during registration procedure for initial registration.\t\tStart T3511 or T3502 as specified in subclause\u00a05.5.1.3.7 if T3510 expired during the registration procedure for mobility and periodic registration update\nT3502\tDefault 12 min.\tNOTE\u00a01\t5GMM-REGISTERED\tAt registration failure and the attempt counter is equal to 5\tTransmission of REGISTRATION REQUEST message\tInitiation of the registration procedure, if still required\nT3511\t10s\t5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION\t\t5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE\t\t5GMM-REGISTERED.NORMAL-SERVICE\tAt registration failure due to lower layer failure, T3510 timeout or registration rejected with other 5GMM cause values than those treated in subclause\u00a05.5.1.2.5 for initial registration or subclause\u00a05.5.1.3.5 for mobility and periodic registration\tTransmission of REGISTRATION REQUEST message\t\t5GMM-CONNECTED mode entered (NOTE\u00a05)\tRetransmission of the REGISTRATION REQUEST, if still required\nT3512\tDefault 54 min\tNOTE\u00a01\tNOTE\u00a02\t5GMM-REGISTERED\tIn 5GMM-REGISTERED, when 5GMM-CONNECTED mode is left\tWhen entering state 5GMM-DEREGISTERED or when entering 5GMM-CONNECTED mode\tInitiation of the periodic registration procedure if the UE is not registered for emergency services.\t\tLocally deregister if the UE is registered for emergency services\nT3516\t30s\t5GMM-REGISTERED-INITIATED\t5GMM-REGISTERED\t5GMM-DEREGISTERED-INITIATED\t5GMM-SERVICE-REQUEST-INITIATED\tRAND and RES* stored as a result of an 5G authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tREGISTRATION ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\t5GMM-DEREGISTERED, 5GMM-NULL or\t5GMM-IDLE mode entered\tDelete the stored RAND and RES*\nT3517\t15s\t5GMM-SERVICE-REQUEST-INITIATED\tTransmission of SERVICE REQUEST message\t(a)\tIndication from the lower layers that the UE has changed to S1 mode or E-UTRA connected to 5GCN for case h) in subclause\u00a05.6.1.1; or\t(b)\tSERVICE ACCEPT message received, or\tSERVICE REJECT message received for cases other than h) in subclause\u00a05.6.1.1\tAbort the procedure\nT3519\t60s\t\t5GMM-REGISTERED-INITIATED\t\tTransmission of IDENTITY RESPONSE message, REGISTRATION REQUEST message, or DEREGISTRATION REQUEST message with freshly generated SUCI\tREGISTRATION ACCEPT message with new 5G-GUTI received\tCONFIGURATION UPDATE COMMAND message with new 5G-GUTI received DEREGISTRATION ACCEPT message\tDelete stored SUCI\nT3520\t15s\t5GMM-REGISTERED-INITIATED\t5GMM-DEREGISTERED-INITIATED\t5GMM-SERVICE-REQUEST-INITIATED\tTransmission of AUTHENTICATION FAILURE message with any of the 5GMM cause #20, #21, #26 or #71\t\tTransmission of AUTHENTICATION RESPONSE message with an EAP-response message after detection of an error as described in subclause\u00a05.4.1.2.2.4\tAUTHENTICATION REQUEST message received or AUTHENTICATION REJECT message received\tor\tSECURITY MODE COMMAND message received\t\twhen entering 5GMM-IDLE mode\t\tindication of transmission failure of AUTHENTICATION FAILURE message from lower layers\tOn first expiry during a 5G AKA based primary authentication and key agreement procedure, the UE should consider the network as false and follow item g of subclause\u00a05.4.1.3.7, if the UE is not registered for emergency services.\t\tOn first expiry during a 5G AKA based primary authentication and key agreement procedure, the UE will follow subclause\u00a05.4.1.3.7 under \"For items\u00a0c, d, e and f:\", if the UE is registered for emergency services.\t\tOn first expiry during an EAP based primary authentication and key agreement procedure, the UE should consider the network as false and follow item e of subclause\u00a05.4.1.2.4.5, if the UE is not registered for emergency services.\t\tOn first expiry during an EAP based primary authentication and key agreement procedure, the UE will follow subclause\u00a05.4.1.2.4.5 under \"For item e:\", if the UE is registered for emergency services\nT3521\t15s\t5GMM-DEREGISTERED-INITIATED\tTransmission of DEREGISTRATION REQUEST message when de-registration procedure is not due to a \"switch off\"\tDEREGISTRATION ACCEPT message received\tRetransmission of DEREGISTRATION REQUEST message\nT3525\tDefault 60s\tNOTE\u00a03\t5GMM-REGISTERED.NORMAL-SERVICE\tT3517 expires and service request attempt counter is greater than or equal to 5\tWhen entering state other than 5GMM-REGISTERED.NORMAL-SERVICE state,\tor\tUE camped on a new PLMN other than the PLMN on which timer started,\tor\tUser-plane resources established with the network\tThe UE may initiate service request procedure\nT3540\t10s\t5GMM-REGISTERED-INITIATED\t\t5GMM-DEREGISTERED-INITIATED\t\t5GMM-SERVICE-REQUEST-INITIATED\tREGISTRATION REJECT message or DEREGISTRATION REQUEST message received with any of the 5GMM cause #7, #11, #12, #13, #15, #27 or #72\tSERVICE REJECT message received with any of the 5GMM cause #7, #11, #12, #13, #15, #27 or #72.\tREGISTRATION ACCEPT message received as described in subclause 5.3.1.3 case b)\tSERVICE ACCEPT message received as described in subclause\u00a05.3.1.3 case f)\tN1 NAS signalling connection released\tPDU sessions have been set up\tRelease the NAS signalling connection for the cases a), b) and f) as described in subclause\u00a05.3.1.3\n\t\t5GMM-REGISTERED\tCONFIGURATION UPDATE COMMAND message received as described in subclause\u00a05.3.1.3 case e)\tN1 NAS signalling connection released\tRelease the NAS signalling connection for the case e) and perform a new registration procedure as described in subclause 5.5.1.3.2\n\t\t5GMM-DEREGISTERED\t\t5GMM-DEREGISTERED.NORMAL-SERVICE\tREGISTRATION REJECT message or SERVICE REJECT message received with the 5GMM cause #9 or #10\t\tRelease the NAS signalling connection for the cases c) and d) as described in subclause\u00a05.3.1.3 and initiation of the registration procedure as specified in subclause\u00a05.5.1.2.2 or 5.5.1.3.2\nNon-3GPP de-registration timer\tDefault 54 min.\tNOTE\u00a01\tNOTE\u00a02\tNOTE\u00a04\tAll 5GMM state over non-3GPP access except 5GMM-DEREGISTERED over non-3GPP access\tEntering 5GMM-IDLE mode over non-3GPP access\tN1 NAS signalling connection over non-3GPP access established or when entering state 5GMM-DEREGISTERED over non-3GPP access\tImplicitly de-register the UE for non-3GPP access on 1st expiry\nNOTE\u00a01:\tThe value of this timer is provided by the network operator during the registration procedure.\tNOTE\u00a02:\tThe default value of this timer is used if the network does not indicate a value in the REGISTRATION ACCEPT message and the UE does not have a stored value for this timer.\tNOTE\u00a03:\tThe value of this timer is UE implementation specific, with a minimum value of 60 seconds.\tNOTE\u00a04:\tIf the T3346 value received in the mobility management messages is greater than the value of the non-3GPP de-registration timer, the UE sets the non-3GPP de-registration timer value to be 4 minutes greater than the value of timer T3346.\tNOTE\u00a05:\tThe conditions for which this applies are described in subclause\u00a05.5.1.3.7.\nTable\u00a010.2.2: Timers of 5GS mobility management \u2013 AMF side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3550\t6s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of REGISTRATION ACCEPT message with 5G-GUTI, with SOR transparent container IE, the Extended emergency number list IE or the Operator-defined access category definitions IE\tTransmission of REGISTRATION ACCEPT message with any of a) Network slicing subscription changed indication, and b) new configured NSSAI and optionally new mapped S-NSSAI(s)\tREGISTRATION COMPLETE message received\tRetransmission of REGISTRATION ACCEPT message\nT3560\t6s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of AUTHENTICATION REQUEST message\tTransmission of SECURITY MODE COMMAND message\tAUTHENTICATION RESPONSE message received\tAUTHENTICATION FAILURE message received\tSECURITY MODE COMPLETE message received\tSECURITY MODE REJECT message received\tRetransmission of AUTHENTICATION REQUEST message or SECURITY MODE COMMAND message\nT3570\t6s\t5GMM-COMMON-PROCEDURE-INITIATED\tTransmission of IDENTITY REQUEST message\tIDENTITY RESPONSE message received\tRetransmission of IDENTITY REQUEST message\nT3513\tNOTE\u00a04\t5GMM-REGISTERED\tPaging procedure initiated\tPaging procedure completed as specified in subclause\u00a05.6.2.2.1\tNetwork dependent\nT3522\t6s\t5GMM-DEREGISTERED-INITIATED\tTransmission of DEREGISTRATION REQUEST message\tDEREGISTRATION ACCEPT message received\tRetransmission of DEREGISTRATION REQUEST message\nT3555\t6s\t5GMM-REGISTERED\tTransmission of CONFIGURATION UPDATE COMMAND message with Acknowledgement requested flag IE\tCONFIGURATION UPDATE COMPLETE message received\tRetransmission of CONFIGURATION UPDATE COMMAND message\nT3565\t6s\t5GMM-REGISTERED\tTransmission of NOTIFICATION message\tSERVICE REQUEST message received\tNOTIFICATION RESPONSE message received\tREGISTRATION REQUEST\tMessage received\tRetransmission of NOTIFICATION message\nMobile reachable timer\tNOTE\u00a01 \tAll except 5GMM-DEREGISTERED\tEntering 5GMM-IDLE mode\tN1 NAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry, and start implicit de-registration timer, if the UE is not registered for emergency services.\t\tImplicitly de-register the UE which is registered for emergency services\nImplicit de-registration timer\tNOTE\u00a02\tAll except 5GMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in 5GMM-IDLE mode\tN1 NAS signalling connection established\tImplicitly de-register the UE on 1st expiry\nNon-3GPP implicit de-registration timer\tNOTE\u00a03\tAll except 5GMM-DEREGISTERED\tEntering 5GMM-IDLE mode over non-3GPP access\tN1 NAS signalling connection over non-3GPP access established\tImplicitly de-register the UE for non-3GPP access on 1s expiry\nNOTE\u00a01:\tThe default value of this timer is 4 minutes greater than the value of timer T3512. If the UE is registered for emergency services, the value of this timer is set equal to the value of timer T3512. If the T3346 value provided in the mobility management messages is greater than the value of the timer T3512, the AMF sets the mobile reachable timer and the implicit de-registration timer such that the sum of the timer values is greater than the value of timer T3346.\tNOTE\u00a02:\tThe value of this timer is network dependent. If MICO is activated, the default value of this timer is 4 minutes greater than the value of timer T3512.\tNOTE\u00a03:\tThe value of this timer is network dependent. The default value of this timer is 4 minutes greater than the non-3GPP de-registration timer. If the T3346 value provided in the mobility management messages is greater than the value of the non-3GPP de-registration timer, the AMF sets the non-3GPP implicit de-registration timer value to be 8 minutes greater than the value of timer T3346.\tNOTE\u00a04:\tThe value of this timer is network dependent.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently there are some inconsistencies in the specification regarding the use of SUCI:1) According to subclause 5.3.2, Permanent identifiers, the UE includes the SUCI as mobile identity only in the Registration Request message or Identity Response message, and only if certain conditions are fulfilled. This is in contradiction to the description in subclause 5.5.2.2.1, where the UE is allowed to include the SUCI also in the Deregistration Request message.2) According to the timer table in subclause 10.2, the timer T3519 protecting the UE from too frequent requests to calculate a fresh SUCI value can be running only in state 5GMM-REGISTERED-INITIATED. But in the description of the identity request procedure (subclause 5.4.3.3) and de-registration procedure (subclause 5.5.2.2.1) there is no such dependency on the 5GMM state. I.e. the UE will start T3519 whenever is sends an Identity Response message or Deregistration Request message with a fresh SUCI included.Overall it is not clear whether the UE can use the T3519 mechanism only during the registration procedure, i.e. - only if the identity request is received during a registration procedure or the UE initiates the deregistration procedure during a registration procedure, - or whether the UE can use the mechanism at any time, i.e. also in states 5GMM-REGISTERED, 5GMM-DEREGISTERED-INITIATED, and 5GMM-SERVICE-REQUEST-INITIATED.Interoperability impact analysisNo interoperability issues are expected for 1) and 2) for the following reasons:1) A legacy network implemented according to subclauses 5.5.2.2.1 and 5.5.2.2.2 will be able to process a Deregistration Request message including a SUCI. Note that there is no network requirement to check whether the UE is allowed to include a SUCI in a specific message.2) The mechanism to start T3519 and not create a fresh SUCI while T3519 is running is UE internal. There is no network requirement to check in a specific situation whether the UE created a fresh SUCI or not.\n\n>>> SUMMARY OF CHANGE\n1) Possibility to include the SUCI also in the Deregistration Request message is added to subclause 5.3.2.2) Missing states are added to the timer table.\n\n>>> CONSEQUENCES IF NOT REVISED\n1) Inconsistent description could result in a UE implementation which is not able to react to the user's request to terminate an ongoing initial registration procedure by sending a Deregistration Request message.2) If due to the inconsistent description a UE implementation does not start T3519 while the UE is e.g. in 5GMM-REGISTERED, this can result in unnecessary high power consumption. The possibility to repeat the ID request for SUCI with very high frequency could also be used for security attacks."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nProposed modification\n5.1.1.2\tInitial registration\n5.1.1.2.1\tGeneral\nThe initial registration procedure consists of the UE sending an unprotected REGISTER request and, if challenged depending on the security mechanism supported for this UE, sending the integrity-protected REGISTER request or other appropriate response to the challenge. The UE can register a public user identity with any of its contact addresses at any time after it has acquired an IP address, discovered a P-CSCF, and established an IP-CAN bearer that can be used for SIP signalling. However, the UE shall only initiate a new registration procedure when it has received a final response from the registrar for the ongoing registration, or the previous REGISTER request has timed out.\nWhen registering any public user identity belonging to the UE, the UE shall either use an already active pair of security associations or a TLS session to protect the REGISTER requests, or register the public user identity via a new initial registration procedure.\nWhen binding any one of its public user identities to an additional contact address via a new initial registration procedure, the UE shall follow the procedures described in the draft-ietf-sip-outbound\u00a0[92]. The set of security associations or a TLS session resulting from this initial registration procedure will have no impact on the existing set of security associations or TLS sessions that have been established as a result of previous initial registration procedures. However, if the UE registers any one of its public user identities with a new contact address via a new initial registration procedure and does not employ the procedures described in the draft-ietf-sip-outbound\u00a0[92], then the new set of security associations or TLS session shall replace any existing set of security association or TLS session.\nIf the UE detects that the existing security associations or TLS sessions associated with a given contact address are no longer active (e.g., after receiving no response to several protected messages), the UE shall: \n-\tconsider all previously registered public user identities bound to this security associations or TLS session that are only associated with this contact address as deregistered; and\n-\tstop processing all associated ongoing dialogs and transactions that were using the security associations or TLS session associated with this contact address, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs).\nThe UE shall send only the unprotected REGISTER requests to the port advertised to the UE during the P-CSCF discovery procedure. If the UE does not receive any specific port information during the P-CSCF discovery procedure, or if the UE was pre-configured with the P-CSCF's IP address or domain name and was unable to obtain specific port information, the UE shall send the unprotected REGISTER request to the SIP default port values as specified in RFC\u00a03261\u00a0[26]. \n\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request-URI in the registration, according to the procedures described in subclause\u00a05.1.1.1A or subclause\u00a05.1.1.1B. A public user identity may be input by the end user.\nOn sending an unprotected REGISTER request, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP URI that contains the public user identity to be registered;\nb)\ta To header field set to the SIP URI that contains the public user identity to be registered;\nc)\ta Contact header field set to include SIP URI(s) containing the IP address or FQDN of the UE in the hostport parameter. If the UE supports GRUU (see table\u00a0A.4, item\u00a0A.4/53) or multiple registrations, the UE shall include a \"+sip.instance\" header field parameter containing the instance ID. If the UE supports multiple registrations it shall include \"reg-id\" header field parameter as described in draft-ietf-sip-outbound\u00a0[92]. The UE shall include all supported ICSI values (coded as specified in subclause\u00a07.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause\u00a07.9.2 and RFC\u00a03840\u00a0[62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause\u00a07.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause\u00a07.9.3 and RFC\u00a03840\u00a0[62];\nd)\ta Via header field set to include the sent-by field containing the IP address or FQDN of the UE and the port number where the UE expects to receive the response to this request when UDPis used. For TCP, the response is received on the TCP connection on which the request was sent. The UE shall also include a \"rport\" header field parameter with no value in the Via header field;\nNOTE\u00a01:\tWhen sending the unprotected REGISTER request using UDP, the UE transmit the request from the same IP address and port on which it expects to receive the response to this request.\ne)\ta registration expiration interval value of 600\u00a0000 seconds as the value desired for the duration of the registration;\nNOTE\u00a02:\tThe registrar (S-CSCF) might decrease the duration of the registration in accordance with network policy. Registration attempts with a registration period of less than a predefined minimum value defined in the registrar will be rejected with a 423 (Interval Too Brief) response.\nf)\ta Request-URI set to the SIP URI of the domain name of the home network used to address the REGISTER request;\ng)\tthe Supported header field containing the option-tag \"path\", and\n1)\tif GRUU is supported, the option-tag \"gruu\"; and\n2)\tif multiple registrations is supported, the option-tag \"outbound\".\nh)\tif a security association or TLS session exists, and if available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause\u00a07.2A.4).\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\na)\tstore the expiration time of the registration for the public user identities found in the To header field value and bind it to the respective contact address of the UE;\nb)\tstore as the default public user identity the first URI on the list of URIs present in the P-Associated-URI header field and bind it to the respective contact address of the UE and the associated set of security associations or TLS session;\nNOTE\u00a03:\tWhen using the respective contact addres and associated set of security associations or TLS session, the UE can utilize additional URIs contained in the P-Associated-URI header field and bound it to the respective contact address of the UE and the associated set of security associations or TLS session, e.g. for application purposes.\nc)\ttreat the identity under registration as a barred public user identity, if it is not included in the P-Associated-URI header field;\nd)\tstore the list of service route values contained in the Service-Route header field and bind the list to the contact address and the associated set of security associations or TLS session over which the REGISTER request was sent, in order to build a proper preloaded Route header field value for new dialogs and standalone transactions when using this contact address and the associated set of security associations or TLS session;\ne)\tfind the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter or a \"temp-gruu\" header field parameter or both, and the UE supports GRUU (see table\u00a0A.4, item\u00a0A.4/53), then store the value of those parameters as the GRUUs for the UE in association with the public user identity and the contact address that was registered; and\nf)\tthe UE shall check whether the option-tag \"outbound\" is present in the Require header field:\n-\tif no option-tag \"outbound\" is present, the UE shall refrain from registering additional IMS flows for the same private identity; or\n-\tif an option-tag \"outbound\" is present, the UE may establish additional IMS flows for the same private identity, as defined in draft-ietf-sip-outbound\u00a0[92].\nOn receiving a 305 (Use Proxy) response to the unprotected REGISTER request, the UE shall:\na)\trelease all IP-CAN bearers used for the transport of media according to the procedures in subclause\u00a09.2.2;\nb)\tinitiate either a new P-CSCF discovery procedure as described in subclause\u00a09.2.1, or select a new P-CSCF, if the UE was pre-configured with more than one P-CSCF's IP addresses or domain names;\nc)\tselect a P-CSCF address, which is different from the previously used address, from the address list; and\nd)\tperform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nOn receiving a 423 (Interval Too Brief) response to the REGISTER request, the UE shall:\n-\tsend another REGISTER request populating the registration expiration interval value with an expiration timer of at least the value received in the Min-Expires header field of the 423 (Interval Too Brief) response.\nOn receiving a 408 (Request Timeout) response or 500 (Server Internal Error) response or 504 (Server Time-Out) or 600 (Busy Everywhere) response for an initial registration, the UE may attempt to perform initial registration again.\nWhen the timer F expires at the UE, the UE may:\na)\tselect a different P-CSCF address from the list of P-CSCF addresses discovered during the procedures described in subclause\u00a09.2.1 or from its pre-configured list of P-CSCF's IP addresses or domain names;\nb)\tif no response has been received when attempting to contact all P-CSCFs known by the UE, the UE may get a new set of P-CSCF-addresses as described in subclause\u00a09.2.1; and\nc)\tperform the procedures for initial registration as described in subclause\u00a05.1.1.2.\nNOTE\u00a04:\tIt is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g. based on ICMP messages.\nAfter a maximum of 5 consecutive unsuccessful initial registration attempts, the UE shall not automatically attempt any further initial registration via the same network and the same P-CSCF, for an implementation dependant time of at least: \na)\tthe amount of time indicated in the Retry-After header field of the 4xx, 5xx, or 6xx response received in response to the most recent registration request, if the Retry-After header field was present; or\nb)\t30 minutes, if the Retry-After header field was not present and the initial registration was automatically performed as a consequence of a failed reregistration; or \nc)\t5 minutes, if the Retry-After header field was not present and the initial registration was not performed as a consequence of a failed reregistration.\nThese limits do not apply if the UE is power cycled.\nNext proposed modification\n5.1.1.5\tAuthentication\n5.1.1.5.1\tIMS AKA - general\nAuthentication is performed during initial registration. A UE can be re-authenticated during subsequent reregistrations, deregistrations or registrations of additional public user identities. When the network requires authentication or re-authentication of the UE, the UE will receive a 401 (Unauthorized) response to the REGISTER request.\nOn receiving a 401 (Unauthorized) response to the REGISTER request, the UE shall:\n1)\textract the RAND and AUTN parameters;\n2)\tcheck the validity of a received authentication challenge, as described in 3GPP\u00a0TS\u00a033.203\u00a0[19] i.e. the locally calculated XMAC must match the MAC parameter derived from the AUTN part of the challenge; and the SQN parameter derived from the AUTN part of the challenge must be within the correct range; and\n3)\tcheck the existence of the Security-Server header field as described in RFC\u00a03329\u00a0[48]. If the Security-Server header field is not present or it does not contain the parameters required for the setup of the set of security associations (see annex\u00a0H of 3GPP\u00a0TS\u00a033.203\u00a0[19]), the UE shall abandon the authentication procedure and send a new REGISTER request with a new Call-ID.\nIn the case that the 401 (Unauthorized) response to the REGISTER request is deemed to be valid the UE shall:\n1)\tcalculate the RES parameter and derive the keys CK and IK from RAND as described in 3GPP\u00a0TS\u00a033.203\u00a0[19];\n2)\tset up a temporary set of security associations for this registration based on the static list and parameters the UE received in the 401 (Unauthorized) response and its capabilities sent in the Security-Client header field in the REGISTER request. The UE sets up the temporary set of security associations using the most preferred mechanism and algorithm returned by the P-CSCF and supported by the UE and using IK and CK (only if encryption enabled) as the shared key. The UE shall use the parameters received in the Security-Server header field to setup the temporary set of security associations. The UE shall set a temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n3)\tsend another REGISTER request using the temporary set of security associations to protect the message. The header fields are populated as defined for the initial REGISTER request that was challenged with the received 401 (Unauthorized) response, with the addition that the UE shall include an Authorization header field containing:\n-\tthe \"realm\" header field parameter set to the value as received in the \"realm\" WWW-Authenticate header field parameter;\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"response\" header field parameter that contains the RES parameter, as described in RFC\u00a03310\u00a0[49];\n-\tthe \"uri\" header field parameter, set to the SIP URI of the domain name of the home network;\n-\tthe \"algorithm\" header field parameter, set to the value received in the 401 (Unauthorized) response; and\n-\tthe \"nonce\" header field parameter, set to the value received in the 401 (Unauthorized) response. \n\tThe UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID of the security association protected REGISTER request which carries the authentication challenge response to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nOn receiving the 200 (OK) response for the security association protected REGISTER request registering a public user identity with the associated contact address, the UE shall:\n-\tchange the temporary set of security associations to a newly established set of security associations, i.e. set its SIP level lifetime to the longest of either the previously existing set of security associations SIP level lifetime, or the lifetime of the just completed registration plus 30 seconds; and\n-\tif this is the only set of security associations available toward the P-CSCF, use the newly established set of security associations for further messages sent towards the P-CSCF. If there are additional sets of security associations (e.g. due to registration of multiple contact addresses), the UE can either use them or use the newly established set of security associations for further messages sent towards the P-CSCF as appropriate.\nNOTE\u00a01:\tIf the UE has registered multiple contact addresses, the UE can either send requests towards the P-CSCF over the newly established set of security associations, or use different UE's contact address and associated set of security associations when sending the requests towards the P-CSCF. Responses towards the P-CSCF that are sent via UDP will be sent over the same set of security associations that the related request was received on. Responses towards the P-CSCF that are sent via TCP will be sent over the same set of security associations that the related request was received on.\nWhen the first request or response protected with the newly established set of security associations is received from the P-CSCF or when the lifetime of the old set of security associations expires, the UE shall delete the old set of security associations and related keys it may have with the P-CSCF after all SIP transactions that use the old set of security associations are completed.\nNOTE\u00a02:\tIf the UE has registered multiple contact addresses, the S-CSCF may use different contact address when sending the requests desined for the UE. In this case the UE will not receive the subsequent requests over the newly established set of security associations.\nWhenever the 200 (OK) response is not received before the temporary SIP level lifetime of the temporary set of security associations expires or a 403 (Forbidden) response is received, the UE shall consider the registration to have failed. The UE shall delete the temporary set of security associations it was trying to establish, and use the old set of security associations. The UE should send an unprotected REGISTER request according to the procedure specified in subclause\u00a05.1.1.2 if the UE considers the old set of security associations to be no longer active at the P-CSCF.\nIn the case that the 401 (Unauthorized) response is deemed to be invalid then the UE shall behave as defined in subclause\u00a05.1.1.5.3.\nNext proposed modification\n5.1.1.5.6\tSIP digest with TLS \u2013 general\nOn receiving a 401 (Unauthorized) response to the REGISTER request, the procedures in subclause\u00a05.1.1.5.4 apply with the following differences:\n-\tThe UE shall check the existence of the Security-Server header field as described in RFC\u00a03329\u00a0[48]. If the Security-Server header field is not present or the list of supported security mechanisms does not include \"tls\", the UE shall abandon the authentication procedure and send a new REGISTER request.\nIn the case that the 401 (Unauthorized) response to the REGISTER is deemed to be valid the UE shall send another REGISTER request using the TLS session to protect the message. The header fields are populated as defined for the initial request, with the addition that the UE shall include an Authorization header field containing a challenge response, \"cnonce\", \"qop\", and \"nonce-count\" header field parameters as indicated in RFC\u00a02617\u00a0[21]. The UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nWhen SIP digest with TLS is used, and for the case where the 401 (Unauthorized) response to the REGISTER request is deemed to be valid, the UE shall establish the TLS session as described in 3GPP\u00a0TS\u00a033.203\u00a0[19]. The UE shall use this TLS session to send all further messages towards the P-CSCF.\nNext proposed modification\n5.2.2\tRegistration\n5.2.2.1\tGeneral\nThe P-CSCF shall be prepared to receive only the unprotected REGISTER requests on the SIP default port values as specified in RFC\u00a03261\u00a0[26]. The P-CSCF shall also be prepared to receive only the unprotected REGISTER requests on the port advertised to the UE during the P-CSCF discovery procedure.\n\nThe P-CSCF shall distinguish between security mechanisms through the use of the Security-Client header field and Authorization header field as follows:\n1)\tif a REGISTER request from the UE contains a Security-Client header field then for an initial registration, the P-CSCF shall select the sec-mechanism and mode (as described in Annex\u00a0H of 3GPP\u00a0TS\u00a033.203\u00a0[19]) from the corresponding parameters offered in the Security-Client header field according to its priorities, as follows:\n-\tif the P-CSCF selects the sec-mechanism \"ipsec- 3gpp\" then follow the procedures as described in subclause\u00a05.2.2.2, in addition to the procedures described in this subclause;\n-\tif the P-CSCF selects the sec-mechanism \"tls\" then follow the procedures as described in subclause\u00a05.2.2.4, in addition to the procedures described in this subclause.\n2)\tif a REGISTER request from the UE does not contain a Security-Client header field, or the P-CSCF does not select any sec-mechanism from the Security-Client header field, then the P-CSCF shall behave as follows, in addition to the procedures described in the remainder of this subclause:\n-\tif the REGISTER request does not contain an Authorization header field and was received over an access network defined in 3GPP specifications then follow the GPRS-IMS-Bundled authentication  procedures as described in subclause\u00a05.2.2.6; or\n-\tif the REGISTER request does not contain an Authorization header field and was received over a TISPAN NASS then follow the NASS-IMS bundled authentication procedures described in subclause\u00a05.2.2.5. If the NASS-IMS bundled authentcation related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall not continue and shall return an error message to the UE; or\nEditor's Note:\tIt is FFS which error message is sent to the UE in the case of a failed query from the P-CSCF to the TISPAN NASS.\n-\tif the REGISTER request contains an Authorization header field and was not received over a TISPAN NASS then follow the SIP digest without TLS procedures as described in subclause\u00a05.2.2.3; or\n-\tif the REGISTER request contains an Authorization header field and was received over a TISPAN NASS, and the P-CSCF supports both SIP digest and NASS-IMS bundled authentication, then the P-CSCF shall perform the steps required for NASS-IMS bundled authentication, in subclause\u00a05.2.2.5, as well as the steps required for SIP digest without TLS, in subclause\u00a05.2.2.3, unless it is configured to behave differently. If the NASS-IMS bundled authentication related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall only continue with the SIP digest related steps.\nFor subsequent registrations, the P-CSCF shall continue to use the selected mechanism.\nNOTE\u00a01:\tThe steps required for SIP digest and for NASS-IMS bundled authentcation are not in contradiction. Rather, for NASS-IMS bundled authentication the P-CSCF needs to perform additional steps, namely an exchange with the TISPAN NASS and an inclusion of NASS location information in the REGISTER request, on top of the steps required for SIP digest.\nNOTE\u00a02:\tHow the P-CSCF knows the access network type of a specific network interface is implementation-dependent (e.g. it can know the access network type from different UE IP address ranges or by using different network interfaces for different access network types).\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall:\n1)\tinsert a Path header field in the request including an entry containing: \n-\tthe SIP URI identifying the P-CSCF;\n-\tan indication that requests routed in this direction of the path (i.e. from the S-CSCF towards the P-CSCF) are expected to be treated as for the UE-terminating case. This indication may e.g. be in a parameter in the URI, a character string in the user part of the URI, or be a port number in the URI;\n-\tan IMS flow token and the \"ob\" SIP URI parameter according to draft-ietf-sip-outbound\u00a0[92];\n2)\tinsert a Require header field containing the option-tag \"path\";\n3)\tinsert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP\u00a0TS\u00a032.260\u00a0[17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n4)\tinsert a P-Visited-Network-ID header field, with the value of a pre-provisioned string that identifies the visited network at the home network;\n5)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, forward the request to an IBCF in the visited network.\n\tIf the selected exit point:\n-\tdoes not respond to the REGISTER request and its retransmissions by the P-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\n\tthe P-CSCF shall select a new exit point and forward the original REGISTER request.\nNOTE\u00a03:\tThe list of the exit points can be either obtained as specified in RFC\u00a03263\u00a0[27A] or provisioned in the P-CSCF.\n\tIf the P-CSCF fails to forward the REGISTER request to any exit point, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC\u00a03261\u00a0[26] unless local policy allows omitting the exit point;\nNOTE\u00a04:\tIf the P-CSCF forwards the request to an IBCF in the visited network, the IBCF can determine the entry point of the home network, using the same mechanisms as described in NOTE\u00a01 above. In that case the P-CSCF does not need to determine the entry point of the home network.\n6)\tdetermine the entry point of the home network and forward the request to that entry point.\n\tIf the selected entry point:\n-\tdoes not respond to the REGISTER request and its retransmissions by the P-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\n\tthe P-CSCF shall select a new entry point and forward the original REGISTER request. \nNOTE\u00a05:\tThe list of the entry points can be either obtained as specified in RFC\u00a03263\u00a0[27A] or provisioned in the P-CSCF.\n\tIf the P-CSCF fails to forward the REGISTER request to any entry point, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC\u00a03261\u00a0[26]; and\n7)\tif the REGISTER request contains an Authorization header field, remove the \"integrity-protected\" header field parameter, if present.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request, the P-CSCF shall check the value of the registration expiration inyerval value. When the registration expiration interval value is different than zero, then the P-CSCF shall:\n1)\tsave the list of service route values in the Service-Route header fields preserving the order, and bind the list to the contact address and the associated security association or TLS session over which the REGISTER request was received. The P-CSCF shall store this list during the entire registration period of the respective public user identity with this associated contact address. The P-CSCF shall use this list to validate the routeing information in the requests originated by the UE and received over the respective security association or a TLS session. If the list of Service-Route headers already exists for this contact address, the P-CSCF shall replace the already existing list of service route values with the received list of Service-Route headers;\nNOTE\u00a06:\tWhen the UE registers multiple contact addresses, then the UE and the P-CSCF will have a list of Service-Route headers for each contact address and the associated security association or TLS session. When sending a request using a given the associated security association or TLS session and associated contact address the UE will use the corresponding list of Service-Route headers, when building a list of Route headers.\n2)\tassociate the list of service route values with the registered public user identity and the associated contact address the associated security association or TLS session;\n3)\tstore the public user identities and wildcarded public user identities, found in the P-Associated-URI header field value, including any associated display names, and any parameters associated with either the user or the identities of the user, and associate them to the registered public user identity, i.e. the registered public user identity and its associated set of implicitly registered public user identities and implicitly registered wildcarded public user identities are bound to the contact address and security association or TLS session over which the REGISTER request was received;\n4)\tstore the default public user identity, including its associated display name, if provided, for use with procedures for the P-Asserted-Identity header field for requests received from the UE over the respective security association or TLS session. The default public user identity is the first on the list of URIs present in the P-Associated-URI header field;\nNOTE\u00a07:\tThere can be more than one default public user identity stored in the P-CSCF, as the result of the multiple registrations of public user identities.\nNOTE\u00a08:\tFor each contact address and the associated security association or TLS session the P-CSCF will maintain a list of registered public user identities and the associated default public user identities, that it will use when populating the P-Asserted Identity header.\n5)\tstore the values received in the P-Charging-Function-Addresses header field;\n6) \tif a \"term-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"term-ioi\" header field parameter; and\nNOTE\u00a09:\tAny received \"term-ioi\" header field parameter will contain a type 1 IOI. The type 1 IOI identifies the home network of the registered user.\n7)\tif the P-CSCF included an IMS flow token and the \"ob\" SIP URI parameter in the Path header field of the REGISTER request, check for presence of  the option-tag \"outbound\" in the Require header field of the a 200 (OK) response:\n-\tif the option-tag \"outbound\" is present, it indicates that the UE has successfully registered its public user identity with a new bidirectional flow as defined in the draft-ietf-sip-outbound\u00a0[92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in draft-ietf-sip-outbound\u00a0[92]; or\n-\tif the option-tag \"outbound\" is not present, it indicates that the public user identity has not been registered as specified in the draft-ietf-sip-outbound\u00a0[92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in RFC\u00a03261\u00a0[26]. \nNext proposed modification\n5.2.2.2\tIMS AKA as a security mechanism\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause\u00a05.2.2.1, the P-CSCF shall additionally:\n1)\tinsert the \"integrity-protected\" header field parameter (described in subclause\u00a07.2A.2) with a value \"yes\" into the Authorization header field in case the REGISTER request was either received protected with the security association created during an ongoing authentication procedure and includes an authentication challenge response (i.e. RES parameter), or it was received on the security association created during the last successful authentication procedure, otherwise insert the parameter with the value \"no\";\n1A)\tif the \"reg-id\" header field parameter was included in the Contact header field of the REGISTER request, insert in the Path header an IMS flow token and the \"ob\" URI parameter according to draft-ietf-sip-outbound\u00a0[92]. The IMS flow token shall identify the flow from the P-CSCF toward the UE, as follows: \na)\tfor UDP, the IMS flow token identifies the unidirectional flow from the P-CSCF's protected client port and the P-CSCF's IP address to the UE's protected server port and the UE's IP address. This flow is used by the P-CSCF to send requests and responses to the UE. The P-CSCF shall receive the requests and responses from the UE on its protected server port; or\nb)\tfor TCP, the IMS flow token identifies the excising TCP connection between the UE and the P-CSCF. This TCP connection was established by the UE, i.e. from the UE's protected server port and the UE's IP address to the P-CSCF's protected client port and the P-CSCF's IP address. This TCP connection is used to exchange SIP messages between the UE and the P-CSCF;\n2)\tin case the REGISTER request was received without protection:\na)\tcheck the existence of the Security-Client header field. If the Security-Client header field is present, then remove and store it. If the Security-Client header field is not present, then the P-CSCF shall return a suitable 4xx response;\nb)\tset the value of the \"rport\" header field parameter in the Via header field to the source port of the received REGISTER request;\nc)\tinsert the \"received\" header field parameter in the Via header field containing the source IP address that the request came from, as defined in the RFC 3581 [56A]; and\nNOTE\u00a01:\tAs defined in RFC 3581 [56A], the P-CSCF will insert a \"received\" header field parameter containing the source IP address that the request came from, even if it is identical to the value of the \"sent-by\" component.\nNOTE\u00a02:\tUpon receiving the unprotected REGISTER request the P-CSCF detects if the UE is behind a NAT.\n3)\tin case the REGISTER request was received protected, then:\na)\tcheck the security association which protected the request. If the security association is a temporary one, then the request is expected to contain a Security-Verify header field in addition to a Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such header fields, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The request should be rejected by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header field;\nb)\tif the security association the REGISTER request was received on, is an already established one, then:\n-\tthe P-CSCF shall remove the Security-Verify header field if it is present;\n-\ta Security-Client header field containing new parameter values is expected. If the Security-Client header field or any required parameter is missing, then the P-CSCF shall return a suitable 4xx response; and\n-\tthe P-CSCF shall remove and store the Security-Client header field before forwarding the request to the S-CSCF;\nc)\tcheck if the private user identity conveyed in the Authorization header field of the protected REGISTER request is the same as the private user identity which was previously challenged or authenticated. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response; and\nd)\tignore the \"rport\" Via header field parameter, if included.\nNOTE\u00a03:\tOnce the IPsec security associations between the UE and the P-CSCF have been created, in case of UDP the P-CSCF sends the responses to a different UE's port then the one from which the request was received from the UE. For the TCP, the responses are sent on the TCP connection on which the request was received. Hence, the P-CSCF  will ignore the \"rport\" Via header field parameter in all protected requests and responses, if received.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a REGISTER request, the P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tremove the \"ck\" and \"ik\" WWW-Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF static security list and the parameters needed for this security association setup, as specified in Annex H of 3GPP\u00a0TS\u00a033.203\u00a0[19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC\u00a03329\u00a0[48]. The P-CSCF shall support the IPsec layer algorithms for integrity and confidentiality protection as defined in 3GPP\u00a0TS\u00a033.203\u00a0[19] and shall announce support for them according to the procedures defined in RFC\u00a03329\u00a0[48];\n4)\tset up the temporary set of security associations for this registration with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. For further details see 3GPP\u00a0TS\u00a033.203\u00a0[19] and RFC\u00a03329\u00a0[48]. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response to the UE using the security association with which the associated REGISTER request was protected, or unprotected in case the REGISTER request was received unprotected. If the 401 (Unauthorized) response to the unprotected REGISTER request is sent using UDP, the P-CSCF shall send the response to the IP address listed in the \"received\" Via header field parameter and the port in the \"rport\" Via header field parameter. In case of TCP, the P-CSCF shall send  the response over the same TCP connection over which the request was received from the UE.\nNOTE\u00a04:\tThe challenge in the 401 (Unauthorized) response sent back by the S-CSCF to the UE as a response to the REGISTER request is piggybacked by the P-CSCF to insert the Security-Server header field in it. The S-CSCF authenticates the UE, while the P-CSCF negotiates and sets up two pairs of security associations with the UE during the same registration procedure. For further details see 3GPP\u00a0TS\u00a033.203\u00a0[19].\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request as defined in subclause\u00a05.2.2.1, the P-CSCF shall additionally:\n1)\tif an existing set of security association is available, set the SIP level lifetime of the security association to the longest of either the previously existing security association lifetime, or the lifetime of the just completed registration plus 30 seconds;\n2)\tif a temporary set of security associations exists, change the temporary set of security associations to a newly established set of security associations, i.e. set its SIP level lifetime to the longest of either the previously existing set of security associations SIP level lifetime, or the lifetime of the just completed registration plus 30 seconds; and\n3)\tprotect the 200 (OK) response to the REGISTER request within the same security association to that in which the REGISTER request was protected.\nIf the P-CSCF receives a SIP message (including REGISTER requests) from the UE over the newly established set of security associations that have not yet been taken into use, the P-CSCF shall:\n1)\treduce the SIP level lifetime of the old set of security associations towards the same UE to 64*T1 (if currently longer than 64*T1); and\n2)\tuse the newly established set of security associations for further messages sent towards the UE as appropriate (i.e. take the newly established set of security associations into use).\nNOTE\u00a05:\tIf the UE has registered other contact addresses and established security associations for these contact addresses, it may use them when sending subsequent SIP messages rather then using the newly established set of security associations. In this case the P-CSCF will not receive any SIP message over the newly established set of security associations.\nNOTE\u00a06:\tIn this case, the P-CSCF will send requests  (that specify the associated contact address in the Request-URI) towards the UE over the newly established set of security associations. Responses towards the UE that are sent via UDP will be sent over the newly established set of security associations. Responses towards the UE that are sent via TCP will be sent over the same set of security associations that the related request was received on.\nNOTE\u00a07:\tWhen receiving a SIP message (including REGISTER requests) from the UE over a set of security associations that is different from the newly established set of security associations, the P-CSCF will not take any action on any set of security associations.\nWhen the SIP level lifetime of an old set of security associations is about to expire, i.e. their SIP level lifetime is shorter than 64*T1 and a newly established set of security associations has not been taken into use, the P-CSCF shall use the newly established set of security associations for further messages towards the UE as appropriate (see NOTE\u00a02).\nWhen sending the 200 (OK) response for a REGISTER request that concludes a re-authentication, the P-CSCF shall:\n1)\tkeep the set of security associations that was used for the REGISTER request that initiated the re-authentication;\n2)\tkeep the newly established set of security associations created during this authentication; and\n3)\tgo on using for further requests sent towards the UE the set of security associations and associated contact address that was used to protect the REGISTER request that initiated the re-authentication as appropriate (see NOTE\u00a06).\nWhen sending the 200 (OK) respone for a REGISTER request that concludes an initial authentication of the user registering its public user identity with a given contact address the associated security association, i.e. the REGISTER request that initiated the authentication was received unprotected, the P-CSCF shall:\n1)\tkeep the newly established set of security associations created during this authentication; and\n2)\tuse the kept newly established set of security associations and associated contact address for further messages sent towards the UE as appropriate (see NOTE\u00a06).\nNOTE\u00a08:\tFor each contact address and the associated set of security associations the P-CSCF will maintain two Route header field lists. The first list of Service-Route headers, received during the last registration procedure of the respective contact address, is used only to validate the routeing information in the initial requests for a dialog and stand alone transactions that originate from the UE and are received over the respective security association. This list is valid as long as there is at least public user identity registered with the associated contact address. The second list is the list of Route headers - constructed from the Record Route header fields in the initial INVITE and associated response and is used during the duration of the call. Once the call is terminated, the list of Route headers is discarded.\nThe P-CSCF shall delete any security association from the IPsec database when their SIP level lifetime expires.\nThe handling of the security associations at the P-CSCF is summarized in table\u00a05.2.2-1.\nTable\u00a05.2.2-1: Handling of security associations at the P-CSCF\n\tTemporary set of security associations\tNewly established set of security associations\tOld set of security associations\nSIP message received over newly established set of security associations that have not yet been taken into use\tNo action\tTake into use\tReduce SIP level lifetime to 64*T1, if lifetime is larger than 64*T1\nSIP message received over old set of security associations\tNo action\tNo action\tNo action\nOld set of security associations currently in use will expire in 64*T1\tNo action\tTake into use\tNo action\nSending an authorization challenge within a 401 (Unauthorized) response for a REGISTER request\tCreate\tRemove any previously existing temporary set of security associations \tNo action\tNo action\nSending 200 (OK) response for REGISTER request that concludes re-authentication\tChange to a newly established set of security associations\tConvert to and treat as old set of security associations (see next column)\tContinue using the old set of security associations over which the REGISTER request, that initiated the re-authentication was received.\tDelete all other old sets of security associations immediately\nSending 200 (OK) response for REGISTER request that concludes initial authentication\tChange to a newly established set of security associations and take into use immediately\tConvert to old set of security associations, i.e. delete\tDelete\n\nNext proposed modification\n5.2.2.4\tSIP digest with TLS as a security mechanism\nTLS is optional to implement and is used only in combination with SIP digest authentication. If the P-CSCF supports TLS, then the P-CSCF shall support TLS as described in 3GPP\u00a0TS 33.203\u00a0[19]. If the P-CSCF supports TLS, the P-CSCF shall support TLS ciphersuites as described in 3GPP\u00a0TS 33.203\u00a0[19].\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause\u00a05.2.2.1, the P-CSCF shall additionally:\n1)\tin case the REGISTER request was received without protection and with the Security-Client header field indicating \"tls\", then:\na)\tremove and store the Security-Client header field; \nb)\tdo not include the \"integrity-protected\" header field parameter in the Authorization header; or\nc)\tset the value of the \"rport\" header field parameter in the Via header to the source port of the received REGISTER request; and\nd)\tinsert the \"received\" header field parameter in the Via header containing the source IP address that the request came from, as defined in the RFC\u00a03581\u00a0[56A]; \nNOTE\u00a01:\tThe absence of an \"integrity-protected\" header field parameter in the Authorization header is an indication to the I-CSCF and S-CSCF that this is an initial REGISTER request.\nNOTE\u00a02:\tAs defined in RFC\u00a03581\u00a0[56A], the P-CSCF will insert a \"received\" header field parameter containing the source IP address that the request came from, even if it is identical to the value of the \"sent-by\" component.\nNOTE\u00a03:\tUpon receiving the unprotected REGISTER request the P-CSCF detects if the UE is behind a NAT.\n2)\tif the REGISTER request was received protected with a TLS session created during an ongoing authentication procedure, where the Session ID for the TLS session is not yet bound to a private user identity, and includes an authentication challenge response (i.e. response parameter), then:\na)\tcheck if the private user identity conveyed in the Authorization header of the protected REGISTER request is the same as the private user identity which was previously challenged. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response;\nb)\tcheck the existence of the Security-Verify header field and the Security-Client header field. If there are no such headers, then the P CSCF shall return a suitable 4xx response. If there are such headers, then the PCSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The P-CSCF should reject the request by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header fields; and\nc)\tinclude an \"integrity-protected\" header field parameter with the value set to \"tls-pending\"; or\n3)\tif the REGISTER request was received on an existing TLS session created during a previous authentication procedure and the private user identity contained in the REGISTER request matches the private user identity previously associated with the Session ID for this TLS session, then:\na)\tcheck if the private user identity conveyed in the Authorization header of the protected REGISTER request is the same as the private user identity which was previously authenticated. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response;\nb)\tcheck the existence of the Security-Verify header field and Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such headers, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The P-CSCF should reject the request by sending a suitable 4xx response; \nc)\tthe P-CSCF shall remove and store the Security-Client header field and remove the Security-Verify header field before forwarding the request to the S-CSCF; and \nd)\tinclude an \"integrity-protected\" header field parameter with the value set to \"tls-yes\".\nIf the P-CSCF require security agreement, and the Security-Client header field is not present, then the P-CSCF shall return a suitable 4xx response.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a REGISTER request, the P-CSCF shall:\n1)\tinsert a Security-Server header field in the response, containing the P-CSCF selected mechanism name, as specified in Annex\u00a0H of 3GPP\u00a0TS\u00a033.203\u00a0[19]. The P-CSCF shall support and indicate the \"tls\" security mechanism, as specified in RFC\u00a03329\u00a0[48]. The P-CSCF shall support the TLS ciphersuites as described in 3GPP\u00a0TS 33.203\u00a0[19] and shall announce support for them according to the procedures defined in RFC\u00a03329\u00a0[48]; and\n2)\tsend the 401 (Unauthorized) response to the UE using the TLS session with which the associated REGISTER request was protected, or unprotected in case the REGISTER request was received unprotected. If the 401 (Unauthorized) response to the unprotected REGISTER request is sent using UDP, the P-CSCF shall send the response to the IP address listed in the \"received\" header field parameter and the port in the \"rport\" header field parameter. In case of TCP, the P-CSCF shall send the response over the same TCP connection over which the request was received from the UE.\nNOTE\u00a04:\tThe challenge in the 401 (Unauthorized) response sent back by the S-CSCF to the UE as a response to the REGISTER request is piggybacked by the P-CSCF to insert the Security-Server header field in it.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request as defined in subclause\u00a05.2.2.1, and the registration expiration interval value is different than zero, the P-CSCF shall additionally:\n-\tcreate an association by storing and associating the UEs IP address and port of the TLS connection with the TLS Session ID, the private user identity and all the successfully registered public user identities related to that private user identity; and\n-\tprotect the 200 (OK) response to the REGISTER request within the same TLS session to that in which the request was protected.\nNo further proposal\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAccording to some of the security mechanism as described in clause 4.2B, it is possible to exchange SIP messages on default SIP ports or ports advertised to the UE during P-CSCF discoverly procedure, not only for the initial REGISTER message but for all other subsequent messages under specific circumstances as the messages will remain exchanged unprotected (e.g. when using NASS bundled authentication).However, current UE and P-CSCF procedures are specified with the assumption that security association is always created, in which case change of ports used for the exchange for SIP messages needs to be changed.\n\n>>> SUMMARY OF CHANGE\nAllow default port or ports advertised by the UE during P-CSCF discoverly procedure to be used for exchanging SIP messages between UE and P-CSCF, when the SIP messages are sent unprotected.\n\n>>> CONSEQUENCES IF NOT REVISED\nSome security mechanism, e.g. NASS bundled authentication, will not work as default port for SIP or ports advertised by the UE during P-CSCF discoverly procedure is expected to be used for exchanging all SIP messages."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n4.7.1\tContents of 5GMM messages\n<<< TEXT SKIPPED >>>\n\u2013\tRegistration request\nTable 4.7.1-6: REGISTRATION REQUEST\nDerivation Path: 24.501 clause 8.2.6\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration request message identity\t\u20180100 0001\u2019B\n5GS registration type\n  5GS registration type value\t\u2018001\u2019B\tInitial registration\n\t\u2018010\u2019B\t\tMOBILITY\n\t\u2018011\u2019B\t\tPERIODIC\n\t\u2018100\u2019B\t\tEMERGENCY\n  SMS requested\tPresent but contents not checked\n  FOR\tPresent but contents not checked\n  NG-RAN-RCU\t\u20180\u2019B\tNG-RAN radio capability update not needed\nngKSI\tPresent but contents not checked\nSpare half octet\t'0000'B\n5GS mobile identity\tPresent but contents not checked\nNon-current native NAS key set identifier\tIf present: contents not checked\n5GMM capability\tIf present: contents not checked\nUE security capability\tIf present: contents not checked\nRequested NSSAI\tIf present: contents not checked\nLast visited registered TAI\tIf present: contents not checked\nS1 UE network capability\tIf present: contents not checked\nUplink data status\tIf present: contents not checked\nPDU session status\tIf present: contents not checked\nMICO indication\tIf present: contents not checked\nUE status\tIf present: contents not checked\nAdditional GUTI\tIf present: contents not checked\nAllowed PDU session status\tIf present: contents not checked\nUE's usage setting\tIf present: contents not checked\nRequested DRX parameters\tIf present: contents not checked\nEPS NAS message container\tIf present: contents not checked\nLADN indication\tIf present: contents not checked\nPayload container\tIf present: contents not checked\n\nCondition\tExplanation \nINITIAL\tInitial registration\nMOBILITY\tMobility registration updating\nPERIODIC\tPeriodic registration updating\nEMERGENCY\tEmergency registration\n\nNOTE:\tThis message is sent without integrity protection before NAS security mode control procedure has been successfully completed and sent within SECURITY PROTECTED 5GS NAS MESSAGE message after NAS security mode control procedure has been successfully completed. \nEditor\u2019s Note: The value of FOR is FFS.\n\u2013\tRegistration accept\nTable 4.7.1-7: REGISTRATION ACCEPT\nDerivation Path: 24.501 clause 8.2.7\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration accept message identity\t\u20180100 0010\u2019B\n5GS registration result\n  5GS registration result value\t\u2018001\u2019B\t3GPP access\n  SMS allowed\t\u20180\u2019B\tSMS over NAS not allowed\n5G-GUTI\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\nEquivalent PLMNs\tNot Present\nTAI list\n  Length of tracking area identity list contents\t'0000 0111'B\t7 octets\n  Partial tracking area identity list 1\n    Number of elements\t'0 0000'B\t1 element\n    Type of list\t'00'B\tlist of TACs belonging to one PLMN, with non-consecutive TAC values\n    MCC\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\n    MNC\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\n    TAC 1\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\nAllowed NSSAI\n  S-NSSAI\n    Length of S-NSSAI contents\t\u20180000 0001\u2019B\tSST\n    SST\t\u20180000 0001\u2019B\tSST value 1 (eMBB)\nRejected NSSAI\tNot Present\nConfigured NSSAI\tNot Present\n5GS network feature support\t\u20180000 0000 0000 0000\u2019B\nPDU session status\tNot Present\t\tINITIAL\n\tFFS\t\tFFS\nPDU session reactivation result\tNot Present\nPDU session reactivation result error cause\tNot Present\nLADN information\tNot Present\nMICO indication\tNot Present\nService area list\tNot Present\nT3512 value\t\t\tINITIAL\n  Timer value\t'0 0000'B\n  Unit\t'111'B\tvalue indicates that the timer is deactivated\nT3512 value\tNot Present\nNon-3GPP de-registration timer value\tNot Present\nT3502 value\tNot Present\nEmergency number list\tNot Present\nExtended emergency number list\tNot Present\nSOR Transparent container\tNot Present\nEAP message\tNot Present\n\nCondition\tExplanation \nINITIAL\tInitial registration\n\nNOTE:\tThis message is always sent within SECURITY PROTECTED 5GS NAS MESSAGE message.\n\u2013\tRegistration complete\nTable 4.7.1-8: REGISTRATION COMPLETE\nDerivation Path: 24.501 clause 8.2.8\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration complete message identity\t\u20180100 0011\u2019B\nSOR transparent container\tIf present: contents not checked\n\nCondition\tExplanation \n\nNOTE:\tThis message is always sent within SECURITY PROTECTED 5GS NAS MESSAGE message.\n\u2013\tRegistration reject\nTable 4.7.1-9: REGISTRATION REJECT\nDerivation Path: 24.501 clause 8.2.9\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration reject message identity\t\u20180100 0100\u2019B\n5GMM cause\tSet according to specific message content\nT3346 value\tNot Present\nT3502 value\tNot Present\nEAP message\tNot Present\n\nCondition\tExplanation \n\nNOTE:\tThe security protection of this message is the same as the previous REGISTRATION REQUEST message.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications.\n\n>>> SUMMARY OF CHANGE\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications.\n\n>>> CONSEQUENCES IF NOT REVISED\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n<<< Start of changes >>>\n5.15.10\tNetwork Slice-Specific Authentication and Authorization\nA serving PLMN shall perform Network Slice-Specific Authentication and Authorization for the S-NSSAIs of the HPLMN which are subject to it based on subscription information. The UE shall indicate in the Registration Request message in the UE 5GMM Core Network Capability whether it supports NSSAA feature. If the UE does not support NSSAA feature and if the UE requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, the AMF shall not trigger this procedure for the UE and they are rejected for the PLMN. If the UE supports NSSAA feature and if the UE requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, they are included in the list of Pending NSSAI for the PLMN, as described in clause\u00a05.15.5.2.1.\nIf a UE is configured with S-NSSAIs, which are subject to Network Slice-Specific Authentication and Authorization, the UE stores an association between the S-NSSAI and corresponding credentials for the Network Slice-Specific Authentication and Authorization.\nNOTE:\tThe credentials for Network Slice-Specific Authentication and Authorization and how to provision them in the UE are not specified.\nTo perform the Network Slice-Specific Authentication and Authorization for an S-NSSAI, the AMF invokes an EAP- based Network Slice-Specific authorization procedure documented in TS\u00a023.502\u00a0[3] clause\u00a04.2.9 (see also TS\u00a033.501\u00a0[29]) for the S-NSSAI. When an NSSAA procedure is started and is ongoing for an S-NSSAI, the AMF stores the NSSAA status of the S-NSSAI as pending and when the NSSAA is completed the S-NSSAI becomes either part of the Allowed NSSAI or a Rejected S-NSSAI. The NSSAA status of each S-NSSAI, if any is stored, is transferred when the AMF changes.\nThis procedure can be invoked for a supporting UE by an AMF at any time, e.g. when:\na.\tThe UE registers with the AMF and one of the S-NSSAIs of the HPLMN which maps to an S-NSSAI in the Requested NSSAI is requiring Network Slice-Specific Authentication and Authorization (see clause\u00a05.15.5.2.1 for details), and the S-NSSAI in the Requested NSSAI can be added to the Allowed NSSAI by the AMF once the Network Slice-Specific Authentication and Authorization for the HPLMN S-NSSAI succeeds; or\nb.\tThe Network Slice-Specific AAA Server triggers a UE re-authentication and re-authorization for an S-NSSAI; or\nc.\tThe AMF, based on operator policy or a subscription change, decides to initiate the Network Slice-Specific Authentication and Authorization procedure for a certain S-NSSAI which was previously authorized.\n\tIn the case of re-authentication and re-authorization (b. and c. above) the following applies:\n-\tIf S-NSSAIs that are requiring Network Slice-Specific Authentication and Authorization map to S-NSSAIs that are included in the Allowed NSSAI for each Access Type, AMF selects an Access Type to be used to perform the Network Slice Specific Authentication and Authorization procedure based on network policies.\n-\tIf the Network Slice-Specific Authentication and Authorization for some S-NSSAIs mapped to some S-NSSAIs in the Allowed NSSAI is unsuccessful, the AMF shall update the Allowed NSSAI for each Access Type to the UE via UE Configuration Update procedure.\n-\tIf the Network Slice-Specific Authentication and Authorization fails for all S-NSSAIs mapped to all S-NSSAIs in the Allowed NSSAI, the AMF shall execute the Network-initiated Deregistration procedure described in TS\u00a023.502\u00a0[3], clause\u00a04.2.2.3.3, and shall include in the explicit De-Registration Request message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.\nAfter a successful or unsuccessful UE Network Slice-Specific Authentication and Authorization, the UE context in the AMF shall retain the authentication and authorization status for the UE for the related specific S-NSSAI of the HPLMN while the UE remains RM-REGISTERED in the PLMN, so that the AMF is not required to execute a Network Slice-Specific Authentication and Authorization for a UE at every Periodic Registration Update or Mobility Registration procedure with the PLMN.\nA Network Slice-Specific AAA server may revoke the authorization or challenge the authentication and authorization of a UE at any time. When authorization is revoked for an S-NSSAI that maps to an S-NSSAI in the current Allowed NSSAI for an Access Type, the AMF shall provide a new Allowed NSSAI to the UE and trigger the release of all PDU sessions associated with the S-NSSAI, for this Access Type.\nThe AMF provides the GPSI of the UE related to the S-NSSAI to the AAA Server to allow the AAA server to initiate the Network Slice-Specific Authentication and Authorization, or the Authorization revocation procedure, where the current AMF serving the UE needs to be identified by the system, so the UE authorization status can be challenged or revoked.\nThe Network Slice-Specific Authentication and Authorization requires that the UE Primary Authentication and Authorization of the SUPI has successfully completed. If the SUPI authorization is revoked, then also the Network Slice-Specific authorization is revoked.\n\n<<< End of changes >>>\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCT1 asked in LS C1-206508:If the target VPLMN decides to run NSSAA for an S-NSSAI whose NSSAA status is EAP-Success when a UE accesses the target VPLMN for the first time, how will the target VPLMN handle the S-NSSAI that is subject to NSSAA: will it be put in the pending NSSAI or will it be put in the allowed NSSAI included in the registration accept message sent to the UE, and how are existing PDU sessions associated with the S-NSSAI handled?At re-authentication the S-NSSAI is requested by the UE and it may already be in the Allowed NSSAI or the S-NSSAI may have been \"deregistered\" again while the NSSAA status is kept in the AMF's UE context.If the S-NSSAI is in Allowed NSSAI and an NSSAA is triggered, then any related PDU Session is kept until NSSAA has been executed i.e. PDU Sessions are released only after a re-authentication fails.\n\n>>> SUMMARY OF CHANGE\nIt is clarified that re-authentication may also map to an S-NSSAI in the Requested NSSAI.It is clarified that a PDU Session is released if NSSAA re-authentication fails.\n\n>>> CONSEQUENCES IF NOT REVISED\nSome implementations may keep PDU Sessions even if NSSAA failed, and some implementations may release PDU Sessions when triggering re-authentication even if it will be successful."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\nH.3\tUa security protocol identifiers for 3GPP specified protocols\nThe following Ua security protocol identifiers are specified by 3GPP:\n\t( 0x01,0x00,0x00,0x00,0x00 )\t\tUa security protocol according to TS\u00a033.221\u00a0[5].\n\t( 0x01,0x00,0x00,0x00,0x01 )\t\tUa security protocols according to TS\u00a033.246\u00a0[26].\nNOTE\u00a01:\tTS\u00a033.246\u00a0[26] provides key separation between the keys that are used within HTTP digest and MIKEY protocols.\n( 0x01,0x00,0x00,0x00,0x02) \tUa security protocol HTTP digest authentication according to TS\u00a024.109\u00a0[29], unless HTTP digest authentication is used in the context of another Ua security protocol, which is already covered elsewhere in this Annex.\n( 0x01,0x00,0x00,0x00,0x03 )\tUa security protocols used with HTTP-based security procedures for MBMS user services according to TS\u00a026.237\u00a0[38].\n( 0x01,0x00,0x00,0x00,0x04 )\tUa security protocols used with SIP-based security procedures for MBMS user services according to TS\u00a026.237\u00a0[38]. \n( 0x01,0x00,0x00,0x00,0x05 )\tUa security protocols used with Generic Push Layer according to TS\u00a033.224\u00a0[39], unless Generic Push Layer is used in the context of another Ua security protocol, which is already covered elsewhere in this Annex.\n( 0x01,0x00,0x00,0x00,0x06 )\tUa security protocol for IMS UE to KMS  http based message exchanges according  to \"IMS media plane security\", TS 33.328 [40]\n\n\t( 0x01,0x00,0x00, 0x01,0x00 ) \t\tGeneration of TMPI according to Annex B.4.\nNOTE\u00a02:\tThis protocol identifier is not strictly a Ua protocol identifier, but its use in key derivation function is exactly equal.to a Ua protocol identifier.\n( 0x01,0x00,0x01,yy,zz )\tUa security protocol for \"Shared key-based UE authentication with certificate-based NAF authentication\", according to TS\u00a033.222\u00a0[25] section 5.3, or \"Shared key-based mutual authentication between UE and NAF\", according to TS\u00a033.222\u00a0[25] section 5.4. Here, \"yy,zz\" is the protection mechanism CipherSuite code according to the defined values for TLS CipherSuites in the IANA TLS Cipher Suite Registry which is referenced in TLS V1.2\u00a0[41]. \n\tNOTE 3: \tThe \"Certificate based mutual authentication between UE and NAF\u201d according to TS 33.222 [25] section 5.5 does not require a Ua protocol identifier.\n\nNOTE\u00a04:\tAs an example: RFC\u00a05246\u00a0[41] CipherSuite TLS_RSA_WITH_3DES_EDE_CBC_SHA has code = { 0x00,0x0A }, thus the according protocol identifier shall be (\u00a00x01,0x00,0x01,0x00,0x0A\u00a0).\n( 0x01,0x00,0x02,yy,zz ) \tUa security protocol for \"Shared key-based UE authentication with certificate-based NAF authentication\", according to TS\u00a033.222\u00a0[25] Annex D. Here, \"yy,zz\" is the protection mechanism CipherSuite code according to the defined values for TLS CipherSuites in the IANA TLS Cipher Suite Registry which is referenced in TLS V1.2\u00a0[41]. This Ua security protocol identifier is used for the case outlined in TS 33.222 [5] Annex D, where e.g.  HTML FORM based authentication is used within a TLS tunnel.\n\tNOTE 4: \tThe third octet (0x02) distinguish this case from other protocols tunneled inside the TLS tunnel. \n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nProSe needs a Ua security protocol identifier\n\n>>> SUMMARY OF CHANGE\nAdd a Ua security protocol identifier for ProSe\n\n>>> CONSEQUENCES IF NOT REVISED\nProSe key may not be cryptographically separate for other cases."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n5.5.3.2.7\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tIf a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE and a GUTI has been assigned, the network shall abort the procedure and shall consider both, the old and new GUTI as valid until the old GUTI can be considered as invalid by the network (see subclause\u00a05.4.1.4). During this period the network may use the identification procedure followed by a GUTI reallocation procedure if the old GUTI is used by the UE in a subsequent message.\n\tThe network may page with IMSI if paging with old and new S-TMSI fails. Paging with IMSI causes the UE to re-attach as described in subclause\u00a05.6.2.2.2.\nb)\tProtocol error\n\tIf the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values:\n\t#96:\tinvalid mandatory information element error;\n\t#99:\tinformation element non-existent or not implemented;\n\t#100:\tconditional IE error; or\n\t#111:\tprotocol error, unspecified.\nc)\tT3450 time-out\n\tOn the first expiry of the timer, the network shall retransmit the TRACKING AREA UPDATE ACCEPT message and shall reset and restart timer T3450. The retransmission is performed four times, i.e. on the fifth expiry of timer T3450, the tracking area updating procedure is aborted. Both, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network (see subclause\u00a05.4.1.4). During this period the network acts as described for case\u00a0a above.\nd)\tTRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent and before the TRACKING AREA UPDATE COMPLETE message is received\n\n-\tIf one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted if the TRACKING AREA UPDATE COMPLETE message has not been received and the new tracking area updating procedure shall be progressed; or\n-\tif the information elements do not differ, then the TRACKING AREA UPDATE ACCEPT message shall be resent and the timer T3450 shall be restarted if an TRACKING AREA UPDATE COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.\n\ne)\tMore than one TRACKING AREA UPDATE REQUEST received and no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent\n\n-\tIf one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted and the new tracking area updating procedure shall be progressed;\n-\tif the information elements do not differ, then the network shall continue with the previous tracking area updating procedure and shall not treat any further this TRACKING AREA UPDATE REQUEST message.\n\nf)\tLower layers indication of non-delivered NAS PDU due to handover\n\tIf the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to handover then the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message if the failure of handover procedure is reported by the lower layer and the S1 signalling connection exists.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThis CR corrects a TAU collision case, where the 2nd TAU request is identical in the NAS contents, but the TAI has changed.It is possible that the UE reselects a cell and changes the TA (TAI) during an ongoing TAU procedure. Then clearly it does not make sense to continue to process the first TAU procedure. The error case needs to be expanded to cover the duplication of TAU request message and TAI is changed, where the first TAU message shall be discarded and the MME shall process the TAU request received on the recent TAI.\n\n>>> SUMMARY OF CHANGE\nSection 5.5.3.2.7, parts d) and e) are corrected to refer to the MME behaviour to abort the ongoing TAU procedure in case a new TAU request is received from a different TAI.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe MME shall mistakenly process the TAU request message which was not originated by UE camping on the actual TA and hence is not valid to the recent TA. The MME may mistakenly provide information to the UE which is not valid to the actual TAI (ex. wrong TAI list) and this may cause unexpected and wrong behaviour implementations in the UE and MME."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n27.22.4.26\tLAUNCH BROWSER\n27.22.4.26.1\tLAUNCH BROWSER (No session already launched)\n27.22.4.26.1.1\tDefinition and applicability\nSee clause 3.2.2.\n27.22.4.26.1.2\tConformance requirements\nThe ME shall support the LAUNCH BROWSER Proactive SIM Command as defined in:\n-\tTS\u00a011.14\u00a0[15] clause 5.2, clauses 6.4.26 and 6.6.26, clause 12.6, clause 12.7, clause 12.48, clause 13.2, clause 12.2, clause 12.47, clause 12.49, clause 12.50, clause 12.15 and clause 12.31.\n27.22.4.26.1.3\tTest purpose\nTo verify that when the ME is in idle state, it launches properly the browser session required in LAUNCH BROWSER, and returns a successful result in the TERMINAL RESPONSE command.\n27.22.4.26.1.4\tMethod of test \n27.22.4.26.1.4.1\tInitial conditions\nThe ME is connected to the SIM Simulator and the System Simulator.\nThe elementary files are coded as SIM Application Toolkit default.\nPrior to this test the ME shall have been powered on and performed the PROFILE DOWNLOAD procedure.\nA valid access to 2 different Wap gateways is required:\n-\tthe default browser parameters (IP address, gateway/proxy identity, called number, URL \u2026) of the tested mobile shall be properly filled to access one of the gateways (\"default gateway\")\nWith that default gateway we shall be able to access to an URL different from the default one.\n-\tanother gateway with an IP address different from the one defined in default browser parameters.\nThe mobile is in idle mode.\n\nThe following Bearer Parameters used are those defined in the default Test PDP context3, as specified in TS\u00a051.010-1\u00a0[12], for test cases using packet services:\nBearer Parameters\nPrecedence Class:\t\t02\nDelay Class:\t\t04\nReliability Class:\t\t05\nPeak throughput class: \t\t05\nMean throughput class:\t\t31\nPacket data protocol:\t\t02 (IP)\n\nGPRS Parameters\nNetwork access name: \t\tTestGp.rs\nUser login:\t\tUserLog\nUser password:\t\tUserPwd\n\nSIM/ME interface transport level\nTransport format:\t\tUDP\nPort number: \t\t44444\nData destination address\t\t01.01.01.01(as an example)\nNote: \t\tIf a data destination address different to 01.01.01.01 is used then the network simulator setup and related UE settings might require a corresponding adaptation.\n\n27.22.4.26.1.4.2 \tProcedure\nExpected Sequence 1.1 (LAUNCH BROWSER, connect to the default URL)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 1.1.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 1.1.1\t[connect to the default URL, \"launch browser, if not already launched\", no null alpha id.]\n4\tME  USER\tME displays the alpha identifier\n5\tUSER  ME\tThe user may have to confirm the launch browser.\t[option: user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 1.1.1\t[Command performed successfully]\n7\tMESS \tThe ME attempts to launch the session with the default browser parameters and the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER   ME\tThe user verifies that the default browser session is properly established. \tThen he/she ends the navigation.\tThe ME returns in idle mode.\n\n[..]\nExpected Sequence 1.2 (LAUNCH BROWSER, connect to the specified URL, alpha identifier length=0)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 1.2.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 1.2.1\t[connect to defined URL, \"launch browser, if not already launched, alpha identifier length=0]\n4\tME  USER\tNo information should be displayed.\n5\tUSER  ME\tThe user may have to confirm the launch browser.\t[option: user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 1.2.1\t[Command performed successfully]\n7\tMESS \tThe ME attempts to connect the URL specified in the LAUNCH BROWSER command.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the URL is properly connected. \tThen he/she ends the navigation.\tThe ME returns in idle mode.\n\n[..]\n\nExpected Sequence 1.3 (LAUNCH BROWSER, Browser identity, no alpha identifier)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 1.3.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 1.3.1\t[connect to the default URL, \"launch browser, if not already launched, browser identity]\n4\tME  USER\tME may display a default message of its own.\n5\tUSER  ME\tThe user may confirm the launch browser.\t[option: user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 1.3.1\t[Command performed successfully]\n7\tMESS \tThe ME attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the default browser session is properly established. \tThen he/she ends the navigation.\tThe ME returns in idle mode.\n\n[..]\nExpected Sequence 1.4 (LAUNCH BROWSER, only GPRS bearer specified and gateway/proxy identity, GPRS supported by SS)  \n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 1.4.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 1.4.1\t[connect to the default URL, \"launch browser, if not already launched, 1 bearer specified, gateway/proxy id specified]\n4\tME  USER\tME may display a default message\n5\tUSER  ME\tThe user may confirm the launch browser.\t[option: user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 1.4.1\t[Command performed successfully]\n7\tMESS \tThe ME attempts to connect the default URL using the requested bearer and proxy identity\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the browser session is properly established with the required bearer. Then he/she ends the navigation.\tThe ME returns in idle mode.\n\n[..]\n\nExpected Sequence 1.5 Void\n\n27.22.4.26.1.5\tTest Requirement\nThe ME shall operate in the manner defined in expected sequences 1.1 to 1.4\n\n27.22.4.26.2\tLAUNCH BROWSER (Interaction with current session)\n[..]\n27.22.4.26.2.4.1\tInitial conditions\nThe ME is connected to the SIM Simulator and the System Simulator.\nThe elementary files are coded as SIM Application Toolkit default.\nPrior to this test the ME shall have been powered on and performed the PROFILE DOWNLOAD procedure.\nA valid access to a Wap gateway is required. The default browser parameters (IP address, gateway/proxy identity, called number\u2026) of the tested mobile shall be properly filled to access that gateway.\nThe mobile is busy in a browser session, the user navigates in pages different from the URL defined by default in browser parameters.\n\n\n\nThe Bearer Parameters defined in 27.22.4.26.1.4.1 shall be used.\n27.22.4.26.2.4.2 \tProcedure\nExpected Sequence 2.1 (LAUNCH BROWSER, use the existing browser, connect to the default URL)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\tThe user is navigating in a browser session (not default URL).\t[Browser is in use, the current session is not secured]\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 2.1.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 2.1.1\t[connect to the default URL, \"use the existing browser\", no null alpha id.]\n4\tME  USER\tME displays the alpha identifier\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 2.1.1\t[Command performed successfully]\n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved. \tThen he/she ends the navigation with the default URL.\n\n[..]\nExpected Sequence 2.2 (LAUNCH BROWSER, close the existing browser session and launch new browser session, connect to the default URL)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\tThe user is navigating in a browser session (not default URL)..\t[Browser is in use, the current session is not secured]\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 2.2.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 2.2.1\t[connect to the default URL, \"close the existing browser session and launch new browser session\", no null alpha id.]\n4\tME  USER\tME displays the alpha identifier\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 2.2.1\t[Command performed successfully]\n7\tMESS \tThe ME closes the existing session and attempts to launch the session with the default browser parameters and the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER   ME\tThe user verifies that the default URL is connected. \tThen he/she ends the navigation.\n\n[..]\n\nExpected Sequence 2.3 (LAUNCH BROWSER, if not already launched)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\tThe user is navigating in a browser session (not default URL)..\t[Browser is in use, the current session is not secured]\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 2.3.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 2.3.1\t[connect to the default URL, \"launch browser, if not already launched]\n4\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 2.3.1\t[ME unable to process command - browser unavailable]\n5\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n6\tUSER   ME\tThe user verifies that the default URL has not been connected. \tThen he/she ends the navigation.\tThe ME returns in idle mode.\n\n[..]\n27.22.4.26.3\tLAUNCH BROWSER (UCS2 support)\n27.22.4.26.3.1\tDefinition and applicability\nSee clause 3.2.2.\n27.22.4.26.3.2\tConformance requirements\nThe ME shall support the LAUNCH BROWSER Proactive SIM Command as defined in:\n-\tTS\u00a011.14\u00a0[15] clause 5.2, clauses 6.4.26 and 6.6.26, clause 12.6, clause 12.7, clause 12.48, clause 13.2, clause 12.2, clause 12.47, optional clause 12.49, optional clause 12.50, clause 12.15 and clause 12.31.\nAdditionally the ME shall support the UCS2 facility for the coding of the Cyrillic alphabet, as defined in:\n-\tISO/IEC 10646 [17].\n27.22.4.26.2.3\tTest purpose\nTo verify that the ME performs a proper user confirmation with an USC2 alpha identifier, launches the Wap session required in LAUNCH BROWSER and returns a successful result in the TERMINAL RESPONSE command send to the SIM.\n27.22.4.26.3.4\tMethod of test \n27.22.4.26.3.4.1\tInitial conditions\nThe ME is connected to the SIM Simulator and the System Simulator.\nThe elementary files are coded as SIM Application Toolkit default.\nPrior to this test the ME shall have been powered on and performed the PROFILE DOWNLOAD procedure.\nA valid access to 2 different Wap gateways is required:\n-\tthe default browser parameters (IP address, gateway/proxy identity, called number, URL \u2026) of the tested mobile shall be properly filled to access one of the gateways (\"default gateway\").\nWith that default gateway we shall be able to access to an URL different from the default one.\n-\tanother gateway with an IP address different from the one defined in default browser parameters.\nThe mobile is busy in a browser session, the user navigates in pages different from the URL defined by default in browser parameters.\n\n\n\nThe Bearer Parameters defined in 27.22.4.26.1.4.1 shall be used.\n27.22.4.26.3.4.2 \tProcedure\nExpected Sequence 3.1 (LAUNCH BROWSER, use the existing browser, connect to the default URL)\n\nStep\tDirection\tMESSAGE / Action\tComments\n0\tME\tThe user is navigating in a browser  session (not default URL)..\t[Browser is in use, the current session is not secured]]\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 3.1.1\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 3.1.1\t[connect to the default URL, \"use the existing browser\", alpha id. In UCS2]\n4\tME  USER\tME displays the alpha identifier\t\"\u0417\u0414\u0420\u0410\u0412\u0421\u0422\u0412\u0423\u0419\u0422\u0415\"\t[\"Hello\" in Russian]\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 3.1.1\t[Command performed successfully]\t \n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER   ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved. \tThen he/she ends the navigation with the default URL.\n\n[..]\n\n27.22.4.26.3.5\tTest Requirement\nThe ME shall operate in the manner defined in expected sequence 3.1.\n27.22.4.26.4\tLAUNCH BROWSER (icons support)\n[..]\n27.22.4.26.4.2\tConformance requirements\nThe ME shall support the LAUNCH BROWSER Proactive SIM Command as defined in:\n-\tTS\u00a011.14\u00a0[15] clause 5.2, clauses 6.4.26 and 6.6.26, clause 12.6, clause 12.7, clause 12.48, clause 13.2, clause 12.2, clause 12.47, optional clause 12.49, optional clause 12.50, clause 12.15 and clause 12.31.\n27.22.4.26.4.3\tTest purpose\nTo verify that the ME performs a proper user confirmation with an icon identifier, launches the browser session required in LAUNCH BROWSER and returns a successful result in the TERMINAL RESPONSE command send to the SIM.\n27.22.4.26.4.4\tMethod of test \n27.22.4.26.4.4.1\tInitial conditions\nThe ME is connected to the SIM Simulator and the System Simulator.\nThe elementary files are coded as SIM Application Toolkit default.\nPrior to this test the ME shall have been powered on and performed the PROFILE DOWNLOAD procedure.\nA valid access to 2 different Wap gateways is required:\n-\tthe default browser parameters (IP address, gateway/proxy identity, called number, URL \u2026) of the tested mobile shall be properly filled to access one of the gateways (\"default gateway\").\nWith that default gateway we shall be able to access to an URL different from the default one.\n-\tanother gateway with an IP address different from the one defined in default browser parameters.\nThe mobile is busy in a browser session, the user navigates in pages different from the URL defined by default in browser parameters.\n\n\nThe Bearer Parameters defined in 27.22.4.26.1.4.1 shall be used.\n27.22.4.26.4.4.2 \tProcedure\nExpected Sequence 4.1A (LAUNCH BROWSER, use the existing browser, icon not self explanatory, successful)\n\nStep\tDirection\tMESSAGE / Action\tComments\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 4.1.1\t[Browser is in use, the current session is not secured]]\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 4.1.1\t[connect to the default URL, \"use the existing browser\", no null alpha id.]\n4\tME  USER\tME displays the alpha identifier\tand the icon\t[\"Not self explan.\"]\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 4.1.1 A\t\t[Command performed successfully]\t \n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER   ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved. \tThen he/she ends the navigation with the default URL.\n\n[..]\nExpected Sequence 4.1B (LAUNCH BROWSER, use the existing browser, icon not self explanatory, requested icon could not be displayed)\n\nStep\tDirection\tMESSAGE / Action\tComments\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 4.1.1\t[Browser is in use, the current session is not secured]]\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 4.1.1\t[connect to the default URL, \"use the existing browser\", no null alpha id.]\n4\tME  USER\tME displays the alpha identifier\tWithout the icon\t[\"Not self explan.\"]\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 4.1.1 B\t[Command performed successfully but requested icon could not be displayed]\n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER   ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved. \tThen he/she ends the navigation with the default URL.\n\n[..]\nExpected Sequence 4.2A (LAUNCH BROWSER, use the existing browser, icon self explanatory, successful)\n\nStep\tDirection\tMESSAGE / Action\tComments\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 4.2.1\t[Browser is in use, the current session is not secured]]\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 4.2.1\t[connect to the default URL, \"use the existing browser\", alpha id. In UCS2]\n4\tME  USER\tME displays only the icon\t[\"Self explan.\"]\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 4.2.1 A\t[Command performed successfully]\n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved.\tThen he/she ends the navigation with the default URL.\n\n[..]\nExpected Sequence 4.2B (LAUNCH BROWSER, use the existing browser, icon self explanatory, requested icon could not be displayed)\n\nStep\tDirection\tMESSAGE / Action\tComments\n1\tSIM  ME\tPROACTIVE COMMAND PENDING: LAUNCH BROWSER 4.2.1\t[Browser is in use, the current session is not secured]]\n2\tME  SIM\tFETCH\n3\tSIM  ME\tPROACTIVE COMMAND: LAUNCH BROWSER 4.2.1\t[connect to the default URL, \"use the existing browser\", alpha id. In UCS2]\n4\tME  USER\tME displays only the alpha identifier\t[\"Self explan.\"]\n5\tUSER  ME\tThe user confirms the launch browser.\t[user confirmation]\n6\tME  SIM\tTERMINAL RESPONSE: LAUNCH BROWSER 4.2.1 B\t[Command performed successfully]\t\t[Command performed successfully but requested icon could not be displayed]\n7\tMESS \tThe ME does not close the existing session and attempts to connect the default URL.\n8\tSIM  ME\tPROACTIVE SIM SESSION ENDED\n9\tUSER  ME\tThe user verifies that the default URL is connected; and the previous URL can be retrieved. \tThen he/she ends the navigation with the default URL.\n\n[..]\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe Launch Browser tests in clause 27.22.4.26 mandate that the user ends the navigation and that in consequence the ME shall return to idle mode. Terminals may support Launch Browser, but not a browser termination which results in a PDP context deactivation. The successful browser session establishment according to the Launch Browser command shall be verified, but not the return to the idle mode after browser termination.Several sequences require the ME to be in idle mode before the Launch Browser command shall be issued. This shall verify that the ME is not only able to launch the browser, but that the command execution also ensures that the required data connection is also successfully established before the URL is requested.  It needs to be verified that the ME is not simply relying on an existing data session which might have been established by other application on the ME. To ensure this the SS needs to be configured for several sequences that way, that PDP context activation requests are rejected until the Launch Browser command is executed.When launching a browser, MEs might request additonal URLs besides of the Default URL (home page). These \"Auto-URLs\" can be favicon requests, compability view database requests, etc. For successful command execution the SS shall be able to handle these requests, but shall also exclude these requests from the test case verdict generation as otherwise failed verdicts would be generated even if the ME successfully retreives the web page as requested by the Launch Browser command. MEs might unfairly pass tests if the page which shall be retrieved is still stored in the browser's cache.\n\n>>> SUMMARY OF CHANGE\nDeletion or update of steps in which the user shall end the navigation and which should then required the ME to return to idle mode.   Update of the initial conditions section to indicate that the SS shall not accept PDP context activation requests until the Launch Browser command is fetched.   Update of the initial conditions section and the related test procedure steps to indicate how the SS shall handle URL requests which do not match the default page or the page requested in the Launch Browser command.   Update of the initial conditions section or test sequences to clarify that the browser's cache shall be cleared before the test case is started or at least before the Launch Browser commands are issued.\n\n>>> CONSEQUENCES IF NOT REVISED\nTerminals not returning to idle mode when the user ends the navigation would unfairly fail tests.    No reliable verification if a PDP context activation will be supported to retrieve a webpage when no PDP context is currently available.   MEs requesting various \"Auto-URLs\", e.g. for favicon, compability view data bases, etc., but still successfully opening the web page as defined in the proactive command would unfairly fail several tests    MEs might unfairly pass several tests in case a web page could be displayed only because it is still stored on the browser's cache, e.g. as a result of the execution of another test."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\nStart of change\n7.2.3.2.2.9 \tP-Access-Network-Info\nIf the IAM message includes a location number ISDN user part parameter, the O-MGCF shall include a P-Access-Network-Info header. The P-Access-Network-Info shall be populated as shown in table 7.2.3.2.2.9.1.\nTable 7.2.3.2.2.9.1: Coding of the P-Access-Network-Info header fields\nBICC/ISUP parameter / field\tSIP component\tValue\nLocation Number\taccess-type\t\"GSTN\"\n\tgstn-location\tvalue of Location Number, in quotes\n\nTable 7.2.3.2.2.9.2: Mapping ISUP Location Number to SIP P-Access-Network-Info\nIAM\tINVITE\nLocation Number\tP-Access-Network-Info\nParameter name\tnot mapped\nParameter length \tnot mapped \nParameter content \tgstn-location set to the hexadecimal representation of the ISUP parameter content, encoded as a text string between quotes\nNOTE 1:\tAs specified in ITU-T Q.763 [4], the parameter content includes both the header fields (octets 1 and 2) and the address signals.\tNOTE 3:\tIf the screening indicator is set to network provided, a np parameter is added to the P-Access-Network-Info header field value.\n\nEnd of change\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current text there is an inconsistency in the NOTE 2 of Table 7.2.3.2.2.9.2 where Privacy of the Location Number is referring to Table 16 but is not actually mentioned in Table 16.Table 16 is in a section \"P-Asserted-Identity, From and Privacy\" and it appears that there is only a description of the Calling Party Number APRI (Location Number APRI is not mentioned).  The NOTE 2 in Table 7.2.3.2.2.9.2 creates a wrong reference to Table16.\n\n>>> SUMMARY OF CHANGE\nSection 7.2.3.2.2.9, table 7.2.3.2.2.9.2, NOTE 2: APRI is not mapped to Privacy header field; a reference to Table 16 is removed;a removal of the P-Access-Network-Info header when leaving trust domain is under operator responsibility.\n\n>>> CONSEQUENCES IF NOT REVISED\nReferencing inappropriate mapping table may lead to incorrect implementations by creating a Privacy=id when receiving a Location Number with \"presentation restricted\" (which as per RFC 3455 has no link: \"id\" value is referring to the Calling Party Number / P-Asserted-Identity)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n6.5.1.4\tUE requested PDN connectivity procedure not accepted by the network\nIf connectivity with the requested PDN cannot be accepted by the network, the MME shall send a PDN CONNECTIVITY REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity.\nThe ESM cause IE typically indicates one of the following ESM cause values:\n#8:\t\toperator determined barring;\n#26:\tinsufficient resources;\n#27:\tmissing or unknown APN;\n#28:\tunknown PDN type;\n#29:\tuser authentication failed;\n#30:\trequest rejected by Serving GW or PDN GW;\n#31:\trequest rejected, unspecified;\n#32:\tservice option not supported;\n#33:\trequested service option not subscribed;\n#34:\tservice option temporarily out of order;\n#35:\tPTI already in use;\n#38:\tnetwork failure;\n#50:\tPDN type IPv4 only allowed;\n#51:\tPDN type IPv6 only allowed;\n#53:\tESM information not received;\n#54:\tPDN connection does not exist;\n#55:\tmultiple PDN connections for a given APN not allowed;\n#65:\tmaximum number of EPS bearers reached;\n#66:\trequested APN not supported in current RAT and PLMN combination;\n#95 \u2013 111:\tprotocol errors;\n#112:\tAPN restriction value incompatible with active EPS bearer context.\nIf the ESM cause value is #26 \"insufficient resources\" or #27 \"missing or unknown APN\", the network may include a value for timer T3396 (see 3GPP\u00a0TS\u00a024.008\u00a0[13]) in the PDN CONNECTIVITY REJECT message. If the ESM cause value is #26 \"insufficient resources\" and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause \"High priority access AC 11 \u2013 15\" or request type in the PDN CONNECTIVITY REQUEST message was set to \"emergency\", the network shall not include a value for timer T3396.\nUpon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE.\nIf the ESM cause value is #26 \"insufficient resources\" and T3396 value IE is included:\n-\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396:\n-\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 if it is running. The UE shall then start timer T3396 and not send another PDN CONNECTIVITY REQUEST message for the same APN until timer T3396 expires, the timer T3396 is stopped, the UE is switched off or the USIM is removed;\n-\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same APN from the network; and\n-\tif the timer value indicates zero, the UE may send another PDN CONNECTIVITY REQUEST message for the same APN;\n-\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 and integrity protection of the ATTACH REJECT message:\n-\tif the ATTACH REJECT message is not integrity protected, the UE shall stop timer T3396 if it is running. The UE shall then start timer T3396 with a random value from a default range specified in table\u00a011.2.3 defined in 3GPP\u00a0TS\u00a024.008\u00a0[13], and:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until timer T3396 expires, the timer T3396 is stopped, the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until timer T3396 expires, the UE is switched off or the USIM is removed;\n-\tif the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:\na)\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 if it is running. The UE shall then start timer T3396 with the value provided in the T3396 value IE and:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until timer T3396 expires, the timer T3396 is stopped, the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until timer T3396 expires, the UE is switched off or the USIM is removed;\nb)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same APN from the network; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until the UE is switched off or the USIM is removed; and\nc)\tif the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d;\n-\tif the UE is switched off when the timer T3396 is running, the UE shall behave as follows when the UE is switched on:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;\n-\tif prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause\u00a06.5.5; and\n-\tif prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause\u00a06.5.5.\nIf the ESM cause value is #27 \"missing or unknown APN\" and T3396 value IE is included:\n-\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396:\n-\tif the timer value indicates neither zero nor deactivated, the UE shall start timer T3396 and not send another PDN CONNECTIVITY REQUEST message for the same APN until timer T3396 expires, the UE is switched off or the USIM is removed;\n-\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN until the UE is switched off or the USIM is removed; and\n-\tif the timer value indicates zero, the UE may send another PDN CONNECTIVITY REQUEST message for the same APN; and\n-\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 and integrity protection of the ATTACH REJECT message:\n-\tif the ATTACH REJECT message is not integrity protected, the UE shall start timer T3396 with a random value from a default range specified in table\u00a011.2.3(see 3GPP\u00a0TS\u00a024.008\u00a0[13]), and:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until timer T3396 expires, the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until timer T3396 expires, the UE is switched off or the USIM is removed;\n-\tif the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:\na)\tif the timer value indicates neither zero nor deactivated, the UE shall start timer T3396 and:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until timer T3396 expires, the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until timer T3396 expires, the UE is switched off or the USIM is removed;\nb)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not initiate a new attach procedure with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure without an APN if the UE did not provide any APN during the attach procedure, until the UE is switched off or the USIM is removed; and\nc)\tif the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause\u00a05.5.1.2.6 item\u00a0d.\nIf the T3396 IE is not included and PDN CONNECTIVITY REQUEST was sent standalone, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN. \nIf the T3396 IE is not included and PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, the UE shall proceed as specified in subclause\u00a05.5.1.2.6, item\u00a0d.\nWhen the timer T3396 is running, the UE is allowed to initiate attach procedure or PDN connectivity procedure if:\n-\tthe UE is a UE configured to use AC11 \u2013 15 in selected PLMN; or\n-\tthe procedure is for emergency bearer services.\nIf the ESM cause value is #50 \"PDN type IPv4 only allowed\" or #51 \"PDN type IPv6 only allowed\", the UE shall not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type until:\n-\ta new PLMN which is not in the list of equivalent PLMNs is selected;\n-\tthe PDN type which is used to access to the APN is changed;\n-\tthe UE is switched off; or\n-\tthe USIM is removed.\nNOTE\u00a01:\tRequest to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.\nIf the ESM cause value is #65 \"maximum number of EPS bearers reached\", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause\u00a06.5.0) as the number of active EPS bearer contexts it has.\nNOTE\u00a02:\tIn some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts that the UE has when ESM cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.\nNOTE\u00a03:\tWhen the network supports emergency bearer services, it is not expected that ESM cause #65 is returned by the network when the UE requests a PDN connection for emergency bearer services.\nThe PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 \"maximum number of EPS bearers reached\" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. When the UE selects a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number(s) of EPS bearer contexts in S1 mode.\nIf the ESM cause value is #66 \"requested APN not supported in current RAT and PLMN combination\", the UE shall not send another PDN CONNECTIVITY REQUEST for the same APN in the current PLMN or any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed.\n\n***** End of change *****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn CP-120308(CR1462r1), the ESM cause #66 \"requested APN not supported in current RAT and PLMN combination\" is introduced from release 11. If the UE receives ESM cause #66, the UE is inhibited retransmitting the PDN Connectivity Request with the same APN that the UE requested in order to avoid wasteful retransmissions for establishing a specific APN(e.g. IMS APN).However, it is unclear how the UE should behave if the UE initiates PDN Connectivity Request procedure together with Attach Request procedure with NULL APN but the ESM cause #66 is returned and it is rejected by the network.Additonally, it is also unclear how the UE should behave if the UE initiates PDN Connectivity Request procedure together with Attach Request procedure with a non-NULL APN but the ESM cause #66 is returned and it is rejected by the network.\n\n>>> SUMMARY OF CHANGE\nIt is specified that the UE shall not retransmit the Attach Request together with the PDN Connectivity Request with NULL APN, if the UE receives the ESM cause #66 as a response of the Attach Request together with the PDN Connectivity Request with NULL APN.Additonally, it is also clarified that the UE shall not retransmit the Attach Request together with the PDN Connectivity Request with the same APN that was sent by the UE, if the UE receives the ESM cause #66 \"requested APN not supported in current RAT and PLMN combination\" as a response of the Attach Request together with the PDN Connectivity Request with a non-NULL APN.These UE behaviours are similar to the ones in the case of receiving the ESM cause #26 \"insufficient resources\" or #27 \"missing or unknown APN\" with SM backoff timer T3396 set to \u201cdeactivated\u201d.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE may send the Attach Request together with the PDN Connectivity Request with NULL APN or the same APN that was sent by the UE even if the UE receives the ESM cause #66. This means that the operator may not be able to inhibit the wasteful UE\u2019s retransmissions of the Attach Request together with the PDN Connectivity Request for establishing a default or a specific APN in the network not supporting to connect to that APN(e.g. IMS APN)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nStart of Change\n4.1\tArchitectural Principles\nThe solution for emergency sessions in the IMS fulfils the emergency principles and requirements of TS\u00a022.101\u00a0[8] and the following architectural requirements:\n1.\tVoid.\n2.\tEmergency services are independent from the IP-CAN with respect to the detection and routing of emergency sessions. The emergency services shall be possible over at least a cellular access network, a fixed broadband access, I-WLAN access and a nomadic access.\n3.\tAny kind of emergency numbers, and emergency SIP and TEL URIs as specified in TS\u00a022.101\u00a0[8], and special indications for emergency sessions within the SIP signalling shall be supported.\n4.\tEmergency sessions should be prioritized over non-emergency sessions by the system.\n5.\tThe establishment of IMS emergency sessions shall be possible for users with a barred public user identity.\n6.\tThe primary solution shall be that the UE can detect an emergency session (e.g. by evaluating the SIP-URI or the dialled number) by itself and indicates the emergency session to the network. The cases where the UE can't detect an emergency session shall also be supported.\n7.\tThe solution shall work in case the UE has sufficient credentials to authenticate with the IMS and is registered to the IMS or is not registered with the IMS. The case where the UE does not have sufficient credentials to authenticate with the IMS shall also be supported where regulations allow.\n\tIn the case that UE is not already IMS registered, it shall perform a registration for the support of emergency services (emergency registration).\n\tIn the case a UE is already IMS registered, the UE may skip the additional emergency registration if the UE is aware that it is in its home network (e.g. including IP-CANs where roaming outside the home network is not supported).\n\tIf the UE does not have sufficient credentials to authenticate with the IMS it shall be possible to perform session establishment without an existing security association between UE and PCSCF, and the UE shall include an equipment identifier (the specific details of the equipment identifier to use may depend upon the IP-CAN) in the request to establish an emergency session.\n8.\tIt shall be possible to reject emergency service requests from an UE, without sufficient credentials to authenticate with the IMS in networks where emergency services from UEs with sufficient credentials to authenticate with the IMS are required.\n9.\tEmergency Service is not a subscription service and therefore will mainly be supported in the roamed-to network. In the case that a UE has sufficient credentials, it shall initiate an emergency registration with the network (requiring the involvement of the home network). The CSCFs providing service for emergency sessions may be different from the CSCFs involved in the other IMS services. In the case that the registration fails, the UE may attempt an anonymous emergency call.\n10.\tIf an emergency session establishment request is routed to a PCSCF located in the home network, the home network should be able to detect that the session is for emergency service (whether indicated as such or not) and respond to the UE indicating that the UE should initiate an emergency session in the visited network (e.g. via the CS domain of the visited network).\n11.\tEmergency centers and PSAPs may be connected to the PSTN, CS domain, PS domain or any other packet network.\n12.\tEmergency centres and PSAPs shall be able to call back the user for an emergency session from a UE that has registered (i.e. containing valid credentials).\n13.\tThe IMS core network shall be able to transport information on the location of the subscriber.\n14.\tVoid.\n15.\tThe network shall be able to retrieve the caller's location;\n16.\tAs a regional option, the network shall be capable of assigning a routable location key (i.e. Emergency Services Query Key, a.k.a. ESQK, which has the same properties as the existing ESRK in wireless 911 services) to an IMS emergency session, and releasing the ESQK when the emergency session is terminated.\n17.\tThe network shall provide the caller's location information to the PSAP upon query from the PSAP.\n18.\tThe network shall provide the possibility to route to a default answering point given the scenario where the local PSAP can not be determined.\n19.\tThe network may provide a capability to enable a UE to obtain local emergency numbers.\n20\tA UE should support a capability to obtain local emergency numbers from the network once such a capability has been defined and agreed.\n21.\tIt shall be possible to prevent the sending of the information of the users, such as public user identifiers and the location information to the PSAP when explicitly requested by the user, i.e. request on session by session basis.\n22.\tThe Emergency Public User Identifier shall only be used for emergency services and not for other services.\nNOTE:\tTS\u00a024.008\u00a0[13] contains a procedure to provide local emergency numbers for UMTS and GPRS access but the procedure is not applicable to I-WLAN and contains a limited number of emergency service categories. Therefore, an improved capability may need to be developed for IMS Emergency calls.\nIn addition to the architectural requirements, the following architectural principles apply to IMS emergency sessions:\n-\tThe IMS network shall be able to discriminate between emergency sessions and other sessions. This shall allow special treatment (e.g. with respect to filtering, higher priority, routing, QoS) of emergency sessions.\n-\tIf a visited network can support PS emergency service, the emergency session shall be established in the visited network whether or not UE is registered in IMS in the home network.\n-\tThe PCSCF is the IMS network entity, which is responsible to detect the request for emergency session and forwards the request to ECSCF in the same network.\n-\tThe PCSCF serving the emergency call is the IMS network entity which may retrieve the location identifier from the IP-CAN.\n-\tThe ECSCF is the IMS network entity, which shall be able to retrieve geographical location information from the LRF in the case that the geographical location information is not available and is required.\n-\tIf required, the ECSCF shall be able to forward the location information to the LRF for validation of geographical location information in the case that the geographical location information is included by the UE over any access network type.\n-\tThe ECSCF is the IMS network entity, which is responsible to route the request to an emergency centre/PSAP or BGCF based on location information and additionally other information such as type of emergency service in the request.\nNext Change\n4.2\tNaming and Addressing\nThe UE shall use a special emergency Public User Identifier in the emergency registration request. The implicit registration set of the emergency Public User Identifier shall contain an associated Tel URI. The format is defined in TS\u00a023.003\u00a0[21].\n\nNext Change\n6\tFunctional description\n6.1\tUE\n-\tShould be able to detect an emergency session establishment request.\n-\tUse a special emergency Public User Identifier in the IMS emergency registration request.\n-\tThe UE may perform an IMS emergency session establishment without prior emergency registration when already IMS registered and it is in home network (e.g. including IP-CANs where roaming outside the home network is not supported).\n-\tOtherwise, the UE shall perform an IMS emergency registration.\n-\tInclude an emergency service indication in the emergency session request.\n-\tInclude an equipment identifier in the request to establish an emergency session for \"anonymous user\".\nNOTE:\t\"Anonymous user\" in this context is the person who does not have sufficient credential for IMS registration. No Stage 3 work is expected as the anonymous user detection already existed today.\n-\tInclude identity information for the IP-CAN if available (e.g. MCC-MNC or an equivalent)\nNOTE:\tUE provided IP-CAN identity information will not be completely reliable and hence a mechanism based on network provision (e.g. using PCC) may be needed in a later version of this specification.\n-\tAttempt the emergency call in CS domain, if capable.\n-\tHandle a 380 (Alternative Service) response with the type set to \"emergency\" as a result of non UE detectable emergency attempt.\n-\tHandle a response with an indication, IMS emergency registration required as a result of emergency session establishment attempt.\n-\tOther general requirements of UE shall be referred to the general requirements of emergency calls in TS\u00a022.101\u00a0[8].\nThe UE initiates the emergency session establishment request, and for the purpose of processing the request properly in the network the following specific information is supplied in the request message.\n-\tEmergency session indication.\n-\tEmergency Public User Identifier if an IMS emergency registration is performed. If not, any registered Public User Identifier is used.\n-\tOptionally, type of emergency service. It could be implied in the above emergency session indication.\n-\tUE's location information, if available.\n-\tThe Tel URI associated to the emergency Public User Identifier, if available.\nNext Change\n6.2\tIMS Functional entities\n6.2.1\tProxyCSCF\n-\tHandle registration requests with an emergency Public User Identifier like any other registration request, except that it may reject an emergency registration request if the IM CN subsystem that the P-CSCF belongs to can not support emergency sessions for the UE (e.g., due to local policy or UE is not within IM CN subsystem's geographical area or IP-CAN not supported)..\n-\tDetect an emergency session establishment request.\n-\tReject/allow unmarked emergency requests.\n-\tReject/allow anonymous emergency requests.\n-\tPrevent the assertion of an emergency Public User Identifier in non-emergency requests\n-\tPrevent non-emergency requests that are associated with an emergency registration.\n-\tMay query IP-CAN for location identifier.\n-\tSelect an Emergency CSCF in the same network to handle the emergency session request. The selection method is not standardized in the present document.\n-\tPrioritize the emergency session.\n-\tCheck the validity of the caller Tel URI if provided by the UE and shall provide the Tel URI in the session establishment request if it is aware about the Tel URI associated with the emergency Public User Identifier.\n-\tMay respond to a UE with an emergency session indication as a result of detecting a non UE detectable emergency session establishment request\n-\tMay respond to the UE with an indication, IMS emergency registration required as a result of processing the emergency session establishment attempt.\n-\tShould be able to identify the service data flow associated with emergency service and inform PCRF accordingly.\nNext Change\n7\tProcedures related to establishment of IMS emergency session\n7.1\tHigh Level Procedures for IMS Emergency Services\n7.1.1\tUE Detectable Emergency Session\nThe following flow contains a high level description of the emergency service procedures performed when the UE can detect the emergency session is being requested.\n\nFigure 7.1: Terminal Detected Emergency Calls\nThe following steps are performed:\n1.\tThe UE detects the request for the establishment of an emergency session. Step\u00a02 to 6 may be skipped based on the conditions specified in clause\u00a06.1.\n2.\tIn the case that the UE has insufficient resources or capabilities to establish an emergency call due to other ongoing sessions then the UE should terminate the ongoing communication and release reserved bearer resources\n3.\tIn the case that bearer registration is required and has not been performed, the UE shall perform bearer registration to the IP-CAN. If the UE is already bearer registered, then the bearer registration procedures are not required to be performed.\nNOTE 1:\tDepending on the IP-CAN, the UE may be assigned an IP address at this stage.\n4.\tIn the case that bearer resources for the transport of the IMS related signalling are required to be reserved in the IP-CAN, the UE shall reserve the resources in the IP-CAN.\nIf the IP-CAN does not provide an IP address to the UE in step 3, then the IP-CAN shall allocate an IP address to the UE during the bearer resource request procedures.\n5.\tUE performs a PCSCF discovery procedure, where the UE discovers a PCSCF in the local network suitable for use in emergency sessions.\nNOTE 2:\tThe exact means for the PCSCF discovery is dependant upon the IP-CAN.\n6.\tIf the UE has sufficient credentials to authenticate with the IMS network, it shall initiate an IMS emergency registration by providing the IP address obtained at step 3 or step 4 to the PCSCF selected at step 5. The IP address used for signalling purposes is allocated in association with step 3 or step 4. The IMS registration request shall include an Emergency Public User Identity. The implicit registration set of the emergency Public User Identifier shall contain an associated Tel URI that is used to call back the user from the PSTN.\n\tThe SCSCF may set the proposed registration expiration according to the local policy of the serving system and regulation. The subsequent registration flows are like any other registration.\n\tIf the UE does not have sufficient credentials to authenticate with the IMS network, it shall not initiate an IMS emergency registration request, but instead immediately establish an emergency session towards the PCSCF as described in step 7.\n7.\tIf IMS emergency registration is performed, the UE shall initiate the IMS emergency session establishment using the IMS session establishment procedures containing an emergency session indication and emergency Public User Identifiers. Otherwise, the UE shall initiate the IMS emergency session establishment using the IMS session establishment procedures containing an emergency session indication and any registered Public User Identifier.\nWhether the procedures are activated individually by the UE or some of them are performed automatically depends on the implementation of the terminal and on the UE's configuration. For instance, the multimedia application in the UE could start the application level registration and steps 2-4 would have to be executed in response to support the operation initiated by the application. Interaction with the UE may happen during these steps.\n\nNext Change\n7.2\tIMS Registration for Emergency Session\nThe IMS emergency registration procedure shall follow the procedures as described in clause\u00a05.2.2.3 of TS\u00a023.228\u00a0[1] with the following modifications:\n-\tThe UE shall initiate an IMS emergency registration when all of the following conditions are met:\n-\teither the UE is not already IMS registered or the UE is IMS registered but is roaming outside its home network;\n-\tthe UE has sufficient credentials to authenticate with the IMS network;\n-\tthe UE is able to detect emergency session.\nThe UE shall also initiate an IMS emergency registration when it receives an \"IMS emergency registration required\" response as a result of the emergency session request:\n-\tIf the UE initiates an IMS emergency registration, it shall first initiate an emergency access to the IP-CAN if emergency access has been defined for the particular type of IP-CAN. This is to ensure that the session attempt is handled in the VPLMN when the UE is roaming and provides appropriate priority treatment and access to appropriate network elements (e.g. to a particular PDG and P-CSCF in the VPLMN).\n-\tIf the UE had already performed an emergency access when it receives an \"IMS emergency registration required\" response as a result of an emergency registration or emergency session request, it shall perform an emergency access followed by an emergency registration using a different VPLMN if available to prevent looping.\n-\tThe UE shall use an emergency Public User Identifier in the emergency registration request. This indication may be used to route calls coming from the PSAP to the contact address registered during the emergency registration procedure and to inform the home network that roaming restrictions may not be applied.\n-\tThe user's home network should ignore roaming restrictions for emergency registration requests.\n-\tNo originating and terminating services should be applied to emergency Public User Identifiers.\nNOTE:\tThe special emergency public user identifier is different from emergency indication in the IMS emergency session establishment request.\nPCSCF handles the registration requests with an emergency Public User Identifier like any other registration request.\nThe SCSCF in the home network may modify the received registration expiration value from the request according to local policy in the serving system and regulation. The subsequent registration flows are like any other registration.\n\nNext Change\n7.3\tEmergency Session Establishment in the Serving IMS network\nIf the UE is able to detect that the user is requesting an emergency session then it shall include an emergency service indication in the emergency session establishment request.\nIf the UE is CS capable and not attached to the PS domain, the UE shall attempt an emergency call in the CS domain. If the UE is only PS attached, and the network has indicated that IMS emergency services are supported, it should attempt the emergency call in the PS Domain. If the UE is attached to both domains, it should follow the requirement as stated in TS\u00a022.101\u00a0[8] that specifies \"A CS and IMS capable UE attempting an emergency call should give priority to the CS Domain. In case the call attempt fails, the UE should automatically make a second attempt on the other domain\". For an attempt in the IM CN Subsystem of the PS domain, the attempt should be in the serving (visited if roaming) IM CN Subsystem of the PS domain.\nIf the initial attempt is in the CS domain and it fails, the serving (visited if roaming) IM CN Subsystem of the PS domain shall be attempted if the UE is capable. If the initial attempt is in the IM CN Subsystem of the PS domain and it fails, the UE shall make the attempt in the CS domain (if the UE is capable and if for an appropriate service e.g., voice).\nIf a UE attempts to initiate a session and receives a 380 (Alternative Service) response with the type set to \"emergency\", the UE shall then re-attempt the session as described above with first attempt being towards the CS domain (if the UE is capable and if for an appropriate service e.g., voice), and with an indication that emergency service is requested.\nIf the UE is aware that it does not have sufficient credentials to authenticate with the IMS network, it shall not initiate an IMS registration but immediately establish an emergency session towards the PCSCF, see clause\u00a07.4.\nUpon receiving an initial request for an emergency session, the PCSCF shall follow the rules and procedures described in TS\u00a023.228\u00a0[1] with the following additions and clarifications:\n-\tThe PCSCF is the IMS network entity, which detects an emergency session.\n-\tFor the case that the initial request carries an indication that the request is for emergency services, and the UE is not registered in the IMS network, see clause\u00a07.4 for details.\n-\tFor the case that UE is IMS registered and the initial request does not carry an indication that the request is for emergency services, and the PCSCF is able to detect that the request is for emergency services, the PCSCF shall perform the \" Non UE detectable Emergency Session \" described in clause\u00a07.1.2 above.\n-\tFor the case that the initial request carries an indication that the request is for emergency services, and the UE is registered in the IMS network, but not performed emergency registration:\na)\tthe P-CSCF shall reject the request indicating that IMS emergency registration required, if the UE is roaming;\nNOTE:\tRoaming is when a UE is in a geographic area that is outside the serving geographic area of the home IMS system.\nb)\tthe home P-CSCF may reject the request indicating that IMS emergency registration required, based on local policy.\n-\tOn receipt of a session establishment request, which is recognized to be for an emergency service, the PCSCF shall check whether the UE provided a Tel URI as its identity in the request. If a Tel URI is present in the request, the PCSCF shall check the validity of this Tel URI. If no Tel URI is present in the request and the PCSCF is aware about the Tel URI associated with the emergency Public User Identifier, it shall provide the Tel URI to the ECSCF in the session establishment request.\n-\tThe PCSCF may query the IP-CAN for the location identifier.\n-\tPCSCF shall prioritize emergency sessions over other non-emergency sessions.\n-\tEmergency IP flows need to be identified by PCSCF in the Rx interface signalling to allow the PCRF to prioritize emergency service data flows over non-emergency service data flows within IPCAN. The detailed procedures are specified in TS\u00a023.203\u00a0[20].\nUpon receiving an initial request for an emergency session from PCSCF, the ECSCF shall perform the following:\n-\tif location information is not included in the emergency service request or if additional location information is required, the ECSCF, if required, retrieves the UE's location information as described in clause\u00a07.6 Retrieving Location information for Emergency Session.\n-\tIf location information is included by the UE, the ECSCF, if required requests the LRF to validate the location information.\n-\tMay determine or may request the LRF to determine the appropriate routing information which could be based on the type of emergency service requested and UE's location.\n-\tdetermine the default PSAP destination if routing based on UE's location is required but the location is unknown.\n-\tIf the PSAP/emergency centre contains a point of presence within the IMS connectivity network, the ECSCF shall forward the emergency session initiation request directly to the PSAP/emergency centre.\n-\tIf the PSAP/emergency centre has its point of presence in the PSTN/ISDN network or the CS domain, the ECSCF uses the Tel-URI obtained from the LRF and forwards the request to an appropriate BGCF/MGCF for routing in the GSTN. This number shall have the same format as used for CS emergency calls. The MGCF may insert any available location information in the PSTN/CS signalling.\nNOTE:\tIn case an ESRN is received from the LRF, the ECSCF maps the received ESRN from the LRF to a TEL-URI before forwarding the request to MGCF.\n\nEnd Changes\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently, there are open issues regarding the emergency public user identity (E-IMPU) and the ability to assign the same Tel URI to both a normal IRS and the IRS associated with the E-IMPU since TS 23.008 only allows identities to be included in a single IRS.In addition, it has been recognized that the E-IMPU should not be used to determine PSAP callback.  Further, with recent emergency call interactions identified in TS 22.173 and TS 22.101, it has been determined that feature interactions can not be managed through use of an E-IMPU.  Therefore, the only need is to distinguish an emergency registration from a non-emergency registration so that barring and roaming restrictions can be ignored.  HSS management will be simpified if E-IMPU\u2019s and their associated implicit registration sets do not have to be managed by operators. See also previous SA2 discussion papers and proposed CRs, including: S2-082186, S2-082482, S2-082332, S2-082614.\n\n>>> SUMMARY OF CHANGE\nRemove the use of an E-IMPU and introduce an indicator in the registration request.\n\n>>> CONSEQUENCES IF NOT REVISED\nRetaining an E-IMPU has the following consequences: - There will not be a way to associate a subscriber\u2019s \u201cnormal\u201d Tel URI with the E-IMPU resulting in CS PSAPs inability to callback users if the UE performed an emergency registration. - IP PSAP callback to users will fail if the emergency registration has expired and they address the callback using the E-IMPU.  - Operators will have to manage an additional implicit registration set for all subscribers that can make emergency calls.  - Operators will have to add \u201csos.domainX\u201d to all routing servers that contain their domain (domainX)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n14\tSRVCC between E-UTRAN and Circuit Switched UTRAN/GERAN\n14.1\tFrom E-UTRAN to Circuit Switched UTRAN/GERAN\nSingle Radio Voice Call Continuity (SRVCC) is specified in 3GPP TS 23.216 [22].\nThe MME and the UE shall derive a confidentiality key CKSRVCC, and an integrity key IKSRVCC from KASME and the NAS downlink COUNT with the help of a one-way key derivation function KDF as specified in Annex A. The MME shall select the current NAS downlink COUNT value to use in the handover and then increase the stored NAS downlink COUNT value by 1.\nThe KDF returns a 256-bit output, where the 128 most significant bits are identified with CKSRVCC and the 128 least significant bits are identified with IKSRVCC.\nThe MME shall also provide the 4 LSB of the current NAS downlink COUNT value to the source eNB, which then includes the bits to the HO Command to the UE. The UE shall use the received 4 LSB and its stored NAS downlink COUNT to estimate the NAS downlink COUNT selected by the MME. \nNOTE 0: It is left to the implementation how to estimate the NAS downlink COUNT.\nThe UE shall ensure that the estimated NAS downlink COUNT has not been used to calculate a CK'  and  IK'  in a previous successful or unsuccessful PS or SRVCC handover. If the estimated NAS downlink COUNT is greater than all the estimated NAS downlink COUNTs either used by the UE for key derivation in a handover or received in a NAS message that passed its integrity check, the UE shall update its stored NAS downlink COUNT as though it has successfully integrity checked  a NAS message with that estimated NAS downlink COUNT. In particular, the stored NAS downlink COUNT shall never be decreased.\nUE and MME shall assign the value of eKSI to KSI. MME shall transfer CKSRVCC, IKSRVCC with KSI and the UE security capability to the enhanced MSC server.  The enhanced MSC server shall replace all the stored UTRAN CS key  parameters CK, IK, KSI, if any, with CKSRVCC, IKSRVCC, KSI received from the MME. The UE shall replace all the stored UTRAN CS key parameters CK, IK, KSI, if any, with CKSRVCC, IKSRVCC, KSI in both ME and USIM. STARTCS shall comply with the rules in 3GPP\u00a0TS 25.331 [24]. The ME shall use CKSRVCC and IKSRVCC to derive the GSM CS Kc using the c3 function specified in 3GPP TS 33.102 [4]. The ME shall assign the eKSI value (associated with CKSRVCC and IKSRVCC) to the GSM CS CKSN (associated with the GSM CS Kc). The ME shall update the USIM and ME with the GSM CS Kc and GSM CS CKSN.\nNOTE 1: The new derived security context (including CKSRVCC, IKSRVCC and KSI) replacing the stored values in the USIM is for allowing to reuse the derived security context without invoking the authentication procedure in subsequent connection set-ups, and also for avoiding that one KSI value indicates to two different key sets and consequently leads to security context desynchronization.\nNOTE 2: An operator concerned about the security of keys received from an E-UTRAN of another operator may want to enforce a policy in the enhanced MSC server to run a UMTS AKA as soon as possible after the handover. One example of ensuring this is the deletion of the mapped UMTS security context in the the enhanced MSC server after the UE has left active state.\nNOTE 3: Due to replacing all the UTRAN CS key parameters CK, IK, KSI with CKSRVCC, IKSRVCC and KSI on USIM and in ME, a new GSM CS Kc needs to be derived from the new UTRAN CS key parameters CK and IK (i.e. CKSRVCC and IKSRVCC), which is part of the new UMTS security context as well, as any old GSM CS Kc stored on USIM and in ME, belongs to an old UMTS security context and can no longer be taken into use.\nIf the SRVCC is from E-UTRAN to GERAN, the above description in this section applies as well for the MME, the enhanced MSC server and the UE. The enhanced MSC server shall in addition derive GSM CS Kc from CKSRVCC and IKSRVCC with the help of the key conversion function c3 as specified in TS 33.102 [4]. The enhanced MSC Server shall assign the value of eKSI to GSM CS CKSN (associated with the GSM CS Kc).\nNOTE :\tNon-voice bearers may be handed over during the SRVCC handover operation. Key derivation for non-voice bearers is specified in clause 9 of the present specification.\nIf the SRVCC handover is not completed successfully, the new mapped CKSRVCC, IKSRVCC and KSISRVCC can not be used in the future. The MSC server enhanced for SRVCC shall delete the new mapped CKSRVCC, IKSRVCC and KSISRVCC and the stored parameters CKCS and IKCS which has the same KSI as the new mapped CKSRVCC, IKSRVCC (if such exist).\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFor the case where non-voice PS bearers are not handed over during the SRVCC handover operation, the security key derivation for the PS domain is not defined.As in this case the subscriber context (mobility management and session management contexts) is not transferred from the MME to the SGSN during the SRVCC handover, but only later when the UE resumes PS services (e.g. after the voice call has been released, i.e. possibly several minutes after the SRVCC handover), the rules defined in clause 9.1.1 and 10.2.1 for idle mode mobility from E-UTRAN to GERAN/UTRAN should be followed, since for MME this appears as an idle mode mobility procedure with no relationship to the previous SRVCC handover. (Note that when ISR is activated for the UE, it is also possible that an existing UMTS security context is used between UE and SGSN.)\n\n>>> SUMMARY OF CHANGE\nFor the case where non-voice PS bearers are not handed over during the SRVCC handover operation, the security key derivation for the PS domain is explicitly defined to follow the rules defined in clause 9.1.1 and 10.2.1 for idle mobility.\n\n>>> CONSEQUENCES IF NOT REVISED\nAn undefined case can lead to different implementations on UE and network side. In UE tests (3GPP TS 36.523 13_4_3_1) it has been observed that UE and network side (protocol tester) are using different key derivation functions for the PS domain (KASME to CK', IK' derivation at handover and derivation at idle mobility, respectively). As a consequence, the UE cannot resume PS services, because the subsequent routing area updating procedure fails when the network tries to activate security."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n******************** Start of changes ****************\n2\tReferences\nThe following documents contain provisions, which, through reference in this text, constitute provisions of the present document.\nReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\nFor a specific reference, subsequent revisions do not apply.\nFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP\u00a0TS 22.146: \"Multimedia Broadcast/Multicast Service; Stage 1\".\n[3]\t3GPP\u00a0TS\u00a023.246: \"Multimedia Broadcast/Multicast Service (MBMS); Architecture and Functional Description\".\n[4]\t3GPP TS 33.102: \"3G Security; Security Architecture\".\n[5]\t3GPP TS 22.246: \"MBMS User Services\".\n[6]\t3GPP\u00a0TS\u00a033.220: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture\".\n[7]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the USIM application\".\n[8]\tIETF\u00a0RFC\u00a02617 \"HTTP Digest Authentication\".\n[9]\tIETF\u00a0RFC\u00a03830 \"MIKEY: Multimedia Internet KEYing\"\n[10]\tIETF\u00a0RFC\u00a01982 \"Serial Number Arithmetic\".\n[11]\tIETF\u00a0RFC\u00a03711 \"Secure Real-time Transport Protocol\".\n[12]\t3GPP\u00a0TS\u00a043.020: \"Security related network functions\".\n[13]\t3GPP\u00a0TS\u00a026.346: \"Multimedia Broadcast/Multicast Service; Protocols and Codecs\".\n[14]\t3GPP\u00a0TS\u00a033.210: \"Network domain security; IP network layer security\".\n[15]\tOMA-DRM-DCF-v2_0: \"OMA DRM Content Format\", \n[16]\tIETF RFC 4563 \"The Key ID Information Type for the General Extension Payload in Multimedia Internet KEYing (MIKEY) \"\n[17]\tPort numbers at IANA, .\n[18]\t3GPP\u00a0TS\u00a024.109: \"3rd Generation Partnership Project; Technical Specification Group Core Network; Bootstrapping interface (Ub) and network application function interface (Ua); Protocol details\".\n[19]\tIETF RFC 2616 \" Hypertext Transfer Protocol -- HTTP/1.1\".\n[20]\t3GPP\u00a0TS\u00a029.109: \"3rd Generation Partnership Project; Technical Specification Group Core Network; Generic Authentication Architecture (GAA); Zh and Zn Interfaces based on the Diameter protocol; Stage 3\".\n[21]\tIETF RFC 3629 \"UTF-8, a transformation format of ISO 10646\".\n[22]\tIETF RFC 4771 \"Integrity Transform Carrying Roll-Over Counter for the Secure Real-time Transport Protocol (SRTP)\".\n[23]\t3GPP\u00a0TS\u00a023.107: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Quality of Service (QoS) concept and architecture\".\n[24]\tOMA DRM v2.0 Extensions for Broadcast Support, Candidate Version 1.0 \u2013 29 May 2007\u201d \n(OMA-TS-DRM_XBS-V1_0-20070529-C).\n[25]\tIETF RFC 3376 \"Internet Group Management Protocol, Version 3\".\n[26]\tIETF RFC 3810 \"Multicast Listener Discovery Version 2 (MLDv2) for IPv6\".\n[27]\t3GPP TS 25.434, \"UTRAN Iub Interface Data Transport and Transport Signalling for Common Transport Channel Data Streams\".\n[28]\tIETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\".\n[27]\t3GPP TS 26.237: \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols\".\n[28]\t3GPP TS 22.203: \" Policy and charging control architecture\".\n\n\n\n\n******************** Next change ****************\n6.2.1.3\tHTTP digest authentication\nWhen the UE initiates an HTTP procedure towards the BM-SC, HTTP digest authentication as defined in RFC\u00a02617\u00a0[8] shall be used for mutual authentication. HTTP digest is run between BM-SC and ME. The MBMS authentication procedure is based on the general user authentication procedure over Ua interface that is specified in clause \"Procedures using the bootstrapped Security Association\" in TS\u00a033.220\u00a0[6]. The BM-SC will act as a NAF according to TS\u00a033.220\u00a0[6]. Along with the GBA-keys the BSF shall send the IMPI of the user to the BM-SC. The details of HTTP digest authentication are specified in clause\u00a05.2 of TS\u00a024.109\u00a0[18]\nThe following adaptations apply to HTTP digest:\n-\tthe B-TID as specified in TS\u00a033.220\u00a0[6] is used as username;\n-\tMRK (MBMS Request Key) is used as password.\nAll HTTP procedures within this specification including the associated delivery procedures in TS\u00a026.346\u00a0[13] shall be integrity protected with HTTP digest as specified in this clause.\n\n******************** Next change ****************\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe MBMS associated delivery procedures for reception reporting and file repair may contain both user privacy and network privacy sensistive information. However, the ability to confidentiality protect these information is missing, thus leading to potential privacy compromise to users and operators.\n\n>>> SUMMARY OF CHANGE\nThe use of TLS over HTTP is specified for confidentiality protecting the associated delivery procedures.\n\n>>> CONSEQUENCES IF NOT REVISED\nConfidentiality of user and network privacy is compromised."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n9\tMobility management\nEditor\u2019s note: Intended to capture tests of \n5G Core Network behaviour defined in TS 24.301, TS 24.501 et.al.\n\nMulti-RAT Dual Connectivity behaviour defined in TS 37.340. \nPossible configurations may be handled in the following sub-structure:\na)  E-UTRA\u2013NR DC via EPC with E-UTRA as master (also referred to EN-DC, option 3, 3a, 3x)\nb)  E-UTRA\u2013NR DC via 5GC \n      -  with E-UTRA as master (also referred to NGEN-DC, option 7, 7a, 7x)\n      -  with NR as master (also referred to NE-DC, option 4, 4A)\n9.1\t5GS Mobility Management\n\n\n\n9.1.5.1.12.3.3\tSpecific message contents\nTable 9.1.5.1.12.3.3-1: REGISTRATION REJECT (step 10 Table 9.1.5.1.12.3.2-1)\nDerivation Path: 38.508-1 [4], FFS\nInformation Element\tValue/remark\tComment\tCondition\n5GMM cause\tFFS\tCause #22 (Congestion)\nT3346 Value\t\u201800100011\u2019B\t3 minutes\n\nTable 9.1.5.1.12.3.3-1: REGISTRATION REJECT (step 21 Table 9.1.5.1.12.3.2-1)\nDerivation Path: 38.508 [4], FFS\nInformation Element\tValue/remark\tComment\tCondition\n5GMM cause\tFFS\tCause #22 (Congestion)\nT3346 Value\t\u201800100101\u2019B\t5 minutes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.3.2-1: Main behaviour\n\n\n\n.3.2-1)\n\n\n Table 9.1.5.2.1.3.2-1)\n\n\n, Table 9.1.5.2.1.3.2-1)\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe core requirements for the UE behaviour in regard to the 5GMM Mobility and periodic registration update when the UE detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the AMF are essential for the correct operation of a Device. Therefore, they need to be tested.\n\n>>> SUMMARY OF CHANGE\nA test case for verifying the UE behaviour is added.\n\n>>> CONSEQUENCES IF NOT REVISED\nEssential requirements will not be verified and UEs cannot be tested. \"bad\" UEs may enter the market and disrupt the service."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * \n5.1.3.1\tInitial INVITE request\nUpon generating an initial INVITE request, the UE shall include the Accept header with \"application/sdp\", the MIME type associated with the 3GPP IMS XML body (see subclause\u00a07.6.1) and any other MIME type the UE is willing and capable to accept.\nThe \"integration of resource management and SIP\" extension is hereafter in this subclause referred to as \"the precondition mechanism\" and is defined in RFC\u00a03312\u00a0[30] as updated by RFC\u00a04032\u00a0[64]. \nThe preconditions mechanism should be supported by the originating UE.\nThe UE may initiate a session without the precondition mechanism if the originating UE does not require local resource reservation. \nNOTE\u00a01:\tThe originating UE can decide if local resource reservation is required based on e.g. application requirements, current access network capabilities, local configuration, etc.\nIn order to allow the peer entity to reserve its required resources, an originating UE supporting the precondition mechanism should make use of the precondition mechanism, even if it does not require local resource reservation.\nUpon generating an initial INVITE request using the precondition mechanism, the UE shall:\n-\tindicate the support for reliable provisional responses and specify it using the Supported header mechanism; and\n-\tindicate the support for the preconditions mechanism and specify it using the Supported header mechanism.\nUpon generating an initial INVITE request using the precondition mechanism, the UE should not indicate the requirement for the precondition mechanism by using the Require header mechanism.\nNOTE\u00a02:\tIf an UE chooses to require the precondition mechanism, i.e. if it indicates the \"precondition\" option tag within the Require header, the interworking with a remote UE, that does not support the precondition mechanism, is not described in this specification.\nNOTE\u00a03:\tTable\u00a0A.4 specifies that UE support of forking is required in accordance with RFC\u00a03261\u00a0[26]. The UE can accept or reject any of the forked responses, for example, if the UE is capable of supporting a limited number of simultaneous transactions or early dialogs.\nUpon successful reservation of local resources the UE shall confirm the successful resource reservation (see subclause\u00a06.1.2) within the next SIP request. \nNOTE\u00a04: \tIn case of the precondition mechanism being used on both sides, this confirmation will be sent in either a PRACK request or an UPDATE request. In case of the precondition mechanism not being supported on one or both sides, alternatively a reINVITE request can be used for this confirmation, in case the terminating UE does not support the PRACK request (as described in RFC\u00a03262\u00a0[27]) and does not support the UPDATE request (as described in RFC\u00a03311\u00a0[29]).\nNOTE\u00a05:\tIf the UE supports the P-Early-Media header, upon receiving a 18x provisional response with a P-Early-Media header indicating authorized early media, as described in RFC\u00a05009\u00a0[109], if the preconditions are met, the UE should, based on local configuration, present received early media to the user.\nNOTE\u00a06:\tIf the UE supports the P-Early-Media header, upon receiving a 180 (Ringing) provisional response with a P-Early-Media header indicating authorized early media, as described in RFC\u00a05009\u00a0[109], if the preconditions are met, and the UE presents the received early media to the user based on local configuration, the UE will not provide an indication that the invited user is being alerted.\nNOTE\u00a07:\tIf the UE supports the P-Early-Media header and if the most recently received P-Early-Media header within the dialog includes a parameter applicable to media stream with value \"inactive\", then based on local configuration, the UE will provide an indication that the invited user is being alerted and stop presenting received early media to the user if requested by any previous receipt of P-Early-Media header within the dialog.\nIf the UE wishes to receive early media authorization indications, as described in RFC\u00a05009\u00a0[109], it shall add the P-Early-Media header with the \"supported\" parameter to the INVITE request.\nWhen a final answer is received for one of the early dialogues, the UE proceeds to set up the SIP session. The UE shall not progress any remaining early dialogues to established dialogs. Therefore, upon the reception of a subsequent final 200 (OK) response for an INVITE request (e.g., due to forking), the UE shall:\n1)\tacknowledge the response with an ACK request; and\n2)\tsend a BYE request to this dialog in order to terminate it.\nUpon receiving a 488 (Not Acceptable Here) response to an initial INVITE request, the originating UE should send a new INVITE request containing SDP according to the procedures defined in subclause\u00a06.1.\nNOTE\u00a08:\tAn example of where a new request would not be sent is where knowledge exists within the UE, or interaction occurs with the user, such that it is known that the resulting SDP would describe a session that did not meet the user requirements.\nUpon receiving a 421 (Extension Required) response to an initial INVITE request in which the precondition mechanism was not used, including the \"precondition\" option tag in the Require header, the originating UE shall: \n-\tsend a new INVITE request using the precondition mechanism, if the originating UE supports the precondition mechanism; and\n-\tsend an UPDATE request as soon as the necessary resources are available and a 200 (OK) response for the first PRACK request has been received.\nUpon receiving a 503 (Service Unavailable) response to an initial INVITE request containing a Retry-After header, then the originating UE shall not automatically reattempt the request until after the period indicated by the Retry-After header contents.\nIn the event the UE receives a 380 (Alternative Service) response to an INVITE request the response containing a XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table\u00a07.7AA), the UE shall attempt an emergency call as described in subclause\u00a05.1.6.\n\n* * * Next Change * * * \n5.1.6.8.1\tGeneral\nThe UE shall translate any user indicated emergency number as specified in 3GPP\u00a0TS\u00a022.101\u00a0[1A] to an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" service type as specified in RFC\u00a05031\u00a0[69]. An additional sub-service type can be added if information on the type of emergency service is known.\nIn the event the UE receives a 380 (Alternative Service) response to an INVITE request the response containing a XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table\u00a07.7AA), the UE shall automatically send an ACK request to the P-CSCF as per normal SIP procedures and terminate the session.\nNOTE\u00a01:\tThe UE can attempt an emergency call setup according to the procedures described in 3GPP\u00a0TS\u00a024.008\u00a0[8].\nNOTE\u00a02:\tEmergency numbers which the UE does not detect, will be treated as a normal call.\n\n* * * Next Change * * * \n5.1.6.8.3\tEmergency session set-up within an emergency registration\nAfter a successful initial emergency registration, the UE shall apply the procedures as specified in subclauses\u00a05.1.2A, 5.1.3 and 5.1.4 with the following additions:\n1)\tthe UE shall insert in the INVITE request, a From header that includes the public user identity registered via emergency registration or the tel URI associated with the public user identity registered via emergency registration, as described in subclause\u00a04.2;\n2)\tthe UE shall include a Request URI in the INVITE request that contains an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69]. An additional sub-service type can be added if information on the type of emergency service is known;\n3)\tthe UE shall insert in the INVITE request, a To header with:\n-\tthe same emergency service URN as in the Request URI; or\n-\tif the UE cannot perform local dialstring interpretation for the dialled digits, a dialstring URI representing the dialled digits in accordance with RFC\u00a04967\u00a0[103] or a tel URL representing the dialled digits;\nNOTE\u00a01:\tThis version of this document does not provide any specified handling of a URI with the dialled digits in accordance with RFC\u00a04967\u00a0[103] at an entity within the IM CN susbsystem. Behaviour when this is used is therefore not defined.\n4)\tif available to the UE, and if defined for the access type as specified in subclause\u00a07.2A.4, the P-Access-Network-Info header shall contain a location identifier such as the cell id, line id or the identity of the I-WLAN access node, which is relevant for routeing the IMS emergency call;\nNOTE\u00a02:\tThe IMS emergency specification in 3GPP\u00a0TS\u00a023.167\u00a0[4B] describes several methods how the UE can get its location information from the access network or from a server. Such methods are not in the scope of this specification.\n5)\tthe UE shall insert in the INVITE request, a P-Preferred-Identity header that includes the public user identity registered via emergency registration or the tel URI associated with the public user identity registered via emergency registration as described in subclause\u00a04.2;\n6)\tvoid;\n7)\tif the UE has its location information available, it shall include its location information in the INVITE request in the following way:\n-\tif the UE is aware of the URI that points to where the UE's location is stored, include the URI in the Geolocation header, set the \"inserted-by\" header field parameter to indicate its hostport and set the \"routing-allowed\" header field parameter to \"yes\", all in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]; or \n-\tif the geographical location information of the UE is available to the UE, include its geographical location information as PIDF location object in accordance with RFC\u00a04119\u00a0[90] and include the location object in a message body with the content type application/pidf+xml in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]. The Geolocation header is set to a Content ID, set the \"inserted-by\" header field parameter to indicate its hostport and set the \"routing-allowed\" header field parameter to \"yes\", all in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]; and\nNOTE\u00a03:\tIt is suggested that UE's only use the option of providing a URI when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A URI that is only resolvable to the UE which is making the emergency call is not desirable.\n8)\tif the UE has no geographical location information available, the UE shall not include any geographical location information as specified in draft-ietf-sipcore-location-conveyance\u00a0[89] in the INVITE request.\nNOTE\u00a04:\tRFC\u00a03261\u00a0[26] provides for the use of the Priority header field with a suggested value of \"emergency\". It is not precluded that emergency sessions contain this value, but such usage will have no impact on the processing within the IM CN subsystem.\nUpon receiving a 380 (Alternative Service) response to the INVITE request, with the 380 (Alternative Service) response including a IM CN subsystem XML body, with an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with a <type> child element set to \"emergency\" (see table\u00a07.7AA), the UE shall perform the first action that is applicable from the following prioritised actions:\n-\tattempt emergency call via CS domain according to the procedures described in 3GPP\u00a0TS\u00a024.008\u00a0[8], if available and not already tried;\n-\tif the <action> child element of the <alternative-service> child element of the <ims-3gpp> element in the IM CN subsystem XML body as described in subclause\u00a07.6 is set to \"emergency-registration\" (see table\u00a07.7AB), perform an initial emergency registration using a different VPLMN if available, as described in subclause\u00a05.1.6.2 and if the new emergency registration succeeded, attempt an emergency call as described in this subclause; or\n-\tperform implementation specific actions to establish the emergency call.\n\n* * * Next Change * * * \n5.1.6.8.4\tEmergency session setup within a non-emergency registration\nThe UE shall apply the procedures as specified in subclauses\u00a05.1.2A, 5.1.3 and 5.1.4 with the following additions:\n1)\tthe UE shall include a Request URI in the INVITE request that contains an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69]. An additional sub-service type can be added if information on the type of emergency service is known;\n2)\tthe UE shall insert in the INVITE request, a To header with:\n-\tthe same emergency service URN as in the Request URI; or\n-\tif the UE cannot perform local dialstring interpretation for the dialled digits, a dialstring URI representing the dialled digits in accordance with RFC\u00a04967\u00a0[103] or a tel URL representing the dialled digits;\nNOTE\u00a01:\tThis version of this document does not provide any specified handling of a URI with the dialled digits in accordance with RFC\u00a04967\u00a0[103] at an entity within the IM CN susbsystem. Behaviour when this is used is therefore not defined.\n3)\tthe UE shall insert in the INVITE request, a From header that includes the public user identity or the tel URI associated with the public user identity, as described in subclause\u00a04.2; \n4)\tif available to the UE, and if defined for the access type as specified in subclause\u00a07.2A.4, the P-Access-Network-Info header shall contain a location identifier such as the cell id, line id or the identity of the I-WLAN access node, which is relevant for routeing the IMS emergency call;\nNOTE\u00a02:\t3GPP\u00a0TS\u00a023.167\u00a0[4B] describes several methods how the UE can get its location information from the access network or from a server. Such methods are not in the scope of this specification.\n5)\tthe UE shall insert in the INVITE request a P-Preferred-Identity that includes the public user identity or the tel URI associated with the public user identity as described in subclause\u00a04.2;\n6)\tif the UE has its location information available, it shall include its location information in the INVITE request in the following way:\n-\tif the UE is aware of the URI that points to where the UE's location is stored, include the URI in the Geolocation header, set the \"inserted-by\" header field parameter to indicate its hostport and set the \"routing-allowed\" header field parameter to \"yes\", all in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]; or \n-\tif the geographical location information of the UE is available to the UE, include its geographical location information as PIDF location object in accordance with RFC\u00a04119\u00a0[90] and include the location object in a message body with the content type application/pidf+xml in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]. The Geolocation header is set to a Content ID, set the \"inserted-by\" header field parameter to indicate its hostport and set the \"routing-allowed\" header field parameter to \"yes\", all in accordance with draft-ietf-sipcore-location-conveyance\u00a0[89]; and\n7)\tif the UE has no geographical location information available, the UE shall not include any geographical location information as specified in draft-ietf-sipcore-location-conveyance\u00a0[89] in the INVITE request; and\nNOTE\u00a03:\tIt is suggested that UE's only use the option of providing a URI when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A URI that is only resolvable to the UE which is making the emergency call is not desirable.\n8)\tif a public GRUU value (pub-gruu) has been saved associated with the public user identity to be used for this request, and the UE does not indicate privacy of the P-Asserted-Identity, then insert the public GRUU (pub-gruu) value in the Contact header as specified in RFC\u00a05627\u00a0[93]; otherwise the UE shall include the protected server port in the address in the Contact header.\nUpon receiving a 380 (Alternative Service) response to the INVITE request, with the 380 (Alternative Service) response include a IM CN subsystem XML body, with an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with a <type> child element set to \"emergency\" (see table\u00a07.7AA), the UE shall:\n-\tif the <action> child element of the <alternative-service> child element of the <ims-3gpp> element in the IM CN subsystem XML body as described in subclause\u00a07.6 is set to \"emergency-registration\" (see table\u00a07.7AB), perform an initial emergency registration, as described in subclause\u00a05.1.6.2 and attempt an emergency call as described in subclause\u00a05.1.6.8.3;\n-\tattempt emergency call via CS domain according to the procedures described in 3GPP\u00a0TS\u00a024.008\u00a0[8], if available and not already tried; or\n-\tperform implementation specific actions to establish the emergency call.\nNOTE\u00a04:\tHow the UE indicates that no location is available when the UE does not support draft-ietf-sipcore-location-conveyance [89] is not specified in this version of the specification.\nNOTE\u00a05:\tRFC\u00a03261\u00a0[26] provides for the use of the Priority header field with a suggested value of \"emergency\". It is not precluded that emergency sessions contain this value, but such usage will have no impact on the processing within the IM CN subsystem.\n\n* * * Next Change * * * \n5.2.10.4\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method - non-emergency registration\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user the P-CSCF shall inspect the Request URI independent of values of possible entries in the received Route header fields for known emergency service identifiers. The P-CSCF shall consider the Request URI of the initial request as an emergency service identifier, if it is an emergency number or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to;\n-\tfor inbound roamers , the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP URI belonging to the user; and\n-\tthe country of roaming partners, if the request originates from a different country then the country of the network to which the P-CSCF belongs to. Access technology specific procedures are described in each access technology specific annex to determine from which country and roaming partner the request was originated. If the country from which the request originates can not be determined all lists are associated.\nIf the P-CSCF detects that the Request-URI of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n0A)\tdetermine the geographic location of the UE. Access technology specific procedures are described in each access technology specific annex. If the UE is roaming or the P-CSCF is in a different network than the UE's home operator's network, then the P-CSCF:\nI)\tshall reject the request by returning a 380 (Alternative Service) response to the UE;\nII)\tshall assume that the UE supports version 1 of the XML Schema for the IM CN subsystem XML body if support for the 3GPP IMS XML body in the Accept header field is not indicated; and\nIII)\tshall include in the 380 (Alternative Service) response \na Content-Type header field with the value set to associated MIME type of the 3GPP IMS XML body as described in subclause\u00a07.6.1\n, and\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"emergency\" (see table\u00a07.7AA) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table\u00a07.7AB) if the P-CSCF is accordingly configured by the operator.\nNOTE\u00a01:\tRoaming is when a UE is in a geographic area that is outside the serving geographic area of the home IM CN subsystem.\nNOTE\u00a02:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\n1)\tinclude in the Request-URI an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69], if necessary, and execute the procedure described in step 2, 3, 4, 5, and 6, in subclause\u00a05.2.6.3 dealing with the procedure when the P-CSCF receives an initial request from the UE. An additional sub-service type can be added if information on the type of emergency service is known. The entry in the Request-URI that the P-CSCF includes may either be:\n-\tas received from the UE in the Request URI in accordance with RFC\u00a05031\u00a0[69]; or\n-\tas deduced from the Request-URI received from the UE;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE protected server port, for the  security association on which the request was received such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-URI; and\n3)\texecute the procedures as specified in subclause\u00a05.2, except for the procedure described in step 3, 4, 5, and 6, in subclause 5.2.6.3 dealing with the procedure when the P-CSCF receives an initial request from the UE, and with the following additions:\na)\tthe P-CSCF shall:\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP URI and if a tel URI belongs to the set of implicitly registered public user identities that contains the SIP URI, add a second P-Asserted-Identity header field that contains the tel URI;\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel URI, add a second P-Asserted-Identity header field that contains a SIP URI belonging to the set of implicitly registered public user identities that contains the tel URI; and\niii)\tselect an E-CSCF and add the URI of the selected E-CSCF to the topmost Route header field.\nNOTE\u00a03:\tIt is implementation dependant as to how the P-CSCF obtains the list of E-CSCFs.\nIf the P-CSCF does not receive any response to the INVITE request (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an INVITE request, the P-CSCF shall select a new E-CSCF and forward the INVITE request.\nWhen the P-CSCF receives a target refresh request for a dialog with the Request-URI containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE protected server port related to the GRUU contained in the Request-URI and rewrite the Request-URI with that UE IP address and UE protected server port; and\n-\tperform the steps in subclause\u00a05.2.6.4 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\n* * * Next Change * * * \n5.2.10.5\tAbnormal cases\nIf the IM CN subsystem to where the P-CSCF belongs to is not capable to handle emergency sessions or due to local policy does not handle emergency sessions or only handles certain type of emergency session request or does not support emergency sessions for either the geographical location of the UE is located or the IP-CAN to which the UE is attached, the P-CSCF shall not forward the INVITE request. The P-CSCF:\nI)\tshall respond to the INVITE request with a 380 (Alternative Service) response;\nII)\tshall assume that the UE supports version 1 of the XML Schema for the IM CN subsystem XML body if support for the 3GPP IMS XML body in the Accept header is not indicated; and\nIII)\tshall include in the 380 (Alternative Service) response \na Content-Type header field with the value set to associated MIME type of the 3GPP IMS XML body as described in subclause\u00a07.6.1.\n\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"emergency\" (see table\u00a07.7AA) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table\u00a07.7AB) if the P-CSCF is accordingly configured by the operator.\nNOTE\u00a01:\tEmergency service URN in the request-URI indicates for the network that the emergency call attempt is recognized by the UE.\nNOTE\u00a02:\tSome networks only allow session requests with a Request-URI containing an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC\u00a05031\u00a0[69].\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nRecently, Cat F CRs have been approved or agreed to Rel-7, correcting the emergency call handling, e.g. CR#3253 (titled \u201cCorrection of Stage 3 misalignment with Stage 1 and Stage 2 on use of SIP 380 response.\u201d) and CR#3341 (titled \u201cFurther modifications required to SIP 380 response to remove new requirements\u201d). Even after these corrections, emergency call handling is broken. A Rel-7 P-CSCF will provide a SIP 380 response that is ignored by Rel-8 and up UEs. Furthermore, a Rel-7 UE can request emergency service without the user\u2019s consent or knowledge, upon receiving a SIP 380 response.Subclause 5.1.3.1 includes the following:In the event the UE receives a 380 (Alternative Service) response to an INVITE request the response containing a XML body that includes an <alternative service> element with the <type> child element set to \"emergency\", the UE shall attempt an emergency call as described in subclause\u00a05.1.6.During CT1#55bis \u201cCT1 agree[d] that in Rel-5, Rel-6, Rel7 and Rel-8 of IMS networks compliant to 3GPP TS 24.229 a DDOS attack can occur on the PSAP. The UE can request emergency service without the user\u2019s consent or knowledge when the UE initiates a session (which results in a 380 being spoofed)\u201d.\n\n>>> SUMMARY OF CHANGE\nThe P-CSCF includes in 380 (Alternative Service) messages containing XML bodies that include an <alternative service> element with the <type> child element set to \"emergency\", a P-Asserted-Identity header field with a value equal to the value of the SIP URI of the P-CSCF included in the Path header field during registration of the UE.A UE verifies if a 380 (Alternative Service) messages containing XML bodies that include an <alternative service> element with the <type> child element set to \"emergency\" also contains a P-Asserted-Identity header field with a value equal to the value of the SIP URI of the P-CSCF received in the Path header field during registration\n\n>>> CONSEQUENCES IF NOT REVISED\nA DDOS attack can occur on the PSAP, originated by Rel-7 UEs. The Rel-7 UE can request emergency service without the user\u2019s consent or knowledge. A SIP 380 response provided by a Rel-7 P-CSCF is ignored by Rel-8 and up UEs."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n------------------------------- FIRST CHANGE -------------------------------\n5.3.5\tHandling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)\nPeriodic tracking area updating is used to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by the periodic tracking area update timer (timer T3412). The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.\n\nThe timer T3412 is reset and started with its initial value, when the UE goes from EMM-CONNECTED to EMM-IDLE mode. The timer T3412 is stopped when the UE enters EMM-CONNECTED mode or EMM-DEREGISTERED state.\nWhen timer T3412 expires, the periodic tracking area updating procedure shall be started and the timer shall be set to its initial value for the next start.\nIf the UE is in another state than EMM-REGISTERED.NORMAL-SERVICE when the timer expires the periodic tracking area updating procedure is delayed until the UE returns to EMM-REGISTERED.NORMAL-SERVICE.\nIf ISR is activated, the UE shall keep both the periodic tracking area update timer (timer T3412) and the periodic routeing area update timer (timer T3312). The two separate timers run in the UE for updating MME and SGSN independently. If the periodic tracking area update timer expires and the UE cannot initiate the tracking area updating procedure, as it is in state EMM-REGISTERED.NO-CELL-AVAILABLE, the UE shall start the E-UTRAN deactivate ISR timer T3423. The UE shall initiate the tracking area updating procedure and stop the timer T3423 when it enters state EMM-REGISTERED.NORMAL-SERVICE before timer T3423 expires. After expiry of timer T3423 the UE shall set its TIN to \"P-TMSI\" in order to initiate the tracking area updating procedure when it returns to state EMM-REGISTERED.NORMAL-SERVICE.\nIf the UE is attached to both EPS and non-EPS services, and if timer T3412 expires or timer T3423 expires when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, then the UE shall initiate the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" when the UE returns to EMM-REGISTERED.NORMAL-SERVICE state.\nThe network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer. The mobile reachable timer shall be longer than T3412. By default, the mobile reachable timer is 4 minutes greater than T3412. If ISR is not activated, the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.\nThe mobile reachable timer shall be reset and started with its initial value, when the MME releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.\nUpon expiry of the mobile reachable timer the network shall start the implicit detach timer. The value of the implicit detach timer is network dependent. If ISR is activated, the default value of the implicit detach timer is 4 minutes greater than T3423. If the implicit detach timer expires before the UE contacts the network, the network shall implicitly detach the UE.\nThe implicit detach timer shall be stopped when a NAS signalling connection is established for the UE.\n------------------------------- NEXT CHANGE -------------------------------\n\n\n8.2.26.2\tT3412 value\nThis IE may be included to indicate a value for timer T3412.\nIf this IE is not included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT message.\n\n------------------------------- NEXT CHANGE -------------------------------\n10.2\tTimers of EPS mobility management\nTable 10.2.1: EPS mobility management timers \u2013 UE side\nTIMER NUM.\tTIMER VALUE\tSTATE\tCAUSE OF START\tNORMAL STOP\tON \nEXPIRY\nT3402\tDefault 12 min.\tNOTE\u00a01\tEMM-DEREGISTERED\tEMM-REGISTERED\tAt attach failure and the attempt counter is equal to 5.\tAt tracking area updating failure and the attempt counter is equal to 5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tInitiation of the attach procedure or TAU procedure\nT3410\t15s\tEMM-REGISTERED-INITIATED\tATTACH REQUEST sent\tATTACH ACCEPT received\tATTACH REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.1.2.6\nT3411\t10s\tEMM-DEREGISTERED. ATTEMPTING-TO-ATTACH\t\tEMM-REGISTERED. ATTEMPTING-TO-UPDATE\tAt attach failure due to lower layer failure, T3410 timeout or attach rejected with other EMM cause values than those treated in subclause\u00a05.5.1.2.5.\t\tAt tracking area updating failure due to lower layer failure, T3430 timeout or TAU rejected with other EMM cause values than those treated in subclause\u00a05.5.3.2.5.\tATTACH REQUEST sent\tTRACKING AREA UPDATE REQUEST sent\tRetransmission of the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST\nT3412\tNOTE\u00a02\tEMM-REGISTERED\tIn EMM-REGISTERED, when EMM-CONNECTED mode is left.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode. \tInitiation of the periodic TAU procedure\nT3416\t30s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tRAND and RES stored as a result of a UMTS authentication challenge\tSECURITY MODE COMMAND received\tSERVICE REJECT received\tTRACKING AREA UPDATE ACCEPT received\tAUTHENTICATION REJECT received\tAUTHENTICATION FAILURE sent\tEMM-DEREGISTERED or EMM-NULL entered\tDelete the stored RAND and RES\nT3417\t5s\tEMM-SERVICE-REQUEST-INITIATED\tSERVICE REQUEST sent\tEXTENDED SERVICE REQUEST sent in case f and g in subclause 5.6.1.1\tBearers have been set up\tSERVICE REJECT received\tAbort the procedure\nT3417ext\t10s\tEMM-SERVICE-REQUEST-INITIATED\tEXTENDED SERVICE REQUEST sent in case d in subclause 5.6.1.1\tEXTENDED SERVICE REQUEST sent in case e in subclause 5.6.1.1 and the CSFB response was set to \"CS fallback accepted by the UE\"\tInter-system change from S1 mode to A/Gb mode or Iu mode is completed\tInter-system change from S1 mode to A/Gb mode or Iu mode is failed\tSERVICE REJECT received\tAbort the procedure\nT3418\t20s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (EMM cause = #20 \"MAC failure\" or #26 \"non-EPS authentication unacceptable\") sent\tAUTHENTICATION REQUEST received\tOn first expiry, the UE should consider the network as false\nT3420\t15s\tEMM-REGISTERED-INITIATED\tEMM-REGISTERED\tEMM-DEREGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tAUTHENTICATION FAILURE (cause = #21 \"synch failure\") sent\tAUTHENTICATION REQUEST received\tOn first expiry, the UE should consider the network as false\nT3421\t15s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3423\tNOTE\u00a03\tEMM-REGISTERED\tT3412 expires while the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE and ISR is activated.\tWhen entering state EMM-DEREGISTERED or when entering EMM-CONNECTED mode.\tSet TIN to \"PTMSI\"\nT3430\t15s\tEMM-TRACKING-AREA-UPDATING-INITIATED\tTRACKING AREA UPDATE REQUEST sent\tTRACKING AREA UPDATE ACCEPT received\tTRACKING AREA UPDATE REJECT received\tStart T3411 or T3402 as described in subclause\u00a05.5.3.2.6\nT3440\t10s\tEMM-REGISTERED-INITIATED\tEMM-TRACKING-AREA-UPDATING-INITIATED\tEMM-DEREGISTERED-INITIATED\tEMM-SERVICE-REQUEST-INITIATED\tEMM-REGISTERED\tATTACH REJECT, DETACH REQUEST, TRACKING AREA UPDATE REJECT with any of the EMM cause #11, #12, #13, #14 or #15\tSERVICE REJECT received with any of the EMM cause #11, #12, #13 or #15\tTRACKING AREA UPDATE ACCEPT received after the UE sent TRACKING AREA UPDATE REQUEST in EMM-IDLE mode with no \"active\" flag\tSignalling connection released\tBearers have been set up\tRelease the signalling connection and proceed as described in subclause\u00a05.3.1.2\nT3442\tNOTE\u00a04\tEMM-REGISTERED\tSERVICE REJECT received with EMM cause #39 \"CS domain temporarily not available\"\tTRACKING AREA UPDATE REQUEST sent\tNone\nNOTE\u00a01:\tThe default value of this timer is used if the network does not indicate another value in an EMM signalling procedure.\tNOTE\u00a02:\tThe value of this timer is provided by the network operator during the attach and tracking area updating procedures.\tNOTE\u00a03:\tThe value of this timer may be provided by the network in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. The default value of this timer is identical to the value of T3412.\tNOTE\u00a04:\tThe value of this timer is provided by the network operator when a service request for CS fallback is rejected by the network with EMM cause #39 \"CS domain temporarily not available\".\n\nTable 10.2.2: EPS mobility management timers \u2013 network side\nTIMER NUM.\tTIMER VALUE\tSTATE \tCAUSE OF START\tNORMAL STOP\tON THE\n1st, 2nd, 3rd, 4th EXPIRY (NOTE\u00a01)\nT3413\tNOTE\u00a02\tEMM-REGISTERED\tPaging procedure for EPS services initiated\tPaging procedure for EPS services completed\tNetwork dependent\nT3422\t6s\tEMM-DEREGISTERED-INITIATED\tDETACH REQUEST sent\tDETACH ACCEPT received\tRetransmission of DETACH REQUEST\nT3450\t6s\tEMM-COMMON-PROC-INIT\tATTACH ACCEPT sent\t\tTRACKING AREA UPDATE ACCEPT sent with GUTI\t\tTRACKING AREA UPDATE ACCEPT sent with TMSI\t\tGUTI REALLOCATION COMMAND sent\tATTACH COMPLETE received\tTRACKING AREA UPDATE COMPLETE received\tGUTI REALLOCATION COMPLETE received\tRetransmission of the same message type, i.e. ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT or GUTI REALLOCATION COMMAND\nT3460\t6s\tEMM-COMMON-PROC-INIT\tAUTHENTICATION REQUEST sent\t\tSECURITY MODE COMMAND sent\tAUTHENTICATION RESPONSE received\tAUTHENTICATION FAILURE received\tSECURITY MODE COMPLETE received\tSECURITY MODE REJECT received\tRetransmission of the same message type, i.e. AUTHENTICATION REQUEST\tor SECURITY MODE COMMAND\nT3470\t6s\tEMM-COMMON-PROC-INIT\tIDENTITY REQUEST sent\tIDENTITY RESPONSE received\tRetransmission of IDENTITY REQUEST\nMobile reachable\tDefault 4 min greater than T3412\tAll except EMM-DEREGISTERED\tEntering EMM-IDLE mode\tNAS signalling connection established\tNetwork dependent, but typically paging is halted on 1st expiry\nImplicit detach timer\tNOTE 3\tAll except EMM-DEREGISTERED\tThe mobile reachable timer expires while the network is in EMM-IDLE mode \tNAS signalling connection established\tImplicitly detach the UE on 1st expiry\nNOTE\u00a01:\tTypically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding procedure description.\tNOTE\u00a02:\tThe value of this timer is network dependent.\tNOTE\u00a03:\tThe value of this timer is network dependent. If ISR is activated, the default value of this timer is 4 minutes greater than T3423. \n\n\n------------------------------- END OF CHANGE -------------------------------\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWith C1-082816, CT1 agreed that the value for T3412 would be optionally sent in the TRACKING AREA UPDATE ACCEPT message, in order to keep the TRACKING AREA UPDATE ACCEPT message as short as possible. At the same time, there is no default value defined in the UE for T3412, so there is no mean for the UE to use a pre-defined value if the network does not provide it. There are at least two use cases when the first procedure the UE performs in LTE in a given network is a tracking area update procedure: 1/ the UE reselects a different PLMN in LTE while it was EPS attached,2/ the UE first powers on in 2G/3G, attaches to PS services (i.e. also EPS services), and then moves to E-UTRAN. For these cases, the network shall send a value for T3412 in the TRACKING AREA UPDATE ACCEPT message. However, this is not clearly specified in TS 24.301, and if the network simply does not send a value, the UE will have to use the stored value. What will happen next is: For 1/ the UE might use a value defined by another operator, which could lead to the UE being implicitly detached if the old and new networks use different value,For 2/ the UE behaviour is unpredictable as the UE has no value for T3412.  Also, as per subclause 5.3.5 from TS 24.301: \u201cThe value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.\u201d So in case a new TAI list is provided to the UE, the value for T3412 shall also be provided. As can be seen from the above, there are several situations when the network shall provide a value for T3412 in TRACKING AREA UPDATE ACCEPT message. However, this is not clearly specified in TS 24.301 and consequently there is the risk that the UE is not provided any value while a new value is expected from UE side.One option would be to mandate the IE for T3412 in the TRACKING AREA UPDATE ACCEPT message. However, this change is not backwards compatible, and consequently impossible at this stage of Rel-8. Also, this change may not be suitable for networks without overlapping GERAN or UTRAN coverage (refering to the scenario when the UE first powers on in 2G/3G, attaches to PS services (i.e. also EPS services), and then moves to E-UTRAN).\n\n>>> SUMMARY OF CHANGE\nIt is proposed to add a default value for T3412, which is to be used in the UE when the UE does not have a value from previous attach or tracking area updating procedure and the UE receives a TRACKING AREA UPDATE ACCEPT message without a value for T3412. In case the network does not provide a value for T3412 in the TRACKING AREA UPDATE ACCEPT message and the network previously indicated a value for timer T3412 to the UE which is smaller than the default value of T3412, the network has to use a value for the mobile reachable timer which is longer than the default value of T3412.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE behaviour is unpredictable if the network does not provide a value for T3412 while the UE does not have a stored value. This unpredictable behaviour could lead to the network implicitly detaching the UE for EPS services (and non-EPS services as a consequence for a CS fallback UE) after some time. If the network uses a value for T3412 which is smaller than the default value, there is the risk that the UE does not have received the value for T3412 and the network implicitly detaches the UE."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n4.7.1\tContents of 5GMM messages\n<<< TEXT SKIPPED >>>\n\u2013\tRegistration request\nTable 4.7.1-6: REGISTRATION REQUEST\nDerivation Path: 24.501 clause 8.2.6\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration request message identity\t\u20180100 0001\u2019B\n5GS registration type\n  5GS registration type value\t\u2018001\u2019B\tInitial registration\n\t\u2018010\u2019B\t\tMOBILITY\n\t\u2018011\u2019B\t\tPERIODIC\n\t\u2018100\u2019B\t\tEMERGENCY\n  SMS requested\tPresent but contents not checked\n  FOR\tPresent but contents not checked\n  NG-RAN-RCU\t\u20180\u2019B\tNG-RAN radio capability update not needed\nngKSI\tPresent but contents not checked\nSpare half octet\t'0000'B\n5GS mobile identity\tPresent but contents not checked\nNon-current native NAS key set identifier\tIf present: contents not checked\n5GMM capability\tIf present: contents not checked\nUE security capability\tIf present: contents not checked\nRequested NSSAI\tIf present: contents not checked\nLast visited registered TAI\tIf present: contents not checked\nS1 UE network capability\tIf present: contents not checked\nUplink data status\tIf present: contents not checked\nPDU session status\tIf present: contents not checked\nMICO indication\tIf present: contents not checked\nUE status\tIf present: contents not checked\nAdditional GUTI\tIf present: contents not checked\nAllowed PDU session status\tIf present: contents not checked\nUE's usage setting\tIf present: contents not checked\n\nRequested DRX parameters\tIf present: contents not checked\nEPS NAS message container\tIf present: contents not checked\nLADN indication\tIf present: contents not checked\nPayload container\tIf present: contents not checked\n\nCondition\tExplanation \nINITIAL\tInitial registration\nMOBILITY\tMobility registration updating\nPERIODIC\tPeriodic registration updating\nEMERGENCY\tEmergency registration\n\nNOTE:\tThis message is sent without integrity protection before NAS security mode control procedure has been successfully completed and sent within SECURITY PROTECTED 5GS NAS MESSAGE message after NAS security mode control procedure has been successfully completed. \nEditor\u2019s Note: The value of FOR is FFS.\n\u2013\tRegistration accept\nTable 4.7.1-7: REGISTRATION ACCEPT\nDerivation Path: 24.501 clause 8.2.7\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration accept message identity\t\u20180100 0010\u2019B\n5GS registration result\n  5GS registration result value\t\u2018001\u2019B\t3GPP access\n  SMS allowed\t\u20180\u2019B\tSMS over NAS not allowed\n5G-GUTI\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\nEquivalent PLMNs\tNot Present\nTAI list\n  Length of tracking area identity list contents\t'0000 0111'B\t7 octets\n  Partial tracking area identity list 1\n    Number of elements\t'0 0000'B\t1 element\n    Type of list\t'00'B\tlist of TACs belonging to one PLMN, with non-consecutive TAC values\n    MCC\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\n    MNC\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\n    TAC 1\tSee Table 4.4.2-3\tFor 5GC NAS test cases see Table 6.3.2.2-1\nAllowed NSSAI\n  S-NSSAI\n    Length of S-NSSAI contents\t\u20180000 0001\u2019B\tSST\n    SST\t\u20180000 0001\u2019B\tSST value 1 (eMBB)\nRejected NSSAI\tNot Present\nConfigured NSSAI\tNot Present\n5GS network feature support\nPDU session status\tNot Present\t\tINITIAL\n\tFFS\t\tFFS\nPDU session reactivation result\tNot Present\nPDU session reactivation result error cause\tNot Present\nLADN information\tNot Present\nMICO indication\tNot Present\nService area list\tNot Present\nT3512 value\t\t\tINITIAL\n  Timer value\t'0 0000'B\n  Unit\t'111'B\tvalue indicates that the timer is deactivated\nT3512 value\tNot Present\nNon-3GPP de-registration timer value\tNot Present\nT3502 value\tNot Present\nEmergency number list\tNot Present\nExtended emergency number list\tNot Present\nSOR Transparent container\tNot Present\nEAP message\tNot Present\n\nCondition\tExplanation \nINITIAL\tInitial registration\n\nNOTE:\tThis message is always sent within SECURITY PROTECTED 5GS NAS MESSAGE message.\n\u2013\tRegistration complete\nTable 4.7.1-8: REGISTRATION COMPLETE\nDerivation Path: 24.501 clause 8.2.8\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration complete message identity\t\u20180100 0011\u2019B\nSOR transparent container\tIf present: contents not checked\n\nCondition\tExplanation \n\nNOTE:\tThis message is always sent within SECURITY PROTECTED 5GS NAS MESSAGE message.\n\u2013\tRegistration reject\nTable 4.7.1-9: REGISTRATION REJECT\nDerivation Path: 24.501 clause 8.2.9\nInformation Element\tValue/remark\tComment\tCondition\nExtended protocol discriminator\t\u20180111 1110\u2019B\t5GS mobility management messages\nSecurity header type\t\u20190000\u2019B\tPlain 5GS NAS message, not security protected\nSpare half octet\t'0000'B\nRegistration reject message identity\t\u20180100 0100\u2019B\n5GMM cause\tSet according to specific message content\nT3346 value\tNot Present\nT3502 value\tNot Present\nEAP message\tNot Present\n\nCondition\tExplanation \n\nNOTE:\tThe security protection of this message is the same as the previous REGISTRATION REQUEST message.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications.\n\n>>> SUMMARY OF CHANGE\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications.\n\n>>> CONSEQUENCES IF NOT REVISED\nCT plenary recently approved a new version of TS 24.501, V15.2.0. The updates introduced in this version have impact on the definition of default messages and TS 38.508-1 have to be updated accordingly.The Registration 5GMM messages have been updated according to the latest version of the core specifications.Updates related to initial NAS message protection according to the solution recently agreed by CT have been made.The message contents will not be according to core specifications."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n4.2.1.3\tDynamic services interactions handling\n4.2.1.3.1\tService information exchanged between Application Servers\nTo avoid conflicting interactions between services they execute, different ASs involved in the same IMS session (within an operator network or across networks) shall be able to exchange the following service interaction information:\n-\tindication of services that have been performed, and\n-\toptionally, additional indication of services that should be further avoided.\n4.2.1.3.2\tHandling by the Application Server\nIf an AS provides one or more services, the AS may include service interaction information in SIP signalling, identifying the service that it has executed.\nIf an AS provides one or more services which are known to be negatively impacted by the subsequent execution of a service by another AS, the AS may include, in addition to the an indication of the services executed, service interaction information in SIP signalling, indicating the services that should be avoided.\nAn AS receiving a SIP message containing an indication\n-\tthat a service has been executed previously, and/or\n-\tthat a service should be avoided,\nmay, depending on local policy, take this information into account. The service interaction information shall be such that an AS receiving this information should not be able to misinterpret the information and shall ignore such information that it does not recognize.\nThe IBCF shall remove any service interaction information not in compliance with service level agreements with other domains.\nService interaction information for standardized services shall be standardized but there shall also be the ability to exchange globally unique service information for non-standardized services.\n\n\n\n* * * End of Changes * * * *\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the last meeting, it was agreed that service interaction information is added to avoid the service conflict and \"The IBCF shall remove any service interaction information not in compliance with service level agreements with other domains.\" The service interaction information is added by network entity and just used in the core network. It can not be dilivered to UE. But in the current specification, IBCF just cover the Inter-PLMN case and only delete the service interaction information not in compliance with service level agreements with other domains.So how to delete this kind of information before the signalling is delivered to UE is not addressed.There are two possible points to delete this IE. One is P-CSCF. The P-CSCF can do it before it sends signalling to the UE. But the drawback is that it requires the P-CSCF can be aware of service.Another is S-CSCF. The S-CSCF can do it when it sends signalling to the UE via P-CSCF. Compare these two check points, the S-CSCF is better to do it.\n\n>>> SUMMARY OF CHANGE\nBefore sends the signalling to the UE via P-CSCF, the S-CSCF shall remove all the service interaction information.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe terminating UE or originating UE will know what sevices were performed for the remote UE. It may expose the user private information."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n***** Next change *****\n4.4.4.7\tLocation updating not accepted by the network\nIf the location updating cannot be accepted, the network sends a LOCATION UPDATING REJECT message to the mobile station. The mobile station receiving a LOCATION UPDATING REJECT message containing a reject cause other than MM cause value #25 or the message is integrity protected, shall stop the timer T3210, store the reject cause, start the timer T3240, enter state LOCATION UPDATING REJECTED, await the release of the RR connection triggered by the network, and for all causes except #12, #15, #22 and #25 deletes the list of \"equivalent PLMNs\".\nIf the LOCATION UPDATING REJECT message containing the MM cause value #25 was received without integrity protection, then the MS shall discard the message.\nIf the location updating is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 \"congestion\" and assign a back-off timer T3246 (see 3GPP\u00a0TS\u00a023.012\u00a0[140]).\n\nUpon the release of the RR connection, the mobile station shall take the following actions depending on the stored reject cause:\n# 2:\t(IMSI unknown in HLR);\n# 3:\t(Illegal MS); or\n# 6:\t(Illegal ME).\n\tThe mobile station shall set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2), and delete any TMSI, stored LAI and ciphering key sequence number and shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed.\n# 11:\t(PLMN not allowed);\n\tThe mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). The mobile station shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe MS shall perform a PLMN selection when back to the MM IDLE state according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to performing a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n# 12:\t(Location Area not allowed);\n\tThe mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). \n \tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\". \n \tThe MS shall perform a cell selection when back to the MM IDLE state according to 3GPP TS\u00a043.022 [82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a01:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n# 13:\t(Roaming not allowed in this location area).\n \tThe mobile station shall reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2). \n \tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\".\n \tThe mobile station shall perform a PLMN selection instead of a cell selection when back to the MM IDLE state according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to performing a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n# 15:\t(No Suitable Cells In Location Area).\n \tThe mobile station shall reset the location update attempt counter, set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2).\n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\".\n\tThe mobile station shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a02:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n# 22:\t(Congestion).\n\tIf the T3246 value IE is present in the LOCATION UPDATING REJECT message and the value indicates that this timer is neither zero nor deactivated, the mobile station shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.4.4.9.\n\tThe mobile station shall abort the location updating procedure, reset the location update attempt counter, set the MM update status to U2 NOT UPDATED and change to state MM IDLE sub-state ATTEMPTING TO UPDATE.\n\tThe MS shall stop timer T3246 if it is running.\n\tIf the LOCATION UPDATING REJECT message is integrity protected, the mobile station shall start timer T3246 with the value provided in the T3246 value IE.\n\tIf the LOCATION UPDATING REJECT message is not integrity protected, the mobile station shall start timer T3246 with a random value from the default range specified in table\u00a011.1.\n\tThe mobile station stays in the current serving cell and applies the normal cell reselection process. The MM connection establishment is started, if still necessary, when timer T3246 expires or is stopped.\n# 25:\t(Not authorized for this CSG ).\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.4.4.9.\n\tThe MS shall reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause\u00a04.1.2.2).\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP TS 23.122 [14] subclause\u00a03.1A.\n\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nOther values are considered as abnormal cases and the specification of the mobile station behaviour in those cases is given in subclause\u00a04.4.4.9.\n***** Next change *****\n4.5.1.1\tMM connection establishment initiated by the mobile station\nUpon request of a CM entity to establish an MM connection the MM sublayer first decides whether to accept, delay, or reject this request:\n-\tAn MM connection establishment may only be initiated by the mobile station when the following conditions are fulfilled:\n-\tIts update status is UPDATED.\n-\tThe MM sublayer is in one of the states MM IDLE, RR CONNECTION RELEASE NOT ALLOWED or MM connection active but not in MM connection active (Group call).\n\tAn exception from this general rule exists for emergency calls (see subclause\u00a04.5.1.5). A further exception is defined in the following clause.\n-\tIf an MM specific procedure is running at the time the request from the CM sublayer is received, and the LOCATION UPDATING REQUEST message has been sent, the request will either be rejected or delayed, depending on implementation, until the MM specific procedure is finished and, provided that the network has not sent a \"follow-on proceed\" indication, the RR connection is released. If the LOCATION UPDATING REQUEST message has not been sent, the mobile station may include a \"follow-on request\" indicator in the message. The mobile station shall then delay the request until the MM specific procedure is completed, when it may be given the opportunity by the network to use the RR connection: see subclause\u00a04.4.4.6.\nIn order to establish an MM connection, the mobile station proceeds as follows:\na)\tIf no RR connection exists, the MM sublayer requests the RR sublayer to establish an RR connection and enters MM sublayer state WAIT FOR RR CONNECTION (MM CONNECTION). This request contains an establishment cause and a CM SERVICE REQUEST message. When the establishment of an RR connection is indicated by the RR sublayer, the MM sublayer of the mobile station starts timer T3230, gives an indication to the CM entity that requested the MM connection establishment, and enters MM sublayer state WAIT FOR OUTGOING MM CONNECTION.\nb)\tIf an RR connection is available, the MM sublayer of the mobile station sends a CM SERVICE REQUEST message to the network, starts timer T3230, stops and resets timer T3241, gives an indication to the CM entity that requested the MM connection establishment, and enters:\n-\tMM sublayer state WAIT FOR OUTGOING MM CONNECTION, if no MM connection is active;\n-\tMM sublayer state WAIT FOR ADDITIONAL OUTGOING MM CONNECTION, if at least one MM connection is active;\n-\tIf an RR connection exists but the mobile station is in the state WAIT FOR NETWORK COMMAND then any requests from the CM layer that are received will either be rejected or delayed until this state is left.\nc)\tOnly applicable for mobile stations supporting VGCS talking:\n\tIf a mobile station which is in the MM sublayer state MM IDLE, service state RECEIVING GROUP CALL (NORMAL SERVICE), receives a request from the GCC sublayer to perform an uplink access, the MM sublayer requests the RR sublayer to perform an uplink access procedure and enters MM sublayer state WAIT FOR RR CONNECTION (GROUP TRANSMIT MODE).\n\tWhen a successful uplink access is indicated by the RR sublayer, the MM sublayer of the mobile station gives an indication to the GCC sublayer and enters MM sublayer state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE).\n\tWhen an uplink access reject is indicated by the RR sublayer, the MM sublayer of the mobile station gives an indication to the GCC sublayer and enters the MM sublayer state MM IDLE, service state RECEIVING GROUP CALL (NORMAL SERVICE).\n\tIn the network, if an uplink access procedure is performed, the RR sublayer in the network provides an indication to the MM sublayer together with the mobile subscriber identity received in the TALKER INDICATION message. The network shall then enter the MM sublayer state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE).\nd)\tWhen the MS is IMSI attached for CS services via EMM combined procedures, as described in 3GPP\u00a0TS\u00a024.301\u00a0[120], and the MS is camping on an E-UTRAN cell, and if T3246 is not running, the MM sublayer requests EMM to initiate a service request procedure for CS fallback. The MM connection establishment is delayed until the MS changes to a GERAN or UTRAN cell.\n\tIf the MS enters a GERAN or UTRAN cell, then the MS shall initiate the MM connection establishment and send a CM SERVICE REQUEST message. The MS shall include the Additional update parameters information element indicating \"CS fallback mobile originating call\". If the MS determines that it is in a different location area than the stored location area, the MS shall first initiate a normal location updating procedure regardless of Network Mode of Operation. If the location area of the current cell is not available, the MS may initiate a normal location updating procedure directly. The MM connection establishment is delayed until successful completion of the normal location updating procedure. Additionally the MS performs routing area updating as specified in subclause\u00a04.7.5. If the normal location updating procedure is initiated, the MS shall indicate the \"follow-on request pending\", shall include the Additional update parameters information element indicating\"CS fallback mobile originating call\", and shall not include the MS network feature support information element in the LOCATION UPDATING REQUEST message.\nIn case a, b and d, the CM SERVICE REQUEST message contains the:\n-\tmobile identity according to subclause\u00a010.5.1.4;\n-\tmobile station classmark 2;\n-\tciphering key sequence number; and\n-\tCM service type identifying the requested type of transaction (e.g. mobile originating call establishment, emergency call establishment, short message service, supplementary service activation, location services).\nA MS supporting eMLPP may optionally include a priority level in the CM SERVICE REQUEST message.\nFor MM connection establishment involving a shared GERAN network in A/Gb mode, if the MS is a GERAN network sharing supporting MS, the chosen PLMN identity shall be indicated to the GERAN in the CM SERVICE REQUEST message using the Skip Indicator IE as specified in subclause\u00a010.3.1.\nA collision may occur when a CM layer message is received by the mobile station in MM sublayer state WAIT FOR OUTGOING MM CONNECTION or in WAIT FOR ADDITIONAL OUTGOING MM CONNECTION. In this case the MM sublayer in the MS shall establish a new MM connection for the incoming CM message as specified in subclause\u00a04.5.1.3.\nUpon receiving a CM SERVICE REQUEST message, the network shall analyse its content. The type of semantic analysis may depend on other on going MM connection(s). Depending on the type of request and the current status of the RR connection, the network may start any of the MM common procedures and RR procedures.\nIn A/Gb mode, the network may initiate the classmark interrogation procedure, for example, to obtain further information on the mobile station's encryption capabilities.\nThe identification procedure (see subclause\u00a04.3.3) may be invoked for instance if a TMSI provided by the mobile station is not recognized.\nThe network may invoke the authentication procedure (see subclause\u00a04.3.2) depending on the CM service type.\nIn A/Gb mode, the network decides also if the ciphering mode setting procedure shall be invoked (see subclause\u00a03.4.7 in 3GPP\u00a0TS\u00a044.018\u00a0[84]).\nIn Iu mode, the network decides also if the security mode control procedure shall be invoked (see 3GPP\u00a0TS\u00a025.331\u00a0[23c] and 3GPP\u00a0TS\u00a044.118\u00a0[111]).\nNOTE\u00a01:\tIf the CM_SERVICE_REQUEST message contains a priority level the network may use this to perform queuing and pre-emption as defined in 3GPP\u00a0TS\u00a023.067\u00a0[88].\nIn A/Gb mode, the MS shall consider the MM connection establishment to be completed when:\n-\treceiving an indication from the RR sublayer that the ciphering mode setting procedure is completed in MM sublayer state WAIT FOR OUTGOING MM CONNECTION, or\n-\treceiving a CM SERVICE ACCEPT message.\nIn Iu mode, the MS shall consider the MM connection establishment to be completed when\n-\treceiving an indication from the RR sublayer that the security mode control procedure is completed in MM sublayer state WAIT FOR OUTGOING MM CONNECTION; or\n-\treceiving a CM SERVICE ACCEPT message.\nThe procedures in subclause\u00a04.1.1.1.1 shall always have precedence over this subclause.\nIn Iu mode, during a MM connection establishment for all services, except for emergency call (see subclause\u00a04.1.1.1.1), the security mode control procedure with activation of integrity protection shall be invoked by the network unless integrity protection is already started (see subclause\u00a04.1.1.1.1).\nThe MM connection establishment is completed, timer T3230 shall be stopped, the CM entity that requested the MM connection shall be informed, and MM sublayer state MM CONNECTION ACTIVE is entered. The MM connection is considered to be active.\nIf the service request cannot be accepted, the network returns a CM SERVICE REJECT message to the mobile station.\nThe reject cause information element (see subclause\u00a010.5.3.6 and annex G) indicates the reason for rejection. The following cause values may apply:\n#4:\tIMSI unknown in VLR\n#6:\tIllegal ME\n#17:\tNetwork failure\n#22:\tCongestion\n#25\tNot authorized for this CSG\n#32:\tService option not supported\n#33:\tRequested service option not subscribed\n#34:\tService option temporarily out of order\nIf the service request is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 \"congestion\" and assign a back-off timer T3246 (see 3GPP\u00a0TS\u00a023.012\u00a0[140]).\nIf no other MM connection is active, the network may start the RR connection release (see subclause\u00a03.5 of 3GPP\u00a0TS\u00a044.018\u00a0[84] (A/Gb mode only), 3GPP\u00a0TS\u00a025.331\u00a0[23c] (UTRAN Iu mode only), or in 3GPP\u00a0TS\u00a044.118\u00a0[111] (GERAN Iu mode only) when the CM SERVICE REJECT message is sent.\n\nIf a CM SERVICE REJECT message is received by the mobile station, timer T3230 shall be stopped, the requesting CM sublayer entity informed. Then the mobile station shall proceed as follows:\n-\tIf the cause value is not #4 or #6 or #25 received from a CSG cell and the MS is in UTRAN Iu mode, the MM sublayer returns to the previous state (the state where the request was received). Other MM connections shall not be affected by the CM SERVICE REJECT message.\n-\tIf cause value #4 is received, the mobile station aborts any MM connection, deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to NOT UPDATED (and stores it in the SIM/USIM according to subclause\u00a04.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. If subsequently the RR connection is released or aborted, this will force the mobile station to initiate a normal location updating). Whether the CM request shall be memorized during the location updating procedure, is a choice of implementation.\n-\tIf cause value #6 is received, the mobile station aborts any MM connection, deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to ROAMING NOT ALLOWED (and stores it in the SIM/USIM according to subclause\u00a04.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. The mobile station shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed.\n-\tIf cause value #22 is received, the T3246 value IE is present in the CM SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall check whether the CM SERVICE REJECT message with cause #22 is integrity protected and shall stop timer T3246 if it is running. If the message is integrity protected, the MS shall start timer T3246 with the value provided in the T3246 value IE. Otherwise, the MS shall start timer T3246 with a random value from the default range specified in table\u00a011.1.The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3246 expires or is stopped.\n\tIf cause value #22 is received, the T3246 value IE is not present in the CM SERVICE REJECT message or if the T3246 value IE the value indicates that this timer is zero or deactivated, the same actions as on timer expiry in subclause\u00a04.5.1.2 shall be taken by the mobile station.\n-\tIf cause value #25 is received from a CSG cell and the MS is in UTRAN Iu mode, the MS shall check whether the CM SERVICE REJECT message with cause #25 is integrity protected. If the message is not integrity protected, the MS shall discard the message. Otherwise, the MS shall abort any MM connection, remove the entry corresponding to the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message from the Allowed CSG list if the CSG ID and associated PLMN identity are contained in the Allowed CSG list, and enter the MM sublayer state WAIT FOR NETWORK COMMAND. If the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message is contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A. Subsequently, after the RR connection is released or aborted, the MS applies normal cell reselection process.\n\tIf cause value #25 is received and the cell is not a CSG cell or the MS is not in UTRAN Iu mode, the MS shall discard the CM SERVICE REJECT message.\n***** Next change *****\n4.7.3.1.4\tGPRS attach not accepted by the network\nIf the attach request cannot be accepted by the network, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3310 and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\".\nIf the ATTACH REJECT message containing GMM cause value cause #25 was received without integrity protection, then the MS shall discard the message.\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\n\nThe MS shall then take one of the following actions depending upon the reject cause:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed.\n\tIf the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED.\nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when attach procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a03:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) , shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection.\nA GPRS MS operating in MS operation mode A or B in network operation mode II, is still IMSI attached for CS services in the network. \nAs an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:\n-\tThe MS may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology\" list; \n-\tOn the \"Operator Controlled PLMN Selector with Access Technology\" list;\n-\tOn the \"PLMN Selector\" list for an MS using a SIM/USIM without access technology information storage (i.e. the \"User Controlled PLMN Selector with Access Technology\" and the \"Operator Controlled PLMN Selector with Access Technology\" data files are not present); or\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.3.1.5.\n\tThe MS shall abort the attach procedure, reset the GPRS attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG);\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.3.1.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), reset the GPRS attach attempt counter and enter the state GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list stored in the MS, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause\u00a04.7.3.1.5.\n***** Next change *****\n4.7.3.2.4\tCombined GPRS attach not accepted by the network\nIf the attach request can neither be accepted by the network for GPRS nor for non-GPRS services, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3310, and for all causes except #12, #14, #15, #22 and #25 deletes the list of \"equivalent PLMNs\".\nIf the ATTACH REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\n\nThe MS shall then take one of the following actions depending upon the reject cause:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME), or\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED. The new MM state is MM IDLE.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. \nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9 for reject cause #8\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new GMM state is GMM-DEREGISTERED; the MM state is MM IDLE.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and changes to state GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \nThe MS shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a03:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for roaming\". \nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED. \nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology\";\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology\" list;\n-\tOn the \"PLMN Selector\" list for an MS using a SIM/USIM without access technology information storage (i.e. the \"User Controlled PLMN Selector with Access Technology\" and the \"Operator Controlled PLMN Selector with Access Technology\" data files are not present); or\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\nIf the MS does not perform a PLMN selection then a GPRS MS operating in MS operation mode A or B which is not yet IMSI attached for CS services in the network shall then perform an IMSI attach for non-GPRS services according to the conditions for the MM IMSI attach procedure (see subclause\u00a04.4.3).\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE. \nThe MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. \nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\n# 22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.3.1.5.\n\tThe MS shall abort the attach procedure, reset the GPRS attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the attach procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.3.2.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf the MS is IMSI attached for non-GPRS services, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause\u00a04.7.3.2.5. \n***** Next change *****\n4.7.5.1.4\tNormal and periodic routing area updating procedure not accepted by the network\nIf the routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS, which receives a ROUTING AREA UPDATE REJECT message with a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.\nIf the ROUTING AREA UPDATE REJECT message containing GMM cause value cause #25 was received without integrity protection, then the MS shall discard the message.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\n\nThe MS shall then take different actions depending on the received reject cause value:\n# 3\t\t(Illegal MS);\n# 6\t\t(Illegal ME);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\n\tIf the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a01:\tThe possibility to configure a MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.\n# 7\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a0.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs, and shall enter the GMM state GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\nNOTE\u00a03:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area procedure is rejected with the EMM cause with the same value.\n# 9\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, then\n-\ta GPRS MS operating in MS operation mode A in network operation mode I shall proceed with appropriate MM specific procedures. Additionally, the MS shall initiate a normal or combined GPRS attach procedure depending on whether it is in an ongoing circuit-switched transaction. If the MS is in an ongoing circuit-switched transaction, it shall initiate the appropriate MM specific procedure after the circuit-switched transaction has been released. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered;\n-\tif the update type is \"periodic updating\", a GPRS MS operating in MS operation mode B in network operation mode I shall proceed with appropriate MM specific procedures. Additionally, the MS shall initiate a combined GPRS attach procedure. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered;\n-\ta GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures. Additionally, a GPRS MS operating in MS operation mode A or B in network operation mode II shall initiate a GPRS attach procedure; and\n-\ta GPRS MS operating in MS operation mode A or B in network operation mode II which is not configured to use CS fallback and SMS over SGs, or SMS over SGs only, and a GPRS MS operating in MS operation mode C may subsequently, automatically initiate the GPRS attach procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tIf the update type is \"periodic updating\", a GPRS MS operating in MS operation mode B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.\n\tA GPRS MS operating in MS operation mode A in network operation mode I is detached for GPRS services. If no RR connection exists then the MS is also IMSI detached for the CS services.\n\tThe MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, then\n-\ta GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures;\n-\tregardless of the MS operation mode and the network operation mode, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s); and\n-\tadditionally, a GPRS MS operating in MS operation mode A in network operation mode I which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which is in an ongoing circuit-switched transaction shall initiate the appropriate MM specific procedure after the circuit-switched transaction has been released. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a04:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter, shall delete the list of equivalent PLMNs, and enter the state GMM-DEREGISTERED.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS\u00a044.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection.\nA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\nIf the update type is \"periodic updating\" a GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:\n-\tThe MS may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\nThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a06:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.1.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures.\n# 25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.1.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.1.5.\n***** Next change *****\n4.7.5.2.4\tCombined routing area updating not accepted by the network\nIf the combined routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS that receives a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330, and shall enter the state MM IDLE. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.\nIf the ROUTING AREA UPDATE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.\nIf the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\n\nThe MS shall then take different actions depending on the received reject cause:\n# 3\t\t\t(Illegal MS);\n# 6\t\t\t(Illegal ME), or\n# 8\t\t\t(GPRS services and non GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS and non GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9 for reject cause #8.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP TS 24.301 [120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services in the network, is still IMSI attached for CS services in the network.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, then\n-\ta GPRS MS operating in MS operation mode A or B shall proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered; and\n-\tthe MS may subsequently, automatically initiate the GPRS attach procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.\n\tThe MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nNOTE\u00a03:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP/MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, the MS shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number GPRS ciphering key sequence number, shall delete the list of equivalent PLMNs, and shall reset the routing area updating attempt counter and the location update attempt counter.\n\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall then perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\nThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\nThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\nThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure following the PLMN selection.\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 14\t(GPRS services not allowed in this PLMN);\nThe MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.\nThe MS shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\nA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.\nA GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.\nAs an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP TS\u00a023.122 [14].\nIf an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\nThe MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:\n-\tOn the \"User Controlled PLMN Selector with Access Technology \" or,\n-\tOn the \"Operator Controlled PLMN Selector with Access Technology \" list or,\n-\tA PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n\tThe MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n\tThe MS shall search for a suitable cell in another location area according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tThe MS shall indicate the Update type IE \"combined RA/LA updating with IMSI attach\" when performing the routing area updating procedure.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.5.2.5.\n\tThe MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer with the value provided in the T3346 value IE.\n\tIf the ROUTING AREA UPDATE REJECT message is not integrity protected, the ME shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.\n#25\t(Not authorized for this CSG)\n\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.5.2.5.\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a04.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\n\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.5.2.5.\n***** Next change *****\n4.7.13.4\tService request procedure not accepted by the network\nIf the Service request cannot be accepted, the network returns a SERVICE REJECT message to the mobile station.\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nAn MS that receives a SERVICE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall reset the service request attempt counter, shall stop the timer T3317.\nIf the SERVICE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.\n\nThe MS shall then take different actions depending on the received reject cause value:\n# 3\t\t\t(Illegal MS); or\n# 6\t\t\t(Illegal ME);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, it shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed.\n-\tA GPRS MS operating in MS operation mode A or B shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 7\t\t\t(GPRS services not allowed);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. \n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.\n\tA GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.\nNOTE\u00a01:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 8\t\t(GPRS services and non-GPRS services not allowed);\n\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a0.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.\n\tThe MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed.\nNOTE\u00a02:\tOptionally the MS starts the timer T3340 as described in subclause\u00a04.7.1.9.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 9\t\t\t(MS identity cannot be derived by the network);\n-\tThe MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause\u00a04.1.3.2), enter the state GMM-DEREGISTERED, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may subsequently, automatically initiate the GPRS attach procedure. \n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 10\t(Implicitly detached);\n-\tA GPRS MS operating in MS operation mode B in network operation mode I is IMSI detached for both GPRS and CS services.\n\tA GPRS MS operating in MS operation mode A in network operation mode I is detached for GPRS services.If no RR connection exists then the MS is also IMSI detached for the CS services.\n-\tThe MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the the service request procedure is rejected with the EMM cause with the same value.\nNOTE\u00a03:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\n# 11\t(PLMN not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and enter the state GMM-DEREGISTERED.\n-\tThe MS shall store the PLMN identity in the \"forbidden PLMN list\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tA GPRS MS operating in MS operation mode A shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP\u00a0TS\u00a023.122\u00a0[14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 12\t(Location area not allowed);\n-\tThe MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.\n-\tThe mobile station shall store the LAI in the list of \"forbidden location areas for regional provision of service\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a cell selection according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\nNOTE\u00a04:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 13\t(Roaming not allowed in this location area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall perform a PLMN selection according to 3GPP TS\u00a023.122\u00a0[14].\n\tAn MS in GAN mode shall request a PLMN list in GAN (see 3GPP\u00a0TS\u00a044.318\u00a0[76b]) prior to perform a PLMN selection from this list according to 3GPP TS\u00a023.122 [14].\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 15\t(No Suitable Cells In Location Area);\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\tThe MS shall store the LAI in the list of \"forbidden location areas for roaming\".\nThe MS shall start timer T3340 as described in subclause\u00a04.7.1.9.\n-\tIf no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:\n-\tIf the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell in another location area or a tracking area according to 3GPP TS\u00a043.022\u00a0[82] and 3GPP TS\u00a025.304\u00a0[98] or 3GPP\u00a0TS\u00a036.304\u00a0[121].\nNOTE\u00a05:\tThe cell selection procedure is not applicable for an MS in GAN mode.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause\u00a04.7.13.5.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall abort the service request procedure and enter state GMM-REGISTERED, and stop timer T3317 if still running.\n\tThe MS shall stop timer T3346 if it is running.\n\tIf the SERVICE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the SERVICE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table\u00a011.3a.\n\tThe MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3346 expires or is stopped.\n\tA GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.\n\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 25\t(Not authorized for this CSG)\n-\tCause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause\u00a04.7.13.5.\n-\tThe MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a04.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.\n-\t If the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n-\tIf the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP\u00a0TS\u00a023.122\u00a0[14] subclause\u00a03.1A.\nThe MS shall start timer\u00a0T3340 as described in subclause\u00a04.7.1.9.\nIf the MS is IMSI attached for non-GPRS services, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.\n-\tThe MS shall search for a suitable cell according to 3GPP\u00a0TS\u00a043.022\u00a0[82] and 3GPP\u00a0TS\u00a025.304\u00a0[98].\n-\tIf S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[120] for the case when the service request procedure is rejected with the EMM cause with the same value.\n# 40\t(No PDP context activated)\n-\tThe MS shall deactivate locally all active PDP and MBMS contexts and the MS shall enter the state GMM-REGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS may also perform the procedures needed in order to activate any previously active multicast service(s).\nNOTE\u00a06:\tIn some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.\nOther values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause\u00a04.7.13.5.\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nPresent specification mandates the MS to accept (G)MM reject messages even if received non-integrity protected (see sub-clause 4.1.1.1 on \"Integrity checking of signalling messages in the mobile station (Iu Mode only)\").The use of (G)MM reject message without integrity protection can be exploited by an attacker in order to perform denial of service (DoS) attack. This attack would deliver to the MS a non-integrity protected (G)MM reject message. As described in C1-154300, a persistent DoS attack can take effect when reject causes #2, #3, #6, #7, #8 and #22 are used. Also, as described in C1-154300, two scenarios need to be considered:when the MS has a valid UMTS security context; andwhen the MS has no valid UMTS security context.This CR looks into the case (1) in which the messages to take into consideration are; LOCATION UPDATING REJECT, CM SERVICE REJECT, ATTACH REJECT, ROUTING AREA UPDATE REJECT, and SERVICE REJECT.For the case when a valid UMTS security context exists, the use of integrity protection is an AS responsibility though the supervision that integrity protection is activated is the responsibility of the NAS in the MS (MM and GMM layers). Hence, the AS provides an indication (per domain) to NAS on whether integrity protection is activated.The receipt of a reject message without integrity protection should be considered abnormal, and therefore a potential DoS attack. For this case, it is proposed to follow the principle of allowing the UE to obtain service as soon as possible in a genuine cell rather than stopping the UE to get service. Additionally, the solution should prevent the MS from returning to the so-called fake cell(s) and avoid potential ping ponging. It is therefore proposed to follow the existing behaviour for the reject cause value #15 (No suitable cells in location area) and add an implementation specific timer to erase the list of \"forbidden location areas for roaming\" within a 15-30m as the current handling is not optimal for the case of DoS attack. Note that the current handling is that the MS erases the list when switched off or when the UICC containing the USIM is removed, and periodically (with a period in the range 12 to 24 hours). This period of 12-24h is considered too long. One can wonder whether the MS needs to erase \u201cthe whole\u201d list or only the LAI which was added. It seems more reasonable to delete only the LAI upon expiry of the timer. Hence, operator\u2019s indicated forbidden TAIs are kept.\n\n>>> SUMMARY OF CHANGE\nWhen the MS receives a LOCATION UPDATING REJECT, CM SERVICE REJECT, ATTACH REJECT, ROUTING AREA UPDATE REJECT, or SERVICE REJECT message with cause #2, #3, #6, #7, #8, #11, or #22 without integrity protection and a valid UMTS security context exists, the MS follows similar behaviour as existing #15 (No suitable cells in location/routing area) so that the MS adds the current LAI in in the list of \"forbidden location areas for roaming\", an implementation specific timer is started with a random value uniformly drawn from the range between 15 minutes to 30 minutes, if it\u2019s not running for the current LAI. The MS searches for a suitable cell in another LA or TA in the same PLMN (a MS supporting S1 mode may move to E-UTRA). At expirty of the implementation specific timer, the MS erases the associated LAI from the list of \"forbidden location areas for roaming\".\n\n>>> CONSEQUENCES IF NOT REVISED\nThe posibility for mounting a DoS attack against MS through the use of reject cause values within non-integrity protected (G)MM messages remains. This can lead to undesirable effects, e.g., locking the user out from both CS and PS services."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n////////////////////////////////////////////////////////////////////////skip unrelated text////////////////////////////////////////////////////////////////////////\n9.3.1.10\tServed Cell Information\nThis IE contains cell configuration information of a cell in the gNB-DU.\nIE/Group Name\tPresence\tRange\tIE type and reference\tSemantics description\tCriticality\tAssigned Criticality\nNR CGI\tM\t\t9.3.1.12\t\t-\nNR PCI\tM\t\tINTEGER (0..1007)\tPhysical Cell ID\t-\n5GS TAC\tO\t\t9.3.1.29\t5GS Tracking Area Code\t-\nConfigured EPS TAC\tO\t\t9.3.1.29a\t\t-\nServed PLMNs\t\t1..<maxnoofBPLMNs>\t\tBroadcast PLMNs in SIB1 associated to the NR Cell Identity in the NR CGI IE.\t-\n>PLMN Identity\tM\t\t9.3.1.14\t\t-\n>TAI Slice Support List\tO\t\tSlice Support List\t9.3.1.37\tSupported S-NSSAIs per TA. \tYES\tignore\nCHOICE NR-Mode-Info \tM\t\t\t\t-\n>FDD\t\t\t\t\t-\n>>FDD Info\t\t1\t\t\t-\n>>>UL FreqInfo\tM\t\tNR Frequency Info\t9.3.1.17\t\t-\n>>>DL FreqInfo\tM\t\tNR Frequency Info\t9.3.1.17\t\t-\n>>>UL Transmission Bandwidth\tM\t\tTransmission Bandwidth\t9.3.1.15\t\t-\n>>>DL Transmission Bandwidth\tM\t\tTransmission Bandwidth\t9.3.1.15\t\t-\n>TDD\t\t\t\t\t-\n>>TDD Info\t\t1\t\t\t-\n>>> NR FreqInfo\tM\t\tNR Frequency Info\t9.3.1.17\t\t-\n>>> Transmission Bandwidth\tM\t\tTransmission Bandwidth\t9.3.1.15\t\t-\nMeasurement Timing Configuration\tM\t\tOCTET STRING\tContains the MeasurementTimingConfiguration inter-node message defined in TS 38.331 [8].\t-\nRANAC\tO\t\tRAN Area Code\t9.3.1.57\t\tYES\tignore\nExtended Served PLMNs List\t\t0..1\t\tThis is included if more than 6 Served PLMNs is to be signalled.\tYES\tignore\n>Extended Served PLMNs Item\t\t1 ..<maxnoofExtendedBPLMNs>\t\t\t-\n>>PLMN Identity\tM\t\t9.3.1.14\t\t-\n>>TAI Slice Support List\tO\t\tSlice Support List\t9.3.1.37\tSupported S-NSSAIs per TA. \t-\nCell Direction\tO\t\t9.3.1.78\t\tYES\tignore\nCell Type \tO\t\t9.3.1.87\t\tYES\tignore\nBroadcast PLMN Identity Info List\t\t0..<maxnoofBPLMNsNR>\t\tThis IE corresponds to the PLMN-IdentityInfoList IE in SIB1 as specified in TS 38.331 [8]. All PLMN Identities and associated information contained in the PLMN-IdentityInfoList IE are included and provided in the same order as broadcast in SIB1.\tYES\tignore\n>PLMN Identity List\tM\t\tAvailable PLMN List\t9.3.1.65\tBroadcast PLMN IDs in SIB1 associated to the NR Cell Identity IE\t-\n>Extended PLMN Identity List\tO\t\tExtended Available PLMN List\t9.3.1.76\t\t-\n>5GS-TAC\tO\t\tOCTET STRING (3)\t\t-\n>NR Cell Identity\tM\t\tBIT STRING (36)\t\t-\n>RANAC\tO\t\tRAN Area Code\t9.3.1.57\t\t-\n\nRange bound\tExplanation\nmaxnoofBPLMNs\tMaximum no. of Broadcast PLMN Ids. Value is 6.\nmaxnoofExtendedBPLMNs\tMaximum no. of Extended Broadcast PLMN Ids. Value is 6.\nmaxnoofBPLMNsNR\tMaximum no. of PLMN Ids.broadcast in an NR cell. Value is 12.\n\n////////////////////////////////////////////////////////////////////////skip unrelated text////////////////////////////////////////////////////////////////////////\n\n\n\n\n\n////////////////////////////////////////////////////////////////////////skip urnealted text////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////skip unrelated text////////////////////////////////////////////////////////////////////////\n9.4.5\tInformation Element definitions\n-- ASN1START \n-- **************************************************************\n--\n-- Information Element Definitions\n--\n-- **************************************************************\n\nF1AP-IEs {\nitu-t (0) identified-organization (4) etsi (0) mobileDomain (0) \nngran-access (22) modules (3) f1ap (3) version1 (1) f1ap-IEs (2) }\n\nDEFINITIONS AUTOMATIC TAGS ::= \n\nBEGIN\n\nIMPORTS\n\tid-gNB-CUSystemInformation,\n\tid-HandoverPreparationInformation,\n\tid-TAISliceSupportList,\n\tid-RANAC,\n\tid-BearerTypeChange,\n\tid-Cell-Direction,\n\tid-Cell-Type,\n\tid-CellGroupConfig,\n\tid-AvailablePLMNList,\n\tid-PDUSessionID,\n\tid-ULPDUSessionAggregateMaximumBitRate, \n\tid-DC-Based-Duplication-Configured,\n\tid-DC-Based-Duplication-Activation,\n\tid-Duplication-Activation,\n\tid-DLPDCPSNLength,\n\tid-ULPDCPSNLength,\n\tid-RLC-Status,\n\tid-MeasurementTimingConfiguration,\n\tid-DRB-Information,\n\tid-QoSFlowMappingIndication,\n\tid-ServingCellMO,\n\tid-RLCMode,\n\tid-ExtendedServedPLMNs-List,\n\tid-ExtendedAvailablePLMN-List,\n\tid-DRX-LongCycleStartOffset,\n\tid-SelectedBandCombinationIndex,\n\tid-SelectedFeatureSetEntryIndex,\n\tid-Ph-InfoSCG,\n\tid-latest-RRC-Version-Enhanced,\n\tid-RequestedBandCombinationIndex,\n\tid-RequestedFeatureSetEntryIndex,\n\tid-RequestedP-MaxFR2,\n\tid-DRX-Config,\n\tid-UEAssistanceInformation,\n\tid-PDCCH-BlindDetectionSCG,\n\tid-Requested-PDCCH-BlindDetectionSCG,\n\tid-BPLMN-ID-Info-List,\n\tid-NotificationInformation,\n\tid-TNLAssociationTransportLayerAddressgNBDU,\n\tid-portNumber,\n\tid-AdditionalSIBMessageList,\n\tid-IgnorePRACHConfiguration,\n\tid-CG-Config,\n\tid-Ph-InfoMCG,\n\tid-MeasGapSharingConfig,\n\tid-systemInformationAreaID,\n\tid-areaScope,\n\n\tmaxNRARFCN,\n\tmaxnoofErrors,\n\tmaxnoofBPLMNs,\n\tmaxnoofBPLMNsNR,\n\tmaxnoofDLUPTNLInformation,\n\tmaxnoofNrCellBands,\n\tmaxnoofULUPTNLInformation,\n\tmaxnoofQoSFlows,\n\tmaxnoofSliceItems,\n\tmaxnoofSIBTypes,\n\tmaxnoofSITypes,\n\tmaxCellineNB,\n\tmaxnoofExtendedBPLMNs,\n\tmaxnoofAdditionalSIBs,\n\tmaxnoofUACPLMNs,\n\tmaxnoofUACperPLMN\n\n\nFROM F1AP-Constants\n\n\tCriticality,\n\tProcedureCode,\n\tProtocolIE-ID,\n\tTriggeringMessage\n\nFROM F1AP-CommonDataTypes\n\n\tProtocolExtensionContainer{},\n\tF1AP-PROTOCOL-EXTENSION,\n\tProtocolIE-SingleContainer{},\n\tF1AP-PROTOCOL-IES\n\nFROM F1AP-Containers;\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\n-- B\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\nBPLMN-ID-Info-List ::= SEQUENCE (SIZE(1..maxnoofBPLMNsNR)) OF BPLMN-ID-Info-Item\n\nBPLMN-ID-Info-Item ::= SEQUENCE {\n\tpLMN-Identity-List\t\t\tAvailablePLMNList,\n\textended-PLMN-Identity-List\tExtendedAvailablePLMN-List\tOPTIONAL,\n\tfiveGS-TAC\t\t\t\t\tFiveGS-TAC\t\t\t\t\tOPTIONAL,\n\tnr-cell-ID\t\t\t\t\tNRCellIdentity,\n\tranac\t\t\t\t\t\tRANAC\t\t\t\t\t\tOPTIONAL,\n\tiE-Extensions\t\t\t\tProtocolExtensionContainer { { BPLMN-ID-Info-ItemExtIEs} } OPTIONAL,\n\t...\n}\n\nBPLMN-ID-Info-ItemExtIEs F1AP-PROTOCOL-EXTENSION ::= {\n\n\t...\n}\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\n-- P\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\n\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\n-- S\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\nServed-Cell-Information ::= SEQUENCE {\n\tnRCGI\t\t\t\t\t\t\tNRCGI,\n\tnRPCI\t\t\t\t\t\t\tNRPCI,\n\tfiveGS-TAC\t\t\t\t\t\t\tFiveGS-TAC\t\t\tOPTIONAL,\n\tconfigured-EPS-TAC\t\t\t\tConfigured-EPS-TAC \t\tOPTIONAL,\n\tservedPLMNs\t\t\t\t\tServedPLMNs-List,\n\tnR-Mode-Info\t\t\t\t\tNR-Mode-Info, \n\tmeasurementTimingConfiguration\tOCTET STRING,\n\tiE-Extensions\t\tProtocolExtensionContainer { {Served-Cell-Information-ExtIEs} } OPTIONAL,\n\t...\n}\n\nServed-Cell-Information-ExtIEs F1AP-PROTOCOL-EXTENSION ::= {\n\t{\tID id-RANAC\t\t\t\t\t\t\tCRITICALITY ignore EXTENSION RANAC\t\t\t\t\t\t\tPRESENCE optional }|\n\t{\tID id-ExtendedServedPLMNs-List\t\tCRITICALITY ignore EXTENSION ExtendedServedPLMNs-List\t\tPRESENCE optional }|\n\t{\tID id-Cell-Direction\t\t\t\tCRITICALITY ignore EXTENSION Cell-Direction\t\t\t\t\tPRESENCE optional }|\n\t{\tID id-BPLMN-ID-Info-List\t\t\tCRITICALITY ignore EXTENSION BPLMN-ID-Info-List\t\t\t\tPRESENCE optional }|\n\t{\tID id-Cell-Type\t\t\t\t\t\tCRITICALITY ignore EXTENSION CellType\t\t\t\t\t\tPRESENCE optional}\n,\n\t...\n}\n\n//////////////////////////////////////////////////////////////skip unrelated codes//////////////////////////////////////////////////////////////\n\n9.4.7\tConstant definitions\n//////////////////////////////////////////////////////////////skip unrealted codes//////////////////////////////////////////////////////////////\n\n-- **************************************************************\n--\n-- IEs\n--\n-- **************************************************************\n\nid-Cause\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 0\nid-Cells-Failed-to-be-Activated-List\t\t\t\tProtocolIE-ID ::= 1\nid-Cells-Failed-to-be-Activated-List-Item\t\t\tProtocolIE-ID ::= 2\nid-Cells-to-be-Activated-List\t\t\t\t\t\tProtocolIE-ID ::= 3\nid-Cells-to-be-Activated-List-Item\t\t\t\t\tProtocolIE-ID ::= 4\nid-Cells-to-be-Deactivated-List\t\t\t\t\t\tProtocolIE-ID ::= 5\nid-Cells-to-be-Deactivated-List-Item\t\t\t\tProtocolIE-ID ::= 6\nid-CriticalityDiagnostics\t\t\t\t\t\t\tProtocolIE-ID ::= 7\nid-CUtoDURRCInformation\t\t\t\t\t\t\t\tProtocolIE-ID ::= 9\nid-DRBs-FailedToBeModified-Item\t\t\t\t\t\tProtocolIE-ID ::= 12\nid-DRBs-FailedToBeModified-List\t\t\t\t\t\tProtocolIE-ID ::= 13\nid-DRBs-FailedToBeSetup-Item\t\t\t\t\t\tProtocolIE-ID ::= 14\nid-DRBs-FailedToBeSetup-List\t\t\t\t\t\tProtocolIE-ID ::= 15\nid-DRBs-FailedToBeSetupMod-Item\t\t\t\t\t\tProtocolIE-ID ::= 16\nid-DRBs-FailedToBeSetupMod-List\t\t\t\t\t\tProtocolIE-ID ::= 17\nid-DRBs-ModifiedConf-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 18\nid-DRBs-ModifiedConf-List\t\t\t\t\t\t\tProtocolIE-ID ::= 19\nid-DRBs-Modified-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 20\nid-DRBs-Modified-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 21\nid-DRBs-Required-ToBeModified-Item\t\t\t\t\tProtocolIE-ID ::= 22\nid-DRBs-Required-ToBeModified-List\t\t\t\t\tProtocolIE-ID ::= 23\nid-DRBs-Required-ToBeReleased-Item\t\t\t\t\tProtocolIE-ID ::= 24\nid-DRBs-Required-ToBeReleased-List\t\t\t\t\tProtocolIE-ID ::= 25\nid-DRBs-Setup-Item\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 26\nid-DRBs-Setup-List\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 27\nid-DRBs-SetupMod-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 28\nid-DRBs-SetupMod-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 29\nid-DRBs-ToBeModified-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 30\nid-DRBs-ToBeModified-List\t\t\t\t\t\t\tProtocolIE-ID ::= 31\nid-DRBs-ToBeReleased-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 32\nid-DRBs-ToBeReleased-List\t\t\t\t\t\t\tProtocolIE-ID ::= 33\nid-DRBs-ToBeSetup-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 34\nid-DRBs-ToBeSetup-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 35\nid-DRBs-ToBeSetupMod-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 36\nid-DRBs-ToBeSetupMod-List\t\t\t\t\t\t\tProtocolIE-ID ::= 37\nid-DRXCycle\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 38\nid-DUtoCURRCInformation\t\t\t\t\t\t\t\tProtocolIE-ID ::= 39\nid-gNB-CU-UE-F1AP-ID\t\t\t\t\t\t\t\tProtocolIE-ID ::= 40\nid-gNB-DU-UE-F1AP-ID\t\t\t\t\t\t\t\tProtocolIE-ID ::= 41\nid-gNB-DU-ID\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 42\nid-GNB-DU-Served-Cells-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 43\nid-gNB-DU-Served-Cells-List\t\t\t\t\t\t\tProtocolIE-ID ::= 44\nid-gNB-DU-Name\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 45\nid-NRCellID\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 46\nid-oldgNB-DU-UE-F1AP-ID\t\t\t\t\t\t\t\tProtocolIE-ID ::= 47\nid-ResetType\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 48\nid-ResourceCoordinationTransferContainer\t\t\tProtocolIE-ID ::= 49\nid-RRCContainer\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 50\nid-SCell-ToBeRemoved-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 51\nid-SCell-ToBeRemoved-List\t\t\t\t\t\t\tProtocolIE-ID ::= 52\nid-SCell-ToBeSetup-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 53\nid-SCell-ToBeSetup-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 54\nid-SCell-ToBeSetupMod-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 55\nid-SCell-ToBeSetupMod-List\t\t\t\t\t\t\tProtocolIE-ID ::= 56\nid-Served-Cells-To-Add-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 57\nid-Served-Cells-To-Add-List\t\t\t\t\t\t\tProtocolIE-ID ::= 58\nid-Served-Cells-To-Delete-Item\t\t\t\t\t\tProtocolIE-ID ::= 59\nid-Served-Cells-To-Delete-List\t\t\t\t\t\tProtocolIE-ID ::= 60\nid-Served-Cells-To-Modify-Item\t\t\t\t\t\tProtocolIE-ID ::= 61\nid-Served-Cells-To-Modify-List\t\t\t\t\t\tProtocolIE-ID ::= 62\nid-SpCell-ID\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 63\nid-SRBID\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 64\nid-SRBs-FailedToBeSetup-Item\t\t\t\t\t\tProtocolIE-ID ::= 65\nid-SRBs-FailedToBeSetup-List\t\t\t\t\t\tProtocolIE-ID ::= 66\nid-SRBs-FailedToBeSetupMod-Item\t\t\t\t\t\tProtocolIE-ID ::= 67\nid-SRBs-FailedToBeSetupMod-List\t\t\t\t\t\tProtocolIE-ID ::= 68\nid-SRBs-Required-ToBeReleased-Item\t\t\t\t\tProtocolIE-ID ::= 69\nid-SRBs-Required-ToBeReleased-List\t\t\t\t\tProtocolIE-ID ::= 70\nid-SRBs-ToBeReleased-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 71\nid-SRBs-ToBeReleased-List\t\t\t\t\t\t\tProtocolIE-ID ::= 72\nid-SRBs-ToBeSetup-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 73\nid-SRBs-ToBeSetup-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 74\nid-SRBs-ToBeSetupMod-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 75\nid-SRBs-ToBeSetupMod-List\t\t\t\t\t\t\tProtocolIE-ID ::= 76\nid-TimeToWait\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 77\nid-TransactionID\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 78\nid-TransmissionActionIndicator\t\t\t\t\t\tProtocolIE-ID ::= 79\nid-UE-associatedLogicalF1-ConnectionItem \t\t\tProtocolIE-ID ::= 80\nid-UE-associatedLogicalF1-ConnectionListResAck\t\tProtocolIE-ID ::= 81\nid-gNB-CU-Name\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 82\nid-SCell-FailedtoSetup-List\t\t\t\t\t\t\tProtocolIE-ID ::= 83\nid-SCell-FailedtoSetup-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 84\nid-SCell-FailedtoSetupMod-List\t\t\t\t\t\tProtocolIE-ID ::= 85\nid-SCell-FailedtoSetupMod-Item\t\t\t\t\t\tProtocolIE-ID ::= 86\nid-RRCReconfigurationCompleteIndicator \t\t\t\tProtocolIE-ID ::= 87\nid-Cells-Status-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 88\nid-Cells-Status-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 89\nid-Candidate-SpCell-List\t\t\t\t\t\t\tProtocolIE-ID ::= 90\nid-Candidate-SpCell-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 91\nid-Potential-SpCell-List\t\t\t\t\t\t\tProtocolIE-ID ::= 92\nid-Potential-SpCell-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 93\nid-FullConfiguration\t\t\t\t\t\t\t\tProtocolIE-ID ::= 94\nid-C-RNTI\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 95\nid-SpCellULConfigured\t\t\t\t\t\t\t\tProtocolIE-ID ::= 96\nid-InactivityMonitoringRequest\t\t\t\t\t\tProtocolIE-ID ::= 97\nid-InactivityMonitoringResponse\t\t\t\t\t\tProtocolIE-ID ::= 98\nid-DRB-Activity-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 99\nid-DRB-Activity-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 100\nid-EUTRA-NR-CellResourceCoordinationReq-Container \t\tProtocolIE-ID ::= 101\nid-EUTRA-NR-CellResourceCoordinationReqAck-Container \tProtocolIE-ID ::= 102\nid-Protected-EUTRA-Resources-List\t\t\t\t\tProtocolIE-ID ::= 105\nid-RequestType \t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 106\nid-ServCellIndex\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 107 \nid-RAT-FrequencyPriorityInformation\t\t\t\t\tProtocolIE-ID ::= 108\nid-ExecuteDuplication\t\t\t\t\t\t\t\tProtocolIE-ID ::= 109\nid-NRCGI\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 111\nid-PagingCell-Item\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 112\nid-PagingCell-List\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 113\nid-PagingDRX\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 114\nid-PagingPriority \t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 115\nid-SItype-List\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 116\nid-UEIdentityIndexValue\t\t\t\t\t\t\t\tProtocolIE-ID ::= 117\nid-gNB-CUSystemInformation\t\t\t\t\t\t\tProtocolIE-ID ::= 118\nid-HandoverPreparationInformation\t\t\t\t\tProtocolIE-ID ::= 119\nid-GNB-CU-TNL-Association-To-Add-Item\t\t\t\tProtocolIE-ID ::= 120\nid-GNB-CU-TNL-Association-To-Add-List\t\t\t\tProtocolIE-ID ::= 121\nid-GNB-CU-TNL-Association-To-Remove-Item\t\t\tProtocolIE-ID ::= 122\nid-GNB-CU-TNL-Association-To-Remove-List\t\t\tProtocolIE-ID ::= 123\nid-GNB-CU-TNL-Association-To-Update-Item\t\t\tProtocolIE-ID ::= 124\nid-GNB-CU-TNL-Association-To-Update-List\t\t\tProtocolIE-ID ::= 125\nid-MaskedIMEISV\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 126\nid-PagingIdentity\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 127\nid-DUtoCURRCContainer\t\t\t\t\t\t\t\tProtocolIE-ID ::= 128\nid-Cells-to-be-Barred-List\t\t\t\t\t\t\tProtocolIE-ID ::= 129\nid-Cells-to-be-Barred-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 130\nid-TAISliceSupportList\t\t\t\t\t\t\t\tProtocolIE-ID ::= 131\nid-GNB-CU-TNL-Association-Setup-List\t\t\t\tProtocolIE-ID ::= 132\nid-GNB-CU-TNL-Association-Setup-Item\t\t\t\tProtocolIE-ID ::= 133\nid-GNB-CU-TNL-Association-Failed-To-Setup-List\t\tProtocolIE-ID ::= 134\nid-GNB-CU-TNL-Association-Failed-To-Setup-Item\t\tProtocolIE-ID ::= 135\nid-DRB-Notify-Item\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 136\nid-DRB-Notify-List\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 137\nid-NotficationControl\t\t\t\t\t\t\t\tProtocolIE-ID ::= 138\nid-RANAC\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 139\nid-PWSSystemInformation\t\t\t\t\t\t\t\tProtocolIE-ID ::= 140\nid-RepetitionPeriod\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 141\nid-NumberofBroadcastRequest\t\t\t\t\t\t\tProtocolIE-ID ::= 142\nid-Cells-To-Be-Broadcast-List\t\t\t\t\t\tProtocolIE-ID ::= 144\nid-Cells-To-Be-Broadcast-Item\t\t\t\t\t\tProtocolIE-ID ::= 145\nid-Cells-Broadcast-Completed-List \t\t\t\t\tProtocolIE-ID ::= 146\nid-Cells-Broadcast-Completed-Item \t\t\t\t\tProtocolIE-ID ::= 147\nid-Broadcast-To-Be-Cancelled-List \t\t\t\t\tProtocolIE-ID ::= 148\nid-Broadcast-To-Be-Cancelled-Item \t\t\t\t\tProtocolIE-ID ::= 149\nid-Cells-Broadcast-Cancelled-List \t\t\t\t\tProtocolIE-ID ::= 150\nid-Cells-Broadcast-Cancelled-Item \t\t\t\t\tProtocolIE-ID ::= 151\nid-NR-CGI-List-For-Restart-List \t\t\t\t\tProtocolIE-ID ::= 152\nid-NR-CGI-List-For-Restart-Item \t\t\t\t\tProtocolIE-ID ::= 153\nid-PWS-Failed-NR-CGI-List \t\t\t\t\t\t\tProtocolIE-ID ::= 154\nid-PWS-Failed-NR-CGI-Item \t\t\t\t\t\t\tProtocolIE-ID ::= 155\nid-ConfirmedUEID\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 156\nid-Cancel-all-Warning-Messages-Indicator\t\t\tProtocolIE-ID ::= 157\nid-GNB-DU-UE-AMBR-UL\t\t\t\t\t\t\t\tProtocolIE-ID ::= 158\nid-DRXConfigurationIndicator\t\t\t\t\t\tProtocolIE-ID ::= 159\nid-RLC-Status\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 160\nid-DLPDCPSNLength\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 161\nid-GNB-DUConfigurationQuery\t\t\t\t\t\t\tProtocolIE-ID ::= 162\nid-MeasurementTimingConfiguration\t\t\t\t\tProtocolIE-ID ::= 163\nid-DRB-Information\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 164\nid-ServingPLMN\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 165\nid-Protected-EUTRA-Resources-Item\t\t\t\t\tProtocolIE-ID ::= 168\nid-GNB-CU-RRC-Version\t\t\t\t\t\t\t\tProtocolIE-ID ::= 170\nid-GNB-DU-RRC-Version\t\t\t\t\t\t\t\tProtocolIE-ID ::= 171\nid-GNBDUOverloadInformation\t\t\t\t\t\t\tProtocolIE-ID ::= 172\nid-CellGroupConfig\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 173\nid-RLCFailureIndication\t\t\t\t\t\t\t\tProtocolIE-ID ::= 174\nid-UplinkTxDirectCurrentListInformation\t\t\t\tProtocolIE-ID ::= 175\nid-DC-Based-Duplication-Configured\t\t\t\t\tProtocolIE-ID ::= 176\nid-DC-Based-Duplication-Activation\t\t\t\t\tProtocolIE-ID ::= 177\nid-SULAccessIndication\t\t\t\t\t\t\t\tProtocolIE-ID ::= 178\nid-AvailablePLMNList\t\t\t\t\t\t\t\tProtocolIE-ID ::= 179\nid-PDUSessionID\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 180\nid-ULPDUSessionAggregateMaximumBitRate\t\t\t\tProtocolIE-ID ::= 181\nid-ServingCellMO\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 182\nid-QoSFlowMappingIndication\t\t\t\t\t\t\tProtocolIE-ID ::= 183\nid-RRCDeliveryStatusRequest\t\t\t\t\t\t\tProtocolIE-ID ::= 184\nid-RRCDeliveryStatus\t\t\t\t\t\t\t\tProtocolIE-ID ::= 185\nid-BearerTypeChange\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 186\nid-RLCMode\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 187\nid-Duplication-Activation\t\t\t\t\t\t\tProtocolIE-ID ::= 188\nid-Dedicated-SIDelivery-NeededUE-List\t\t\t\tProtocolIE-ID ::= 189\nid-Dedicated-SIDelivery-NeededUE-Item\t\t\t\tProtocolIE-ID ::= 190\nid-DRX-LongCycleStartOffset\t\t\t\t\t\t\tProtocolIE-ID ::= 191\nid-ULPDCPSNLength\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 192\nid-SelectedBandCombinationIndex\t\t\t\t\t\tProtocolIE-ID ::= 193\nid-SelectedFeatureSetEntryIndex\t\t\t\t\t\tProtocolIE-ID ::= 194\nid-ResourceCoordinationTransferInformation\t\t\tProtocolIE-ID ::= 195\nid-ExtendedServedPLMNs-List\t\t\t\t\t\t\tProtocolIE-ID ::= 196\nid-ExtendedAvailablePLMN-List\t\t\t\t\t\tProtocolIE-ID ::= 197\nid-Associated-SCell-List\t\t\t\t\t\t\tProtocolIE-ID ::= 198\nid-latest-RRC-Version-Enhanced\t\t\t\t\t\tProtocolIE-ID ::= 199\nid-Associated-SCell-Item\t\t\t\t\t\t\tProtocolIE-ID ::= 200\nid-Cell-Direction\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 201\nid-SRBs-Setup-List\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 202\nid-SRBs-Setup-Item\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 203\nid-SRBs-SetupMod-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 204\nid-SRBs-SetupMod-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 205\nid-SRBs-Modified-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 206\nid-SRBs-Modified-Item\t\t\t\t\t\t\t\tProtocolIE-ID ::= 207\nid-Ph-InfoSCG\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 208\nid-RequestedBandCombinationIndex\t\t\t\t\tProtocolIE-ID ::= 209\nid-RequestedFeatureSetEntryIndex\t\t\t\t\tProtocolIE-ID ::= 210\nid-RequestedP-MaxFR2\t\t\t\t\t\t\t\tProtocolIE-ID ::= 211\nid-DRX-Config\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 212\nid-IgnoreResourceCoordinationContainer\t\t\t\tProtocolIE-ID ::= 213\nid-UEAssistanceInformation\t\t\t\t\t\t\tProtocolIE-ID ::= 214\nid-NeedforGap\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 215\nid-PagingOrigin\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 216\nid-new-gNB-CU-UE-F1AP-ID\t\t\t\t\t\t\tProtocolIE-ID ::= 217\nid-RedirectedRRCmessage\t\t\t\t\t\t\t\tProtocolIE-ID ::= 218\nid-new-gNB-DU-UE-F1AP-ID\t\t\t\t\t\t\tProtocolIE-ID ::= 219\nid-NotificationInformation\t\t\t\t\t\t\tProtocolIE-ID ::= 220\nid-PLMNAssistanceInfoForNetShar\t\t\t\t\t\tProtocolIE-ID ::= 221\nid-UEContextNotRetrievable\t\t\t\t\t\t\tProtocolIE-ID ::= 222\nid-BPLMN-ID-Info-List\t\t\t\t\t\t\t\tProtocolIE-ID ::= 223\nid-SelectedPLMNID\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 224\nid-UAC-Assistance-Info\t\t\t\t\t\t\t\tProtocolIE-ID ::= 225\nid-RANUEID\t\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 226\nid-GNB-DU-TNL-Association-To-Remove-Item\t\t\tProtocolIE-ID ::= 227\nid-GNB-DU-TNL-Association-To-Remove-List\t\t\tProtocolIE-ID ::= 228\nid-TNLAssociationTransportLayerAddressgNBDU\t\t\tProtocolIE-ID ::= 229\nid-portNumber\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 230\nid-AdditionalSIBMessageList\t\t\t\t\t\t\tProtocolIE-ID ::= 231\nid-Cell-Type\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 232\nid-IgnorePRACHConfiguration\t\t\t\t\t\t\tProtocolIE-ID ::= 233\nid-CG-Config\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 234\nid-PDCCH-BlindDetectionSCG\t\t\t\t\t\t\tProtocolIE-ID ::= 235\nid-Requested-PDCCH-BlindDetectionSCG\t\t\t\tProtocolIE-ID ::= 236\nid-Ph-InfoMCG\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 237\nid-MeasGapSharingConfig\t\t\t\t\t\t\t\tProtocolIE-ID ::= 238\nid-systemInformationAreaID\t\t\t\t\t\t\tProtocolIE-ID ::= 239\nid-areaScope\t\t\t\t\t\t\t\t\t\tProtocolIE-ID ::= 240\nid-RRCContainer-RRCSetupComplete\t\t\t\t\tProtocolIE-ID ::= 241\n\n\n//////////////////////////////////////////////////////////////end//////////////////////////////////////////////////////////////\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAn gNB-CU cannot get aware of whether each cell in its gNB-DU is only capable to support NSA mode, and thus may consider these cells as potential target cells for handover even if they are not capable to serve as PCell.\n\n>>> SUMMARY OF CHANGE\nOne new optional IE, namely PCell Support, is proposed to be added into the \u00a79.3.1.10 Served Cell Information of TS 38.473 and each item of Broadcast PLMN Identity Info List within it, used to inform the gNB-CU whether the related cell is capable to serve as a PCell.Impact assessment towards the previous version of the specification (same release):This CR is a clarification and has an isolated impact towards the previous version of the specification (same release).This CR only has an impact on F1AP global procedure.This CR is backward compatible.\n\n>>> CONSEQUENCES IF NOT REVISED\nA gNB-CU cannot get aware of whether each cell in its gNB-DU is only capable to support NSA mode."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n5.3.8.3\tReception of the RRCRelease by the UE\nThe UE shall:\n1>\tdelay the following actions defined in this sub-clause 60ms from the moment the RRCRelease message was received or optionally when lower layers indicate that the receipt of the RRCRelease message has been successfully acknowledged, whichever is earlier;\n1>\tstop timer T320, if running;\n\n1>\tif the RRCRelease message includes redirectedCarrierInfo indicating redirection to eutra:\n2>\tif cnType is included:\n3>\t the received cnType is provided to upper layers; \nNOTE:\tHandling the case if the E-UTRA cell selected after the redirection does not support the core network type specified by the cnType, is up to UE implementation.\n1>\tif the RRCRelease message includes the cellReselectionPriorities:\n2>\tstore the cell reselection priority information provided by the cellReselectionPriorities;\n2>\tif the t320 is included:\n3>\tstart timer T320, with the timer value set according to the value of t320;\n1>\telse:\n2>\tapply the cell reselection priority information broadcast in the system information;\n1>\tif deprioritisationReq is included:\n2>\tstart or restart timer T325 with the timer value set to the deprioritisationTimer signalled;\n2>\tstore the deprioritisationReq until T325 expiry;\n1>\tif the RRCRelease includes suspendConfig:\n2> apply the received suspendConfig;  \n2> store fullI-RNTI, shortI-RNTI, nextHopChainingCount, t380 and ran-PagingCycle provided in suspendConfig; \n2>\treset MAC;\n2>\tre-establish RLC entities for SRB1;\n2>\tif the RRCRelease message with suspendConfig was received in response to an RRCResumeRequest or an RRCResumeRequest1:\n3> stop the timer T319 if running;\n3> replace any previously stored security context with newly received security context in the suspendConfig;\n3> replace the previously stored C-RNTI with the temporary C-RNTI in the cell the UE has received the RRCRelease message;\n3> replace the previously stored cellIdentity with the cellIdentity of the cell the UE has received the RRCRelease message;\n3> replace the previously stored physical cell identity with the physical cell identity of the cell the UE has received the RRCRelease message;\n2>\telse:\n3> store the UE AS Context including the current RRC configuration, the current security context, the PDCP state including ROHC state, SDAP configuration, C-RNTI used in the source PCell, the cellIdentity and the physical cell identity of the source PCell;\n2>\tsuspend all SRB(s) and DRB(s), except SRB0;\n2>\tstart timer T380, with the timer value set to t380;\n2>\tindicate the suspension of the RRC connection to upper layers;\n2> enter RRC_INACTIVE and perform procedures as specified in TS 38.304 [21]\n1>\telse\n2>\tperform the actions upon going to RRC_IDLE as specified in 5.3.11, with the release cause \u2018other\u2019.\nEditor\u2019s Note: FFS Whether there needs to be different release causes and actions associated. \n\n****Next Change ****\n\nB.1\tProtection of RRC messages (informative)\nThe following list provides information which messages can be sent (unprotected) prior to security activation and which messages can be sent unprotected after security activation. Those messages indicated \"-\" in \"P\" column should never be sent unprotected by gNB or UE. Further requirements are defined in the procedural text.\nP\u2026Messages that can be sent (unprotected) prior to security activation\nA - I\u2026Messages that can be sent without integrity protection after security activation\nA - C\u2026Messages that can be sent unciphered after security activation\nNA\u2026 Message can never be sent after security activation\nMessage\tP\tA-I\tA-C\tComment\nDLInformationTransfer\t+\t-\t-\nLocationMeasurementIndication\t-\t-\t-\nMIB\t+\t+\t+\nMeasurementReport\t-\t-\t-\tMeasurement configuration may be sent prior to security activation. But: In order to protect privacy of UEs, MEASUREMENT REPORT is only sent from the UE after successful security activation.\nPaging\t+\t+\t+\nRRCReconfiguration\t+\t-\t-\tThe message shall not be sent unprotected before security activation if it is used to perform handover or to establish SRB2 and DRBs\nRRCReconfigurationComplete\t+\t-\t-\tUnprotected, if sent as response to RRCConnectionReconfiguration which was sent before security activation\nRRCReestablishment\t-\t-\t+\tIntegrity protection applied, but no ciphering.\nRRCReestablishmentComplete\t-\t-\t-\nRRCReestablishmentRequest\t-\t-\t+\tThis message is not protected by PDCP operation. However, a short MAC-I is included.\nRRCReject\t+\tNA\tNA\nRRCRelease\t+\t-\t-\nRRCRequest\t+\tNA\tNA\nRRCResume\t-\t-\t-\nRRCResumeRequest\t-\t-\t+\tThis message is not protected by PDCP operation. However, a short MAC-I is included.\nRRCResumeComplete\t-\t-\t-\nRRCSetup\t+\tNA\tNA\nRRCSetupComplete\t+\tNA\tNA\nRRCSystemInfoRequest\t+\tNA\tNA\nSecurityModeCommand\t+\tNA\tNA\tIntegrity protection applied, but no ciphering (integrity verification done after the message received by RRC)\nSecurityModeComplete\t-\tNA\tNA\tIntegrity protection applied, but no ciphering. Ciphering is applied after completing the procedure.\nSecurityModeFailure\t+\tNA\tNA\tNeither integrity protection nor ciphering applied.\nSystemInformation\t+\t+\t+\nSIB1\t+\t+\t+\nUECapabilityEnquiry\t+\t-\t-\nUECapabilityInformation\t+\t-\t-\nULInformationTransfer\t+\t-\t-\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs discussed in R2-1813999, SA3 confirmed that security is required when RRC release message is sent with additional configuraiton information.\n\n>>> SUMMARY OF CHANGE\nUE action is updated to only release the RRC connection and ignore any other the fields if present when UE recieves RRC Release without security.\n\n>>> CONSEQUENCES IF NOT REVISED\nUE may accept RRC release with other configurations without security.  This is considered a security risk and not considered acceptable by SA3.Impact analysis:If UE is implemented according to the CR and network is not, network may provide the fields in RRC release and they will be ignored by the UEIf network is implemented according to the CR and UE is not, there is no inter-operability issue."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n<<< Start of changes >>>\n6.1.3.5\tPolicy Control Request Triggers relevant for SMF\nThe Policy Control Request Triggers relevant for SMF define the conditions when the SMF shall interact again with PCF after a PDU Session establishment as defined in the Session Management Policy Establishment and Session Management Policy Modification procedure as defined in TS\u00a023.502\u00a0[3].\nThe PCR triggers are not applicable any longer at termination of the SM Policy Association.\nThe access independent Policy Control Request Triggers relevant for SMF are listed in table 6.1.3.5-1.\nTable 6.1.3.5-1: Access independent Policy Control Request Triggers relevant for SMF\nPolicy Control Request Trigger\tDescription\tDifference compared with table 6.2 and table A.4.3-2 in TS\u00a023.203\u00a0[4]\tConditions for reporting\tMotivation\nPLMN change\tThe UE has moved to another operators' domain.\tNone\tPCF\nQoS change\tThe QoS parameters of the QoS Flow has changed.\tRemoved\t\tOnly applicable when binding of bearers was done in PCRF.\nQoS change exceeding authorization\tThe QoS parameters of the QoS Flow has changed and exceeds the authorized QoS.\tRemoved\t\tOnly applicable when binding of bearers was done in PCRF.\nTraffic mapping information change\tThe traffic mapping information of the QoS profile has changed.\tRemoved\t\tOnly applicable when binding of bearers was done in PCRF.\nResource modification request\tA request for resource modification has been received by the SMF.\tNone\tSMF always reports to PCF\nRouting information change\tThe IP flow mobility routing information has changed (when IP flow mobility as specified in TS\u00a023.261\u00a0[11] applies) or the PCEF has received Routing Rules from the UE (when NBIFOM as specified in TS\u00a023.161\u00a0[10] applies).\tRemoved\t\tNot in 5GS yet.\nChange in Access Type \tThe Access Type and, if applicable, the RAT Type of the PDU Session has changed.\tNone\tPCF\nLoss/recovery of transmission resources\tThe Access type transmission resources are no longer usable/again usable.\tRemoved\t\tNot in 5GS yet.\nLocation change (serving cell) \tThe serving cell of the UE has changed.\tRemoved\t\tNot in 5GS yet.\nLocation change (serving area)\t(NOTE\u00a02)\tThe serving area of the UE has changed.\tNone\tPCF\nLocation change (serving CN node in 5GS)\t(NOTE\u00a03)\tThe serving core network node of the UE in 5GS has changed.\tAdded\tPCF\nLocation change (serving CN node in EPC)\t(NOTE\u00a04)\tThe serving core network node of the UE in EPC has changed.\tNone\tPCF\nChange of UE presence in Presence Reporting Area (see NOTE 1)\tThe UE is entering/leaving a Presence Reporting Area.\tNone\tPCF\tOnly applicable to PCF\nOut of credit\tCredit is no longer available.\tNone\tPCF\tMay need validation with SA5.\n\nEnforced PCC rule request\tSMF is performing a PCC rules request as instructed by the PCF.\tNone\tPCF\nEnforced ADC rule request\tTDF is performing an ADC rules request as instructed by the PCRF.\tRemoved\t\tADC Rules are not applicable.\nUE IP address change \tA UE IP address has been allocated/released.\tNone\tSMF always reports allocated or released UE IP addresses\nUE MAC address change\tA new UE MAC address is detected or a used UE MAC address is inactive for a specific period.\tNew\tPCF\nAccess Network Charging Correlation Information\tAccess Network Charging Correlation Information has been assigned.\tNone\tPCF\nUsage report\t\tThe PDU Session or the Monitoring key specific resources consumed by a UE either reached the threshold or needs to be reported for other reasons.\tNone\tPCF\nStart of application traffic detection and\tStop of application traffic detection \tThe start or the stop of application traffic has been detected.\tNone\tPCF\nSRVCC CS to PS handover\tA CS to PS handover has been detected.\tRemoved\t\tNo support in 5GS yet\nAccess Network Information report\tAccess information as specified in the Access Network Information Reporting part of a PCC rule.\tNone\tPCF\nCredit management session failure\tTransient/Permanent failure as specified by the CHF.\tNone\tPCF\nAddition / removal of an access to an IP-CAN session \tThe PCEF reports when an access is added or removed.\tRemoved\t\tNo support in 5GS yet\nChange of usability of an access \tThe PCEF reports that an access becomes unusable or usable again.\tRemoved\t\tNo support in 5GS yet\n3GPP PS Data Off status change  \tThe SMF reports when the 3GPP PS Data Off status changes.\tNone\tSMF always reports to PCF\nSession AMBR change\tThe Session AMBR has changed.\tAdded\tSMF always reports to PCF\nDefault QoS change\tThe subscribed QoS has changed.\tAdded\tSMF always reports to PCF\nRemoval of PCC rule\tThe SMF reports when the PCC rule is removed.\tAdded\tSMF always reports to PCF\nGFBR of the QoS Flow can no longer (or can again) be guaranteed \tThe SMF notifies the PCF when receiving notifications from RAN that GFBR of the QoS Flow can no longer (or can again) be guaranteed.\tAdded\nUE resumed from suspend state\tThe SMF reports to the PCF when it detects that the UE is resumed from suspend state.\tNone\tPCF\tOnly applicable to EPC IWK\nChange of DN Authorization Profile Index\tThe DN Authorization Profile Index received from DN-AAA has changed.\tAdded\tSMF always reports to PCF\nNOTE\u00a01:\tThe maximum number of PRA(s) per UE per PDU Session is configured in the PCF. The PCF may have independent configuration of the maximum number for Core Network pre-configured PRAs and UE-dedicated PRAs. The exact number(s) should be determined by operator in deployment.\tNOTE\u00a02:\tThis trigger reports change of Tracking Area in both 5GS and EPC interworking.\tNOTE\u00a03:\tThis trigger reports change of AMF in 5GS.\tNOTE\u00a04:\tThis trigger reports change from ePDG to Serving GW, or from Serving Gateway to ePDG or between Serving GWs.\n\nNOTE\u00a01:\tIn the following description of the access independent Policy Control Request Triggers relevant for SMF, the term trigger is used instead of Policy Control Request Trigger where appropriate.\nThe Resource modification request trigger shall trigger the PCF interaction for all resource modification requests not tied to a specific QoS Flow received by SMF. The resource modification request received by SMF may include request for guaranteed bit rate changes for a traffic aggregate and/or the association/disassociation of the traffic aggregate with a 5QI and/or a modification of the traffic aggregate.\nThe enforced PCC rule request trigger shall trigger a SMF interaction to request PCC rules from the PCF for an established PDU Session. This SMF interaction shall take place within the Revalidation time limit set by the PCF in the PDU Session related policy information. The SMF reports that the enforced PCC rule request trigger was met and the enforced PCC Rules.\nThe UE IP address change trigger shall trigger a SMF interaction with the PCF in case a UE IP address is allocated or released during the lifetime of the PDU session. The SMF reports that the UE IP address change trigger was met and the new or released UE IP address.\nThe UE MAC address change trigger shall trigger a SMF interaction with the PCF in case a new UE MAC address is detected or a used UE MAC address is inactive for a specific period during the lifetime of the Ethernet type PDU session. The SMF reports that the UE IP address change trigger was met and the new or released UE MAC address.\nNOTE\u00a02:\tThe SMF instructs the UPF to detect new UE MAC addresses or used UE MAC address is inactive for a specific period as described in TS\u00a023.501\u00a0[2].\nThe Access Network Charging Correlation Information trigger shall trigger the SMF to report the assigned access network charging identifier for the PCC rules that are accompanied with a request for this trigger at activation. The SMF reports that the Access Network Charging Correlation Information trigger was met and the Access Network Charging Correlation Information.\nIf the Usage report trigger is set and the volume or the time thresholds, earlier provided by the PCF, are reached, the SMF shall report this situation to the PCF. If both volume and time thresholds were provided and the thresholds, for one of the measurements, are reached, the SMF shall report this situation to the PCF and the accumulated usage since last report shall be reported for both measurements.\nThe management of the Presence Reporting Area (PRA) functionality enables the PCF to subscribe to reporting change of UE presence in a particular Presence Reporting Area.\nNOTE\u00a03:\tPCF decides whether to subscribe to AMF or to SMF for those triggers that are present in both tables 6.1.2.5-2 and 6.1.3.5-1. If the Change of UE presence in Presence Reporting Area trigger is available on both AMF and SMF, PCF should not subscribe to both AMF and SMF simultaneously.\nUpon every interaction with the SMF, the PCF may activate / deactivate reporting changes of UE presence in Presence Reporting Area by setting / unsetting the corresponding trigger by providing the PRA Identifier(s) and additionally the list(s) of elements comprising the Presence Reporting Area for UE-dedicated Presence Reporting Area(s).\nThe SMF shall subscribe to the UE Location Change notification from the AMF by providing an area of interest containing the PRA Identifier(s) and additionally the list(s) of elements provided by the PCF as specified in TS\u00a023.501\u00a0[2], clause\u00a05.6.11 and TS\u00a023.502\u00a0[3], clause\u00a05.2.2.3.1.\nWhen the Change of UE presence in Presence Reporting Area trigger is armed, i.e. when the PCF subscribes to reporting change of UE presence in a particular Presence Reporting Area and the reporting change of UE presence in this Presence Reporting Area was not activated before, the SMF subscribes to the UE mobility event notification service provided by the AMF for reporting of UE presence in Area of Interest which reports when the UE enters or leaves a Presence Reporting Area (an initial report is received when the PDU Session specific procedure is activated). The SMF reports the PRA Identifier(s) and indication(s) whether the UE is inside or outside the Presence Reporting Area(s), and indication(s) if the corresponding Presence Reporting Area(s) is set to inactive by the AMF to the PCF.\nNOTE\u00a04:\tThe serving node (i.e. AMF in 5GC or MME in EPC/EUTRAN) can activate the reporting for the PRAs which are inactive as described in the TS\u00a023.501\u00a0[2].\nWhen PCF modifies the list of PRA id(s) to change of UE presence in Presence Reporting Area for a particular Presence Reporting Area(s), the SMF removes or adds the PRA id(s) provided in the UE mobility event notification service provided by AMF for reporting of UE presence in Area Of Interest. When the PCF unsubscribes to reporting change of UE presence in Presence reporting Area, the SMF unsubscribes to the UE mobility event notification service provided by AMF for reporting of UE presence in Area Of Interest, unless subscriptions to AMF remains due to other triggers.\nThe SMF stores PCF subscription to reporting for changes of UE presence in Presence Reporting Area and notifies the PCF with the PRA Identifier(s) and indication(s) whether the UE is inside or outside the Presence Reporting Area(s) based on UE location change notification in area of interest received from the serving node according to the corresponding subscription.\nNOTE\u00a05:\tThe SMF can also be triggered by the CHF to subscribe to notification of UE presence in PRA from the AMF, and notifies the CHF when receiving reporting of UE presence in PRA from the AMF, referring to TS\u00a032.291\u00a0[20].\nIf PCF is configured with a PRA identifier referring to the list of PRA Identifier(s) within a Set of Core Network predefined Presence Reporting Areas as defined in TS\u00a023.501\u00a0[2], it activates the reporting of UE entering/leaving each individual PRA in the Set of Core Network predefined Presence Reporting Areas, without providing the complete set of individual PRAs.\nWhen a PRA set identified by a PRA Identifier was subscribed to report changes of UE presence in Presence Reporting Area by the PCF, the SMF additionally receives the PRA Identifier of the PRA set from the AMF, along with the individual PRA Identifier(s) belonging to the PRA set and indication(s) of whether the UE is inside or outside the individual Presence Reporting Area(s), as described in TS\u00a023.501\u00a0[2].\nWhen the Out of credit detection trigger is set the SMF shall inform the PCF about the PCC rules for which credit is no longer available together with the applied termination action.\n\nThe Start of application traffic detection and Stop of application traffic detection triggers shall trigger an interaction with PCF once the requested application traffic is detected (i.e. Start of application traffic detection) or the end of the requested application traffic is detected (i.e. Stop of application traffic detection) unless it is requested within a specific PCC Rule to mute such interaction for solicited application reporting or unconditionally in case of unsolicited application reporting. The application identifier and service data flow descriptions, if deducible, shall also be included in the report. An application instance identifier shall be included in the report both for Start and for Stop of application traffic detection when service data flow descriptions are deducible. This is done to unambiguously match the Start and the Stop events.\nAt PCC rule activation, modification and deactivation the SMF shall send, as specified in the PCC rule, the User Location Report and/or UE Timezone Report to the PCF.\nNOTE\u00a06:\tAt PCC rule deactivation the User Location Report includes information on when the UE was last known to be in that location.\nThe PCF shall send the User Location Report and/or UE Timezone Report to the AF upon receiving an Access Network Information report corresponding to the AF session from the SMF.\nIf the trigger for Access Network Information reporting is set, the SMF shall check the need for access network information reporting after successful installation/modification or removal of a PCC rule or upon termination of the PDU Session. The SMF shall check the Access Network Information report parameters (User Location Report, UE Timezone Report) of the PCC rules and report the access network information to the PCF. The SMF shall not report any subsequent access network information updates received from the PDU Session without any previous updates of related PCC rule unless the associated QoS Flow or PDU Session has been released.\nIf the SMF receives a request to install/modify or remove a PCC rule with Access Network Information report parameters (User Location Report, UE Timezone Report) set the SMF shall initiate a PDU Session modification to retrieve the current access network information of the UE and forward it to the PCF afterwards.\nIf the Access Network Information report parameter for the User Location Report is set and the user location (e.g. cell) is not available to the SMF, the SMF shall provide the serving PLMN identifier to the PCF which shall forward it to the AF.\nThe Credit management session failure trigger shall trigger a SMF interaction with the PCF to inform about a credit management session failure and to indicate the failure reason, and the affected PCC rules.\nNOTE\u00a07:\tAs a result, the PCF may decide about e.g. PDU Session termination, perform gating of services, switch to offline charging, change rating group, etc.\nNOTE\u00a08:\tThe Credit management session failure trigger applies to situations wherein the PDU Session is not terminated by the SMF due to the credit management session failure.\nThe default QoS change triggers shall trigger the PCF interaction for all changes in the default QoS data received in SMF from the UDM.\nThe Session AMBR change trigger shall trigger the SMF to provide the Session AMBR to the PCF containing the DN authorised Session AMBR if received from the DN-AAA, or the Subscribed Session AMBR received from the UDM as described in clause\u00a05.6.6 of TS\u00a023.501\u00a0[2].\nThe default QoS change trigger reports a change in the default 5QI/ARP retrieved by SMF from UDM, as explained in clause\u00a05.7.2.7 of TS\u00a023.501\u00a0[2].\nIf the PCC Rules bound to a QoS Flow are removed when the corresponding QoS Flow is removed or the PCC rules are failed to be enforced, the SMF shall report this situation to the PCF. The PCF may then provide the same or updated PCC rules for the established PDU Session.\nIf the GFBR of the QoS Flow can no longer (or can again) be guaranteed trigger is armed, the SMF shall check the need for reporting to the PCF when the SMF receives an explicit notification from (R)AN indicating that GFBR of the QoS Flow can no longer (or can again) be guaranteed and when the condition described in TS\u00a023.501\u00a0[2] clause\u00a05.7.2.4 is met during the handover. The SMF shall report that GFBR of the QoS Flow can no longer (or can again) be guaranteed accordingly to the PCF for those PCC rules which are bound to the affected QoS Flow and have the QoS Notification Control (QNC) parameter set. The PCF may then update those PCC rules for the established PDU Session.\nIn an interworking scenario between 5GS and EPC/E-UTRAN, as explained in the TS\u00a023.501\u00a0[2], clause\u00a04.3, the PCF may subscribe via the SMF also to the Policy Control Request Triggers described in clause\u00a06.1.2.5 when the UE is served by the EPC/E-UTRAN.\nThe change of DN Authorization Profile Index shall trigger a SMF interaction to send DN Authorization Profile Index to retrieve a list of PCC Rules (as defined in clause\u00a06.3) and/or PDU Session related policy (as defined in clause\u00a06.4) for an established PDU Session.\n<<< End of changes >>>\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nCurrently the PCF can use the \u2018Out of credit\u2019 Policy Control Request Trigger to learn about PCC rules for which the user has no available credit, e.g. to throttle the subscriber. However, in addition the PCF needs to know when this condition has cleared up, ie when the user has replenished the credit for the PCC rules so that the actions taken on out of credit can be reverted (e.g. stop throttling).NOTE: Reallocation of credit has been part of Gx (TS 29.212) since Rel-7.\n\n>>> SUMMARY OF CHANGE\n\u2018Reallocation of credit\u2019 Policy Control Request Trigger is added to Table 6.1.3.5-1. Corresponding text for out of credit and reallocation of credit is also added.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe PCF will have no way to learn about a clearing up of an \u2018Out of credit\u2019 situation. Consequently, the PCF will not be able to install/update proper PCC rules. As a result a user may be, for example throttled down after credit has been reallocated for some specific services."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** First change *****\n3.2\tAbbreviations\nFor the purposes of the present document, the abbreviations given in 3GPP\u00a0TR\u00a021.905\u00a0[1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP\u00a0TR\u00a021.905\u00a0[1].\nALUID\tApplication Layer User ID\n\n\n\nEPUID\tEPC ProSe User ID\nMIC\tMessage Integrity Check\nPDUID\tProSe Discovery UE ID\nProSe\tProximity-based Services\nRPAUID\tRestricted ProSe Application User ID\nUTC\tUniversal Time Coordinated\nWLLID\tWLAN Link Layer ID\n\n***** Next change *****\n5.3.2\tDetailed behaviour of the HPLMN ProSe Function \nThe ProSe Function in the HPLMN shall make use of this procedure to request the ProSe Function in VPLMN for ProSe Direct Discovery announcing authorisation for an announcing UE roaming in the VPLMN. \n-\tFor open ProSe Direct Discovery, the HPLMN ProSe Function shall include in the request the Discovery Entry ID and shall include in the Discovery Authorization Request the Discovery Type set to \"ANNOUNCING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\" , the ProSe Application ID corresponding to the request from the announcing UE and the ProSe Application Code assigned for this request. The Discovery Authorization Request shall include the UE identity (i.e., IMSI or MSISDN) and the ProSe Validity Timer corresponding to ProSe Application Code in order to allow the ProSe Function in VPLMN to perform charging. If the announcing UE's original announce request is for updating the metadata, the updated metadata shall also be included.\n-\tFor restricted ProSe Direct Discovery, the HPLMN ProSe Function shall include in the Discovery Authorization Request  the Discovery Entry ID and the Discovery Type set to \"ANNOUNCING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the application identity, RPAUID corresponding to the announcing UE, the ProSe Restricted Code assigned for this request. The Discovery Authorization Request shall also include the UE identity (i.e., IMSI or MSISDN) and the ProSe Validity Timer corresponding to ProSe Restricted Code in order to allow the ProSe Function in VPLMN to perform charging. For restricted ProSe Direct Discovery using application-controlled extension, the ProSe Function shall include a ProSe Restricted Code Prefix and one or more ProSe Restricted Code Suffix Range in the Discovery Authorization Request.\n-\tFor restricted ProSe Direct Discovery model B discoverer operation, the HPLMN ProSe Function shall include in the Discovery Authorization Request the Discovery Entry ID and the Discovery Type set to \"DISCOVERER_ANNOUNCING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the application identity, RPAUID corresponding to the discoverer UE as well as the ProSe Query Code assigned for this request. The Discovery Authorization Request shall also include the UE identity (i.e., IMSI or MSISDN) and the ProSe Validity Timer corresponding to ProSe Query Code in order to allow the ProSe Function in VPLMN to perform charging\n-\tFor restricted ProSe Direct Discovery model B discoveree operation, the HPLMN ProSe Function shall include in the Discovery Authorization Request the Discovery Entry ID and the Discovery Type set to \"DISCOVEREE_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the application identity, RPAUID corresponding to the discoverer UE as well as the ProSe Response Code assigned for this request. The Discovery Authorization Request shall also include the UE identity (i.e., IMSI or MSISDN) and the ProSe Validity Timer corresponding to ProSe Query Code in order to allow the ProSe Function in VPLMN to perform charging.\nThe ProSe Function in the HPLMN shall make use of this procedure to retrieve from the ProSe Function in the local PLMN the Discovery Filter for monitoring in open ProSe Direct Discovery or to retrieve parameters needed to create a Restricted Discovery Filter, or ProSe Response Filter associated with the monitored/queried application-layer identity for restricted ProSe Direct Discovery.\n-\tFor open ProSe Direct Discovery, the HPLMN ProSe Function shall include in the request the Discovery Entry ID and shall include in the Discovery Authorization Request the Discovery Type set to \"MONITORING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the ProSe Application ID name corresponding to the request from the monitoring UE. The Discovery Authorization Request shall also include the UE identity (i.e., IMSI or MSISDN) in order to allow the ProSe Function in local PLMN to perform charging.\n-\tFor restricted ProSe Direct Discovery, the HPLMN ProSe Function shall include in the Discovery Authorization Request  the Discovery Entry ID and the Discovery Type set to \"MONITORING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY, the application identity, the requesting RPAUID, target RPAUID and target PDUID of a monitoring target. The Discovery Authorization Request shall also include the UE identity (i.e., IMSI or MSISDN) in order to allow the ProSe Function in local PLMN to perform charging.\n-\tFor restricted ProSe Direct Discovery model B discoveree operation, the HPLMN ProSe Function shall include in the Discovery Authorization Request the Discovery Entry ID and the Discovery Type set to the indicate \"DISCOVERER_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the application identity, the requesting RPAUID, target RPAUID and target PDUID of a monitoring target. The request shall include the UE identity (IMSI or MSISDN) and the Discovery Entry ID in order to allow the ProSe Function in local PLMN to perform charging.\nWhen receiving the ProSe Direct Discovery Authorization response with the Result Code set to \"DIAMETER_SUCCESS\" for a request with the Discovery Type set to \"MONITORING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the HPLMN ProSe Function shall check whether a ProSe Discovery Filter is received for each ProSe Application ID Name sent in the request. If a ProSe Discovery Filter is missing for one ProSe Application ID Name, the ProSe Function shall consider that there is no valid ProSe Discovery Filter the ProSe associated with this ProSe Application ID Name in the ProSe Function in the local PLMN or VPLMN.\n\n\n5.3.3\tDetailed behaviour of the ProSe Function in the local PLMN or VPLMN\nWhen receiving a ProSe Direct Discovery Authorization request, the ProSe Function in the local PLMN or VPLMN shall check the value of the Discovery Type.\n-\tIf the value is \"ANNOUNCING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall check if the UE is authorized to announce in the PLMN.\n-\tIf the UE is not authorized, the experimental result code shall be set to \"DIAMETER_ERROR_ANNOUNCING_UNAUTHORIZED_IN_PLMN\" in the response sent by the ProSe Function.\n-\tIf the UE is authorized, the result code shall be set to \"DIAMETER_SUCCESS\" in the response sent by the ProSe Function. The ProSe Function shall store the UE identity (i.e., IMSI or MSISDN) in order to perform charging In addition, the ProSe Function in the VPLMN shall store the ProSe Validity Timer corresponding to ProSe Application Code in order to perform charging.\n\tIf the value is \"ANNOUNCING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall check whether the UE is authorized to announce in the PLMN for restricted discovery model A.\n-\tIf the UE is not authorized, the experimental result code shall be set to \"DIAMETER_ERROR_ANNOUNCING_NOT_AUTHORIZED\" in the response sent by the ProSe Function.\n-\tIf the UE is authorized, the result code shall be set to \"DIAMETER_SUCCESS\" in the response sent by the ProSe Function. The ProSe Function in the VPLMN shall store the UE identity (IMSI or MSISDN) in order to perform charging;\n-\tProSe Function in the VPLMN shall store the Application Identity, and the ProSe Validity Timer corresponding to ProSe Restricted Code or ProSe Restricted Code Prefix and ProSe Restricted Code Suffix(es) in order to perform charging.-\tIf the value is \"DISCOVERER_ANNOUNCING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall check whether the UE is authorized to announce in the PLMN for restricted discovery model B discoveree operation.\n-\tIf the UE is not authorized, the experimental result code shall be set to \"DIAMETER_ERROR_ANNOUNCING_UNAUTHORIZED_IN_PLMN\" in the response sent by the ProSe Function.\n-\tIf the UE is authorized, the result code shall be set to \"DIAMETER_SUCCESS\" in the response sent by the ProSe Function. The ProSe Function in the VPLMN shall store the UE identity (IMSI or MSISDN) in order to perform charging;\n-\tProSe Function in the VPLMN shall store the Application Identity, and the ProSe Validity Timer corresponding to ProSe Response Code in order to perform charging.\n-\tIf the value is \"DISCOVERER_ANNOUNCING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall check whether the UE is authorized to announce in the PLMN for restricted discovery model B discoverer operation.\n-\tIf the UE is not authorized, the experimental result code shall be set to \"DIAMETER_ERROR_ANNOUNCING_UNAUTHORIZED_IN_PLMN\" in the response sent by the ProSe Function.\n-\tIf the UE is authorized, the result code shall be set to \"DIAMETER_SUCCESS\" in the response sent by the ProSe Function. The ProSe Function in the VPLMN shall store the UE identity (IMSI or MSISDN), the Application Identity and the ProSe Validity Timer corresponding to ProSe Query Code in order to perform charging;\n-\tIf the value is \"MONITORING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall check whether one or more Discovery Filter(s) exist for each ProSe Application ID name received in the request.\n-\tIf there is no valid Discovery Filter associated to the ProSe Application ID name in the request, the experimental result code shall be set to \"DIAMETER_ERROR_NO_ASSOCIATED_DISCOVERY_FILTER\" in the response sent by the ProSe Function.\n-\tIf there exists one or more valid Discovery Filters related to the ProSe Application ID name, the ProSe Function shall return the Discovery Authorization Response including the Discovery Filter(s) along with the Discovery Entry ID and set the result code to \"DIAMETER_SUCCESS\" in the response. If the announcing UE is roaming, the PLMN-Id of the VPLMN shall be included in the Discovery Authorization Response.\n-\tIf the value is \"MONITORING_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall process the request in the following order to check if the monitoring is authorized.\n-\tThe ProSe function shall check whether the target PDUID is known and belongs to its own PLMN. If not, the experimental result code shall be set to \"DIAMETER_ERROR_INVALID_TARGET_PDUID\" in the response sent by the ProSe Function.\n-\tThe ProSe function may check whether the requesting RPAUID is allowed to discover the target RPAUID. If not, the experimental result code shall be set to \"DIAMETER_ERROR_INVALID_TARGET_RPAUID\" in the response sent by the ProSe Function.\n-\tThe ProSe function shall check whether a valid ProSe Restricted Code or ProSe Restricted Code Prefix exists for the target RPAUID included in the request.\n-\tIf not, the experimental result code shall be set to \"DIAMETER_ERROR_NO_ASSOCIATED_RESTRICTED_CODE\" in the response sent by the ProSe Function.\n-\tOtherwise, the ProSe Function shall set the result code to \"DIAMETER_SUCCESS\" in the response. The ProSe Function shall return the Discovery Authorization Response including the ProSe Restricted Code or ProSe Restricted Code Prefix associated with the target RPAUID and its corresponding Validity Timer. If the announcing UE is roaming, the PLMN-Id of the VPLMN shall be also included in the response.\n-\tIf the value is \"DISCOVERER_REQUEST_FOR_RESTRICTED_PROSE_DIRECT_DISCOVERY\", the ProSe Function shall process the request in the following order to check whether the monitoring is authorized.\n-\tThe ProSe function shall check if the target PDUID is known and belongs to its own PLMN. If not, the experimental result code shall be set to \"DIAMETER_ERROR_INVALID_TARGET_PDUID\" in the response sent by the ProSe Function.\n-\tThe ProSe function may check if the requesting RPAUID is allowed to discovery the target RPAUID. If not, the experimental result code shall be set to \"DIAMETER_ERROR_INVALID_TARGET_RPAUID\" in the response sent by the ProSe Function.\n-\tThe ProSe function shall check if both ProSe Query Code and ProSe Response Code exist for the target RPAUID included in the request.\n-\tIf not, the experimental result code shall be set to \"DIAMETER_ERROR_NO_ASSOCIATED_RESTRICTED_CODE\" in the response sent by the ProSe Function.\n-\tOtherwise, the ProSe Function shall set the result code to \"DIAMETER_SUCCESS\" in the response. The ProSe Function shall return the Discovery Authorization Response including the ProSe Query Code and ProSe Response Code Code associated with the target RPAUID and its corresponding Validity Timer. If the announcing UE is roaming, the PLMN-Id of the VPLMN shall be also included in the response.\nIf the ProSe Function cannot fulfil the received request for reasons not stated in the above steps, e.g. due to a database error or any of the required actions cannot be performed, it shall set the Result Code to \"DIAMETER_UNABLE_TO_COMPLY\".\n***** Next change *****\n6.3.1\tGeneral\nThe following table (table 6.3.1-1) specifies the Diameter AVPs defined for the PC6/PC7 interfaces, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted. The Vendor-ID header of all AVPs defined in this specification shall be set to 3GPP (10415).\nFor all AVPs which contain bit masks and are of the type Unsigned32 e.g., PRR-Flags, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x0001 shall be used.\nTable 6.3.1-1: PC6/PC7 specific Diameter AVPs\n\tAVP Flag rules\nAttribute Name\tAVP Code\tClause\t defined\tValue Type\tMust\tMay\tShould not\tMust not\tMay Encr.\nApp-Layer-User-Id\t3801\t6.3.2\tUTF8String\tM, V\t\t\t\tNo\nAssistance-info\t3802\t6.3.3\tGrouped\tM, V\t\t\t\tNo\nAssistance-Info-Validity-Timer\t3803\t6.3.4\tUnsigned32\tM, V\t\t\t\tNo\nDiscovery-Type\t3804\t6.3.5\tUnsigned32\tM, V\t\t\t\tNo\nFilter-Id\t3805\t6.3.9\tOctetString\tM, V\t\t\t\tNo\nMAC-Address\t3806\t6.3.11\tUTF8String\tM, V\t\t\t\tNo\nMatch-Report\t3807\t6.3.12\tGrouped\tM, V\t\t\t\tNo\nOperating-Channel\t3808\t6.3.14\tUnsigned32\tM, V\t\t\t\tNo\nP2P-Features\t3809\t6.3.15\tUnsigned32\tM, V\t\t\t\tNo\nProSe-App-Code\t3810\t6.3.16\tOctetString\tM, V\t\t\t\tNo\nProSe-App-Id\t3811\t6.3.17\tUTF8String\tM, V\t\t\t\tNo\nProSe-App-Mask\t3812\t6.3.18\tOctetString\tM, V\t\t\t\tNo\nProSe-Discovery-Filter\t3813\t6.3.20\tGrouped\tM, V\t\t\t\tNo\nPRR-Flags\t3814\t6.3.21\tUnsigned32\tM, V\t\t\t\tNo\nProSe-Validity-Timer\t3815\t6.3.22\tUnsigned32\tM, V\t\t\t\tNo\nRequesting-EPUID\t3816\t6.3.23\tUTF8String\tM, V\t\t\t\tNo\nTargeted-EPUID\t3817\t6.3.26\tUTF8String\tM, V\t\t\t\tNo\nTime-Window\t3818\t6.3.27\tUnsigned32\tM, V\t\t\t\tNo\nWiFi-P2P-Assistance-Info\t3819\t6.3.30\tGrouped\tM, V\t\t\t\tNo\nWLAN-Assistance-Info\t3820\t6.3.31\tGrouped\tM, V\t\t\t\tNo\nWLAN-Link-Layer-Id\t3821\t6.3.32\tOctetString\tM, V\t\t\t\tNo\nWLAN-Link-Layer-Id-List\t3822\t6.3.33\tGrouped\tM, V\t\t\t\tNo\nLocation-Update-Trigger\t3823\t6.3.42\tGrouped\tM,V\t\t\t\tNo\nLocation-Update-Event-Type\t3824\t6.3.43\tUnsigned32\tM,V\t\t\t\tNo\nChange-Of-Area-Type\t3825\t6.3.44\tGrouped\tM,V\t\t\t\tNo\nLocation-Update-Event-Trigger\t3826\t6.3.45\tUnsigned32\tM,V\t\t\t\tNo\nReport-Cardinality\t3827\t6.3.46\tEnumerated\tM,V\t\t\t\tNo\nMinimum-Interval-Time\t3828\t6.3.47\tUnsigned32\tM,V\t\t\t\tNo\nPeriodic-Location-Type\t3829\t6.3.48\tGrouped\tM,V\t\t\t\tNo\nLocation-Report-Interval-Time\t3830\t6.3.49\tUnsigned32\tM,V\t\t\t\tNo\nTotal-Number-Of-Reports\t3831\t6.3.50\tUnsigned32\tM,V\t\t\t\tNo\nValidity-Time-Announce\t3832\t6.3.36\tUnsigned32\tM, V\t\t\t\tNo\nValidity-Time-Monitor\t3833\t6.3.37\tUnsigned32\tM, V\t\t\t\tNo\nValidity-Time-Communication\t3834\t6.3.38\tUnsigned32\tM, V\t\t\t\tNo\nProSe-App-Code-Info\t3835\t6.3.39\tGrouped\tM. V\t\t\t\tNo\nMIC\t3836\t6.3.40\tOctetString\tM, V\t\t\t\tNo\nUTC-based-Counter\t3837\t6.3.41\tUnsigned32\tM. V\t\t\t\tNo\nProSe-Match-Refresh-Timer\t3838\t6.3.52\tUnsigned32\tM, V\t\t\t\tNo\nProSe-Metadata-Index-Mask\t3839\t6.3.60\tOctetString\tV\t\t\tM\tNo\nApp-Identifier\t3840\t6.3.61\tGroup\tV\t\t\tM\tNo\nOS-ID\t3841\t6.3.62\tOctetString\tV\t\t\tM\tNo\nOS-App-ID\t3842\t6.3.63\tUTF8String\tV\t\t\tM\tNo\nRequesting-RPAUID\t3843\t6.3.64\tUTF8String\tV\t\t\tM\tNo\nTarget-RPAUID\t3844\t6.3.65\tUTF8String\tV\t\t\tM\tNo\nTarget-PDUID\t3845\t6.3.66\tOctetString\tV\t\t\tM\tNo\nProSe-Restricted-Code\t3846\t6.3.67\tOctetString\tV\t\t\tM\tNo\nProSe-Restricted-Code-Suffix-Range\t3847\t6.3.68\tOctetString\tV\t\t\tM\tNo\nBeginning-Suffix\t3848\t6.3.69\tOctetString\tV\t\t\tM\tNo\nEnding-Suffix\t3849\t6.3.70\tOctetString\tV\t\t\tM\tNo\nDiscovery-Entry-ID\t3850\t6.3.59\tUnsigned32\tV\t\t\tM\tNo\nMatch-Timestamp\t3851\t6.3.71\tTime\tV\t\t\tM\tNo\nPMR-Flags\t3852\t6.3.57\tUnsigned32\tM,V\t\t\t\tNo\nProSe-Application-Metadata\t3853\t6.3.58\tUTF8String\tM,V\t\t\t\tNo\nDiscovery-Auth-Request\t3854\t6.3.53\tGrouped\tM, V\t\t\t\tNo\nDiscovery-Auth-Response\t3855\t6.3.54\tGrouped\tM, V\t\t\t\tNo\nMatch-Request\t3856\t6.3.55\tGrouped\tM, V\t\t\t\tNo\nMatch-Report-Info\t3857\t6.3.56\tGrouped\tM, V\t\t\t\tNo\n\n\n\n\n\n\n\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\" indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF\u00a0RFC\u00a03588\u00a0[7]. \tNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\n\nThe following table (table 6.3.1-2) specifies the Diameter AVPs re-used by the PC6/PC7 interfaces from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within PC6/PC7 interfaces. \nAny other AVPs from existing Diameter Applications, except for the AVPs from Diameter Base Protocol, do not need to be supported. The AVPs from Diameter Base Protocol are not included in table 6.3.1-2.\nTable 6.3.1-2: PC6/PC7 re-used Diameter AVPs\nAttribute Name\tReference\tComments\tM-bit\nSupported-Features\t3GPP\u00a0TS\u00a029.229\u00a0[10]\nEAP-Master-Session-Key\tIETF\u00a0RFC\u00a04072\u00a0[12]\nFeature-List-ID\t3GPP\u00a0TS\u00a029.229\u00a0[10]\nFeature-List\t3GPP\u00a0TS\u00a029.229\u00a0[10]\tSee subclause 7.3.10\nMSISDN\t3GPP\u00a0TS\u00a029.329\u00a0[5]\nUser-Name\tIETF\u00a0RFC\u00a03588\u00a0[7]\nLocation-Estimate\t3GPP\u00a0TS\u00a032.299\u00a0[13]\nProSe-Direct-Allowed\t3GPP\u00a0TS\u00a029.344\u00a0[14]\nAuthorized-Discovery-Range\t3GPP\u00a0TS\u00a029.344\u00a0[14]\nSSID\t3GPP\u00a0TS\u00a029.273\u00a0[15]\nVisited-PLMN-Id\t3GPP\u00a0TS\u00a029.272\u00a0[16]\nUser-Identifier\t3GPP\u00a0TS\u00a029.336\u00a0[18]\nOC-Supported-Features\tIETF RFC 7683 [21]\tSee subclause 6.3.34\tMust set\nOC-OLR\tIETF RFC 7683 [21]\tSee subclause 6.3.35\tMust set\nNOTE 1: \tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies. \tNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\n\n\n***** Next change *****\n6.3.54\tDiscovery-Auth-Response\nThe Discovery-Auth-Response is of type Grouped. It shall contain the information elements used in ProSe direct discovery authorization answer.\nThe AVP format shall conform to:\n\t\tDiscovery-Auth-Response ::=\t\t<AVP header: 3855 10415>\n{ Discovery-Type }\n*[ ProSe-Discovery-Filter ]\n[ Visited-PLMN-Id ]\n\n\n\n\n\n\n\n*[AVP]\nWhen the Discovery-Type is set to \"ANNOUNCING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the Discovery-Auth-Response shall contain no other parameters.\nWhen the Discovery-Type is set to \"MONITORING_REQUEST_FOR_OPEN_PROSE_DIRECT_DISCOVERY\", the Discovery-Auth-Response shall contain one or more ProSe Discovery Filters, and optionally a PLMN ID.\n\n\n\n***** First change *****\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n***** End of changes *****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 33.303 v13.2.0 subclause 6.1.3.4.2.1 specifies the security flows for restricted ProSe direct discovery model A.In Step 9, the specification says:The ProSe Function in the HPLMN of the Announcing UE responds to the ProSe Function in the HPLMN of the Monitoring UE with a Monitor Response message including the ProSe Code, the corresponding Code-Receiving Security Parameters (see subclause 6.1.3.4.3.3) and an optional Discovery User Integrity Key (DUIK). The Code-Receiving Security Parameters provide the information needed by the Monitoring UE to undo the protection applied by the announcing UE. The DUIK shall be included as a separate parameter if the Code-Receiving Security Parameters indicate that the Monitoring UE shall use Match Reports for MIC checking. The ProSe Function in the HPLMN of the Monitoring UE stores the ProSe Code and the Discovery User Integrity Key (if it received one outside of the Code-Receiving Security Parameters). Similarly, security materials are also needed for restricted ProSe direct discovery model B discoverer procedures, as stated in step 9 of TS 33.303 subclause 6.1.3.4.2.2:The ProSe Function in the HPLMN of the Discoveree UE responds to the ProSe Function in the HPLMN of the Discoverer UE with a Discovery Response message including the ProSe Query Code(s) and their associated Code-Sending Security Parameters, ProSe Response Code and its associated Code-Receiving Security Parameters (see subclause 6.1.3.4.3.3), and an optional Discovery User Integrity Key (DUIK) for the ProSe Response Code. The Code-Receiving Security Parameters provide the information needed by the Discoverer UE to undo the protection applied by the Discoveree UE. The DUIK shall be included as a separate parameter if the Code-Receiving Security Parameters indicate that the Discoverer UE shall use Match Reports for MIC checking. The ProSe Function in the HPLMN of the Discoverer UE stores the ProSe Response Code and the Discovery User Integrity Key (if it received one outside of the Code-Receiving Security Parameters). The Code-Sending Security Parameters provide the information needed by the Discoveree UE to protect the ProSe Query Code (see subclause 6.1.3.4.3.2) These new security-related parameters to be added to the Discovery Authorization procedure for restricted discovery announcing in stage 3 TS.\n\n>>> SUMMARY OF CHANGE\nAdded DUCK, DUIK and DUSK to the abbreviations list. Updated the procedure description for discovery authorization to include the sending and receiving of security materials in both the HPLMN ProSe Function and the peer ProSe Function(s).2. Added the necessary new AVP definitions in subclause 6.3.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe ProSe Function will be unable to deliver security materials for the UEs to protect the discovery messages for restricted discovery."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n================== START OF CHANGE ==================\n\n9.2.2\tFrom UTRAN to E-UTRAN\n9.2.2.1\tProcedures\nIf UP ciphering in UTRAN is activated, then UP ciphering shall remain activated in E-UTRAN after handover as well.\nIntegrity protection on NAS is mandatory for both E-UTRAN and UTRAN\nSGSN shall transfer CK and IK to MME in the relocation request message. MME and UE shall derive K'ASME from CK and IK with the help of a one-way key derivation function as defined in Annex X.MME and UE shall derive the NAS keys and KeNB from K'ASME.\nSGSN shall be informed by the UE about its EPS security capabilities. This happens via the MS Network Capability IE, that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nSGSN transfers UE's EPC/E-UTRAN security capabilities to MME in the relocation request message. MME shall select the NAS security algorithms and include the allowed UP/RRC algorithms as well as the RRC and UP keys in the relocation request to the target eNB. eNB shall select the RRC and UP algorithms and indicate them in the relocation request acknowledgement. MME shall include the selected NAS, UP, and RRC algorithms in the relocation response sent to SGSN. SGSN shall include them in the relocation command and RNC shall indicate them to UE in the handover from UTRAN command.\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE 3: The issues raised by Editors NOTE's 1 to 4 of section 9.1.2 are also valid here. \nEditor's NOTE: In case the selected AS level algorithm on active mode handover is used to integrity protect the TAU Request creates problems in the MME (i.e. the MME does not know the selected AS algorithm), then the default algorithm solution as used in the idle mode mobility is used\nUE uses the converted keys from the source system to protect the TAU Request and include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\nIf EPS does not have the previous EPS security context for the UE indicated in the TAU Request, or if EPS does not activate the previous EPS security context indicated in the TAU Request, The newly generated keys or the previous EPS security context shall be taken into operation as soon as possible.\n9.2.2.2\tKey Derivation during Handover\nSGSN shall transfer CK and IK to MME in the relocation request message. MME and UE shall derive K'ASME from CK and IK with the help of a one-way key derivation function KDF as specified in Annex X. \nK'ASME = KDF(CK || IK) . MME and UE shall derive the NAS keys and KeNB from K'ASME.\nDuring UTRAN to E-UTRAN HO, MME sets NAS COUNT equal to zero and uses it with K'ASME (derived from CK and IK) to derive Kenb by applying the KDF defined in annex X for IDLE to CONNECTED transition. The MME distributes the KeNB to the eNB in the Handover Request message. The UE derives the KeNB in the same way the MME did.\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nEditor's Note: The following problems needs to be addressed at inter RAT handover:\nThere must be a way to derive the K_eNB in the UE and in the MME before the handover request message is sent from the MME to the eNB. This can be solved by using setting NAS COUNT to zero in case the mapped EPS security context always provides a fresh K_ASME.\nWhen a cached EPS security context exists, and the UE moves from E-UTRAN to UTRAN, the CK/IK derived in UTRAN will always be the same as long as the K_ASME is the same (this is a problem for UTRAN). This, in turn results in that when the UE moves back into E-UTRAN the same mapped K_ASME would be used with a NAS COUNT of zero and hence the K_eNB as well as the NAS keys will be the same again (this is a problem for E-UTRAN).\nKey separation between different target eNBs when doing handover from UTRAN/GERAN to E-UTRAN is solved by using a cached EPS security context or by running an AKA in E-UTRAN as soon as possible after the handover and needs no further consideration.\n================== END OF CHANGE ==================\n\n================== START OF CHANGE ==================\n10.2.2\tFrom GERAN to E-UTRAN\n10.2.2.1\tProcedures\nIf UP ciphering was activated in GERAN, it shall remain activated in E-UTRAN after handover from GERAN to E-UTRAN as well.\nSGSN shall be informed by the UE about its EPS security capabilities. This happens via the MS Network Capability IE, that is extended to include also E-UTRAN capabilities, in Attach Request and RAU Request.\nSGSN transfers UE's EPC/E-UTRAN security capabilities to MME in the relocation request message. MME shall select the NAS security algorithms and include the allowed UP/RRC algorithms as well as the RRC and UP keys in the relocation request to the target eNB. eNB shall select the RRC and UP algorithms and indicate them in the relocation request acknowledgement. MME shall include the selected NAS, UP, and RRC algorithms in the relocation response sent to SGSN. SGSN shall indicate them in the appropriate message to BSS and BSS shall indicate them to UE in the handover command.\nTAU Request message shall be integrity protected with one of the default EPS algorithms.\nEditors NOTE: The issues raised by Editors NOTE's 1 to 4 of section 9.1.2 are also valid here. \nEditor's NOTE: In case the selected AS level algorithm on active mode handover is used to integrity protect the TAU Request creates problems in the MME (i.e. the MME does not know the selected AS algorithm), then the default algorithm solution as used in the idle mode mobility is used\nUE uses the converted keys from the source system to protect the TAU Request and include the corresponding needed source system temporary identities and KSI value to point to the right source SGSN and key set. In addition if UE has previous EPS security context, UE shall include corresponding E-UTRAN temporary identities and KSIASME to point to the right MME and key set into the TAU Request.\nIf EPS does not have the previous EPS security context for the UE indicated in the TAU Request, or if EPS does not activate the previous EPS security context indicated in the TAU Request, The newly generated keys or the previous EPS security context shall be taken into operation as soon as possible.\n10.2.2.2\tKey Derivation during Handover\n\nSGSN shall transfer CK and IK to MME in the relocation request message. MME shall derive K'ASME from CK and IK as described in the UTRAN to E-UTRAN handover case.\nEditor's Note: It is for ffs whether the KDF shall be performed by the SGSN or not at all.\nDuring GERAN to E-UTRAN handover, the MME sets the NAS COUNT equal to zero and uses it with K'ASME (derived from CK and IK) to derive Kenb by applying the KDF defined in annex X for IDLE to CONNECTED transition. The MME distributes the KeNB to the eNB in the Handover Request message. The UE derives the KeNB in the same way the MME did.\nEditor's Note: The following problems needs to be addressed at inter RAT handover:\nThere must be a way to derive the K_eNB in the UE and in the MME before the handover request message is sent from the MME to the eNB. This can be solved by using setting NAS COUNT to zero in case the mapped EPS security context always provides a fresh K_ASME.\nWhen a cached EPS security context exists, and the UE moves from E-UTRAN to GERAN, the CK/IK derived in GERAN will always be the same as long as the K_ASME is the same (this is a problem for GERAN). This, in turn results in that when the UE moves back into E-UTRAN the same mapped K_ASME would be used with a NAS COUNT of zero and hence the K_eNB as well as the NAS keys will be the same again (this is a problem for E-UTRAN).\nKey separation between different target eNBs when doing handover from UTRAN/GERAN to E-UTRAN is solved by using a cached EPS security context or by running an AKA in E-UTRAN as soon as possible after the handover and needs no further consideration.\n\n\n================== END OF CHANGE ==================\n================== START OF CHANGE ==================\nA.11 KASME from and to CK, IK derivation (S10)\nThis input string is used when there is a need to derive a KASME from CK/IK and vice versa during mapping of security contexts between E-UTRAN and GERAN/UTRAN. KASME is a 256-bit entity, and so is the concatenation of CK and IK (which are 128 bits each). Therefore, the derivation function mapping 256 bits to 256 bits can be applied in both directions (using a constant in the input S to separate the directions from each other). The following input parameters shall be used.\n-\tFC = 0x11,\n-\tP0 = key output type,\n-\tL0 = length of key output type (i.e. 0x00 0x01)\nEditor's NOTE: It is FFS if more input parameters are required to counter the threat identified by ETSI/SAGE in the LS to SA3 received in SA3#28 (S3-030219).\nIf the KDF is used to derive a KASME from the concatenation CK || IK, then the key output type shall be 0x00. If the KDF is used to derive CK || IK from a KASME, then the key output type shall be 0x01.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n================== END OF CHANGE ==================\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nBased on the key derivation function as specified by TS 33.401 v800 key reuse is possible in E-UTRAN when the UE moves between UTRAN and E-UTRAN multiple times. The S4 SGSN which interworks with the MME may provide the same CK and IK multiple times for the MME if the context is cached in the S4 SGSN. MME uses the mapped security context based on K'ASME derived exclusively from CK, IK because MME did not cache a security context, or has already deleted it, or prefers to use the mapped context for performance reasons in HO in spite of the availability of a cached context. This results in K'ASME repetition in MME, and all resulting NAS keys and the KeNB which is sent to the eNB, will be the same.\n\n>>> SUMMARY OF CHANGE\nAdd a solution that ensures a fresh security context in MME on handover from an SGSN independent from the SGSN release.\n\n>>> CONSEQUENCES IF NOT REVISED\nWithout a solution that ensures a fresh mapped security context on handover from SGSN to MME the system will be left vulnerable to attacks due to potential key reuse in E-UTRAN."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n*************** Start of Change 1 ****************\nB.2.2\tFC value allocations\nFC values shall only be assigned to a key derivation function by their allocated specification.\nFC values in the range 0x00 \u2013 0x0F are allocated for use in this specification.\nFC values in the range 0x10 \u2013 0x1F are allocated for use in TS 33.401 [35].\nFC values in the range 0x20 \u2013 0x2F are allocated for use in TS 33.402 [36].\nFC values in the range 0x30 \u2013 0x37 are allocated for use in TS 33.102 [2]. \nFC values in the range 0x38 \u2013 0x3F are allocated for use in TS 43.020 [47].\nFC values in the range 0x40 \u2013 0x47 are allocated for use in TS 33.224 [39].\nFC values in the range 0x48 \u2013 0x4F are allocated for use in TS 33.303 [49]. \nFC values in the range 0x50 \u2013 0x57 are allocated for use in TS 33.179 [50]. \nFC values in the range 0x58 \u2013 0x5F are allocated for use in TS 33.203 [51]. \nFC values in the range 0x60 \u2013 0x68 are allocated for use in TS 33.163 [52]. \nFC values in the range 0x69\u2013 0x79 are  allocated for use in TS 33. 501 [53 ].\n\nFC values in range 0x7A  \u2013 0xDF are reserved for future use in 3GPP specifications.\nFC values in the range 0xE0 \u2013 0xEF are reserved for uses of the KDF by other standardization organisations where the FC value for such use is registered in the present specification.\nFC values in the range 0xF0 \u2013 0xFE are reserved for proprietary uses of the KDF where the FC value for the such use is not registered with 3GPP.\nFC values of the form 0xFF || FC2 are reserved for future use in 3GPP specifications.\nNOTE 1:\tRegistering an FC value with 3GPP for use by other standardization organisations means that only the FC value is recorded in the present specification, but the full specification of the key derivation is done elsewhere. This has the advantage that clashes in FC values in different uses by other standardization organisations can be avoided. On the other hand, not registering an FC value with 3GPP for proprietary use means that 3GPP may have no knowledge of this use at all. \nNOTE 2:\tRanges of FC values for use by other standardization organisations or for proprietary use could be extended in the future if such a need was indicated to 3GPP. \n\n*************** End of Change 1 **************\n\n\n*************** Start of Change 2 ****************\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the USIM application\".\n[2]\t3GPP\u00a0TS\u00a033.102: \"3G Security; Security architecture\".\n[3]\tIETF\u00a0RFC\u00a02617: \"HTTP Authentication: Basic and Digest Access Authentication\".\n[4]\tIETF\u00a0RFC\u00a03310: \"Hypertext Transfer Protocol (HTTP) Digest Authentication Using Authentication and Key Agreement (AKA)\".\n[5]\t3GPP\u00a0TS\u00a033.221: \"Generic Authentication Architecture (GAA); Support for Subscriber Certificates\".\n[6]\tVoid\n[7]\tVoid\n[8]\t3GPP\u00a0TS\u00a023.228: \"IP Multimedia Subsystem (IMS); Stage 2 (Release 6)\".\n[9]\tVoid.\n[10]\t3GPP\u00a0TS\u00a031.103: \"Characteristics of the IP Multimedia Services Identity Module (ISIM) application\".\n[11]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[12]\tIETF\u00a0RFC\u00a03548: \"The Base16, Base32, and Base64 Data Encodings\".\n[13]\t3GPP\u00a0TS\u00a033.210: \"3G Security; Network domain security; IP network layer security\".\n[14]\tVoid.\n[15]\t3GPP\u00a0TS\u00a031.101: \"UICC-terminal interface; Physical and logical characteristics\".\n[16]\t3GPP\u00a0TS\u00a033.203: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; 3G security; Access security for IP-based services\".\n[17]\tVoid.\n[18]\tIETF\u00a0RFC\u00a02818: \"HTTP over TLS\".\n[19]\t3GPP\u00a0TS\u00a033.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[20]\tVoid.\n[21]\tVoid.\n[22]\tIETF RFC 2104: \"HMAC: Keyed-Hashing for Message Authentication\".\n[23]\tISO/IEC 10118-3:2004: \"Information Technology \u2013 Security techniques \u2013 Hash-functions \u2013 Part 3: Dedicated hash-functions\".\n[24]\tIETF\u00a0RFC\u00a03629: \"UTF-8, a transformation format of ISO 10646\".\n[25]\t3GPP\u00a0TS\u00a033.222: \"Generic Authentication Architecture (GAA); Access to network application functions using Hypertext Transfer Protocol over Transport Layer Security (HTTPS)\".\n[26]\t3GPP\u00a0TS\u00a033.246: \"3G Security; Security of Multimedia Broadcast/Multicast Service (MBMS)\".\n[27]\tVoid.\n[28]\tIETF\u00a0RFC\u00a02246: \"The TLS Protocol Version 1\".\n[29]\t3GPP\u00a0TS\u00a024.109: \"Bootstrapping interface (Ub) and network application function interface (Ua); Protocol details\".\n[30]\t(void)\n[31]\t(void)\n[32]\t3GPP\u00a0TS\u00a029.109: \"Generic Authentication Architecture (GAA); Zh and Zn Interfaces based on the Diameter protocol; Stage\u00a03\".\n[33]\tIETF\u00a0RFC\u00a02616: \"Hypertext Transfer Protocol -- HTTP/1.1\".\n[34]\t3GPP TS 23.002: \u201cNetwork architecture \u201c.\n[35]\t3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security Architecture\".\n[36]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses\".\n[37]\t\"Unicode Standard Annex #15; Unicode Normalization Forms\", Unicode 5.1.0, March 2008.  \n[38]\t3GPP TS 26.237: \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols\".\n[39]\t3GPP TS 33.224: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push Layer\".\n[40]\t3GPP TS 33.328: \"IMS Media plane security\".\n[41]\tIETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version 1.2\".\n[42]\t(void)\n[43]\tVoid.\n[44]\tIETF\u00a0RFC\u00a05705: \"Keying Material Exporters for Transport Layer Security (TLS)\".\n[45]\t3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function\".\n[46]\t3GPP TS 44.006 \"Technical Specification Group GSM/EDGE Radio Access Network; Mobile Station - Base Station System (MS - BSS) interface; Data Link (DL) layer specification\".\n[47]\t3GPP TS 43.020 \"Technical Specification Group Services and system Aspects; Security related network functions\".\n[48]\tIETF RFC 5929 \"Channel Bindings for TLS\".\n[49]\t3GPP TS 33.303: \"Proximity-based Services; Security Aspects\".\n[50]\t3GPP TS 33.179: \"Security of Mission Critical Push-To-Talk (MCPTT)\". \n[51]\t3GPP TS 33.203: \"3G security; Access security for IP-based services\".\n[52]\t3GPP TS 33.163: \" Battery Efficient Security for very low Throughput Machine Type Communication (MTC) devices (BEST)\".\n[53]\t3GPP TS 33.501: \" Security architecture and procedures for 5G system\".\n\n\n*************** End of Change 2 **************\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nFC value for CAPIF security is determined.\n\n>>> SUMMARY OF CHANGE\nFC valuse for CAPIF security is introduced.\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is no FC valuse for CAPIF security"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n***** Next change *****\n5.5.1.1\tGeneral\nThe attach procedure is used to attach to an EPC for packet services in EPS.\nThe attach procedure is used for three purposes:\n-\tby a UE in PS mode of operation to attach for EPS services only;\n-\tby a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services; or\n-\tto attach for emergency bearer services.\nThe lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP\u00a0TS\u00a036.331\u00a0[22]). This information is taken into account when deciding whether to initiate attach for emergency bearer services.\nIf the MME does not support an attach for emergency bearer services, the MME shall reject any request to attach with an attach type set to \"EPS emergency attach\".\nWith a successful attach procedure, a context is established for the UE in the MME, and a default bearer is established between the UE and the PDN GW, thus enabling always-on IP connectivity to the UE. The network may also initiate the activation of dedicated bearers as part of the attach procedure.\nDuring the attach procedure, the UE may also obtain the home agent IPv4 or IPv6 address or both.\nIn a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP\u00a0TS\u00a023.122\u00a0[6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received as part of the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP\u00a0TS\u00a036.331\u00a0[22]). Whenever an ATTACH REJECT message with the EMM cause #11 \"PLMN not allowed\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMN list\". Whenever an ATTACH REJECT message with the EMM cause #14 \"EPS services not allowed in this PLMN\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMNs for GPRS service\". Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12\u00a0\"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", or #15 \"no suitable cells in tracking area\", the constructed TAI shall be stored in the suitable list.\nAn attach attempt counter is used to limit the number of subsequently rejected attach attempts. The attach attempt counter shall be incremented as specified in subclause\u00a05.5.1.2.6. Depending on the value of the attach attempt counter, specific actions shall be performed. The attach attempt counter shall be reset when:\n-\tthe UE is powered on;\n-\ta USIM is inserted;\n-\tan attach or combined attach procedure is successfully completed;\n-\ta GPRS attach or combined GPRS attach procedure is successfully completed in A/Gb or Iu mode;\n-\ta combined attach procedure is completed for EPS services only with cause #2, #16, #17, #18 or #22;\n-\tan attach or combined attach procedure is rejected with cause #11, #12, #13, #14, #15, #25 or #35:\n-\ta network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or\n-\ta new PLMN is selected.\nAdditionally the attach attempt counter shall be reset when the UE is in substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and:\n-\ta new tracking area is entered;\n-\ttimer T3402 expires; or\n-\ttimer T3346 is started.\n***** Next change *****\n5.5.1.2.5\tAttach not accepted by the network\nIf the attach request cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure, or operator determined barring is applied on default EPS bearer context activation during attach procedure, the MME shall:\n-\tcombine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 \"ESM failure\"; or\n-\tsend the ATTACH REJECT message with the EMM cause set to #15 \"No suitable cells in tracking area\", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP\u00a0TS\u00a029.274\u00a0[16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value \"E-UTRAN not allowed\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nUpon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410.\nIf the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.\n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services and non-EPS services until switching off or the UICC containing the USIM is removed. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nNOTE:\tThe possibility to configure a UE so that the radio transceiver for a specific RAT is not active, although it is implemented in the UE, is out of scope of the present specification. \n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\n\tIn S1 mode, the UE shall store the PLMN identity in the \"forbidden PLMN list\" and enter state EMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value and no RR connection exists.\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\n\tIn S1 mode, the UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\n\tIn S1 mode, the UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\n\tIn S1 mode, the UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6]. \n\tIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\n\tIn S1 mode, the UE shall:\n-\tstore the current TAI in the list of \"forbidden tracking areas for roaming\" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE. AND\n-\tif the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the ATTACH REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP\u00a0TS\u00a024.368\u00a0[15A] or 3GPP\u00a0TS\u00a031.102\u00a0[17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause\u00a04.5 and search for a suitable cell in GERAN or UTRAN radio access technology; otherwise. the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.2.6.\n\tThe UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#25\t(Not authorized for this CSG);\n\tEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.6.\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a05.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\n#42\t(Severe network failure);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP\u00a0TS\u00a023.122\u00a0[6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.2.6.\n\n***** Next change *****\n5.5.1.3.4.3\tCombined attach successful for EPS services only\nApart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause\u00a05.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.\nThe UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t\t(IMSI unknown in HSS)\n\tThe UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed .\n#16\t(MSC temporarily not reachable); or\n#17\t(Network failure)\n\tThe UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\n\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered.\n\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause\u00a04.5).\n#18\t(CS domain not available)\n\tThe UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\n\tThe UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.\n\tA UE in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology  and disable the E-UTRA capability (see subclause\u00a04.5).\n\tA UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" may provide a notification to the user or the upper layers that the CS domain is not available.\n\tThe UE shall not attempt combined attach or combined tracking area update procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.\n#22\t(Congestion)\n\tThe UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to\u00a05. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and shall enter state MM IDLE.\nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.3.6.\n***** Next change *****\n5.5.1.3.5\tCombined attach not accepted by the network\nIf the attach request can neither be accepted by the network for EPS nor for non-EPS services, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure or operator determined barring, the MME shall:\n-\tcombine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, \"ESM failure\"; or\n-\tsend the ATTACH REJECT message with the EMM cause set to #15 \"No suitable cells in tracking area\" ,if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP\u00a0TS\u00a029.274\u00a0[16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value \"E-UTRAN not allowed\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nUpon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410 and enter MM state MM IDLE.\nIf the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.\n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI.\n\tThe UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tA UE which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\n\tThe UE shall attempt to select GERAN or UTRAN radio access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value and no RR connection exists.\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. Additionally the UE enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED. \n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause\u00a04.5).\n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tA UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\n\tIf the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the ATTACH REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP\u00a0TS\u00a024.368\u00a0[15A] or 3GPP\u00a0TS\u00a031.102\u00a0[17] is present and set to enabled, then the UE shall disable the E-UTRA capability as specified in subclause\u00a04.5 and search for a suitable cell in another location area; otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.6.\n\tThe UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#25\t(Not authorized for this CSG);\n\tEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.6.\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a05.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\n#42\t(Severe network failure);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP\u00a0TS\u00a023.122\u00a0[6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.3.6.\n***** Next change *****\n5.5.2.3.2\tNetwork initiated detach procedure completion by the UE\nWhen receiving the DETACH REQUEST message and the detach type indicates \"re-attach required\", the UE shall deactivate the EPS bearer context(s) including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall stop the timer T3346, if it is running. The UE shall also stop timer(s) T3396, if it is running. The UE shall send a DETACH ACCEPT message to the network and enter the state EMM-DEREGISTERED. Furthermore, the UE shall, after the completion of the detach procedure, and the release of the existing NAS signalling connection, initiate an attach or combined attach procedure. The UE should also re-establish any previously established PDN connection(s).\nNOTE\u00a01:\tWhen the detach type indicates \"re-attach required\", user interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nA UE which receives a DETACH REQUEST message with detach type indicating \"re-attach required\" or \"re-attach not required\" and no EMM cause IE, is detached only for EPS services.\nWhen receiving the DETACH REQUEST message and the detach type indicates \"IMSI detach\", the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. The UE shall set the MM update status to U2 NOT UPDATED. A UE may send a DETACH ACCEPT message to the network, and shall re-attach to non-EPS services by performing the combined tracking area updating procedure according to subclause\u00a05.5.3.3, sending a TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating \"combined TA/LA updating with IMSI attach\".\nIf the UE is attached for EPS and non-EPS services, then the UE shall set the update status to U2 NOT UPDATED if:\n-\tthe Detach type IE indicates \"re-attach required\"; or\n-\tthe Detach type IE indicates \"re-attach not required\" and no EMM cause IE is included.\nWhen receiving the DETACH REQUEST message and the detach type indicates \"re-attach not required\" and no EMM cause IE, or \"re-attach not required\" and the EMM cause value is not #2 \"IMSI unknown in HSS\", the UE shall deactivate the EPS bearer context(s) including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall then send a DETACH ACCEPT message to the network and enter state EMM-DEREGISTERED.\nIf the detach type indicates \"IMSI detach\" or \"re-attach required\", then the UE shall ignore the EMM cause IE if received.\nIf the detach type indicates \"re-attach not required\", the UE shall take the following actions depending on the received EMM cause value:\n#2\t\t(IMSI unknown in HSS);\n\tThe UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.\n\tThe UE is still attached for EPS services in the network. \n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". The USIM shall also be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.\nNOTE\u00a02:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\n#11\t(PLMN not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, reset the attach attempt counter and shall change to state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6]\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter and as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n#14\t(EPS services not allowed in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). Furthermore the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\n\tA UE in PS mode 1 or PS mode 2 of operation shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause\u00a04.5).\n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tA UE operating in CS/PS mode 1 of operation and supporting S1 mode only or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6]. \n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\n\tThe UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\n#25\t(Not authorized for this CSG);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nOther EMM cause values or if no EMM cause IE is included is considered as abnormal cases. The behaviour of the UE in those cases is described in subclause\u00a05.5.2.3.4.\n***** Next change *****\n5.5.3.1\tGeneral\nThe tracking area updating procedure is always initiated by the UE and is used for the following purposes:\n-\tnormal tracking area updating to update the registration of the actual tracking area of a UE in the network;\n-\tcombined tracking area updating to update the registration of the actual tracking area for a UE in CS/PS mode 1 or CS/PS mode 2 of operation;\n-\tperiodic tracking area updating to periodically notify the availability of the UE to the network;\n-\tIMSI attach for non-EPS services when the UE is attached for EPS services. This procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation;\n-\tin various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode;\n-\tS101 mode to S1 mode inter-system change;\n-\tMME load balancing;\n-\tto update certain UE specific parameters in the network;\n-\trecovery from certain error cases;\n-\tto indicate that the UE enters S1 mode after CS fallback or 1xCS fallback;\n-\tto indicate to the network that the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;\n-\tto indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions; and\n-\tto indicate to the network that the UE has locally released EPS bearer context(s).\nDetails on the conditions for the UE to initiate the tracking area updating procedure are specified in subclause\u00a05.5.3.2.2 and subclause\u00a05.5.3.3.2.\nWhile a UE has a PDN connection for emergency bearer services, the UE shall not perform manual CSG selection.\nA UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts during the procedure.\nIn a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP\u00a0TS\u00a023.122\u00a0[6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received on the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP\u00a0TS\u00a036.331\u00a0[22]). Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 \"PLMN not allowed\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMN list\". Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 \"EPS services not allowed in this PLMN\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMNs for GPRS service\". Whenever a TRACKING AREA UPDATE REJECT message is received by the UE with the EMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", or #15 \"no suitable cells in tracking Area\", the constructed TAI shall be stored in the suitable list.\nIn a shared network, if TRACKING AREA UPDATE REJECT is received as a response to a tracking area update procedure initiated in EMM-CONNECTED mode, the UE need not update forbidden lists.\nA tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in subclause\u00a05.5.3.2.6. Depending on the value of the tracking area updating attempt counter, specific actions shall be performed. The tracking area updating attempt counter shall be reset when:\n-\tan attach or combined attach procedure is successfully completed;\n-\ta normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;\n-\ta normal or periodic tracking area updating or a combined tracking area updating procedure is rejected with EMM cause #11, #12, #13, #14, #15, #25 or #35:\n-\ta combined attach procedure or a combined tracking area updating procedure is completed for EPS services only with cause #2 or #18;or\n-\ta new PLMN is selected.\nAdditionally the tracking area updating attempt counter shall be reset when the UE is in substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and:\n-\ta new tracking area is entered;\n-\ttimer T3402 expires; or\n-\ttimer T3346 is started.\n***** Next change *****\n5.5.3.2.5\tNormal and periodic tracking area updating procedure not accepted by the network\nIf the tracking area updating cannot be accepted by the network, the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.\nIf a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in subclause\u00a05.5.3.2.4, the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 \"Implicitly detached\".\nIf the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nUpon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430 and stop any transmission of user data.\nIf the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.\n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed . The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed .\nNOTE\u00a01:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed . The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf the EPS update type is \"periodic updating\", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and shall proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect EUTRAN radio access technology until switching off or the UICC containing the USIM is removed.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#9\t\t(UE identity cannot be derived by the network);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.\nNOTE\u00a02:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#10\t(Implicitly detached);\n\tIf the EPS update type is \"periodic updating\", a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.\n\tThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.\nNOTE\u00a03:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value and no RR connection exists.\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present.\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). Furthermore the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\n\tIf the EPS update type is \"TA updating\", or the EPS update type is \"periodic updating\" and the UE is in PS mode 1 or PS mode 2 of operation, the UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6]. In this case, the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure.\n\tIf the EPS update type is \"periodic updating\", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services and shall proceed as follows:\n-\ta UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED;\n-\ta UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause\u00a04.5);\n-\ta UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6];\n-\ta UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present.\n\tIf the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the TRACKING AREA UPDATE REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP\u00a0TS\u00a024.368\u00a0[15A] or 3GPP\u00a0TS\u00a031.102\u00a0[17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause\u00a04.5 and search for a suitable cell in another location area; otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.3.2.6.\n\tThe UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.\n\tIf the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#25\t(Not authorized for this CSG);\n\tEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.3.2.6.\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a05.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\n#40\t(No EPS bearer context activated);\n\tThe UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall perform a new attach procedure.\nNOTE\u00a04:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\n#42\t(Severe network failure);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs, and set the tracking area update counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP\u00a0TS\u00a023.122\u00a0[6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nOther values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause\u00a05.5.3.2.6.\n***** Next change *****\n5.5.3.3.4.3\tCombined tracking area updating successful for EPS services only\nApart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in subclause\u00a05.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.\nThe UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t\t(IMSI unknown in HSS)\n\tThe UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed .\n#16\t(MSC temporarily not reachable); or\n#17\t(Network failure)\n\tThe UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\n\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again.\n\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause\u00a04.5);\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" and with a persistent EPS bearer context shall wait until the radio bearer associated with the persistent EPS bearer context has been released. When the radio bearer associated with the persistent EPS bearer context has been released and the UE is registered for EPS services only, operating in CS/PS mode 1 of operation with \"IMS voice not available\", then the UE shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause\u00a04.5).\n#18\t(CS domain not available)\n\tThe UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\n\tThe UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.\n\tA UE in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see subclause\u00a04.5).\n\tA UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" may provide a notification to the user or the upper layers that the CS domain is not available.\n\tThe UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.\n#22\t(Congestion)\n\tThe UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall enter state MM IDLE.\nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause\u00a05.5.3.3.6.\n***** Next change *****\n5.5.3.3.5\tCombined tracking area updating procedure not accepted by the network\nIf the combined tracking area updating cannot be accepted by the network, the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.\nIf the MME locally deactivates EPS bearer contexts for the UE (see subclause\u00a05.5.3.2.4) and no active EPS bearer contexts remain for the UE, the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 \"implicitly detached\".\nIf the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nUpon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430, stop any transmission of user data and enter state MM IDLE.\nIf the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.\n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI.\n\tThe UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed . Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall consider then USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed . The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#9\t\t(UE identity cannot be derived by the network);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall enter the state EMM-DEREGISTERED.\n\tIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and proceeds with the appropriate MM and CC specific procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.\nNOTE\u00a01:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#10\t(Implicitly detached);\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.\n\tThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\n\tIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and proceeds with the appropriate MM and CC specific procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.\nNOTE\u00a02:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe UE shall then perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value and no RR connection exists.\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present.\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure following the PLMN selection.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). Furthermore the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list.\n\tThe UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tThe UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause\u00a04.5).\n\tA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tA UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present.\n\tIf the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the TRACKING AREA UPDATE REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP\u00a0TS\u00a024.368\u00a0[15A] or 3GPP\u00a0TS\u00a031.102\u00a0[17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause\u00a04.5 and search for a suitable cell in another location area; otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.3.3.6.\n\tThe UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.\n\tIf the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#25\t(Not authorized for this CSG);\n\tEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.3.3.6.\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a05.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\n#40\t(No EPS bearer context activated);\n\tThe UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. \n\tIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology technology and proceeds with the appropriate MM and CC specific procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback, the UE shall perform a new attach procedure.\nNOTE\u00a03:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#42\t(Severe network failure);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs, and set the tracking area update attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP\u00a0TS\u00a023.122\u00a0[6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.3.3.6.\n***** Next change *****\n5.6.1.5\tService request procedure not accepted by the network\nIf the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value.\nThe MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 \"CS service temporarily not available\".\nNOTE\u00a01:\tDependent on implementation and operator configuration the area A can be configured with the granularity of an MME area, tracking area or eNodeB service area. \nThe MME may further be configured for a certain area A' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, if:\n-\tthe service request is initiated in EMM-IDLE mode; and\n-\tthe UE indicated support of eNodeB-based access control for mobile originating CS fallback calls during an attach or tracking area updating procedure.\nNOTE\u00a02:\tThe operator can use this second option when the eNodeBs in area A' are supporting the eNodeB-based access control for CS fallback calls. The area A' can be part of area A or the whole area A. It is the responsibility of the operator to coordinate the activation of MME-based access control and eNodeB-based access control for mobile originating CS fallback calls.\nWhen the EMM cause value is #39 \"CS service temporarily not available\", the MME shall include a value for timer T3442 in the SERVICE REJECT message. If a mobile terminating CS fallback call is aborted by the network during call establishment as specified in 3GPP\u00a0TS\u00a029.118\u00a0[16A], the MME shall include the EMM cause value #39 \"CS service temporarily not available\" and set the value of timer T3442 to zero.\nIf a service request from a UE with only LIPA PDN connections is not accepted due to the reasons specified in subclause\u00a05.6.1.4, depending on the service request received, the MME shall include the following EMM cause value in the SERVICE REJECT message:\n-\tif the service request received is not due to CS fallback or 1xCS fallback, EMM cause value #10 \"implicitly detached\"; or\n-\tif the service request received is due to CS fallback or 1xCS fallback, EMM cause value #40 \"no EPS bearer context activated\".\nIf a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted due to the reasons specified in subclause\u00a05.6.1.4, depending on the service request received, the MME shall:\n-\tif the service request received is due to CS fallback or 1xCS fallback, include the EMM cause value #40 \"no EPS bearer context activated\" in the SERVICE REJECT message; or\n-\tif the service request received is not due to CS fallback or 1xCS fallback, abort the service request procedure and send a DETACH REQUEST message to the UE with detach type \"re-attach required\" (see subclause\u00a05.5.2.3.1).\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nOn receipt of the SERVICE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall reset the service request attempt counter, stop timer T3417, or T3417ext if running.\nIf the SERVICE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the received EMM cause value in the SERVICE REJECT message.\n#3\t\t(Illegal UE);\n#6\t\t(Illegal ME); or\n#8\t\t(EPS services and non-EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed . The UE shall enter the state EMM-DEREGISTERED.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed .\nNOTE\u00a03:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t\t(EPS services not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed . The UE shall enter the state EMM-DEREGISTERED.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#9\t\t(UE identity cannot be derived by the network);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.\n\tIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\n\tIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE\u00a04:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#10\t(Implicitly detached);\n\tThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\n\tIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\n\tIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE\u00a05:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\n\tThe UE shall store the PLMN identity in the \"forbidden PLMN list\".\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#12\t(Tracking area not allowed);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\n\tIf the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present.\n\tThe UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present.\n\tIf the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\n\tIf the service request was not initiated for mobile originated CS fallback, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#18\t(CS domain not available);\n\tIf the request was related to CS fallback, the UE shall send an indication to the MM sublayer and shall not attempt CS fallback until combined tracking area updating procedure has been successfully completed. The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE.\n\tThe UE shall set the update status to U2 NOT UPDATED.\n\tIf the UE is in CS/PS mode 1 of operation with \"IMS voice not available\" and the request was related to CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).\n\tIf the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, the UE may provide a notification to the user or the upper layers that the CS domain is not available.\n\tIf the request was related to 1xCS fallback, the UE shall cancel upper layer actions related to 1xCS fallback and enter the state EMM-REGISTERED.NORMAL-SERVICE.\n#22\t(Congestion);\n\tIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.6.1.6.\n\tIf the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall abort the service request procedure and enter state EMM-REGISTERED, and stop timer T3417 or T3417ext if still running.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\n\tIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nNOTE\u00a06:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\n\tIf the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.\n\tIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tFor all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#25\t(Not authorized for this CSG);\n\tEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.6.\n\tThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause\u00a05.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\n\tIf the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP\u00a0TS\u00a023.122\u00a0[6] subclause\u00a03.1A.\n\tThe UE shall search for a suitable cell according to 3GPP\u00a0TS\u00a036.304\u00a0[21].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause with the same value.\n#39\t(CS service temporarily not available); \n\tIf the T3442 value received in the SERVICE REJECT message is not zero, the UE shall start timer T3442 and enter the state EMM-REGISTERED.NORMAL-SERVICE. If the T3442 value received in the SERVICE REJECT message is zero, the UE shall not start timer T3442.\n\tThe UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message.\t\n#40\t(No EPS bearer context activated);\n\tThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\n\tIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\n\tIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000\u00ae 1x radio access technology. The UE then proceeds with appropriate cdma2000\u00ae 1x CS procedures.\n\tIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\n\tIf the service request was initiated for any reason other than CS fallback or 1x CS fallback, the UE shall perform a new attach procedure.\nNOTE\u00a07:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13] for the case when the service request procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.\n\tA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\n#42\t(Severe network failure);\n\tThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP\u00a0TS\u00a023.122\u00a0[6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[6].\n\tIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nOther values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause\u00a05.6.1.6.\n***** End change *****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWhen the MS receives cause #3 \"Illegal UE\" or #6 \"Illegal ME\" then the USIM shall be considered as invalid for GRPS/non-GPRS services until switching off or the USIM is removed. However when the UE is configured to use timer T3245 then after expiry of timer T3245 the USIM is set to valid and the UE can perform cell selection.Additionally when a T3245 expires also the \"forbidden PLMN list\" has to be deleted. However it is not mentioned at the starting of the T3245 when a PLMN id is added to the forbidden PLMN list.\n\n>>> SUMMARY OF CHANGE\nAdding clarification that in case the USIM is considered invalid then usage of timer T3245 can set the USIM valid again besides the switching off or USIM removal.Adding reference to the T3245 requirements in cases when a new value is added in the forbidden PLMN lists.\n\n>>> CONSEQUENCES IF NOT REVISED\nUnclear specification about the condition setting the USIM valid. Loss of service for longer time than it would be necessary."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n7.2.3.5.8\tReceive Floor Queue Position Request message (R: Floor Queue Position Request)\nUpon receiving a Floor Queue Position Request message, the floor participant:\n1.\tshall send the Floor Queue Position Info message. The Floor Queue Position Info message:\na.\tshall include the MCPTT ID of the queued floor participant in the Queued User ID field;\nb.\tshall include the queue position and floor priority in the Queue Info field;\nc.\tshall include the SSRC of floor participant sending Floor Queue Position Request message in SSRC of queue floor participant field; and\nd.\tshall include the User ID of floor participant sending Floor Queue Position Request message in User ID field; and\n2.\tremain in the 'O: has permission' state.\n***** Next change *****\n7.2.3.8.3\tReceive Floor Queue Position Info message (R: Floor Queue Position Info)\nUpon receiving Floor Queue Position Info message, if the <User ID> value in the User ID field matches its own MCPTT ID and SSRC of floor participant sending the Floor Queue Position Info message matches the stored SSRC of current arbitrator, the floor participant:\n1.\tshall update the queue position;\n2.\tshall notify the MCPTT user about the queue position received in the <Queue position info> value in the Queue Info field;\n3.\tshall stop timer T204 (Floor Queue Position request); and\n4.\tshall remain in 'O: queued' state.\n***** End of changes *****\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIncorrect useage of \u201cQueued User ID\u201d and \u201cUser ID\u201d fields when constructing Floor Queue Position Info message.Incorrect reference to \u201cUser ID\u201d field rather than to \u201cQueued User ID\u201d field in processing of received Floor Queue Position Info message.\n\n>>> SUMMARY OF CHANGE\nCorrect useage of \u201cQueued User ID\u201d and \u201cUser ID\u201d fields when constructing off-network Floor Queue Position Info message.Change field name reference from \u201cUser ID\u201d to \u201cQueued User ID\u201d in off-network handling of received Floor Queue Position Info message.\n\n>>> CONSEQUENCES IF NOT REVISED\nClient implementations strictly following current specification would:1 - ignore valid responses to requests for Floor Queue Position;2 \u2013 send Floor Queue Position Info messages with User ID and Queued User ID values swapped."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 38.300: \"NR; Overall description; Stage 2\".\n[3]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC); Protocol specification\".\n[4]\t3GPP TS 38.322: \"NR; Radio Link Control (RLC) protocol specification\".\n[5]\t3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP) protocol specification\".\t\n[6]\tITU-T Recommendation X.680 (08/2015) \"Information Technology - Abstract Syntax Notation One (ASN.1): Specification of basic notation\" (Same as the ISO/IEC International Standard 8824-1).\n[7]\tITU-T Recommendation X.681 (08/2015) \"Information Technology - Abstract Syntax Notation One (ASN.1): Information object specification\" (Same as the ISO/IEC International Standard 8824-2).\n[8]\tITU-T Recommendation X.691 (08/2015) \"Information technology - ASN.1 encoding rules: Specification of Packed Encoding Rules (PER)\" (Same as the ISO/IEC International Standard 8825-2).\n[9]\t3GPP TS 38.215: \"NR; Physical layer measurements\".\n[10]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA) Radio Resource Control (RRC); Protocol Specification\".\n[11]\t3GPP TS 33.501: \"Security Architecture and Procedures for 5G System\".\n[12]\t3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\".\n[13]\t3GPP TS 38.213: \"NR; Physical layer procedures for control\".\n[14]\t3GPP TS 38.133: \"NR; Requirements for support of radio resource management\".\n[15]\t3GPP TS 38.101: \"NR; User Equipment (UE) radio transmission and reception\".\n[16]\t3GPP TS 38.211: \"NR; Physical channels and modulation\".\n[17]\t3GPP TS 38.212: \"NR; Multiplexing and channel coding\".\n[18]\tITU-T Recommendation X.683 (08/2015) \"Information Technology - Abstract Syntax Notation One (ASN.1): Parameterization of ASN.1 specifications\" (Same as the ISO/IEC International Standard 8824-4).\n[19]\t3GPP TS 38.214: \"NR; Physical layer procedures for data\".\n[20]\t3GPP TS 38.304: \"NR; User Equipment (UE) procedures in Idle mode and RRC Inactive state\".\n[21]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[22]\t3GPP TS 36.101: \"E-UTRA; User Equipment (UE) radio transmission and reception\".\n[23]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[24]\t3GPP TS 37.324: \"Service Data Adaptation Protocol (SDAP) specification\".\n[25]\t3GPP TS 22.261: \"Service requirements for the 5G System\".\n[26]\t3GPP TS 38.306: \"User Equipment (UE) radio access capabilities\".\n[27]\t3GPP TS 36.304: \"E-UTRA; User Equipment (UE) procedures in idle mode\".\n[28]\tATIS 0700041: \"WEA 3.0: Device-Based Geo-Fencing\".\n[29]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[30]\t3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security architecture\".\n[31]\t3GPP TS 36.211: \"E-UTRA; Physical channels and modulation\".\n[32]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[33]\t3GPP TS 36.104:\"E-UTRA; Base Station (BS) radio transmission and reception\".\n[34]\t3GPP TS 38.101-3 \"NR; User Equipment (UE) radio transmission and reception; Part 3: Range 1 and Range 2 Interworking operation with other radios\"\n\n\n5.3.8\tRRC connection release\n5.3.8.1\tGeneral\n\nFigure 5.3.8.1-1: RRC connection release, successful\nThe purpose of this procedure is:\n-\tto release the RRC connection, which includes the release of the established radio bearers as well as all radio resources; or\n-\tto suspend the RRC connection only if SRB2 and at least one DRB is setup, which includes the suspension of the established radio bearers.\n5.3.8.2\tInitiation\nThe network initiates the RRC connection release procedure to transit a UE in RRC_CONNECTED to RRC_IDLE; or to transit a UE in RRC_CONNECTED to RRC_INACTIVE only if SRB2 and at least one DRB is setup in RRC_CONNECTED; or to transit a UE in RRC_INACTIVE back to RRC_INACTIVE when the UE tries to resume; or to transit a UE in RRC_INACTIVE to RRC_IDLE when the UE tries to resume. The procedure can also be used to release and redirect a UE to another frequency.\n5.3.8.3\tReception of the RRCRelease by the UE\nThe UE shall:\n1>\tdelay the following actions defined in this sub-clause 60 ms from the moment the RRCRelease message was received or optionally when lower layers indicate that the receipt of the RRCRelease message has been successfully acknowledged, whichever is earlier;\n1>\tstop timer T380, if running;\n1>\tstop timer T320, if running;\n1>\tstop timer T390, if running;\n1>\tif the security is not activated, perform the actions upon going to RRC_IDLE as specified in 5.3.11 with the release cause 'other' upon which the procedure ends;\n1>\tif the RRCRelease message includes redirectedCarrierInfo indicating redirection to eutra:\n2>\tif cnType is included:\n3>\tafter the cell selection, indicate the available CN Type(s) and the received cnType to upper layers;\nNOTE:\tHandling the case if the E-UTRA cell selected after the redirection does not support the core network type specified by the cnType, is up to UE implementation.\n\n\n1>\tif the RRCRelease message includes the cellReselectionPriorities:\n2>\tstore the cell reselection priority information provided by the cellReselectionPriorities;\n2>\tif the t320 is included:\n3>\tstart timer T320, with the timer value set according to the value of t320;\n1>\telse:\n2>\tapply the cell reselection priority information broadcast in the system information;\n1>\tif deprioritisationReq is included:\n2>\tstart or restart timer T325 with the timer value set to the deprioritisationTimer signalled;\n2>\tstore the deprioritisationReq until T325 expiry;\n1>\tif the RRCRelease includes suspendConfig:\n2>\tapply the received suspendConfig;\n2>\treset MAC and release the default MAC Cell Group configuration, if any;\n2>\tre-establish RLC entities for SRB1;\n2>\tif the RRCRelease message with suspendConfig was received in response to an RRCResumeRequest or an RRCResumeRequest1:\n3>\tstop the timer T319 if running;\n3>\tin the stored UE Inactive AS context:\n4>\treplace the KgNB and KRRCint keys with the current KgNB and KRRCint keys;\n4>\treplace the C-RNTI with the temporary C-RNTI in the cell the UE has received the RRCRelease message;\n4>\treplace the cellIdentity with the cellIdentity of the cell the UE has received the RRCRelease message;\n4>\treplace the physical cell identity with the physical cell identity of the cell the UE has received the RRCRelease message;\n4>\treplace the suspendConfig with the current suspendConfig;\n2>\telse:\n3>\tstore in the UE Inactive AS Context the received suspendConfig, all current parameters configured with RRCReconfiguration or RRCResume, the current KgNB and KRRCint keys, the ROHC state, the C-RNTI used in the source PCell, the cellIdentity and the physical cell identity of the source PCell;\n2>\tsuspend all SRB(s) and DRB(s), except SRB0;\n2>\tindicate PDCP suspend to lower layers of all DRBs;\n2>\tif the t380 is included:\n3>\tstart timer T380, with the timer value set to t380;\n2>\tif the RRCRelease message is including the waitTime:\n3>\tstart timer T302 with the value set to the waitTime;\n3>\tinform the upper layer that access barring is applicable for all access categories except categories '0' and '2';\n2>\tindicate the suspension of the RRC connection to upper layers;\n2>\tenter RRC_INACTIVE and perform cell selection as specified in TS 38.304 [20];\n1>\telse\n2>\tperform the actions upon going to RRC_IDLE as specified in 5.3.11, with the release cause 'other'.\n5.3.8.4\tT320 expiry\nThe UE shall:\n1>\tif T320 expires:\n2>\tif stored, discard the cell reselection priority information provided by the cellReselectionPriorities or inherited from another RAT;\n2>\tapply the cell reselection priority information broadcast in the system information.\n\n====================Next change=====================\n5.4.3.3\tReception of the MobilityFromNRCommand by the UE\nThe UE shall:\n1>\tif T390 is running:\n2>\tstop timer T390 for all access categories;\n2>\tperform the actions as specified in 5.3.14.4;\n1>\tif the targetRAT-Type is set to eutra:\n2>\tconsider inter-RAT mobility as initiated towards E-UTRA;\n2>\tforward the nas-SecurityParamFromNR to the upper layers, if included;\n1>\taccess the target cell indicated in the inter-RAT message in accordance with the specifications of the target RAT.\n5.4.3.4\tSuccessful completion of the mobility from NR\nUpon successfully completing the handover, at the source side the UE shall:\n1>\treset MAC;\n1>\tstop all timers that are running;\n1>\trelease ran-NotificationAreaInfo, if stored;\n1>\trelease the AS security context including the KRRCenc key, the KRRCint, the KUPint key and the KUPenc key, if stored;\n1>\trelease all radio resources, including release of the RLC entity and the MAC configuration;\n1>\tif delta configuration is used:\n2>\tmaintain source RAT configuration of PDCP and SDAP for applicable RBs which is used for target RAT RBs;\n1>\telse:\n2>\trelease the associated PDCP entity and SDAP entity for all established RBs;\n1>\tindicate the release of the RRC connection to upper layers together with the release cause 'other'.\n5.4.3.5\tMobility from NR failure\nThe UE shall:\n1>\tif the UE does not succeed in establishing the connection to the target radio access technology; or\n1>\tif the UE is unable to comply with any part of the configuration included in the MobilityFromNRCommand message; or\n1>\tif there is a protocol error in the inter RAT information included in the MobilityFromNRCommand message, causing the UE to fail the procedure according to the specifications applicable for the target RAT:\n2>\t\n\n\nrevert back to the configuration used in the source PCell;\n2>\tinitiate the connection re-establishment procedure as specified in subclause 5.3.7.\n\n====================Next change=====================\n\n\u2013\tMobilityFromNRCommand\nThe MobilityFromNRCommand message is used to command handover from NR to E-UTRA (connected to EPC or 5GC).\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nMobilityFromNRCommand message\n-- ASN1START\n-- TAG-MOBILITYFROMNRCOMMAND-START\n\nMobilityFromNRCommand ::=       SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n            mobilityFromNRCommand               MobilityFromNRCommand-IEs,\n            criticalExtensionsFuture                SEQUENCE {}\n    }\n}\n\nMobilityFromNRCommand-IEs ::=   SEQUENCE {\n    targetRAT-Type                          ENUMERATED { eutra, spare3, spare2, spare1, ...},\n    targetRAT-MessageContainer              OCTET STRING,\n    nas-SecurityParamFromNR                 OCTET STRING                                OPTIONAL,   -- Cond HO-ToEPC\n    lateNonCriticalExtension                OCTET STRING                                OPTIONAL,\n    nonCriticalExtension                    SEQUENCE {}                                 OPTIONAL\n}\n\n\n\n\n\n\n-- TAG-MOBILITYFROMNRCOMMAND-STOP\n-- ASN1STOP\n\nMobilityFromNRCommand-IEs field descriptions\nnas-SecurityParamFromNR\tThis field is used to deliver the key synchronisation and Key freshness for the NR to LTE/EPC handovers as specified in TS 33.501 [11] and contains the 4 LSB of the downlink NAS COUNT.\ntargetRAT-MessageContainer\tThe field contains a message specified in another standard, as indicated by the targetRAT-Type, and carries information about the target cell identifier(s) and radio parameters relevant for the target radio access technology. NOTE 1. A complete message is included, as specified in the other standard.\ntargetRAT-Type\tIndicates the target RAT type.\n\nNOTE 1:\tThe correspondence between the value of the targetRAT-Type, the standard to apply, and the message contained within the targetRAT-MessageContainer is shown in the table below:\ntargetRAT-Type\tStandard to apply\ttargetRAT-MessageContainer\neutra\t3GPP TS 36.331 [10] (clause 5.4.2)\tRRCConnectionReconfiguration\n\nConditional Presence\tExplanation\nHO-ToEPC\tThis field is mandatory present in case of inter system handover. Otherwise it is absent.\n\n====================Next change=====================\n\u2013\tRRCRelease\nThe RRCRelease message is used to command the release of an RRC connection or the suspension of the RRC connection.\nSignalling radio bearer: SRB1\nRLC-SAP: AM\nLogical channel: DCCH\nDirection: Network to UE\nRRCRelease message\n-- ASN1START\n-- TAG-RRCRELEASE-START\n\nRRCRelease ::=                      SEQUENCE {\n    rrc-TransactionIdentifier           RRC-TransactionIdentifier,\n    criticalExtensions                  CHOICE {\n        rrcRelease                          RRCRelease-IEs,\n        criticalExtensionsFuture            SEQUENCE {}\n    }\n}\n\nRRCRelease-IEs ::=                  SEQUENCE {\n    redirectedCarrierInfo               RedirectedCarrierInfo                                                   OPTIONAL,   -- Need N\n    cellReselectionPriorities           CellReselectionPriorities                                               OPTIONAL,   -- Need R\n    suspendConfig                       SuspendConfig                                                           OPTIONAL,   -- Need R\n    deprioritisationReq                 SEQUENCE {\n        deprioritisationType                ENUMERATED {frequency, nr},\n        deprioritisationTimer               ENUMERATED {min5, min10, min15, min30}\n    }                                                                                                           OPTIONAL,   -- Need N\n    lateNonCriticalExtension                OCTET STRING                                                        OPTIONAL,\n    nonCriticalExtension                    RRCRelease-v1540-IEs                                                OPTIONAL\n}\n\nRRCRelease-v1540-IEs ::=            SEQUENCE {\n    waitTime                           RejectWaitTime                OPTIONAL, -- Need N\n    nonCriticalExtension               SEQUENCE {}                   OPTIONAL\n}\n\n\n\n\n\n\nRedirectedCarrierInfo ::=           CHOICE {\n    nr                                  CarrierInfoNR,\n    eutra                               RedirectedCarrierInfo-EUTRA,\n    ...\n}\n\nRedirectedCarrierInfo-EUTRA ::=     SEQUENCE {\n    eutraFrequency                          ARFCN-ValueEUTRA,\n    cnType-r15                              ENUMERATED {epc,fiveGC}                                             OPTIONAL    -- Need N\n}\n\nCarrierInfoNR ::=                   SEQUENCE {\n    carrierFreq                         ARFCN-ValueNR,\n    ssbSubcarrierSpacing                SubcarrierSpacing,\n    smtc                                SSB-MTC                                                                 OPTIONAL,      -- Need S\n    ...\n}\n\nSuspendConfig ::=                   SEQUENCE {\n    fullI-RNTI                          I-RNTI-Value,\n    shortI-RNTI                         ShortI-RNTI-Value,\n    ran-PagingCycle                     PagingCycle,\n    ran-NotificationAreaInfo            RAN-NotificationAreaInfo                                                OPTIONAL,   -- Need M\n    t380                                PeriodicRNAU-TimerValue                                                 OPTIONAL,   -- Need R\n    nextHopChainingCount                NextHopChainingCount,\n    ...\n}\n\n\nPeriodicRNAU-TimerValue ::=         ENUMERATED { min5, min10, min20, min30, min60, min120, min360, min720}\n\n\nCellReselectionPriorities ::=       SEQUENCE {\n    freqPriorityListEUTRA               FreqPriorityListEUTRA                                                   OPTIONAL,       -- Need M\n    freqPriorityListNR                  FreqPriorityListNR                                                      OPTIONAL,       -- Need M\n    t320                                ENUMERATED {min5, min10, min20, min30, min60, min120, min180, spare1}   OPTIONAL,       -- Need R\n    ...\n}\n\nPagingCycle ::=                     ENUMERATED {rf32, rf64, rf128, rf256}\n\nFreqPriorityListEUTRA ::=           SEQUENCE (SIZE (1..maxFreq)) OF FreqPriorityEUTRA\n\nFreqPriorityListNR ::=              SEQUENCE (SIZE (1..maxFreq)) OF FreqPriorityNR\n\nFreqPriorityEUTRA ::=               SEQUENCE {\n    carrierFreq                         ARFCN-ValueEUTRA,\n    cellReselectionPriority             CellReselectionPriority,\n    cellReselectionSubPriority          CellReselectionSubPriority                                              OPTIONAL        -- Need R\n}\n\nFreqPriorityNR ::=                  SEQUENCE {\n    carrierFreq                         ARFCN-ValueNR,\n    cellReselectionPriority             CellReselectionPriority,\n    cellReselectionSubPriority          CellReselectionSubPriority                                              OPTIONAL        -- Need R\n}\n\nRAN-NotificationAreaInfo ::=        CHOICE {\n    cellList                            PLMN-RAN-AreaCellList,\n    ran-AreaConfigList                  PLMN-RAN-AreaConfigList,\n    ...\n}\n\nPLMN-RAN-AreaCellList ::=           SEQUENCE (SIZE (1.. maxPLMNIdentities)) OF PLMN-RAN-AreaCell\n\nPLMN-RAN-AreaCell ::=               SEQUENCE {\n    plmn-Identity                       PLMN-Identity                                                           OPTIONAL,   -- Need S\n    ran-AreaCells                       SEQUENCE (SIZE (1..32)) OF  CellIdentity\n}\n\nPLMN-RAN-AreaConfigList ::=         SEQUENCE (SIZE (1..maxPLMNIdentities)) OF PLMN-RAN-AreaConfig\n\nPLMN-RAN-AreaConfig ::=             SEQUENCE {\n    plmn-Identity                       PLMN-Identity                                                           OPTIONAL,   -- Need S\n    ran-Area                            SEQUENCE (SIZE (1..16)) OF  RAN-AreaConfig\n}\n\nRAN-AreaConfig ::=                  SEQUENCE {\n    trackingAreaCode            TrackingAreaCode,\n    ran-AreaCodeList            SEQUENCE (SIZE (1..32)) OF  RAN-AreaCode        OPTIONAL    -- Need R\n}\n\n-- TAG-RRCRELEASE-STOP\n-- ASN1STOP\n\nRRCRelease field descriptions\ncnType\tIndicate that the UE is redirected to EPC or 5GC.\ndeprioritisationReq\tIndicates whether the current frequency or RAT is to be de-prioritised.\ndeprioritisationTimer\tIndicates the period for which either the current carrier frequency or NR is deprioritised. Value minN corresponds to N minutes.\nsuspendConfig\tIndicates configuration for the RRC_INACTIVE state.\nt380\tRefers to the timer that triggers the periodic RNAU procedure in UE. Value min5 corresponds to 5 minutes, value min10 corresponds to 10 minutes and so on.\nran-PagingCycle\tRefers to the UE specific cycle for RAN-initiated paging. Value rf32 corresponds to 32 radio frames, rf64 corresponds to 64 radio frames and so on.\nredirectedCarrierInfo\tIndicates a carrier frequency (downlink for FDD) and is used to redirect the UE to an NR or an inter-RAT carrier frequency, by means of cell selection at transition to RRC_IDLE or RRC_INACTIVE as specified in TS 38.304 [20]\n\nCarrierInfoNR field descriptions\ncarrierFreq\tIndicates the redirected NR frequency.\nssbSubcarrierSpacing\tSubcarrier spacing of SSB in the redirected SSB frequency. Only the values 15 or 30 (<6GHz), 120 kHz or 240 kHz (>6GHz) are applicable.\nsmtc\tThe SSB periodicity/offset/duration configuration for the redirected SSB frequency. It is based on timing reference of PCell. If the field is absent, the UE uses the SMTC configured in the measObjectNR having the same SSB frequency and subcarrier spacing.\n\nRAN-NotificationAreaInfo field descriptions\ncellList\tA list of cells configured as RAN area.\nran-AreaConfigList\tA list of RAN area codes or RA code(s) as RAN area.\n\nPLMN-RAN-AreaConfig field descriptions\nplmn-Identity\tPLMN Identity to which the cells in ran-AreaCells belong. If the field is absent the UE uses the ID of the registered PLMN.\nran-AreaCodeList\tThe sum of RAN-AreaCodes all PLMNs does not exceed 32\nran-Area\tIndicates whether TA code(s) or RAN area code(s) are used for the RAN notification area. The network uses only TA code(s) or RAN area code(s) to configure a UE.\n\nPLMN-RAN-AreaCell field descriptions\nplmn-Identity\tPLMN Identity to which the cells in ran-AreaCells belong. If the field is absent the UE uses the ID of the registered PLMN.\nran-AreaCells\tThe sum of cells from all PLMNs does not exceed 32\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the current NR to LTE voice fallback, the UE\u2019s access stratum and the E-UTRAN are not aware whether the handover/redirection is for voice fallback, and therefore there is no way for E-UTRAN to prioritize the UE in the voice fallback from NR in RRC connection establishment in redirection from NR to E-UTRAN. Also the UE returns to NR in case of handover failure according to the current specification, which causes additional delay in voice call set up.\n\n>>> SUMMARY OF CHANGE\nAdd voiceFallbackIndication in MobilityFromNRCommand It is specified that in case of failing in inter-RAT handove from NR to E-UTRAN for the purpose of voice fallback, UE shall attempt to select a E-UTRA cell for IMS voice cell setup. Add voiceFallbackIndication in RRCRelease.\n\n>>> CONSEQUENCES IF NOT REVISED\nThere is no way for E-UTRAN to prioritize the UE in the voice fallback from NR, in RRC connection establishment after redirection from NR to E-UTRAN.The UE returns to NR in case of handover failure, which causes additional delay in voice call set up.Impact Analysis:Impacted functionality: Inter-system voice fallback from NR/5GC to EPS.Inter-operability:If the network is implemented according to the CR and the UE is not; There is no inter-operability problem. For the change 1, the UE will ignore the the new indication in MobilityFromNRCommand. For the change 2, the UE returms to NR in case of handover failure, which is according to the current standard. For the change 3, the the UE will ignore the the new indication in RRCRelease.If the UE is implemented according to the CR and the network is not; There is no inter-operability problem. For the change 1, the network will not use the the new indication in MobilityFromNRCommand, and the UE behaves according to the curent standard. For the change 2, the UE will not retrun to NR in case of handover failure, and the network behaviour is the same as the exsiting case today that the UE cannot find a suitable NR cell. For the change 3, the network will not use the the new indication in RRCRelease, and the UE behaves according to the curent standard."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n\n****** First Change ******\n4.4.2\tMTC-IWF\nTo support the Indirect and Hybrid models of MTC, one or more instances of an MTC InterWorking Function (MTC-IWF) reside in the HPLMN. An MTC-IWF could be a standalone entity or a functional entity of another network element. The MTC-IWF hides the internal PLMN topology and relays or translates signaling protocols used over Tsp to invoke specific functionality in the PLMN.\nThe functionality of the MTC-IWF includes the following:\n-\tterminates the Tsp, S6m, T5a, T5b, T5c, T4 and Rf/Ga reference points;\n-\tsupports ability to authorize the SCS before communication establishment with the 3GPP network;\n-\tsupports ability to authorize control plane requests from an SCS;\n-\tsupports the following device trigger functionality:\n-\treception of a device trigger request from SCS;\n-\treport to the SCS the acceptance or non-acceptance of the device trigger request;\n-\treport to the SCS the success or failure of a device trigger delivery;\n-\tmay apply MTC-IWF and/or SGSN/MME induced congestion/load control as part of the response to trigger requests; and\n-\tassigns appropriate identifier (e.g. port address number) to allow the UE to distinguish an MT message carrying device triggering information from any other type of messages.\n-\tan HSS resolution mechanism for use when multiple and separately addressable HSSs have been deployed by the network operator (see e.g. the SLF / Diameter Proxy agent specified in clause 5.8 TS 23.228 [10]);\n-\tinterrogation of the appropriate HSS, when needed for device triggering, to:\n-\tmap E.164 MSISDN or external identifier to IMSI of the associated UE;\n-\tretrieve serving node information for the UE (i.e. serving SGSN/MME/MSC address);\n-\tdetermine if a SCS is allowed to send a device trigger to a particular UE;\n-\tselection of the most efficient and effective device trigger delivery mechanism and shielding this detail from SCS based on;\n-\tcurrent UE serving node information from HSS/HLR (e.g. serving MME/SGSN/MSC address);\n- \tthe device trigger delivery mechanisms supported by the UE;\n-\tthe possible device trigger delivery services supported by the HPLMN and, when roaming, VPLMN;\n-\tany MNO device trigger delivery policies; and/or\n-\tany information received from the SCS.\n-\tperform protocol translation, if necessary, and forwarding towards the relevant network entity (i.e. serving SGSN/MME/MSC or SMS-SC inside HPLMN domain) of a device trigger request to match the selected trigger delivery mechanism;\n-\tgeneration of device trigger CDRs with External Identifier and SCS Identifier and forwarding to CDF/CGF over instance of Rf/Ga; \nNOTE:\tCDR generation with or without a device trigger indication by other network entities is not precluded by CDR generation by the MTC-IWF.\n-\tsupport ability for secure communications between the 3GPP network and the SCS;\nEditor\u2019s Note: Solutions for the security related functionality described in the three bullets above are in the scope of SA WG3.\nThe characteristics of the MTC-IWF include the following:\n-\tmultiple MTC-IWFs can be used with a HPLMN;\n-\tsystem shall be robust to single MTC-IWF failure;\n****** Second Change ******\n4.5.1\tDevice Triggering Function\nDevice Triggering is the means by which a SCS sends information to the UE via the 3GPP network to trigger the UE to perform application specific actions that include initiating communication with the SCS for the indirect model or an AS in the network for the hybrid model. Device Triggering is required when an IP address for the UE is not available or reachable by the SCS/AS.\nDevice trigger message contains information that allows the network to route the message to the appropriate UE and the UE to route the message to appropriate application. The information destined to the application, along with the information to route it, is referred to as the Trigger payload. The UE needs to be able to distinguish an MT message carrying device triggering information from any other type of messages.\nNOTE:\tThe Trigger payload for example upon the reception by the UE possibly provides information to the application that may trigger application related actions. The application in the UE may perform indicated actions, such as for example to initiate immediate or later communication to the SCS/AS, based on the information contained in the Trigger payload.\nDevice Triggering is subscription based. The MTC-IWF provides devices triggering based on HSS subscriber data for a specific mobile subscriber. When device triggers are delivered via SMS-MT the serving nodes MME, SGSN and MSC provide the service towards a specific UE based on the UE's subscription for SMS-MT and other subscription parameters affecting SMS-MT service provision.\nCharging data are collected for the device triggering. The MTC-IWF generates CDRs for the service requester. When device triggers are delivered via SMS-MT then network entities, like MME, SGSN, MSC or SMS-SC generate CDRs for SMS services provided for the mobile subscriber.\n\n****** Third Change ******\n5.2.2\tTrigger Delivery using T4\n\n\nFigure 5.2.2-1: T4 Trigger Delivery Flow\n1.\tThe MTC-IWF selects a suitable SMS-SC based on configured information. The MTC-IWF sends a Submit Trigger (External Identifier or MSISDN, IMSI, SCS Identifier, Trigger Reference Number, validity period, priority, serving node ID(s) , SMS Application port ID, trigger payload) message to the SMS-SC. The SMS-SC should avoid an additional HSS interrogation (SRI for SM) and receives necessary parameters in the Submit Trigger message from the MTC-IWF. The SMS Application port ID is set to address the triggering function in the UE (the SMS Application port ID shall be reserved for trigger messages). The SMS-SC does any necessary segmentation for larger messages.\n2.\tThe SMS-SC sends a Submit Trigger Confirm message to the MTC-IWF to confirm that the submission of the SMS has been accepted by the SMS-SC.\n3.\tThe MTC-IWF sends a Device Trigger Confirm message to the SCS to confirm that the Device Trigger Request has been accepted for delivery to the UE.\n4, 5, 6.  The short message is delivered to the UE (see MT SMS procedures specified in TS 23.040 [12]). This may involve delivery attempts in MSC, SGSN and/or MME. This may involve delivery attempts over IMS (as specified in TS 23.204 [13]).\nThe SMS-delivered trigger payload is processed and handled by the triggering function in the UE. Any information contained within the trigger payload is forwarded to the related or addressed UE-application.\n7.\tThe SMS-SC generate the necessary CDR information and includes the SCS Identifier. The SMS Application port which is included in the SM User Data Header is included in the CDRs, i.e. it is possible to perform differentiated charging for an SMS used for triggering purposes.\n8.\tThe SMS-SC shall always send a Message Delivery Report (cause code, trigger reference number, SCS Identifier) to the MTC-IWF.\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 23.682 clause 4.2 states \u201cTsms can be used to send a trigger to a UE encapsulated in a MT SMS as an over-the-top application by any network entity acting as a SME. Tsp is a 3GPP standardized interface to facilitate value-added services motivated by MTC (e.g. control plane device triggering) and provided by a SCS.\u201dCurrently, there is nothing specified on how to prevent entities outside the network from generating false, and fraudulent triggers that appear to have been submitted over Tsp from an authorized SCS e.g. through the SMSC Tsms I/F. Since UE\u2019s recognize Tsp based triggers based on a specified and defined SMS application port ID (per clause 5.2.2) and that this parameter can be easily set by entities outside the network accessing the SMSC directly through the Tsms I/F, it is currently fairly easy to create fraudulent triggers. The SMSC should restrict sending of Trigger messages (i.e. using the Triggering Port ID) over the Tsms I/F.\n\n>>> SUMMARY OF CHANGE\nAdded a text to ensure trigger messages received by the UE are only originated by the MTC-IWF and not by the Tsms I/F.\n\n>>> CONSEQUENCES IF NOT REVISED\nThe UE may receive fraudulent and unsolicited triggers."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n\n* * * 1st change * * *\n4.3.2.6\tAbnormal cases\n(a)\tRR connection failure:\n\tUpon detection of a RR connection failure before the AUTHENTICATION RESPONSE message is received, the network shall release all MM connections (if any) and abort any ongoing MM specific procedure.\n(b)\tExpiry of timer T3260:\n\tThe authentication procedure is supervised on the network side by the timer T3260. At expiry of this timer the network may release the RR connection. In this case the network shall abort the authentication procedure and any ongoing MM specific procedure, release all MM connections if any, and initiate the RR connection release procedure described in subclause\u00a03.5 of 3GPP\u00a0TS\u00a044.018\u00a0[84] (A/Gb mode only), 3GPP\u00a0TS\u00a025.331\u00a0[23c] (UTRAN Iu mode only), or in 3GPP\u00a0TS\u00a044.118\u00a0[111] (GERAN Iu mode only). \n(c) Authentication failure (reject cause \"MAC failure\" or \"GSM authentication unacceptable\"):\n\tThe MS shall send an AUTHENTICATION FAILURE message, with reject cause \"MAC failure\" or \"GSM authentication unacceptable\" according to subclause\u00a04.3.2.5.1, to the network and start timer T3214. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3210, T3220 or T3230). Upon the first receipt of an AUTHENTICATION FAILURE message from the MS with reject cause \"MAC failure\" or \"GSM authentication unacceptable\", the network may initiate the identification procedure described in subclause\u00a04.3.3. This is to allow the network to obtain the IMSI from the MS. The network may then check that the TMSI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the MS shall send the IDENTITY RESPONSE message.\nNOTE:\tUpon receipt of an AUTHENTICATION FAILURE message from the MS with reject cause \"MAC failure\" or \"GSM authentication unacceptable\", the network may also terminate the authentication procedure (see subclause\u00a04.3.2.5).\n\tIf the TMSI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the MS. Upon receiving the new AUTHENTICATION REQUEST message from the network, the MS shall stop the timer T3214, if running, and then process the challenge information as normal. If theTMSI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message.\n\tIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the MS shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3210, T3220 or T3230), if they were running and stopped when the MS received the first failed AUTHENTICATION REQUEST message.\n\tIf the MS receives the second AUTHENTICATION REQUEST message while T3214 is running, and the MAC value cannot be resolved or the message contains a GSM authentication challenge, the MS shall follow the procedure specified in this subclause (c), starting again from the beginning. If the SQN is invalid, the MS shall proceed as specified in (d).\n\tIt can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the MS) if any of the following occur:\n-\tthe timer T3214 expires;\n-\tthe MS detects any combination of the authentication failures: \"MAC failure\", \"invalid SQN\", and \"GSM authentication unacceptable\", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3214 or T3216 started after the previous authentication failure is running.\n\tWhen it has been deemed by the MS that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the MS), the MS shall behave as described in subclause\u00a04.3.2.6.1.\n\n\nFigure 4.2/3GPP TS 24.008: Authentication Failure Procedure \n(reject cause \"MAC failure\" or \"GSM authentication unacceptable\")\n(d) Authentication failure (reject cause \"synch failure\"):\n\tThe MS shall send an AUTHENTICATION FAILURE message, with reject cause \"synch failure\", to the network and start the timer T3216. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3210, T3220 or T3230). Upon the first receipt of an AUTHENTICATION FAILURE message from the MS with the reject cause \"synch failure\", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the VLR/MSC to delete all unused authentication vectors for that IMSI and obtain new vectors from the HLR. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the MS shall stop the timer T3216, if running.\nNOTE:\tUpon receipt of two consecutive AUTHENTICATION FAILURE messages from the MS with reject cause \"synch failure\", the network may terminate the authentication procedure by sending an AUTHENTICATION REJECT message.\n\tIf the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3216 is running, the MS shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3210, T3220 or T3230), if they were running and stopped when the MS received the first failed AUTHENTICATION REQUEST message.\nIf the MS receives the second AUTHENTICATION REQUEST message while T3216 is running, and the MAC value cannot be resolved or the message contains a GSM authentication challenge, the MS shall proceed as specified in (c); if the SQN is invalid, the MS shall follow the procedure specified in this subclause (d), starting again fom the beginning.\nThe MS shall deem that the network has failed the authentication check and behave as described in subclause\u00a04.3.2.6.1, if any of the following occurs:\n-\tthe timer T3216 expires;\n-\tthe MS detects any combination of the authentication failures: \"MAC failure\", \"invalid SQN\", and \"GSM authentication unacceptable\", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3214 or T3216 started after the previous authentication failure is running.\n\tWhen it has been deemed by the MS that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the MS), the MS shall behave as described in subclause\u00a04.3.2.6.1.\n\nFigure 4.2a/3GPP TS 24.008: Authentication Failure Procedure (reject cause \"Synch failure\")\n\tUpon receipt of an AUTHENTICATION REJECT message, the mobile station shall perform the actions as specified in subclause\u00a04.3.2.5.\n\n* * * 2nd change * * *\n11.2.1\tTimer T3240 and Timer T3241\nTimer T3240 is started in the mobile station when:\n-\tthe mobile station receives a LOCATION UPDATING ACCEPT message completing a location updating procedure in the cases specified in subclauses 4.4.4.6 and 4.4.4.8;\n-\tthe mobile station receives a LOCATION UPDATING REJECT message in the cases specified in subclause\u00a04.4.4.7;\n-\tthe mobile station has sent a CM SERVICE ABORT message as specified in subclause\u00a04.5.1.7;\n-\tthe mobile station has released or aborted all MM connections in the cases specified in 4.3.2.5, 4.3.5.2, 4.5.1.1, and 4.5.3.1;\n-\tthe mobile station receives the paging message from network and enter the MM state 9 (WAIT FOR NETWORK COMMAND).\nTimer T3240 is stopped, reset, and started again at receipt of an MM message.\nTimer T3240 is stopped and reset (but not started) at receipt of a CM message that initiates establishment of an CM connection (an appropriate SETUP, REGISTER, or CP-DATA message as defined in 3GPP TS 24.008, 3GPP TS 24.010 [21] or 3GPP TS 24.011 [22]).\nIf timer T3240 expires, the MS shall abort the RR connection and enter the MM state MM IDLE.\nTimer T3241 is started in the mobile station when entering MM state RR CONNECTION RELEASE NOT ALLOWED.\nTimer T3241 is stopped and reset (but not started) when the MM state RR CONNECTION RELEASE NOT ALLOWED is left.\nIf timer T3241 expires, the MS shall abort the RR connection and enter the MM state MM IDLE. \n\n* * * End of changes * * *\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nAs described in discussion paper C1-12xxxx, scenarios exist that cause a clash between the networks desire to try and authenticate the MS and the MS\u2019s desire to abort the RR connection. The issue occurs when the UE enters the \u201cWAITING FOR NETWORK COMMAND\u201d state and runs the guard timer governing the release of the RR connection (timer T3240). The network (with a MM connection established) performs an authentication request which fails and the UE starts timer T3214 or T3216. Timers T3214 and T3216 are guard timers that govern the re-transmission of the authentication request depending on the error returned. When both T3240 and T3214 or T3216 are running, the UE will abort the RR connection on T3240 expiry even though the retry of the authentication procedure by the network (governed by timer T3214 or T3216) is in progress. The result is an impact to the authentication procedure and further mobile terminating operation.\n\n>>> SUMMARY OF CHANGE\nNormally timer T3240 is stopped, reset and started again at receipt of an MM message. EXCEPTION: Stop the timer T3240 whenever the UE receives an Authentication Request and the UE needs to send Authentication Failure and when the UE starts timers T3214 or T3216. Restart T3240 after receiving a new Authentication Request message when an Authentication response is sent (USIM accepts the authentication challenge).\n\n>>> CONSEQUENCES IF NOT REVISED\nAborting the RR Connection from the UE side during the Authentication procedure can be avoided.The network is actively trying to retry the authentication procedure, so then it would seem useless for the network to even go the trouble of performing resync with the HLR and retrying if the UE is in a possible position to release the signalling connection.The Authentication procedure for specific failure cases is guarded by large timers of large duration, T3214(20s) or T3216(15s). Having one more shorter timer T3240(10s) in parallel is redundant. If the reason for MM moving into Wait For Network Command state was due to the completion of the paging procedure for an mobile terminating call or SMS, release of the RR connection could impact user functionality."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Start of Change *****\n6.3.3.2\tAttributes\nAttribute name\tSupport Qualifier\tisReadable\tisWritable\tisInvariant\tisNotifyable\nserviceProfileId\tM\tT\tF\tT\tT\nsNSSAIList\tM\tT\tT\tF\tT\npLMNIdList\tM\tT\tT\tF\tT\nperfReq\tM\tT\tT\tF\tT\nmaxNumberofUEs\tO\tT\tT\tF\tT\ncoverageAreaTAList\tO\tT\tT\tF\tT\nlatency\tO\tT\tT\tF\tT\nuEMobilityLevel\tO\tT\tT\tF\tT\nresourceSharingLevel\tO\tT\tT\tF\tT\nsST\tM\tT\tT\tF\tT\navailability\tM\tT\tT\tF\tT\n\n***** Next Change *****\n\n6.3.3.3\tAttribute constraints\nNone.\n\n\n***** Next Change *****\n6.3.4.2\tAttributes\nAttribute name\tSupport Qualifier\tisReadable\tisWritable\tisInvariant\tisNotifyable\nsliceProfileId\tM\tT\tF\tT\tT\nsNSSAIList\tM\tT\tT\tF\tT\npLMNIdList\tM\tT\tT\tF\tT\nperfReq\tM\tT\tT\tF\tT\nmaxNumberofUEs\tO\tT\tT\tF\tT\ncoverageAreaTAList\tO\tT\tT\tF\tT\nlatency\tO\tT\tT\tF\tT\nuEMobilityLevel\tO\tT\tT\tF\tT\nresourceSharingLevel\tO\tT\tT\tF\tT\n\n***** Next Change *****\n\n6.3.4.3\tAttribute constraints\nNone.\n\n\n***** End of Changes *****\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIsolation is one of the key expectations of network slicing. A network slice instance may be fully or partly, logically and/or physically, isolated from another network slice instance. Isolation Level Support is one of GST attributes which is defined in GSMA NG.116 for Network Slicing requirement.It is important to define some attributes for network slice isolation level, which would protect sensitive data inside a relative network slice\n\n>>> SUMMARY OF CHANGE\nDefine isolationLevel attribute to describe different types of isolation for a network slice in ServiceProfile class and SliceProfile class\n\n>>> CONSEQUENCES IF NOT REVISED\nWithout specifying different types of isolation, the risk of a network slice sercurity will be more higher.Weak network slice isolation and connection may compromise the entire 5G security,sensitive data managed inside a network slice, could be exposed to applications running in other network slices services, through side channel attacks"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Next change *****\n5.1.1\tGeneral\nThe service authorisation for ProSe direct discovery and ProSe direct communication determines whether the UE is authorised to use ProSe direct discovery announcing or ProSe direct discovery monitoring or both, and to use ProSe direct communication, in a particular PLMN or when not served by E-UTRAN. In this release of the specification, ProSe direct communication is supported only for Public Safety ProSe-enabled UE. The service authorisation is either:\n1)\tpre-configured in the UE. The pre-configured service authorisation may be stored in the ME, or in the USIM as specified in 3GPP\u00a0TS\u00a031.102\u00a0[17], or in both the ME and the USIM. If both the ME and the USIM contain the same parameters, the values stored in the USIM shall take precedence. The UE shall not use the pre-configured service authorisation if the contents of the USIM indicate that the UE is not authorised to use them (see 3GPP\u00a0TS\u00a031.102\u00a0[17]); or\n2)\ttransferred between the UE and the ProSe Function over the PC3 interface with the ProSe Direct Services Provisioning Management Object or the ProSe Public Safety Direct Services Provisioning Management Object as specified in 3GPP\u00a0TS\u00a024.333\u00a0[9]. The communication security over the PC3 interface is specified in 3GPP\u00a0TS\u00a033.303\u00a0[6].\nWhen using option 2) above, the UE shall request service authorisation to use ProSe direct discovery or ProSe direct communication or both from the ProSe Function of the HPLMN. As specified in 3GPP\u00a0TS\u00a029.345\u00a0[5], the ProSe Function of the HPLMN contacts the ProSe Function of each local PLMN or VPLMN to obtain the service authorisation, merges it with its own service authorisation and sends the merged service authorisation to the UE.\nNOTE\u00a01:\tHow the Prose Function in the HPLMN merges the authorisation policy is implementation dependent.\nThe service authorisation provided by the ProSe Function of the HPLMN for ProSe direct discovery contains a list of PLMNs in which the UE is authorised to use ProSe direct discovery.\nThe service authorisation provided by the ProSe Function of the HPLMN for ProSe direct communication indicates:\n-\twhether the UE is authorised to perform ProSe direct communication when not served by E-UTRAN, and if so, the required radio parameters to be used for ProSe direct communication when not served by E-UTRAN;\n-\tthe ProSe direct communication policy parameters; and\n-\tthe list of PLMNs in which the UE is authorised to use direct communication when served by E-UTRAN.\nAlternatively, the ProSe direct communication policy parameters mentioned above can be provided by the third party public safety provider application server, using mechanisms that are out of scope of the present specification. If the UE receives the same parameters from the third party public safety provider application server as those which had been previously transferred between the UE and the ProSe Function over the PC3 interface with the ProSe Public Safety Direct Services Provisioning Management Object, the UE shall use the parameters provided by the third party public safety provider application server for ProSe direct communication.\nThe UE discovers the IP address of the ProSe Functions of the HPLMN as specified in subclause\u00a05.1.2.\n\n\n\n\nAfter the UE is authorised to use ProSe direct discovery or ProSe direct communication or both, the ProSe Function of the HPLMN shall update the service authorisation:\na)\twhen the ProSe Function of the HPLMN is informed the ProSe related subscription data is updated at the HSS;\nb)\twhen the ProSe Function of the HPLMN decides to revoke the authorization for ProSe direct service; or\nc)\twhen the ProSe Function of the HPLMN is informed the ProSe Function of the VPLMN or local PLMN decides to revoke the authorization for ProSe direct service.\nThe ProSe Function of the HPLMN sends the updated authorization for ProSe direct service to the UE, e.g. by sending an OMA push message. The updated authorization for ProSe direct service does not include:\na)\tthe authorization for ProSe direct service (discovery or communication or both) which is to be revoked; and\nb)\tthe PLMN ID of the PLMN in which the service authorisation is to be revoked.\nNOTE\u00a02:\tThe ProSe Function of the HPLMN can send the updated authorization for ProSe direct service to the UE immediately or wait for the next time when the UE communicates with the ProSe Function of the HPLMN based on operator's policy; in the latter case, the UE is allowed to use ProSe direct services until the next time that it will communicate with the ProSe Function of the HPLMN.\n***** Next change *****\n6.1.1\tTransport protocol for PC3 Control Protocol messages for ProSe direct discovery \nThe UE and ProSe Function shall use HTTP\u00a01.1 as specified in IETF\u00a0RFC\u00a07230\u00a0[18] and IETF\u00a0RFC\u00a07231\u00a0[19] as the transport protocol for ProSe messages over the PC3 interface. The ProSe messages described here shall be included in the body of either an HTTP request message or an HTTP response message. The following rules apply:\n-\tThe UE initiates ProSe transactions with an HTTP request message containing the PC3 request(s)\n;\n\n\n- \tThe ProSe Function responds to the requests with an HTTP response message containing the PC3 response(s) for the PC3 request(s); and\n-\tHTTP POST methods are used for PC3 direct discovery procedures.\n***** Next change *****\n7.1.2\tHandling of UE-initiated procedures\nThe following rules apply for UE-initiated procedures:\n-\tThe UE initiates ProSe transactions with an HTTP request message containing the PC3 request(s)\n\n; and\n\n-\tThe ProSe Function responds to the requests with an HTTP response message containing the PC3 response(s) for the PC3 request(s).\n***** Next change *****\n\n\n\n\n\n\n\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIt is not clear today which PDN connection the UE uses to reach the HPLMN ProSe Function.If the ProSe UE can use any PDN connection of the UE to reach HPLMN ProSe function, then packet data network accessible via each PDN connection of the UE must be configured to enable routing to HPLMN ProSe Function (when P-GW is in HPLMN) or to ProSe Proxy Function (when P-GW is in VPLMN).Given that, subject to subscription, ProSe UE can access any packet data network (including packet data network of IMS APN with P-GW in VPLMN), this implies that the operator must adjust all its packet data networks. Moreover, the HPLMN will need to make an agreement with VPLMNs to deploy the ProSe Proxy Functions in packet data networks accessible via the PDN connections of the UE with a P-GW in VPLMN. That's quite a big impact on the network operation.In order to avoid this impact on the network operation, it would be preferable to configure the UE with APN of PDN connection to be used for communication with HPLMN ProSe Function.Stage-2 states:NOTE:The ProSe Function in HPLMN can be always reached if Home Routed configuration is applied for PDN connection (e.g. PDN GW is located in the HPLMN), when such function is supported by the HPLMN. In case of Local Breakout (e.g. PDN GW is located in the VPLMN), a ProSe Proxy Function can be deployed by the VPLMN to support UE to Home ProSe Function communication, if inter-PLMN signalling is required. Whether a PDN connection is provided by Local Breakout or Home Routed is determined by the HSS configuration described in 3GPP TS\u00a023.401\u00a0[5]. UE is not aware of this and as such will not know which APN can be used for communication with ProSe Function unless a specific APN for ProSe is configured.\n\n>>> SUMMARY OF CHANGE\nThe UE uses a PDN connection established using UE configuration to reach the HPLMN ProSe Function. The PDN connection can carry other traffic (i.e. non ProSe related) too.\n\n>>> CONSEQUENCES IF NOT REVISED\nDeployment problems since:- the operator would be required to reconfigure all its packet data networks, accessible from ProSe UEs, to provide routing to HPLMN ProSe function; and- the operator would be required to ensure that VPLMN deploys ProSe Proxy function and reconfigures all its packet data networks, accessible using local break out from a roaming ProSe UEs, to provide routing to the ProSe Proxy function."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n3\tDefinitions, symbols and abbreviations\n3.1\tDefinitions\nFor the purposes of the present document, the terms and definitions given in 3GPP TR\u00a021.905\u00a0[1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP\u00a0TR\u00a021.905\u00a0[1].\nAutomatic commencement mode: A mode in which the initiation of the private call does not require any action on the part of the receiving MCPTT user.\nGroup affiliation: A mechanism by which an MCPTT user's interest in one or more MCPTT groups is determined.\nGroup call: A mechanism by which an MCPTT user can make a one-to-many MCPTT transmission to other users that are members of MCPTT group(s).\nGroup de-affiliation: A mechanism by which an MCPTT user's interest in one or more MCPTT groups is removed.\nGroup home MCPTT system: The MCPTT system where the MCPTT group is defined.\nGroup host MCPTT server: The MCPTT server within an MCPTT system which provides centralised support for MCPTT services of an MCPTT group defined in a group home MCPTT system.\nManual commencement mode: A mode in which the initiation of the private call requires the receiving MCPTT user to perform some action to accept or reject the call setup.\nOn-network MCPTT service: The collection of functions and capabilities required to provide MCPTT via EPS bearers using E-UTRAN to provide the last hop radio bearers.\nUE-to-network relay MCPTT service: The collection of functions and capabilities required to provide MCPTT via a ProSe UE-to-network relay using ProSe direct communication paths to provide the last hop radio bearer(s).\n\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a022.179\u00a0[2] apply:\nDispatcher\nFloor control\nMCPTT administrator\nMCPTT service\nMCPTT system\nMCPTT UE\nMCPTT user\nMission Critical Push To Talk\nOff-network MCPTT service\nPartner MCPTT system\nPrimary MCPTT system\nPrivate call\n\nFor the purposes of the present document, the following terms and definitions given in IETF\u00a0RFC\u00a05245\u00a0[14] apply:\nCandidate\nCandidate pair\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe term \"trust domain\" is used through-out TS 23.179 but is currently undefined within the specification.\n\n>>> SUMMARY OF CHANGE\nAdd a definition for the frequently used term \"trust domain\".\n\n>>> CONSEQUENCES IF NOT REVISED\nThe term \"trust domain\", which is used through-out TS 23.179, will remain undefined and thus open to potentially different interpretations by the reader. Different interpretations of what is a trust domain could potentially lead to inadvertent sharing of private information between two different domains (e.g. two different MCPTT systems)."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nFIRST PROPOSED CHANGE\n\n9.1.8.4\tS1 SETUP REQUEST\nThis message is sent by the eNB to transfer information for a TNL association.  \nDirection: eNB  MME\nIE/Group Name\tPresence\tRange\tIE type and reference\tSemantics description\tCriticality\tAssigned Criticality\nMessage Type\tM\t\t9.2.1.1\t\tYES\tReject\neNB ID\tM\t\tOCTET STRING\t\tYES\tReject\neNB Name\tM\t\tOCTET STRING\tFSS if IE is optional\tYES\tIgnore\nSupported TAIs\t\t1..<maxnoofTAIs>\t\tSupported  TAIs in the eNB\tGLOBAL\tReject\n>TAI\tM\t\tOCTET STRING\t\t-\n>Broadcast PLMNs\t\t1..<maxnoofBPLMNs>\t\tBroadcast PLMNs \t-\n >>PLMN Identity\tM\t\tOCTET STRING (SIZE (3))\t\t-\n\nRange bound\tExplanation\nmaxnoofTAIs\tMaximum no. of TAIs. Value is FFS.\n\nRange bound\tExplanation\nmaxnoofBPLMNs\tMaximum no. of Broadcasted PLMNs. Value is FFS.\n\nNEXT PROPOSED CHANGE\n\n9.2.1\tRadio Network Layer Related IEs\n\n\n\n\n\nNEXT PROPOSED CHANGE\n\n9.3.3\tPDU Definitions\n-- **************************************************************\n--\n-- PDU definitions for S1AP.\n--\n-- **************************************************************\n\nS1AP-PDU-Contents { \nitu-t (0) identified-organization (4) etsi (0) mobileDomain (0) \neps-Access (20) modules (3) s1ap (1) version1 (1) s1ap-PDU-Contents (1) }\n\nDEFINITIONS AUTOMATIC TAGS ::= \n\nBEGIN\n\n-- **************************************************************\n--\n-- IE parameter types from other modules.\n--\n-- **************************************************************\n\nIMPORTS\n\tAggregateMaximumBitrate,\n\tMME-UE-S1AP-ID,\n\tENB-UE-S1AP-ID,\n\tHandoverType,\n\tCause,\n\tSourceID,\n\tTargetID,\n\tSourceeNodeB-ToTargeteNodeB-TransparentContainer,\n\tSourceRNC-ToTargetRNC-TransparentContainer,\n\tSourceBSS-ToTargetBSS-TransparentContainer,\n\tTargeteNodeB-ToSourceeNodeB-TransparentContainer,\n\tTargetRNC-ToSourceRNC-TransparentContainer,\n\tTargetBSS-ToSourceBSS-TransparentContainer,\t\n\tSAE-Bearer-ID,\n\tTransportLayerAddress,\n\tGTP-TEID,\n\tSAE-BearerLevelQoSParameters,\n\tSAEBearerList,\n\tCause,\n\tTraceActivation,\n\tNAS-PDU,\n\tUserDataType,\n\tSecurityInformation,\n\tS-TMSI,\n\tPagingDRX,\n\tPagingCause,\n\tTAId,\n\tCriticalityDiagnostics,\n\tENB-ID,\n\tENBname,\n\tMMEname,\n\tNRIs,\n\tServedPLMNs,\n\tSupportedTAIs,\n\tTimeToWait,\n\tHandoverRestrictionList,\n\tPLMNidentity\n\n\n\nFROM S1AP-IEs\n\n\tPrivateIE-Container{},\n\tProtocolExtensionContainer{},\n\tProtocolIE-Container{},\n\tProtocolIE-ContainerList{},\n\tProtocolIE-ContainerPair{},\n\tProtocolIE-ContainerPairList{},\n\tProtocolIE-SingleContainer{},\n\tS1AP-PRIVATE-IES,\n\tS1AP-PROTOCOL-EXTENSION,\n\tS1AP-PROTOCOL-IES,\n\tS1AP-PROTOCOL-IES-PAIR\nFROM S1AP-Containers\n\n\n\tid-aggregateMaximumBitrate,\n\tid-Cause,\n\tid-CriticalityDiagnostics,\n\tid-ENB-ID,\n\tid-eNBname,\n\tid-eNB-UE-S1AP-ID, \n\tid-GERANtoLTEHOInformationReq,\n\tid-GERANtoLTEHOInformationRes,\n\tid-HandoverRestrictionList,\n\tid-HandoverType,\n\tid-InitialContextSetup,\n\tid-Intra-LTEHOInformationReq,\n\tid-Intra-LTEHOInformationRes,\n\tid-LTEtoGERANHOInformationReq,\n\tid-LTEtoGERANHOInformationRes,\n\tid-LTEtoUTRANHOInformationReq,\n\tid-LTEtoUTRANHOInformationRes,\n\tid-MMEname,\n\tid-MME-UE-S1AP-ID,\n\tid-NAS-PDU,\n\tid-NRIs,\n\tid-pagingCause,\n\tid-pagingDRX,\n\tid-ServingPLMN,\n\tid-SAEBearerAdmittedItem,\n\tid-SAEBearerAdmittedList,\n\tid-SAEBearerDataForwardingItem,\n\tid-SAEBearerFailedToModifyList,\n\tid-SAEBearerFailedToReleaseList,\n\tid-SAEBearerFailedtoSetupItemHOReqAck,\n\tid-SAEBearerFailedToSetupListBearerSURes,\n\tid-SAEBearerFailedToSetupListCtxtSURes,\n\tid-SAEBearerFailedToSetupListHOReqAck,\n\tid-SAEBearerModify,\n\tid-SAEBearerModifyItemBearerModRes,\n\tid-SAEBearerModifyListBearerModRes,\n\tid-SAEBearerRelease,\n\tid-SAEBearerReleaseItemBearerRelComp,\n\tid-SAEBearerReleaseItemHOCmd,\n\tid-SAEBearerReleaseListBearerRelComp,\n\tid-SAEBearerReleaseRequest,\n\tid-SAEBearerSetup,\n\tid-SAEBearerSetupItemBearerSURes,\n\tid-SAEBearerSetupItemCtxtSURes,\n\tid-SAEBearerSetupListBearerSURes,\n\tid-SAEBearerSetupListCtxtSURes,\n\tid-SAEBearerSubjecttoDataForwardingList,\n\tid-SAEBearerToBeModifiedItemBearerModReq,\n\tid-SAEBearerToBeModifiedListBearerModReq,\n\tid-SAEBearerToBeReleasedList,\n\tid-SAEBearerToBeSetupItemBearerSUReq,\n\tid-SAEBearerToBeSetupItemCtxtSUReq,\n\tid-SAEBearerToBeSetupItemHOReq,\n\tid-SAEBearerToBeSetupListBearerSUReq,\n\tid-SAEBearerToBeSetupListCtxtSUReq,\n\tid-SAEBearerToBeSetupListHOReq,\n\tid-SAEBearerToBeSwitchedDLItem,\n\tid-SAEBearerToBeSwitchedDLList,\n\tid-SAEBearertoReleaseListHOCmd,\n\tid-Security-Information,\n\tid-ServedPLMNs,\n\tid-SourceID,\n\tid-s-TMSI,\n\tid-SupportedTAIs,\n\tid-TAId,\n\tid-TAIdItem,\n\tid-TAIdList,\n\tid-TargetID,\n\tid-TimeToWait,\n\tid-TraceActivation,\n\tid-UTRANtoLTEHOInformationReq,\n\tid-UTRANtoLTEHOInformationRes,\n\n\tmaxnoofTAI,\n\tmaxNrOfErrors,\n\tmaxNrOfSAEBs\n\n\nFROM S1AP-Constants;\n\n-- **************************************************************\n--\n-- Common Container Lists\n--\n-- **************************************************************\n\nSAEB-IE-ContainerList                  { S1AP-PROTOCOL-IES      : IEsSetParam }\t::= ProtocolIE-ContainerList     { 1, maxNrOfSAEBs,   {IEsSetParam} }\nSAEB-IE-ContainerPairList              { S1AP-PROTOCOL-IES-PAIR : IEsSetParam }\t::= ProtocolIE-ContainerPairList { 1, maxNrOfSAEBs,   {IEsSetParam} }\nProtocolError-IE-ContainerList        { S1AP-PROTOCOL-IES      : IEsSetParam }\t::= ProtocolIE-ContainerList     { 1, maxNrOfSAEBs,   {IEsSetParam} }\n\n\n\n-- **************************************************************\n--\n-- S1 SETUP ELEMENTARY PROCEDURE\n--\n-- **************************************************************\n\n-- **************************************************************\n--\n-- S1 Setup Request\n--\n-- **************************************************************\n\nS1SetupRequest ::= SEQUENCE {\n\tprotocolIEs\t\t\tProtocolIE-Container       { {S1SetupRequestIEs} },\n\t...\n}\n\nS1SetupRequestIEs S1AP-PROTOCOL-IES ::= {\n\t{ ID id-ENB-ID\t\t\t\tCRITICALITY reject\tTYPE ENB-ID\t \t\t\tPRESENCE mandatory\t}|\n\t{ ID id-eNBname\t\t\t\tCRITICALITY ignore\tTYPE ENBname\t\t\tPRESENCE mandatory\t}|\n\t{ ID id-SupportedTAIs\t\tCRITICALITY reject\tTYPE SupportedTAIs\t \tPRESENCE mandatory\t}\n,\n\t...\n}\n\n\n\n\n\nNEXT PROPOSED CHANGE\n9.3.4\tInformation Element Definitions\n-- **************************************************************\n--\n-- Information Element Definitions\n--\n-- **************************************************************\n\nS1AP-IEs { \nitu-t (0) identified-organization (4) etsi (0) mobileDomain (0) \neps-Access (20) modules (3) s1ap (1) version1 (1) s1ap-IEs (2) }\n\nDEFINITIONS AUTOMATIC TAGS ::= \n\nBEGIN\n\nIMPORTS\n\tid-SAEBearerItem,\n\tmaxNrOfSAEBs,\n\tmaxNrOfInterfaces,\n\t\n\tmaxNrOfErrors,\n\tmaxnoofBPLMNs,\n\tmaxnoofNRIs,\n\tmaxnoofPLMNsPerMME,\n\tmaxnoofTAIs,\n\tmaxnoofEPLMNs,\n\tmaxnoofEPLMNsPlusOne,\n\tmaxnoofForbLACs,\n\tmaxnoofForbTAIs\n\nFROM S1AP-Constants\n\n\tCriticality,\n\tProcedureCode,\n\tProtocolIE-ID,\n\tTriggeringMessage\nFROM S1AP-CommonDataTypes\n\n\tProtocolExtensionContainer{},\n\tS1AP-PROTOCOL-EXTENSION,\n\tProtocolIE-SingleContainer{},\n\tS1AP-PROTOCOL-IES\n\nFROM S1AP-Containers;\t\n\n-- E\n\n\n\nNEXT PROPOSED CHANGE\n9.3.6\tConstant Definitions\n-- **************************************************************\n--\n-- Constant definitions\n--\n-- **************************************************************\n\nS1AP-Constants { \nitu-t (0) identified-organization (4) etsi (0) mobileDomain (0) \neps-Access (20) modules (3) s1ap (1) version1 (1) s1ap-Constants (4) } \n\nDEFINITIONS AUTOMATIC TAGS ::= \n\nBEGIN\n\n-- **************************************************************\n--\n-- Elementary Procedures\n--\n-- **************************************************************\n\nid-HandoverPreparation \t\t\t\tINTEGER ::= 0\nid-HandoverResourceAllocation \t\tINTEGER ::= 1\nid-HandoverNotification \t\t\tINTEGER ::= 2\nid-PathSwitchRequest \t\t\t\tINTEGER ::= 3\nid-HandoverCancel \t\t\t\t\tINTEGER ::= 4\nid-SAEBearerSetup\t\t\t\t\t\tINTEGER ::= 5\nid-SAEBearerModify \t\t\t\t\tINTEGER ::= 6\nid-SAEBearerRelease\t\t\t\t\tINTEGER ::= 7\nid-SAEBearerReleaseRequest\t\t\t\tINTEGER ::= 8\nid-InitialContextSetup\t\t\t\t\t\tINTEGER ::= 9\nid-Paging\t\t\t\t\t\t\tINTEGER ::= 10\nid-downlinkNASTransport\t\t\t\tINTEGER ::= 11\nid-initialUEMessage\t\t\t\t\tINTEGER ::= 12\nid-uplinkNASTransport\t\t\t\tINTEGER ::= 13\nid-Reset\t\t\t\t\t\t\tINTEGER ::= 14\nid-ErrorIndication\t\t\t\t\tINTEGER ::= 15\nid-NASNonDeliveryIndication\t\t\tINTEGER ::= 16\nid-S1Setup\t\t\t\t\t\t\tINTEGER ::= 17\nid-UEContextReleaseRequest\t\t\tINTEGER ::= 18\n\n-- **************************************************************\n--\n-- Extension constants\n--\n-- **************************************************************\n\nmaxPrivateIEs \t\t\t\t\t\tINTEGER ::= 65535\nmaxProtocolExtensions \t\t\t\tINTEGER ::= 65535\nmaxProtocolIEs\t\t\t\t\t\tINTEGER ::= 65535\n-- **************************************************************\n--\n-- Lists\n--\n-- **************************************************************\n\nmaxNrOfSAEBs\t\t\t\t\t\t\tINTEGER ::= 256\nmaxNrOfInterfaces\t\t\t\t\t\tINTEGER ::= 3   --FFS\nmaxnoofTAI\t\t\t\t\t\t\t\tINTEGER ::= 256 --FFS\nmaxNrOfErrors\t\t\t\t\t\t\tINTEGER ::= 256\nmaxnoofBPLMNs\t\t\t\t\t\t\tINTEGER ::= 6\nmaxnoofNRIs\t\t\t\t\t\t\t\tINTEGER ::= 512 -- FFS\nmaxnoofPLMNsPerMME\t\t\t\t\t\tINTEGER ::= 32 -- FFS\nmaxnoofTAIs\t\t\t\t\t\t\t\tINTEGER ::= 256  -- FFS \nmaxnoofEPLMNs\t\t\t\t\t\t\tINTEGER ::= 15\nmaxnoofEPLMNsPlusOne\t\t\t\t\tINTEGER ::= 16\nmaxnoofForbLACs\t\t\t\t\t\t\tINTEGER ::= 256\t\t-- FFS Value to be checked\nmaxnoofForbTAIs\t\t\t\t\t\t\tINTEGER ::= 256\t\t-- FFS Value to be checked\n\n\n\n-- **************************************************************\n--\n-- IEs\n--\n-- **************************************************************\n\nid-MME-UE-S1AP-ID\t\t\t\t\t\t\t\t\tINTEGER ::= 0\nid-HandoverType\t\t\t\t\t\t\t\t\tINTEGER ::= 1\nid-Cause\t\t\t\t\t\t\t\t\t\tINTEGER ::= 2\nid-SourceID\t\t\t\t\t\t\t\t\t\tINTEGER ::= 3\nid-TargetID\t\t\t\t\t\t\t\t\t\tINTEGER ::= 4\nid-Intra-LTEHOInformationReq\t\t\t\t\tINTEGER ::= 5\nid-LTEtoUTRANHOInformationReq\t\t\t\t\tINTEGER ::= 6\nid-LTEtoGERANHOInformationReq\t\t\t\t\tINTEGER ::= 7\nid-eNB-UE-S1AP-ID\t\t\t\t\t\t\t\tINTEGER ::= 8\nid-Intra-LTEHOInformationRes\t\t\t\t\tINTEGER ::= 9\nid-LTEtoUTRANHOInformationRes\t\t\t\t\tINTEGER ::= 10\nid-LTEtoGERANHOInformationRes\t\t\t\t\tINTEGER ::= 11\nid-SAEBearerSubjecttoDataForwardingList\t\tINTEGER ::= 12\nid-SAEBearertoReleaseListHOCmd\t\t\t\tINTEGER ::= 13\nid-SAEBearerDataForwardingItem\t\t\t\tINTEGER ::= 14\nid-SAEBearerReleaseItemBearerRelComp\t\t\tINTEGER ::= 15\nid-SAEBearerToBeSetupListBearerSUReq\t\t\tINTEGER ::= 16\nid-SAEBearerToBeSetupItemBearerSUReq\t\t\tINTEGER ::= 17\nid-SAEBearerAdmittedList\t\t\t\t\t\tINTEGER ::= 18\nid-SAEBearerFailedToSetupListHOReqAck\t\tINTEGER ::= 19\nid-SAEBearerAdmittedItem\t\t\t\t\t\tINTEGER ::= 20\nid-SAEBearerFailedtoSetupItemHOReqAck\t\t\t\tINTEGER ::= 21\nid-SAEBearerToBeSwitchedDLList\t\t\t\t\tINTEGER ::= 22\nid-SAEBearerToBeSwitchedDLItem\t\t\t\tINTEGER ::= 23\nid-SAEBearerToBeSetupListCtxtSUReq\t\t\t\tINTEGER::= 24\nid-TraceActivation\t\t\t\t\t\t\t\tINTEGER::= 25\nid-NAS-PDU\t\t\t\t\t\t\t\tINTEGER ::= 26\nid-SAEBearerToBeSetupItemHOReq\t\t\t\t\t\tINTEGER ::= 27\nid-SAEBearerSetupListBearerSURes\t\t\t\t\tINTEGER ::= 28\nid-SAEBearerFailedToSetupListBearerSURes\t\t\tINTEGER ::= 29\nid-SAEBearerToBeModifiedListBearerModReq\t\t\tINTEGER ::= 30\nid-SAEBearerModifyListBearerModRes\t\t\t\t\tINTEGER ::= 31\nid-SAEBearerFailedToModifyList\t\t\t\t\t\tINTEGER ::= 32\nid-SAEBearerToBeReleasedList\t\t\t\t\t\tINTEGER ::= 33\nid-SAEBearerReleaseListBearerRelComp\t\t\t\tINTEGER ::= 33\nid-SAEBearerFailedToReleaseList\t\t\t\t\tINTEGER ::= 34\nid-SAEBearerItem\t\t\t\t\t\t\t\t\tINTEGER ::= 35\nid-SAEBearerToBeModifiedItemBearerModReq\t\tINTEGER ::= 36\nid-SAEBearerModifyItemBearerModRes\t\t\t\tINTEGER ::= 37\nid-SAEBearerReleaseItem\t\t\t\t\t\t\tINTEGER ::= 38\nid-SAEBearerSetupItemBearerSURes\t\t\t\t\tINTEGER ::= 39\nid-Security-Information\t\t\t\t\t\t\tINTEGER ::= 40\nid-HandoverRestrictionList\t\t\t\t\t\tINTEGER ::= 41\nid-s-TMSI \t\t\t\t\t\t\t\t\t\tINTEGER ::= 43\nid-pagingDRX \t\t\t\t\t\t\t\t\tINTEGER ::= 44\nid-pagingCause\t\t\t\t\t\t\t\t\tINTEGER ::= 45\nid-TAIdList\t\t\t\t\t\t\t\t\t\tINTEGER ::= 46\nid-TAIdItem\t\t\t\t\t\t\t\t\t\tINTEGER ::= 47\nid-SAEBearerFailedToSetupListCtxtSURes\t\t\tINTEGER ::= 48\nid-SAEBearerReleaseItemHOCmd\t\t\t\t\tINTEGER ::= 49\nid-SAEBearerSetupItemCtxtSURes\t\t\t\t\tINTEGER ::= 50\nid-SAEBearerSetupListCtxtSURes\t\t\t\t\tINTEGER ::= 51\nid-SAEBearerToBeSetupItemCtxtSUReq\t\t\t\tINTEGER ::= 52\nid-SAEBearerToBeSetupListHOReq\t\t\t\tINTEGER ::= 53\nid-GERANtoLTEHOInformationReq\t\t\t\tINTEGER ::= 54\nid-GERANtoLTEHOInformationRes\t\t\t\tINTEGER ::= 55\nid-UTRANtoLTEHOInformationReq\t\t\t\tINTEGER ::= 56\nid-UTRANtoLTEHOInformationRes\t\t\t\tINTEGER ::= 57\nid-CriticalityDiagnostics \t\t\t\t\tINTEGER ::= 58\nid-ENB-ID\t\t\t\t\t\t\t\t\tINTEGER ::= 59\nid-eNBname\t\t\t\t\t\t\t\t\tINTEGER ::= 60\nid-MMEname\t\t\t\t\t\t\t\t\tINTEGER ::= 61\nid-NRIs\t\t\t\t\t\t\t\t\t\tINTEGER ::= 62\nid-ServedPLMNs\t\t\t\t\t\t\t\tINTEGER ::= 63\nid-SupportedTAIs\t\t\t\t\t\t\tINTEGER ::= 64\nid-TimeToWait\t\t\t\t\t\t\t\tINTEGER ::= 65\nid-aggregateMaximumBitrate\t\t\t\t\tINTEGER ::= 66\nid-TAId\t\t\t\t\t\t\t\t\t\tINTEGER ::= 67\nid-ServingPLMN\t\t\t\t\t\t\t\tINTEGER ::= 68\n\n\n\nEND\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\neNB security capabalities needs to be provided to the MME for AS security algorithm selection in the MME. The usefulness of having the eNB security capabilites was confirmed by SA3 in R3-080054.\n\n>>> SUMMARY OF CHANGE\nThe eNB security capablity IE is included in the S1 Setup Request message, ASN.1 is added\n\n>>> CONSEQUENCES IF NOT REVISED\nMME has no means to select AS security algorithm"}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\nDetailed proposal\n6.1.1\tAuthentication framework\n***** Start of Change 1 *****\n6.1.1.1\tGeneral\nThe purpose of the primary authentication and key agreement procedures is to enable mutual authentication between the UE and the network and provide keying material that can be used between the UE and network in subsequent security procedures. The keying material generated by the primary authentication and key agreement procedure results in an anchor key called the KSEAF provided by the AUSF of the home network to the SEAF of the serving network.\nKeys for more than one security context can be derived from the KSEAF without the need of a new authentication run. A concrete example of this is that an authentication run over a 3GPP access network can also provide keys to establish security between the UE and a N3IWF used in untrusted non-3GPP access. \nThe authentication run also results in an intermediate key called the KAUSF. The KAUSF may be left at the AUSF based on the home operator's policy on using such key. \nNOTE 1:\tThis feature is an optimization that may be useful, for example, when a UE registers to different serving networks for 3GPP-defined access and untrusted non-3GPP access (this is possible according to TS 23.501 [2]).\nNOTE 2:\tA subsequent authentication based on a key left at the AUSF gives somewhat weaker guarantees than an authentication directly involving the ARPF and the USIM. It is rather comparable to fast re-authentication in EAP-AKA'. \nEditor's Note: The details of an authentication procedure using a key left at the AUSF are FFS. They can be found in clause TBD.\nUE and serving network shall support EAP-AKA' and 5G AKA authentication methods.\nThe USIM shall reside on a UICC. The UICC may be removable or non removable.\nEditor's Note: ETSI SCP is working on a new secure element called SSP. The SSP can be included as another solution where the USIM can reside on, if the SSP is defined in the Release 15 timeframe and if it complies with the security requirements defined in the present document. \nNOTE 3:\tFor non-3GPP access networks USIM applies in case of terminal with 3GPP access capabilities.\nIf the terminal supports 3GPP access capabilities, the credentials used with EAP-AKA' and 5G AKA for non-3GPP access networks shall reside on the UICC.\nNOTE 4:\tEAP-AKA' and 5G AKA are the only authentication methods that are supported in UE and serving network, hence only they are described in sub-clause 6.1.3 of the present document. For a private network using the 5G system as specified in [7] an example of how additional authentication methods can be used with the EAP framework is given in the informative Annex B. \n\n***** End of Change 1 *****\n***** Start of Change 2 *****\n6.1.2\tInitiation of authentication and selection of authentication method\nThe initiation of the primary authentication is shown in Figure 6.1.2-1. \n\nFigure 6.1.2-1: Initiation of authentication procedure and selection of authentication method\nThe SEAF may initiate an authentication with the UE during any procedure establishing a signalling connection with the UE, according to the SEAF's policy. The UE shall use SUCI or 5G-GUTI in the Registration Request.\nThe SEAF shall invoke the Nausf_UEAuthentication service by sending a Nausf_UEAuthentication_Authenticate Requestmessage to the AUSF whenever the SEAF wishes to initiate an authentication. \nThe Nausf_UEAuthentication_Authenticate Request message shall contain either:\n-\tSUCI, as defined in the current specification, or\n-\tSUPI, as defined in TS 23.501 [2].\nThe SEAF shall include the SUPI in the Nausf_UEAuthentication_Authenticate Request message in case the SEAF has a valid 5G-GUTI and re-authenticates the UE. Otherwise the SUCI is included in Nausf_UEAuthentication_Authenticate Request. SUPI/SUCI structure is part of stage 3 protocol design.\nThe Nausf_UEAuthentication_Authenticate Request shall furthermore contain:\n-\tthe serving network name, as defined in sub-clause 6.1.1.2 of the present document.\nNOTE 2:\tThe local policy for the selection of the authentication method does not need to be on a per-UE basis, but can be the same for all UEs.\nUpon receiving the Nausf_UEAuthentication_Authenticate Request message, the AUSF shall check that the requesting SEAF in the serving network is entitled to use the serving network name in the Nausf_UEAuthentication_Authenticate Request by comparing the serving network name with the expected serving network name. The AUSF shall store the received serving network name temporarily. If the serving network is not authorized to use the serving network name, the AUSF shall respond with \"serving network not authorized\" in the Nausf_UEAuthentication_Authenticate Response.\nThe Nudm_UEAuthentication_Get Request sent from AUSF to UDM includes the following information:\n-\tSUCI or SUPI;\n-\tthe serving network name;\nUpon reception of the Nudm_UEAuthentication_Get Request, the UDM/SIDF shall be invoked if a SUCI is received. SIDF shall de-conceal SUCI to gain SUPI before UDM can process the request.\nBased on SUPI, the UDM/ARPF shall choose the authentication method, based on the subscription data. \nNOTE 3:\tThe Nausf_UEAuthentication_Authenticate Response message is the reply to the Nausf_UEAuthentication_Authenticate Request message and is described as part of the authentication procedures in section 6.1.3.\n***** End of Change 2 *****\n6.1.3\tAuthentication procedures\nEditor's Note: The term authentication vector in this clause is used for authentication vectors that contain different elements. It is FFS to specify what is in each authentication vector.\t\n6.1.3.1\tAuthentication procedure for EAP-AKA'\n***** Start of Change 3 *****\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\n***** End of Change 3 *****\n6.1.3.2\tAuthentication procedure for 5G AKA6.1.3.2.0\t5G AKA\n***** Start of Change 4 *****\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n***** End of Change 4 *****\n\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nTS 33.501, Clause 6.1.2 Initiation of authentication and selection of authentication method confirms the presence of re-authentication in 5G system as follows.\u201cThe SEAF shall include the SUPI in the Nausf_UEAuthentication_Authenticate Request message in case the SEAF has a valid 5G-GUTI and re-authenticates the UE.\u201d Moreover the possible usecase of the KAUSF is also discussed in the TS 33.501, subclause 6.1.1.1 General of clause 6.1.1Authentication framework which also states that,\u201cThe authentication run also results in an intermediate key called the KAUSF. The KAUSF may be left at the AUSF based on the home operator's policy on using such key. Therefore with these information, the detailed fast re-authentication procedure is proposed to resolve the following related Editor\u2019s Note in subclause clause 6.1.1.1 General.Editor's Note: The details of an authentication procedure using a key left at the AUSF are FFS. They can be found in clause TBD.\n\n>>> SUMMARY OF CHANGE\nFast re-authentication procedure is proposed and a related EN is resolved from clause 6.1.1.1.\n\n>>> CONSEQUENCES IF NOT REVISED\nA time consuming authentication procedure need to be invoked for every registration request from a UE irrespective of their previous authentication with a same network."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n* * * First Change * * * *\n\nB.2.1\tPublic Identification\nThe following picture gives an outline of the UML model of Public Identification class:\n\nFigure B.2.1.1: Public Identification\nThe attribute BarringIndication is of type Boolean. If it is absent, or if it is present and set to FALSE, the S-CSCF shall not restrict the use of that public user identity in any IMS communications. If it is present and set to TRUE, the S-CSCF shall prevent that public identity from being used in any IMS communication except registrations and re-registrations, as specified in 3GPP TS 24.229 [8].\nPublic Identification class can contain an Identity attribute. The attribute IdentityType indicates the type of identity contained in each case. It could be either:\nA distinct Public User Identity\nA distinct Public Service Identity\nA Wildcarded Public Service Identity\nA non distinct Public User Identity, i.e. not explicitly provisioned in HSS.\nWildcarded Public User Identity\nIf the identity type is not present, it is assumed to be a distinct Public User Identity.\nThe attribute WildcardedPSI may be present (when IdentityType is WildcardedPSI) and contains the Wildcarded Public Service Identity that matched the Public Service Identity. This Wildcarded Public Service identity shall be sent as stored in the HSS, that is, including the delimiter described in 3GPP TS 23.003 [17].\nThe attribute DisplayName allows a name to be associated with a Public Identity.\nThe attribute AliasIdentityGroupID indicates the alias group to which the Public User Identity belongs. If the \"AliasInd\" feature is supported, all Public User Identities shall have an AliasIdentityGroupID allocated. Within an IMS subscription Public User Identities that have the same AliasIdentityGroupID allocated shall not be in different implicit registration sets and shall share their service profile, and shall be regarded aliases of each other. If the \"AliasInd\" feature is not supported, all Public User Identities within an IMS subscription that are within the same implicit registration set and share their service profile shall be regarded aliases of each other. \nThe attribute WildcardedIMPU shall be present when IdentityType is a non distinct IMPU or it may be optionally present when IdentityType is a Wildcarded IMPU. It contains the Wildcarded Public User Identity that matched the Public User Identity. This Wildcarded Public User identity shall be sent as stored in the HSS, that is, including the delimiter described in 3GPP TS 23.003 [17].\nThe attribute ServicePriorityLevel provides the Priority Levelallowed for the Public User Identity, which can be used by the S-CSCF and other network elements for Priority Service. \n* * * End of Change * * * *\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nWildcarded Public User Identities cannot be aliases\n\n>>> SUMMARY OF CHANGE\nClarify that the attribute AliasIdentityGroupID is not applicable to wildcarded public user identities.\n\n>>> CONSEQUENCES IF NOT REVISED\nAll Public User Identities matching a wildcard are forced to be aliases because they all belong to the same implicit registration set and share the same service profile."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***** Begin change *****\n6.4.7.5\tSteering of roaming via NAS messages\nWhen the ME receives an SOR transparent container, as specified in 3GPP\u00a0 TS\u00a024.501\u00a0 [70] clause 9.10.3.49, via a REGISTRATION ACCEPT message (see 3GPP\u00a0TS\u00a023.122\u00a0[7] Annex C.2 ) or via a DL NAS TRANSPORT message (see 3GPP\u00a0TS\u00a023.122\u00a0[7] Annex C.3 ), with the indication that the transparent container shall be forwarded to the USIM using SMS-PP data download, and the integrity check of the message was successful, the ME shall pass the transparent container to the USIM by using the procedure for SMS-PP data download via REGISTRATION ACCEPT or DL NAS TRANSPORT messages as described in section 7.1.1.1a\n\n\n\n\n\n\n\n***** End of change *****\n\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nIn the Steering of Roaming procedure defined in 3GPP TS 31.111, there is no definition of the ME maximum waiting time after transmitting the SOR transparent container to the USIM. This could lead to the ME waiting for too long for an answer from the USIM and may delay the authentication process.\n\n>>> SUMMARY OF CHANGE\nThe ME shall wait for an answer for at least 1 second.\n\n>>> CONSEQUENCES IF NOT REVISED\nThis could lead to the ME waiting for too long for an answer from the USIM and may delay the authentication process."}]
[{"role": "system", "content": "You are a cellular network protocol expert. Given a segment of the 3GPP specifications, you should envision what bad things may happen when following the statements, and analyze its potential design weakness. Then, you prepare a change request, which should include:\n1. **REASON FOR CHANGE**: Explain why the identified flaws need to be addressed.\n2. **SUMMARY OF CHANGE**: Provide a summary of the necessary changes to the specifications.\n3. **CONSEQUENCES IF NOT REVISED**: Describe the potential negative impacts if the proposed changes are not made.\n\nYou should avoid missing important statements and try your best to return detailed responses rich in reasoning."}, {"role": "user", "content": ">>> Original Specification Statements:\n\n\n***BEGIN CHANGES***\n5.28.3\tPort management information exchange in 5GS\n5.28.3.1\tGeneral\nBridge management information is exchanged between CNC and TSN AF. A subset of bridge management information, referred to as port management information, is related to Ethernet ports located in DS-TT or NW-TT.\n5GS shall support transfer of standardized and deployment-specific port management information transparently between TSN AF and DS-TT or NW-TT, respectively inside a Port Management Information Container. Table 5.28.3.1-1 lists standardized port management information.\nTable 5.28.3.1-1: Standardized port management information\nPort management information\tApplicability (see Note 6)\tSupported operations by TSN AF\n(see Note\u00a01)\tReference\n\tDS-TT\tNW-TT\nGeneral\n\nPort management capabilities (see Note 2)\tX\tX\tR\nBridge delay related information\ntxPropagationDelay\tX\tX\tR\tIEEE\u00a0802.1Qcc\u00a0[95] clause\u00a012.32.2.1\nTraffic class related information\nTraffic class table\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] clause\u00a012.6.3 and clause\u00a08.6.6.\nGate control information\nGateEnabled\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-29\nAdminBaseTime\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-29\nAdminControlList\tX\tX\tRW\tIEEE 802.1Q\u00a0[98] Table 12-29\nAdminCycleTime (see Note\u00a03)\tX\tX\tRW\tIEEE 802.1Q\u00a0[98] Table 12-29\nAdminControlListLength (see Note\u00a03)\tX\tX\tRW\tIEEE 802.1Q\u00a0[98] Table 12-28\nTick granularity\tX\tX\tR\tIEEE 802.1Q\u00a0[98] Table 12-29\nTraffic forwarding information\nStatic Filtering Entry (NOTE\u00a07)\t\tX\tRW\tIEEE 802.1Q\u00a0[98] clause\u00a08.8.1\nGeneral Neighbor discovery configuration\t(NOTE\u00a04)\nadminStatus\tD\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] clause\u00a09.2.5.1\nlldpV2LocChassisIdSubtype\tD\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nlldpV2LocChassisId\tD\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nlldpV2MessageTxInterval\tD\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nlldpV2MessageTxHoldMultiplier\tD\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nNW-TT port neighbor discovery configuration\nlldpV2LocPortIdSubtype\t\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nlldpV2LocPortId\t\tX\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nDS-TT port neighbor discovery configuration\nlldpV2LocPortIdSubtype\tD\tN\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nlldpV2LocPortId\tD\tN\tRW\tIEEE\u00a0802.1AB\u00a0[97] Table 11-2\nNeighbor discovery information for each discovered neighbor of NW-TT\nlldpV2RemChassisIdSubtype\t\tX\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemChassisId\t\tX\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemPortIdSubtype\t\tX\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemPortId\t\tX\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nTTL\t\tX\tR\tIEEE 802.1AB\u00a0[97] clause\u00a08.5.4\nNeighbor discovery information for each discovered neighbor of DS-TT\t(NOTE\u00a05)\nlldpV2RemChassisIdSubtype\tD\tN\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemChassisId\tD\tN\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemPortIdSubtype\tD\tN\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nlldpV2RemPortId\tD\tN\tR\tIEEE 802.1AB\u00a0[97] Table 11-2\nTTL\tD\tN\tR\tIEEE 802.1AB\u00a0[97] clause\u00a08.5.4.1\nPer-Stream Filtering and Policing information\t(NOTE\u00a010)\nStream Filter Instance Table\t(NOTE\u00a08)\t\t\t\tIEEE 802.1Q\u00a0[98] Table 12-32\nStreamHandleSpec\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-32\nPrioritySpec\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-32\nStreamGateInstanceID\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-32\nStream Gate Instance Table\t(NOTE\u00a09)\t\t\t\tIEEE 802.1Q\u00a0[98] Table 12-33\nStreamGateInstance\tX\tX\tR\tIEEE 802.1Q\u00a0[98] Table 12-33\nPSFPAdminBaseTime\tX\tX\tRW\tIEEE\u00a0802.1Q\u00a0[98] Table 12-33\nPSFPAdminControlList\tX\tX\tRW\tIEEE 802.1Q\u00a0[98] Table 12-33\nPSFPAdminCycleTime\tX\tX\tRW\tIEEE 802.1Q\u00a0[98] Table 12-33\nPSFPTickGranularity\tX\tX\tR\tIEEE 802.1Q\u00a0[98] Table 12-33\nNOTE\u00a01:\tR = Read only access; RW = Read/Write access.\tNOTE\u00a02:\tIndicates which standardized and deployment-specific port management information is supported by DS-TT or NW-TT.\tNOTE\u00a03:\tAdminCycleTime and AdminControlListLength are optional for gate control information.\tNOTE\u00a06:\tX = applicable; D = applicable when validation and generation of LLDP frames is processed at the DS-TT; N = applicable when validation and generation of LLDP frames is processed centrally at NW-TT.\tNOTE\u00a08:\tThere is a Stream Filter Instance Table per Stream.\tNOTE\u00a09:\tThere is a Stream Gate Instance Table per Gate.\tNOTE\u00a010:\tThe use of PSFP information is mandatory at the TSN AF and is optional at both DS-TT and NW-TT. TSN AF uses the PSFP information at TSN bridge configuration time to identify the DS-TT MAC address of the PDU Session as described in clause\u00a05.28.2 and for determination of the TSCAI information as described in Annex I. The PSFP information can be used at the DS-TT (if supported) and at the NW-TT (if supported) for the purpose of per-stream filtering and policing as defined in IEEE 802.1Q [98] clause\u00a08.6.5.1.\n\n\n\n\n\n\nExchange of port management information between TSN AF and NW-TT or DS-TT allows TSN AF to:\n1)\tretrieve port management information for a DS-TT or NW-TT Ethernet port;\n2)\tsend port management information for a DS-TT or NW-TT Ethernet port;\n3)\tsubscribe to and receive notifications if specific port management information for a DS-TT or NW-TT Ethernet port changes.\nExchange of port management information between TSN AF and NW-TT or DS-TT is initiated by DS-TT or NW-TT to:\n-\tnotify TSN AF if port management information has changed that TSN AF has subscribed for.\n\n\nExchange of port management information is initiated by DS-TT to:\n-\tprovide port management capabilities, i.e. provide information indicating which standardized and deployment-specific port management information is supported by DS-TT.\nTSN AF indicates inside the Port Management Information Container whether it wants to retrieve or send port management information or intends to (un-)subscribe for notifications.\n\n***NEXT CHANGE***\n\n5.28.3.2\tTransfer of port management information\nPort management information is transferred transparently via 5GS between TSN AF and DS-TT or NW-TT, respectively, inside a Port Management Information Container as follows:\n-\tTo convey port management information from DS-TT or NW-TT to TSN AF:\n-\tDS-TT provides a Port Management Information Container and the DS-TT port MAC address to the UE, which includes the Port Management Information container as an optional Information Element of an N1 SM container and triggers the UE requested PDU Session Establishment procedure/PDU Session Modification procedure to forward the Port Management Information container to the SMF. SMF forwards the Port Management Information container and the port number of the related DS-TT Ethernet port to TSN AF as described in TS\u00a023.502\u00a0[3] clause\u00a04.3.3.2;\n-\tNW-TT provides a Port Management Information Container to the UPF, which triggers the N4 Session Level Reporting Procedure to forward the Port Management Information Container to SMF. SMF in turn forwards the container and the port number of the related NW-TT Ethernet port to TSN AF as described in TS\u00a023.502\u00a0[3] clause\u00a04.16.5.1. If NW-TT provides a Port Management Information Container for an Ethernet port shared by multiple PDU sessions, then UPF forwards the Port Management Information Container only for one of those PDU sessions.\n\n-\tTo convey port management information from TSN AF to DS-TT or NW-TT:\n-\tTSN AF provides a Port Management Information Container, MAC address reported for a PDU Session (i.e. MAC address of the DS-TT port related to the PDU session) and the port number of the Ethernet port to manage to the PCF, which forwards the information to SMF based on the MAC address using the PCF initiated SM Policy Association Modification procedure as described in TS\u00a023.502\u00a0[3] clause\u00a04.16.5.2. SMF determines whether the port number relates to a DS-TT or NW-TT Ethernet port and based on this forwards the Port Management Information Container to DS-TT or NW-TT using the network requested PDU Session Modification procedure as described in TS\u00a023.502\u00a0[3] clause\u00a04.3.3.2. If the port number identifies an NW-TT Ethernet port shared by multiple PDU sessions, PCF and SMF forward the Port Management Information Container only for one of those PDU sessions.\n\n\n\n***END OF CHANGES***\n"}, {"role": "assistant", "content": ">>> REASON FOR CHANGE\nThe port management information table (Table 5.28.3.1-1) contains diverse information that falls in one of the following two categories:Port-specific (either DS-TT port or NW-TT port)Bridge-specific applying to the 5GS TSN bridge as a whole (e.g. Chassis ID, traffic forwarding information, Stream parameters).It is proposed to split the table accordingly into port-specific and bridge-specific information, assuming that it will be transported in Port Management Information Container and Bridge Management Information Container, respectively.Regarding the case of DS-TT that is not able to perform Neighbor discovery, currently the specification implies that a specific NW-TT port container needs to be used (probably randomly selected), although the network discovery on DS-TT behalf is a function of the NW-TT as a whole, rather than a specific NW-TT port.Note that the current specification is unclear whether the NW-TT port used for delivering DS-TT neighbor discovery configuration needs to be the same as the NW-TT port for delivering the DS-TT neighbor discovery information. It is proposed to move the information related to DS-TT not capable of network discovery into the Bridge-specific table because that information targets the NW-TT as a whole, rather than a specific NW-TT port.\n\n>>> SUMMARY OF CHANGE\nClause 5.28.3.1: Separated Port management information and Bridge management information in two different tables. The Bridge management information table also consolidates parameters that are mentioned elsewhere (e.g. in clause 5.28.1 and 5.28.2).Clause 5.28.3.2: Clarified that the information exchanged between TSN AF and NW-TT can include one or several Port Management Information Containers with related NW-TT port numbers and/or one Bridge Management Information Container.\n\n>>> CONSEQUENCES IF NOT REVISED\nBy using Port Management Information only in the current specification text it is implied that for exchange of common 5G TSN bridge information (e.g. Traffic forwarding rules) between AF and NW-TT a specific NW-TT port management container needs to be used. Similarly, for exchanging DS-TT neighbor discovery configuration/information between AF and NW-TT (for DS-TTs that are not capable of neighbor discovery) it is implied that a specific NW-TT port management container needs to be used. Consider how strange this is: if the AF needs to deliver DS-TT discovery configuration to NW-TT, it randomly selects a PDU Session (not necessarily related to the DS-TT for which the neighbor discovery is intended) and also randomly selects the NW-TT port in order to deliver the information to NW-TT\u2026. information that is unrelated to either the \u201chijacked\u201d PDU session or the \u201chijacked\u201d NW-TT port."}]
